(()=>{var NP=Object.create;var Sf=Object.defineProperty;var V_=Object.getOwnPropertyDescriptor;var LP=Object.getOwnPropertyNames;var BP=Object.getPrototypeOf,FP=Object.prototype.hasOwnProperty;var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var VP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of LP(e))!FP.call(i,r)&&r!==t&&Sf(i,r,{get:()=>e[r],enumerable:!(n=V_(e,r))||n.enumerable});return i};var Fr=(i,e,t)=>(t=i!=null?NP(BP(i)):{},VP(e||!i||!i.__esModule?Sf(t,"default",{value:i,enumerable:!0}):t,i));var sc=(i,e,t,n)=>{for(var r=n>1?void 0:n?V_(e,t):e,o=i.length-1,s;o>=0;o--)(s=i[o])&&(r=(n?s(e,t,r):s(r))||r);return n&&r&&Sf(e,t,r),r};var yn=f(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.safeAssign=ui.hasOwnProperty=ui.isObject=void 0;function H_(i){return typeof i=="object"&&i!==null}ui.isObject=H_;function KP(i,e,t){if(!H_(i))return!1;if(Array.isArray(e))for(let n of e){if(!Object.prototype.hasOwnProperty.call(i,n)||typeof t=="string"&&typeof i[n]!==t)return!1;if(typeof t=="function"&&!t(i[n]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,e))return!1;if(typeof t=="string")return typeof i[e]===t;if(typeof t=="function")return t(i[e])}return!0}ui.hasOwnProperty=KP;function HP(i,e){return Object.assign(i,e)}ui.safeAssign=HP});var te=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ReconnectAction=E.ApplyLabelEditAction=E.DeleteElementAction=E.CreateElementAction=E.HoverFeedbackAction=E.MoveAction=E.RedoAction=E.UndoAction=E.BringToFrontAction=E.SetViewportAction=E.FitToScreenAction=E.CenterAction=E.LayoutAction=E.OpenAction=E.CollapseExpandAllAction=E.CollapseExpandAction=E.SelectAllAction=E.SelectAction=E.LoggingAction=E.ComputedBoundsAction=E.RequestBoundsAction=E.SetBoundsAction=E.SetPopupModelAction=E.RequestPopupModelAction=E.UpdateModelAction=E.SetModelAction=E.RequestModelAction=E.RejectAction=E.isResponseAction=E.generateRequestId=E.isRequestAction=E.isAction=E.isActionMessage=void 0;var ac=yn();function zP(i){return(0,ac.hasOwnProperty)(i,"action")}E.isActionMessage=zP;function YP(i){return(0,ac.hasOwnProperty)(i,"kind","string")}E.isAction=YP;function kP(i){return(0,ac.hasOwnProperty)(i,"requestId","string")}E.isRequestAction=kP;var UP=1;function cc(){return(UP++).toString()}E.generateRequestId=cc;function GP(i){return(0,ac.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}E.isResponseAction=GP;var WP;(function(i){i.KIND="rejectRequest";function e(t){return{kind:i.KIND,message:t.message,detail:t.detail,responseId:t.requestId}}i.create=e})(WP=E.RejectAction||(E.RejectAction={}));var $P;(function(i){i.KIND="requestModel";function e(t){return{kind:i.KIND,options:t,requestId:cc()}}i.create=e})($P=E.RequestModelAction||(E.RequestModelAction={}));var XP;(function(i){i.KIND="setModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(XP=E.SetModelAction||(E.SetModelAction={}));var JP;(function(i){i.KIND="updateModel";function e(t,n={}){return Array.isArray(t)?{kind:i.KIND,matches:t,animate:n.animate,cause:n.cause}:{kind:i.KIND,newRoot:t,animate:n.animate,cause:n.cause}}i.create=e})(JP=E.UpdateModelAction||(E.UpdateModelAction={}));var ZP;(function(i){i.KIND="requestPopupModel";function e(t){return{kind:i.KIND,elementId:t.elementId,bounds:t.bounds,requestId:cc()}}i.create=e})(ZP=E.RequestPopupModelAction||(E.RequestPopupModelAction={}));var QP;(function(i){i.KIND="setPopupModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(QP=E.SetPopupModelAction||(E.SetPopupModelAction={}));var eI;(function(i){i.KIND="setBounds";function e(t){return{kind:i.KIND,bounds:t}}i.create=e})(eI=E.SetBoundsAction||(E.SetBoundsAction={}));var tI;(function(i){i.KIND="requestBounds";function e(t){return{kind:i.KIND,newRoot:t,requestId:cc()}}i.create=e})(tI=E.RequestBoundsAction||(E.RequestBoundsAction={}));var nI;(function(i){i.KIND="computedBounds";function e(t,n={}){var r;return{kind:i.KIND,bounds:t,revision:n.revision,alignments:n.alignments,responseId:(r=n.requestId)!==null&&r!==void 0?r:""}}i.create=e})(nI=E.ComputedBoundsAction||(E.ComputedBoundsAction={}));var iI;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(iI=E.LoggingAction||(E.LoggingAction={}));var rI;(function(i){i.KIND="elementSelected";function e(t){var n,r;return{kind:i.KIND,selectedElementsIDs:(n=t.selectedElementsIDs)!==null&&n!==void 0?n:[],deselectedElementsIDs:(r=t.deselectedElementsIDs)!==null&&r!==void 0?r:[]}}i.create=e})(rI=E.SelectAction||(E.SelectAction={}));var oI;(function(i){i.KIND="allSelected";function e(t={}){var n;return{kind:i.KIND,select:(n=t.select)!==null&&n!==void 0?n:!0}}i.create=e})(oI=E.SelectAllAction||(E.SelectAllAction={}));var sI;(function(i){i.KIND="collapseExpand";function e(t){var n,r;return{kind:i.KIND,expandIds:(n=t.expandIds)!==null&&n!==void 0?n:[],collapseIds:(r=t.collapseIds)!==null&&r!==void 0?r:[]}}i.create=e})(sI=E.CollapseExpandAction||(E.CollapseExpandAction={}));var aI;(function(i){i.KIND="collapseExpandAll";function e(t={}){var n;return{kind:i.KIND,expand:(n=t.expand)!==null&&n!==void 0?n:!0}}i.create=e})(aI=E.CollapseExpandAllAction||(E.CollapseExpandAllAction={}));var cI;(function(i){i.KIND="open";function e(t){return{kind:i.KIND,elementId:t}}i.create=e})(cI=E.OpenAction||(E.OpenAction={}));var uI;(function(i){i.KIND="layout";function e(t={}){return{kind:i.KIND,layoutType:t.layoutType,elementIds:t.elementIds}}i.create=e})(uI=E.LayoutAction||(E.LayoutAction={}));var dI;(function(i){i.KIND="center";function e(t,n={}){var r,o;return{kind:i.KIND,elementIds:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,retainZoom:(o=n.retainZoom)!==null&&o!==void 0?o:!1}}i.create=e})(dI=E.CenterAction||(E.CenterAction={}));var lI;(function(i){i.KIND="fit";function e(t,n={}){var r;return{kind:i.KIND,elementIds:t,padding:n.padding,maxZoom:n.maxZoom,animate:(r=n.animate)!==null&&r!==void 0?r:!0}}i.create=e})(lI=E.FitToScreenAction||(E.FitToScreenAction={}));var fI;(function(i){i.KIND="viewport";function e(t,n,r={}){var o;return{kind:i.KIND,elementId:t,newViewport:n,animate:(o=r.animate)!==null&&o!==void 0?o:!0}}i.create=e})(fI=E.SetViewportAction||(E.SetViewportAction={}));var hI;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(hI=E.BringToFrontAction||(E.BringToFrontAction={}));var pI;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(pI=E.UndoAction||(E.UndoAction={}));var gI;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(gI=E.RedoAction||(E.RedoAction={}));var mI;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(mI=E.MoveAction||(E.MoveAction={}));var yI;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(yI=E.HoverFeedbackAction||(E.HoverFeedbackAction={}));var _I;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(_I=E.CreateElementAction||(E.CreateElementAction={}));var vI;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(vI=E.DeleteElementAction||(E.DeleteElementAction={}));var bI;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(bI=E.ApplyLabelEditAction||(E.ApplyLabelEditAction={}));var SI;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(SI=E.ReconnectAction||(E.ReconnectAction={}))});var uc=f(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.isLabeledAction=We.LabeledAction=We.RejectAction=We.isResponseAction=We.generateRequestId=We.isRequestAction=We.isAction=void 0;var EI=te(),wf=yn();function Pf(i){return(0,wf.hasOwnProperty)(i,"kind","string")}We.isAction=Pf;function wI(i){return Pf(i)&&(0,wf.hasOwnProperty)(i,"requestId","string")}We.isRequestAction=wI;We.generateRequestId=EI.generateRequestId;function PI(i){return Pf(i)&&(0,wf.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}We.isResponseAction=PI;var Vr=class{constructor(e,t,n){this.message=e,this.responseId=t,this.detail=n,this.kind=Vr.KIND}};We.RejectAction=Vr;Vr.KIND="rejectRequest";var Ef=class{constructor(e,t,n){this.label=e,this.actions=t,this.icon=n}};We.LabeledAction=Ef;function II(i){return i!==void 0&&i.label!==void 0&&i.actions!==void 0}We.isLabeledAction=II});var Ce=f(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0;J.NAMED_TAG="named";J.NAME_TAG="name";J.UNMANAGED_TAG="unmanaged";J.OPTIONAL_TAG="optional";J.INJECT_TAG="inject";J.MULTI_INJECT_TAG="multi_inject";J.TAGGED="inversify:tagged";J.TAGGED_PROP="inversify:tagged_props";J.PARAM_TYPES="inversify:paramtypes";J.DESIGN_PARAM_TYPES="design:paramtypes";J.POST_CONSTRUCT="post_construct";function RI(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=RI()});var _n=f(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.TargetTypeEnum=di.BindingTypeEnum=di.BindingScopeEnum=void 0;var MI={Request:"Request",Singleton:"Singleton",Transient:"Transient"};di.BindingScopeEnum=MI;var OI={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};di.BindingTypeEnum=OI;var TI={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};di.TargetTypeEnum=TI});var li=f(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});dc.id=void 0;var AI=0;function CI(){return AI++}dc.id=CI});var Y_=f(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});lc.Binding=void 0;var z_=_n(),xI=li(),DI=function(){function i(e,t){this.id=xI.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=z_.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return i.prototype.clone=function(){var e=new i(this.serviceIdentifier,this.scope);return e.activated=e.scope===z_.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},i}();lc.Binding=DI});var lt=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.STACK_OVERFLOW=T.CIRCULAR_DEPENDENCY_IN_FACTORY=T.POST_CONSTRUCT_ERROR=T.MULTIPLE_POST_CONSTRUCT_METHODS=T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=T.ARGUMENTS_LENGTH_MISMATCH=T.INVALID_DECORATOR_OPERATION=T.INVALID_TO_SELF_VALUE=T.INVALID_FUNCTION_BINDING=T.INVALID_MIDDLEWARE_RETURN=T.NO_MORE_SNAPSHOTS_AVAILABLE=T.INVALID_BINDING_TYPE=T.NOT_IMPLEMENTED=T.CIRCULAR_DEPENDENCY=T.UNDEFINED_INJECT_ANNOTATION=T.MISSING_INJECT_ANNOTATION=T.MISSING_INJECTABLE_ANNOTATION=T.NOT_REGISTERED=T.CANNOT_UNBIND=T.AMBIGUOUS_MATCH=T.KEY_NOT_FOUND=T.NULL_ARGUMENT=T.DUPLICATED_METADATA=T.DUPLICATED_INJECTABLE_DECORATOR=void 0;T.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";T.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";T.NULL_ARGUMENT="NULL argument";T.KEY_NOT_FOUND="Key Not Found";T.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";T.CANNOT_UNBIND="Could not unbind serviceIdentifier:";T.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";T.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";T.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var qI=function(i){return"@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};T.UNDEFINED_INJECT_ANNOTATION=qI;T.CIRCULAR_DEPENDENCY="Circular dependency found:";T.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";T.INVALID_BINDING_TYPE="Invalid binding type:";T.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";T.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";T.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";T.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";T.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var jI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"The number of constructor arguments in the derived class "+(i[0]+" must be >= than the number of constructor arguments of its base class.")};T.ARGUMENTS_LENGTH_MISMATCH=jI;T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";T.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var NI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"@postConstruct error in class "+i[0]+": "+i[1]};T.POST_CONSTRUCT_ERROR=NI;var LI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"It looks like there is a circular dependency "+("in one of the '"+i[0]+"' bindings. Please investigate bindings with")+("service identifier '"+i[1]+"'.")};T.CIRCULAR_DEPENDENCY_IN_FACTORY=LI;T.STACK_OVERFLOW="Maximum call stack size exceeded"});var Rf=f(fc=>{"use strict";Object.defineProperty(fc,"__esModule",{value:!0});fc.MetadataReader=void 0;var If=Ce(),BI=function(){function i(){}return i.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(If.PARAM_TYPES,e),n=Reflect.getMetadata(If.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},i.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(If.TAGGED_PROP,e)||[];return t},i}();fc.MetadataReader=BI});var k_=f(hc=>{"use strict";Object.defineProperty(hc,"__esModule",{value:!0});hc.BindingCount=void 0;var FI={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};hc.BindingCount=FI});var Mf=f(pc=>{"use strict";Object.defineProperty(pc,"__esModule",{value:!0});pc.isStackOverflowExeption=void 0;var VI=lt();function KI(i){return i instanceof RangeError||i.message===VI.STACK_OVERFLOW}pc.isStackOverflowExeption=KI});var Kr=f(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.circularDependencyToException=Ft.listMetadataForTarget=Ft.listRegisteredBindingsForServiceIdentifier=Ft.getServiceIdentifierAsString=Ft.getFunctionName=void 0;var HI=lt();function U_(i){if(typeof i=="function"){var e=i;return e.name}else{if(typeof i=="symbol")return i.toString();var e=i;return e}}Ft.getServiceIdentifierAsString=U_;function zI(i,e,t){var n="",r=t(i,e);return r.length!==0&&(n=`
Registered bindings:`,r.forEach(function(o){var s="Object";o.implementationType!==null&&(s=$_(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Ft.listRegisteredBindingsForServiceIdentifier=zI;function G_(i,e){return i.parentRequest===null?!1:i.parentRequest.serviceIdentifier===e?!0:G_(i.parentRequest,e)}function YI(i){function e(n,r){r===void 0&&(r=[]);var o=U_(n.serviceIdentifier);return r.push(o),n.parentRequest!==null?e(n.parentRequest,r):r}var t=e(i);return t.reverse().join(" --> ")}function W_(i){i.childRequests.forEach(function(e){if(G_(e,e.serviceIdentifier)){var t=YI(e);throw new Error(HI.CIRCULAR_DEPENDENCY+" "+t)}else W_(e)})}Ft.circularDependencyToException=W_;function kI(i,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),r=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),r!==null&&r.forEach(function(o){t+=o.toString()+`
`})," "+i+`
 `+i+" - "+t}else return" "+i}Ft.listMetadataForTarget=kI;function $_(i){if(i.name)return i.name;var e=i.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Ft.getFunctionName=$_});var X_=f(gc=>{"use strict";Object.defineProperty(gc,"__esModule",{value:!0});gc.Context=void 0;var UI=li(),GI=function(){function i(e){this.id=UI.id(),this.container=e}return i.prototype.addPlan=function(e){this.plan=e},i.prototype.setCurrentRequest=function(e){this.currentRequest=e},i}();gc.Context=GI});var Vt=f(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});mc.Metadata=void 0;var WI=Ce(),$I=function(){function i(e,t){this.key=e,this.value=t}return i.prototype.toString=function(){return this.key===WI.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},i}();mc.Metadata=$I});var J_=f(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});yc.Plan=void 0;var XI=function(){function i(e,t){this.parentContext=e,this.rootRequest=t}return i}();yc.Plan=XI});var zn=f(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.tagProperty=fi.tagParameter=fi.decorate=void 0;var Z_=lt(),ev=Ce();function JI(i,e,t,n){var r=ev.TAGGED;tv(r,i,e,n,t)}fi.tagParameter=JI;function ZI(i,e,t){var n=ev.TAGGED_PROP;tv(n,i.constructor,e,t)}fi.tagProperty=ZI;function tv(i,e,t,n,r){var o={},s=typeof r=="number",a=r!==void 0&&s?r.toString():t;if(s&&t!==void 0)throw new Error(Z_.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(i,e)&&(o=Reflect.getMetadata(i,e));var c=o[a];if(!Array.isArray(c))c=[];else for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===n.key)throw new Error(Z_.DUPLICATED_METADATA+" "+l.key.toString())}c.push(n),o[a]=c,Reflect.defineMetadata(i,o,e)}function Q_(i,e){Reflect.decorate(i,e)}function QI(i,e){return function(t,n){e(t,n,i)}}function eR(i,e,t){typeof t=="number"?Q_([QI(t,i)],e):typeof t=="string"?Reflect.decorate([i],e,t):Q_([i],e)}fi.decorate=eR});var Of=f(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.inject=Hr.LazyServiceIdentifer=void 0;var tR=lt(),nR=Ce(),iR=Vt(),nv=zn(),rR=function(){function i(e){this._cb=e}return i.prototype.unwrap=function(){return this._cb()},i}();Hr.LazyServiceIdentifer=rR;function oR(i){return function(e,t,n){if(i===void 0)throw new Error(tR.UNDEFINED_INJECT_ANNOTATION(e.name));var r=new iR.Metadata(nR.INJECT_TAG,i);typeof n=="number"?nv.tagParameter(e,t,n,r):nv.tagProperty(e,t,r)}}Hr.inject=oR});var iv=f(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.QueryableString=void 0;var sR=function(){function i(e){this.str=e}return i.prototype.startsWith=function(e){return this.str.indexOf(e)===0},i.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},i.prototype.contains=function(e){return this.str.indexOf(e)!==-1},i.prototype.equals=function(e){return this.str===e},i.prototype.value=function(){return this.str},i}();_c.QueryableString=sR});var Tf=f(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});vc.Target=void 0;var Yn=Ce(),aR=li(),rv=Vt(),cR=iv(),uR=function(){function i(e,t,n,r){this.id=aR.id(),this.type=e,this.serviceIdentifier=n,this.name=new cR.QueryableString(t||""),this.metadata=new Array;var o=null;typeof r=="string"?o=new rv.Metadata(Yn.NAMED_TAG,r):r instanceof rv.Metadata&&(o=r),o!==null&&this.metadata.push(o)}return i.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var r=n[t];if(r.key===e)return!0}return!1},i.prototype.isArray=function(){return this.hasTag(Yn.MULTI_INJECT_TAG)},i.prototype.matchesArray=function(e){return this.matchesTag(Yn.MULTI_INJECT_TAG)(e)},i.prototype.isNamed=function(){return this.hasTag(Yn.NAMED_TAG)},i.prototype.isTagged=function(){return this.metadata.some(function(e){return Yn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},i.prototype.isOptional=function(){return this.matchesTag(Yn.OPTIONAL_TAG)(!0)},i.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Yn.NAMED_TAG})[0]:null},i.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Yn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},i.prototype.matchesNamedTag=function(e){return this.matchesTag(Yn.NAMED_TAG)(e)},i.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var s=o[r];if(s.key===e&&s.value===n)return!0}return!1}},i}();vc.Target=uR});var fv=f(vn=>{"use strict";var bc=vn&&vn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(vn,"__esModule",{value:!0});vn.getFunctionName=vn.getBaseClassDependencyCount=vn.getDependencies=void 0;var dR=Of(),ov=lt(),sv=_n(),Is=Ce(),Af=Kr();Object.defineProperty(vn,"getFunctionName",{enumerable:!0,get:function(){return Af.getFunctionName}});var av=Tf();function lR(i,e){var t=Af.getFunctionName(e),n=cv(i,t,e,!1);return n}vn.getDependencies=lR;function cv(i,e,t,n){var r=i.getConstructorMetadata(t),o=r.compilerGeneratedMetadata;if(o===void 0){var s=ov.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=r.userGeneratedMetadata,c=Object.keys(a),u=t.length===0&&c.length>0,d=c.length>t.length,l=u||d?c.length:t.length,S=hR(n,e,o,a,l),R=uv(i,t),v=bc(bc([],S),R);return v}function fR(i,e,t,n,r){var o=r[i.toString()]||[],s=lv(o),a=s.unmanaged!==!0,c=n[i],u=s.inject||s.multiInject;if(c=u||c,c instanceof dR.LazyServiceIdentifer&&(c=c.unwrap()),a){var d=c===Object,l=c===Function,S=c===void 0,R=d||l||S;if(!e&&R){var v=ov.MISSING_INJECT_ANNOTATION+" argument "+i+" in class "+t+".";throw new Error(v)}var m=new av.Target(sv.TargetTypeEnum.ConstructorArgument,s.targetName,c);return m.metadata=o,m}return null}function hR(i,e,t,n,r){for(var o=[],s=0;s<r;s++){var a=s,c=fR(a,i,e,t,n);c!==null&&o.push(c)}return o}function uv(i,e){for(var t=i.getPropertiesMetadata(e),n=[],r=Object.keys(t),o=0,s=r;o<s.length;o++){var a=s[o],c=t[a],u=lv(t[a]),d=u.targetName||a,l=u.inject||u.multiInject,S=new av.Target(sv.TargetTypeEnum.ClassProperty,d,l);S.metadata=c,n.push(S)}var R=Object.getPrototypeOf(e.prototype).constructor;if(R!==Object){var v=uv(i,R);n=bc(bc([],n),v)}return n}function dv(i,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=Af.getFunctionName(t),r=cv(i,n,t,!0),o=r.map(function(c){return c.metadata.filter(function(u){return u.key===Is.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=r.length-s;return a>0?a:dv(i,t)}else return 0}vn.getBaseClassDependencyCount=dv;function lv(i){var e={};return i.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[Is.INJECT_TAG],multiInject:e[Is.MULTI_INJECT_TAG],targetName:e[Is.NAME_TAG],unmanaged:e[Is.UNMANAGED_TAG]}}});var hv=f(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.Request=void 0;var pR=li(),gR=function(){function i(e,t,n,r,o){this.id=pR.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=n===null?new Map:null}return i.prototype.addChildRequest=function(e,t,n){var r=new i(e,this.parentContext,this,t,n);return this.childRequests.push(r),r},i}();Sc.Request=gR});var Sv=f(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.getBindingDictionary=hi.createMockRequest=hi.plan=void 0;var Ec=k_(),xf=lt(),mv=_n(),pv=Ce(),mR=Mf(),zr=Kr(),yv=X_(),Df=Vt(),yR=J_(),Cf=fv(),qf=hv(),_v=Tf();function vv(i){return i._bindingDictionary}hi.getBindingDictionary=vv;function _R(i,e,t,n,r,o){var s=i?pv.MULTI_INJECT_TAG:pv.INJECT_TAG,a=new Df.Metadata(s,t),c=new _v.Target(e,n,t,a);if(r!==void 0){var u=new Df.Metadata(r,o);c.metadata.push(u)}return c}function gv(i,e,t,n,r){var o=Rs(t.container,r.serviceIdentifier),s=[];return o.length===Ec.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(r.serviceIdentifier).toSelf(),o=Rs(t.container,r.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new qf.Request(a.serviceIdentifier,t,n,a,r);return a.constraint(c)}),vR(r.serviceIdentifier,s,r,t.container),s}function vR(i,e,t,n){switch(e.length){case Ec.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var r=zr.getServiceIdentifierAsString(i),o=xf.NOT_REGISTERED;throw o+=zr.listMetadataForTarget(r,t),o+=zr.listRegisteredBindingsForServiceIdentifier(n,r,Rs),new Error(o);case Ec.BindingCount.OnlyOneBindingAvailable:if(!t.isArray())return e;case Ec.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var r=zr.getServiceIdentifierAsString(i),o=xf.AMBIGUOUS_MATCH+" "+r;throw o+=zr.listRegisteredBindingsForServiceIdentifier(n,r,Rs),new Error(o)}}function bv(i,e,t,n,r,o){var s,a;if(r===null){s=gv(i,e,n,null,o),a=new qf.Request(t,n,null,s,o);var c=new yR.Plan(n,a);n.addPlan(c)}else s=gv(i,e,n,r,o),a=r.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(u){var d=null;if(o.isArray())d=a.addChildRequest(u.serviceIdentifier,u,o);else{if(u.cache)return;d=a}if(u.type===mv.BindingTypeEnum.Instance&&u.implementationType!==null){var l=Cf.getDependencies(i,u.implementationType);if(!n.container.options.skipBaseClassChecks){var S=Cf.getBaseClassDependencyCount(i,u.implementationType);if(l.length<S){var R=xf.ARGUMENTS_LENGTH_MISMATCH(Cf.getFunctionName(u.implementationType));throw new Error(R)}}l.forEach(function(v){bv(i,!1,v.serviceIdentifier,n,d,v)})}})}function Rs(i,e){var t=[],n=vv(i);return n.hasKey(e)?t=n.get(e):i.parent!==null&&(t=Rs(i.parent,e)),t}function bR(i,e,t,n,r,o,s,a){a===void 0&&(a=!1);var c=new yv.Context(e),u=_R(t,n,r,"",o,s);try{return bv(i,a,r,c,null,u),c}catch(d){throw mR.isStackOverflowExeption(d)&&c.plan&&zr.circularDependencyToException(c.plan.rootRequest),d}}hi.plan=bR;function SR(i,e,t,n){var r=new _v.Target(mv.TargetTypeEnum.Variable,"",e,new Df.Metadata(t,n)),o=new yv.Context(i),s=new qf.Request(e,o,null,[],r);return s}hi.createMockRequest=SR});var Pv=f(Yr=>{"use strict";var ER=Yr&&Yr.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.resolveInstance=void 0;var wR=lt(),wv=_n(),Ev=Ce();function PR(i,e,t){var n=e.filter(function(o){return o.target!==null&&o.target.type===wv.TargetTypeEnum.ClassProperty}),r=n.map(t);return n.forEach(function(o,s){var a="";a=o.target.name.value();var c=r[s];i[a]=c}),i}function IR(i,e){return new(i.bind.apply(i,ER([void 0],e)))}function RR(i,e){if(Reflect.hasMetadata(Ev.POST_CONSTRUCT,i)){var t=Reflect.getMetadata(Ev.POST_CONSTRUCT,i);try{e[t.value]()}catch(n){throw new Error(wR.POST_CONSTRUCT_ERROR(i.name,n.message))}}}function MR(i,e,t){var n=null;if(e.length>0){var r=e.filter(function(s){return s.target!==null&&s.target.type===wv.TargetTypeEnum.ConstructorArgument}),o=r.map(t);n=IR(i,o),n=PR(n,e,t)}else n=new i;return RR(i,n),n}Yr.resolveInstance=MR});var Rv=f(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.resolve=void 0;var Iv=lt(),kn=_n(),OR=Mf(),TR=Kr(),AR=Pv(),jf=function(i,e,t){try{return t()}catch(n){throw OR.isStackOverflowExeption(n)?new Error(Iv.CIRCULAR_DEPENDENCY_IN_FACTORY(i,e.toString())):n}},Nf=function(i){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,r=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(r&&o)return n.map(function(l){var S=Nf(i);return S(l)});var s=null;if(e.target.isOptional()&&t.length===0)return;var a=t[0],c=a.scope===kn.BindingScopeEnum.Singleton,u=a.scope===kn.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&i!==null&&i.has(a.id))return i.get(a.id);if(a.type===kn.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===kn.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===kn.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===kn.BindingTypeEnum.DynamicValue&&a.dynamicValue!==null)s=jf("toDynamicValue",a.serviceIdentifier,function(){return a.dynamicValue(e.parentContext)});else if(a.type===kn.BindingTypeEnum.Factory&&a.factory!==null)s=jf("toFactory",a.serviceIdentifier,function(){return a.factory(e.parentContext)});else if(a.type===kn.BindingTypeEnum.Provider&&a.provider!==null)s=jf("toProvider",a.serviceIdentifier,function(){return a.provider(e.parentContext)});else if(a.type===kn.BindingTypeEnum.Instance&&a.implementationType!==null)s=AR.resolveInstance(a.implementationType,n,Nf(i));else{var d=TR.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(Iv.INVALID_BINDING_TYPE+" "+d)}return typeof a.onActivation=="function"&&(s=a.onActivation(e.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&i!==null&&!i.has(a.id)&&i.set(a.id,s),s}};function CR(i){var e=Nf(i.plan.rootRequest.requestScope);return e(i.plan.rootRequest)}wc.resolve=CR});var Lf=f(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.typeConstraint=bn.namedConstraint=bn.taggedConstraint=bn.traverseAncerstors=void 0;var xR=Ce(),DR=Vt(),Mv=function(i,e){var t=i.parentRequest;return t!==null?e(t)?!0:Mv(t,e):!1};bn.traverseAncerstors=Mv;var Ov=function(i){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(i)(e)};return t.metaData=new DR.Metadata(i,e),t}};bn.taggedConstraint=Ov;var qR=Ov(xR.NAMED_TAG);bn.namedConstraint=qR;var jR=function(i){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof i=="string"){var n=t.serviceIdentifier;return n===i}else{var r=e.bindings[0].implementationType;return i===r}return!1}};bn.typeConstraint=jR});var Ic=f(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.BindingWhenSyntax=void 0;var rt=Rc(),xe=Lf(),NR=function(){function i(e){this._binding=e}return i.prototype.when=function(e){return this._binding.constraint=e,new rt.BindingOnSyntax(this._binding)},i.prototype.whenTargetNamed=function(e){return this._binding.constraint=xe.namedConstraint(e),new rt.BindingOnSyntax(this._binding)},i.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new rt.BindingOnSyntax(this._binding)},i.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=xe.taggedConstraint(e)(t),new rt.BindingOnSyntax(this._binding)},i.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return xe.typeConstraint(e)(t.parentRequest)},new rt.BindingOnSyntax(this._binding)},i.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return xe.namedConstraint(e)(t.parentRequest)},new rt.BindingOnSyntax(this._binding)},i.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return xe.taggedConstraint(e)(t)(n.parentRequest)},new rt.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,xe.typeConstraint(e))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,xe.typeConstraint(e))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,xe.namedConstraint(e))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,xe.namedConstraint(e))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return xe.traverseAncerstors(n,xe.taggedConstraint(e)(t))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!xe.traverseAncerstors(n,xe.taggedConstraint(e)(t))},new rt.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,e)},new rt.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,e)},new rt.BindingOnSyntax(this._binding)},i}();Pc.BindingWhenSyntax=NR});var Rc=f(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.BindingOnSyntax=void 0;var LR=Ic(),BR=function(){function i(e){this._binding=e}return i.prototype.onActivation=function(e){return this._binding.onActivation=e,new LR.BindingWhenSyntax(this._binding)},i}();Mc.BindingOnSyntax=BR});var Bf=f(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.BindingWhenOnSyntax=void 0;var FR=Rc(),VR=Ic(),KR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new VR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new FR.BindingOnSyntax(this._binding)}return i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Oc.BindingWhenOnSyntax=KR});var Tv=f(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.BindingInSyntax=void 0;var Ff=_n(),Vf=Bf(),HR=function(){function i(e){this._binding=e}return i.prototype.inRequestScope=function(){return this._binding.scope=Ff.BindingScopeEnum.Request,new Vf.BindingWhenOnSyntax(this._binding)},i.prototype.inSingletonScope=function(){return this._binding.scope=Ff.BindingScopeEnum.Singleton,new Vf.BindingWhenOnSyntax(this._binding)},i.prototype.inTransientScope=function(){return this._binding.scope=Ff.BindingScopeEnum.Transient,new Vf.BindingWhenOnSyntax(this._binding)},i}();Tc.BindingInSyntax=HR});var Av=f(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.BindingInWhenOnSyntax=void 0;var zR=Tv(),YR=Rc(),kR=Ic(),UR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new kR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new YR.BindingOnSyntax(this._binding),this._bindingInSyntax=new zR.BindingInSyntax(e)}return i.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},i.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},i.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Ac.BindingInWhenOnSyntax=UR});var Dv=f(Cc=>{"use strict";Object.defineProperty(Cc,"__esModule",{value:!0});Cc.BindingToSyntax=void 0;var Cv=lt(),ft=_n(),xv=Av(),Ms=Bf(),GR=function(){function i(e){this._binding=e}return i.prototype.to=function(e){return this._binding.type=ft.BindingTypeEnum.Instance,this._binding.implementationType=e,new xv.BindingInWhenOnSyntax(this._binding)},i.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Cv.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},i.prototype.toConstantValue=function(e){return this._binding.type=ft.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ft.BindingScopeEnum.Singleton,new Ms.BindingWhenOnSyntax(this._binding)},i.prototype.toDynamicValue=function(e){return this._binding.type=ft.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new xv.BindingInWhenOnSyntax(this._binding)},i.prototype.toConstructor=function(e){return this._binding.type=ft.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=ft.BindingScopeEnum.Singleton,new Ms.BindingWhenOnSyntax(this._binding)},i.prototype.toFactory=function(e){return this._binding.type=ft.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=ft.BindingScopeEnum.Singleton,new Ms.BindingWhenOnSyntax(this._binding)},i.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Cv.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=ft.BindingTypeEnum.Function,this._binding.scope=ft.BindingScopeEnum.Singleton,t},i.prototype.toAutoFactory=function(e){return this._binding.type=ft.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=ft.BindingScopeEnum.Singleton,new Ms.BindingWhenOnSyntax(this._binding)},i.prototype.toProvider=function(e){return this._binding.type=ft.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=ft.BindingScopeEnum.Singleton,new Ms.BindingWhenOnSyntax(this._binding)},i.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},i}();Cc.BindingToSyntax=GR});var qv=f(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.ContainerSnapshot=void 0;var WR=function(){function i(){}return i.of=function(e,t){var n=new i;return n.bindings=e,n.middleware=t,n},i}();xc.ContainerSnapshot=WR});var jv=f(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.Lookup=void 0;var Zi=lt(),$R=function(){function i(){this._map=new Map}return i.prototype.getMap=function(){return this._map},i.prototype.add=function(e,t){if(e==null)throw new Error(Zi.NULL_ARGUMENT);if(t==null)throw new Error(Zi.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},i.prototype.get=function(e){if(e==null)throw new Error(Zi.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(Zi.KEY_NOT_FOUND)},i.prototype.remove=function(e){if(e==null)throw new Error(Zi.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(Zi.KEY_NOT_FOUND)},i.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var o=n.filter(function(s){return!e(s)});o.length>0?t._map.set(r,o):t._map.delete(r)})},i.prototype.hasKey=function(e){if(e==null)throw new Error(Zi.NULL_ARGUMENT);return this._map.has(e)},i.prototype.clone=function(){var e=new i;return this._map.forEach(function(t,n){t.forEach(function(r){return e.add(n,r.clone())})}),e},i.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},i}();Dc.Lookup=$R});var Lv=f(Sn=>{"use strict";var XR=Sn&&Sn.__awaiter||function(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(l){s(l)}}function c(d){try{u(n.throw(d))}catch(l){s(l)}}function u(d){d.done?o(d.value):r(d.value).then(a,c)}u((n=n.apply(i,e||[])).next())})},JR=Sn&&Sn.__generator||function(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},ZR=Sn&&Sn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.Container=void 0;var QR=Y_(),Qi=lt(),Un=_n(),Kf=Ce(),eM=Rf(),qc=Sv(),tM=Rv(),nM=Dv(),iM=li(),rM=Kr(),oM=qv(),Nv=jv(),sM=function(){function i(e){this._appliedMiddleware=[];var t=e||{};if(typeof t!="object")throw new Error(""+Qi.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Un.BindingScopeEnum.Transient;else if(t.defaultScope!==Un.BindingScopeEnum.Singleton&&t.defaultScope!==Un.BindingScopeEnum.Transient&&t.defaultScope!==Un.BindingScopeEnum.Request)throw new Error(""+Qi.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+Qi.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+Qi.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=iM.id(),this._bindingDictionary=new Nv.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new eM.MetadataReader}return i.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i,s=ZR([e,t],n).map(function(u){return qc.getBindingDictionary(u)}),a=qc.getBindingDictionary(o);function c(u,d){u.traverse(function(l,S){S.forEach(function(R){d.add(R.serviceIdentifier,R.clone())})})}return s.forEach(function(u){c(u,a)}),o},i.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var s=o[r],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},i.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return XR(this,void 0,void 0,function(){var n,r,o,s,a;return JR(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(o){return function(s){return s.moduleId===o}};t.forEach(function(o){var s=r(o.id);e._bindingDictionary.removeByCondition(s)})},i.prototype.bind=function(e){var t=this.options.defaultScope||Un.BindingScopeEnum.Transient,n=new QR.Binding(e,t);return this._bindingDictionary.add(e,n),new nM.BindingToSyntax(n)},i.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},i.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(Qi.CANNOT_UNBIND+" "+rM.getServiceIdentifierAsString(e))}},i.prototype.unbindAll=function(){this._bindingDictionary=new Nv.Lookup},i.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},i.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Kf.NAMED_TAG,t)},i.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=qc.createMockRequest(this,e,t,n);r=o.some(function(a){return a.constraint(s)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},i.prototype.snapshot=function(){this._snapshots.push(oM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},i.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(Qi.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},i.prototype.createChild=function(e){var t=new i(e||this.options);return t.parent=this,t},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(r,o){return o(r)},n)},i.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},i.prototype.get=function(e){return this._get(!1,!1,Un.TargetTypeEnum.Variable,e)},i.prototype.getTagged=function(e,t,n){return this._get(!1,!1,Un.TargetTypeEnum.Variable,e,t,n)},i.prototype.getNamed=function(e,t){return this.getTagged(e,Kf.NAMED_TAG,t)},i.prototype.getAll=function(e){return this._get(!0,!0,Un.TargetTypeEnum.Variable,e)},i.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,Un.TargetTypeEnum.Variable,e,t,n)},i.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Kf.NAMED_TAG,t)},i.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(e)},i.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(a,c){a._binding.moduleId=c},n=function(a){return function(c){var u=e.bind.bind(e),d=u(c);return t(d,a),d}},r=function(a){return function(c){var u=e.unbind.bind(e);u(c)}},o=function(a){return function(c){var u=e.isBound.bind(e);return u(c)}},s=function(a){return function(c){var u=e.rebind.bind(e),d=u(c);return t(d,a),d}};return function(a){return{bindFunction:n(a),isboundFunction:o(a),rebindFunction:s(a),unbindFunction:r(a)}}},i.prototype._get=function(e,t,n,r,o,s){var a=null,c={avoidConstraints:e,contextInterceptor:function(u){return u},isMultiInject:t,key:o,serviceIdentifier:r,targetType:n,value:s};if(this._middleware){if(a=this._middleware(c),a==null)throw new Error(Qi.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},i.prototype._planAndResolve=function(){var e=this;return function(t){var n=qc.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var r=tM.resolve(n);return r}},i}();Sn.Container=sM});var Fv=f(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.AsyncContainerModule=kr.ContainerModule=void 0;var Bv=li(),aM=function(){function i(e){this.id=Bv.id(),this.registry=e}return i}();kr.ContainerModule=aM;var cM=function(){function i(e){this.id=Bv.id(),this.registry=e}return i}();kr.AsyncContainerModule=cM});var Vv=f(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.injectable=void 0;var uM=lt(),Hf=Ce();function dM(){return function(i){if(Reflect.hasOwnMetadata(Hf.PARAM_TYPES,i))throw new Error(uM.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(Hf.DESIGN_PARAM_TYPES,i)||[];return Reflect.defineMetadata(Hf.PARAM_TYPES,e,i),i}}jc.injectable=dM});var Hv=f(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.tagged=void 0;var lM=Vt(),Kv=zn();function fM(i,e){return function(t,n,r){var o=new lM.Metadata(i,e);typeof r=="number"?Kv.tagParameter(t,n,r,o):Kv.tagProperty(t,n,o)}}Nc.tagged=fM});var Yv=f(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.named=void 0;var hM=Ce(),pM=Vt(),zv=zn();function gM(i){return function(e,t,n){var r=new pM.Metadata(hM.NAMED_TAG,i);typeof n=="number"?zv.tagParameter(e,t,n,r):zv.tagProperty(e,t,r)}}Lc.named=gM});var Uv=f(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.optional=void 0;var mM=Ce(),yM=Vt(),kv=zn();function _M(){return function(i,e,t){var n=new yM.Metadata(mM.OPTIONAL_TAG,!0);typeof t=="number"?kv.tagParameter(i,e,t,n):kv.tagProperty(i,e,n)}}Bc.optional=_M});var Gv=f(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.unmanaged=void 0;var vM=Ce(),bM=Vt(),SM=zn();function EM(){return function(i,e,t){var n=new bM.Metadata(vM.UNMANAGED_TAG,!0);SM.tagParameter(i,e,t,n)}}Fc.unmanaged=EM});var $v=f(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.multiInject=void 0;var wM=Ce(),PM=Vt(),Wv=zn();function IM(i){return function(e,t,n){var r=new PM.Metadata(wM.MULTI_INJECT_TAG,i);typeof n=="number"?Wv.tagParameter(e,t,n,r):Wv.tagProperty(e,t,r)}}Vc.multiInject=IM});var Xv=f(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.targetName=void 0;var RM=Ce(),MM=Vt(),OM=zn();function TM(i){return function(e,t,n){var r=new MM.Metadata(RM.NAME_TAG,i);OM.tagParameter(e,t,n,r)}}Kc.targetName=TM});var Jv=f(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.postConstruct=void 0;var AM=lt(),zf=Ce(),CM=Vt();function xM(){return function(i,e,t){var n=new CM.Metadata(zf.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(zf.POST_CONSTRUCT,i.constructor))throw new Error(AM.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(zf.POST_CONSTRUCT,n,i.constructor)}}Hc.postConstruct=xM});var Zv=f(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.multiBindToService=void 0;var DM=function(i){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(r){return i.bind(r).toService(e)})}}};zc.multiBindToService=DM});var _=f(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.multiBindToService=x.getServiceIdentifierAsString=x.typeConstraint=x.namedConstraint=x.taggedConstraint=x.traverseAncerstors=x.decorate=x.id=x.MetadataReader=x.postConstruct=x.targetName=x.multiInject=x.unmanaged=x.optional=x.LazyServiceIdentifer=x.inject=x.named=x.tagged=x.injectable=x.ContainerModule=x.AsyncContainerModule=x.TargetTypeEnum=x.BindingTypeEnum=x.BindingScopeEnum=x.Container=x.METADATA_KEY=void 0;var qM=Ce();x.METADATA_KEY=qM;var jM=Lv();Object.defineProperty(x,"Container",{enumerable:!0,get:function(){return jM.Container}});var Yf=_n();Object.defineProperty(x,"BindingScopeEnum",{enumerable:!0,get:function(){return Yf.BindingScopeEnum}});Object.defineProperty(x,"BindingTypeEnum",{enumerable:!0,get:function(){return Yf.BindingTypeEnum}});Object.defineProperty(x,"TargetTypeEnum",{enumerable:!0,get:function(){return Yf.TargetTypeEnum}});var Qv=Fv();Object.defineProperty(x,"AsyncContainerModule",{enumerable:!0,get:function(){return Qv.AsyncContainerModule}});Object.defineProperty(x,"ContainerModule",{enumerable:!0,get:function(){return Qv.ContainerModule}});var NM=Vv();Object.defineProperty(x,"injectable",{enumerable:!0,get:function(){return NM.injectable}});var LM=Hv();Object.defineProperty(x,"tagged",{enumerable:!0,get:function(){return LM.tagged}});var BM=Yv();Object.defineProperty(x,"named",{enumerable:!0,get:function(){return BM.named}});var eb=Of();Object.defineProperty(x,"inject",{enumerable:!0,get:function(){return eb.inject}});Object.defineProperty(x,"LazyServiceIdentifer",{enumerable:!0,get:function(){return eb.LazyServiceIdentifer}});var FM=Uv();Object.defineProperty(x,"optional",{enumerable:!0,get:function(){return FM.optional}});var VM=Gv();Object.defineProperty(x,"unmanaged",{enumerable:!0,get:function(){return VM.unmanaged}});var KM=$v();Object.defineProperty(x,"multiInject",{enumerable:!0,get:function(){return KM.multiInject}});var HM=Xv();Object.defineProperty(x,"targetName",{enumerable:!0,get:function(){return HM.targetName}});var zM=Jv();Object.defineProperty(x,"postConstruct",{enumerable:!0,get:function(){return zM.postConstruct}});var YM=Rf();Object.defineProperty(x,"MetadataReader",{enumerable:!0,get:function(){return YM.MetadataReader}});var kM=li();Object.defineProperty(x,"id",{enumerable:!0,get:function(){return kM.id}});var UM=zn();Object.defineProperty(x,"decorate",{enumerable:!0,get:function(){return UM.decorate}});var Yc=Lf();Object.defineProperty(x,"traverseAncerstors",{enumerable:!0,get:function(){return Yc.traverseAncerstors}});Object.defineProperty(x,"taggedConstraint",{enumerable:!0,get:function(){return Yc.taggedConstraint}});Object.defineProperty(x,"namedConstraint",{enumerable:!0,get:function(){return Yc.namedConstraint}});Object.defineProperty(x,"typeConstraint",{enumerable:!0,get:function(){return Yc.typeConstraint}});var GM=Kr();Object.defineProperty(x,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return GM.getServiceIdentifierAsString}});var WM=Zv();Object.defineProperty(x,"multiBindToService",{enumerable:!0,get:function(){return WM.multiBindToService}})});var Uc=f(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.Deferred=void 0;var kf=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};kc.Deferred=kf});var P=f(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.TYPES=void 0;Gc.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandler:Symbol("IButtonHandler"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),IToolManager:Symbol("IToolManager"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}});var En=f(Kt=>{"use strict";var Wc=Kt&&Kt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Kt,"__esModule",{value:!0});Kt.MultiInstanceRegistry=Kt.InstanceRegistry=Kt.FactoryRegistry=Kt.ProviderRegistry=void 0;var $c=_(),Uf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?new n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};Uf=Wc([(0,$c.injectable)()],Uf);Kt.ProviderRegistry=Uf;var Gf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};Gf=Wc([(0,$c.injectable)()],Gf);Kt.FactoryRegistry=Gf;var Wf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e){let t=this.elements.get(e);return t||this.missing(e)}missing(e){throw new Error("Unknown registry key: "+e)}};Wf=Wc([(0,$c.injectable)()],Wf);Kt.InstanceRegistry=Wf;var $f=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");let n=this.elements.get(e);n!==void 0?n.push(t):this.elements.set(e,[t])}deregisterAll(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}get(e){let t=this.elements.get(e);return t!==void 0?t:[]}};$f=Wc([(0,$c.injectable)()],$f);Kt.MultiInstanceRegistry=$f});var Q=f(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.almostEquals=de.toRadians=de.toDegrees=de.Bounds=de.isBounds=de.Dimension=de.centerOfLine=de.angleBetweenPoints=de.angleOfPoint=de.Point=void 0;var $M=yn(),XM;(function(i){i.ORIGIN=Object.freeze({x:0,y:0});function e(l,S){return{x:l.x+S.x,y:l.y+S.y}}i.add=e;function t(l,S){return{x:l.x-S.x,y:l.y-S.y}}i.subtract=t;function n(l,S){return l.x===S.x&&l.y===S.y}i.equals=n;function r(l,S,R){let v=t(S,l),m=o(v),O={x:m.x*R,y:m.y*R};return e(l,O)}i.shiftTowards=r;function o(l){let S=s(l);return S===0||S===1?i.ORIGIN:{x:l.x/S,y:l.y/S}}i.normalize=o;function s(l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))}i.magnitude=s;function a(l,S,R){return{x:(1-R)*l.x+R*S.x,y:(1-R)*l.y+R*S.y}}i.linear=a;function c(l,S){let R=S.x-l.x,v=S.y-l.y;return Math.sqrt(R*R+v*v)}i.euclideanDistance=c;function u(l,S){return Math.abs(S.x-l.x)+Math.abs(S.y-l.y)}i.manhattanDistance=u;function d(l,S){return Math.max(Math.abs(S.x-l.x),Math.abs(S.y-l.y))}i.maxDistance=d})(XM=de.Point||(de.Point={}));function JM(i){return Math.atan2(i.y,i.x)}de.angleOfPoint=JM;function ZM(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}de.angleBetweenPoints=ZM;function QM(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return tb.center(t)}de.centerOfLine=QM;var Xc;(function(i){i.EMPTY=Object.freeze({width:-1,height:-1});function e(t){return t.width>=0&&t.height>=0}i.isValid=e})(Xc=de.Dimension||(de.Dimension={}));function eO(i){return(0,$M.hasOwnProperty)(i,["x","y","width","height"])}de.isBounds=eO;var tb;(function(i){i.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function e(o,s){if(!Xc.isValid(o))return Xc.isValid(s)?s:i.EMPTY;if(!Xc.isValid(s))return o;let a=Math.min(o.x,s.x),c=Math.min(o.y,s.y),u=Math.max(o.x+(o.width>=0?o.width:0),s.x+(s.width>=0?s.width:0)),d=Math.max(o.y+(o.height>=0?o.height:0),s.y+(s.height>=0?s.height:0));return{x:a,y:c,width:u-a,height:d-c}}i.combine=e;function t(o,s){return{x:o.x+s.x,y:o.y+s.y,width:o.width,height:o.height}}i.translate=t;function n(o){return{x:o.x+(o.width>=0?.5*o.width:0),y:o.y+(o.height>=0?.5*o.height:0)}}i.center=n;function r(o,s){return s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height}i.includes=r})(tb=de.Bounds||(de.Bounds={}));function tO(i){return i*180/Math.PI}de.toDegrees=tO;function nO(i){return i*Math.PI/180}de.toRadians=nO;function iO(i,e){return Math.abs(i-e)<.001}de.almostEquals=iO});var er=f(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.mapIterable=ot.filterIterable=ot.DONE_RESULT=ot.toArray=ot.FluentIterableImpl=void 0;var Os=class{constructor(e,t){this.startFn=e,this.nextFn=t}[Symbol.iterator](){let e={state:this.startFn(),next:()=>this.nextFn(e.state),[Symbol.iterator]:()=>e};return e}filter(e){return nb(this,e)}map(e){return ib(this,e)}forEach(e){let t=this[Symbol.iterator](),n=0,r;do r=t.next(),r.value!==void 0&&e(r.value,n),n++;while(!r.done)}indexOf(e){let t=this[Symbol.iterator](),n=0,r;do{if(r=t.next(),r.value===e)return n;n++}while(!r.done);return-1}};ot.FluentIterableImpl=Os;function rO(i){if(i.constructor===Array)return i;let e=[];return i.forEach(t=>e.push(t)),e}ot.toArray=rO;ot.DONE_RESULT=Object.freeze({done:!0,value:void 0});function nb(i,e){return new Os(()=>rb(i),t=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n})}ot.filterIterable=nb;function ib(i,e){return new Os(()=>rb(i),t=>{let{done:n,value:r}=t.next();return n?ot.DONE_RESULT:{done:!1,value:e(r)}})}ot.mapIterable=ib;function rb(i){let e=i[Symbol.iterator];if(typeof e=="function")return e.call(i);let t=i.length;return typeof t=="number"&&t>=0?new Xf(i):{next:()=>ot.DONE_RESULT}}var Xf=class{constructor(e){this.array=e,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:ot.DONE_RESULT}[Symbol.iterator](){return this}}});var G=f($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.ModelIndexImpl=$e.createRandomId=$e.SModelRoot=$e.SChildElement=$e.SParentElement=$e.isParent=$e.SModelElement=void 0;var Jf=Q(),oO=er(),Jc=class{get root(){let e=this;for(;e;){if(e instanceof Qc)return e;e instanceof Zc?e=e.parent:e=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(e){return this.features!==void 0&&this.features.has(e)}};$e.SModelElement=Jc;function sO(i){let e=i.children;return e!==void 0&&e.constructor===Array}$e.isParent=sO;var tr=class extends Jc{constructor(){super(...arguments),this.children=[]}add(e,t){let n=this.children;if(t===void 0)n.push(e);else{if(t<0||t>this.children.length)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(t,0,e)}e.parent=this,this.index.add(e)}remove(e){let t=this.children,n=t.indexOf(e);if(n<0)throw new Error(`No such child ${e.id}`);t.splice(n,1),this.index.remove(e)}removeAll(e){let t=this.children;if(e!==void 0){for(let n=t.length-1;n>=0;n--)if(e(t[n])){let r=t.splice(n,1)[0];this.index.remove(r)}}else t.forEach(n=>{this.index.remove(n)}),t.splice(0,t.length)}move(e,t){let n=this.children,r=n.indexOf(e);if(r===-1)throw new Error(`No such child ${e.id}`);if(t<0||t>n.length-1)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(r,1),n.splice(t,0,e)}localToParent(e){return(0,Jf.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}parentToLocal(e){return(0,Jf.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}};$e.SParentElement=tr;var Zc=class extends tr{};$e.SChildElement=Zc;var Qc=class extends tr{constructor(e=new eu){super(),this.canvasBounds=Jf.Bounds.EMPTY,Object.defineProperty(this,"index",{value:e,writable:!1})}};$e.SModelRoot=Qc;var ob="0123456789abcdefghijklmnopqrstuvwxyz";function sb(i=8){let e="";for(let t=0;t<i;t++)e+=ob.charAt(Math.floor(Math.random()*ob.length));return e}$e.createRandomId=sb;var eu=class{constructor(){this.id2element=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else do e.id=sb();while(this.contains(e));if(this.id2element.set(e.id,e),e instanceof tr)for(let t of e.children)this.add(t)}remove(e){if(this.id2element.delete(e.id),e instanceof tr)for(let t of e.children)this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getAttachedElements(e){return[]}all(){return(0,oO.mapIterable)(this.id2element,([e,t])=>t)}};$e.ModelIndexImpl=eu});var wn=f(Xe=>{"use strict";var Zf=Xe&&Xe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cb=Xe&&Xe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ab=Xe&&Xe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.createFeatureSet=Xe.EMPTY_ROOT=Xe.SModelFactory=Xe.SModelRegistry=void 0;var Ts=_(),ub=P(),aO=En(),Ur=G(),tu=class extends aO.FactoryRegistry{constructor(e){super(),e.forEach(t=>{let n=this.getDefaultFeatures(t.constr);if(!n&&t.features&&t.features.enable&&(n=[]),n){let r=db(n,t.features);this.register(t.type,()=>{let o=new t.constr;return o.features=r,o})}else this.register(t.type,()=>new t.constr)})}getDefaultFeatures(e){let t=e;do{let n=t.DEFAULT_FEATURES;if(n)return n;t=Object.getPrototypeOf(t)}while(t)}};tu=Zf([(0,Ts.injectable)(),ab(0,(0,Ts.multiInject)(ub.TYPES.SModelElementRegistration)),ab(0,(0,Ts.optional)()),cb("design:paramtypes",[Array])],tu);Xe.SModelRegistry=tu;var nu=class{createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Ur.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else n=new Ur.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Ur.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else t=new Ur.SModelRoot;return this.initializeRoot(t,e)}createSchema(e){let t={};for(let n in e)if(!this.isReserved(e,n)){let r=e[n];typeof r!="function"&&(t[n]=r)}return e instanceof Ur.SParentElement&&(t.children=e.children.map(n=>this.createSchema(n))),t}initializeElement(e,t){for(let n in t)if(!this.isReserved(e,n)){let r=t[n];typeof r!="function"&&(e[n]=r)}return e}isReserved(e,t){if(["children","parent","index"].indexOf(t)>=0)return!0;let n=e;do{let r=Object.getOwnPropertyDescriptor(n,t);if(r!==void 0)return r.get!==void 0;n=Object.getPrototypeOf(n)}while(n);return!1}initializeParent(e,t){return this.initializeElement(e,t),(0,Ur.isParent)(t)&&(e.children=t.children.map(n=>this.createElement(n,e))),e}initializeChild(e,t,n){return this.initializeParent(e,t),n!==void 0&&(e.parent=n),e}initializeRoot(e,t){return this.initializeParent(e,t),e.index.add(e),e}};Zf([(0,Ts.inject)(ub.TYPES.SModelRegistry),cb("design:type",tu)],nu.prototype,"registry",void 0);nu=Zf([(0,Ts.injectable)()],nu);Xe.SModelFactory=nu;Xe.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function db(i,e){let t=new Set(i);if(e&&e.enable)for(let n of e.enable)t.add(n);if(e&&e.disable)for(let n of e.disable)t.delete(n);return t}Xe.createFeatureSet=db});var Wr=f(Gr=>{"use strict";var cO=Gr&&Gr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.AnimationFrameSyncer=void 0;var uO=_(),Qf=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(e){this.tasks.push(e),this.trigger()}onEndOfNextFrame(e){this.endTasks.push(e),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(e=>this.run(e)):setTimeout(e=>this.run(e)))}run(e){let t=this.tasks,n=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],t.forEach(r=>r.call(void 0,e)),n.forEach(r=>r.call(void 0,e))}};Qf=cO([(0,uO.injectable)()],Qf);Gr.AnimationFrameSyncer=Qf});var iu=f(gi=>{"use strict";var $r=gi&&gi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},As=gi&&gi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(gi,"__esModule",{value:!0});gi.ActionDispatcher=void 0;var Xr=_(),nr=te(),dO=Uc(),Cs=P(),lO=wn(),fO=Wr(),pi=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(e=>{this.actionHandlerRegistry=e,this.handleAction(nr.SetModelAction.create(lO.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(e){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(e,this.blockUntil);if(this.diagramLocker.isAllowed(e))return this.handleAction(e)})}dispatchAll(e){return Promise.all(e.map(t=>this.dispatch(t)))}request(e){if(!e.requestId)return Promise.reject(new Error("Request without requestId"));let t=new dO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(()=>{}),t.promise}handleAction(e){if(e.kind===nr.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(e.kind===nr.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,nr.isResponseAction)(e)){let r=this.requests.get(e.responseId);if(r!==void 0){if(this.requests.delete(e.responseId),e.kind===nr.RejectAction.KIND){let o=e;r.reject(new Error(o.message)),this.logger.warn(this,`Request with id ${e.responseId} failed.`,o.message,o.detail)}else r.resolve(e);return Promise.resolve()}this.logger.log(this,"No matching request for response",e)}let t=this.actionHandlerRegistry.get(e.kind);if(t.length===0){this.logger.warn(this,"Missing handler for action",e);let r=new Error(`Missing handler for action '${e.kind}'`);if((0,nr.isRequestAction)(e)){let o=this.requests.get(e.requestId);o!==void 0&&(this.requests.delete(e.requestId),o.reject(r))}return Promise.reject(r)}this.logger.log(this,"Handle",e);let n=[];for(let r of t){let o=r.handle(e);(0,nr.isAction)(o)?n.push(this.dispatch(o)):o!==void 0&&(n.push(this.commandStack.execute(o)),this.blockUntil=o.blockUntil)}return Promise.all(n)}handleBlocked(e,t){if(t(e)){this.blockUntil=void 0;let n=this.handleAction(e),r=this.postponedActions;this.postponedActions=[];for(let o of r)this.dispatch(o.action).then(o.resolve,o.reject);return n}else return this.logger.log(this,"Action is postponed due to block condition",e),new Promise((n,r)=>{this.postponedActions.push({action:e,resolve:n,reject:r})})}};$r([(0,Xr.inject)(Cs.TYPES.ActionHandlerRegistryProvider),As("design:type",Function)],pi.prototype,"actionHandlerRegistryProvider",void 0);$r([(0,Xr.inject)(Cs.TYPES.ICommandStack),As("design:type",Object)],pi.prototype,"commandStack",void 0);$r([(0,Xr.inject)(Cs.TYPES.ILogger),As("design:type",Object)],pi.prototype,"logger",void 0);$r([(0,Xr.inject)(Cs.TYPES.AnimationFrameSyncer),As("design:type",fO.AnimationFrameSyncer)],pi.prototype,"syncer",void 0);$r([(0,Xr.inject)(Cs.TYPES.IDiagramLocker),As("design:type",Object)],pi.prototype,"diagramLocker",void 0);pi=$r([(0,Xr.injectable)()],pi);gi.ActionDispatcher=pi});var ir=f(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.isInjectable=void 0;function hO(i){return Reflect.getMetadata("inversify:paramtypes",i)!==void 0}ru.isInjectable=hO});var Ds=f(ht=>{"use strict";var pO=ht&&ht.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gO=ht&&ht.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ou=ht&&ht.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ht,"__esModule",{value:!0});ht.onAction=ht.configureActionHandler=ht.ActionHandlerRegistry=void 0;var xs=_(),su=P(),mO=En(),yO=ir(),eh=class extends mO.MultiInstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.actionKind,n.factory())),t.forEach(n=>this.initializeActionHandler(n))}initializeActionHandler(e){e.initialize(this)}};eh=pO([(0,xs.injectable)(),ou(0,(0,xs.multiInject)(su.TYPES.ActionHandlerRegistration)),ou(0,(0,xs.optional)()),ou(1,(0,xs.multiInject)(su.TYPES.IActionHandlerInitializer)),ou(1,(0,xs.optional)()),gO("design:paramtypes",[Array,Array])],eh);ht.ActionHandlerRegistry=eh;function _O(i,e,t){if(typeof t=="function"){if(!(0,yO.isInjectable)(t))throw new Error(`Action handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(su.TYPES.ActionHandlerRegistration).toDynamicValue(n=>({actionKind:e,factory:()=>n.container.get(t)}))}ht.configureActionHandler=_O;function vO(i,e,t){i.bind(su.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:e,factory:()=>({handle:t})})}ht.onAction=vO});var nh=f(Jr=>{"use strict";var bO=Jr&&Jr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.DefaultDiagramLocker=void 0;var SO=_(),th=class{isAllowed(e){return!0}};th=bO([(0,SO.injectable)()],th);Jr.DefaultDiagramLocker=th});var ih=f(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.easeInOut=void 0;function EO(i){return i<.5?i*i*2:1-(1-i)*(1-i)*2}au.easeInOut=EO});var rr=f(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.CompoundAnimation=Zr.Animation=void 0;var lb=ih(),cu=class{constructor(e,t=lb.easeInOut){this.context=e,this.ease=t}start(){return new Promise((e,t)=>{let n,r=0,o=s=>{r++;let a;n===void 0?(n=s,a=0):a=s-n;let c=Math.min(1,a/this.context.duration),u=this.tween(this.ease(c),this.context);this.context.modelChanged.update(u),c===1?(this.context.logger.log(this,r*1e3/this.context.duration+" fps"),e(u)):this.context.syncer.onNextFrame(o)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(o);else{let s=this.tween(1,this.context);e(s)}})}};Zr.Animation=cu;var rh=class extends cu{constructor(e,t,n=[],r=lb.easeInOut){super(t,r),this.model=e,this.context=t,this.components=n,this.ease=r}include(e){return this.components.push(e),this}tween(e,t){for(let n of this.components)n.tween(e,t);return this.model}};Zr.CompoundAnimation=rh});var pe=f(Je=>{"use strict";var Qr=Je&&Je.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Je,"__esModule",{value:!0});Je.ResetCommand=Je.SystemCommand=Je.PopupCommand=Je.HiddenCommand=Je.MergeableCommand=Je.Command=void 0;var eo=_(),mi=class{};mi=Qr([(0,eo.injectable)()],mi);Je.Command=mi;var oh=class extends mi{merge(e,t){return!1}};oh=Qr([(0,eo.injectable)()],oh);Je.MergeableCommand=oh;var sh=class extends mi{undo(e){return e.logger.error(this,"Cannot undo a hidden command"),e.root}redo(e){return e.logger.error(this,"Cannot redo a hidden command"),e.root}};sh=Qr([(0,eo.injectable)()],sh);Je.HiddenCommand=sh;var ah=class extends mi{};ah=Qr([(0,eo.injectable)()],ah);Je.PopupCommand=ah;var ch=class extends mi{};ch=Qr([(0,eo.injectable)()],ch);Je.SystemCommand=ch;var uh=class extends mi{};uh=Qr([(0,eo.injectable)()],uh);Je.ResetCommand=uh});var gt=f(pt=>{"use strict";var wO=pt&&pt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},PO=pt&&pt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},fb=pt&&pt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(pt,"__esModule",{value:!0});pt.configureCommand=pt.CommandActionHandlerInitializer=pt.CommandActionHandler=void 0;var uu=_(),IO=ir(),dh=P(),du=class{constructor(e){this.commandRegistration=e}handle(e){return this.commandRegistration.factory(e)}};pt.CommandActionHandler=du;var lh=class{constructor(e){this.registrations=e}initialize(e){this.registrations.forEach(t=>e.register(t.kind,new du(t)))}};lh=wO([(0,uu.injectable)(),fb(0,(0,uu.multiInject)(dh.TYPES.CommandRegistration)),fb(0,(0,uu.optional)()),PO("design:paramtypes",[Array])],lh);pt.CommandActionHandlerInitializer=lh;function RO(i,e){if(!(0,IO.isInjectable)(e))throw new Error(`Commands should be @injectable: ${e.name}`);i.isBound(e)||i.bind(e).toSelf(),i.bind(dh.TYPES.CommandRegistration).toDynamicValue(t=>({kind:e.KIND,factory:n=>{let r=new uu.Container;return r.parent=t.container,r.bind(dh.TYPES.Action).toConstantValue(n),r.get(e)}}))}pt.configureCommand=RO});var hb=f(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.overrideCommandStackOptions=void 0;var MO=yn(),OO=P();function TO(i,e){let t=i.get(OO.TYPES.CommandStackOptions);return(0,MO.safeAssign)(t,e),t}lu.overrideCommandStackOptions=TO});var hh=f(_i=>{"use strict";var sr=_i&&_i.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yi=_i&&_i.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(_i,"__esModule",{value:!0});_i.CommandStack=void 0;var ar=_(),qs=P(),fh=wn(),AO=G(),CO=Wr(),or=pe(),Gn=class{constructor(){this.undoStack=[],this.redoStack=[],this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(fh.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(fh.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(fh.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(e=>e.main.model)}executeAll(e){return e.forEach(t=>{this.logger.log(this,"Executing",t),this.handleCommand(t,t.execute,this.mergeOrPush)}),this.thenUpdate()}execute(e){return this.logger.log(this,"Executing",e),this.handleCommand(e,e.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();let e=this.undoStack[this.undoStack.length-1];return e!==void 0&&!this.isBlockUndo(e)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();let e=this.redoStack.pop();return e!==void 0&&(this.logger.log(this,"Redoing",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(e,t,n){this.currentPromise=this.currentPromise.then(r=>new Promise(o=>{let s;e instanceof or.HiddenCommand?s="hidden":e instanceof or.PopupCommand?s="popup":s="main";let a=this.createContext(r.main.model),c;try{c=t.call(e,a)}catch(d){this.logger.error(this,"Failed to execute command:",d),c=r[s].model}let u=pb(r);c instanceof Promise?c.then(d=>{s==="main"&&n.call(this,e,a),u[s]={model:d,modelChanged:!0},o(u)}):c instanceof AO.SModelRoot?(s==="main"&&n.call(this,e,a),u[s]={model:c,modelChanged:!0},o(u)):(s==="main"&&n.call(this,e,a),u[s]={model:c.model,modelChanged:r[s].modelChanged||c.modelChanged,cause:c.cause},o(u))}))}pushToUndoStack(e){this.undoStack.push(e),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(e=>{let t=pb(e);return e.hidden.modelChanged&&(this.updateHidden(e.hidden.model,e.hidden.cause),t.hidden.modelChanged=!1,t.hidden.cause=void 0),e.main.modelChanged&&(this.update(e.main.model,e.main.cause),t.main.modelChanged=!1,t.main.cause=void 0),e.popup.modelChanged&&(this.updatePopup(e.popup.model,e.popup.cause),t.popup.modelChanged=!1,t.popup.cause=void 0),t}),this.currentModel}update(e,t){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(e,t)}updateHidden(e,t){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(e,t)}updatePopup(e,t){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(e,t)}mergeOrPush(e,t){if(this.isBlockUndo(e)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(e);return}if(this.isPushToOffStack(e)&&this.redoStack.length>0){if(this.offStack.length>0){let n=this.offStack[this.offStack.length-1];if(n instanceof or.MergeableCommand&&n.merge(e,t))return}this.offStack.push(e);return}if(this.isPushToUndoStack(e)){if(this.offStack.forEach(n=>this.undoStack.push(n)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){let n=this.undoStack[this.undoStack.length-1];if(n instanceof or.MergeableCommand&&n.merge(e,t))return}this.pushToUndoStack(e)}}undoOffStackSystemCommands(){let e=this.offStack.pop();for(;e!==void 0;)this.logger.log(this,"Undoing off-stack",e),this.handleCommand(e,e.undo,()=>{}),e=this.offStack.pop()}undoPreceedingSystemCommands(){let e=this.undoStack[this.undoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)}),e=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let e=this.redoStack[this.redoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.redoStack.pop(),this.logger.log(this,"Redoing ",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)}),e=this.redoStack[this.redoStack.length-1]}createContext(e){return{root:e,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(e){return e instanceof or.SystemCommand}isPushToUndoStack(e){return!(e instanceof or.HiddenCommand)}isBlockUndo(e){return e instanceof or.ResetCommand}};sr([(0,ar.inject)(qs.TYPES.IModelFactory),yi("design:type",Object)],Gn.prototype,"modelFactory",void 0);sr([(0,ar.inject)(qs.TYPES.IViewerProvider),yi("design:type",Object)],Gn.prototype,"viewerProvider",void 0);sr([(0,ar.inject)(qs.TYPES.ILogger),yi("design:type",Object)],Gn.prototype,"logger",void 0);sr([(0,ar.inject)(qs.TYPES.AnimationFrameSyncer),yi("design:type",CO.AnimationFrameSyncer)],Gn.prototype,"syncer",void 0);sr([(0,ar.inject)(qs.TYPES.CommandStackOptions),yi("design:type",Object)],Gn.prototype,"options",void 0);sr([(0,ar.postConstruct)(),yi("design:type",Function),yi("design:paramtypes",[]),yi("design:returntype",void 0)],Gn.prototype,"initialize",null);Gn=sr([(0,ar.injectable)()],Gn);_i.CommandStack=Gn;function pb(i){return{main:Object.assign({},i.main),hidden:Object.assign({},i.hidden),popup:Object.assign({},i.popup)}}});var gb=f(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});fu.ServerActionHandlerRegistry=void 0;var ph=class{constructor(){this.handlers=new Map}getHandler(e){return this.handlers.get(e)}onAction(e,t){this.handlers.has(e)?this.handlers.get(e).push(t):this.handlers.set(e,[t])}removeActionHandler(e,t){let n=this.handlers.get(e);if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}};fu.ServerActionHandlerRegistry=ph});var vi=f(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.SModelIndex=mt.findElement=mt.getSubType=mt.getBasicType=mt.applyBounds=mt.cloneModel=void 0;function xO(i){return JSON.parse(JSON.stringify(i))}mt.cloneModel=xO;function DO(i,e){let t=new hu;t.add(i);for(let n of e.bounds){let r=t.getById(n.elementId);if(r){let o=r;n.newPosition&&(o.position={x:n.newPosition.x,y:n.newPosition.y}),n.newSize&&(o.size={width:n.newSize.width,height:n.newSize.height})}}if(e.alignments)for(let n of e.alignments){let r=t.getById(n.elementId);if(r){let o=r;o.alignment={x:n.newAlignment.x,y:n.newAlignment.y}}}}mt.applyBounds=DO;function qO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}mt.getBasicType=qO;function jO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}mt.getSubType=jO;function mb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=mb(t,e);if(n!==void 0)return n}}mt.findElement=mb;var hu=class{constructor(){this.id2element=new Map,this.id2parent=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(e.id,e),Array.isArray(e.children))for(let t of e.children)this.add(t),this.id2parent.set(t.id,e)}remove(e){if(this.id2element.delete(e.id),Array.isArray(e.children))for(let t of e.children)this.id2parent.delete(t.id),this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getParent(e){return this.id2parent.get(e)}getRoot(e){let t=e;for(;t;){let n=this.id2parent.get(t.id);if(n===void 0)return t;t=n}throw new Error("Element has no root")}};mt.SModelIndex=hu});var yb=f(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.DiagramServer=void 0;var NO=gb(),yt=te(),LO=Uc(),gh=vi(),mh=class{constructor(e,t){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=e,this.diagramGenerator=t.DiagramGenerator,this.layoutEngine=t.ModelLayoutEngine,this.actionHandlerRegistry=t.ServerActionHandlerRegistry}onAction(e,t){this.actionHandlerRegistry||(this.actionHandlerRegistry=new NO.ServerActionHandlerRegistry),this.actionHandlerRegistry.onAction(e,t)}removeActionHandler(e,t){this.actionHandlerRegistry&&this.actionHandlerRegistry.removeActionHandler(e,t)}setModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!1)}updateModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(e){if((0,yt.isResponseAction)(e)){let t=e.responseId,n=this.requests.get(t);if(n){if(this.requests.delete(t),e.kind===yt.RejectAction.KIND){let r=e;n.reject(new Error(r.message)),console.warn(`Request with id ${e.responseId} failed: ${r.message}`,r.detail)}else n.resolve(e);return Promise.resolve()}console.info("No matching request for response:",e)}return this.handleAction(e)}request(e){e.requestId||(e.requestId="server_"+(0,yt.generateRequestId)());let t=new LO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(n=>{this.requests.delete(e.requestId),t.reject(n)}),t.promise}rejectRemoteRequest(e,t){e&&(0,yt.isRequestAction)(e)&&this.dispatch({kind:yt.RejectAction.KIND,responseId:e.requestId,message:t.message,detail:t.stack})}handleAction(e){var t;let n=(t=this.actionHandlerRegistry)===null||t===void 0?void 0:t.getHandler(e.kind);if(n&&n.length===1)return n[0](e,this.state,this);if(n&&n.length>1)return Promise.all(n.map(r=>r(e,this.state,this)));switch(e.kind){case yt.RequestModelAction.KIND:return this.handleRequestModel(e);case yt.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case yt.LayoutAction.KIND:return this.handleLayout(e)}return console.warn(`Unhandled action from client: ${e.kind}`),Promise.resolve()}async handleRequestModel(e){var t;this.state.options=e.options;try{let n=await this.diagramGenerator.generate({options:(t=this.state.options)!==null&&t!==void 0?t:{},state:this.state});n.revision=++this.state.revision,this.state.currentRoot=n,await this.submitModel(this.state.currentRoot,!1,e)}catch(n){this.rejectRemoteRequest(e,n),console.error("Failed to generate diagram:",n)}}async submitModel(e,t,n){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:yt.RequestBoundsAction.KIND,newRoot:e});else{let r=yt.RequestBoundsAction.create(e),o=await this.request(r),s=this.state.currentRoot;o.revision===s.revision?((0,gh.applyBounds)(s,o),await this.doSubmitModel(s,t,n)):this.rejectRemoteRequest(n,new Error(`Model revision does not match: ${o.revision}`))}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n){if(e.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(e=await this.layoutEngine.layout(e));let r=e.type;if(n&&n.kind===yt.RequestModelAction.KIND){let o=n.requestId,s=yt.SetModelAction.create(e,o);await this.dispatch(s)}else t&&r===this.state.lastSubmittedModelType?await this.dispatch({kind:yt.UpdateModelAction.KIND,newRoot:e,cause:n}):await this.dispatch({kind:yt.SetModelAction.KIND,newRoot:e});this.state.lastSubmittedModelType=r}handleComputedBounds(e){return e.revision!==this.state.currentRoot.revision?Promise.reject():((0,gh.applyBounds)(this.state.currentRoot,e),Promise.resolve())}async handleLayout(e){if(this.layoutEngine){if(!this.needsServerLayout){let t=(0,gh.cloneModel)(this.state.currentRoot);t=await this.layoutEngine.layout(t),t.revision=++this.state.revision,this.state.currentRoot=t}await this.doSubmitModel(this.state.currentRoot,!0,e)}}};pu.DiagramServer=mh});var vb=f(_b=>{"use strict";Object.defineProperty(_b,"__esModule",{value:!0})});var Sb=f(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.isZoomable=to.isScrollable=void 0;var bb=yn();function BO(i){return(0,bb.hasOwnProperty)(i,"scroll")}to.isScrollable=BO;function FO(i){return(0,bb.hasOwnProperty)(i,"zoom")}to.isZoomable=FO});var wb=f(Eb=>{"use strict";Object.defineProperty(Eb,"__esModule",{value:!0})});var cr=f(st=>{"use strict";var VO=st&&st.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Wn=st&&st.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&VO(e,i,t)};Object.defineProperty(st,"__esModule",{value:!0});Wn(te(),st);Wn(yb(),st);Wn(vb(),st);Wn(Sb(),st);Wn(Uc(),st);Wn(Q(),st);Wn(wb(),st);Wn(vi(),st);Wn(yn(),st)});var Pn=f(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.hitsMouseEvent=Ht.getWindowScroll=Ht.isCrossSite=Ht.isMac=Ht.isCtrlOrCmd=void 0;var KO=cr();function HO(i){return Pb()?i.metaKey:i.ctrlKey}Ht.isCtrlOrCmd=HO;function Pb(){return window.navigator.userAgent.indexOf("Mac")!==-1}Ht.isMac=Pb;function zO(i){if(i&&typeof window<"u"&&window.location){let e="";return window.location.protocol&&(e+=window.location.protocol+"//"),window.location.host&&(e+=window.location.host),e.length>0&&!i.startsWith(e)}return!1}Ht.isCrossSite=zO;function YO(){return typeof window>"u"?KO.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}Ht.getWindowScroll=YO;function kO(i,e){let t=i.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}Ht.hitsMouseEvent=kO});var Ns=f(at=>{"use strict";var yh=at&&at.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ib=at&&at.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},UO=at&&at.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(at,"__esModule",{value:!0});at.InitializeCanvasBoundsCommand=at.InitializeCanvasBoundsAction=at.CanvasBoundsInitializer=void 0;var gu=_(),js=Q(),Rb=P(),GO=G(),WO=pe(),$O=Pn(),mu=class{decorate(e,t){return t instanceof GO.SModelRoot&&!js.Dimension.isValid(t.canvasBounds)&&(this.rootAndVnode=[t,e]),e}postUpdate(){if(this.rootAndVnode!==void 0){let e=this.rootAndVnode[1].elm,t=this.rootAndVnode[0].canvasBounds;if(e!==void 0){let n=this.getBoundsInPage(e);(0,js.almostEquals)(n.x,t.x)&&(0,js.almostEquals)(n.y,t.y)&&(0,js.almostEquals)(n.width,t.width)&&(0,js.almostEquals)(n.height,t.width)||this.actionDispatcher.dispatch(_h.create(n))}this.rootAndVnode=void 0}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,$O.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};yh([(0,gu.inject)(Rb.TYPES.IActionDispatcher),Ib("design:type",Object)],mu.prototype,"actionDispatcher",void 0);mu=yh([(0,gu.injectable)()],mu);at.CanvasBoundsInitializer=mu;var _h;(function(i){i.KIND="initializeCanvasBounds";function e(t){return{kind:i.KIND,newCanvasBounds:t}}i.create=e})(_h=at.InitializeCanvasBoundsAction||(at.InitializeCanvasBoundsAction={}));var yu=class extends WO.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newCanvasBounds=this.action.newCanvasBounds,e.root.canvasBounds=this.newCanvasBounds,e.root}undo(e){return e.root}redo(e){return e.root}};yu.KIND=_h.KIND;yu=yh([(0,gu.injectable)(),UO(0,(0,gu.inject)(Rb.TYPES.Action)),Ib("design:paramtypes",[Object])],yu);at.InitializeCanvasBoundsCommand=yu});var vu=f(_t=>{"use strict";var XO=_t&&_t.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},JO=_t&&_t.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ZO=_t&&_t.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(_t,"__esModule",{value:!0});_t.SetModelCommand=_t.SetModelAction=_t.RequestModelAction=void 0;var Mb=_(),Ob=te(),QO=pe(),eT=P(),tT=Ns(),ur=class{constructor(e,t=""){this.options=e,this.requestId=t,this.kind=ur.KIND}static create(e){return new ur(e,(0,Ob.generateRequestId)())}};_t.RequestModelAction=ur;ur.KIND="requestModel";var no=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=no.KIND}};_t.SetModelAction=no;no.KIND="setModel";var _u=class extends QO.ResetCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.modelFactory.createRoot(e.root),this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}get blockUntil(){return e=>e.kind===tT.InitializeCanvasBoundsCommand.KIND}};_u.KIND=Ob.SetModelAction.KIND;_u=XO([(0,Mb.injectable)(),ZO(0,(0,Mb.inject)(eT.TYPES.Action)),JO("design:paramtypes",[Object])],_u);_t.SetModelCommand=_u});var Ab=f(Tb=>{"use strict";Object.defineProperty(Tb,"__esModule",{value:!0})});var Ke=f(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.transformToRootBounds=ve.containsSome=ve.translateBounds=ve.translatePoint=ve.findParentByFeature=ve.findParent=ve.findElement=ve.getSubType=ve.getBasicType=ve.registerModelElement=void 0;var nT=P(),Ls=G();function iT(i,e,t,n){i.bind(nT.TYPES.SModelElementRegistration).toConstantValue({type:e,constr:t,features:n})}ve.registerModelElement=iT;function rT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}ve.getBasicType=rT;function oT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}ve.getSubType=oT;function Cb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Cb(t,e);if(n!==void 0)return n}}ve.findElement=Cb;function sT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ls.SChildElement?t=t.parent:t=void 0}return t}ve.findParent=sT;function aT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ls.SChildElement?t=t.parent:t=void 0}return t}ve.findParentByFeature=aT;function vh(i,e,t){if(e!==t){for(;e instanceof Ls.SChildElement;)if(i=e.localToParent(i),e=e.parent,e===t)return i;let n=[];for(;t instanceof Ls.SChildElement;)n.push(t),t=t.parent;if(e!==t)throw new Error("Incompatible source and target: "+e.id+", "+t.id);for(let r=n.length-1;r>=0;r--)i=n[r].parentToLocal(i)}return i}ve.translatePoint=vh;function cT(i,e,t){let n=vh(i,e,t),r=vh({x:i.x+i.width,y:i.y+i.height},e,t);return{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y}}ve.translateBounds=cT;function uT(i,e){let t=r=>i.index.getById(r.id)!==void 0,n=r=>r.some(o=>t(o)||n(o.children));return n([e])}ve.containsSome=uT;function dT(i,e){for(;i instanceof Ls.SChildElement;)e=i.localToParent(e),i=i.parent;return e}ve.transformToRootBounds=dT});var bu=f(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.EnableDefaultToolsAction=bi.EnableToolsAction=void 0;var lT;(function(i){i.KIND="enable-tools";function e(t){return{kind:i.KIND,toolIds:t}}i.create=e})(lT=bi.EnableToolsAction||(bi.EnableToolsAction={}));var fT;(function(i){i.KIND="enable-default-tools";function e(){return{kind:i.KIND}}i.create=e})(fT=bi.EnableDefaultToolsAction||(bi.EnableDefaultToolsAction={}))});var Ne=f(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.getAttrs=je.on=je.mergeStyle=je.copyClassesFromElement=je.copyClassesFromVNode=je.setNamespace=je.setClass=je.setAttr=void 0;function hT(i,e,t){Db(i)[e]=t}je.setAttr=hT;function bh(i,e,t){qb(i)[e]=t}je.setClass=bh;function xb(i,e){i.data===void 0&&(i.data={}),i.data.ns=e;let t=i.children;if(t!==void 0)for(let n=0;n<t.length;n++){let r=t[n];typeof r!="string"&&xb(r,e)}}je.setNamespace=xb;function pT(i,e){let t=qb(i);Object.keys(t).forEach(n=>bh(e,n,!0))}je.copyClassesFromVNode=pT;function gT(i,e){let t=i.classList;for(let n=0;n<t.length;n++){let r=t.item(n);r&&bh(e,r,!0)}}je.copyClassesFromElement=gT;function mT(i,e){Bs(i).style=Object.assign(Object.assign({},Bs(i).style||{}),e)}je.mergeStyle=mT;function yT(i,e,t){let n=_T(i);if(n[e])throw new Error("EventListener for "+e+" already registered on VNode");n[e]=t}je.on=yT;function Db(i){let e=Bs(i);return e.attrs||(e.attrs={}),e.attrs}je.getAttrs=Db;function Bs(i){return i.data||(i.data={}),i.data}function qb(i){let e=Bs(i);return e.class||(e.class={}),e.class}function _T(i){let e=Bs(i);return e.on||(e.on={}),e.on}});var sn=f(zt=>{"use strict";var wh=zt&&zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nb=zt&&zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},jb=zt&&zt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(zt,"__esModule",{value:!0});zt.KeyListener=zt.KeyTool=void 0;var Fs=_(),Lb=P(),vT=G(),Sh=Ne(),Su=class{constructor(e=[]){this.keyListeners=e}register(e){this.keyListeners.push(e)}deregister(e){let t=this.keyListeners.indexOf(e);t>=0&&this.keyListeners.splice(t,1)}handleEvent(e,t,n){let r=this.keyListeners.map(o=>o[e].apply(o,[t,n])).reduce((o,s)=>o.concat(s));r.length>0&&(n.preventDefault(),this.actionDispatcher.dispatchAll(r))}keyDown(e,t){this.handleEvent("keyDown",e,t)}keyUp(e,t){this.handleEvent("keyUp",e,t)}focus(){}decorate(e,t){return t instanceof vT.SModelRoot&&((0,Sh.on)(e,"focus",this.focus.bind(this,t)),(0,Sh.on)(e,"keydown",this.keyDown.bind(this,t)),(0,Sh.on)(e,"keyup",this.keyUp.bind(this,t))),e}postUpdate(){}};wh([(0,Fs.inject)(Lb.TYPES.IActionDispatcher),Nb("design:type",Object)],Su.prototype,"actionDispatcher",void 0);Su=wh([(0,Fs.injectable)(),jb(0,(0,Fs.multiInject)(Lb.TYPES.KeyListener)),jb(0,(0,Fs.optional)()),Nb("design:paramtypes",[Array])],Su);zt.KeyTool=Su;var Eh=class{keyDown(e,t){return[]}keyUp(e,t){return[]}};Eh=wh([(0,Fs.injectable)()],Eh);zt.KeyListener=Eh});var In=f(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.getActualCode=io.matchesKeystroke=void 0;var bT=Pn();function ST(i,e,...t){if(Bb(i)!==e)return!1;if((0,bT.isMac)()){if(i.ctrlKey!==t.findIndex(n=>n==="ctrl")>=0||i.metaKey!==t.findIndex(n=>n==="meta"||n==="ctrlCmd")>=0)return!1}else if(i.ctrlKey!==t.findIndex(n=>n==="ctrl"||n==="ctrlCmd")>=0||i.metaKey!==t.findIndex(n=>n==="meta")>=0)return!1;return!(i.altKey!==t.findIndex(n=>n==="alt")>=0||i.shiftKey!==t.findIndex(n=>n==="shift")>=0)}io.matchesKeystroke=ST;function Bb(i){if(i.keyCode){let e=Ph[i.keyCode];if(e!==void 0)return e}return i.code}io.getActualCode=Bb;var Ph=new Array(256);(()=>{function i(e,t){Ph[t]===void 0&&(Ph[t]=e)}i("Pause",3),i("Backspace",8),i("Tab",9),i("Enter",13),i("ShiftLeft",16),i("ShiftRight",16),i("ControlLeft",17),i("ControlRight",17),i("AltLeft",18),i("AltRight",18),i("CapsLock",20),i("Escape",27),i("Space",32),i("PageUp",33),i("PageDown",34),i("End",35),i("Home",36),i("ArrowLeft",37),i("ArrowUp",38),i("ArrowRight",39),i("ArrowDown",40),i("Insert",45),i("Delete",46),i("Digit1",49),i("Digit2",50),i("Digit3",51),i("Digit4",52),i("Digit5",53),i("Digit6",54),i("Digit7",55),i("Digit8",56),i("Digit9",57),i("Digit0",48),i("KeyA",65),i("KeyB",66),i("KeyC",67),i("KeyD",68),i("KeyE",69),i("KeyF",70),i("KeyG",71),i("KeyH",72),i("KeyI",73),i("KeyJ",74),i("KeyK",75),i("KeyL",76),i("KeyM",77),i("KeyN",78),i("KeyO",79),i("KeyP",80),i("KeyQ",81),i("KeyR",82),i("KeyS",83),i("KeyT",84),i("KeyU",85),i("KeyV",86),i("KeyW",87),i("KeyX",88),i("KeyY",89),i("KeyZ",90),i("OSLeft",91),i("MetaLeft",91),i("OSRight",92),i("MetaRight",92),i("ContextMenu",93),i("Numpad0",96),i("Numpad1",97),i("Numpad2",98),i("Numpad3",99),i("Numpad4",100),i("Numpad5",101),i("Numpad6",102),i("Numpad7",103),i("Numpad8",104),i("Numpad9",105),i("NumpadMultiply",106),i("NumpadAdd",107),i("NumpadSeparator",108),i("NumpadSubtract",109),i("NumpadDecimal",110),i("NumpadDivide",111),i("F1",112),i("F2",113),i("F3",114),i("F4",115),i("F5",116),i("F6",117),i("F7",118),i("F8",119),i("F9",120),i("F10",121),i("F11",122),i("F12",123),i("F13",124),i("F14",125),i("F15",126),i("F16",127),i("F17",128),i("F18",129),i("F19",130),i("F20",131),i("F21",132),i("F22",133),i("F23",134),i("F24",135),i("NumLock",144),i("ScrollLock",145),i("Semicolon",186),i("Equal",187),i("Comma",188),i("Minus",189),i("Period",190),i("Slash",191),i("Backquote",192),i("IntlRo",193),i("BracketLeft",219),i("Backslash",220),i("BracketRight",221),i("Quote",222),i("IntlYen",255)})()});var Oh=f(Yt=>{"use strict";var wu=Yt&&Yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ET=Yt&&Yt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.DefaultToolsEnablingKeyListener=Yt.ToolManagerActionHandler=Yt.ToolManager=void 0;var Pu=_(),wT=P(),Ih=bu(),PT=sn(),IT=In(),Rh=class{constructor(){this.tools=[],this.defaultTools=[],this.actives=[]}get managedTools(){return this.defaultTools.concat(this.tools)}get activeTools(){return this.actives}disableActiveTools(){this.actives.forEach(e=>e.disable()),this.actives.splice(0,this.actives.length)}enableDefaultTools(){this.enable(this.defaultTools.map(e=>e.id))}enable(e){this.disableActiveTools(),e.map(n=>this.tool(n)).forEach(n=>{n!==void 0&&(n.enable(),this.actives.push(n))})}tool(e){return this.managedTools.find(t=>t.id===e)}registerDefaultTools(...e){for(let t of e)this.defaultTools.push(t)}registerTools(...e){for(let t of e)this.tools.push(t)}};Rh=wu([(0,Pu.injectable)()],Rh);Yt.ToolManager=Rh;var Eu=class{handle(e){switch(e.kind){case Ih.EnableDefaultToolsAction.KIND:this.toolManager.enableDefaultTools();break;case Ih.EnableToolsAction.KIND:this.toolManager.enable(e.toolIds);break}}};wu([(0,Pu.inject)(wT.TYPES.IToolManager),ET("design:type",Object)],Eu.prototype,"toolManager",void 0);Eu=wu([(0,Pu.injectable)()],Eu);Yt.ToolManagerActionHandler=Eu;var Mh=class extends PT.KeyListener{keyDown(e,t){return(0,IT.matchesKeystroke)(t,"Escape")?[Ih.EnableDefaultToolsAction.create()]:[]}};Mh=wu([(0,Pu.injectable)()],Mh);Yt.DefaultToolsEnablingKeyListener=Mh});var Ks=f(ct=>{"use strict";var Ah=ct&&ct.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ch=ct&&ct.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Th=ct&&ct.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ct,"__esModule",{value:!0});ct.SetUIExtensionVisibilityCommand=ct.SetUIExtensionVisibilityAction=ct.UIExtensionRegistry=void 0;var ro=_(),RT=En(),MT=pe(),xh=P(),Iu=class extends RT.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>this.register(t.id(),t))}};Iu=Ah([(0,ro.injectable)(),Th(0,(0,ro.multiInject)(xh.TYPES.IUIExtension)),Th(0,(0,ro.optional)()),Ch("design:paramtypes",[Array])],Iu);ct.UIExtensionRegistry=Iu;var Fb;(function(i){i.KIND="setUIExtensionVisibility";function e(t){var n;return{kind:i.KIND,extensionId:t.extensionId,visible:t.visible,contextElementsId:(n=t.contextElementsId)!==null&&n!==void 0?n:[]}}i.create=e})(Fb=ct.SetUIExtensionVisibilityAction||(ct.SetUIExtensionVisibilityAction={}));var Vs=class extends MT.SystemCommand{constructor(e){super(),this.action=e}execute(e){let t=this.registry.get(this.action.extensionId);return t&&(this.action.visible?t.show(e.root,...this.action.contextElementsId):t.hide()),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};Vs.KIND=Fb.KIND;Ah([(0,ro.inject)(xh.TYPES.UIExtensionRegistry),Ch("design:type",Iu)],Vs.prototype,"registry",void 0);Vs=Ah([(0,ro.injectable)(),Th(0,(0,ro.inject)(xh.TYPES.Action)),Ch("design:paramtypes",[Object])],Vs);ct.SetUIExtensionVisibilityCommand=Vs});var Ru=f(Si=>{"use strict";var Dh=Si&&Si.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Vb=Si&&Si.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Si,"__esModule",{value:!0});Si.AbstractUIExtension=void 0;var qh=_(),Kb=P(),Hs=class{show(e,...t){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,e,...t),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){let e=this.activeElement;e&&e.focus()}initialize(){let e=document.getElementById(this.options.baseDiv);return e?(this.containerElement=this.getOrCreateContainer(e.id),this.initializeContents(this.containerElement),e&&e.insertBefore(this.containerElement,e.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(e){let t=document.getElementById(this.id());return t===null&&(t=document.createElement("div"),t.id=e+"_"+this.id(),t.classList.add(this.containerClass())),t}setContainerVisible(e){this.containerElement&&(e?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(e,t,...n){}};Dh([(0,qh.inject)(Kb.TYPES.ViewerOptions),Vb("design:type",Object)],Hs.prototype,"options",void 0);Dh([(0,qh.inject)(Kb.TYPES.ILogger),Vb("design:type",Object)],Hs.prototype,"logger",void 0);Hs=Dh([(0,qh.injectable)()],Hs);Si.AbstractUIExtension=Hs});var oo=f(Ei=>{"use strict";var Hb=Ei&&Ei.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},OT=Ei&&Ei.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.DOMHelper=void 0;var zb=_(),TT=P(),Mu=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(e){return this.getPrefix()+e.id}findSModelIdByDOMElement(e){return e.id.replace(this.getPrefix(),"")}};Hb([(0,zb.inject)(TT.TYPES.ViewerOptions),OT("design:type",Object)],Mu.prototype,"viewerOptions",void 0);Mu=Hb([(0,zb.injectable)()],Mu);Ei.DOMHelper=Mu});var Mt=f(Ze=>{"use strict";var ao=Ze&&Ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Au=Ze&&Ze.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Ou=Ze&&Ze.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.MousePositionTracker=Ze.MouseListener=Ze.PopupMouseTool=Ze.MouseTool=void 0;var Rn=_(),AT=te(),CT=G(),Cu=P(),xT=oo(),kt=Ne(),so=class{constructor(e=[]){this.mouseListeners=e}register(e){this.mouseListeners.push(e)}deregister(e){let t=this.mouseListeners.indexOf(e);t>=0&&this.mouseListeners.splice(t,1)}getTargetElement(e,t){let n=t.target,r=e.index;for(;n;){if(n.id){let o=r.getById(this.domHelper.findSModelIdByDOMElement(n));if(o!==void 0)return o}n=n.parentNode}}handleEvent(e,t,n){this.focusOnMouseEvent(e,t);let r=this.getTargetElement(t,n);if(!r)return;let o=this.mouseListeners.map(s=>s[e](r,n)).reduce((s,a)=>s.concat(a));if(o.length>0){n.preventDefault();for(let s of o)(0,AT.isAction)(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}focusOnMouseEvent(e,t){if(document&&e==="mouseDown"){let n=document.getElementById(this.domHelper.createUniqueDOMElementId(t));n!==null&&typeof n.focus=="function"&&n.focus()}}mouseOver(e,t){this.handleEvent("mouseOver",e,t)}mouseOut(e,t){this.handleEvent("mouseOut",e,t)}mouseEnter(e,t){this.handleEvent("mouseEnter",e,t)}mouseLeave(e,t){this.handleEvent("mouseLeave",e,t)}mouseDown(e,t){this.handleEvent("mouseDown",e,t)}mouseMove(e,t){this.handleEvent("mouseMove",e,t)}mouseUp(e,t){this.handleEvent("mouseUp",e,t)}wheel(e,t){this.handleEvent("wheel",e,t)}contextMenu(e,t){t.preventDefault(),this.handleEvent("contextMenu",e,t)}doubleClick(e,t){this.handleEvent("doubleClick",e,t)}decorate(e,t){return t instanceof CT.SModelRoot&&((0,kt.on)(e,"mouseover",this.mouseOver.bind(this,t)),(0,kt.on)(e,"mouseout",this.mouseOut.bind(this,t)),(0,kt.on)(e,"mouseenter",this.mouseEnter.bind(this,t)),(0,kt.on)(e,"mouseleave",this.mouseLeave.bind(this,t)),(0,kt.on)(e,"mousedown",this.mouseDown.bind(this,t)),(0,kt.on)(e,"mouseup",this.mouseUp.bind(this,t)),(0,kt.on)(e,"mousemove",this.mouseMove.bind(this,t)),(0,kt.on)(e,"wheel",this.wheel.bind(this,t)),(0,kt.on)(e,"contextmenu",this.contextMenu.bind(this,t)),(0,kt.on)(e,"dblclick",this.doubleClick.bind(this,t)),(0,kt.on)(e,"dragover",n=>this.handleEvent("dragOver",t,n)),(0,kt.on)(e,"drop",n=>this.handleEvent("drop",t,n))),e=this.mouseListeners.reduce((n,r)=>r.decorate(n,t),e),e}postUpdate(){}};ao([(0,Rn.inject)(Cu.TYPES.IActionDispatcher),Au("design:type",Object)],so.prototype,"actionDispatcher",void 0);ao([(0,Rn.inject)(Cu.TYPES.DOMHelper),Au("design:type",xT.DOMHelper)],so.prototype,"domHelper",void 0);so=ao([(0,Rn.injectable)(),Ou(0,(0,Rn.multiInject)(Cu.TYPES.MouseListener)),Ou(0,(0,Rn.optional)()),Au("design:paramtypes",[Array])],so);Ze.MouseTool=so;var jh=class extends so{constructor(e=[]){super(e),this.mouseListeners=e}};jh=ao([(0,Rn.injectable)(),Ou(0,(0,Rn.multiInject)(Cu.TYPES.PopupMouseListener)),Ou(0,(0,Rn.optional)()),Au("design:paramtypes",[Array])],jh);Ze.PopupMouseTool=jh;var Tu=class{mouseOver(e,t){return[]}mouseOut(e,t){return[]}mouseEnter(e,t){return[]}mouseLeave(e,t){return[]}mouseDown(e,t){return[]}mouseMove(e,t){return[]}mouseUp(e,t){return[]}wheel(e,t){return[]}doubleClick(e,t){return[]}contextMenu(e,t){return[]}dragOver(e,t){return[]}drop(e,t){return[]}decorate(e,t){return e}};Tu=ao([(0,Rn.injectable)()],Tu);Ze.MouseListener=Tu;var Nh=class extends Tu{mouseMove(e,t){return this.lastPosition=e.root.parentToLocal({x:t.offsetX,y:t.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};Nh=ao([(0,Rn.injectable)()],Nh);Ze.MousePositionTracker=Nh});var co=f(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});function DT(i,e){return document.createElement(i,e)}function qT(i,e,t){return document.createElementNS(i,e,t)}function jT(){return dr(document.createDocumentFragment())}function NT(i){return document.createTextNode(i)}function LT(i){return document.createComment(i)}function BT(i,e,t){if($n(i)){let n=i;for(;n&&$n(n);)n=dr(n).parent;i=n??i}$n(e)&&(e=dr(e,i)),t&&$n(t)&&(t=dr(t).firstChildNode),i.insertBefore(e,t)}function FT(i,e){i.removeChild(e)}function VT(i,e){$n(e)&&(e=dr(e,i)),i.appendChild(e)}function Zb(i){if($n(i)){for(;i&&$n(i);)i=dr(i).parent;return i??null}return i.parentNode}function KT(i){var e;if($n(i)){let t=dr(i),n=Zb(t);if(n&&t.lastChildNode){let r=Array.from(n.childNodes),o=r.indexOf(t.lastChildNode);return(e=r[o+1])!==null&&e!==void 0?e:null}return null}return i.nextSibling}function HT(i){return i.tagName}function zT(i,e){i.textContent=e}function YT(i){return i.textContent}function kT(i){return i.nodeType===1}function UT(i){return i.nodeType===3}function GT(i){return i.nodeType===8}function $n(i){return i.nodeType===11}function dr(i,e){var t,n,r;let o=i;return(t=o.parent)!==null&&t!==void 0||(o.parent=e??null),(n=o.firstChildNode)!==null&&n!==void 0||(o.firstChildNode=i.firstChild),(r=o.lastChildNode)!==null&&r!==void 0||(o.lastChildNode=i.lastChild),o}var Hh={createElement:DT,createElementNS:qT,createTextNode:NT,createDocumentFragment:jT,createComment:LT,insertBefore:BT,removeChild:FT,appendChild:VT,parentNode:Zb,nextSibling:KT,tagName:HT,setTextContent:zT,getTextContent:YT,isElement:kT,isText:UT,isComment:GT,isDocumentFragment:$n};function ut(i,e,t,n,r){let o=e===void 0?void 0:e.key;return{sel:i,data:e,children:t,text:n,elm:r,key:o}}var Ys=Array.isArray;function lr(i){return typeof i=="string"||typeof i=="number"||i instanceof String||i instanceof Number}function Lh(i){return i===void 0}function vt(i){return i!==void 0}var Bh=ut("",{},[],void 0,void 0);function zs(i,e){var t,n;let r=i.key===e.key,o=((t=i.data)===null||t===void 0?void 0:t.is)===((n=e.data)===null||n===void 0?void 0:n.is),s=i.sel===e.sel,a=!i.sel&&i.sel===e.sel?typeof i.text==typeof e.text:!0;return s&&r&&o&&a}function WT(){throw new Error("The document fragment is not supported on this platform.")}function $T(i,e){return i.isElement(e)}function XT(i,e){return i.isDocumentFragment(e)}function JT(i,e,t){var n;let r={};for(let o=e;o<=t;++o){let s=(n=i[o])===null||n===void 0?void 0:n.key;s!==void 0&&(r[s]=o)}return r}var ZT=["create","update","remove","destroy","pre","post"];function QT(i,e,t){let n={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:Hh;for(let v of ZT)for(let m of i){let O=m[v];O!==void 0&&n[v].push(O)}function o(v){let m=v.id?"#"+v.id:"",O=v.getAttribute("class"),A=O?"."+O.split(" ").join("."):"";return ut(r.tagName(v).toLowerCase()+m+A,{},[],void 0,v)}function s(v){return ut(void 0,{},[],void 0,v)}function a(v,m){return function(){if(--m===0){let A=r.parentNode(v);r.removeChild(A,v)}}}function c(v,m){var O,A,K,U;let D,F=v.data;if(F!==void 0){let z=(O=F.hook)===null||O===void 0?void 0:O.init;vt(z)&&(z(v),F=v.data)}let H=v.children,W=v.sel;if(W==="!")Lh(v.text)&&(v.text=""),v.elm=r.createComment(v.text);else if(W!==void 0){let z=W.indexOf("#"),oe=W.indexOf(".",z),we=z>0?z:W.length,le=oe>0?oe:W.length,_e=z!==-1||oe!==-1?W.slice(0,Math.min(we,le)):W,Ue=v.elm=vt(F)&&vt(D=F.ns)?r.createElementNS(D,_e,F):r.createElement(_e,F);for(we<le&&Ue.setAttribute("id",W.slice(we+1,le)),oe>0&&Ue.setAttribute("class",W.slice(le+1).replace(/\./g," ")),D=0;D<n.create.length;++D)n.create[D](Bh,v);if(Ys(H))for(D=0;D<H.length;++D){let si=H[D];si!=null&&r.appendChild(Ue,c(si,m))}else lr(v.text)&&r.appendChild(Ue,r.createTextNode(v.text));let mn=v.data.hook;vt(mn)&&((A=mn.create)===null||A===void 0||A.call(mn,Bh,v),mn.insert&&m.push(v))}else if(!((K=t?.experimental)===null||K===void 0)&&K.fragments&&v.children){for(v.elm=((U=r.createDocumentFragment)!==null&&U!==void 0?U:WT)(),D=0;D<n.create.length;++D)n.create[D](Bh,v);for(D=0;D<v.children.length;++D){let z=v.children[D];z!=null&&r.appendChild(v.elm,c(z,m))}}else v.elm=r.createTextNode(v.text);return v.elm}function u(v,m,O,A,K,U){for(;A<=K;++A){let D=O[A];D!=null&&r.insertBefore(v,c(D,U),m)}}function d(v){var m,O;let A=v.data;if(A!==void 0){(O=(m=A?.hook)===null||m===void 0?void 0:m.destroy)===null||O===void 0||O.call(m,v);for(let K=0;K<n.destroy.length;++K)n.destroy[K](v);if(v.children!==void 0)for(let K=0;K<v.children.length;++K){let U=v.children[K];U!=null&&typeof U!="string"&&d(U)}}}function l(v,m,O,A){for(var K,U;O<=A;++O){let D,F,H=m[O];if(H!=null)if(vt(H.sel)){d(H),D=n.remove.length+1,F=a(H.elm,D);for(let z=0;z<n.remove.length;++z)n.remove[z](H,F);let W=(U=(K=H?.data)===null||K===void 0?void 0:K.hook)===null||U===void 0?void 0:U.remove;vt(W)?W(H,F):F()}else H.children?(d(H),l(v,H.children,0,H.children.length-1)):r.removeChild(v,H.elm)}}function S(v,m,O,A){let K=0,U=0,D=m.length-1,F=m[0],H=m[D],W=O.length-1,z=O[0],oe=O[W],we,le,_e,Ue;for(;K<=D&&U<=W;)F==null?F=m[++K]:H==null?H=m[--D]:z==null?z=O[++U]:oe==null?oe=O[--W]:zs(F,z)?(R(F,z,A),F=m[++K],z=O[++U]):zs(H,oe)?(R(H,oe,A),H=m[--D],oe=O[--W]):zs(F,oe)?(R(F,oe,A),r.insertBefore(v,F.elm,r.nextSibling(H.elm)),F=m[++K],oe=O[--W]):zs(H,z)?(R(H,z,A),r.insertBefore(v,H.elm,F.elm),H=m[--D],z=O[++U]):(we===void 0&&(we=JT(m,K,D)),le=we[z.key],Lh(le)?r.insertBefore(v,c(z,A),F.elm):(_e=m[le],_e.sel!==z.sel?r.insertBefore(v,c(z,A),F.elm):(R(_e,z,A),m[le]=void 0,r.insertBefore(v,_e.elm,F.elm))),z=O[++U]);U<=W&&(Ue=O[W+1]==null?null:O[W+1].elm,u(v,Ue,O,U,W,A)),K<=D&&l(v,m,K,D)}function R(v,m,O){var A,K,U,D,F,H,W,z;let oe=(A=m.data)===null||A===void 0?void 0:A.hook;(K=oe?.prepatch)===null||K===void 0||K.call(oe,v,m);let we=m.elm=v.elm;if(v===m)return;if(m.data!==void 0||vt(m.text)&&m.text!==v.text){(U=m.data)!==null&&U!==void 0||(m.data={}),(D=v.data)!==null&&D!==void 0||(v.data={});for(let Ue=0;Ue<n.update.length;++Ue)n.update[Ue](v,m);(W=(H=(F=m.data)===null||F===void 0?void 0:F.hook)===null||H===void 0?void 0:H.update)===null||W===void 0||W.call(H,v,m)}let le=v.children,_e=m.children;Lh(m.text)?vt(le)&&vt(_e)?le!==_e&&S(we,le,_e,O):vt(_e)?(vt(v.text)&&r.setTextContent(we,""),u(we,null,_e,0,_e.length-1,O)):vt(le)?l(we,le,0,le.length-1):vt(v.text)&&r.setTextContent(we,""):v.text!==m.text&&(vt(le)&&l(we,le,0,le.length-1),r.setTextContent(we,m.text)),(z=oe?.postpatch)===null||z===void 0||z.call(oe,v,m)}return function(m,O){let A,K,U,D=[];for(A=0;A<n.pre.length;++A)n.pre[A]();for($T(r,m)?m=o(m):XT(r,m)&&(m=s(m)),zs(m,O)?R(m,O,D):(K=m.elm,U=r.parentNode(K),c(O,D),U!==null&&(r.insertBefore(U,O.elm,r.nextSibling(K)),l(U,[m],0,0))),A=0;A<D.length;++A)D[A].data.hook.insert(D[A]);for(A=0;A<n.post.length;++A)n.post[A]();return O}}function qu(i,e,t){if(i.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let n=0;n<e.length;++n){let r=e[n];if(typeof r=="string")continue;let o=r.data;o!==void 0&&qu(o,r.children,r.sel)}}function Du(i,e,t){let n={},r,o,s;if(t!==void 0?(e!==null&&(n=e),Ys(t)?r=t:lr(t)?o=t.toString():t&&t.sel&&(r=[t])):e!=null&&(Ys(e)?r=e:lr(e)?o=e.toString():e&&e.sel?r=[e]:n=e),r!==void 0)for(s=0;s<r.length;++s)lr(r[s])&&(r[s]=ut(void 0,void 0,void 0,r[s],void 0));return i[0]==="s"&&i[1]==="v"&&i[2]==="g"&&(i.length===3||i[3]==="."||i[3]==="#")&&qu(n,r,i),ut(i,n,r,o,void 0)}function eA(i){let e,t;if(Ys(i)?e=i:lr(e)?t=i:e&&e.sel&&(e=[i]),e!==void 0)for(let n=0;n<e.length;++n)lr(e[n])&&(e[n]=ut(void 0,void 0,void 0,e[n],void 0));return ut(void 0,{},e,t,void 0)}function xu(i,e){var t;let n=(t=e.data)===null||t===void 0?void 0:t.ns;i.data.fn=e.data.fn,i.data.args=e.data.args,e.data=i.data,e.children=i.children,e.text=i.text,e.elm=i.elm,n&&qu(e.data,e.children,e.sel)}function tA(i){let e=i.data,t=e.fn(...e.args);xu(t,i)}function nA(i,e){let t,n=i.data,r=e.data,o=n.args,s=r.args;if(n.fn!==r.fn||o.length!==s.length){xu(r.fn(...s),e);return}for(t=0;t<s.length;++t)if(o[t]!==s[t]){xu(r.fn(...s),e);return}xu(i,e)}var iA=function(e,t,n,r){return r===void 0&&(r=n,n=t,t=void 0),Du(e,{key:t,hook:{init:tA,prepatch:nA},fn:n,args:r})};function rA(i,e){let t=i.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,i.elm=i.data.attachData.real}function oA(i,e){e.elm=e.data.attachData.placeholder}function sA(i){i.elm!==void 0&&i.elm.parentNode.removeChild(i.elm),i.elm=i.data.attachData.real}function aA(i,e){let t=e.elm,n=e.data.attachData,r=document.createElement("span");e.elm=r,n.target.appendChild(t),n.real=t,n.placeholder=r}function cA(i,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});let t=e.data,n=e.data.hook;return t.attachData={target:i,placeholder:void 0,real:void 0},n.create=aA,n.prepatch=rA,n.postpatch=oA,n.destroy=sA,e}function Qb(i,e){let t=e!==void 0?e:Hh,n;if(t.isElement(i)){let r=i.id?"#"+i.id:"",o=i.getAttribute("class"),s=o?"."+o.split(" ").join("."):"",a=t.tagName(i).toLowerCase()+r+s,c={},u={},d={},l=[],S,R,v,m=i.attributes,O=i.childNodes;for(R=0,v=m.length;R<v;R++)S=m[R].nodeName,S[0]==="d"&&S[1]==="a"&&S[2]==="t"&&S[3]==="a"&&S[4]==="-"?u[S.slice(5)]=m[R].nodeValue||"":S!=="id"&&S!=="class"&&(c[S]=m[R].nodeValue);for(R=0,v=O.length;R<v;R++)l.push(Qb(O[R],e));return Object.keys(c).length>0&&(d.attrs=c),Object.keys(u).length>0&&(d.dataset=u),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&qu(d,l,a),ut(a,d,l,void 0,i)}else return t.isText(i)?(n=t.getTextContent(i),ut(void 0,void 0,void 0,n,i)):t.isComment(i)?(n=t.getTextContent(i),ut("!",{},[],n,i)):ut("",{},[],void 0,i)}var uA="http://www.w3.org/1999/xlink",dA="http://www.w3.org/XML/1998/namespace",Yb=58,lA=120;function kb(i,e){let t,n=e.elm,r=i.data.attrs,o=e.data.attrs;if(!(!r&&!o)&&r!==o){r=r||{},o=o||{};for(t in o){let s=o[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==lA?n.setAttribute(t,s):t.charCodeAt(3)===Yb?n.setAttributeNS(dA,t,s):t.charCodeAt(5)===Yb?n.setAttributeNS(uA,t,s):n.setAttribute(t,s))}for(t in r)t in o||n.removeAttribute(t)}}var fA={create:kb,update:kb};function Ub(i,e){let t,n,r=e.elm,o=i.data.class,s=e.data.class;if(!(!o&&!s)&&o!==s){o=o||{},s=s||{};for(n in o)o[n]&&!Object.prototype.hasOwnProperty.call(s,n)&&r.classList.remove(n);for(n in s)t=s[n],t!==o[n]&&r.classList[t?"add":"remove"](n)}}var hA={create:Ub,update:Ub},Gb=/[A-Z]/g;function Wb(i,e){let t=e.elm,n=i.data.dataset,r=e.data.dataset,o;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(o in n)r[o]||(s?o in s&&delete s[o]:t.removeAttribute("data-"+o.replace(Gb,"-$&").toLowerCase()));for(o in r)n[o]!==r[o]&&(s?s[o]=r[o]:t.setAttribute("data-"+o.replace(Gb,"-$&").toLowerCase(),r[o]))}var pA={create:Wb,update:Wb};function eS(i,e,t){if(typeof i=="function")i.call(e,t,e);else if(typeof i=="object")for(let n=0;n<i.length;n++)eS(i[n],e,t)}function gA(i,e){let t=i.type,n=e.data.on;n&&n[t]&&eS(n[t],e,i)}function mA(){return function i(e){gA(e,i.vnode)}}function Fh(i,e){let t=i.data.on,n=i.listener,r=i.elm,o=e&&e.data.on,s=e&&e.elm,a;if(t!==o){if(t&&n)if(o)for(a in t)o[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(o){let c=e.listener=i.listener||mA();if(c.vnode=e,t)for(a in o)t[a]||s.addEventListener(a,c,!1);else for(a in o)s.addEventListener(a,c,!1)}}}var yA={create:Fh,update:Fh,destroy:Fh};function $b(i,e){let t,n,r,o=e.elm,s=i.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||o[t]!==n)&&(o[t]=n)}}var _A={create:$b,update:$b},Xb=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,vA=function(i){Xb(function(){Xb(i)})},Vh=!1;function bA(i,e,t){vA(function(){i[e]=t})}function Jb(i,e){let t,n,r=e.elm,o=i.data.style,s=e.data.style;if(!o&&!s||o===s)return;o=o||{},s=s||{};let a="delayed"in o;for(n in o)s[n]||(n[0]==="-"&&n[1]==="-"?r.style.removeProperty(n):r.style[n]="");for(n in s)if(t=s[n],n==="delayed"&&s.delayed)for(let c in s.delayed)t=s.delayed[c],(!a||t!==o.delayed[c])&&bA(r.style,c,t);else n!=="remove"&&t!==o[n]&&(n[0]==="-"&&n[1]==="-"?r.style.setProperty(n,t):r.style[n]=t)}function SA(i){let e,t,n=i.elm,r=i.data.style;if(!(!r||!(e=r.destroy)))for(t in e)n.style[t]=e[t]}function EA(i,e){let t=i.data.style;if(!t||!t.remove){e();return}Vh||(i.elm.offsetLeft,Vh=!0);let n,r=i.elm,o=0,s=t.remove,a=0,c=[];for(n in s)c.push(n),r.style[n]=s[n];let d=getComputedStyle(r)["transition-property"].split(", ");for(;o<d.length;++o)c.indexOf(d[o])!==-1&&a++;r.addEventListener("transitionend",function(l){l.target===r&&--a,a===0&&e()})}function wA(){Vh=!1}var PA={pre:wA,create:Jb,update:Jb,destroy:SA,remove:EA};function IA(i,...e){let t=zh(e,[]);return t.length===1&&!t[0].sel&&t[0].text?ut(void 0,void 0,void 0,t[0].text,void 0):ut(void 0,i??{},t,void 0,void 0)}function zh(i,e){for(let t of i)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?zh(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(ut(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function Kh(i,e,...t){let n=zh(t,[]);return typeof i=="function"?i(e,n):n.length===1&&!n[0].sel&&n[0].text?Du(i,e,n[0].text):Du(i,e,n)}(function(i){})(Kh||(Kh={}));Pe.Fragment=IA;Pe.array=Ys;Pe.attachTo=cA;Pe.attributesModule=fA;Pe.classModule=hA;Pe.datasetModule=pA;Pe.eventListenersModule=yA;Pe.fragment=eA;Pe.h=Du;Pe.htmlDomApi=Hh;Pe.init=QT;Pe.jsx=Kh;Pe.primitive=lr;Pe.propsModule=_A;Pe.styleModule=PA;Pe.thunk=iA;Pe.toVNode=Qb;Pe.vnode=ut});var kh=f(wi=>{"use strict";var RA=wi&&wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(wi,"__esModule",{value:!0});wi.isThunk=wi.ThunkView=void 0;var MA=co(),OA=_(),Yh=class{render(e,t){return(0,MA.h)(this.selector(e),{key:e.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(e,t),args:this.watchedArgs(e),thunk:!0})}renderAndDecorate(e,t){let n=this.doRender(e,t);return t.decorate(n,e),n}copyToThunk(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}init(e){let t=e.data,n=t.fn.apply(void 0,t.args);this.copyToThunk(n,e)}prepatch(e,t){let n=e.data,r=t.data;this.equals(n.args,r.args)?this.copyToThunk(e,t):this.copyToThunk(r.fn.apply(void 0,r.args),t)}equals(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<t.length;++n)if(!this.equals(e[n],t[n]))return!1}else if(typeof e=="object"&&typeof t=="object"){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(n!=="parent"&&n!=="root"&&(!(n in t)||!this.equals(e[n],t[n])))return!1}else if(e!==t)return!1;return!0}};Yh=RA([(0,OA.injectable)()],Yh);wi.ThunkView=Yh;function TA(i){return"thunk"in i}wi.isThunk=TA});var Ut=f(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.JSX=Pi.svg=Pi.html=void 0;var AA=co(),CA=["hook","on","style","class","props","attrs","dataset"],xA="http://www.w3.org/2000/svg";function DA(i,e,t){let n={};if(t&&(n.ns=t),i===null)return n;return CA.forEach(o=>{i[o]&&(n[o]=i[o])}),Object.keys(i).forEach(o=>{if(o==="key"||o==="classNames"||o==="selector")return;let s=o.indexOf("-");s>0?r(o.slice(0,s),o.slice(s+1),i[o]):n[o]||r(e,o,i[o])}),n;function r(o,s,a){let c=n[o]||(n[o]={});c[s]=a}}function Uh(i,e="props"){return(t,n,...r)=>(0,AA.jsx)(t,DA(n,e,i),r)}Pi.JSX=Uh;var qA=Uh();Pi.html=qA;var jA=Uh(xA,"attrs");Pi.svg=jA});var uo=f(Ie=>{"use strict";var Wh=Ie&&Ie.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},NA=Ie&&Ie.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},tS=Ie&&Ie.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.MissingView=Ie.EmptyView=Ie.configureView=Ie.configureModelElement=Ie.ViewRegistry=Ie.findArgValue=void 0;var nS=Ut(),ks=_(),iS=P(),LA=En(),BA=ir(),FA=wn(),VA=Ke(),KA=cr();function HA(i,e){for(;i!==void 0&&!(e in i)&&i.parentArgs;)i=i.parentArgs;return i?i[e]:void 0}Ie.findArgValue=HA;var Gh=class extends LA.InstanceRegistry{constructor(e){super(),this.registerDefaults(),e.forEach(t=>this.register(t.type,t.factory()))}registerDefaults(){this.register(FA.EMPTY_ROOT.type,new ju)}missing(e){return new Nu}};Gh=Wh([(0,ks.injectable)(),tS(0,(0,ks.multiInject)(iS.TYPES.ViewRegistration)),tS(0,(0,ks.optional)()),NA("design:paramtypes",[Array])],Gh);Ie.ViewRegistry=Gh;function zA(i,e,t,n,r){(0,VA.registerModelElement)(i,e,t,r),rS(i,e,n)}Ie.configureModelElement=zA;function rS(i,e,t){if(typeof t=="function"){if(!(0,BA.isInjectable)(t))throw new Error(`Views should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(iS.TYPES.ViewRegistration).toDynamicValue(n=>({type:e,factory:()=>n.container.get(t)}))}Ie.configureView=rS;var ju=class{render(e,t){return(0,nS.svg)("svg",{"class-sprotty-empty":!0})}};ju=Wh([(0,ks.injectable)()],ju);Ie.EmptyView=ju;var Nu=class{render(e,t){let n=e.position||KA.Point.ORIGIN;return(0,nS.svg)("text",{"class-sprotty-missing":!0,x:n.x,y:n.y},"?",e.id,"?")}};Nu=Wh([(0,ks.injectable)()],Nu);Ie.MissingView=Nu});var Jh=f(Ii=>{"use strict";var $h=Ii&&Ii.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},oS=Ii&&Ii.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.ViewerCache=void 0;var Xh=_(),sS=P(),YA=Wr(),Us=class{update(e,t){if(t!==void 0)this.delegate.update(e,t),this.cachedModel=void 0;else{let n=this.cachedModel===void 0;this.cachedModel=e,n&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};$h([(0,Xh.inject)(sS.TYPES.IViewer),oS("design:type",Object)],Us.prototype,"delegate",void 0);$h([(0,Xh.inject)(sS.TYPES.AnimationFrameSyncer),oS("design:type",YA.AnimationFrameSyncer)],Us.prototype,"syncer",void 0);Us=$h([(0,Xh.injectable)()],Us);Ii.ViewerCache=Us});var Zh=f(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.overrideViewerOptions=Xn.configureViewerOptions=Xn.defaultViewerOptions=void 0;var kA=yn(),Lu=P(),UA=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300});Xn.defaultViewerOptions=UA;function GA(i,e){let t=Object.assign(Object.assign({},(0,Xn.defaultViewerOptions)()),e);i.isBound(Lu.TYPES.ViewerOptions)?i.rebind(Lu.TYPES.ViewerOptions).toConstantValue(t):i.bind(Lu.TYPES.ViewerOptions).toConstantValue(t)}Xn.configureViewerOptions=GA;function WA(i,e){let t=i.get(Lu.TYPES.ViewerOptions);return(0,kA.safeAssign)(t,e),t}Xn.overrideViewerOptions=WA});var Qh=f(Le=>{"use strict";var an=Le&&Le.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cn=Le&&Le.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Gt=Le&&Le.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Le,"__esModule",{value:!0});Le.PopupModelViewer=Le.HiddenModelViewer=Le.ModelViewer=Le.PatcherProvider=Le.ModelRenderer=void 0;var ge=_(),lo=co(),Gs=Ut(),$A=Pn(),XA=Ns(),aS=wn(),Qe=P(),JA=kh(),Ot=Ne(),Ws=class{constructor(e,t,n,r={}){this.viewRegistry=e,this.targetKind=t,this.postprocessors=n,this.args=r}decorate(e,t){return(0,JA.isThunk)(e)?e:this.postprocessors.reduce((n,r)=>r.decorate(n,t),e)}renderElement(e){let n=this.viewRegistry.get(e.type).render(e,this,this.args);if(n)return this.decorate(n,e)}renderChildren(e,t){let n=t?new Ws(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map(r=>n.renderElement(r)).filter(r=>r!==void 0)}postUpdate(e){this.postprocessors.forEach(t=>t.postUpdate(e))}};Le.ModelRenderer=Ws;var fo=class{constructor(){this.patcher=(0,lo.init)(this.createModules())}createModules(){return[lo.propsModule,lo.attributesModule,lo.classModule,lo.styleModule,lo.eventListenersModule]}};fo=an([(0,ge.injectable)(),cn("design:paramtypes",[])],fo);Le.PatcherProvider=fo;var ho=class{constructor(e,t,n){this.renderer=e("main",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering",e);let n=(0,Gs.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(e));if(this.lastVDOM!==void 0){let r=this.hasFocus();(0,Ot.copyClassesFromVNode)(this.lastVDOM,n),this.lastVDOM=this.patcher.call(this,this.lastVDOM,n),this.restoreFocus(r)}else if(typeof document<"u"){let r=document.getElementById(this.options.baseDiv);r!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(n)}),(0,Ot.copyClassesFromElement)(r,n),(0,Ot.setClass)(n,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,r,n)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(t)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let e=this.lastVDOM.children[0];if(typeof e=="object"){let t=e.elm;return document.activeElement===t}}return!1}restoreFocus(e){if(e&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let t=this.lastVDOM.children[0];if(typeof t=="object"){let n=t.elm;n&&typeof n.focus=="function"&&n.focus()}}}onWindowResize(e){let t=document.getElementById(this.options.baseDiv);if(t!==null){let n=this.getBoundsInPage(t);this.actiondispatcher.dispatch(XA.InitializeCanvasBoundsAction.create(n))}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,$A.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};an([(0,ge.inject)(Qe.TYPES.ViewerOptions),cn("design:type",Object)],ho.prototype,"options",void 0);an([(0,ge.inject)(Qe.TYPES.ILogger),cn("design:type",Object)],ho.prototype,"logger",void 0);an([(0,ge.inject)(Qe.TYPES.IActionDispatcher),cn("design:type",Object)],ho.prototype,"actiondispatcher",void 0);ho=an([(0,ge.injectable)(),Gt(0,(0,ge.inject)(Qe.TYPES.ModelRendererFactory)),Gt(1,(0,ge.inject)(Qe.TYPES.PatcherProvider)),Gt(2,(0,ge.multiInject)(Qe.TYPES.IVNodePostprocessor)),Gt(2,(0,ge.optional)()),cn("design:paramtypes",[Function,fo,Array])],ho);Le.ModelViewer=ho;var $s=class{constructor(e,t,n){this.hiddenRenderer=e("hidden",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering hidden");let n;if(e.type===aS.EMPTY_ROOT.type)n=(0,Gs.html)("div",{id:this.options.hiddenDiv});else{let r=this.hiddenRenderer.renderElement(e);r&&(0,Ot.setAttr)(r,"opacity",0),n=(0,Gs.html)("div",{id:this.options.hiddenDiv},r)}if(this.lastHiddenVDOM!==void 0)(0,Ot.copyClassesFromVNode)(this.lastHiddenVDOM,n),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,n);else{let r=document.getElementById(this.options.hiddenDiv);r===null?(r=document.createElement("div"),document.body.appendChild(r)):(0,Ot.copyClassesFromElement)(r,n),(0,Ot.setClass)(n,this.options.baseClass,!0),(0,Ot.setClass)(n,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,r,n)}this.hiddenRenderer.postUpdate(t)}};an([(0,ge.inject)(Qe.TYPES.ViewerOptions),cn("design:type",Object)],$s.prototype,"options",void 0);an([(0,ge.inject)(Qe.TYPES.ILogger),cn("design:type",Object)],$s.prototype,"logger",void 0);$s=an([(0,ge.injectable)(),Gt(0,(0,ge.inject)(Qe.TYPES.ModelRendererFactory)),Gt(1,(0,ge.inject)(Qe.TYPES.PatcherProvider)),Gt(2,(0,ge.multiInject)(Qe.TYPES.HiddenVNodePostprocessor)),Gt(2,(0,ge.optional)()),cn("design:paramtypes",[Function,fo,Array])],$s);Le.HiddenModelViewer=$s;var Xs=class{constructor(e,t,n){this.modelRendererFactory=e,this.popupRenderer=this.modelRendererFactory("popup",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering popup",e);let n=e.type===aS.EMPTY_ROOT.type,r;if(n)r=(0,Gs.html)("div",{id:this.options.popupDiv});else{let o=e.canvasBounds,s={top:o.y+"px",left:o.x+"px"};r=(0,Gs.html)("div",{id:this.options.popupDiv,style:s},this.popupRenderer.renderElement(e))}if(this.lastPopupVDOM!==void 0)(0,Ot.copyClassesFromVNode)(this.lastPopupVDOM,r),(0,Ot.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,r);else if(typeof document<"u"){let o=document.getElementById(this.options.popupDiv);o===null?(o=document.createElement("div"),document.body.appendChild(o)):(0,Ot.copyClassesFromElement)(o,r),(0,Ot.setClass)(r,this.options.popupClass,!0),(0,Ot.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,o,r)}this.popupRenderer.postUpdate(t)}};an([(0,ge.inject)(Qe.TYPES.ViewerOptions),cn("design:type",Object)],Xs.prototype,"options",void 0);an([(0,ge.inject)(Qe.TYPES.ILogger),cn("design:type",Object)],Xs.prototype,"logger",void 0);Xs=an([(0,ge.injectable)(),Gt(0,(0,ge.inject)(Qe.TYPES.ModelRendererFactory)),Gt(1,(0,ge.inject)(Qe.TYPES.PatcherProvider)),Gt(2,(0,ge.multiInject)(Qe.TYPES.PopupVNodePostprocessor)),Gt(2,(0,ge.optional)()),cn("design:paramtypes",[Function,fo,Array])],Xs);Le.PopupModelViewer=Xs});var tp=f(po=>{"use strict";var ZA=po&&po.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(po,"__esModule",{value:!0});po.FocusFixPostprocessor=void 0;var QA=_(),eC=Ne(),ep=class{decorate(e,t){return e.sel&&e.sel.startsWith("svg")&&(0,eC.setAttr)(e,"tabindex",0),e}postUpdate(){}};ep=ZA([(0,QA.injectable)()],ep);po.FocusFixPostprocessor=ep});var Vu=f(Tt=>{"use strict";var Bu=Tt&&Tt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cS=Tt&&Tt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.ConsoleLogger=Tt.NullLogger=Tt.LogLevel=void 0;var Fu=_(),uS=P(),fr;(function(i){i[i.none=0]="none",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i[i.log=4]="log"})(fr=Tt.LogLevel||(Tt.LogLevel={}));var np=class{constructor(){this.logLevel=fr.none}error(e,t,...n){}warn(e,t,...n){}info(e,t,...n){}log(e,t,...n){}};np=Bu([(0,Fu.injectable)()],np);Tt.NullLogger=np;var Js=class{constructor(){this.logLevel=fr.log,this.viewOptions={baseDiv:""}}error(e,t,...n){if(this.logLevel>=fr.error)try{console.error.apply(e,this.consoleArguments(e,t,n))}catch{}}warn(e,t,...n){if(this.logLevel>=fr.warn)try{console.warn.apply(e,this.consoleArguments(e,t,n))}catch{}}info(e,t,...n){if(this.logLevel>=fr.info)try{console.info.apply(e,this.consoleArguments(e,t,n))}catch{}}log(e,t,...n){if(this.logLevel>=fr.log)try{console.log.apply(e,this.consoleArguments(e,t,n))}catch{}}consoleArguments(e,t,n){let r;return typeof e=="object"?r=e.constructor.name:r=e,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+r+": "+t,...n]}};Bu([(0,Fu.inject)(uS.TYPES.LogLevel),cS("design:type",Number)],Js.prototype,"logLevel",void 0);Bu([(0,Fu.inject)(uS.TYPES.ViewerOptions),cS("design:type",Object)],Js.prototype,"viewOptions",void 0);Js=Bu([(0,Fu.injectable)()],Js);Tt.ConsoleLogger=Js});var fS=f(Ri=>{"use strict";var ip=Ri&&Ri.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},dS=Ri&&Ri.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.IdPostprocessor=void 0;var rp=_(),lS=P(),tC=oo(),nC=Ne(),Zs=class{decorate(e,t){let n=(0,nC.getAttrs)(e);return n.id!==void 0&&this.logger.warn(e,"Overriding id of vnode ("+n.id+"). Make sure not to set it manually in view."),n.id=this.domHelper.createUniqueDOMElementId(t),e.key||(e.key=t.id),e}postUpdate(){}};ip([(0,rp.inject)(lS.TYPES.ILogger),dS("design:type",Object)],Zs.prototype,"logger",void 0);ip([(0,rp.inject)(lS.TYPES.DOMHelper),dS("design:type",tC.DOMHelper)],Zs.prototype,"domHelper",void 0);Zs=ip([(0,rp.injectable)()],Zs);Ri.IdPostprocessor=Zs});var pS=f(go=>{"use strict";var iC=go&&go.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(go,"__esModule",{value:!0});go.CssClassPostprocessor=void 0;var rC=vi(),hS=Ne(),oC=_(),op=class{decorate(e,t){if(t.cssClasses)for(let r of t.cssClasses)(0,hS.setClass)(e,r,!0);let n=(0,rC.getSubType)(t);return n&&n!==t.type&&(0,hS.setClass)(e,n,!0),e}postUpdate(){}};op=iC([(0,oC.injectable)()],op);go.CssClassPostprocessor=op});var up=f(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});var sC=_(),B=P(),sp=Ns(),gS=Vu(),aC=iu(),Ku=Ds(),cC=hh(),mS=wn(),uC=Wr(),Mi=Qh(),dC=Zh(),mo=Mt(),yS=sn(),_S=tp(),lC=uo(),Hu=Jh(),fC=oo(),zu=fS(),Yu=gt(),ap=pS(),yo=Oh(),vS=bu(),hC=vu(),bS=Ks(),pC=nh(),gC=new sC.ContainerModule((i,e,t)=>{i(B.TYPES.ILogger).to(gS.NullLogger).inSingletonScope(),i(B.TYPES.LogLevel).toConstantValue(gS.LogLevel.warn),i(B.TYPES.SModelRegistry).to(mS.SModelRegistry).inSingletonScope(),i(Ku.ActionHandlerRegistry).toSelf().inSingletonScope(),i(B.TYPES.ActionHandlerRegistryProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(Ku.ActionHandlerRegistry))})),i(B.TYPES.ViewRegistry).to(lC.ViewRegistry).inSingletonScope(),i(B.TYPES.IModelFactory).to(mS.SModelFactory).inSingletonScope(),i(B.TYPES.IActionDispatcher).to(aC.ActionDispatcher).inSingletonScope(),i(B.TYPES.IActionDispatcherProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.IActionDispatcher))})),i(B.TYPES.IDiagramLocker).to(pC.DefaultDiagramLocker).inSingletonScope(),i(B.TYPES.IActionHandlerInitializer).to(Yu.CommandActionHandlerInitializer),i(B.TYPES.ICommandStack).to(cC.CommandStack).inSingletonScope(),i(B.TYPES.ICommandStackProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.ICommandStack))})),i(B.TYPES.CommandStackOptions).toConstantValue({defaultDuration:250,undoHistoryLimit:50}),i(Mi.ModelViewer).toSelf().inSingletonScope(),i(Mi.HiddenModelViewer).toSelf().inSingletonScope(),i(Mi.PopupModelViewer).toSelf().inSingletonScope(),i(B.TYPES.ModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Mi.ModelViewer),o.bind(Hu.ViewerCache).toSelf(),o.get(Hu.ViewerCache)}).inSingletonScope(),i(B.TYPES.PopupModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Mi.PopupModelViewer),o.bind(Hu.ViewerCache).toSelf(),o.get(Hu.ViewerCache)}).inSingletonScope(),i(B.TYPES.HiddenModelViewer).toService(Mi.HiddenModelViewer),i(B.TYPES.IViewerProvider).toDynamicValue(r=>({get modelViewer(){return r.container.get(B.TYPES.ModelViewer)},get hiddenModelViewer(){return r.container.get(B.TYPES.HiddenModelViewer)},get popupModelViewer(){return r.container.get(B.TYPES.PopupModelViewer)}})),i(B.TYPES.ViewerOptions).toConstantValue((0,dC.defaultViewerOptions)()),i(B.TYPES.PatcherProvider).to(Mi.PatcherProvider).inSingletonScope(),i(B.TYPES.DOMHelper).to(fC.DOMHelper).inSingletonScope(),i(B.TYPES.ModelRendererFactory).toFactory(r=>(o,s,a={})=>{let c=r.container.get(B.TYPES.ViewRegistry);return new Mi.ModelRenderer(c,o,s,a)}),i(zu.IdPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(zu.IdPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(zu.IdPostprocessor),i(ap.CssClassPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(ap.CssClassPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(ap.CssClassPostprocessor),i(mo.MouseTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(mo.MouseTool),i(yS.KeyTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(yS.KeyTool),i(_S.FocusFixPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(_S.FocusFixPostprocessor),i(B.TYPES.PopupVNodePostprocessor).toService(zu.IdPostprocessor),i(mo.PopupMouseTool).toSelf().inSingletonScope(),i(B.TYPES.PopupVNodePostprocessor).toService(mo.PopupMouseTool),i(B.TYPES.AnimationFrameSyncer).to(uC.AnimationFrameSyncer).inSingletonScope();let n={bind:i,isBound:t};(0,Yu.configureCommand)(n,sp.InitializeCanvasBoundsCommand),i(sp.CanvasBoundsInitializer).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(sp.CanvasBoundsInitializer),(0,Yu.configureCommand)(n,hC.SetModelCommand),i(B.TYPES.IToolManager).to(yo.ToolManager).inSingletonScope(),i(yo.DefaultToolsEnablingKeyListener).toSelf().inSingletonScope(),i(B.TYPES.KeyListener).toService(yo.DefaultToolsEnablingKeyListener),i(yo.ToolManagerActionHandler).toSelf().inSingletonScope(),(0,Ku.configureActionHandler)(n,vS.EnableDefaultToolsAction.KIND,yo.ToolManagerActionHandler),(0,Ku.configureActionHandler)(n,vS.EnableToolsAction.KIND,yo.ToolManagerActionHandler),i(B.TYPES.UIExtensionRegistry).to(bS.UIExtensionRegistry).inSingletonScope(),(0,Yu.configureCommand)(n,bS.SetUIExtensionVisibilityCommand),i(mo.MousePositionTracker).toSelf().inSingletonScope(),i(B.TYPES.MouseListener).toService(mo.MousePositionTracker)});cp.default=gC});var ae=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.SShapeElement=Z.findChildrenAtPosition=Z.getAbsoluteClientBounds=Z.getAbsoluteBounds=Z.isAlignable=Z.isSizeable=Z.isLayoutableChild=Z.isLayoutContainer=Z.isBoundsAware=Z.alignFeature=Z.layoutableChildFeature=Z.layoutContainerFeature=Z.boundsFeature=void 0;var _o=Q(),ku=G(),mC=Ke(),yC=Pn();Z.boundsFeature=Symbol("boundsFeature");Z.layoutContainerFeature=Symbol("layoutContainerFeature");Z.layoutableChildFeature=Symbol("layoutableChildFeature");Z.alignFeature=Symbol("alignFeature");function vo(i){return"bounds"in i}Z.isBoundsAware=vo;function _C(i){return vo(i)&&i.hasFeature(Z.layoutContainerFeature)&&"layout"in i}Z.isLayoutContainer=_C;function vC(i){return vo(i)&&i.hasFeature(Z.layoutableChildFeature)}Z.isLayoutableChild=vC;function bC(i){return i.hasFeature(Z.boundsFeature)&&vo(i)}Z.isSizeable=bC;function SC(i){return i.hasFeature(Z.alignFeature)&&"alignment"in i}Z.isAlignable=SC;function EC(i){let e=(0,mC.findParentByFeature)(i,vo);if(e!==void 0){let t=e.bounds,n=e;for(;n instanceof ku.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}else if(i instanceof ku.SModelRoot){let t=i.canvasBounds;return{x:0,y:0,width:t.width,height:t.height}}else return _o.Bounds.EMPTY}Z.getAbsoluteBounds=EC;function wC(i,e,t){let n=0,r=0,o=0,s=0,a=e.createUniqueDOMElementId(i),c=document.getElementById(a);if(c){let d=c.getBoundingClientRect(),l=(0,yC.getWindowScroll)();n=d.left+l.x,r=d.top+l.y,o=d.width,s=d.height}let u=document.getElementById(t.baseDiv);if(u)for(;u.offsetParent instanceof HTMLElement&&(u=u.offsetParent);)n-=u.offsetLeft,r-=u.offsetTop;return{x:n,y:r,width:o,height:s}}Z.getAbsoluteClientBounds=wC;function PC(i,e){let t=[];return SS(i,e,t),t}Z.findChildrenAtPosition=PC;function SS(i,e,t){i.children.forEach(n=>{if(vo(n)&&_o.Bounds.includes(n.bounds,e)&&t.push(n),n instanceof ku.SParentElement){let r=n.parentToLocal(e);SS(n,r,t)}})}var dp=class extends ku.SChildElement{constructor(){super(...arguments),this.position=_o.Point.ORIGIN,this.size=_o.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:e.x+this.position.x,y:e.y+this.position.y,width:-1,height:-1};return(0,_o.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}parentToLocal(e){let t={x:e.x-this.position.x,y:e.y-this.position.y,width:-1,height:-1};return(0,_o.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}};Z.SShapeElement=dp});var $u=f(ce=>{"use strict";var IC=ce&&ce.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),RC=ce&&ce.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),ES=ce&&ce.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},MC=ce&&ce.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&IC(e,i,t);return RC(e,i),e},wS=ce&&ce.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},PS=ce&&ce.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ce,"__esModule",{value:!0});ce.RequestBoundsCommand=ce.SetBoundsCommand=ce.LayoutAction=ce.ComputedBoundsAction=ce.RequestBoundsAction=ce.SetBoundsAction=void 0;var Uu=_(),OC=te(),IS=MC(te()),RS=pe(),MS=P(),TC=ae(),bo=class{constructor(e){this.bounds=e,this.kind=bo.KIND}};ce.SetBoundsAction=bo;bo.KIND="setBounds";var hr=class{constructor(e,t=""){this.newRoot=e,this.requestId=t,this.kind=hr.KIND}static create(e){return new hr(e,(0,OC.generateRequestId)())}};ce.RequestBoundsAction=hr;hr.KIND="requestBounds";var pr=class{constructor(e,t,n,r=""){this.bounds=e,this.revision=t,this.alignments=n,this.responseId=r,this.kind=pr.KIND}};ce.ComputedBoundsAction=pr;pr.KIND="computedBounds";var So=class{constructor(){this.kind=So.KIND}};ce.LayoutAction=So;So.KIND="layout";var Gu=class extends RS.SystemCommand{constructor(e){super(),this.action=e,this.bounds=[]}execute(e){return this.action.bounds.forEach(t=>{let n=e.root.index.getById(t.elementId);n&&(0,TC.isBoundsAware)(n)&&this.bounds.push({element:n,oldBounds:n.bounds,newPosition:t.newPosition,newSize:t.newSize})}),this.redo(e)}undo(e){return this.bounds.forEach(t=>t.element.bounds=t.oldBounds),e.root}redo(e){return this.bounds.forEach(t=>{t.newPosition?t.element.bounds=Object.assign(Object.assign({},t.newPosition),t.newSize):t.element.bounds=Object.assign({x:t.element.bounds.x,y:t.element.bounds.y},t.newSize)}),e.root}};Gu.KIND=IS.SetBoundsAction.KIND;Gu=ES([(0,Uu.injectable)(),PS(0,(0,Uu.inject)(MS.TYPES.Action)),wS("design:paramtypes",[Object])],Gu);ce.SetBoundsCommand=Gu;var Wu=class extends RS.HiddenCommand{constructor(e){super(),this.action=e}execute(e){return{model:e.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return e=>e.kind===pr.KIND}};Wu.KIND=IS.RequestBoundsAction.KIND;Wu=ES([(0,Uu.injectable)(),PS(0,(0,Uu.inject)(MS.TYPES.Action)),wS("design:paramtypes",[Object])],Wu);ce.RequestBoundsCommand=Wu});var Zu=f(et=>{"use strict";var ta=et&&et.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ju=et&&et.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},OS=et&&et.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(et,"__esModule",{value:!0});et.configureLayout=et.StatefulLayouter=et.Layouter=et.LayoutRegistry=void 0;var gr=_(),AC=Q(),na=P(),CC=En(),TS=ae(),xC=ir(),Qs=class extends CC.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>{this.hasKey(t.layoutKind)?this.logger.warn("Layout kind is already defined: ",t.layoutKind):this.register(t.layoutKind,t.factory())})}};ta([(0,gr.inject)(na.TYPES.ILogger),Ju("design:type",Object)],Qs.prototype,"logger",void 0);Qs=ta([(0,gr.injectable)(),OS(0,(0,gr.multiInject)(na.TYPES.LayoutRegistration)),OS(0,(0,gr.optional)()),Ju("design:paramtypes",[Array])],Qs);et.LayoutRegistry=Qs;var ea=class{layout(e){new Xu(e,this.layoutRegistry,this.logger).layout()}};ta([(0,gr.inject)(na.TYPES.LayoutRegistry),Ju("design:type",Qs)],ea.prototype,"layoutRegistry",void 0);ta([(0,gr.inject)(na.TYPES.ILogger),Ju("design:type",Object)],ea.prototype,"logger",void 0);ea=ta([(0,gr.injectable)()],ea);et.Layouter=ea;var Xu=class{constructor(e,t,n){this.element2boundsData=e,this.layoutRegistry=t,this.log=n,this.toBeLayouted=[],e.forEach((r,o)=>{(0,TS.isLayoutContainer)(o)&&this.toBeLayouted.push(o)})}getBoundsData(e){let t=this.element2boundsData.get(e),n=e.bounds;return(0,TS.isLayoutContainer)(e)&&this.toBeLayouted.indexOf(e)>=0&&(n=this.doLayout(e)),t||(t={bounds:n,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(e,t)),t}layout(){for(;this.toBeLayouted.length>0;){let e=this.toBeLayouted[0];this.doLayout(e)}}doLayout(e){let t=this.toBeLayouted.indexOf(e);t>=0&&this.toBeLayouted.splice(t,1);let n=this.layoutRegistry.get(e.layout);n&&n.layout(e,this);let r=this.element2boundsData.get(e);return r!==void 0&&r.bounds!==void 0?r.bounds:(this.log.error(e,"Layout failed"),AC.Bounds.EMPTY)}};et.StatefulLayouter=Xu;function DC(i,e,t){if(typeof t=="function"){if(!(0,xC.isInjectable)(t))throw new Error(`Layouts be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(na.TYPES.LayoutRegistration).toDynamicValue(n=>({layoutKind:e,factory:()=>n.container.get(t)}))}et.configureLayout=DC});var pp=f(Mn=>{"use strict";var Qu=Mn&&Mn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},fp=Mn&&Mn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Mn,"__esModule",{value:!0});Mn.HiddenBoundsUpdater=Mn.BoundsData=void 0;var ed=_(),AS=te(),mr=Q(),CS=G(),hp=P(),qC=Zu(),ia=ae(),lp=class{};Mn.BoundsData=lp;var Eo=class{constructor(){this.element2boundsData=new Map}decorate(e,t){return((0,ia.isSizeable)(t)||(0,ia.isLayoutContainer)(t))&&this.element2boundsData.set(t,{vnode:e,bounds:t.bounds,boundsChanged:!1,alignmentChanged:!1}),t instanceof CS.SModelRoot&&(this.root=t),e}postUpdate(e){if(e===void 0||e.kind!==AS.RequestBoundsAction.KIND)return;let t=e;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);let n=[],r=[];this.element2boundsData.forEach((s,a)=>{if(s.boundsChanged&&s.bounds!==void 0){let c={elementId:a.id,newSize:{width:s.bounds.width,height:s.bounds.height}};a instanceof CS.SChildElement&&(0,ia.isLayoutContainer)(a.parent)&&(c.newPosition={x:s.bounds.x,y:s.bounds.y}),n.push(c)}s.alignmentChanged&&s.alignment!==void 0&&r.push({elementId:a.id,newAlignment:s.alignment})});let o=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(AS.ComputedBoundsAction.create(n,{revision:o,alignments:r,requestId:t.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((e,t)=>{if(e.bounds&&(0,ia.isSizeable)(t)){let n=e.vnode;if(n&&n.elm){let r=this.getBounds(n.elm,t);(0,ia.isAlignable)(t)&&!((0,mr.almostEquals)(r.x,0)&&(0,mr.almostEquals)(r.y,0))&&(e.alignment={x:-r.x,y:-r.y},e.alignmentChanged=!0);let o={x:t.bounds.x,y:t.bounds.y,width:r.width,height:r.height};(0,mr.almostEquals)(o.x,t.bounds.x)&&(0,mr.almostEquals)(o.y,t.bounds.y)&&(0,mr.almostEquals)(o.width,t.bounds.width)&&(0,mr.almostEquals)(o.height,t.bounds.height)||(e.bounds=o,e.boundsChanged=!0)}}})}getBounds(e,t){if(typeof e.getBBox!="function")return this.logger.error(this,"Not an SVG element:",e),mr.Bounds.EMPTY;let n=e.getBBox();return{x:n.x,y:n.y,width:n.width,height:n.height}}};Qu([(0,ed.inject)(hp.TYPES.ILogger),fp("design:type",Object)],Eo.prototype,"logger",void 0);Qu([(0,ed.inject)(hp.TYPES.IActionDispatcher),fp("design:type",Object)],Eo.prototype,"actionDispatcher",void 0);Qu([(0,ed.inject)(hp.TYPES.Layouter),fp("design:type",qC.Layouter)],Eo.prototype,"layouter",void 0);Eo=Qu([(0,ed.injectable)()],Eo);Mn.HiddenBoundsUpdater=Eo});var td=f(wo=>{"use strict";var jC=wo&&wo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(wo,"__esModule",{value:!0});wo.AbstractLayout=void 0;var gp=Q(),xS=G(),mp=ae(),NC=_(),yp=class{layout(e,t){let n=t.getBoundsData(e),r=this.getLayoutOptions(e),o=this.getChildrenSize(e,r,t),s=r.paddingFactor*(r.resizeContainer?o.width:Math.max(0,this.getFixedContainerBounds(e,r,t).width)-r.paddingLeft-r.paddingRight),a=r.paddingFactor*(r.resizeContainer?o.height:Math.max(0,this.getFixedContainerBounds(e,r,t).height)-r.paddingTop-r.paddingBottom);if(s>0&&a>0){let c=this.layoutChildren(e,t,r,s,a);n.bounds=this.getFinalContainerBounds(e,c,r,s,a),n.boundsChanged=!0}}getFinalContainerBounds(e,t,n,r,o){return{x:e.bounds.x,y:e.bounds.y,width:Math.max(n.minWidth,r+n.paddingLeft+n.paddingRight),height:Math.max(n.minHeight,o+n.paddingTop+n.paddingBottom)}}getFixedContainerBounds(e,t,n){let r=e;for(;;){if((0,mp.isBoundsAware)(r)){let o=r.bounds;if((0,mp.isLayoutContainer)(r)&&t.resizeContainer&&n.log.error(r,"Resizable container found while detecting fixed bounds"),gp.Dimension.isValid(o))return o}if(r instanceof xS.SChildElement)r=r.parent;else return n.log.error(r,"Cannot detect fixed bounds"),gp.Bounds.EMPTY}}layoutChildren(e,t,n,r,o){let s={x:n.paddingLeft+.5*(r-r/n.paddingFactor),y:n.paddingTop+.5*(o-o/n.paddingFactor)};return e.children.forEach(a=>{if((0,mp.isLayoutableChild)(a)){let c=t.getBoundsData(a),u=c.bounds,d=this.getChildLayoutOptions(a,n);u!==void 0&&gp.Dimension.isValid(u)&&(s=this.layoutChild(a,c,u,d,n,s,r,o))}}),s}getDx(e,t,n){switch(e){case"left":return 0;case"center":return .5*(n-t.width);case"right":return n-t.width}}getDy(e,t,n){switch(e){case"top":return 0;case"center":return .5*(n-t.height);case"bottom":return n-t.height}}getChildLayoutOptions(e,t){let n=e.layoutOptions;return n===void 0?t:this.spread(t,n)}getLayoutOptions(e){let t=e,n=[];for(;t!==void 0;){let r=t.layoutOptions;if(r!==void 0&&n.push(r),t instanceof xS.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>this.spread(r,o),this.getDefaultLayoutOptions())}};yp=jC([(0,NC.injectable)()],yp);wo.AbstractLayout=yp});var _p=f(Po=>{"use strict";var LC=Po&&Po.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Po,"__esModule",{value:!0});Po.VBoxLayouter=void 0;var BC=_(),FC=Q(),VC=td(),KC=ae(),nd=class extends VC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=0,s=!0;return e.children.forEach(a=>{if((0,KC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&FC.Dimension.isValid(c)&&(o+=c.height,s?s=!1:o+=t.vGap,r=Math.max(r,c.width))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:s.y+e.bounds.y-n.y,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x,y:s.y+n.height+o.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};nd.KIND="vbox";nd=LC([(0,BC.injectable)()],nd);Po.VBoxLayouter=nd});var vp=f(Io=>{"use strict";var HC=Io&&Io.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Io,"__esModule",{value:!0});Io.HBoxLayouter=void 0;var zC=_(),YC=Q(),kC=td(),UC=ae(),id=class extends kC.AbstractLayout{getChildrenSize(e,t,n){let r=0,o=-1,s=!0;return e.children.forEach(a=>{if((0,UC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&YC.Dimension.isValid(c)&&(s?s=!1:r+=t.hGap,r+=c.width,o=Math.max(o,c.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDy(r.vAlign,n,c);return t.bounds={x:s.x+e.bounds.x-n.x,y:o.paddingTop+e.bounds.y-n.y+u,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x+n.width+o.hGap,y:s.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};id.KIND="hbox";id=HC([(0,zC.injectable)()],id);Io.HBoxLayouter=id});var bp=f(Ro=>{"use strict";var GC=Ro&&Ro.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ro,"__esModule",{value:!0});Ro.StackLayouter=void 0;var WC=_(),$C=Q(),XC=td(),JC=ae(),rd=class extends XC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=-1;return e.children.forEach(s=>{if((0,JC.isLayoutableChild)(s)){let a=n.getBoundsData(s).bounds;a!==void 0&&$C.Dimension.isValid(a)&&(r=Math.max(r,a.width),o=Math.max(o,a.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a),d=this.getDy(r.vAlign,n,c);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:o.paddingTop+e.bounds.y-n.y+d,width:n.width,height:n.height},t.boundsChanged=!0,s}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};rd.KIND="stack";rd=GC([(0,WC.injectable)()],rd);Ro.StackLayouter=rd});var ra=f(Mo=>{"use strict";var ZC=Mo&&Mo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.ShapeView=void 0;var QC=_(),ex=Q(),tx=ae(),Sp=class{isVisible(e,t){if(t.targetKind==="hidden"||!ex.Dimension.isValid(e.bounds))return!0;let n=(0,tx.getAbsoluteBounds)(e),r=e.root.canvasBounds;return n.x<=r.width&&n.x+n.width>=0&&n.y<=r.height&&n.y+n.height>=0}};Sp=ZC([(0,QC.injectable)()],Sp);Mo.ShapeView=Sp});var sa=f(Wt=>{"use strict";var nx=Wt&&Wt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ix=Wt&&Wt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},od=Wt&&Wt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.configureButtonHandler=Wt.ButtonHandlerRegistry=void 0;var oa=_(),rx=En(),Ep=P(),ox=ir(),wp=class extends rx.InstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.TYPE,n.factory())),t.forEach(n=>this.register(n.TYPE,new n))}};wp=nx([(0,oa.injectable)(),od(0,(0,oa.multiInject)(Ep.TYPES.IButtonHandlerRegistration)),od(0,(0,oa.optional)()),od(1,(0,oa.multiInject)(Ep.TYPES.IButtonHandler)),od(1,(0,oa.optional)()),ix("design:paramtypes",[Array,Array])],wp);Wt.ButtonHandlerRegistry=wp;function sx(i,e,t){if(typeof t=="function"){if(!(0,ox.isInjectable)(t))throw new Error(`Button handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(Ep.TYPES.IButtonHandlerRegistration).toDynamicValue(n=>({TYPE:e,factory:()=>n.container.get(t)}))}Wt.configureButtonHandler=sx});var Oo=f(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.isFadeable=yr.fadeFeature=void 0;yr.fadeFeature=Symbol("fadeFeature");function ax(i){return i.hasFeature(yr.fadeFeature)&&i.opacity!==void 0}yr.isFadeable=ax});var cd=f(ad=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});ad.SButton=void 0;var Pp=ae(),cx=Oo(),sd=class extends Pp.SShapeElement{constructor(){super(...arguments),this.enabled=!0}};ad.SButton=sd;sd.DEFAULT_FEATURES=[Pp.boundsFeature,Pp.layoutableChildFeature,cx.fadeFeature]});var Ip=f(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.name=Jn.isNameable=Jn.nameFeature=void 0;Jn.nameFeature=Symbol("nameableFeature");function DS(i){return i.hasFeature(Jn.nameFeature)}Jn.isNameable=DS;function ux(i){if(DS(i))return i.name}Jn.name=ux});var ud=f($t=>{"use strict";var NS=$t&&$t.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},LS=$t&&$t.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Mp=$t&&$t.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty($t,"__esModule",{value:!0});$t.RevealNamedElementActionProvider=$t.CommandPaletteActionProviderRegistry=void 0;var aa=_(),Rp=te(),qS=uc(),BS=P(),dx=er(),jS=Ip(),Op=class{constructor(e=[]){this.actionProviders=e}getActions(e,t,n,r){let o=this.actionProviders.map(s=>s.getActions(e,t,n,r));return Promise.all(o).then(s=>s.reduce((a,c)=>c!==void 0?a.concat(c):a))}};Op=NS([(0,aa.injectable)(),Mp(0,(0,aa.multiInject)(BS.TYPES.ICommandPaletteActionProvider)),Mp(0,(0,aa.optional)()),LS("design:paramtypes",[Array])],Op);$t.CommandPaletteActionProviderRegistry=Op;var Tp=class{constructor(e){this.logger=e}getActions(e,t,n,r){return r!==void 0&&r%2===0?Promise.resolve(this.createSelectActions(e)):Promise.resolve([new qS.LabeledAction("Select all",[Rp.SelectAllAction.create()])])}createSelectActions(e){return(0,dx.toArray)(e.index.all().filter(n=>(0,jS.isNameable)(n))).map(n=>new qS.LabeledAction(`Reveal ${(0,jS.name)(n)}`,[Rp.SelectAction.create({selectedElementsIDs:[n.id]}),Rp.CenterAction.create([n.id])],"eye"))}};Tp=NS([(0,aa.injectable)(),Mp(0,(0,aa.inject)(BS.TYPES.ILogger)),LS("design:paramtypes",[Object])],Tp);$t.RevealNamedElementActionProvider=Tp});var Ap=f(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.codiconCSSClasses=Xt.codiconCSSString=Xt.ANIMATION_SPIN=Xt.ACTION_ITEM=void 0;Xt.ACTION_ITEM="action-item";Xt.ANIMATION_SPIN="animation-spin";function lx(i,e=!1,t=!1,n=[]){return FS(i,e,t,n).join(" ")}Xt.codiconCSSString=lx;function FS(i,e=!1,t=!1,n=[]){let r=["codicon",`codicon-${i}`];return e&&r.push(Xt.ACTION_ITEM),t&&r.push(Xt.ANIMATION_SPIN),n.length>0&&r.push(...n),r}Xt.codiconCSSClasses=FS});var bt=f(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.isSelected=Zn.isSelectable=Zn.selectFeature=void 0;Zn.selectFeature=Symbol("selectFeature");function VS(i){return i.hasFeature(Zn.selectFeature)}Zn.isSelectable=VS;function fx(i){return i!==void 0&&VS(i)&&i.selected}Zn.isSelected=fx});var KS=f((Cp,xp)=>{(function(i,e){typeof Cp=="object"&&typeof xp<"u"?xp.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self,i.autocomplete=e())})(Cp,function(){"use strict";function i(e){var t=document,n=e.container||t.createElement("div");n.id=n.id||"autocomplete-"+O();var r=n.style,o=e.debounceWaitMs||0,s=e.preventSubmit||!1,a=e.disableAutoSelect||!1,c=[],u="",d=2,l=e.showOnFocus,S,R=0,v;if(e.minLength!==void 0&&(d=e.minLength),!e.input)throw new Error("input undefined");var m=e.input;n.className="autocomplete "+(e.className||""),n.setAttribute("role","listbox"),m.setAttribute("role","combobox"),m.setAttribute("aria-expanded","false"),m.setAttribute("aria-autocomplete","list"),m.setAttribute("aria-controls",n.id),m.setAttribute("aria-owns",n.id),m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-haspopup","listbox"),r.position="absolute";function O(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function A(){var N=n.parentNode;N&&N.removeChild(n)}function K(){v&&window.clearTimeout(v)}function U(){n.parentNode||t.body.appendChild(n)}function D(){return!!n.parentNode}function F(){R++,c=[],u="",S=void 0,m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-expanded","false"),A()}function H(){if(!D())return;m.setAttribute("aria-expanded","true"),r.height="auto",r.width=m.offsetWidth+"px";var N=0,q;function se(){var qe=t.documentElement,k=qe.clientTop||t.body.clientTop||0,Fe=qe.clientLeft||t.body.clientLeft||0,ai=window.pageYOffset||qe.scrollTop,on=window.pageXOffset||qe.scrollLeft;q=m.getBoundingClientRect();var Ge=q.top+m.offsetHeight+ai-k,it=q.left+on-Fe;r.top=Ge+"px",r.left=it+"px",N=window.innerHeight-(q.top+m.offsetHeight),N<0&&(N=0),r.top=Ge+"px",r.bottom="",r.left=it+"px",r.maxHeight=N+"px"}se(),se(),e.customize&&q&&e.customize(m,q,n,N)}function W(){for(;n.firstChild;)n.removeChild(n.firstChild);m.setAttribute("aria-activedescendant","");var N=function(Fe,ai,on){var Ge=t.createElement("div");return Ge.textContent=Fe.label||"",Ge};e.render&&(N=e.render);var q=function(Fe,ai){var on=t.createElement("div");return on.textContent=Fe,on};e.renderGroup&&(q=e.renderGroup);var se=t.createDocumentFragment(),qe="#9?$";if(c.forEach(function(Fe,ai){if(Fe.group&&Fe.group!==qe){qe=Fe.group;var on=q(Fe.group,u);on&&(on.className+=" group",se.appendChild(on))}var Ge=N(Fe,u,ai);Ge&&(Ge.id=n.id+"_"+ai,Ge.setAttribute("role","option"),Ge.addEventListener("click",function(it){e.onSelect(Fe,m),F(),it.preventDefault(),it.stopPropagation()}),Fe===S&&(Ge.className+=" selected",Ge.setAttribute("aria-selected","true"),m.setAttribute("aria-activedescendant",Ge.id)),se.appendChild(Ge))}),n.appendChild(se),c.length<1)if(e.emptyMsg){var k=t.createElement("div");k.id=n.id+"_"+O(),k.className="empty",k.textContent=e.emptyMsg,n.appendChild(k),m.setAttribute("aria-activedescendant",k.id)}else{F();return}U(),H(),_e()}function z(){D()&&W()}function oe(){z()}function we(N){N.target!==n?z():N.preventDefault()}function le(N){for(var q=N.which||N.keyCode||0,se=e.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9],qe=0,k=se;qe<k.length;qe++){var Fe=k[qe];if(q===Fe)return}q>=112&&q<=123&&!e.keysToIgnore||q===40&&D()||ws(0)}function _e(){var N=n.getElementsByClassName("selected");if(N.length>0){var q=N[0],se=q.previousElementSibling;if(se&&se.className.indexOf("group")!==-1&&!se.previousElementSibling&&(q=se),q.offsetTop<n.scrollTop)n.scrollTop=q.offsetTop;else{var qe=q.offsetTop+q.offsetHeight,k=n.scrollTop+n.offsetHeight;qe>k&&(n.scrollTop+=qe-k)}}}function Ue(){if(c.length<1)S=void 0;else if(S===c[0])S=c[c.length-1];else for(var N=c.length-1;N>0;N--)if(S===c[N]||N===1){S=c[N-1];break}}function mn(){if(c.length<1&&(S=void 0),!S||S===c[c.length-1]){S=c[0];return}for(var N=0;N<c.length-1;N++)if(S===c[N]){S=c[N+1];break}}function si(N){var q=N.which||N.keyCode||0;if(q===38||q===40||q===27){var se=D();if(q===27)F();else{if(!se||c.length<1)return;q===38?Ue():mn(),W()}N.preventDefault(),se&&N.stopPropagation();return}q===13&&(S&&(e.onSelect(S,m),F()),s&&N.preventDefault())}function Es(){l&&ws(1)}function ws(N){var q=++R,se=m.value,qe=m.selectionStart||0;se.length>=d||N===1?(K(),v=window.setTimeout(function(){e.fetch(se,function(k){R===q&&k&&(c=k,u=se,S=c.length<1||a?void 0:c[0],W())},N,qe)},N===0?o:0)):F()}function Ps(){setTimeout(function(){t.activeElement!==m&&F()},200)}n.addEventListener("mousedown",function(N){N.stopPropagation(),N.preventDefault()}),n.addEventListener("focus",function(){return m.focus()});function oc(){m.removeEventListener("focus",Es),m.removeEventListener("keydown",si),m.removeEventListener("keyup",le),m.removeEventListener("blur",Ps),window.removeEventListener("resize",oe),t.removeEventListener("scroll",we,!0),m.removeAttribute("role"),m.removeAttribute("aria-expanded"),m.removeAttribute("aria-autocomplete"),m.removeAttribute("aria-controls"),m.removeAttribute("aria-activedescendant"),m.removeAttribute("aria-owns"),m.removeAttribute("aria-haspopup"),K(),F()}return m.addEventListener("keydown",si),m.addEventListener("keyup",le),m.addEventListener("blur",Ps),m.addEventListener("focus",Es),window.addEventListener("resize",oe),t.addEventListener("scroll",we,!0),{destroy:oc}}return i})});var Np=f(Jt=>{"use strict";var To=Jt&&Jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ca=Jt&&Jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},hx=Jt&&Jt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},dd;Object.defineProperty(Jt,"__esModule",{value:!0});Jt.CommandPaletteKeyListener=Jt.CommandPalette=void 0;var Ao=_(),px=te(),gx=uc(),ld=P(),mx=Ru(),HS=Ks(),yx=oo(),_x=sn(),zS=Ap(),Dp=er(),jp=In(),YS=ae(),US=bt(),vx=ud(),kS=Mt(),bx=hx(KS()),At=dd=class extends mx.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,zS.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return dd.ID}containerClass(){return"command-palette"}show(e,...t){super.show(e,...t),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,bx.default)(this.autocompleteSettings(e)),this.inputElement.focus()}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",t=>this.hideIfEscapeEvent(t)),this.inputElement.addEventListener("keydown",t=>this.cylceIfInvokePaletteKey(t)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),e.appendChild(this.inputElement)}hideIfEscapeEvent(e){(0,jp.matchesKeystroke)(e,"Escape")&&this.hide()}cylceIfInvokePaletteKey(e){dd.isInvokePaletteKey(e)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(e,t,...n){let r=this.xOffset,o=this.yOffset,s=(0,Dp.toArray)(t.index.all().filter(a=>(0,US.isSelectable)(a)&&a.selected));if(s.length===1){let a=(0,YS.getAbsoluteClientBounds)(s[0],this.domHelper,this.viewerOptions);r+=a.x+a.width,o+=a.y}else{let a=(0,YS.getAbsoluteClientBounds)(t,this.domHelper,this.viewerOptions);r+=a.x,o+=a.y}e.style.left=`${r}px`,e.style.top=`${o}px`,e.style.width=`${this.defaultWidth}px`}autocompleteSettings(e){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(t,n)=>this.updateAutoCompleteActions(n,t,e),onSelect:t=>this.onSelect(t),render:(t,n)=>this.renderLabeledActionSuggestion(t,n),customize:(t,n,r,o)=>{this.customizeSuggestionContainer(r,n,o)}}}onSelect(e){this.executeAction(e),this.hide()}updateAutoCompleteActions(e,t,n){this.onLoading(),this.contextActions?(e(this.filterActions(t,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(n,t,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(r=>{this.contextActions=r,e(this.filterActions(t,r)),this.onLoaded("success")}).catch(r=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",r),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(e){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(e,t){let n=document.createElement("div"),r=Ex(t).split(" ").join("|"),o=new RegExp(r,"gi");return e.icon&&this.renderIcon(n,e.icon),t.length>0?n.innerHTML+=e.label.replace(o,s=>"<em>"+s+"</em>").replace(/ /g,"&nbsp;"):n.innerHTML+=e.label.replace(/ /g,"&nbsp;"),n}renderIcon(e,t){e.innerHTML+=`<span class="icon ${this.getCodicon(t)}"></span>`}getFontAwesomeIcon(e){return`fa fa-${e}`}getCodicon(e){return(0,zS.codiconCSSString)(e)}filterActions(e,t){return(0,Dp.toArray)(t.filter(n=>{let r=n.label.toLowerCase();return e.split(" ").every(s=>r.indexOf(s.toLowerCase())!==-1)}))}customizeSuggestionContainer(e,t,n){this.containerElement&&this.containerElement.appendChild(e)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(e){this.actionDispatcherProvider().then(t=>t.dispatchAll(Sx(e))).catch(t=>this.logger.error(this,"No action dispatcher available to execute command palette action",t))}};At.ID="command-palette";At.isInvokePaletteKey=i=>(0,jp.matchesKeystroke)(i,"Space","ctrl");To([(0,Ao.inject)(ld.TYPES.IActionDispatcherProvider),ca("design:type",Function)],At.prototype,"actionDispatcherProvider",void 0);To([(0,Ao.inject)(ld.TYPES.ICommandPaletteActionProviderRegistry),ca("design:type",vx.CommandPaletteActionProviderRegistry)],At.prototype,"actionProviderRegistry",void 0);To([(0,Ao.inject)(ld.TYPES.ViewerOptions),ca("design:type",Object)],At.prototype,"viewerOptions",void 0);To([(0,Ao.inject)(ld.TYPES.DOMHelper),ca("design:type",yx.DOMHelper)],At.prototype,"domHelper",void 0);To([(0,Ao.inject)(kS.MousePositionTracker),ca("design:type",kS.MousePositionTracker)],At.prototype,"mousePositionTracker",void 0);At=dd=To([(0,Ao.injectable)()],At);Jt.CommandPalette=At;function Sx(i){return(0,gx.isLabeledAction)(i)?i.actions:(0,px.isAction)(i)?[i]:[]}function Ex(i){return i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var qp=class extends _x.KeyListener{keyDown(e,t){if((0,jp.matchesKeystroke)(t,"Escape"))return[HS.SetUIExtensionVisibilityAction.create({extensionId:At.ID,visible:!1,contextElementsId:[]})];if(At.isInvokePaletteKey(t)){let n=(0,Dp.toArray)(e.index.all().filter(r=>(0,US.isSelectable)(r)&&r.selected).map(r=>r.id));return[HS.SetUIExtensionVisibilityAction.create({extensionId:At.ID,visible:!0,contextElementsId:n})]}return[]}};Jt.CommandPaletteKeyListener=qp});var GS=f(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.toAnchor=void 0;function wx(i){return i instanceof HTMLElement?{x:i.offsetLeft,y:i.offsetTop}:i}fd.toAnchor=wx});var Co=f(Re=>{"use strict";var Px=Re&&Re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ix=Re&&Re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Rx=Re&&Re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Re,"__esModule",{value:!0});Re.DeleteElementCommand=Re.ResolvedDelete=Re.DeleteElementAction=Re.isDeletable=Re.deletableFeature=void 0;var WS=_(),Mx=pe(),Ox=G(),Tx=P();Re.deletableFeature=Symbol("deletableFeature");function $S(i){return i instanceof Ox.SChildElement&&i.hasFeature(Re.deletableFeature)}Re.isDeletable=$S;var XS;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(XS=Re.DeleteElementAction||(Re.DeleteElementAction={}));var Lp=class{};Re.ResolvedDelete=Lp;var hd=class extends Mx.Command{constructor(e){super(),this.action=e,this.resolvedDeletes=[]}execute(e){let t=e.root.index;for(let n of this.action.elementIds){let r=t.getById(n);r&&$S(r)&&(this.resolvedDeletes.push({child:r,parent:r.parent}),r.parent.remove(r))}return e.root}undo(e){for(let t of this.resolvedDeletes)t.parent.add(t.child);return e.root}redo(e){for(let t of this.resolvedDeletes)t.parent.remove(t.child);return e.root}};hd.KIND=XS.KIND;hd=Px([(0,WS.injectable)(),Rx(0,(0,WS.inject)(Tx.TYPES.Action)),Ix("design:paramtypes",[Object])],hd);Re.DeleteElementCommand=hd});var gd=f(Zt=>{"use strict";var ZS=Zt&&Zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ax=Zt&&Zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},JS=Zt&&Zt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.DeleteContextMenuItemProvider=Zt.ContextMenuProviderRegistry=void 0;var pd=_(),Cx=P(),xx=Co(),Dx=bt(),qx=cr(),Bp=class{constructor(e=[]){this.menuProviders=e}getItems(e,t){let n=this.menuProviders.map(r=>r.getItems(e,t));return Promise.all(n).then(this.flattenAndRestructure)}flattenAndRestructure(e){let t=e.reduce((r,o)=>o!==void 0?r.concat(o):r,[]),n=t.filter(r=>r.parentId);for(let r of n)if(r.parentId){let o=r.parentId.split("."),s,a=t;for(let c of o)s=a.find(u=>c===u.id),s&&s.children&&(a=s.children);s&&(s.children?s.children.push(r):s.children=[r],t=t.filter(c=>c!==r))}return t}};Bp=ZS([(0,pd.injectable)(),JS(0,(0,pd.multiInject)(Cx.TYPES.IContextMenuItemProvider)),JS(0,(0,pd.optional)()),Ax("design:paramtypes",[Array])],Bp);Zt.ContextMenuProviderRegistry=Bp;var Fp=class{getItems(e,t){let n=Array.from(e.index.all().filter(Dx.isSelected).filter(xx.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[qx.DeleteElementAction.create(n.map(r=>r.id))],isEnabled:()=>n.length>0}])}};Fp=ZS([(0,pd.injectable)()],Fp);Zt.DeleteContextMenuItemProvider=Fp});var Hp=f(On=>{"use strict";var e0=On&&On.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},t0=On&&On.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},QS=On&&On.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(On,"__esModule",{value:!0});On.ContextMenuMouseListener=void 0;var Vp=_(),jx=te(),Nx=gd(),Lx=Mt(),Kp=P(),md=bt(),Bx=Ke(),yd=class extends Lx.MouseListener{constructor(e,t){super(),this.contextMenuService=e,this.menuProvider=t}contextMenu(e,t){return this.showContextMenu(e,t),[]}async showContextMenu(e,t){let n;try{n=await this.contextMenuService()}catch{return}let r={x:t.x,y:t.y},o=e.root,s=e.id,a=!1,c=(0,Bx.findParentByFeature)(e,md.isSelectable);c&&(a=c.selected,c.selected=!0);let u=()=>{c&&(c.selected=a)};if((0,md.isSelectable)(e))if((0,md.isSelected)(e)){let d=await this.menuProvider.getItems(e.root,r);n.show(d,r,u)}else{let d={selectedElementsIDs:[s],deselectedElementsIDs:Array.from(o.index.all().filter(md.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(jx.SelectAction.create(d));let l=await this.menuProvider.getItems(o,r);n.show(l,r)}}};e0([(0,Vp.inject)(Kp.TYPES.IActionDispatcher),t0("design:type",Object)],yd.prototype,"actionDispatcher",void 0);yd=e0([QS(0,(0,Vp.inject)(Kp.TYPES.IContextMenuServiceProvider)),QS(1,(0,Vp.inject)(Kp.TYPES.IContextMenuProviderRegistry)),t0("design:paramtypes",[Function,Nx.ContextMenuProviderRegistry])],yd);On.ContextMenuMouseListener=yd});var _r=f(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.hasPopupFeature=Qt.popupFeature=Qt.isHoverable=Qt.hoverFeedbackFeature=void 0;Qt.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function Fx(i){return i.hasFeature(Qt.hoverFeedbackFeature)}Qt.isHoverable=Fx;Qt.popupFeature=Symbol("popupFeature");function Vx(i){return i.hasFeature(Qt.popupFeature)}Qt.hasPopupFeature=Vx});var Oi=f(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.isMoveable=Qn.isLocateable=Qn.moveFeature=void 0;Qn.moveFeature=Symbol("moveFeature");function n0(i){return i.position!==void 0}Qn.isLocateable=n0;function Kx(i){return i.hasFeature(Qn.moveFeature)&&n0(i)}Qn.isMoveable=Kx});var me=f(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.edgeInProgressTargetHandleID=fe.edgeInProgressID=fe.SDanglingAnchor=fe.SRoutingHandle=fe.SConnectableElement=fe.getRouteBounds=fe.getAbsoluteRouteBounds=fe.isConnectable=fe.connectableFeature=fe.SRoutableElement=void 0;var i0=Q(),zp=G(),Hx=ae(),zx=Co(),Yx=bt(),kx=_r(),Ux=Oi(),ua=class extends zp.SChildElement{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((e,t)=>i0.Bounds.combine(e,{x:t.x,y:t.y,width:0,height:0}),i0.Bounds.EMPTY)}};fe.SRoutableElement=ua;fe.connectableFeature=Symbol("connectableFeature");function Gx(i){return i.hasFeature(fe.connectableFeature)&&i.canConnect}fe.isConnectable=Gx;function Wx(i,e=i.routingPoints){let t=r0(e),n=i;for(;n instanceof zp.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}fe.getAbsoluteRouteBounds=Wx;function r0(i){let e={x:NaN,y:NaN,width:0,height:0};for(let t of i)isNaN(e.x)?(e.x=t.x,e.y=t.y):(t.x<e.x?(e.width+=e.x-t.x,e.x=t.x):t.x>e.x+e.width&&(e.width=t.x-e.x),t.y<e.y?(e.height+=e.y-t.y,e.y=t.y):t.y>e.y+e.height&&(e.height=t.y-e.y));return e}fe.getRouteBounds=r0;var _d=class extends Hx.SShapeElement{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(t=>t instanceof ua).filter(t=>t.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(t=>t instanceof ua).filter(t=>t.sourceId===this.id)}canConnect(e,t){return!0}};fe.SConnectableElement=_d;var xo=class extends zp.SChildElement{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(e){return xo.DEFAULT_FEATURES.indexOf(e)!==-1}};fe.SRoutingHandle=xo;xo.DEFAULT_FEATURES=[Yx.selectFeature,Ux.moveFeature,kx.hoverFeedbackFeature];var vd=class extends _d{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}};fe.SDanglingAnchor=vd;vd.DEFAULT_FEATURES=[zx.deletableFeature];fe.edgeInProgressID="edge-in-progress";fe.edgeInProgressTargetHandleID=fe.edgeInProgressID+"-target-anchor"});var Do=f(un=>{"use strict";Object.defineProperty(un,"__esModule",{value:!0});un.DEFAULT_EDGE_PLACEMENT=un.EdgePlacement=un.isEdgeLayoutable=un.edgeLayoutFeature=void 0;var $x=G(),Xx=ae(),Jx=me();un.edgeLayoutFeature=Symbol("edgeLayout");function Zx(i){return i instanceof $x.SChildElement&&i.parent instanceof Jx.SRoutableElement&&Qx(i)&&(0,Xx.isBoundsAware)(i)&&i.hasFeature(un.edgeLayoutFeature)}un.isEdgeLayoutable=Zx;function Qx(i){return"edgePlacement"in i}var Yp=class extends Object{};un.EdgePlacement=Yp;un.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}});var qo=f(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.isWithEditableLabel=He.withEditLabelFeature=He.isEditableLabel=He.editLabelFeature=He.canEditRouting=He.editFeature=void 0;var e1=me();He.editFeature=Symbol("editFeature");function t1(i){return i instanceof e1.SRoutableElement&&i.hasFeature(He.editFeature)}He.canEditRouting=t1;He.editLabelFeature=Symbol("editLabelFeature");function n1(i){return"text"in i&&i.hasFeature(He.editLabelFeature)}He.isEditableLabel=n1;He.withEditLabelFeature=Symbol("withEditLabelFeature");function i1(i){return"editableLabel"in i&&i.hasFeature(He.withEditLabelFeature)}He.isWithEditableLabel=i1});var Tn=f(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.isViewport=vr.viewportFeature=void 0;var r1=G();vr.viewportFeature=Symbol("viewportFeature");function o1(i){return i instanceof r1.SModelRoot&&i.hasFeature(vr.viewportFeature)&&"zoom"in i&&"scroll"in i}vr.isViewport=o1});var bd=f(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.isExportable=br.exportFeature=void 0;br.exportFeature=Symbol("exportFeature");function s1(i){return i.hasFeature(br.exportFeature)}br.isExportable=s1});var wd=f(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});Ed.ViewportRootElement=void 0;var da=Q(),a1=G(),c1=Tn(),u1=bd(),Sd=class extends a1.SModelRoot{constructor(e){super(e),this.scroll={x:0,y:0},this.zoom=1,this.position=da.Point.ORIGIN,this.size=da.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:(e.x-this.scroll.x)*this.zoom,y:(e.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,da.isBounds)(e)&&(t.width=e.width*this.zoom,t.height=e.height*this.zoom),t}parentToLocal(e){let t={x:e.x/this.zoom+this.scroll.x,y:e.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,da.isBounds)(e)&&da.Dimension.isValid(e)&&(t.width=e.width/this.zoom,t.height=e.height/this.zoom),t}};Ed.ViewportRootElement=Sd;Sd.DEFAULT_FEATURES=[c1.viewportFeature,u1.exportFeature]});var Sr=f(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.SGraphIndex=tt.SCompartment=tt.SLabel=tt.SEdge=tt.SPort=tt.SNode=tt.SGraph=void 0;var d1=Q(),l1=G(),dn=ae(),f1=Do(),o0=Co(),h1=qo(),fa=Oo(),Pd=_r(),p1=Oi(),ha=me(),Up=bt(),g1=wd(),m1=er(),kp=class extends g1.ViewportRootElement{constructor(e=new Ti){super(e)}};tt.SGraph=kp;var Id=class extends ha.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(e,t){return this.children.find(n=>n instanceof la)===void 0}get incomingEdges(){let e=this.index;return e instanceof Ti?e.getIncomingEdges(this):this.index.all().filter(n=>n instanceof An).filter(n=>n.targetId===this.id)}get outgoingEdges(){let e=this.index;return e instanceof Ti?e.getOutgoingEdges(this):this.index.all().filter(n=>n instanceof An).filter(n=>n.sourceId===this.id)}};tt.SNode=Id;Id.DEFAULT_FEATURES=[ha.connectableFeature,o0.deletableFeature,Up.selectFeature,dn.boundsFeature,p1.moveFeature,dn.layoutContainerFeature,fa.fadeFeature,Pd.hoverFeedbackFeature,Pd.popupFeature];var la=class extends ha.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){let e=this.index;return e instanceof Ti?e.getIncomingEdges(this):super.incomingEdges.filter(t=>t instanceof An)}get outgoingEdges(){let e=this.index;return e instanceof Ti?e.getOutgoingEdges(this):super.outgoingEdges.filter(t=>t instanceof An)}};tt.SPort=la;la.DEFAULT_FEATURES=[ha.connectableFeature,Up.selectFeature,dn.boundsFeature,fa.fadeFeature,Pd.hoverFeedbackFeature];var An=class extends ha.SRoutableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}};tt.SEdge=An;An.DEFAULT_FEATURES=[h1.editFeature,o0.deletableFeature,Up.selectFeature,fa.fadeFeature,Pd.hoverFeedbackFeature];var Rd=class extends dn.SShapeElement{constructor(){super(...arguments),this.selected=!1,this.alignment=d1.Point.ORIGIN,this.opacity=1}};tt.SLabel=Rd;Rd.DEFAULT_FEATURES=[dn.boundsFeature,dn.alignFeature,dn.layoutableChildFeature,f1.edgeLayoutFeature,fa.fadeFeature];var Md=class extends dn.SShapeElement{constructor(){super(...arguments),this.opacity=1}};tt.SCompartment=Md;Md.DEFAULT_FEATURES=[dn.boundsFeature,dn.layoutContainerFeature,dn.layoutableChildFeature,fa.fadeFeature];var Ti=class extends l1.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(e){if(super.add(e),e instanceof An){if(e.sourceId){let t=this.outgoing.get(e.sourceId);t===void 0?this.outgoing.set(e.sourceId,[e]):t.push(e)}if(e.targetId){let t=this.incoming.get(e.targetId);t===void 0?this.incoming.set(e.targetId,[e]):t.push(e)}}}remove(e){if(super.remove(e),e instanceof An){let t=this.outgoing.get(e.sourceId);if(t!==void 0){let r=t.indexOf(e);r>=0&&(t.length===1?this.outgoing.delete(e.sourceId):t.splice(r,1))}let n=this.incoming.get(e.targetId);if(n!==void 0){let r=n.indexOf(e);r>=0&&(n.length===1?this.incoming.delete(e.targetId):n.splice(r,1))}}}getAttachedElements(e){return new m1.FluentIterableImpl(()=>({outgoing:this.outgoing.get(e.id),incoming:this.incoming.get(e.id),nextOutgoingIndex:0,nextIncomingIndex:0}),t=>{let n=t.nextOutgoingIndex;if(t.outgoing!==void 0&&n<t.outgoing.length)return t.nextOutgoingIndex=n+1,{done:!1,value:t.outgoing[n]};if(n=t.nextIncomingIndex,t.incoming!==void 0)for(;n<t.incoming.length;){let r=t.incoming[n];if(r.sourceId!==r.targetId)return t.nextIncomingIndex=n+1,{done:!1,value:r};n++}return{done:!0,value:void 0}})}getIncomingEdges(e){return this.incoming.get(e.id)||[]}getOutgoingEdges(e){return this.outgoing.get(e.id)||[]}};tt.SGraphIndex=Ti});var ei=f(ze=>{"use strict";var y1=ze&&ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_1=ze&&ze.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},v1=ze&&ze.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ze,"__esModule",{value:!0});ze.AnchorComputerRegistry=ze.RECTANGULAR_ANCHOR_KIND=ze.ELLIPTIC_ANCHOR_KIND=ze.DIAMOND_ANCHOR_KIND=void 0;var s0=_(),b1=P(),S1=En();ze.DIAMOND_ANCHOR_KIND="diamond";ze.ELLIPTIC_ANCHOR_KIND="elliptic";ze.RECTANGULAR_ANCHOR_KIND="rectangular";var Gp=class extends S1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultAnchorKind(){return ze.RECTANGULAR_ANCHOR_KIND}get(e,t){return super.get(`${e}:${t||this.defaultAnchorKind}`)}};Gp=y1([(0,s0.injectable)(),v1(0,(0,s0.multiInject)(b1.TYPES.IAnchorComputer)),_1("design:paramtypes",[Array])],Gp);ze.AnchorComputerRegistry=Gp});var ga=f(Ct=>{"use strict";var u0=Ct&&Ct.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},E1=Ct&&Ct.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.AbstractEdgeRouter=Ct.DefaultAnchors=Ct.Side=void 0;var d0=_(),jo=Q(),Wp=Ke(),St=me(),a0=ei(),c0=me(),ee;(function(i){i[i.RIGHT=0]="RIGHT",i[i.LEFT=1]="LEFT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM"})(ee=Ct.Side||(Ct.Side={}));var pa=class{constructor(e,t,n){this.element=e,this.kind=n;let r=e.bounds;this.bounds=(0,Wp.translateBounds)(r,e.parent,t),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:n},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:n},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:n},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:n}}get(e){return this[ee[e].toLowerCase()]}getNearestSide(e){let t=jo.Point.euclideanDistance(e,this.left),n=jo.Point.euclideanDistance(e,this.right),r=jo.Point.euclideanDistance(e,this.top),o=jo.Point.euclideanDistance(e,this.bottom),s=ee.LEFT,a=t;return n<a&&(a=n,s=ee.RIGHT),r<a&&(a=r,s=ee.TOP),o<a&&(a=o,s=ee.BOTTOM),s}};Ct.DefaultAnchors=pa;var Od=class{pointAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o,lambda:s}=n;return jo.Point.linear(r,o,s)}derivativeAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o}=n;return{x:o.x-r.x,y:o.y-r.y}}calculateSegment(e,t){if(t<0||t>1)return;let n=this.route(e);if(n.length<2)return;let r=[],o=0;for(let c=0;c<n.length-1;++c)r[c]=jo.Point.euclideanDistance(n[c],n[c+1]),o+=r[c];let s=0,a=t*o;for(let c=0;c<n.length-1;++c){let u=s+r[c];if(r[c]>1e-8&&u>=a){let d=Math.max(0,a-s)/r[c];return{segmentStart:n[c],segmentEnd:n[c+1],lambda:d}}s=u}return{segmentEnd:n.pop(),segmentStart:n.pop(),lambda:1}}addHandle(e,t,n,r){let o=new St.SRoutingHandle;return o.kind=t,o.pointIndex=r,o.type=n,t==="target"&&e.id===St.edgeInProgressID&&(o.id=St.edgeInProgressTargetHandleID),e.add(o),o}getHandlePosition(e,t,n){switch(n.kind){case"source":return e.source instanceof St.SDanglingAnchor?e.source.position:t[0];case"target":return e.target instanceof St.SDanglingAnchor?e.target.position:t[t.length-1];default:let r=this.getInnerHandlePosition(e,t,n);if(r!==void 0)return r;if(n.pointIndex>=0&&n.pointIndex<e.routingPoints.length)return e.routingPoints[n.pointIndex]}}findRouteSegment(e,t,n){let r=a=>a.pointIndex!==void 0?a.pointIndex:a.kind==="target"?e.routingPoints.length:-2,o,s;for(let a of t){let c=r(a);c<=n&&(o===void 0||c>r(o))&&(o=a),c>n&&(s===void 0||c<r(s))&&(s=a)}return{start:o,end:s}}getTranslatedAnchor(e,t,n,r,o=0){let s=(0,Wp.translatePoint)(t,n,e.parent),a=this.getAnchorComputer(e),c=.5*e.strokeWidth,u=a.getAnchor(e,s,o+c);return(0,Wp.translatePoint)(u,e.parent,r.parent)}getAnchorComputer(e){return this.anchorRegistry.get(this.kind,e.anchorKind)}applyHandleMoves(e,t){let n=t.slice();t.forEach(r=>{let o=r.handle;if(o.kind==="source"&&!(e.source instanceof St.SDanglingAnchor)){let s=new St.SDanglingAnchor;s.id=e.id+"_dangling-source",s.original=e.source,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.sourceId=s.id}else if(o.kind==="target"&&!(e.target instanceof St.SDanglingAnchor)){let s=new St.SDanglingAnchor;s.id=e.id+"_dangling-target",s.original=e.target,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.targetId=s.id}o.danglingAnchor&&(o.danglingAnchor.position=r.toPosition,n.splice(n.indexOf(r),1))}),n.length>0&&this.applyInnerHandleMoves(e,n),this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)}cleanupRoutingPoints(e,t,n,r){let o=new pa(e.source,e.parent,"source"),s=new pa(e.target,e.parent,"target");this.resetRoutingPointsOnReconnect(e,t,n,o,s)}resetRoutingPointsOnReconnect(e,t,n,r,o){if(t.length===0||e.source instanceof St.SDanglingAnchor||e.target instanceof St.SDanglingAnchor){let s=this.getOptions(e),a=this.calculateDefaultCorners(e,r,o,s);if(t.splice(0,t.length,...a),n){let c=-2;e.children.forEach(u=>{u instanceof St.SRoutingHandle&&(u.kind==="target"?u.pointIndex=t.length:u.kind==="line"&&u.pointIndex>=t.length?e.remove(u):c=Math.max(u.pointIndex,c))});for(let u=c;u<t.length-1;++u)this.addHandle(e,"manhattan-50%","volatile-routing-point",u)}return!0}return!1}applyReconnect(e,t,n){let r=!1;if(t){let o=e.root.index.getById(t);o instanceof c0.SConnectableElement&&(e.sourceId=o.id,r=!0)}if(n){let o=e.root.index.getById(n);o instanceof c0.SConnectableElement&&(e.targetId=o.id,r=!0)}r&&(e.index.remove(e),e.index.add(e),this.getSelfEdgeIndex(e)>-1&&(e.routingPoints=[],this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)))}takeSnapshot(e){return{routingPoints:e.routingPoints.slice(),routingHandles:e.children.filter(t=>t instanceof St.SRoutingHandle).map(t=>t),routedPoints:this.route(e),router:this,source:e.source,target:e.target}}applySnapshot(e,t){e.routingPoints=t.routingPoints,e.removeAll(n=>n instanceof St.SRoutingHandle),e.routerKind=t.router.kind,t.routingHandles.forEach(n=>e.add(n)),t.source&&(e.sourceId=t.source.id),t.target&&(e.targetId=t.target.id),e.root.index.remove(e),e.root.index.add(e)}calculateDefaultCorners(e,t,n,r){let o=this.getSelfEdgeIndex(e);if(o>=0){let s=r.standardDistance,a=r.selfEdgeOffset*Math.min(t.bounds.width,t.bounds.height);switch(o%4){case 0:return[{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y+a},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.BOTTOM).x+a,y:t.get(ee.BOTTOM).y+s}];case 1:return[{x:t.get(ee.BOTTOM).x-a,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y+a}];case 2:return[{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y-a},{x:t.get(ee.LEFT).x-s,y:t.get(ee.TOP).y-s},{x:t.get(ee.TOP).x-a,y:t.get(ee.TOP).y-s}];case 3:return[{x:t.get(ee.TOP).x+a,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y-a}]}}return[]}getSelfEdgeIndex(e){return!e.source||e.source!==e.target?-1:e.source.outgoingEdges.filter(t=>t.target===e.source).indexOf(e)}commitRoute(e,t){let n=[];for(let r=1;r<t.length-1;++r)n.push({x:t[r].x,y:t[r].y});e.routingPoints=n}};u0([(0,d0.inject)(a0.AnchorComputerRegistry),E1("design:type",a0.AnchorComputerRegistry)],Od.prototype,"anchorRegistry",void 0);Od=u0([(0,d0.injectable)()],Od);Ct.AbstractEdgeRouter=Od});var ya=f(Ai=>{"use strict";var h0=Ai&&Ai.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},w1=Ai&&Ai.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},$p;Object.defineProperty(Ai,"__esModule",{value:!0});Ai.PolylineEdgeRouter=void 0;var p0=_(),No=Q(),l0=me(),f0=ei(),P1=ga(),ma=$p=class extends P1.AbstractEdgeRouter{get kind(){return $p.KIND}getOptions(e){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(e){let t=e.source,n=e.target;if(t===void 0||n===void 0)return[];let r,o,s=this.getOptions(e),a=e.routingPoints.length>0?e.routingPoints:[];this.cleanupRoutingPoints(e,a,!1,!1);let c=a!==void 0?a.length:0;if(c===0){let d=No.Bounds.center(n.bounds);r=this.getTranslatedAnchor(t,d,n.parent,e,e.sourceAnchorCorrection);let l=No.Bounds.center(t.bounds);o=this.getTranslatedAnchor(n,l,t.parent,e,e.targetAnchorCorrection)}else{let d=a[0];r=this.getTranslatedAnchor(t,d,e.parent,e,e.sourceAnchorCorrection);let l=a[c-1];o=this.getTranslatedAnchor(n,l,e.parent,e,e.targetAnchorCorrection)}let u=[];u.push({kind:"source",x:r.x,y:r.y});for(let d=0;d<c;d++){let l=a[d];(d>0&&d<c-1||d===0&&No.Point.maxDistance(r,l)>=s.minimalPointDistance+(e.sourceAnchorCorrection||0)||d===c-1&&No.Point.maxDistance(l,o)>=s.minimalPointDistance+(e.targetAnchorCorrection||0))&&u.push({kind:"linear",x:l.x,y:l.y,pointIndex:d})}return u.push({kind:"target",x:o.x,y:o.y}),this.filterEditModeHandles(u,e,s)}filterEditModeHandles(e,t,n){if(t.children.length===0)return e;let r=0;for(;r<e.length;){let o=e[r];if(o.pointIndex!==void 0){let s=t.children.find(a=>a instanceof l0.SRoutingHandle&&a.kind==="junction"&&a.pointIndex===o.pointIndex);if(s!==void 0&&s.editMode&&r>0&&r<e.length-1){let a=e[r-1],c=e[r+1],u={x:a.x-o.x,y:a.y-o.y},d={x:c.x-o.x,y:c.y-o.y},l=(0,No.angleBetweenPoints)(u,d);if(Math.abs(Math.PI-l)<n.removeAngleThreshold){e.splice(r,1);continue}}}r++}return e}createRoutingHandles(e){let t=e.routingPoints.length;this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"line","volatile-routing-point",-1);for(let n=0;n<t;n++)this.addHandle(e,"junction","routing-point",n),this.addHandle(e,"line","volatile-routing-point",n);this.addHandle(e,"target","routing-point",t)}getInnerHandlePosition(e,t,n){if(n.kind==="line"){let{start:r,end:o}=this.findRouteSegment(e,t,n.pointIndex);if(r!==void 0&&o!==void 0)return(0,No.centerOfLine)(r,o)}}applyInnerHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o=e.routingPoints,s=r.pointIndex;r.kind==="line"&&(r.kind="junction",r.type="routing-point",o.splice(s+1,0,n.fromPosition||o[Math.max(s,0)]),e.children.forEach(a=>{a instanceof l0.SRoutingHandle&&(a===r||a.pointIndex>s)&&a.pointIndex++}),this.addHandle(e,"line","volatile-routing-point",s),s++,this.addHandle(e,"line","volatile-routing-point",s)),s>=0&&s<o.length&&(o[s]=n.toPosition)})}};ma.KIND="polyline";h0([(0,p0.inject)(f0.AnchorComputerRegistry),w1("design:type",f0.AnchorComputerRegistry)],ma.prototype,"anchorRegistry",void 0);ma=$p=h0([(0,p0.injectable)()],ma);Ai.PolylineEdgeRouter=ma});var ln=f(en=>{"use strict";var g0=en&&en.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},m0=en&&en.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},I1=en&&en.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(en,"__esModule",{value:!0});en.EdgeRouting=en.EdgeRouterRegistry=void 0;var Td=_(),R1=G(),y0=P(),M1=uo(),O1=En(),T1=me(),A1=ya();function C1(i){return i.routeAll!==void 0}var Ad=class extends O1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultKind(){return A1.PolylineEdgeRouter.KIND}get(e){return super.get(e||this.defaultKind)}routeAllChildren(e){let t=this.doRouteAllChildren(e);for(let n of this.postProcessors)n.apply(t);return t}doRouteAllChildren(e){let t=new Cd,n=new Map,r=[e];for(;r.length>0;){let o=r.shift();for(let s of o.children){if(s instanceof T1.SRoutableElement){let a=s.routerKind||this.defaultKind;n.has(a)?n.get(a).push(s):n.set(a,[s])}s instanceof R1.SParentElement&&r.push(s)}}return n.forEach((o,s)=>{let a=this.get(s);if(C1(a))t.setAll(a.routeAll(o,e));else for(let c of o)t.set(c.id,this.route(c))}),t}route(e,t){let n=(0,M1.findArgValue)(t,"edgeRouting");if(n){let o=n.get(e.id);if(o)return o}return this.get(e.routerKind).route(e)}};g0([(0,Td.multiInject)(y0.TYPES.IEdgeRoutePostprocessor),(0,Td.optional)(),m0("design:type",Array)],Ad.prototype,"postProcessors",void 0);Ad=g0([(0,Td.injectable)(),I1(0,(0,Td.multiInject)(y0.TYPES.IEdgeRouter)),m0("design:paramtypes",[Array])],Ad);en.EdgeRouterRegistry=Ad;var Cd=class{constructor(){this.routesMap=new Map}set(e,t){this.routesMap.set(e,t)}setAll(e){e.routes.forEach((t,n)=>this.set(n,t))}get(e){return this.routesMap.get(e)}get routes(){return this.routesMap}};en.EdgeRouting=Cd});var Xp=f(Ci=>{"use strict";var b0=Ci&&Ci.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},x1=Ci&&Ci.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.EdgeLayoutPostprocessor=void 0;var S0=_(),nt=Q(),D1=G(),q1=Ne(),j1=Sr(),xd=ae(),_0=Do(),v0=ln(),Dd=class{decorate(e,t){if((0,_0.isEdgeLayoutable)(t)&&t.parent instanceof j1.SEdge&&t.bounds!==nt.Bounds.EMPTY){let n=this.getEdgePlacement(t),r=t.parent,o=Math.min(1,Math.max(0,n.position)),s=this.edgeRouterRegistry.get(r.routerKind),a=s.pointAt(r,o),c=s.derivativeAt(r,o),u="";if(a&&c){u+=`translate(${a.x}, ${a.y})`;let d=(0,nt.toDegrees)(Math.atan2(c.y,c.x));if(n.rotate){let l=d;Math.abs(d)>90&&(d<0?l+=180:d>0&&(l-=180)),u+=` rotate(${l})`;let S=this.getRotatedAlignment(t,n,l!==d);u+=` translate(${S.x}, ${S.y})`}else{let l=this.getAlignment(t,n,d);u+=` translate(${l.x}, ${l.y})`}(0,q1.setAttr)(e,"transform",u)}}return e}getRotatedAlignment(e,t,n){let r=(0,xd.isAlignable)(e)?e.alignment.x:0,o=(0,xd.isAlignable)(e)?e.alignment.y:0,s=e.bounds;if(t.side==="on")return{x:r-.5*s.height,y:o-.5*s.height};if(n)switch(t.position<.3333333?r-=s.width+t.offset:t.position<.6666666?r-=.5*s.width:r+=t.offset,t.side){case"left":case"bottom":o-=t.offset+s.height;break;case"right":case"top":o+=t.offset}else switch(t.position<.3333333?r+=t.offset:t.position<.6666666?r-=.5*s.width:r-=s.width+t.offset,t.side){case"right":case"bottom":o+=-t.offset-s.height;break;case"left":case"top":o+=t.offset}return{x:r,y:o}}getEdgePlacement(e){let t=e,n=[];for(;t!==void 0;){let r=t.edgePlacement;if(r!==void 0&&n.push(r),t instanceof D1.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>Object.assign(Object.assign({},r),o),_0.DEFAULT_EDGE_PLACEMENT)}getAlignment(e,t,n){let r=e.bounds,o=(0,xd.isAlignable)(e)?e.alignment.x-r.width:0,s=(0,xd.isAlignable)(e)?e.alignment.y-r.height:0;if(t.side==="on")return{x:o+.5*r.height,y:s+.5*r.height};let a=this.getQuadrant(n),c={x:t.offset,y:s+.5*r.height},u={x:t.offset,y:s+r.height+t.offset},d={x:-r.width-t.offset,y:s+r.height+t.offset},l={x:-r.width-t.offset,y:s+.5*r.height},S={x:-r.width-t.offset,y:s-t.offset},R={x:t.offset,y:s-t.offset};switch(t.side){case"left":switch(a.orientation){case"west":return nt.Point.linear(u,d,a.position);case"north":return nt.Point.linear(d,S,a.position);case"east":return nt.Point.linear(S,R,a.position);case"south":return nt.Point.linear(R,u,a.position)}break;case"right":switch(a.orientation){case"west":return nt.Point.linear(S,R,a.position);case"north":return nt.Point.linear(R,u,a.position);case"east":return nt.Point.linear(u,d,a.position);case"south":return nt.Point.linear(d,S,a.position)}break;case"top":switch(a.orientation){case"west":return nt.Point.linear(S,R,a.position);case"north":return this.linearFlip(R,c,l,S,a.position);case"east":return nt.Point.linear(S,R,a.position);case"south":return this.linearFlip(R,c,l,S,a.position)}break;case"bottom":switch(a.orientation){case"west":return nt.Point.linear(u,d,a.position);case"north":return this.linearFlip(d,l,c,u,a.position);case"east":return nt.Point.linear(u,d,a.position);case"south":return this.linearFlip(d,l,c,u,a.position)}break}return{x:0,y:0}}getQuadrant(e){return Math.abs(e)>135?{orientation:"west",position:(e>0?e-135:e+225)/90}:e<-45?{orientation:"north",position:(e+135)/90}:e<45?{orientation:"east",position:(e+45)/90}:{orientation:"south",position:(e-45)/90}}linearFlip(e,t,n,r,o){return o<.5?nt.Point.linear(e,t,2*o):nt.Point.linear(n,r,2*o-1)}postUpdate(){}};b0([(0,S0.inject)(v0.EdgeRouterRegistry),x1("design:type",v0.EdgeRouterRegistry)],Dd.prototype,"edgeRouterRegistry",void 0);Dd=b0([(0,S0.injectable)()],Dd);Ci.EdgeLayoutPostprocessor=Dd});var qd=f(Zp=>{"use strict";Object.defineProperty(Zp,"__esModule",{value:!0});var N1=_(),E0=P(),Jp=Xp(),L1=new N1.ContainerModule(i=>{i(Jp.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),i(E0.TYPES.IVNodePostprocessor).toService(Jp.EdgeLayoutPostprocessor),i(E0.TYPES.HiddenVNodePostprocessor).toService(Jp.EdgeLayoutPostprocessor)});Zp.default=L1});var I0=f(xt=>{"use strict";var B1=xt&&xt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},F1=xt&&xt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},V1=xt&&xt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(xt,"__esModule",{value:!0});xt.CreateElementCommand=xt.CreateElementAction=void 0;var w0=_(),K1=pe(),H1=G(),z1=P(),P0;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(P0=xt.CreateElementAction||(xt.CreateElementAction={}));var jd=class extends K1.Command{constructor(e){super(),this.action=e}execute(e){let t=e.root.index.getById(this.action.containerId);return t instanceof H1.SParentElement&&(this.container=t,this.newElement=e.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),e.root}undo(e){return this.container.remove(this.newElement),e.root}redo(e){return this.container.add(this.newElement),e.root}};jd.KIND=P0.KIND;jd=B1([(0,w0.injectable)(),V1(0,(0,w0.inject)(z1.TYPES.Action)),F1("design:paramtypes",[Object])],jd);xt.CreateElementCommand=jd});var Qp=f(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.isCreatingOnDrag=Er.creatingOnDragFeature=void 0;Er.creatingOnDragFeature=Symbol("creatingOnDragFeature");function Y1(i){return i.hasFeature(Er.creatingOnDragFeature)&&i.createAction!==void 0}Er.isCreatingOnDrag=Y1});var Pr=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.intersection=M.PointToPointLine=M.Diamond=M.linear=M.almostEquals=M.toRadians=M.toDegrees=M.magnitude=M.normalize=M.shiftTowards=M.angleBetweenPoints=M.angleOfPoint=M.maxDistance=M.manhattanDistance=M.euclideanDistance=M.Direction=M.includes=M.centerOfLine=M.center=M.translate=M.combine=M.isBounds=M.EMPTY_BOUNDS=M.isValidDimension=M.EMPTY_DIMENSION=M.pointEquals=M.subtract=M.add=M.ORIGIN_POINT=void 0;M.ORIGIN_POINT=Object.freeze({x:0,y:0});function R0(i,e){return{x:i.x+e.x,y:i.y+e.y}}M.add=R0;function M0(i,e){return{x:i.x-e.x,y:i.y-e.y}}M.subtract=M0;function _a(i,e){return i.x===e.x&&i.y===e.y}M.pointEquals=_a;M.EMPTY_DIMENSION=Object.freeze({width:-1,height:-1});function Nd(i){return i.width>=0&&i.height>=0}M.isValidDimension=Nd;M.EMPTY_BOUNDS=Object.freeze({x:0,y:0,width:-1,height:-1});function k1(i){return"x"in i&&"y"in i&&"width"in i&&"height"in i}M.isBounds=k1;function U1(i,e){if(!Nd(i))return Nd(e)?e:M.EMPTY_BOUNDS;if(!Nd(e))return i;let t=Math.min(i.x,e.x),n=Math.min(i.y,e.y),r=Math.max(i.x+(i.width>=0?i.width:0),e.x+(e.width>=0?e.width:0)),o=Math.max(i.y+(i.height>=0?i.height:0),e.y+(e.height>=0?e.height:0));return{x:t,y:n,width:r-t,height:o-n}}M.combine=U1;function G1(i,e){return{x:i.x+e.x,y:i.y+e.y,width:i.width,height:i.height}}M.translate=G1;function tg(i){return{x:i.x+(i.width>=0?.5*i.width:0),y:i.y+(i.height>=0?.5*i.height:0)}}M.center=tg;function W1(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return tg(t)}M.centerOfLine=W1;function $1(i,e){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}M.includes=$1;var X1;(function(i){i[i.left=0]="left",i[i.right=1]="right",i[i.up=2]="up",i[i.down=3]="down"})(X1=M.Direction||(M.Direction={}));function J1(i,e){let t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}M.euclideanDistance=J1;function Z1(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}M.manhattanDistance=Z1;function Q1(i,e){return Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y))}M.maxDistance=Q1;function eD(i){return Math.atan2(i.y,i.x)}M.angleOfPoint=eD;function tD(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}M.angleBetweenPoints=tD;function nD(i,e,t){let n=M0(e,i),r=O0(n),o={x:r.x*t,y:r.y*t};return R0(i,o)}M.shiftTowards=nD;function O0(i){let e=T0(i);return e===0||e===1?M.ORIGIN_POINT:{x:i.x/e,y:i.y/e}}M.normalize=O0;function T0(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}M.magnitude=T0;function A0(i){return i*180/Math.PI}M.toDegrees=A0;function iD(i){return i*Math.PI/180}M.toRadians=iD;function rD(i,e){return Math.abs(i-e)<.001}M.almostEquals=rD;function oD(i,e,t){return{x:(1-t)*i.x+t*e.x,y:(1-t)*i.y+t*e.y}}M.linear=oD;var eg=class{constructor(e){this.bounds=e}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new wr(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new wr(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new wr(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new wr(this.bottomPoint,this.leftPoint)}closestSideLine(e){let t=tg(this.bounds);return e.x>t.x?e.y>t.y?this.bottomRightSideLine:this.topRightSideLine:e.y>t.y?this.bottomLeftSideLine:this.topLeftSideLine}};M.Diamond=eg;var wr=class{constructor(e,t){this.p1=e,this.p2=t}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){let e=A0(this.angle),t=e<0?360+e:e;if(t===90)return"south";if(t===0||t===360)return"east";if(t===270)return"north";if(t===180)return"west";if(t>0&&t<90)return"south-east";if(t>90&&t<180)return"south-west";if(t>180&&t<270)return"north-west";if(t>270&&t<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(e){if(this.hasIndistinctPoints(e))return;let t=this.p1.x,n=this.p1.y,r=this.p2.x,o=this.p2.y,s=e.p1.x,a=e.p1.y,c=e.p2.x,u=e.p2.y,d=(u-a)*(r-t)-(c-s)*(o-n);if(d===0)return;let l=(c-s)*(n-a)-(u-a)*(t-s),S=(r-t)*(n-a)-(o-n)*(t-s);if(l===0&&S===0)return;let R=l/d,v=S/d;if(R<0||R>1||v<0||v>1)return;let m=t+R*(r-t),O=n+R*(o-n);return{x:m,y:O}}hasIndistinctPoints(e){return _a(this.p1,e.p1)||_a(this.p1,e.p2)||_a(this.p2,e.p1)||_a(this.p2,e.p2)}};M.PointToPointLine=wr;function sD(i,e){return{x:(i.c*e.b-e.c*i.b)/(i.a*e.b-e.a*i.b),y:(i.a*e.c-e.a*i.c)/(i.a*e.b-e.a*i.b)}}M.intersection=sD});var cg=f(Et=>{"use strict";var va=Et&&Et.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Et,"__esModule",{value:!0});Et.EmptyGroupView=Et.DiamondNodeView=Et.RectangularNodeView=Et.CircularNodeView=Et.SvgViewportView=void 0;var ti=Ut(),Lo=Sr(),ag=ra(),aD=Pr(),ba=_(),ng=class{render(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,ti.svg)("svg",null,(0,ti.svg)("g",{transform:r},t.renderChildren(e)))}};ng=va([(0,ba.injectable)()],ng);Et.SvgViewportView=ng;var ig=class extends ag.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=this.getRadius(e);return(0,ti.svg)("g",null,(0,ti.svg)("circle",{"class-sprotty-node":e instanceof Lo.SNode,"class-sprotty-port":e instanceof Lo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r,cx:r,cy:r}),t.renderChildren(e))}getRadius(e){let t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};ig=va([(0,ba.injectable)()],ig);Et.CircularNodeView=ig;var rg=class extends ag.ShapeView{render(e,t,n){if(this.isVisible(e,t))return(0,ti.svg)("g",null,(0,ti.svg)("rect",{"class-sprotty-node":e instanceof Lo.SNode,"class-sprotty-port":e instanceof Lo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};rg=va([(0,ba.injectable)()],rg);Et.RectangularNodeView=rg;var og=class extends ag.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=new aD.Diamond({height:Math.max(e.size.height,0),width:Math.max(e.size.width,0),x:0,y:0}),o=`${Ld(r.topPoint)} ${Ld(r.rightPoint)} ${Ld(r.bottomPoint)} ${Ld(r.leftPoint)}`;return(0,ti.svg)("g",null,(0,ti.svg)("polygon",{"class-sprotty-node":e instanceof Lo.SNode,"class-sprotty-port":e instanceof Lo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,points:o}),t.renderChildren(e))}};og=va([(0,ba.injectable)()],og);Et.DiamondNodeView=og;function Ld(i){return`${i.x},${i.y}`}var sg=class{render(e,t){return(0,ti.svg)("g",null)}};sg=va([(0,ba.injectable)()],sg);Et.EmptyGroupView=sg});var Vd=f(ie=>{"use strict";var cD=ie&&ie.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},uD=ie&&ie.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},dD=ie&&ie.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ie,"__esModule",{value:!0});ie.getEditableLabel=ie.EditLabelKeyListener=ie.EditLabelMouseListener=ie.ApplyLabelEditCommand=ie.ResolvedLabelEdit=ie.isApplyLabelEditAction=ie.ApplyLabelEditAction=ie.isEditLabelAction=ie.EditLabelAction=void 0;var lD=_(),C0=te(),fD=pe(),hD=P(),pD=Mt(),gD=sn(),mD=In(),yD=bt(),_D=er(),ug=qo(),Fd;(function(i){i.KIND="EditLabel";function e(t){return{kind:i.KIND,labelId:t}}i.create=e})(Fd=ie.EditLabelAction||(ie.EditLabelAction={}));function vD(i){return(0,C0.isAction)(i)&&i.kind===Fd.KIND&&"labelId"in i}ie.isEditLabelAction=vD;var hg;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(hg=ie.ApplyLabelEditAction||(ie.ApplyLabelEditAction={}));function bD(i){return(0,C0.isAction)(i)&&i.kind===hg.KIND&&"labelId"in i&&"text"in i}ie.isApplyLabelEditAction=bD;var dg=class{};ie.ResolvedLabelEdit=dg;var Bd=class extends fD.Command{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.labelId);return n&&(0,ug.isEditableLabel)(n)&&(this.resolvedLabelEdit={label:n,oldLabel:n.text,newLabel:this.action.text},n.text=this.action.text),e.root}undo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),e.root}redo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),e.root}};Bd.KIND=hg.KIND;Bd=cD([dD(0,(0,lD.inject)(hD.TYPES.Action)),uD("design:paramtypes",[Object])],Bd);ie.ApplyLabelEditCommand=Bd;var lg=class extends pD.MouseListener{doubleClick(e,t){let n=pg(e);return n?[Fd.create(n.id)]:[]}};ie.EditLabelMouseListener=lg;var fg=class extends gD.KeyListener{keyDown(e,t){if((0,mD.matchesKeystroke)(t,"F2")){let n=(0,_D.toArray)(e.index.all().filter(r=>(0,yD.isSelectable)(r)&&r.selected)).map(pg).filter(r=>r!==void 0);if(n.length===1)return[Fd.create(n[0].id)]}return[]}};ie.EditLabelKeyListener=fg;function pg(i){if((0,ug.isEditableLabel)(i))return i;if((0,ug.isWithEditableLabel)(i)&&i.editableLabel)return i.editableLabel}ie.getEditableLabel=pg});var Ir=f(fn=>{"use strict";var Kd=fn&&fn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gg=fn&&fn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(fn,"__esModule",{value:!0});fn.SvgExporter=fn.ExportSvgAction=void 0;var Hd=_(),x0=Q(),SD=ae(),ED=iu(),mg=P(),D0;(function(i){i.KIND="exportSvg";function e(t,n){return{kind:i.KIND,svg:t,responseId:n}}i.create=e})(D0=fn.ExportSvgAction||(fn.ExportSvgAction={}));var Bo=class{export(e,t){if(typeof document<"u"){let n=document.getElementById(this.options.hiddenDiv);if(n!==null&&n.firstElementChild&&n.firstElementChild.tagName==="svg"){let r=n.firstElementChild,o=this.createSvg(r,e);this.actionDispatcher.dispatch(D0.create(o,t?t.requestId:""))}}}createSvg(e,t){let n=new XMLSerializer,r=n.serializeToString(e),o=document.createElement("iframe");if(document.body.appendChild(o),!o.contentWindow)throw new Error("IFrame has no contentWindow");let s=o.contentWindow.document;s.open(),s.write(r),s.close();let a=s.getElementById(e.id);a.removeAttribute("opacity"),this.copyStyles(e,a,["width","height","opacity"]),a.setAttribute("version","1.1");let c=this.getBounds(t);a.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`);let u=n.serializeToString(a);return document.body.removeChild(o),u}copyStyles(e,t,n){let r=getComputedStyle(e),o=getComputedStyle(t),s="";for(let a=0;a<r.length;a++){let c=r[a];if(n.indexOf(c)===-1){let u=r.getPropertyValue(c);o.getPropertyValue(c)!==u&&(s+=c+":"+u+";")}}s!==""&&t.setAttribute("style",s);for(let a=0;a<e.childNodes.length;++a){let c=e.childNodes[a],u=t.childNodes[a];c instanceof Element&&this.copyStyles(c,u,[])}}getBounds(e){let t=[x0.Bounds.EMPTY];return e.children.forEach(n=>{(0,SD.isBoundsAware)(n)&&t.push(n.bounds)}),t.reduce((n,r)=>x0.Bounds.combine(n,r))}};Kd([(0,Hd.inject)(mg.TYPES.ViewerOptions),gg("design:type",Object)],Bo.prototype,"options",void 0);Kd([(0,Hd.inject)(mg.TYPES.IActionDispatcher),gg("design:type",ED.ActionDispatcher)],Bo.prototype,"actionDispatcher",void 0);Kd([(0,Hd.inject)(mg.TYPES.ILogger),gg("design:type",Object)],Bo.prototype,"log",void 0);Bo=Kd([(0,Hd.injectable)()],Bo);fn.SvgExporter=Bo});var Fo=f(Cn=>{"use strict";var zd=Cn&&Cn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},q0=Cn&&Cn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Cn,"__esModule",{value:!0});Cn.ComputedBoundsApplicator=Cn.ModelSource=void 0;var Yd=_(),wD=te(),PD=vi(),j0=P(),ID=Ir(),Sa=class{initialize(e){e.register(wD.RequestModelAction.KIND,this),e.register(ID.ExportSvgAction.KIND,this)}};zd([(0,Yd.inject)(j0.TYPES.IActionDispatcher),q0("design:type",Object)],Sa.prototype,"actionDispatcher",void 0);zd([(0,Yd.inject)(j0.TYPES.ViewerOptions),q0("design:type",Object)],Sa.prototype,"viewerOptions",void 0);Sa=zd([(0,Yd.injectable)()],Sa);Cn.ModelSource=Sa;var yg=class{apply(e,t){let n=new PD.SModelIndex;n.add(e);for(let r of t.bounds){let o=n.getById(r.elementId);o!==void 0&&this.applyBounds(o,r.newPosition,r.newSize)}if(t.alignments!==void 0)for(let r of t.alignments){let o=n.getById(r.elementId);o!==void 0&&this.applyAlignment(o,r.newAlignment)}return n}applyAlignment(e,t){let n=e;n.alignment={x:t.x,y:t.y}}applyBounds(e,t,n){let r=e;t&&(r.position=Object.assign({},t)),r.size=Object.assign({},n)}};yg=zd([(0,Yd.injectable)()],yg);Cn.ComputedBoundsApplicator=yg});var wa=f(Dt=>{"use strict";var N0=Dt&&Dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},L0=Dt&&Dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},RD=Dt&&Dt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.CommitModelCommand=Dt.CommitModelAction=void 0;var _g=_(),MD=pe(),B0=P(),OD=Fo(),F0;(function(i){i.KIND="commitModel";function e(){return{kind:i.KIND}}i.create=e})(F0=Dt.CommitModelAction||(Dt.CommitModelAction={}));var Ea=class extends MD.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newModel=e.modelFactory.createSchema(e.root),this.doCommit(this.newModel,e.root,!0)}doCommit(e,t,n){let r=this.modelSource.commitModel(e);return r instanceof Promise?r.then(o=>(n&&(this.originalModel=o),t)):(n&&(this.originalModel=r),t)}undo(e){return this.doCommit(this.originalModel,e.root,!1)}redo(e){return this.doCommit(this.newModel,e.root,!1)}};Ea.KIND=F0.KIND;N0([(0,_g.inject)(B0.TYPES.ModelSource),L0("design:type",OD.ModelSource)],Ea.prototype,"modelSource",void 0);Ea=N0([(0,_g.injectable)(),RD(0,(0,_g.inject)(B0.TYPES.Action)),L0("design:paramtypes",[Object])],Ea);Dt.CommitModelCommand=Ea});var kd=f(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.ZoomMouseListener=xi.getZoom=xi.isZoomable=void 0;var TD=te(),AD=Pn(),CD=Mt(),V0=Ke(),K0=Tn();function xD(i){return"zoom"in i}xi.isZoomable=xD;function DD(i){let e=1,t=(0,V0.findParentByFeature)(i,K0.isViewport);return t&&(e=t.zoom),e}xi.getZoom=DD;var vg=class extends CD.MouseListener{wheel(e,t){let n=(0,V0.findParentByFeature)(e,K0.isViewport);if(n){let r=this.getZoomFactor(t),o=this.getViewportOffset(e.root,t),s=1/(r*n.zoom)-1/n.zoom,a={scroll:{x:n.scroll.x-s*o.x,y:n.scroll.y-s*o.y},zoom:n.zoom*r};return[TD.SetViewportAction.create(n.id,a,{animate:!1})]}return[]}getViewportOffset(e,t){let n=e.canvasBounds,r=(0,AD.getWindowScroll)();return{x:t.clientX+r.x-n.x,y:t.clientY+r.y-n.y}}getZoomFactor(e){return e.deltaMode===e.DOM_DELTA_PAGE?Math.exp(-e.deltaY*.5):e.deltaMode===e.DOM_DELTA_LINE?Math.exp(-e.deltaY*.05):Math.exp(-e.deltaY*.005)}};xi.ZoomMouseListener=vg});var Eg=f(Dn=>{"use strict";var Rr=Dn&&Dn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Pa=Dn&&Dn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},bg;Object.defineProperty(Dn,"__esModule",{value:!0});Dn.EditLabelUI=Dn.EditLabelActionHandler=void 0;var ni=_(),qD=te(),Ia=P(),jD=Ru(),ND=Ks(),LD=oo(),BD=wa(),H0=In(),FD=ae(),z0=kd(),VD=Vd(),KD=qo(),Sg=class{handle(e){if((0,VD.isEditLabelAction)(e))return ND.SetUIExtensionVisibilityAction.create({extensionId:xn.ID,visible:!0,contextElementsId:[e.labelId]})}};Sg=Rr([(0,ni.injectable)()],Sg);Dn.EditLabelActionHandler=Sg;var xn=bg=class extends jD.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return bg.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(t=>{t.onkeydown=n=>this.applyLabelEditOnEvent(n,"Enter"),this.configureAndAdd(t,e)})}configureAndAdd(e,t){e.style.visibility="hidden",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.addEventListener("keydown",n=>this.hideIfEscapeEvent(n)),e.addEventListener("keyup",n=>this.validateLabelIfContentChange(n,e.value)),e.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),t.appendChild(e)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(e){(0,H0.matchesKeystroke)(e,"Escape")&&this.hide()}applyLabelEditOnEvent(e,t,...n){(0,H0.matchesKeystroke)(e,t||"Enter",...n)&&(e.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(e,t){(this.previousLabelContent===void 0||this.previousLabelContent!==t)&&(this.previousLabelContent=t,this.performLabelValidation(e,this.editControl.value))}async applyLabelEdit(){var e;if(this.isActive){if(((e=this.label)===null||e===void 0?void 0:e.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(t=>t.dispatchAll([qD.ApplyLabelEditAction.create(this.labelId,this.editControl.value),BD.CommitModelAction.create()])).catch(t=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",t)),this.hide()}}performLabelValidation(e,t){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(t),200)}async validateLabel(e){if(this.labelValidator&&this.label)try{let t=await this.labelValidator.validate(e,this.label);return this.isCurrentLabelValid=t.severity!=="error",this.showValidationResult(t),t}catch(t){this.logger.error(this,"Error validating edited label",t)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(e){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,e)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(e,...t){!HD(t,e)||this.isActive||(super.show(e,...t),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(e,t,...n){this.label=Y0(n,t)[0],this.previousLabelContent=this.label.text,this.setPosition(e),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(e){let t=0,n=0,r=100,o=20;if(this.label){let s=(0,z0.getZoom)(this.label),a=(0,FD.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);t=a.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*s,n=a.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*s,o=(this.label.editControlDimension?this.label.editControlDimension.height:o)*s,r=(this.label.editControlDimension?this.label.editControlDimension.width:r)*s}e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=`${r}px`,this.editControl.style.width=`${r}px`,e.style.height=`${o}px`,this.editControl.style.height=`${o}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";let e=window.getComputedStyle(this.labelElement);this.editControl.style.font=e.font,this.editControl.style.fontStyle=e.fontStyle,this.editControl.style.fontFamily=e.fontFamily,this.editControl.style.fontSize=zD(e.fontSize,(0,z0.getZoom)(this.label)),this.editControl.style.fontWeight=e.fontWeight,this.editControl.style.lineHeight=e.lineHeight}}};xn.ID="editLabelUi";Rr([(0,ni.inject)(Ia.TYPES.IActionDispatcherProvider),Pa("design:type",Function)],xn.prototype,"actionDispatcherProvider",void 0);Rr([(0,ni.inject)(Ia.TYPES.ViewerOptions),Pa("design:type",Object)],xn.prototype,"viewerOptions",void 0);Rr([(0,ni.inject)(Ia.TYPES.DOMHelper),Pa("design:type",LD.DOMHelper)],xn.prototype,"domHelper",void 0);Rr([(0,ni.inject)(Ia.TYPES.IEditLabelValidator),(0,ni.optional)(),Pa("design:type",Object)],xn.prototype,"labelValidator",void 0);Rr([(0,ni.inject)(Ia.TYPES.IEditLabelValidationDecorator),(0,ni.optional)(),Pa("design:type",Object)],xn.prototype,"validationDecorator",void 0);xn=bg=Rr([(0,ni.injectable)()],xn);Dn.EditLabelUI=xn;function HD(i,e){return Y0(i,e).length===1}function Y0(i,e){return i.map(t=>e.index.getById(t)).filter(KD.isEditableLabel)}function zD(i,e){return i.replace(/([0-9]+)/,t=>String(Number.parseInt(t,10)*e))}});var Ma=f(qt=>{"use strict";var G0=qt&&qt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},W0=qt&&qt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},YD=qt&&qt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(qt,"__esModule",{value:!0});qt.SwitchEditModeCommand=qt.SwitchEditModeAction=void 0;var wg=_(),kD=pe(),UD=G(),GD=P(),hn=me(),k0=ln(),U0=qo(),$0;(function(i){i.KIND="switchEditMode";function e(t){var n,r;return{kind:i.KIND,elementsToActivate:(n=t.elementsToActivate)!==null&&n!==void 0?n:[],elementsToDeactivate:(r=t.elementsToDeactivate)!==null&&r!==void 0?r:[]}}i.create=e})($0=qt.SwitchEditModeAction||(qt.SwitchEditModeAction={}));var Ra=class extends kD.Command{constructor(e){super(),this.action=e,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(e){let t=e.root.index;return this.action.elementsToActivate.forEach(n=>{let r=t.getById(n);r!==void 0&&this.elementsToActivate.push(r)}),this.action.elementsToDeactivate.forEach(n=>{let r=t.getById(n);if(r!==void 0&&this.elementsToDeactivate.push(r),r instanceof hn.SRoutingHandle&&r.parent instanceof hn.SRoutableElement){let o=r.parent;this.shouldRemoveHandle(r,o)&&(this.handlesToRemove.push({handle:r,parent:o}),this.elementsToDeactivate.push(o),this.elementsToActivate.push(o))}}),this.doExecute(e)}doExecute(e){return this.handlesToRemove.forEach(t=>{t.point=t.parent.routingPoints.splice(t.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(t=>{t instanceof hn.SRoutableElement?t.removeAll(n=>n instanceof hn.SRoutingHandle):t instanceof hn.SRoutingHandle&&(t.editMode=!1,t.danglingAnchor&&t.parent instanceof hn.SRoutableElement&&t.danglingAnchor.original&&(t.parent.source===t.danglingAnchor?t.parent.sourceId=t.danglingAnchor.original.id:t.parent.target===t.danglingAnchor&&(t.parent.targetId=t.danglingAnchor.original.id),t.danglingAnchor.parent.remove(t.danglingAnchor),t.danglingAnchor=void 0))}),this.elementsToActivate.forEach(t=>{(0,U0.canEditRouting)(t)&&t instanceof UD.SParentElement?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof hn.SRoutingHandle&&(t.editMode=!0)}),e.root}shouldRemoveHandle(e,t){return e.kind==="junction"?this.edgeRouterRegistry.route(t).find(r=>r.pointIndex===e.pointIndex)===void 0:!1}undo(e){return this.handlesToRemove.forEach(t=>{t.point!==void 0&&t.parent.routingPoints.splice(t.handle.pointIndex,0,t.point)}),this.elementsToActivate.forEach(t=>{t instanceof hn.SRoutableElement?t.removeAll(n=>n instanceof hn.SRoutingHandle):t instanceof hn.SRoutingHandle&&(t.editMode=!1)}),this.elementsToDeactivate.forEach(t=>{(0,U0.canEditRouting)(t)?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof hn.SRoutingHandle&&(t.editMode=!0)}),e.root}redo(e){return this.doExecute(e)}};Ra.KIND=$0.KIND;G0([(0,wg.inject)(k0.EdgeRouterRegistry),W0("design:type",k0.EdgeRouterRegistry)],Ra.prototype,"edgeRouterRegistry",void 0);Ra=G0([(0,wg.injectable)(),YD(0,(0,wg.inject)(GD.TYPES.Action)),W0("design:paramtypes",[Object])],Ra);qt.SwitchEditModeCommand=Ra});var Ud=f(jt=>{"use strict";var J0=jt&&jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Z0=jt&&jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},WD=jt&&jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.ReconnectCommand=jt.ReconnectAction=void 0;var Pg=_(),$D=pe(),XD=P(),JD=me(),X0=ln(),Q0;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(Q0=jt.ReconnectAction||(jt.ReconnectAction={}));var Oa=class extends $D.Command{constructor(e){super(),this.action=e}execute(e){return this.doExecute(e),e.root}doExecute(e){let n=e.root.index.getById(this.action.routableId);if(n instanceof JD.SRoutableElement){let r=this.edgeRouterRegistry.get(n.routerKind),o=r.takeSnapshot(n);r.applyReconnect(n,this.action.newSourceId,this.action.newTargetId);let s=r.takeSnapshot(n);this.memento={edge:n,before:o,after:s}}}undo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),e.root}redo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),e.root}};Oa.KIND=Q0.KIND;J0([(0,Pg.inject)(X0.EdgeRouterRegistry),Z0("design:type",X0.EdgeRouterRegistry)],Oa.prototype,"edgeRouterRegistry",void 0);Oa=J0([(0,Pg.injectable)(),WD(0,(0,Pg.inject)(XD.TYPES.Action)),Z0("design:paramtypes",[Object])],Oa);jt.ReconnectCommand=Oa});var Og=f(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.labelEditUiModule=Di.labelEditModule=Di.edgeEditModule=void 0;var Mg=_(),Rg=P(),Gd=gt(),ZD=Ds(),QD=uo(),eq=me(),tq=cg(),nq=Co(),Vo=Vd(),Ig=Eg(),iq=Ma(),rq=Ud();Di.edgeEditModule=new Mg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,Gd.configureCommand)(n,iq.SwitchEditModeCommand),(0,Gd.configureCommand)(n,rq.ReconnectCommand),(0,Gd.configureCommand)(n,nq.DeleteElementCommand),(0,QD.configureModelElement)(n,"dangling-anchor",eq.SDanglingAnchor,tq.EmptyGroupView)});Di.labelEditModule=new Mg.ContainerModule((i,e,t)=>{i(Vo.EditLabelMouseListener).toSelf().inSingletonScope(),i(Rg.TYPES.MouseListener).toService(Vo.EditLabelMouseListener),i(Vo.EditLabelKeyListener).toSelf().inSingletonScope(),i(Rg.TYPES.KeyListener).toService(Vo.EditLabelKeyListener),(0,Gd.configureCommand)({bind:i,isBound:t},Vo.ApplyLabelEditCommand)});Di.labelEditUiModule=new Mg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,ZD.configureActionHandler)(n,Vo.EditLabelAction.KIND,Ig.EditLabelActionHandler),i(Ig.EditLabelUI).toSelf().inSingletonScope(),i(Rg.TYPES.IUIExtension).toService(Ig.EditLabelUI)})});var Wd=f(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.isExpandable=Mr.expandFeature=void 0;Mr.expandFeature=Symbol("expandFeature");function oq(i){return i.hasFeature(Mr.expandFeature)&&"expanded"in i}Mr.isExpandable=oq});var Tg=f(qn=>{"use strict";var sq=qn&&qn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(qn,"__esModule",{value:!0});qn.ExpandButtonHandler=qn.CollapseExpandAllAction=qn.CollapseExpandAction=void 0;var aq=_(),cq=te(),uq=Ke(),dq=Wd(),Ko=class{constructor(e,t){this.expandIds=e,this.collapseIds=t,this.kind=Ko.KIND}};qn.CollapseExpandAction=Ko;Ko.KIND="collapseExpand";var Ho=class{constructor(e=!0){this.expand=e,this.kind=Ho.KIND}};qn.CollapseExpandAllAction=Ho;Ho.KIND="collapseExpandAll";var $d=class{buttonPressed(e){let t=(0,uq.findParentByFeature)(e,dq.isExpandable);return t!==void 0?[cq.CollapseExpandAction.create({expandIds:t.expanded?[]:[t.id],collapseIds:t.expanded?[t.id]:[]})]:[]}};$d.TYPE="button:expand";$d=sq([(0,aq.injectable)()],$d);qn.ExpandButtonHandler=$d});var eE=f(zo=>{"use strict";var lq=zo&&zo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(zo,"__esModule",{value:!0});zo.ExpandButtonView=void 0;var Ag=Ut(),fq=Wd(),hq=Ke(),pq=_(),Cg=class{render(e,t){let n=(0,hq.findParentByFeature)(e,fq.isExpandable),r=n!==void 0&&n.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,Ag.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,Ag.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,Ag.svg)("path",{d:r}))}};Cg=lq([(0,pq.injectable)()],Cg);zo.ExpandButtonView=Cg});var Dg=f(Ye=>{"use strict";var Zd=Ye&&Ye.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},nE=Ye&&Ye.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},gq=Ye&&Ye.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.ExportSvgPostprocessor=Ye.ExportSvgCommand=Ye.RequestExportSvgAction=Ye.ExportSvgKeyListener=void 0;var Qd=_(),mq=te(),yq=pe(),_q=bt(),vq=G(),bq=sn(),Sq=In(),tE=bd(),Eq=Ir(),wq=Tn(),Pq=_r(),iE=P(),xg=class extends bq.KeyListener{keyDown(e,t){return(0,Sq.matchesKeystroke)(t,"KeyE","ctrlCmd","shift")?[el.create()]:[]}};xg=Zd([(0,Qd.injectable)()],xg);Ye.ExportSvgKeyListener=xg;var el;(function(i){i.KIND="requestExportSvg";function e(){return{kind:i.KIND,requestId:(0,mq.generateRequestId)()}}i.create=e})(el=Ye.RequestExportSvgAction||(Ye.RequestExportSvgAction={}));var Xd=class extends yq.HiddenCommand{constructor(e){super(),this.action=e}execute(e){if((0,tE.isExportable)(e.root)){let t=e.modelFactory.createRoot(e.root);if((0,tE.isExportable)(t))return(0,wq.isViewport)(t)&&(t.zoom=1,t.scroll={x:0,y:0}),t.index.all().forEach(n=>{(0,_q.isSelectable)(n)&&n.selected&&(n.selected=!1),(0,Pq.isHoverable)(n)&&n.hoverFeedback&&(n.hoverFeedback=!1)}),{model:t,modelChanged:!0,cause:this.action}}return{model:e.root,modelChanged:!1}}};Xd.KIND=el.KIND;Xd=Zd([gq(0,(0,Qd.inject)(iE.TYPES.Action)),nE("design:paramtypes",[Object])],Xd);Ye.ExportSvgCommand=Xd;var Jd=class{decorate(e,t){return t instanceof vq.SModelRoot&&(this.root=t),e}postUpdate(e){this.root&&e!==void 0&&e.kind===el.KIND&&this.svgExporter.export(this.root,e)}};Zd([(0,Qd.inject)(iE.TYPES.SvgExporter),nE("design:type",Eq.SvgExporter)],Jd.prototype,"svgExporter",void 0);Jd=Zd([(0,Qd.injectable)()],Jd);Ye.ExportSvgPostprocessor=Jd});var tl=f(qi=>{"use strict";var Iq=qi&&qi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(qi,"__esModule",{value:!0});qi.ElementFader=qi.FadeAnimation=void 0;var Rq=_(),Mq=rr(),Oq=G(),Tq=Ne(),Aq=Oo(),qg=class extends Mq.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementFades=t,this.removeAfterFadeOut=r}tween(e,t){for(let n of this.elementFades){let r=n.element;n.type==="in"?r.opacity=e:n.type==="out"&&(r.opacity=1-e,e===1&&this.removeAfterFadeOut&&r instanceof Oq.SChildElement&&r.parent.remove(r))}return this.model}};qi.FadeAnimation=qg;var jg=class{decorate(e,t){return(0,Aq.isFadeable)(t)&&t.opacity!==1&&(0,Tq.setAttr)(e,"opacity",t.opacity),e}postUpdate(){}};jg=Iq([(0,Rq.injectable)()],jg);qi.ElementFader=jg});var Fg=f(ne=>{"use strict";var Ni=ne&&ne.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ca=ne&&ne.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},oE=ne&&ne.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ne,"__esModule",{value:!0});ne.ClosePopupActionHandler=ne.HoverKeyListener=ne.PopupHoverMouseListener=ne.HoverMouseListener=ne.AbstractHoverMouseListener=ne.SetPopupModelCommand=ne.SetPopupModelAction=ne.RequestPopupModelAction=ne.HoverFeedbackCommand=ne.HoverFeedbackAction=void 0;var jn=_(),sE=te(),Cq=Q(),xq=In(),xa=P(),rE=G(),Dq=Mt(),aE=pe(),Or=wn(),qq=sn(),Ta=Ke(),jq=ae(),Yo=_r(),ko;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(ko=ne.HoverFeedbackAction||(ne.HoverFeedbackAction={}));var nl=class extends aE.SystemCommand{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.mouseoverElement);return n&&(0,Yo.isHoverable)(n)&&(n.hoverFeedback=this.action.mouseIsOver),this.redo(e)}undo(e){return e.root}redo(e){return e.root}};nl.KIND=ko.KIND;nl=Ni([(0,jn.injectable)(),oE(0,(0,jn.inject)(xa.TYPES.Action)),Ca("design:paramtypes",[Object])],nl);ne.HoverFeedbackCommand=nl;var ji=class{constructor(e,t,n=""){this.elementId=e,this.bounds=t,this.requestId=n,this.kind=ji.KIND}static create(e,t){return new ji(e,t,(0,sE.generateRequestId)())}};ne.RequestPopupModelAction=ji;ji.KIND="requestPopupModel";var ii=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ii.KIND}};ne.SetPopupModelAction=ii;ii.KIND="setPopupModel";var Aa=class extends aE.PopupCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.root,this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}};Aa.KIND=sE.SetPopupModelAction.KIND;Aa=Ni([(0,jn.injectable)(),oE(0,(0,jn.inject)(xa.TYPES.Action)),Ca("design:paramtypes",[Object])],Aa);ne.SetPopupModelCommand=Aa;var Tr=class extends Dq.MouseListener{mouseDown(e,t){return this.mouseIsDown=!0,[]}mouseUp(e,t){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(e=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,e(new ii({type:Or.EMPTY_ROOT.type,id:Or.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}};Ni([(0,jn.inject)(xa.TYPES.ViewerOptions),Ca("design:type",Object)],Tr.prototype,"options",void 0);Ni([(0,jn.inject)(xa.TYPES.HoverState),Ca("design:type",Object)],Tr.prototype,"state",void 0);ne.AbstractHoverMouseListener=Tr;var il=class extends Tr{computePopupBounds(e,t){let n={x:-5,y:20},r=(0,jq.getAbsoluteBounds)(e),o=e.root.canvasBounds,s=Cq.Bounds.translate(r,o),a=s.x+s.width-t.x,c=s.y+s.height-t.y;c<=a&&this.allowSidePosition(e,"below",c)?n={x:-5,y:Math.round(c+5)}:a<=c&&this.allowSidePosition(e,"right",a)&&(n={x:Math.round(a+5),y:-5});let u=t.x+n.x,d=o.x+o.width;u>d&&(u=d);let l=t.y+n.y,S=o.y+o.height;return l>S&&(l=S),{x:u,y:l,width:-1,height:-1}}allowSidePosition(e,t,n){return!(e instanceof rE.SModelRoot)&&n<=150}startMouseOverTimer(e,t){return this.stopMouseOverTimer(),new Promise(n=>{this.state.mouseOverTimer=window.setTimeout(()=>{let r=this.computePopupBounds(e,{x:t.pageX,y:t.pageY});n(new ji(e.id,r)),this.state.popupOpen=!0,this.state.previousPopupElement=e},this.options.popupOpenDelay)})}mouseOver(e,t){let n=[];if(!this.mouseIsDown){let r=(0,Ta.findParent)(e,Yo.hasPopupFeature);this.state.popupOpen&&(r===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==r.id)?n.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t)),this.lastHoverFeedbackElementId&&(n.push(ko.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);let o=(0,Ta.findParentByFeature)(e,Yo.isHoverable);o!==void 0&&(n.push(ko.create({mouseoverElement:o.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=o.id)}return n}mouseOut(e,t){let n=[];if(!this.mouseIsDown){let r=this.getElementFromEventPosition(t);if(!this.isSprottyPopup(r)){if(this.state.popupOpen){let s=(0,Ta.findParent)(e,Yo.hasPopupFeature);this.state.previousPopupElement!==void 0&&s!==void 0&&this.state.previousPopupElement.id===s.id&&n.push(this.startMouseOutTimer())}this.stopMouseOverTimer();let o=(0,Ta.findParentByFeature)(e,Yo.isHoverable);o!==void 0&&(n.push(ko.create({mouseoverElement:o.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==o.id&&n.push(ko.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return n}getElementFromEventPosition(e){return document.elementFromPoint(e.x,e.y)}isSprottyPopup(e){return e?e.id===this.options.popupDiv||!!e.parentElement&&this.isSprottyPopup(e.parentElement):!1}mouseMove(e,t){let n=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,t)&&n.push(this.startMouseOutTimer());let r=(0,Ta.findParent)(e,Yo.hasPopupFeature);r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t))}return n}closeOnMouseMove(e,t){return e instanceof rE.SModelRoot}};Ni([(0,jn.inject)(xa.TYPES.ViewerOptions),Ca("design:type",Object)],il.prototype,"options",void 0);il=Ni([(0,jn.injectable)()],il);ne.HoverMouseListener=il;var Ng=class extends Tr{mouseOut(e,t){return[this.startMouseOutTimer()]}mouseOver(e,t){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};Ng=Ni([(0,jn.injectable)()],Ng);ne.PopupHoverMouseListener=Ng;var Lg=class extends qq.KeyListener{keyDown(e,t){return(0,xq.matchesKeystroke)(t,"Escape")?[new ii({type:Or.EMPTY_ROOT.type,id:Or.EMPTY_ROOT.id})]:[]}};ne.HoverKeyListener=Lg;var Bg=class{constructor(){this.popupOpen=!1}handle(e){if(e.kind===Aa.KIND)this.popupOpen=e.newRoot.type!==Or.EMPTY_ROOT.type;else if(this.popupOpen)return new ii({id:Or.EMPTY_ROOT.id,type:Or.EMPTY_ROOT.type})}};Bg=Ni([(0,jn.injectable)()],Bg);ne.ClosePopupActionHandler=Bg});var rl=f(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.SIssue=wt.SIssueMarker=wt.SDecoration=wt.isDecoration=wt.decorationFeature=void 0;var uE=ae(),cE=_r();wt.decorationFeature=Symbol("decorationFeature");function Nq(i){return i.hasFeature(wt.decorationFeature)}wt.isDecoration=Nq;var Da=class extends uE.SShapeElement{};wt.SDecoration=Da;Da.DEFAULT_FEATURES=[wt.decorationFeature,uE.boundsFeature,cE.hoverFeedbackFeature,cE.popupFeature];var Vg=class extends Da{};wt.SIssueMarker=Vg;var Kg=class{};wt.SIssue=Kg});var Yg=f(Uo=>{"use strict";var Lq=Uo&&Uo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Uo,"__esModule",{value:!0});Uo.IssueMarkerView=void 0;var Hg=Ut(),Bq=Ne(),Fq=_(),zg=class{render(e,t){let n=.008928571428571428,r=`scale(${n}, ${n})`,o=this.getMaxSeverity(e),s=(0,Hg.svg)("g",{"class-sprotty-issue":!0},(0,Hg.svg)("g",{transform:r},(0,Hg.svg)("path",{d:this.getPath(o)})));return(0,Bq.setClass)(s,"sprotty-"+o,!0),s}getMaxSeverity(e){let t="info";for(let n of e.issues.map(r=>r.severity))(n==="error"||n==="warning"&&t==="info")&&(t=n);return t}getPath(e){switch(e){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};zg=Lq([(0,Fq.injectable)()],zg);Uo.IssueMarkerView=zg});var kg=f(Li=>{"use strict";var hE=Li&&Li.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Vq=Li&&Li.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Li,"__esModule",{value:!0});Li.DecorationPlacer=void 0;var pE=_(),Kq=G(),Hq=rl(),zq=Ne(),dE=ae(),Yq=me(),lE=ln(),fE=cr(),ol=class{decorate(e,t){if((0,Hq.isDecoration)(t)){let n=this.getPosition(t),r="translate("+n.x+", "+n.y+")";(0,zq.setAttr)(e,"transform",r)}return e}getPosition(e){if(e instanceof Kq.SChildElement&&e.parent instanceof Yq.SRoutableElement){let t=this.edgeRouterRegistry.route(e.parent);if(t.length>1){let n=Math.floor(.5*(t.length-1)),r=(0,dE.isSizeable)(e)?{x:-.5*e.bounds.width,y:-.5*e.bounds.width}:fE.Point.ORIGIN;return{x:.5*(t[n].x+t[n+1].x)+r.x,y:.5*(t[n].y+t[n+1].y)+r.y}}}return(0,dE.isSizeable)(e)?{x:-.666*e.bounds.width,y:-.666*e.bounds.height}:fE.Point.ORIGIN}postUpdate(){}};hE([(0,pE.inject)(lE.EdgeRouterRegistry),Vq("design:type",lE.EdgeRouterRegistry)],ol.prototype,"edgeRouterRegistry",void 0);ol=hE([(0,pE.injectable)()],ol);Li.DecorationPlacer=ol});var Wg=f((Ug,Gg)=>{(function(i,e){typeof Ug=="object"&&typeof Gg<"u"?Gg.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self,i.TinyQueue=e())})(Ug,function(){"use strict";var i=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var r=this,o=r.data,s=r.compare,a=o[n];n>0;){var c=n-1>>1,u=o[c];if(s(a,u)>=0)break;o[n]=u,n=c}o[n]=a},i.prototype._down=function(n){for(var r=this,o=r.data,s=r.compare,a=this.length>>1,c=o[n];n<a;){var u=(n<<1)+1,d=o[u],l=u+1;if(l<this.length&&s(o[l],d)<0&&(u=l,d=o[l]),s(d,c)>=0)break;o[n]=d,n=u}o[n]=c};function e(t,n){return t<n?-1:t>n?1:0}return i})});var Xg=f(Me=>{"use strict";var kq=Me&&Me.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Me,"__esModule",{value:!0});Me.intersectionOfSegments=Me.getSegmentIndex=Me.checkWhichSegmentHasRightEndpointFirst=Me.runSweep=Me.Segment=Me.SweepEvent=Me.checkWhichEventIsLeft=Me.addRoute=void 0;var Uq=kq(Wg()),gE=Pr();function Gq(i,e,t){if(e.length<1)return;let n=e[0],r;for(let o=0;o<e.length-1;o++){r=e[o+1];let s=new qa(i,n,o),a=new qa(i,r,o+1);s.otherEvent=a,a.otherEvent=s,mE(s,a)>0?(a.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,a.isLeftEndpoint=!1),t.push(s),t.push(a),n=r}}Me.addRoute=Gq;function mE(i,e){return i.point.x>e.point.x?1:i.point.x<e.point.x?-1:i.point.y!==e.point.y?i.point.y>e.point.y?1:-1:1}Me.checkWhichEventIsLeft=mE;var qa=class{constructor(e,t,n){this.edgeId=e,this.point=t,this.segmentIndex=n}};Me.SweepEvent=qa;var sl=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};Me.Segment=sl;function Wq(i){let e=[],t=new Uq.default([],yE);for(;i.length;){let n=i.pop();if(n?.isLeftEndpoint){let r=new sl(n);for(let o=0;o<t.data.length;o++){let s=t.data[o],a=_E(r,s);a&&e.push({routable1:n.edgeId,routable2:s.leftSweepEvent.edgeId,segmentIndex1:$g(r),segmentIndex2:$g(s),intersectionPoint:a})}t.push(r)}else n?.isLeftEndpoint===!1&&t.pop()}return e}Me.runSweep=Wq;function yE(i,e){return i.rightSweepEvent.point.x>e.rightSweepEvent.point.x?1:i.rightSweepEvent.point.x<e.rightSweepEvent.point.x?-1:i.rightSweepEvent.point.y!==e.rightSweepEvent.point.y?i.rightSweepEvent.point.y<e.rightSweepEvent.point.y?1:-1:1}Me.checkWhichSegmentHasRightEndpointFirst=yE;function $g(i){return Math.min(i.leftSweepEvent.segmentIndex,i.rightSweepEvent.segmentIndex)}Me.getSegmentIndex=$g;function _E(i,e){if(i.leftSweepEvent.edgeId===e.leftSweepEvent.edgeId)return;let t=new gE.PointToPointLine(i.leftSweepEvent.point,i.rightSweepEvent.point),n=new gE.PointToPointLine(e.leftSweepEvent.point,e.rightSweepEvent.point);return t.intersection(n)}Me.intersectionOfSegments=_E});var al=f(Be=>{"use strict";var $q=Be&&Be.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Xq=Be&&Be.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Be,"__esModule",{value:!0});Be.IntersectionFinder=Be.BY_DESCENDING_X_THEN_DESCENDING_Y=Be.BY_X_THEN_DESCENDING_Y=Be.BY_DESCENDING_X_THEN_Y=Be.BY_X_THEN_Y=Be.isIntersectingRoutedPoint=void 0;var Jq=_(),Zq=Xq(Wg()),Jg=Xg();function vE(i){return i!==void 0&&"intersections"in i&&"kind"in i}Be.isIntersectingRoutedPoint=vE;var Qq=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Be.BY_X_THEN_Y=Qq;var ej=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Be.BY_DESCENDING_X_THEN_Y=ej;var tj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Be.BY_X_THEN_DESCENDING_Y=tj;var nj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Be.BY_DESCENDING_X_THEN_DESCENDING_Y=nj;var Zg=class{apply(e){let t=this.find(e);this.addToRouting(t,e)}find(e){let t=new Zq.default(void 0,Jg.checkWhichEventIsLeft);return e.routes.forEach((n,r)=>{this.isSupportedRoute(n)&&(0,Jg.addRoute)(r,n,t)}),(0,Jg.runSweep)(t)}isSupportedRoute(e){return e.find(t=>t.kind!=="source"&&t.kind!=="target"&&t.kind!=="linear")===void 0}addToRouting(e,t){for(let n of e){let r=t.get(n.routable1),o=t.get(n.routable2);this.addIntersectionToRoutedPoint(n,r,n.segmentIndex1),this.addIntersectionToRoutedPoint(n,o,n.segmentIndex2)}}addIntersectionToRoutedPoint(e,t,n){if(t&&t.length>n){let r=t[n+1];if(vE(r))r.intersections.push(e);else{let o=Object.assign(Object.assign({},r),{intersections:[e]});t[n+1]=o}}}};Zg=$q([(0,Jq.injectable)()],Zg);Be.IntersectionFinder=Zg});var Va=f(Ee=>{"use strict";var Fa=Ee&&Ee.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ll=Ee&&Ee.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ij=Ee&&Ee.__param||function(i,e){return function(t,n){e(t,n,i)}},Qg;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.LocationPostprocessor=Ee.MoveMouseListener=Ee.MorphEdgesAnimation=Ee.MoveAnimation=Ee.MoveCommand=Ee.MoveAction=void 0;var ri=_(),Bi=Q(),Go=te(),ja=rr(),rj=pe(),ul=G(),Na=Ke(),SE=P(),oj=Mt(),sj=Ne(),aj=Sr(),cj=wa(),EE=ae(),bE=Qp(),cl=Ma(),uj=Ud(),De=me(),dl=ln(),dj=Do(),wE=bt(),lj=Tn(),Wo=Oi(),tm;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(tm=Ee.MoveAction||(Ee.MoveAction={}));var La=Qg=class extends rj.MergeableCommand{constructor(e){super(),this.action=e,this.resolvedMoves=new Map,this.edgeMementi=[]}execute(e){let t=e.root.index,n=new Map,r=new Map;return this.action.moves.forEach(o=>{let s=t.getById(o.elementId);if(s instanceof De.SRoutingHandle&&this.edgeRouterRegistry){let a=s.parent;if(a instanceof De.SRoutableElement){let c=this.resolveHandleMove(s,a,o);if(c){let u=n.get(a);u||(u=[],n.set(a,u)),u.push(c)}}}else if(s&&(0,Wo.isLocateable)(s)){let a=this.resolveElementMove(s,o);a&&(this.resolvedMoves.set(a.element.id,a),this.edgeRouterRegistry&&t.getAttachedElements(s).forEach(c=>{if(c instanceof De.SRoutableElement){let u=r.get(c),d=Bi.Point.subtract(a.toPosition,a.fromPosition),l=u?Bi.Point.linear(u,d,.5):d;r.set(c,l)}}))}}),this.doMove(n,r),this.action.animate?(this.undoMove(),new ja.CompoundAnimation(e.root,e,[new $o(e.root,this.resolvedMoves,e,!1),new Xo(e.root,this.edgeMementi,e,!1)]).start()):e.root}resolveHandleMove(e,t,n){let r=n.fromPosition;if(!r){let o=this.edgeRouterRegistry.get(t.routerKind);r=o.getHandlePosition(t,o.route(t),e)}if(r)return{handle:e,fromPosition:r,toPosition:n.toPosition}}resolveElementMove(e,t){let n=t.fromPosition||{x:e.position.x,y:e.position.y};return{element:e,fromPosition:n,toPosition:t.toPosition}}doMove(e,t){this.resolvedMoves.forEach(n=>{n.element.position=n.toPosition}),e.forEach((n,r)=>{let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);o.applyHandleMoves(r,n);let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}),t.forEach((n,r)=>{if(!e.get(r)){let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);if(r.source&&r.target&&this.resolvedMoves.get(r.source.id)&&this.resolvedMoves.get(r.target.id))r.routingPoints=r.routingPoints.map(c=>Bi.Point.add(c,n));else{let c=(0,wE.isSelectable)(r)&&r.selected;o.cleanupRoutingPoints(r,r.routingPoints,c,this.action.finished)}let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}})}undoMove(){this.resolvedMoves.forEach(e=>{e.element.position=e.fromPosition}),this.edgeMementi.forEach(e=>{this.edgeRouterRegistry.get(e.edge.routerKind).applySnapshot(e.edge,e.before)})}undo(e){return new ja.CompoundAnimation(e.root,e,[new $o(e.root,this.resolvedMoves,e,!0),new Xo(e.root,this.edgeMementi,e,!0)]).start()}redo(e){return new ja.CompoundAnimation(e.root,e,[new $o(e.root,this.resolvedMoves,e,!1),new Xo(e.root,this.edgeMementi,e,!1)]).start()}merge(e,t){if(!this.action.animate&&e instanceof Qg)return e.resolvedMoves.forEach((n,r)=>{let o=this.resolvedMoves.get(r);o?o.toPosition=n.toPosition:this.resolvedMoves.set(r,n)}),e.edgeMementi.forEach(n=>{let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}),!0;if(e instanceof uj.ReconnectCommand){let n=e.memento;if(n){let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}return!0}return!1}};La.KIND=tm.KIND;Fa([(0,ri.inject)(dl.EdgeRouterRegistry),(0,ri.optional)(),ll("design:type",dl.EdgeRouterRegistry)],La.prototype,"edgeRouterRegistry",void 0);La=Qg=Fa([(0,ri.injectable)(),ij(0,(0,ri.inject)(SE.TYPES.Action)),ll("design:paramtypes",[Object])],La);Ee.MoveCommand=La;var $o=class extends ja.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementMoves=t,this.reverse=r}tween(e){return this.elementMoves.forEach(t=>{this.reverse?t.element.position={x:(1-e)*t.toPosition.x+e*t.fromPosition.x,y:(1-e)*t.toPosition.y+e*t.fromPosition.y}:t.element.position={x:(1-e)*t.fromPosition.x+e*t.toPosition.x,y:(1-e)*t.fromPosition.y+e*t.toPosition.y}}),this.model}};Ee.MoveAnimation=$o;var Xo=class extends ja.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.reverse=r,this.expanded=[],t.forEach(o=>{let s=this.reverse?o.after:o.before,a=this.reverse?o.before:o.after,c=s.routedPoints,u=a.routedPoints,d=Math.max(c.length,u.length);this.expanded.push({startExpandedRoute:this.growToSize(c,d),endExpandedRoute:this.growToSize(u,d),memento:o})})}midPoint(e){let t=e.edge,n=e.edge.source,r=e.edge.target;return Bi.Point.linear((0,Na.translatePoint)(Bi.Bounds.center(n.bounds),n.parent,t.parent),(0,Na.translatePoint)(Bi.Bounds.center(r.bounds),r.parent,t.parent),.5)}start(){return this.expanded.forEach(e=>{e.memento.edge.removeAll(t=>t instanceof De.SRoutingHandle)}),super.start()}tween(e){return e===1?this.expanded.forEach(t=>{let n=t.memento;this.reverse?n.before.router.applySnapshot(n.edge,n.before):n.after.router.applySnapshot(n.edge,n.after)}):this.expanded.forEach(t=>{let n=[];for(let s=1;s<t.startExpandedRoute.length-1;++s)n.push(Bi.Point.linear(t.startExpandedRoute[s],t.endExpandedRoute[s],e));let r=e<.5?t.memento.before:t.memento.after,o=Object.assign(Object.assign({},r),{routingPoints:n,routingHandles:[]});r.router.applySnapshot(t.memento.edge,o)}),this.model}growToSize(e,t){let n=t-e.length;if(n<=0)return e;let r=[];r.push(e[0]);let o=1/(n+1),s=1/(e.length-1),a=1;for(let c=1;c<e.length;++c){let u=s*c,d=0;for(;u>(a+d)*o;)++d;a+=d;for(let l=0;l<d;++l){let S=Bi.Point.linear(e[c-1],e[c],(l+1)/(d+1));r.push(S)}r.push(e[c])}return r}};Ee.MorphEdgesAnimation=Xo;var Ba=class extends oj.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(e,t){if(t.button===0){let n=(0,Na.findParentByFeature)(e,Wo.isMoveable),r=e instanceof De.SRoutingHandle;n!==void 0||r||(0,bE.isCreatingOnDrag)(e)?this.startDragPosition={x:t.pageX,y:t.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,bE.isCreatingOnDrag)(e)?this.startCreatingOnDrag(e,t):r&&this.activateRoutingHandle(e,t)}return[]}startCreatingOnDrag(e,t){let n=[];return n.push(Go.SelectAllAction.create({select:!1})),n.push(e.createAction(De.edgeInProgressID)),n.push(Go.SelectAction.create({selectedElementsIDs:[De.edgeInProgressID]})),n.push(cl.SwitchEditModeAction.create({elementsToActivate:[De.edgeInProgressID]})),n.push(Go.SelectAction.create({selectedElementsIDs:[De.edgeInProgressTargetHandleID]})),n.push(cl.SwitchEditModeAction.create({elementsToActivate:[De.edgeInProgressTargetHandleID]})),n}activateRoutingHandle(e,t){return[cl.SwitchEditModeAction.create({elementsToActivate:[e.id]})]}mouseMove(e,t){let n=[];if(t.buttons===0)this.mouseUp(e,t);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(e.root),this.hasDragged=!0;let r=this.getElementMoves(e,t,!1);r&&n.push(r)}return n}collectStartPositions(e){let t=new Set(e.index.all().filter(n=>(0,wE.isSelectable)(n)&&n.selected));t.forEach(n=>{if(!this.isChildOfSelected(t,n)){if((0,Wo.isMoveable)(n))this.elementId2startPos.set(n.id,n.position);else if(n instanceof De.SRoutingHandle){let r=this.getHandlePosition(n);r&&this.elementId2startPos.set(n.id,r)}}})}isChildOfSelected(e,t){for(;t instanceof ul.SChildElement;)if(t=t.parent,(0,Wo.isMoveable)(t)&&e.has(t))return!0;return!1}getElementMoves(e,t,n){if(!this.startDragPosition)return;let r=[],o=(0,Na.findParentByFeature)(e,lj.isViewport),s=o?o.zoom:1,a={x:(t.pageX-this.startDragPosition.x)/s,y:(t.pageY-this.startDragPosition.y)/s};if(this.elementId2startPos.forEach((c,u)=>{let d=e.root.index.getById(u);if(d){let l=this.createElementMove(d,c,a,t);l&&r.push(l)}}),r.length>0)return tm.create(r,{animate:!1,finished:n})}createElementMove(e,t,n,r){let o=this.snap({x:t.x+n.x,y:t.y+n.y},e,!r.shiftKey);if((0,Wo.isMoveable)(e))return{elementId:e.id,elementType:e.type,fromPosition:{x:e.position.x,y:e.position.y},toPosition:o};if(e instanceof De.SRoutingHandle){let s=this.getHandlePosition(e);if(s!==void 0)return{elementId:e.id,elementType:e.type,fromPosition:s,toPosition:o}}}snap(e,t,n){return n&&this.snapper?this.snapper.snap(e,t):e}getHandlePosition(e){if(this.edgeRouterRegistry){let t=e.parent;if(!(t instanceof De.SRoutableElement))return;let n=this.edgeRouterRegistry.get(t.routerKind),r=n.route(t);return n.getHandlePosition(t,r,e)}}mouseEnter(e,t){return e instanceof ul.SModelRoot&&t.buttons===0&&!this.startDragPosition&&this.mouseUp(e,t),[]}mouseUp(e,t){let n=[];if(this.startDragPosition){let r=this.getElementMoves(e,t,!0);r&&n.push(r),e.root.index.all().forEach(o=>{o instanceof De.SRoutingHandle&&n.push(...this.deactivateRoutingHandle(o,e,t))})}if(!n.some(r=>r.kind===Go.ReconnectAction.KIND)){let r=e.root.index.getById(De.edgeInProgressID);r instanceof ul.SChildElement&&n.push(this.deleteEdgeInProgress(r))}return this.hasDragged&&n.push(cj.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),n}deactivateRoutingHandle(e,t,n){let r=[],o=e.parent;if(o instanceof De.SRoutableElement&&e.danglingAnchor){let s=this.getHandlePosition(e);if(s){let a=(0,Na.translatePoint)(s,e.parent,e.root),c=(0,EE.findChildrenAtPosition)(t.root,a).find(u=>(0,De.isConnectable)(u)&&u.canConnect(o,e.kind));c&&this.hasDragged&&r.push(Go.ReconnectAction.create({routableId:e.parent.id,newSourceId:e.kind==="source"?c.id:o.sourceId,newTargetId:e.kind==="target"?c.id:o.targetId}))}}return e.editMode&&r.push(cl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),r}deleteEdgeInProgress(e){let t=[];return t.push(De.edgeInProgressID),e.children.forEach(n=>{n instanceof De.SRoutingHandle&&n.danglingAnchor&&t.push(n.danglingAnchor.id)}),Go.DeleteElementAction.create(t)}decorate(e,t){return e}};Fa([(0,ri.inject)(dl.EdgeRouterRegistry),(0,ri.optional)(),ll("design:type",dl.EdgeRouterRegistry)],Ba.prototype,"edgeRouterRegistry",void 0);Fa([(0,ri.inject)(SE.TYPES.ISnapper),(0,ri.optional)(),ll("design:type",Object)],Ba.prototype,"snapper",void 0);Ee.MoveMouseListener=Ba;var em=class{decorate(e,t){if((0,dj.isEdgeLayoutable)(t)&&t.parent instanceof aj.SEdge)return e;let n="";if((0,Wo.isLocateable)(t)&&t instanceof ul.SChildElement&&t.parent!==void 0){let r=t.position;(r.x!==0||r.y!==0)&&(n="translate("+r.x+", "+r.y+")")}if((0,EE.isAlignable)(t)){let r=t.alignment;(r.x!==0||r.y!==0)&&(n.length>0&&(n+=" "),n+="translate("+r.x+", "+r.y+")")}return n.length>0&&(0,sj.setAttr)(e,"transform",n),e}postUpdate(){}};em=Fa([(0,ri.injectable)()],em);Ee.LocationPostprocessor=em});var PE=f(Jo=>{"use strict";var fj=Jo&&Jo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Jo,"__esModule",{value:!0});Jo.CenterGridSnapper=void 0;var hj=_(),pj=ae(),nm=class{get gridX(){return 10}get gridY(){return 10}snap(e,t){return t&&(0,pj.isBoundsAware)(t)?{x:Math.round((e.x+.5*t.bounds.width)/this.gridX)*this.gridX-.5*t.bounds.width,y:Math.round((e.y+.5*t.bounds.height)/this.gridY)*this.gridY-.5*t.bounds.height}:{x:Math.round(e.x/this.gridX)*this.gridX,y:Math.round(e.y/this.gridY)*this.gridY}}};nm=fj([(0,hj.injectable)()],nm);Jo.CenterGridSnapper=nm});var im=f(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.isOpenable=Ar.openFeature=void 0;Ar.openFeature=Symbol("openFeature");function gj(i){return i.hasFeature(Ar.openFeature)}Ar.isOpenable=gj});var om=f(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.OpenMouseListener=void 0;var mj=te(),yj=Mt(),_j=Ke(),vj=im(),rm=class extends yj.MouseListener{doubleClick(e,t){let n=(0,_j.findParentByFeature)(e,vj.isOpenable);return n!==void 0?[mj.OpenAction.create(n.id)]:[]}};fl.OpenMouseListener=rm});var gl=f(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.getModelBounds=Nn.getProjectedBounds=Nn.getProjections=Nn.isProjectable=void 0;var bj=Q(),Sj=yn(),IE=Ke(),pl=ae();function RE(i){return(0,Sj.hasOwnProperty)(i,"projectionCssClasses")}Nn.isProjectable=RE;function ME(i){let e;for(let t of i.children){if(RE(t)&&t.projectionCssClasses.length>0){let n=OE(t);if(n){let r={elementId:t.id,projectedBounds:n,cssClasses:t.projectionCssClasses};e?e.push(r):e=[r]}}if(t.children.length>0){let n=ME(t);n&&(e?e.push(...n):e=n)}}return e}Nn.getProjections=ME;function OE(i){let e=i.parent;if(i.projectedBounds){let t=i.projectedBounds;return(0,pl.isBoundsAware)(e)&&(t=(0,IE.transformToRootBounds)(e,t)),t}else if((0,pl.isBoundsAware)(i)){let t=i.bounds;return t=(0,IE.transformToRootBounds)(e,t),t}}Nn.getProjectedBounds=OE;var hl=1e9;function Ej(i){let e=hl,t=hl,n=-hl,r=-hl,o=(0,pl.isBoundsAware)(i)?i.bounds:void 0;if(o&&bj.Dimension.isValid(o))e=o.x,t=o.y,n=e+o.width,r=t+o.height;else for(let s of i.children)if((0,pl.isBoundsAware)(s)){let a=s.bounds;e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x+a.width),r=Math.max(r,a.y+a.height)}if(e=Math.min(e,i.scroll.x),t=Math.min(t,i.scroll.y),n=Math.max(n,i.scroll.x+i.canvasBounds.width/i.zoom),r=Math.max(r,i.scroll.y+i.canvasBounds.height/i.zoom),e<n&&t<r)return{x:e,y:t,width:n-e,height:r-t}}Nn.getModelBounds=Ej});var xE=f(Zo=>{"use strict";var wj=Zo&&Zo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Zo,"__esModule",{value:!0});Zo.ProjectedViewportView=void 0;var ml=Ut(),Pj=_(),TE=co(),AE=Ne(),CE=gl(),sm=class{render(e,t,n){let r=(0,ml.html)("div",{"class-sprotty-root":!0},this.renderSvg(e,t,n),this.renderProjections(e,t,n));return(0,AE.setAttr)(r,"tabindex",0),r}renderSvg(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`,o="http://www.w3.org/2000/svg";return(0,TE.h)("svg",{ns:o},(0,TE.h)("g",{ns:o,attrs:{transform:r}},t.renderChildren(e)))}renderProjections(e,t,n){var r;if(e.zoom<=0)return[];let o=(0,CE.getModelBounds)(e);if(!o)return[];let s=(r=(0,CE.getProjections)(e))!==null&&r!==void 0?r:[];return[this.renderProjectionBar(s,e,o,"vertical"),this.renderProjectionBar(s,e,o,"horizontal")]}renderProjectionBar(e,t,n,r){let o={modelBounds:n,orientation:r};return o.factor=r==="horizontal"?t.canvasBounds.width/n.width:t.canvasBounds.height/n.height,o.zoomedFactor=o.factor/t.zoom,(0,ml.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":r==="horizontal","class-vertical":r==="vertical"},this.renderViewport(t,o),e.map(s=>this.renderProjection(s,t,o)))}renderViewport(e,t){let n,r;t.orientation==="horizontal"?(n=e.canvasBounds.width,r=(e.scroll.x-t.modelBounds.x)*t.factor):(n=e.canvasBounds.height,r=(e.scroll.y-t.modelBounds.y)*t.factor);let o=n*t.zoomedFactor;r<0?(o+=r,r=0):r>n&&(r=n),o<0?o=0:r+o>n&&(o=n-r);let s=t.orientation==="horizontal"?{left:`${r}px`,width:`${o}px`}:{top:`${r}px`,height:`${o}px`};return(0,ml.html)("div",{"class-sprotty-viewport":!0,style:s})}renderProjection(e,t,n){let r,o,s;n.orientation==="horizontal"?(r=t.canvasBounds.width,o=(e.projectedBounds.x-n.modelBounds.x)*n.factor,s=e.projectedBounds.width*n.factor):(r=t.canvasBounds.height,o=(e.projectedBounds.y-n.modelBounds.y)*n.factor,s=e.projectedBounds.height*n.factor),o<0?(s+=o,o=0):o>r&&(o=r),s<0?s=0:o+s>r&&(s=r-o);let a=n.orientation==="horizontal"?{left:`${o}px`,width:`${s}px`}:{top:`${o}px`,height:`${s}px`},c=(0,ml.html)("div",{id:`${n.orientation}-projection:${e.elementId}`,"class-sprotty-projection":!0,style:a});return e.cssClasses.forEach(u=>(0,AE.setClass)(c,u,!0)),c}};sm=wj([(0,Pj.injectable)()],sm);Zo.ProjectedViewportView=sm});var yl=f(Ln=>{"use strict";var fm=Ln&&Ln.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ln,"__esModule",{value:!0});Ln.DiamondAnchor=Ln.RectangleAnchor=Ln.EllipseAnchor=void 0;var hm=ei(),am=Pr(),pm=_(),gm=ya(),Qo=Q(),cm=class{get kind(){return gm.PolylineEdgeRouter.KIND+":"+hm.ELLIPTIC_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=Qo.Bounds.center(r),s=o.x-t.x,a=o.y-t.y,c=Math.sqrt(s*s+a*a),u=s/c||0,d=a/c||0;return{x:o.x-u*(.5*r.width+n),y:o.y-d*(.5*r.height+n)}}};cm=fm([(0,pm.injectable)()],cm);Ln.EllipseAnchor=cm;var um=class{get kind(){return gm.PolylineEdgeRouter.KIND+":"+hm.RECTANGULAR_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=Qo.Bounds.center(r),s=new dm(o,t);if(!(0,Qo.almostEquals)(o.y,t.y)){let a=this.getXIntersection(r.y,o,t);a>=r.x&&a<=r.x+r.width&&s.addCandidate(a,r.y-n);let c=this.getXIntersection(r.y+r.height,o,t);c>=r.x&&c<=r.x+r.width&&s.addCandidate(c,r.y+r.height+n)}if(!(0,Qo.almostEquals)(o.x,t.x)){let a=this.getYIntersection(r.x,o,t);a>=r.y&&a<=r.y+r.height&&s.addCandidate(r.x-n,a);let c=this.getYIntersection(r.x+r.width,o,t);c>=r.y&&c<=r.y+r.height&&s.addCandidate(r.x+r.width+n,c)}return s.best}getXIntersection(e,t,n){let r=(e-t.y)/(n.y-t.y);return(n.x-t.x)*r+t.x}getYIntersection(e,t,n){let r=(e-t.x)/(n.x-t.x);return(n.y-t.y)*r+t.y}};um=fm([(0,pm.injectable)()],um);Ln.RectangleAnchor=um;var dm=class{constructor(e,t){this.centerPoint=e,this.refPoint=t,this.currentDist=-1}addCandidate(e,t){let n=this.refPoint.x-e,r=this.refPoint.y-t,o=n*n+r*r;(this.currentDist<0||o<this.currentDist)&&(this.currentBest={x:e,y:t},this.currentDist=o)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}},lm=class{get kind(){return gm.PolylineEdgeRouter.KIND+":"+hm.DIAMOND_ANCHOR_KIND}getAnchor(e,t,n){let r=e.bounds,o=new am.PointToPointLine(Qo.Bounds.center(r),t),s=new am.Diamond(r).closestSideLine(t),a=(0,am.intersection)(s,o);return Qo.Point.shiftTowards(a,t,n)}};lm=fm([(0,pm.injectable)()],lm);Ln.DiamondAnchor=lm});var Sl=f(ke=>{"use strict";var NE=ke&&ke.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ij=ke&&ke.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},DE=ke&&ke.__param||function(i,e){return function(t,n){e(t,n,i)}},Ka;Object.defineProperty(ke,"__esModule",{value:!0});ke.AddRemoveBezierSegmentCommand=ke.AddRemoveBezierSegmentAction=ke.BezierMouseListener=ke.BezierEdgeRouter=void 0;var _l=_(),qE=Q(),Fi=me(),jE=ln(),Rj=ga(),Mj=Mt(),Oj=pe(),Tj=P(),es=Ka=class extends Rj.AbstractEdgeRouter{get kind(){return Ka.KIND}route(e){if(!e.source||!e.target)return[];let t=e.routingPoints.length,n=e.source,r=e.target,o=[];if(o.push({kind:"source",x:0,y:0}),t===0){let[d,l]=this.createDefaultBezierHandles(n.position,r.position);o.push({kind:"bezier-control-after",x:d.x,y:d.y,pointIndex:0}),o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:1}),e.routingPoints.push(d),e.routingPoints.push(l)}else if(t>=2)for(let d=0;d<t;d++){let l=e.routingPoints[d];d%3===0&&o.push({kind:"bezier-control-after",x:l.x,y:l.y,pointIndex:d}),(d+1)%3===0?o.push({kind:"bezier-junction",x:l.x,y:l.y,pointIndex:d}):(d+2)%3===0&&o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:d})}o.push({kind:"target",x:0,y:0});let s=t>2?e.routingPoints[2]:r.position,a=t>2?e.routingPoints[e.routingPoints.length-3]:n.position,c=this.getTranslatedAnchor(n,s,r.parent,e,e.sourceAnchorCorrection),u=this.getTranslatedAnchor(r,a,n.parent,e,e.targetAnchorCorrection);return o[0]={kind:"source",x:c.x,y:c.y},o[o.length-1]={kind:"target",x:u.x,y:u.y},o}createDefaultBezierHandles(e,t){let n={x:e.x-Ka.DEFAULT_BEZIER_HANDLE_OFFSET,y:e.y},r={x:t.x+Ka.DEFAULT_BEZIER_HANDLE_OFFSET,y:t.y};return[n,r]}createRoutingHandles(e){this.route(e),this.rebuildHandles(e)}rebuildHandles(e){this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"bezier-control-after","bezier-routing-point",0),this.addHandle(e,"bezier-add","bezier-create-routing-point",0);let t=e.routingPoints.length;if(t>2)for(let n=1;n<t-1;n+=3)this.addHandle(e,"bezier-control-before","bezier-routing-point",n),this.addHandle(e,"bezier-add","bezier-create-routing-point",n+1),this.addHandle(e,"bezier-junction","routing-point",n+1),this.addHandle(e,"bezier-remove","bezier-remove-routing-point",n+1),this.addHandle(e,"bezier-control-after","bezier-routing-point",n+2),this.moveBezierControlPair(e.routingPoints[n],n,e);this.addHandle(e,"bezier-control-before","bezier-routing-point",t-1),this.addHandle(e,"target","routing-point",-1)}getInnerHandlePosition(e,t,n){if(n.kind==="bezier-control-before"||n.kind==="bezier-junction"||n.kind==="bezier-control-after")for(let r=0;r<t.length;r++){let o=t[r];if(o.pointIndex===n.pointIndex&&o.kind===n.kind)return o}else if(n.kind==="bezier-add"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y+12.5}}else if(n.kind==="bezier-remove"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y-12.5}}}findBezierControl(e,t,n){let r={x:t[0].x,y:t[0].y};if(n>0){for(let o of t)if(o.pointIndex!==void 0&&o.pointIndex===n&&o.kind==="bezier-junction"){r={x:o.x,y:o.y};break}}return r}applyHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o={x:0,y:0},s,a,c,u=n.toPosition;switch(r.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(u,n.handle.pointIndex,e);break;case"bezier-junction":let d=r.pointIndex;d>=0&&d<e.routingPoints.length&&(c=d-1,o=e.routingPoints[d],s=e.routingPoints[c],a=this.calcRelativeMove(o,u,s),e.routingPoints[d]=u,this.moveBezierControlPair(a,c,e));break;case"source":if(c=0,s=e.routingPoints[c],e.source instanceof Fi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Fi.SDanglingAnchor;l.id=e.id+"_dangling-source",l.original=e.source,l.position=n.toPosition,r.root.add(l),r.danglingAnchor=l,e.sourceId=l.id,e.source&&(o=e.source.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;case"target":if(c=e.routingPoints.length-1,s=e.routingPoints[c],e.target instanceof Fi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Fi.SDanglingAnchor;l.id=e.id+"_dangling-target",l.original=e.target,l.position=u,r.root.add(l),r.danglingAnchor=l,e.targetId=l.id,e.target&&(o=e.target.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;default:break}})}applyInnerHandleMoves(e,t){}getOptions(e){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(e,t,n){return{x:n.x-(e.x-t.x),y:n.y-(e.y-t.y)}}createNewBezierSegment(e,t){let n=t.routingPoints,r,o,s;n.length===2?(o=n[e<0?0:e],s=n[n.length-1],r=(0,qE.centerOfLine)(o,s)):(o=n[e],s=n[e+2],r=(0,qE.centerOfLine)(o,s));let[a,c]=this.createDefaultBezierHandles(r,r);n.splice(e+1,0,a),n.splice(e+2,0,r),n.splice(e+3,0,c),this.moveBezierControlPair(a,e+1,t),t.removeAll(u=>u instanceof Fi.SRoutingHandle),this.rebuildHandles(t)}removeBezierSegment(e,t){t.routingPoints.splice(e-1,3),t.removeAll(r=>r instanceof Fi.SRoutingHandle),this.rebuildHandles(t)}moveBezierControlPair(e,t,n){if(t>=0&&t<n.routingPoints.length){let r=t-1,o=t+1;r<0||o===n.routingPoints.length?n.routingPoints[t]=e:t%3===0?this.setBezierMirror(n,e,t,!1):(t+2)%3===0&&this.setBezierMirror(n,e,t,!0)}}setBezierMirror(e,t,n,r){e.routingPoints[n]=t;let o=e.routingPoints[r?n+1:n-1];e.routingPoints[r?n+2:n-2]={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)}}};es.KIND="bezier";es.DEFAULT_BEZIER_HANDLE_OFFSET=25;es=Ka=NE([(0,_l.injectable)()],es);ke.BezierEdgeRouter=es;var mm=class extends Mj.MouseListener{mouseDown(e,t){let n=[];return e instanceof Fi.SRoutingHandle&&(e.kind==="bezier-add"||e.kind==="bezier-remove")&&(e.type==="bezier-create-routing-point"?n.push(vl.create("add",e.id)):e.type==="bezier-remove-routing-point"&&n.push(vl.create("remove",e.id))),n}};ke.BezierMouseListener=mm;var vl;(function(i){i.KIND="addRemoveBezierSegment";function e(t,n){return{kind:i.KIND,actionTask:t,targetId:n}}i.create=e})(vl=ke.AddRemoveBezierSegmentAction||(ke.AddRemoveBezierSegmentAction={}));var bl=class extends Oj.Command{constructor(e,t){super(),this.action=e,this.edgeRouterRegistry=t}execute(e){let n=e.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&n instanceof Fi.SRoutingHandle){let r=this.edgeRouterRegistry.get(n.parent.routerKind);if(r instanceof es){let o=r;for(let s of e.root.children)if(s.id===n.parent.id){this.action.actionTask==="add"?o.createNewBezierSegment(n.pointIndex,s):this.action.actionTask==="remove"&&o.removeBezierSegment(n.pointIndex,s);break}}}return e.root}undo(e){throw new Error("Method not implemented.")}redo(e){throw new Error("Method not implemented.")}};bl.KIND=vl.KIND;bl=NE([(0,_l.injectable)(),DE(0,(0,_l.inject)(Tj.TYPES.Action)),DE(1,(0,_l.inject)(jE.EdgeRouterRegistry)),Ij("design:paramtypes",[Object,jE.EdgeRouterRegistry])],bl);ke.AddRemoveBezierSegmentCommand=bl});var Im=f(Bn=>{"use strict";var bm=Bn&&Bn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.BezierDiamondAnchor=Bn.BezierRectangleAnchor=Bn.BezierEllipseAnchor=void 0;var Sm=ei(),Em=_(),wm=yl(),Pm=Sl(),ym=class extends wm.EllipseAnchor{get kind(){return Pm.BezierEdgeRouter.KIND+":"+Sm.ELLIPTIC_ANCHOR_KIND}};ym=bm([(0,Em.injectable)()],ym);Bn.BezierEllipseAnchor=ym;var _m=class extends wm.RectangleAnchor{get kind(){return Pm.BezierEdgeRouter.KIND+":"+Sm.RECTANGULAR_ANCHOR_KIND}};_m=bm([(0,Em.injectable)()],_m);Bn.BezierRectangleAnchor=_m;var vm=class extends wm.DiamondAnchor{get kind(){return Pm.BezierEdgeRouter.KIND+":"+Sm.DIAMOND_ANCHOR_KIND}};vm=bm([(0,Em.injectable)()],vm);Bn.BezierDiamondAnchor=vm});var wl=f(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});El.ManhattanEdgeRouter=void 0;var ye=Q(),LE=Ke(),b=ga(),Rm=me(),ts=class extends b.AbstractEdgeRouter{get kind(){return ts.KIND}getOptions(e){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(e){if(!e.source||!e.target)return[];let t=this.createRoutedCorners(e),n=t[0]||(0,LE.translatePoint)(ye.Bounds.center(e.target.bounds),e.target.parent,e.parent),r=this.getTranslatedAnchor(e.source,n,e.parent,e,e.sourceAnchorCorrection),o=t[t.length-1]||(0,LE.translatePoint)(ye.Bounds.center(e.source.bounds),e.source.parent,e.parent),s=this.getTranslatedAnchor(e.target,o,e.parent,e,e.targetAnchorCorrection);if(!r||!s)return[];let a=[];return a.push(Object.assign({kind:"source"},r)),t.forEach(c=>a.push(c)),a.push(Object.assign({kind:"target"},s)),a}createRoutedCorners(e){let t=new b.DefaultAnchors(e.source,e.parent,"source"),n=new b.DefaultAnchors(e.target,e.parent,"target");if(e.routingPoints.length>0){let s=e.routingPoints.slice();if(this.cleanupRoutingPoints(e,s,!1,!0),s.length>0)return s.map((a,c)=>Object.assign({kind:"linear",pointIndex:c},a))}let r=this.getOptions(e);return this.calculateDefaultCorners(e,t,n,r).map(s=>Object.assign({kind:"linear"},s))}createRoutingHandles(e){let t=this.route(e);if(this.commitRoute(e,t),t.length>0){this.addHandle(e,"source","routing-point",-2);for(let n=0;n<t.length-1;++n)this.addHandle(e,"manhattan-50%","volatile-routing-point",n-1);this.addHandle(e,"target","routing-point",t.length-2)}}getInnerHandlePosition(e,t,n){let r=this.getFraction(n.kind);if(r!==void 0){let{start:o,end:s}=this.findRouteSegment(e,t,n.pointIndex);if(o!==void 0&&s!==void 0)return ye.Point.linear(o,s,r)}}getFraction(e){switch(e){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(e,t){let n=this.route(e),r=e.routingPoints,o=this.getOptions(e).minimalPointDistance;t.forEach(s=>{let a=s.handle,c=a.pointIndex,u=this.correctX(r,c,s.toPosition.x,o),d=this.correctY(r,c,s.toPosition.y,o);switch(a.kind){case"manhattan-50%":c<0?(0,ye.almostEquals)(n[0].x,n[1].x)?this.alignX(r,0,u):this.alignY(r,0,d):c<r.length-1?(0,ye.almostEquals)(r[c].x,r[c+1].x)?(this.alignX(r,c,u),this.alignX(r,c+1,u)):(this.alignY(r,c,d),this.alignY(r,c+1,d)):(0,ye.almostEquals)(n[n.length-2].x,n[n.length-1].x)?this.alignX(r,r.length-1,u):this.alignY(r,r.length-1,d);break}})}correctX(e,t,n,r){return t>0&&Math.abs(n-e[t-1].x)<r?e[t-1].x:t<e.length-2&&Math.abs(n-e[t+2].x)<r?e[t+2].x:n}alignX(e,t,n){t>=0&&t<e.length&&(e[t]={x:n,y:e[t].y})}correctY(e,t,n,r){return t>0&&Math.abs(n-e[t-1].y)<r?e[t-1].y:t<e.length-2&&Math.abs(n-e[t+2].y)<r?e[t+2].y:n}alignY(e,t,n){t>=0&&t<e.length&&(e[t]={x:e[t].x,y:n})}cleanupRoutingPoints(e,t,n,r){let o=new b.DefaultAnchors(e.source,e.parent,"source"),s=new b.DefaultAnchors(e.target,e.parent,"target");if(!this.resetRoutingPointsOnReconnect(e,t,n,o,s)){for(let a=0;a<t.length&&ye.Bounds.includes(o.bounds,t[a]);++a)t.splice(0,1),n&&this.removeHandle(e,-1);for(let a=t.length-1;a>=0&&ye.Bounds.includes(s.bounds,t[a]);--a)t.splice(a,1),n&&this.removeHandle(e,a);if(t.length>=2){let a=this.getOptions(e);for(let c=t.length-2;c>=0;--c)ye.Point.manhattanDistance(t[c],t[c+1])<a.minimalPointDistance&&(t.splice(c,2),--c,n&&(this.removeHandle(e,c-1),this.removeHandle(e,c)))}r&&(this.addAdditionalCorner(e,t,o,s,n),this.addAdditionalCorner(e,t,s,o,n),this.manhattanify(e,t))}}removeHandle(e,t){let n=[];e.children.forEach(r=>{r instanceof Rm.SRoutingHandle&&(r.pointIndex>t?--r.pointIndex:r.pointIndex===t&&n.push(r))}),n.forEach(r=>e.remove(r))}addAdditionalCorner(e,t,n,r,o){if(t.length===0)return;let s=n.kind==="source"?t[0]:t[t.length-1],a=n.kind==="source"?0:t.length,c=a-(n.kind==="source"?1:0),u;if(t.length>1)u=a===0?(0,ye.almostEquals)(t[0].x,t[1].x):(0,ye.almostEquals)(t[t.length-1].x,t[t.length-2].x);else{let d=r.getNearestSide(s);u=d===b.Side.TOP||d===b.Side.BOTTOM}if(u){if(s.y<n.get(b.Side.TOP).y||s.y>n.get(b.Side.BOTTOM).y){let d={x:n.get(b.Side.TOP).x,y:s.y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Rm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}else if(s.x<n.get(b.Side.LEFT).x||s.x>n.get(b.Side.RIGHT).x){let d={x:s.x,y:n.get(b.Side.LEFT).y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Rm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}manhattanify(e,t){for(let n=1;n<t.length;++n){let r=Math.abs(t[n-1].x-t[n].x)<1,o=Math.abs(t[n-1].y-t[n].y)<1;!r&&!o&&(t.splice(n,0,{x:t[n-1].x,y:t[n].y}),++n)}}calculateDefaultCorners(e,t,n,r){let o=super.calculateDefaultCorners(e,t,n,r);if(o.length>0)return o;let s=this.getBestConnectionAnchors(e,t,n,r),a=s.source,c=s.target,u=[],d=t.get(a),l=n.get(c);switch(a){case b.Side.RIGHT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;case b.Side.RIGHT:u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:d.y}),u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:l.y});break;case b.Side.LEFT:l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.LEFT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;default:l=n.get(b.Side.RIGHT),l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.TOP:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.TOP:u.push({x:d.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance}),u.push({x:l.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance});break;case b.Side.BOTTOM:l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break;case b.Side.BOTTOM:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;default:l=n.get(b.Side.TOP),l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break}return u}getBestConnectionAnchors(e,t,n,r){let o=t.get(b.Side.RIGHT),s=n.get(b.Side.LEFT);if(s.x-o.x>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.LEFT};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.RIGHT),o.x-s.x>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.RIGHT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.BOTTOM),o.y-s.y>r.standardDistance)return{source:b.Side.TOP,target:b.Side.BOTTOM};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.TOP),s.y-o.y>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.TOP};if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.TOP),s.x-o.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.TOP};if(s=n.get(b.Side.BOTTOM),s.x-o.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.BOTTOM};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.BOTTOM),o.x-s.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.BOTTOM};if(s=n.get(b.Side.TOP),o.x-s.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.TOP};if(o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),o.y-s.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),o.y-s.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.LEFT};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),s.y-o.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),s.y-o.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.LEFT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.TOP),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)){if(o.y-s.y<0){if(Math.abs(o.x-s.x)>(t.bounds.width+r.standardDistance)/2)return{source:b.Side.TOP,target:b.Side.TOP}}else if(Math.abs(o.x-s.x)>n.bounds.width/2)return{source:b.Side.TOP,target:b.Side.TOP}}if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)){if(o.x-s.x>0){if(Math.abs(o.y-s.y)>(t.bounds.height+r.standardDistance)/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}else if(Math.abs(o.y-s.y)>n.bounds.height/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}return o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.LEFT}:(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.LEFT}:{source:b.Side.RIGHT,target:b.Side.BOTTOM})))}};El.ManhattanEdgeRouter=ts;ts.KIND="manhattan"});var qm=f(Fn=>{"use strict";var Am=Fn&&Fn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Mm,Om,Tm;Object.defineProperty(Fn,"__esModule",{value:!0});Fn.ManhattanEllipticAnchor=Fn.ManhattanDiamondAnchor=Fn.ManhattanRectangularAnchor=void 0;var Pl=Q(),Nt=Pr(),Cm=ei(),xm=wl(),Dm=_(),Il=Mm=class{get kind(){return Mm.KIND}getAnchor(e,t,n){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n};return t.x>=o.x&&o.x+o.width>=t.x?t.y<o.y+.5*o.height?{x:t.x,y:o.y}:{x:t.x,y:o.y+o.height}:t.y>=o.y&&o.y+o.height>=t.y?t.x<o.x+.5*o.width?{x:o.x,y:t.y}:{x:o.x+o.width,y:t.y}:Pl.Bounds.center(o)}};Il.KIND=xm.ManhattanEdgeRouter.KIND+":"+Cm.RECTANGULAR_ANCHOR_KIND;Il=Mm=Am([(0,Dm.injectable)()],Il);Fn.ManhattanRectangularAnchor=Il;var Rl=Om=class{get kind(){return Om.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Pl.Bounds.center(o),a,c;return t.x>=o.x&&t.x<=o.x+o.width?o.x+.5*o.width>=t.x?(c=new Nt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Nt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Nt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height})):(c=new Nt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Nt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y}):a=new Nt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height})):t.y>=o.y&&t.y<=o.y+o.height&&(o.y+.5*o.height>=t.y?(c=new Nt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Nt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Nt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y})):(c=new Nt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Nt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height}):a=new Nt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height}))),c&&a?(0,Nt.intersection)(a,c):s}};Rl.KIND=xm.ManhattanEdgeRouter.KIND+":"+Cm.DIAMOND_ANCHOR_KIND;Rl=Om=Am([(0,Dm.injectable)()],Rl);Fn.ManhattanDiamondAnchor=Rl;var Ml=Tm=class{get kind(){return Tm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Pl.Bounds.center(o),a=Pl.Point.subtract(t,s),c=s.x,u=s.y;if(t.x>=o.x&&o.x+o.width>=t.x){c+=a.x;let d=.5*o.height*Math.sqrt(1-a.x*a.x/(.25*o.width*o.width));a.y<0?u-=d:u+=d}else if(t.y>=o.y&&o.y+o.height>=t.y){u+=a.y;let d=.5*o.width*Math.sqrt(1-a.y*a.y/(.25*o.height*o.height));a.x<0?c-=d:c+=d}return{x:c,y:u}}};Ml.KIND=xm.ManhattanEdgeRouter.KIND+":"+Cm.ELLIPTIC_ANCHOR_KIND;Ml=Tm=Am([(0,Dm.injectable)()],Ml);Fn.ManhattanEllipticAnchor=Ml});var Nm=f(ns=>{"use strict";var Aj=ns&&ns.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ns,"__esModule",{value:!0});ns.RoutableView=void 0;var Cj=_(),xj=me(),jm=class{isVisible(e,t,n){if(n.targetKind==="hidden"||t.length===0)return!0;let r=(0,xj.getAbsoluteRouteBounds)(e,t),o=e.root.canvasBounds;return r.x<=o.width&&r.x+r.width>=0&&r.y<=o.height&&r.y+r.height>=0}};jm=Aj([(0,Cj.injectable)()],jm);ns.RoutableView=jm});var Lm=f(Vi=>{"use strict";var BE=Vi&&Vi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Dj=Vi&&Vi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Vi,"__esModule",{value:!0});Vi.ModelRequestCommand=void 0;var FE=_(),qj=P(),jj=pe(),Ol=class extends jj.SystemCommand{execute(e){let t=this.retrieveResult(e);return this.actionDispatcher.dispatch(t),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};BE([(0,FE.inject)(qj.TYPES.IActionDispatcher),Dj("design:type",Object)],Ol.prototype,"actionDispatcher",void 0);Ol=BE([(0,FE.injectable)()],Ol);Vi.ModelRequestCommand=Ol});var Bl=f(re=>{"use strict";var jl=re&&re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nl=re&&re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Km=re&&re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(re,"__esModule",{value:!0});re.SelectKeyboardListener=re.GetSelectionCommand=re.SelectMouseListener=re.SelectAllCommand=re.SelectCommand=re.SelectionResult=re.GetSelectionAction=re.SelectAllAction=re.SelectAction=void 0;var Ki=_(),Ll=te(),HE=pe(),Nj=Lm(),Fm=G(),Bm=Ke(),Hm=P(),Lj=sn(),Bj=Mt(),Fj=Ne(),VE=Pn(),zE=er(),Vj=In(),KE=sa(),Kj=cd(),Tl=Ma(),Hj=me(),Al=me(),oi=bt(),Vn=class{constructor(e=[],t=[]){this.selectedElementsIDs=e,this.deselectedElementsIDs=t,this.kind=Vn.KIND}};re.SelectAction=Vn;Vn.KIND="elementSelected";var Cr=class{constructor(e=!0){this.select=e,this.kind=Cr.KIND}};re.SelectAllAction=Cr;Cr.KIND="allSelected";var YE;(function(i){i.KIND="getSelection";function e(){return{kind:i.KIND,requestId:(0,Ll.generateRequestId)()}}i.create=e})(YE=re.GetSelectionAction||(re.GetSelectionAction={}));var kE;(function(i){i.KIND="selectionResult";function e(t,n){return{kind:i.KIND,selectedElementsIDs:t,responseId:n}}i.create=e})(kE=re.SelectionResult||(re.SelectionResult={}));var Cl=class extends HE.Command{constructor(e){super(),this.action=e,this.selected=[],this.deselected=[]}execute(e){let t=e.root;return this.action.selectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Fm.SChildElement&&(0,oi.isSelectable)(r)&&this.selected.push(r)}),this.action.deselectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Fm.SChildElement&&(0,oi.isSelectable)(r)&&this.deselected.push(r)}),this.redo(e)}undo(e){for(let t of this.selected)t.selected=!1;for(let t of this.deselected)t.selected=!0;return e.root}redo(e){for(let t of this.deselected)t.selected=!1;for(let t of this.selected)t.selected=!0;return e.root}};Cl.KIND=Ll.SelectAction.KIND;Cl=jl([(0,Ki.injectable)(),Km(0,(0,Ki.inject)(Hm.TYPES.Action)),Nl("design:paramtypes",[Object])],Cl);re.SelectCommand=Cl;var xl=class extends HE.Command{constructor(e){super(),this.action=e,this.previousSelection={}}execute(e){return this.selectAll(e.root,this.action.select),e.root}selectAll(e,t){(0,oi.isSelectable)(e)&&(this.previousSelection[e.id]=e.selected,e.selected=t);for(let n of e.children)this.selectAll(n,t)}undo(e){let t=e.root.index;return Object.keys(this.previousSelection).forEach(n=>{let r=t.getById(n);r!==void 0&&(0,oi.isSelectable)(r)&&(r.selected=this.previousSelection[n])}),e.root}redo(e){return this.selectAll(e.root,this.action.select),e.root}};xl.KIND=Ll.SelectAllAction.KIND;xl=jl([(0,Ki.injectable)(),Km(0,(0,Ki.inject)(Hm.TYPES.Action)),Nl("design:paramtypes",[Object])],xl);re.SelectAllCommand=xl;var Dl=class extends Bj.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1}mouseDown(e,t){if(t.button!==0)return[];let n=this.handleButton(e,t);if(n)return n;let r=(0,Bm.findParentByFeature)(e,oi.isSelectable);if(r!==void 0||e instanceof Fm.SModelRoot){this.hasDragged=!1;let o=[];if((0,VE.isCtrlOrCmd)(t)||(o=(0,zE.toArray)(e.root.index.all().filter(s=>(0,oi.isSelectable)(s)&&s.selected&&!(r instanceof Hj.SRoutingHandle&&s===r.parent)))),r!==void 0)if(r.selected){if((0,VE.isCtrlOrCmd)(t))return this.wasSelected=!1,this.handleDeselectTarget(r,t);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(r,o,t);else return this.handleDeselectAll(o,t)}return[]}handleButton(e,t){if(this.buttonHandlerRegistry!==void 0&&e instanceof Kj.SButton&&e.enabled){let n=this.buttonHandlerRegistry.get(e.type);if(n!==void 0)return n.buttonPressed(e)}}handleSelectTarget(e,t,n){let r=[];r.push(new Vn([e.id],t.map(s=>s.id))),r.push(Ll.BringToFrontAction.create([e.id]));let o=t.filter(s=>s instanceof Al.SRoutableElement).map(s=>s.id);return e instanceof Al.SRoutableElement?r.push(Tl.SwitchEditModeAction.create({elementsToActivate:[e.id],elementsToDeactivate:o})):o.length>0&&r.push(Tl.SwitchEditModeAction.create({elementsToDeactivate:o})),r}handleDeselectTarget(e,t){let n=[];return n.push(new Vn([],[e.id])),e instanceof Al.SRoutableElement&&n.push(Tl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),n}handleDeselectAll(e,t){let n=[];n.push(new Vn([],e.map(o=>o.id)));let r=e.filter(o=>o instanceof Al.SRoutableElement).map(o=>o.id);return r.length>0&&n.push(Tl.SwitchEditModeAction.create({elementsToDeactivate:r})),n}mouseMove(e,t){return this.hasDragged=!0,[]}mouseUp(e,t){if(t.button===0&&!this.hasDragged){let n=(0,Bm.findParentByFeature)(e,oi.isSelectable);if(n!==void 0&&this.wasSelected)return[new Vn([n.id],[])]}return this.hasDragged=!1,[]}decorate(e,t){let n=(0,Bm.findParentByFeature)(t,oi.isSelectable);return n!==void 0&&(0,Fj.setClass)(e,"selected",n.selected),e}};jl([(0,Ki.inject)(KE.ButtonHandlerRegistry),(0,Ki.optional)(),Nl("design:type",KE.ButtonHandlerRegistry)],Dl.prototype,"buttonHandlerRegistry",void 0);re.SelectMouseListener=Dl;var ql=class extends Nj.ModelRequestCommand{constructor(e){super(),this.action=e,this.previousSelection={}}retrieveResult(e){let t=e.root.index.all().filter(n=>(0,oi.isSelectable)(n)&&n.selected).map(n=>n.id);return kE.create((0,zE.toArray)(t),this.action.requestId)}};ql.KIND=YE.KIND;ql=jl([(0,Ki.injectable)(),Km(0,(0,Ki.inject)(Hm.TYPES.Action)),Nl("design:paramtypes",[Object])],ql);re.GetSelectionCommand=ql;var Vm=class extends Lj.KeyListener{keyDown(e,t){return(0,Vj.matchesKeystroke)(t,"KeyA","ctrlCmd")?[new Cr]:[]}};re.SelectKeyboardListener=Vm});var km=f(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.UndoRedoKeyListener=Kn.RedoAction=Kn.UndoAction=void 0;var zm=In(),zj=sn(),Yj=Pn(),UE;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(UE=Kn.UndoAction||(Kn.UndoAction={}));var GE;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(GE=Kn.RedoAction||(Kn.RedoAction={}));var Ym=class extends zj.KeyListener{keyDown(e,t){return(0,zm.matchesKeystroke)(t,"KeyZ","ctrlCmd")?[UE.create()]:(0,zm.matchesKeystroke)(t,"KeyZ","ctrlCmd","shift")||!(0,Yj.isMac)()&&(0,zm.matchesKeystroke)(t,"KeyY","ctrlCmd")?[GE.create()]:[]}};Kn.UndoRedoKeyListener=Ym});var Fl=f(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.applyMatches=Hi.ModelMatcher=Hi.forEachMatch=void 0;var Um=G(),kj=cr();function Uj(i,e){Object.keys(i).forEach(t=>e(t,i[t]))}Hi.forEachMatch=Uj;var Gm=class{match(e,t){let n={};return this.matchLeft(e,n),this.matchRight(t,n),n}matchLeft(e,t,n){let r=t[e.id];if(r!==void 0?(r.left=e,r.leftParentId=n):(r={left:e,leftParentId:n},t[e.id]=r),(0,Um.isParent)(e))for(let o of e.children)this.matchLeft(o,t,e.id)}matchRight(e,t,n){let r=t[e.id];if(r!==void 0?(r.right=e,r.rightParentId=n):(r={right:e,rightParentId:n},t[e.id]=r),(0,Um.isParent)(e))for(let o of e.children)this.matchRight(o,t,e.id)}};Hi.ModelMatcher=Gm;function Gj(i,e,t){i instanceof Um.SModelRoot?t=i.index:t===void 0&&(t=new kj.SModelIndex,t.add(i));for(let n of e){let r=!1;if(n.left!==void 0&&n.leftParentId!==void 0){let o=t.getById(n.leftParentId);if(o!==void 0&&o.children!==void 0){let s=o.children.indexOf(n.left);s>=0&&(n.right!==void 0&&n.leftParentId===n.rightParentId?(o.children.splice(s,1,n.right),r=!0):o.children.splice(s,1)),t.remove(n.left)}}if(!r&&n.right!==void 0&&n.rightParentId!==void 0){let o=t.getById(n.rightParentId);o!==void 0&&(o.children===void 0&&(o.children=[]),o.children.push(n.right))}}}Hi.applyMatches=Gj});var WE=f(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});Vl.ResizeAnimation=void 0;var Wj=rr(),Wm=class extends Wj.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementResizes=t,this.reverse=r}tween(e){return this.elementResizes.forEach(t=>{let n=t.element,r=this.reverse?{width:(1-e)*t.toDimension.width+e*t.fromDimension.width,height:(1-e)*t.toDimension.height+e*t.fromDimension.height}:{width:(1-e)*t.fromDimension.width+e*t.toDimension.width,height:(1-e)*t.fromDimension.height+e*t.toDimension.height};n.bounds={x:n.bounds.x,y:n.bounds.y,width:r.width,height:r.height}}),this.model}};Vl.ResizeAnimation=Wm});var Hl=f(tn=>{"use strict";var sw=tn&&tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},aw=tn&&tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},$j=tn&&tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.UpdateModelCommand=tn.UpdateModelAction=void 0;var Kl=_(),Xj=te(),is=Q(),$E=rr(),Jj=pe(),Zj=tl(),rs=G(),XE=Va(),JE=Oo(),ZE=Oi(),QE=ae(),ew=wd(),tw=bt(),nw=Fl(),Qj=WE(),eN=P(),iw=Tn(),rw=ln(),ow=me(),tN=Ke(),os=class{constructor(e,t=!0,n){this.animate=t,this.cause=n,this.kind=os.KIND,e.id!==void 0?this.newRoot=e:this.matches=e}};tn.UpdateModelAction=os;os.KIND="updateModel";var Ha=class extends Jj.Command{constructor(e){super(),this.action=e}execute(e){let t;return this.action.newRoot!==void 0?t=e.modelFactory.createRoot(this.action.newRoot):(t=e.modelFactory.createRoot(e.root),this.action.matches!==void 0&&this.applyMatches(t,this.action.matches,e)),this.oldRoot=e.root,this.newRoot=t,this.performUpdate(this.oldRoot,this.newRoot,e)}performUpdate(e,t,n){if((this.action.animate===void 0||this.action.animate)&&e.id===t.id){let r;this.action.matches===void 0?r=new nw.ModelMatcher().match(e,t):r=this.convertToMatchResult(this.action.matches,e,t);let o=this.computeAnimation(t,r,n);return o instanceof $E.Animation?o.start():o}else return e.type===t.type&&is.Dimension.isValid(e.canvasBounds)&&(t.canvasBounds=e.canvasBounds),(0,iw.isViewport)(e)&&(0,iw.isViewport)(t)&&(t.zoom=e.zoom,t.scroll=e.scroll),t}applyMatches(e,t,n){let r=e.index;for(let o of t)if(o.left!==void 0){let s=r.getById(o.left.id);s instanceof rs.SChildElement&&s.parent.remove(s)}for(let o of t)if(o.right!==void 0){let s=n.modelFactory.createElement(o.right),a;o.rightParentId!==void 0&&(a=r.getById(o.rightParentId)),a instanceof rs.SParentElement?a.add(s):e.add(s)}}convertToMatchResult(e,t,n){let r={};for(let o of e){let s={},a;o.left!==void 0&&(a=o.left.id,s.left=t.index.getById(a),s.leftParentId=o.leftParentId),o.right!==void 0&&(a=o.right.id,s.right=n.index.getById(a),s.rightParentId=o.rightParentId),a!==void 0&&(r[a]=s)}return r}computeAnimation(e,t,n){let r={fades:[]};(0,nw.forEachMatch)(t,(s,a)=>{if(a.left!==void 0&&a.right!==void 0)this.updateElement(a.left,a.right,r);else if(a.right!==void 0){let c=a.right;(0,JE.isFadeable)(c)&&(c.opacity=0,r.fades.push({element:c,type:"in"}))}else if(a.left instanceof rs.SChildElement){let c=a.left;if((0,JE.isFadeable)(c)&&a.leftParentId!==void 0&&!(0,tN.containsSome)(e,c)){let u=e.index.getById(a.leftParentId);if(u instanceof rs.SParentElement){let d=n.modelFactory.createElement(c);u.add(d),r.fades.push({element:d,type:"out"})}}}});let o=this.createAnimations(r,e,n);return o.length>=2?new $E.CompoundAnimation(e,n,o):o.length===1?o[0]:e}updateElement(e,t,n){if((0,ZE.isLocateable)(e)&&(0,ZE.isLocateable)(t)){let r=e.position,o=t.position;(!(0,is.almostEquals)(r.x,o.x)||!(0,is.almostEquals)(r.y,o.y))&&(n.moves===void 0&&(n.moves=[]),n.moves.push({element:t,fromPosition:r,toPosition:o}),t.position=r)}(0,QE.isSizeable)(e)&&(0,QE.isSizeable)(t)&&(is.Dimension.isValid(t.bounds)?(!(0,is.almostEquals)(e.bounds.width,t.bounds.width)||!(0,is.almostEquals)(e.bounds.height,t.bounds.height))&&(n.resizes===void 0&&(n.resizes=[]),n.resizes.push({element:t,fromDimension:{width:e.bounds.width,height:e.bounds.height},toDimension:{width:t.bounds.width,height:t.bounds.height}})):t.bounds={x:t.bounds.x,y:t.bounds.y,width:e.bounds.width,height:e.bounds.height}),e instanceof ow.SRoutableElement&&t instanceof ow.SRoutableElement&&this.edgeRouterRegistry&&(n.edgeMementi===void 0&&(n.edgeMementi=[]),n.edgeMementi.push({edge:t,before:this.takeSnapshot(e),after:this.takeSnapshot(t)})),(0,tw.isSelectable)(e)&&(0,tw.isSelectable)(t)&&(t.selected=e.selected),e instanceof rs.SModelRoot&&t instanceof rs.SModelRoot&&(t.canvasBounds=e.canvasBounds),e instanceof ew.ViewportRootElement&&t instanceof ew.ViewportRootElement&&(t.scroll=e.scroll,t.zoom=e.zoom)}takeSnapshot(e){return this.edgeRouterRegistry.get(e.routerKind).takeSnapshot(e)}createAnimations(e,t,n){let r=[];if(e.fades.length>0&&r.push(new Zj.FadeAnimation(t,e.fades,n,!0)),e.moves!==void 0&&e.moves.length>0){let o=new Map;for(let s of e.moves)o.set(s.element.id,s);r.push(new XE.MoveAnimation(t,o,n,!1))}if(e.resizes!==void 0&&e.resizes.length>0){let o=new Map;for(let s of e.resizes)o.set(s.element.id,s);r.push(new Qj.ResizeAnimation(t,o,n,!1))}return e.edgeMementi!==void 0&&e.edgeMementi.length>0&&r.push(new XE.MorphEdgesAnimation(t,e.edgeMementi,n,!1)),r}undo(e){return this.performUpdate(this.newRoot,this.oldRoot,e)}redo(e){return this.performUpdate(this.oldRoot,this.newRoot,e)}};Ha.KIND=Xj.UpdateModelAction.KIND;sw([(0,Kl.inject)(rw.EdgeRouterRegistry),(0,Kl.optional)(),aw("design:type",rw.EdgeRouterRegistry)],Ha.prototype,"edgeRouterRegistry",void 0);Ha=sw([(0,Kl.injectable)(),$j(0,(0,Kl.inject)(eN.TYPES.Action)),aw("design:paramtypes",[Object])],Ha);tn.UpdateModelCommand=Ha});var cs=f(be=>{"use strict";var cw=be&&be.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},uw=be&&be.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},dw=be&&be.__param||function(i,e){return function(t,n){e(t,n,i)}},$m;Object.defineProperty(be,"__esModule",{value:!0});be.ViewportAnimation=be.GetViewportCommand=be.SetViewportCommand=be.ViewportResult=be.GetViewportAction=be.SetViewportAction=void 0;var Xm=_(),lw=te(),nN=Q(),iN=pe(),rN=rr(),fw=Tn(),hw=P(),oN=Lm(),as=class{constructor(e,t,n){this.elementId=e,this.newViewport=t,this.animate=n,this.kind=as.KIND}};be.SetViewportAction=as;as.KIND="viewport";var pw;(function(i){i.KIND="getViewport";function e(){return{kind:i.KIND,requestId:(0,lw.generateRequestId)()}}i.create=e})(pw=be.GetViewportAction||(be.GetViewportAction={}));var gw;(function(i){i.KIND="viewportResult";function e(t,n,r){return{kind:i.KIND,viewport:t,canvasBounds:n,responseId:r}}i.create=e})(gw=be.ViewportResult||(be.ViewportResult={}));var zl=$m=class extends iN.MergeableCommand{constructor(e){super(),this.action=e,this.newViewport=e.newViewport}execute(e){let t=e.root,n=t.index.getById(this.action.elementId);if(n&&(0,fw.isViewport)(n)){if(this.element=n,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom},this.action.animate)return new ss(this.element,this.oldViewport,this.newViewport,e).start();this.element.scroll=this.newViewport.scroll,this.element.zoom=this.newViewport.zoom}return t}undo(e){return new ss(this.element,this.newViewport,this.oldViewport,e).start()}redo(e){return new ss(this.element,this.oldViewport,this.newViewport,e).start()}merge(e,t){return!this.action.animate&&e instanceof $m&&this.element===e.element?(this.newViewport=e.newViewport,!0):!1}};zl.KIND=lw.SetViewportAction.KIND;zl=$m=cw([(0,Xm.injectable)(),dw(0,(0,Xm.inject)(hw.TYPES.Action)),uw("design:paramtypes",[Object])],zl);be.SetViewportCommand=zl;var Yl=class extends oN.ModelRequestCommand{constructor(e){super(),this.action=e}retrieveResult(e){let t=e.root,n;return(0,fw.isViewport)(t)?n={scroll:t.scroll,zoom:t.zoom}:n={scroll:nN.Point.ORIGIN,zoom:1},gw.create(n,t.canvasBounds,this.action.requestId)}};Yl.KIND=pw.KIND;Yl=cw([dw(0,(0,Xm.inject)(hw.TYPES.Action)),uw("design:paramtypes",[Object])],Yl);be.GetViewportCommand=Yl;var ss=class extends rN.Animation{constructor(e,t,n,r){super(r),this.element=e,this.oldViewport=t,this.newViewport=n,this.context=r,this.zoomFactor=Math.log(n.zoom/t.zoom)}tween(e,t){return this.element.scroll={x:(1-e)*this.oldViewport.scroll.x+e*this.newViewport.scroll.x,y:(1-e)*this.oldViewport.scroll.y+e*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(e*this.zoomFactor),t.root}};be.ViewportAnimation=ss});var Wl=f(Oe=>{"use strict";var Qm=Oe&&Oe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ey=Oe&&Oe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},_w=Oe&&Oe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.CenterKeyboardListener=Oe.FitToScreenCommand=Oe.CenterCommand=Oe.BoundsAwareViewportCommand=Oe.FitToScreenAction=Oe.CenterAction=void 0;var vw=te(),us=Q(),mw=In(),sN=G(),aN=pe(),cN=sn(),Jm=ae(),uN=bt(),yw=cs(),kl=Tn(),ty=_(),bw=P(),xr=class{constructor(e,t=!0,n=!1){this.elementIds=e,this.animate=t,this.retainZoom=n,this.kind=xr.KIND}};Oe.CenterAction=xr;xr.KIND="center";var Dr=class{constructor(e,t,n,r=!0){this.elementIds=e,this.padding=t,this.maxZoom=n,this.animate=r,this.kind=Dr.KIND}};Oe.FitToScreenAction=Dr;Dr.KIND="fit";var za=class extends aN.Command{constructor(e){super(),this.animate=e}initialize(e){if((0,kl.isViewport)(e)){this.oldViewport={scroll:e.scroll,zoom:e.zoom};let t=[];if(this.getElementIds().forEach(n=>{let r=e.index.getById(n);r&&(0,Jm.isBoundsAware)(r)&&t.push(this.boundsInViewport(r,r.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,uN.isSelectable)(n)&&n.selected&&(0,Jm.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,Jm.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length!==0){let n=t.reduce((r,o)=>us.Bounds.combine(r,o));us.Dimension.isValid(n)&&(this.newViewport=this.getNewViewport(n,e))}}}boundsInViewport(e,t,n){return e instanceof sN.SChildElement&&e.parent!==n?this.boundsInViewport(e.parent,e.parent.localToParent(t),n):t}execute(e){return this.initialize(e.root),this.redo(e)}undo(e){let t=e.root;if((0,kl.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new yw.ViewportAnimation(t,this.newViewport,this.oldViewport,e).start();t.scroll=this.oldViewport.scroll,t.zoom=this.oldViewport.zoom}return t}redo(e){let t=e.root;if((0,kl.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new yw.ViewportAnimation(t,this.oldViewport,this.newViewport,e).start();t.scroll=this.newViewport.scroll,t.zoom=this.newViewport.zoom}return t}equal(e,t){return e.zoom===t.zoom&&e.scroll.x===t.scroll.x&&e.scroll.y===t.scroll.y}};za=Qm([(0,ty.injectable)(),ey("design:paramtypes",[Boolean])],za);Oe.BoundsAwareViewportCommand=za;var Ul=class extends za{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!us.Dimension.isValid(t.canvasBounds))return;let n=this.action.retainZoom&&(0,kl.isViewport)(t)?t.zoom:1,r=us.Bounds.center(e);return{scroll:{x:r.x-.5*t.canvasBounds.width/n,y:r.y-.5*t.canvasBounds.height/n},zoom:n}}};Ul.KIND=vw.CenterAction.KIND;Ul=Qm([_w(0,(0,ty.inject)(bw.TYPES.Action)),ey("design:paramtypes",[Object])],Ul);Oe.CenterCommand=Ul;var Gl=class extends za{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!us.Dimension.isValid(t.canvasBounds))return;let n=us.Bounds.center(e),r=this.action.padding===void 0?0:2*this.action.padding,o=Math.min(t.canvasBounds.width/(e.width+r),t.canvasBounds.height/(e.height+r));return this.action.maxZoom!==void 0&&(o=Math.min(o,this.action.maxZoom)),o===1/0&&(o=1),{scroll:{x:n.x-.5*t.canvasBounds.width/o,y:n.y-.5*t.canvasBounds.height/o},zoom:o}}};Gl.KIND=vw.FitToScreenAction.KIND;Gl=Qm([_w(0,(0,ty.inject)(bw.TYPES.Action)),ey("design:paramtypes",[Object])],Gl);Oe.FitToScreenCommand=Gl;var Zm=class extends cN.KeyListener{keyDown(e,t){return(0,mw.matchesKeystroke)(t,"KeyC","ctrlCmd","shift")?[new xr([])]:(0,mw.matchesKeystroke)(t,"KeyF","ctrlCmd","shift")?[new Dr([])]:[]}};Oe.CenterKeyboardListener=Zm});var ry=f(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.ScrollMouseListener=ds.isScrollable=void 0;var ny=te(),dN=G(),lN=Mt(),Ya=Ke(),$l=Tn(),fN=Oi(),hN=me(),pN=gl(),gN=Pn();function mN(i){return"scroll"in i}ds.isScrollable=mN;var iy=class extends lN.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(e,t){if((0,Ya.findParentByFeature)(e,fN.isMoveable)===void 0&&!(e instanceof hN.SRoutingHandle)){let r=(0,Ya.findParentByFeature)(e,$l.isViewport);if(r){if(this.lastScrollPosition={x:t.pageX,y:t.pageY},this.scrollbar=this.getScrollbar(t),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(r,t,this.scrollbar,!0).map(o=>new Promise(s=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>s(o),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(e,t){if(t.buttons===0)return this.mouseUp(e,t);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);let n=(0,Ya.findParentByFeature)(e,$l.isViewport);if(n)return this.moveScrollBar(n,t,this.scrollbar)}if(this.lastScrollPosition){let n=(0,Ya.findParentByFeature)(e,$l.isViewport);if(n)return this.dragCanvas(n,t,this.lastScrollPosition)}return[]}mouseEnter(e,t){return e instanceof dN.SModelRoot&&t.buttons===0&&this.mouseUp(e,t),[]}mouseUp(e,t){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(e,t){if((0,Ya.findParentByFeature)(e,$l.isViewport)){let r=this.getScrollbar(t);if(r){window.clearTimeout(this.scrollbarMouseDownTimeout);let o=this.findClickTarget(r,t),s;if(o&&o.id.startsWith("horizontal-projection:")?s=o.id.substring(22):o&&o.id.startsWith("vertical-projection:")&&(s=o.id.substring(20)),s)return[ny.CenterAction.create([s],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(e,t,n){let r=(t.pageX-n.x)/e.zoom,o=(t.pageY-n.y)/e.zoom,s={scroll:{x:e.scroll.x-r,y:e.scroll.y-o},zoom:e.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[ny.SetViewportAction.create(e.id,s,{animate:!1})]}moveScrollBar(e,t,n,r=!1){let o=(0,pN.getModelBounds)(e);if(!o||e.zoom<=0)return[];let s=n.getBoundingClientRect(),a;if(this.getScrollbarOrientation(n)==="horizontal"){if(s.width<=0)return[];let c=e.canvasBounds.width/(e.zoom*o.width)*s.width,u=t.clientX-s.x-c/2;u<0?u=0:u>s.width-c&&(u=s.width-c),a={x:o.x+u/s.width*o.width,y:e.scroll.y}}else{if(s.height<=0)return[];let c=e.canvasBounds.height/(e.zoom*o.height)*s.height,u=t.clientY-s.y-c/2;u<0?u=0:u>s.height-c&&(u=s.height-c),a={x:e.scroll.x,y:o.y+u/s.height*o.height}}return[ny.SetViewportAction.create(e.id,{scroll:a,zoom:e.zoom},{animate:r})]}getScrollbar(e){let t=e.target;for(;t;){if(t.classList&&t.classList.contains("sprotty-projection-bar"))return t;t=t.parentElement}}getScrollbarOrientation(e){return e.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(e,t){let n=Array.from(e.children).filter(r=>r.id&&r.classList.contains("sprotty-projection")&&(0,gN.hitsMouseEvent)(r,t));if(n.length>0)return n[n.length-1]}};ds.ScrollMouseListener=iy});var oy=f(Lt=>{"use strict";var yN=Lt&&Lt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_N=Lt&&Lt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},vN=Lt&&Lt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.BringToFrontCommand=Lt.BringToFrontAction=void 0;var Sw=_(),bN=P(),Ew=G(),SN=pe(),ww=me(),Pw;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(Pw=Lt.BringToFrontAction||(Lt.BringToFrontAction={}));var Xl=class extends SN.Command{constructor(e){super(),this.action=e,this.selected=[]}execute(e){let t=e.root;return this.action.elementIDs.forEach(n=>{let r=t.index.getById(n);r instanceof ww.SRoutableElement&&(r.source&&this.addToSelection(r.source),r.target&&this.addToSelection(r.target)),r instanceof Ew.SChildElement&&this.addToSelection(r),this.includeConnectedEdges(r)}),this.redo(e)}includeConnectedEdges(e){if(e instanceof ww.SConnectableElement&&(e.incomingEdges.forEach(t=>this.addToSelection(t)),e.outgoingEdges.forEach(t=>this.addToSelection(t))),e instanceof Ew.SParentElement)for(let t of e.children)this.includeConnectedEdges(t)}addToSelection(e){this.selected.push({element:e,index:e.parent.children.indexOf(e)})}undo(e){for(let t=this.selected.length-1;t>=0;t--){let n=this.selected[t],r=n.element;r.parent.move(r,n.index)}return e.root}redo(e){for(let t=0;t<this.selected.length;t++)this.bringToFront(this.selected[t]);return e.root}bringToFront(e){let t=e.element,n=t.parent.children.length;t.parent.move(t,n-1)}};Xl.KIND=Pw.KIND;Xl=yN([(0,Sw.injectable)(),vN(0,(0,Sw.inject)(bN.TYPES.Action)),_N("design:paramtypes",[Object])],Xl);Lt.BringToFrontCommand=Xl});var ay=f(ls=>{"use strict";var EN=ls&&ls.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ls,"__esModule",{value:!0});ls.SGraphFactory=void 0;var wN=_(),qr=vi(),zi=wn(),Jl=G(),nn=Sr(),Iw=cd(),sy=class extends zi.SModelFactory{constructor(){super(...arguments),this.defaultGraphFeatures=(0,zi.createFeatureSet)(nn.SGraph.DEFAULT_FEATURES),this.defaultNodeFeatures=(0,zi.createFeatureSet)(nn.SNode.DEFAULT_FEATURES),this.defaultPortFeatures=(0,zi.createFeatureSet)(nn.SPort.DEFAULT_FEATURES),this.defaultEdgeFeatures=(0,zi.createFeatureSet)(nn.SEdge.DEFAULT_FEATURES),this.defaultLabelFeatures=(0,zi.createFeatureSet)(nn.SLabel.DEFAULT_FEATURES),this.defaultCompartmentFeatures=(0,zi.createFeatureSet)(nn.SCompartment.DEFAULT_FEATURES),this.defaultButtonFeatures=(0,zi.createFeatureSet)(Iw.SButton.DEFAULT_FEATURES)}createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Jl.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else this.isNodeSchema(e)?(n=new nn.SNode,n.features=this.defaultNodeFeatures):this.isPortSchema(e)?(n=new nn.SPort,n.features=this.defaultPortFeatures):this.isEdgeSchema(e)?(n=new nn.SEdge,n.features=this.defaultEdgeFeatures):this.isLabelSchema(e)?(n=new nn.SLabel,n.features=this.defaultLabelFeatures):this.isCompartmentSchema(e)?(n=new nn.SCompartment,n.features=this.defaultCompartmentFeatures):this.isButtonSchema(e)?(n=new Iw.SButton,n.features=this.defaultButtonFeatures):n=new Jl.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Jl.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else this.isGraphSchema(e)?(t=new nn.SGraph,t.features=this.defaultGraphFeatures):t=new Jl.SModelRoot;return this.initializeRoot(t,e)}isGraphSchema(e){return(0,qr.getBasicType)(e)==="graph"}isNodeSchema(e){return(0,qr.getBasicType)(e)==="node"}isPortSchema(e){return(0,qr.getBasicType)(e)==="port"}isEdgeSchema(e){return(0,qr.getBasicType)(e)==="edge"}isLabelSchema(e){return(0,qr.getBasicType)(e)==="label"}isCompartmentSchema(e){return(0,qr.getBasicType)(e)==="comp"}isButtonSchema(e){return(0,qr.getBasicType)(e)==="button"}};sy=EN([(0,wN.injectable)()],sy);ls.SGraphFactory=sy});var Rw=f(cy=>{"use strict";Object.defineProperty(cy,"__esModule",{value:!0});var PN=_(),IN=P(),RN=ay(),MN=new PN.ContainerModule((i,e,t,n)=>{n(IN.TYPES.IModelFactory).to(RN.SGraphFactory).inSingletonScope()});cy.default=MN});var ly=f(dy=>{"use strict";Object.defineProperty(dy,"__esModule",{value:!0});var ON=_(),uy=P(),Mw=$u(),Ow=pp(),ka=Zu(),Tw=gt(),Aw=vp(),Cw=_p(),xw=bp(),TN=new ON.ContainerModule((i,e,t)=>{(0,Tw.configureCommand)({bind:i,isBound:t},Mw.SetBoundsCommand),(0,Tw.configureCommand)({bind:i,isBound:t},Mw.RequestBoundsCommand),i(Ow.HiddenBoundsUpdater).toSelf().inSingletonScope(),i(uy.TYPES.HiddenVNodePostprocessor).toService(Ow.HiddenBoundsUpdater),i(uy.TYPES.Layouter).to(ka.Layouter).inSingletonScope(),i(uy.TYPES.LayoutRegistry).to(ka.LayoutRegistry).inSingletonScope(),(0,ka.configureLayout)({bind:i,isBound:t},Cw.VBoxLayouter.KIND,Cw.VBoxLayouter),(0,ka.configureLayout)({bind:i,isBound:t},Aw.HBoxLayouter.KIND,Aw.HBoxLayouter),(0,ka.configureLayout)({bind:i,isBound:t},xw.StackLayouter.KIND,xw.StackLayouter)});dy.default=TN});var hy=f(fy=>{"use strict";Object.defineProperty(fy,"__esModule",{value:!0});var AN=_(),CN=sa(),xN=new AN.ContainerModule(i=>{i(CN.ButtonHandlerRegistry).toSelf().inSingletonScope()});fy.default=xN});var my=f(gy=>{"use strict";Object.defineProperty(gy,"__esModule",{value:!0});var DN=_(),py=P(),Dw=ud(),Zl=Np(),qN=new DN.ContainerModule(i=>{i(Zl.CommandPalette).toSelf().inSingletonScope(),i(py.TYPES.IUIExtension).toService(Zl.CommandPalette),i(Zl.CommandPaletteKeyListener).toSelf().inSingletonScope(),i(py.TYPES.KeyListener).toService(Zl.CommandPaletteKeyListener),i(Dw.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),i(py.TYPES.ICommandPaletteActionProviderRegistry).toService(Dw.CommandPaletteActionProviderRegistry)});gy.default=qN});var _y=f(yy=>{"use strict";Object.defineProperty(yy,"__esModule",{value:!0});var jN=_(),NN=gd(),qw=Hp(),Ua=P(),LN=new jN.ContainerModule(i=>{i(Ua.TYPES.IContextMenuServiceProvider).toProvider(e=>()=>new Promise((t,n)=>{e.container.isBound(Ua.TYPES.IContextMenuService)?t(e.container.get(Ua.TYPES.IContextMenuService)):n()})),i(qw.ContextMenuMouseListener).toSelf().inSingletonScope(),i(Ua.TYPES.MouseListener).toService(qw.ContextMenuMouseListener),i(Ua.TYPES.IContextMenuProviderRegistry).to(NN.ContextMenuProviderRegistry)});yy.default=LN});var by=f(vy=>{"use strict";Object.defineProperty(vy,"__esModule",{value:!0});var BN=uo(),FN=_(),VN=rl(),KN=Yg(),HN=P(),jw=kg(),zN=new FN.ContainerModule((i,e,t)=>{(0,BN.configureModelElement)({bind:i,isBound:t},"marker",VN.SIssueMarker,KN.IssueMarkerView),i(jw.DecorationPlacer).toSelf().inSingletonScope(),i(HN.TYPES.IVNodePostprocessor).toService(jw.DecorationPlacer)});vy.default=zN});var Lw=f(Sy=>{"use strict";Object.defineProperty(Sy,"__esModule",{value:!0});var YN=_(),kN=P(),Nw=al(),UN=new YN.ContainerModule(i=>{i(Nw.IntersectionFinder).toSelf().inSingletonScope(),i(kN.TYPES.IEdgeRoutePostprocessor).toService(Nw.IntersectionFinder)});Sy.default=UN});var wy=f(Ey=>{"use strict";Object.defineProperty(Ey,"__esModule",{value:!0});var GN=_(),WN=sa(),Bw=Tg(),$N=new GN.ContainerModule((i,e,t)=>{(0,WN.configureButtonHandler)({bind:i,isBound:t},Bw.ExpandButtonHandler.TYPE,Bw.ExpandButtonHandler)});Ey.default=$N});var Ry=f(Iy=>{"use strict";Object.defineProperty(Iy,"__esModule",{value:!0});var XN=_(),Py=P(),Ql=Dg(),JN=Ir(),ZN=gt(),QN=new XN.ContainerModule((i,e,t)=>{i(Ql.ExportSvgKeyListener).toSelf().inSingletonScope(),i(Py.TYPES.KeyListener).toService(Ql.ExportSvgKeyListener),i(Py.TYPES.HiddenVNodePostprocessor).to(Ql.ExportSvgPostprocessor).inSingletonScope(),(0,ZN.configureCommand)({bind:i,isBound:t},Ql.ExportSvgCommand),i(Py.TYPES.SvgExporter).to(JN.SvgExporter).inSingletonScope()});Iy.default=QN});var Oy=f(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});var eL=_(),tL=P(),nL=tl(),iL=new eL.ContainerModule(i=>{i(tL.TYPES.IVNodePostprocessor).to(nL.ElementFader).inSingletonScope()});My.default=iL});var Kw=f(Yi=>{"use strict";var Fw=Yi&&Yi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},rL=Yi&&Yi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.PopupPositionUpdater=void 0;var Vw=_(),oL=P(),ef=class{decorate(e,t){return e}postUpdate(){let e=document.getElementById(this.options.popupDiv);if(e!==null&&typeof window<"u"){let t=e.getBoundingClientRect();window.innerHeight<t.height+t.top&&(e.style.top=window.pageYOffset+window.innerHeight-t.height-5+"px"),window.innerWidth<t.left+t.width&&(e.style.left=window.pageXOffset+window.innerWidth-t.width-5+"px"),t.left<0&&(e.style.left="0px"),t.top<0&&(e.style.top="0px")}}};Fw([(0,Vw.inject)(oL.TYPES.ViewerOptions),rL("design:type",Object)],ef.prototype,"options",void 0);ef=Fw([(0,Vw.injectable)()],ef);Yi.PopupPositionUpdater=ef});var Ay=f(Ty=>{"use strict";Object.defineProperty(Ty,"__esModule",{value:!0});var sL=_(),Ga=P(),dt=Fg(),aL=Kw(),Hw=gt(),Wa=Ds(),zw=Wl(),cL=cs(),uL=Va(),dL=new sL.ContainerModule((i,e,t)=>{i(Ga.TYPES.PopupVNodePostprocessor).to(aL.PopupPositionUpdater).inSingletonScope(),i(dt.HoverMouseListener).toSelf().inSingletonScope(),i(Ga.TYPES.MouseListener).toService(dt.HoverMouseListener),i(dt.PopupHoverMouseListener).toSelf().inSingletonScope(),i(Ga.TYPES.PopupMouseListener).toService(dt.PopupHoverMouseListener),i(dt.HoverKeyListener).toSelf().inSingletonScope(),i(Ga.TYPES.KeyListener).toService(dt.HoverKeyListener),i(Ga.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),i(dt.ClosePopupActionHandler).toSelf().inSingletonScope();let n={bind:i,isBound:t};(0,Hw.configureCommand)(n,dt.HoverFeedbackCommand),(0,Hw.configureCommand)(n,dt.SetPopupModelCommand),(0,Wa.configureActionHandler)(n,dt.SetPopupModelCommand.KIND,dt.ClosePopupActionHandler),(0,Wa.configureActionHandler)(n,zw.FitToScreenCommand.KIND,dt.ClosePopupActionHandler),(0,Wa.configureActionHandler)(n,zw.CenterCommand.KIND,dt.ClosePopupActionHandler),(0,Wa.configureActionHandler)(n,cL.SetViewportCommand.KIND,dt.ClosePopupActionHandler),(0,Wa.configureActionHandler)(n,uL.MoveCommand.KIND,dt.ClosePopupActionHandler)});Ty.default=dL});var Dy=f(xy=>{"use strict";Object.defineProperty(xy,"__esModule",{value:!0});var lL=_(),Cy=P(),fs=Va(),fL=gt(),hL=new lL.ContainerModule((i,e,t)=>{i(fs.MoveMouseListener).toSelf().inSingletonScope(),i(Cy.TYPES.MouseListener).toService(fs.MoveMouseListener),(0,fL.configureCommand)({bind:i,isBound:t},fs.MoveCommand),i(fs.LocationPostprocessor).toSelf().inSingletonScope(),i(Cy.TYPES.IVNodePostprocessor).toService(fs.LocationPostprocessor),i(Cy.TYPES.HiddenVNodePostprocessor).toService(fs.LocationPostprocessor)});xy.default=hL});var jy=f(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});var pL=_(),gL=P(),Yw=om(),mL=new pL.ContainerModule(i=>{i(Yw.OpenMouseListener).toSelf().inSingletonScope(),i(gL.TYPES.MouseListener).toService(Yw.OpenMouseListener)});qy.default=mL});var Ky=f(Vy=>{"use strict";Object.defineProperty(Vy,"__esModule",{value:!0});var yL=_(),rn=P(),kw=wl(),Uw=ya(),Ny=qm(),Ly=yl(),_L=ei(),vL=ln(),By=Sl(),Fy=Im(),bL=gt(),SL=new yL.ContainerModule((i,e,t)=>{i(vL.EdgeRouterRegistry).toSelf().inSingletonScope(),i(_L.AnchorComputerRegistry).toSelf().inSingletonScope(),i(kw.ManhattanEdgeRouter).toSelf().inSingletonScope(),i(rn.TYPES.IEdgeRouter).toService(kw.ManhattanEdgeRouter),i(rn.TYPES.IAnchorComputer).to(Ny.ManhattanEllipticAnchor).inSingletonScope(),i(rn.TYPES.IAnchorComputer).to(Ny.ManhattanRectangularAnchor).inSingletonScope(),i(rn.TYPES.IAnchorComputer).to(Ny.ManhattanDiamondAnchor).inSingletonScope(),i(Uw.PolylineEdgeRouter).toSelf().inSingletonScope(),i(rn.TYPES.IEdgeRouter).toService(Uw.PolylineEdgeRouter),i(rn.TYPES.IAnchorComputer).to(Ly.EllipseAnchor),i(rn.TYPES.IAnchorComputer).to(Ly.RectangleAnchor),i(rn.TYPES.IAnchorComputer).to(Ly.DiamondAnchor),i(By.BezierEdgeRouter).toSelf().inSingletonScope(),i(rn.TYPES.IEdgeRouter).toService(By.BezierEdgeRouter),i(rn.TYPES.IAnchorComputer).to(Fy.BezierEllipseAnchor),i(rn.TYPES.IAnchorComputer).to(Fy.BezierRectangleAnchor),i(rn.TYPES.IAnchorComputer).to(Fy.BezierDiamondAnchor),(0,bL.configureCommand)({bind:i,isBound:t},By.AddRemoveBezierSegmentCommand)});Vy.default=SL});var Yy=f(zy=>{"use strict";Object.defineProperty(zy,"__esModule",{value:!0});var EL=_(),Gw=P(),jr=Bl(),Hy=gt(),wL=new EL.ContainerModule((i,e,t)=>{(0,Hy.configureCommand)({bind:i,isBound:t},jr.SelectCommand),(0,Hy.configureCommand)({bind:i,isBound:t},jr.SelectAllCommand),(0,Hy.configureCommand)({bind:i,isBound:t},jr.GetSelectionCommand),i(jr.SelectKeyboardListener).toSelf().inSingletonScope(),i(Gw.TYPES.KeyListener).toService(jr.SelectKeyboardListener),i(jr.SelectMouseListener).toSelf().inSingletonScope(),i(Gw.TYPES.MouseListener).toService(jr.SelectMouseListener)});zy.default=wL});var Uy=f(ky=>{"use strict";Object.defineProperty(ky,"__esModule",{value:!0});var PL=_(),IL=P(),Ww=km(),RL=new PL.ContainerModule(i=>{i(Ww.UndoRedoKeyListener).toSelf().inSingletonScope(),i(IL.TYPES.KeyListener).toService(Ww.UndoRedoKeyListener)});ky.default=RL});var Wy=f(Gy=>{"use strict";Object.defineProperty(Gy,"__esModule",{value:!0});var ML=_(),OL=gt(),TL=Hl(),AL=new ML.ContainerModule((i,e,t)=>{(0,OL.configureCommand)({bind:i,isBound:t},TL.UpdateModelCommand)});Gy.default=AL});var Jy=f(Xy=>{"use strict";Object.defineProperty(Xy,"__esModule",{value:!0});var CL=_(),$y=P(),tf=Wl(),$w=cs(),Xw=ry(),Jw=kd(),nf=gt(),xL=new CL.ContainerModule((i,e,t)=>{(0,nf.configureCommand)({bind:i,isBound:t},tf.CenterCommand),(0,nf.configureCommand)({bind:i,isBound:t},tf.FitToScreenCommand),(0,nf.configureCommand)({bind:i,isBound:t},$w.SetViewportCommand),(0,nf.configureCommand)({bind:i,isBound:t},$w.GetViewportCommand),i(tf.CenterKeyboardListener).toSelf().inSingletonScope(),i($y.TYPES.KeyListener).toService(tf.CenterKeyboardListener),i(Xw.ScrollMouseListener).toSelf().inSingletonScope(),i(Jw.ZoomMouseListener).toSelf().inSingletonScope(),i($y.TYPES.MouseListener).toService(Xw.ScrollMouseListener),i($y.TYPES.MouseListener).toService(Jw.ZoomMouseListener)});Xy.default=xL});var Qy=f(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var DL=_(),qL=gt(),jL=oy(),NL=new DL.ContainerModule((i,e,t)=>{(0,qL.configureCommand)({bind:i,isBound:t},jL.BringToFrontCommand)});Zy.default=NL});var eP=f(ue=>{"use strict";var Pt=ue&&ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},af=ue&&ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(ue,"__esModule",{value:!0});ue.SBezierControlHandleView=ue.SBezierCreateHandleView=ue.SCompartmentView=ue.SLabelView=ue.SRoutingHandleView=ue.BezierCurveEdgeView=ue.PolylineEdgeViewWithGapsOnIntersections=ue.JumpingPolylineEdgeView=ue.PolylineEdgeView=ue.SGraphView=void 0;var It=_(),hs=Q(),Zw=vi(),Ja=Ne(),LL=ra(),$a=al(),BL=Do(),cf=me(),ki=ln(),Qw=Nm(),he=Ut(),FL=Pr(),rf=class{render(e,t){let n=this.edgeRouterRegistry.routeAllChildren(e),r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,he.svg)("svg",{"class-sprotty-graph":!0},(0,he.svg)("g",{transform:r},t.renderChildren(e,{edgeRouting:n})))}};Pt([(0,It.inject)(ki.EdgeRouterRegistry),af("design:type",ki.EdgeRouterRegistry)],rf.prototype,"edgeRouterRegistry",void 0);rf=Pt([(0,It.injectable)()],rf);ue.SGraphView=rf;var Xa=class extends Qw.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,he.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,he.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o=t[0],s=`M ${o.x},${o.y}`;for(let a=1;a<t.length;a++){let c=t[a];s+=` L ${c.x},${c.y}`}return(0,he.svg)("path",{d:s})}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,he.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Pt([(0,It.inject)(ki.EdgeRouterRegistry),af("design:type",ki.EdgeRouterRegistry)],Xa.prototype,"edgeRouterRegistry",void 0);Xa=Pt([(0,It.injectable)()],Xa);ue.PolylineEdgeView=Xa;var of=class extends Xa{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(e,t,n,r){let o="";for(let s=0;s<t.length;s++){let a=t[s];s===0&&(o=`M ${a.x},${a.y}`),(0,$a.isIntersectingRoutedPoint)(a)&&(o+=this.intersectionPath(e,t,a,r)),s!==0&&(o+=` L ${a.x},${a.y}`)}return(0,he.svg)("path",{d:o})}intersectionPath(e,t,n,r){if(n.intersections.length<1)return"";let o=this.getLineSegment(e,n.intersections[0],r,t),s=this.getIntersectionsSortedBySegmentDirection(o,n),a="";for(let c of s){let u=this.getOtherLineSegment(e,c,r);if(u===void 0)continue;let d=this.getLineSegment(e,c,r,t),l=c.intersectionPoint;this.shouldDrawLineJumpOnIntersection(d,u)?a+=this.createJumpPath(l,d):this.shouldDrawLineGapOnIntersection(d,u)&&(a+=this.createGapPath(l,d))}return a}getIntersectionsSortedBySegmentDirection(e,t){switch(e.direction){case"north":case"north-east":return t.intersections.sort($a.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return t.intersections.sort($a.BY_X_THEN_Y);case"south-west":case"west":return t.intersections.sort($a.BY_DESCENDING_X_THEN_Y);case"north-west":return t.intersections.sort($a.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(e,t){return Math.abs(e.slopeOrMax)<Math.abs(t.slopeOrMax)}shouldDrawLineGapOnIntersection(e,t){return!this.shouldDrawLineJumpOnIntersection(e,t)}getLineSegment(e,t,n,r){let o=r||this.edgeRouterRegistry.route(e,n),s=t.routable1===e.id?t.segmentIndex1:t.segmentIndex2;return new FL.PointToPointLine(o[s],o[s+1])}getOtherLineSegment(e,t,n){let r=t.routable1===e.id?t.routable2:t.routable1,o=e.index.getById(r);if(o instanceof cf.SRoutableElement)return this.getLineSegment(o,t,n)}createJumpPath(e,t){let n=hs.Point.shiftTowards(e,t.p1,this.jumpOffsetBefore),r=hs.Point.shiftTowards(e,t.p2,this.jumpOffsetAfter),o=t.p1.x<t.p2.x?1:0;return` L ${n.x},${n.y} A 1,1 0,0 ${o} ${r.x},${r.y}`}createGapPath(e,t){let n,r;e.y<t.p1.y?(n=-this.skipOffsetBefore,r=this.jumpOffsetAfter+this.skipOffsetAfter):(n=this.jumpOffsetBefore+this.skipOffsetAfter,r=-this.skipOffsetBefore);let o=hs.Point.shiftTowards(e,t.p1,n),s=hs.Point.shiftTowards(e,t.p2,r);return` L ${o.x},${o.y} M ${s.x},${s.y}`}};of=Pt([(0,It.injectable)()],of);ue.JumpingPolylineEdgeView=of;var e_=class extends of{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(e,t){return!1}shouldDrawLineGapOnIntersection(e,t){return Math.abs(e.slopeOrMax)>=Math.abs(t.slopeOrMax)}createGapPath(e,t){let n=hs.Point.shiftTowards(e,t.p1,this.skipOffsetBefore),r=hs.Point.shiftTowards(e,t.p2,this.skipOffsetAfter);return` L ${n.x},${n.y} M ${r.x},${r.y}`}};e_=Pt([(0,It.injectable)()],e_);ue.PolylineEdgeViewWithGapsOnIntersections=e_;var sf=class extends Qw.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,he.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,he.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o="";if(t.length>=4){o+=this.buildMainSegment(t);let s=t.length-4;if(s>0&&s%3===0)for(let a=4;a<t.length;a+=3)o+=this.addSpline(t,a)}return(0,he.svg)("path",{d:o})}buildMainSegment(e){let t=e[0],n=e[1],r=e[2],o=e[3];return`M${t.x},${t.y} C${n.x},${n.y} ${r.x},${r.y} ${o.x},${o.y}`}addSpline(e,t){let n=e[t+1],r=e[t+2];return` S${n.x},${n.y} ${r.x},${r.y}`}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,he.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Pt([(0,It.inject)(ki.EdgeRouterRegistry),af("design:type",ki.EdgeRouterRegistry)],sf.prototype,"edgeRouterRegistry",void 0);sf=Pt([(0,It.injectable)()],sf);ue.BezierCurveEdgeView=sf;var ps=class{constructor(){this.minimalPointDistance=10}render(e,t,n){if(n&&n.route&&e.parent instanceof cf.SRoutableElement){let r=this.edgeRouterRegistry.get(e.parent.routerKind),o=n.route===void 0?this.edgeRouterRegistry.route(e.parent,n):n.route,s=r.getHandlePosition(e.parent,o,e);if(s!==void 0){let a=(0,he.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,Ja.setAttr)(a,"data-kind",e.kind),a}}return(0,he.svg)("g",null)}getRadius(){return 7}};Pt([(0,It.inject)(ki.EdgeRouterRegistry),af("design:type",ki.EdgeRouterRegistry)],ps.prototype,"edgeRouterRegistry",void 0);ps=Pt([(0,It.injectable)()],ps);ue.SRoutingHandleView=ps;var t_=class extends LL.ShapeView{render(e,t){if(!(0,BL.isEdgeLayoutable)(e)&&!this.isVisible(e,t))return;let n=(0,he.svg)("text",{"class-sprotty-label":!0},e.text),r=(0,Zw.getSubType)(e);return r&&(0,Ja.setAttr)(n,"class",r),n}};t_=Pt([(0,It.injectable)()],t_);ue.SLabelView=t_;var n_=class{render(e,t,n){let r=`translate(${e.bounds.x}, ${e.bounds.y})`,o=(0,he.svg)("g",{transform:r,"class-sprotty-comp":"{true}"},t.renderChildren(e)),s=(0,Zw.getSubType)(e);return s&&(0,Ja.setAttr)(o,"class",s),o}};n_=Pt([(0,It.injectable)()],n_);ue.SCompartmentView=n_;var i_=class extends ps{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof cf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a="translate("+s.x+", "+s.y+")",c=-5.5,u=5.5,d=e.kind==="bezier-add"?"+":"-",l=(0,he.svg)("g",{transform:a,"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,he.svg)("circle",{r:this.getRadius()}),(0,he.svg)("text",{x:c,y:u,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},d));return(0,Ja.setAttr)(l,"data-kind",e.kind),l}}}return(0,he.svg)("g",null)}};i_=Pt([(0,It.injectable)()],i_);ue.SBezierCreateHandleView=i_;var r_=class extends ps{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof cf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a;for(let u=0;u<r.length;u++){let d=r[u];if(d.kind===s.kind&&d.pointIndex===s.pointIndex){e.kind==="bezier-control-before"?a=r[u+1]:a=r[u-1];break}}let c;if(a){let u=`M ${s.x}, ${s.y} L ${a.x}, ${a.y}`;c=(0,he.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,he.svg)("path",{d:u,stroke:"grey","style-stroke-width":"2px"}),(0,he.svg)("circle",{cx:s.x,cy:s.y,r:this.getRadius()}))}else c=(0,he.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,Ja.setAttr)(c,"data-kind",e.kind),c}}}return(0,he.svg)("g",null)}};r_=Pt([(0,It.injectable)()],r_);ue.SBezierControlHandleView=r_});var s_=f(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});var VL=_(),KL=gt(),uf=P(),HL=wa(),zL=Fo(),YL=new VL.ContainerModule((i,e,t)=>{i(uf.TYPES.ModelSourceProvider).toProvider(n=>()=>new Promise(r=>{r(n.container.get(uf.TYPES.ModelSource))})),(0,KL.configureCommand)({bind:i,isBound:t},HL.CommitModelCommand),i(uf.TYPES.IActionHandlerInitializer).toService(uf.TYPES.ModelSource),i(zL.ComputedBoundsApplicator).toSelf().inSingletonScope()});o_.default=YL});var tP=f(gs=>{"use strict";var Te=gs&&gs.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(gs,"__esModule",{value:!0});gs.loadDefaultModules=void 0;var kL=Te(up()),UL=Te(s_()),GL=Te(ly()),WL=Te(hy()),$L=Te(my()),XL=Te(_y()),JL=Te(by()),ZL=Te(qd()),a_=Og(),QL=Te(wy()),eB=Te(Ry()),tB=Te(Oy()),nB=Te(Ay()),iB=Te(Dy()),rB=Te(jy()),oB=Te(Ky()),sB=Te(Yy()),aB=Te(Uy()),cB=Te(Wy()),uB=Te(Jy()),dB=Te(Qy());function lB(i,e){let t=[kL.default,UL.default,GL.default,WL.default,$L.default,XL.default,JL.default,a_.edgeEditModule,ZL.default,QL.default,eB.default,tB.default,nB.default,a_.labelEditModule,a_.labelEditUiModule,iB.default,rB.default,oB.default,sB.default,aB.default,cB.default,uB.default,dB.default];if(e&&e.exclude)for(let n of e.exclude){let r=t.indexOf(n);r>=0&&t.splice(r,1)}i.load(...t)}gs.loadDefaultModules=lB});var nP=f(u_=>{"use strict";Object.defineProperty(u_,"__esModule",{value:!0});var df=co();function fB(i){let e={},t=(s,a)=>{if(a!=="style"&&a!=="class"){let c=yB(i[a]);s?s[a]=c:s={[a]:c}}return s},n=Object.keys(i).reduce(t,null);n&&(e.attrs=n);let r=hB(i);r&&(e.style=r);let o=pB(i);return o&&(e.class=o),e}function hB(i){let e=(t,n)=>{let r=n.split(":"),o=gB(r[0].trim());if(o){let s=r[1].replace("!important","").trim();t?t[o]=s:t={[o]:s}}return t};try{return i.style.split(";").reduce(e,null)}catch{return null}}function pB(i){let e=(t,n)=>(n=n.trim(),n&&(t?t[n]=!0:t={[n]:!0}),t);try{return i.class.split(" ").reduce(e,null)}catch{return null}}function gB(i){return i=i.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),`${i.charAt(0).toLowerCase()}${i.substring(1)}`}var mB=new RegExp("&[a-z0-9#]+;","gi"),ms=null;function yB(i){return ms||(ms=document.createElement("div")),i.replace(mB,e=>ms===null?"":(ms.innerHTML=e,ms.textContent===null?"":ms.textContent))}function _B(i,e){let t=i,n=null,r=[],o=s=>{let a=s.firstChild;a!==null&&(n=s),t=a};for(e(t,n),o(t);;){for(;t;)r.push(t),e(t,n),o(t);let s=r.pop();if(t=s||null,!r.length)break;if(n=r[r.length-1],t){let a=t.nextSibling;a==null&&(n=r[r.length-1]),t=a}}}var Za=null,c_=new Map,lf=!1;function vB(i,e){let t;switch(e!==null&&(t=c_.get(e)),i?.nodeType){case 1:{if(t===void 0)return;t.children=t.children?t.children:[];let n=t.children,r=i.attributes,o={};for(let a=0;a<r.length;a++){let c=r.item(a);c&&(o[c.name]=c.value)}let s=(0,df.h)(i.nodeName,fB(o));n.push(s),c_.set(i,s);break}case 3:{let n=i.textContent;if(n!==null&&t!==void 0){t.children=t.children?t.children:[];let r=t.children,o=r.length>0?r[r.length-1]:null;!lf&&typeof o!="string"&&o!==null&&o.sel===void 0?o.text=o.text+n:r.push((0,df.vnode)(void 0,void 0,void 0,n,void 0)),lf=!1}break}case 8:{lf=!0;break}case 9:{Za=(0,df.vnode)(void 0,void 0,[],void 0,void 0),c_.set(i,Za);break}default:break}}function bB(i){let e=i?.children;return typeof e>"u"?null:e.length===1&&typeof e[0]!="string"?e[0]:null}function SB(i){var e,t;let n=new window.DOMParser;if(n===void 0||i===void 0||i==="")return null;let r=n.parseFromString(i,"application/xml");if(((e=r?.firstChild)===null||e===void 0?void 0:e.nodeName)==="parsererror"){let o=`${(t=r?.firstChild)===null||t===void 0?void 0:t.textContent}`;return(0,df.h)("parsererror",[o])}return lf=!1,Za=null,_B(r,vB),Za===null?null:bB(Za)}u_.default=SB});var __=f(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.ForeignObjectElement=Ae.ShapedPreRenderedElement=Ae.PreRenderedElement=Ae.HtmlRoot=Ae.RectangularPort=Ae.CircularPort=Ae.DiamondNode=Ae.RectangularNode=Ae.CircularNode=void 0;var Qa=Q(),iP=G(),d_=ae(),EB=Oi(),wB=bt(),tc=Sr(),nc=ei(),l_=class extends tc.SNode{get anchorKind(){return nc.ELLIPTIC_ANCHOR_KIND}};Ae.CircularNode=l_;var f_=class extends tc.SNode{get anchorKind(){return nc.RECTANGULAR_ANCHOR_KIND}};Ae.RectangularNode=f_;var h_=class extends tc.SNode{get anchorKind(){return nc.DIAMOND_ANCHOR_KIND}};Ae.DiamondNode=h_;var p_=class extends tc.SPort{get anchorKind(){return nc.ELLIPTIC_ANCHOR_KIND}};Ae.CircularPort=p_;var g_=class extends tc.SPort{get anchorKind(){return nc.RECTANGULAR_ANCHOR_KIND}};Ae.RectangularPort=g_;var m_=class extends iP.SModelRoot{constructor(){super(...arguments),this.classes=[]}};Ae.HtmlRoot=m_;var ff=class extends iP.SChildElement{};Ae.PreRenderedElement=ff;var ec=class extends ff{constructor(){super(...arguments),this.position=Qa.Point.ORIGIN,this.size=Qa.Dimension.EMPTY,this.selected=!1,this.alignment=Qa.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}};Ae.ShapedPreRenderedElement=ec;ec.DEFAULT_FEATURES=[EB.moveFeature,d_.boundsFeature,wB.selectFeature,d_.alignFeature];var y_=class extends ec{get bounds(){return Qa.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,d_.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:Qa.Bounds.EMPTY}};Ae.ForeignObjectElement=y_});var cP=f(Hn=>{"use strict";var oP=Hn&&Hn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},PB=Hn&&Hn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.ForeignObjectView=Hn.PreRenderedView=void 0;var rP=Ut(),sP=_(),aP=PB(nP()),v_=Ne(),IB=ra(),RB=__(),b_=class extends IB.ShapeView{render(e,t){if(e instanceof RB.ShapedPreRenderedElement&&!this.isVisible(e,t))return;let n=(0,aP.default)(e.code);if(n!==null)return this.correctNamespace(n),n}correctNamespace(e){(e.sel==="svg"||e.sel==="g")&&(0,v_.setNamespace)(e,"http://www.w3.org/2000/svg")}};b_=oP([(0,sP.injectable)()],b_);Hn.PreRenderedView=b_;var S_=class{render(e,t){let n=(0,aP.default)(e.code);if(n===null)return;let r=(0,rP.svg)("g",null,(0,rP.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.bounds.height,width:e.bounds.width,x:0,y:0},n),t.renderChildren(e));return(0,v_.setAttr)(r,"class",e.type),(0,v_.setNamespace)(n,e.namespace),r}};S_=oP([(0,sP.injectable)()],S_);Hn.ForeignObjectView=S_});var uP=f(ys=>{"use strict";var MB=ys&&ys.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ys,"__esModule",{value:!0});ys.HtmlRootView=void 0;var OB=Ut(),TB=_(),AB=Ne(),E_=class{render(e,t){let n=(0,OB.html)("div",null,t.renderChildren(e));for(let r of e.classes)(0,AB.setClass)(n,r,!0);return n}};E_=MB([(0,TB.injectable)()],E_);ys.HtmlRootView=E_});var I_=f((w_,P_)=>{(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof w_<"u"?e():(e(),i.FileSaver={})})(w_,function(){"use strict";function i(a,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function e(a,c,u){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){s(d.response,c,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(a){var c=new XMLHttpRequest;c.open("HEAD",a,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(a,c,u){var d=r.URL||r.webkitURL,l=document.createElement("a");c=c||a.name||"download",l.download=c,l.rel="noopener",typeof a=="string"?(l.href=a,l.origin===location.origin?n(l):t(l.href)?e(a,c,u):n(l,l.target="_blank")):(l.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(a,c,u){if(c=c||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,u),c);else if(t(a))e(a,c,u);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){n(d)})}}:function(a,c,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return e(a,c,u);var l=a.type==="application/octet-stream",S=/constructor/i.test(r.HTMLElement)||r.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||l&&S||o)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var A=v.result;A=R?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=A:location=A,d=null},v.readAsDataURL(a)}else{var m=r.URL||r.webkitURL,O=m.createObjectURL(a);d?d.location=O:location.href=O,d=null,setTimeout(function(){m.revokeObjectURL(O)},4e4)}});r.saveAs=s.saveAs=s,typeof P_<"u"&&(P_.exports=s)})});var A_=f(Rt=>{"use strict";var O_=Rt&&Rt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},hP=Rt&&Rt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.DiagramServer=Rt.DiagramServerProxy=Rt.ServerStatusAction=Rt.isActionMessage=void 0;var CB=I_(),T_=_(),xB=cr(),Ui=te(),DB=yn(),dP=vu(),qB=P(),R_=$u(),jB=Ir(),lP=Hl(),M_=Fo();function pP(i){return(0,DB.hasOwnProperty)(i,"action")}Rt.isActionMessage=pP;var Gi=class{constructor(){this.kind=Gi.KIND}};Rt.ServerStatusAction=Gi;Gi.KIND="serverStatus";var fP="__receivedFromServer",_s=class extends M_.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}initialize(e){super.initialize(e),e.register(Ui.ComputedBoundsAction.KIND,this),e.register(R_.RequestBoundsCommand.KIND,this),e.register(Ui.RequestPopupModelAction.KIND,this),e.register(Ui.CollapseExpandAction.KIND,this),e.register(Ui.CollapseExpandAllAction.KIND,this),e.register(xB.OpenAction.KIND,this),e.register(Gi.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(e){this.handleLocally(e)&&this.forwardToServer(e)}forwardToServer(e){let t={clientId:this.clientId,action:e};this.logger.log(this,"sending",t),this.sendMessage(t)}messageReceived(e){let t=typeof e=="string"?JSON.parse(e):e;pP(t)&&t.action?(!t.clientId||t.clientId===this.clientId)&&(t.action[fP]=!0,this.logger.log(this,"receiving",t),this.actionDispatcher.dispatch(t.action).then(()=>{this.storeNewModel(t.action)})):this.logger.error(this,"received data is not an action message",t)}handleLocally(e){switch(this.storeNewModel(e),e.kind){case Ui.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case Ui.RequestModelAction.KIND:return this.handleRequestModel(e);case R_.RequestBoundsCommand.KIND:return!1;case jB.ExportSvgAction.KIND:return this.handleExportSvgAction(e);case Gi.KIND:return this.handleServerStateAction(e)}return!e[fP]}storeNewModel(e){if(e.kind===dP.SetModelCommand.KIND||e.kind===lP.UpdateModelCommand.KIND||e.kind===R_.RequestBoundsCommand.KIND){let t=e.newRoot;t&&(this.currentRoot=t,(e.kind===dP.SetModelCommand.KIND||e.kind===lP.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=t.type))}}handleRequestModel(e){let t=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},e.options),n=Object.assign(Object.assign({},e),{options:t});return this.forwardToServer(n),!1}handleComputedBounds(e){if(this.viewerOptions.needsServerLayout)return!0;{let t=this.currentRoot;return this.computedBoundsApplicator.apply(t,e),t.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(Ui.UpdateModelAction.create(t)):this.actionDispatcher.dispatch(Ui.SetModelAction.create(t)),this.lastSubmittedModelType=t.type,!1}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});return(0,CB.saveAs)(t,"diagram.svg"),!1}handleServerStateAction(e){return!1}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}};O_([(0,T_.inject)(qB.TYPES.ILogger),hP("design:type",Object)],_s.prototype,"logger",void 0);O_([(0,T_.inject)(M_.ComputedBoundsApplicator),hP("design:type",M_.ComputedBoundsApplicator)],_s.prototype,"computedBoundsApplicator",void 0);_s=O_([(0,T_.injectable)()],_s);Rt.DiagramServerProxy=_s;Rt.DiagramServer=_s});var mP=f(Wi=>{"use strict";var ic=Wi&&Wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},hf=Wi&&Wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.LocalModelSource=void 0;var NB=I_(),Nr=_(),pn=te(),gP=vi(),x_=P(),LB=wn(),BB=cs(),FB=Ir(),VB=Fl(),KB=Bl(),C_=Fo(),Lr=class extends C_.ModelSource{constructor(){super(...arguments),this.currentRoot=LB.EMPTY_ROOT}get model(){return this.currentRoot}set model(e){this.setModel(e)}initialize(e){super.initialize(e),e.register(pn.ComputedBoundsAction.KIND,this),e.register(pn.RequestPopupModelAction.KIND,this)}setModel(e){return this.currentRoot=e,this.submitModel(e,!1)}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}updateModel(e){return e===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=e,this.submitModel(e,!0))}async getSelection(){let e=await this.actionDispatcher.request(KB.GetSelectionAction.create()),t=[];return this.gatherSelectedElements(this.currentRoot,new Set(e.selectedElementsIDs),t),t}gatherSelectedElements(e,t,n){if(t.has(e.id)&&n.push(e),e.children)for(let r of e.children)this.gatherSelectedElements(r,t,n)}async getViewport(){let e=await this.actionDispatcher.request(BB.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}async submitModel(e,t,n){if(this.viewerOptions.needsClientLayout){let r=await this.actionDispatcher.request(pn.RequestBoundsAction.create(e)),o=this.computedBoundsApplicator.apply(this.currentRoot,r);await this.doSubmitModel(e,!0,n,o)}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n,r){if(this.layoutEngine!==void 0)try{let s=this.layoutEngine.layout(e,r);s instanceof Promise?e=await s:s!==void 0&&(e=s)}catch(s){this.logger.error(this,s.toString(),s.stack)}let o=this.lastSubmittedModelType;if(this.lastSubmittedModelType=e.type,n&&n.kind===pn.RequestModelAction.KIND&&n.requestId){let s=n;await this.actionDispatcher.dispatch(pn.SetModelAction.create(e,s.requestId))}else if(t&&e.type===o){let s=Array.isArray(t)?t:e;await this.actionDispatcher.dispatch(pn.UpdateModelAction.create(s,{animate:!0,cause:n}))}else await this.actionDispatcher.dispatch(pn.SetModelAction.create(e))}applyMatches(e){let t=this.currentRoot;return(0,VB.applyMatches)(t,e),this.submitModel(t,e)}addElements(e){let t=[];for(let n of e){let r=n;r.element!==void 0&&r.parentId!==void 0?t.push({right:r.element,rightParentId:r.parentId}):r.id!==void 0&&t.push({right:r,rightParentId:this.currentRoot.id})}return this.applyMatches(t)}removeElements(e){let t=[],n=new gP.SModelIndex;n.add(this.currentRoot);for(let r of e){let o=r;if(o.elementId!==void 0&&o.parentId!==void 0){let s=n.getById(o.elementId);s!==void 0&&t.push({left:s,leftParentId:o.parentId})}else{let s=n.getById(o);s!==void 0&&t.push({left:s,leftParentId:this.currentRoot.id})}}return this.applyMatches(t)}handle(e){switch(e.kind){case pn.RequestModelAction.KIND:this.handleRequestModel(e);break;case pn.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,e);break;case pn.RequestPopupModelAction.KIND:this.handleRequestPopupModel(e);break;case FB.ExportSvgAction.KIND:this.handleExportSvgAction(e);break}}handleRequestModel(e){this.submitModel(this.currentRoot,!1,e)}handleRequestPopupModel(e){if(this.popupModelProvider!==void 0){let t=(0,gP.findElement)(this.currentRoot,e.elementId),n=this.popupModelProvider.getPopupModel(e,t);n!==void 0&&(n.canvasBounds=e.bounds,this.actionDispatcher.dispatch(pn.SetPopupModelAction.create(n,e.requestId)))}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});(0,NB.saveAs)(t,"diagram.svg")}};ic([(0,Nr.inject)(x_.TYPES.ILogger),hf("design:type",Object)],Lr.prototype,"logger",void 0);ic([(0,Nr.inject)(C_.ComputedBoundsApplicator),hf("design:type",C_.ComputedBoundsApplicator)],Lr.prototype,"computedBoundsApplicator",void 0);ic([(0,Nr.inject)(x_.TYPES.IPopupModelProvider),(0,Nr.optional)(),hf("design:type",Object)],Lr.prototype,"popupModelProvider",void 0);ic([(0,Nr.inject)(x_.TYPES.IModelLayoutEngine),(0,Nr.optional)(),hf("design:type",Object)],Lr.prototype,"layoutEngine",void 0);Lr=ic([(0,Nr.injectable)()],Lr);Wi.LocalModelSource=Lr});var bP=f(gn=>{"use strict";var D_=gn&&gn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yP=gn&&gn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(gn,"__esModule",{value:!0});gn.ForwardingLogger=gn.LoggingAction=void 0;var q_=_(),$i=Vu(),_P=P(),vP;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(vP=gn.LoggingAction||(gn.LoggingAction={}));var rc=class{error(e,t,...n){this.logLevel>=$i.LogLevel.error&&this.forward(e,t,$i.LogLevel.error,n)}warn(e,t,...n){this.logLevel>=$i.LogLevel.warn&&this.forward(e,t,$i.LogLevel.warn,n)}info(e,t,...n){this.logLevel>=$i.LogLevel.info&&this.forward(e,t,$i.LogLevel.info,n)}log(e,t,...n){if(this.logLevel>=$i.LogLevel.log)try{let r=typeof e=="object"?e.constructor.name:String(e);console.log.apply(e,[r+": "+t,...n])}catch{}}forward(e,t,n,r){let o=new Date,s=vP.create({message:t,severity:$i.LogLevel[n],time:o.toLocaleTimeString(),caller:typeof e=="object"?e.constructor.name:String(e),params:r.map(a=>JSON.stringify(a))});this.modelSourceProvider().then(a=>{try{a.handle(s)}catch(c){try{console.log.apply(e,[t,s,c])}catch{}}})}};D_([(0,q_.inject)(_P.TYPES.ModelSourceProvider),yP("design:type",Function)],rc.prototype,"modelSourceProvider",void 0);D_([(0,q_.inject)(_P.TYPES.LogLevel),yP("design:type",Number)],rc.prototype,"logLevel",void 0);rc=D_([(0,q_.injectable)()],rc);gn.ForwardingLogger=rc});var SP=f(Xi=>{"use strict";var HB=Xi&&Xi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Xi,"__esModule",{value:!0});Xi.WebSocketDiagramServer=Xi.WebSocketDiagramServerProxy=void 0;var zB=_(),YB=A_(),pf=class extends YB.DiagramServerProxy{listen(e){e.addEventListener("message",t=>{this.messageReceived(t.data)}),e.addEventListener("error",t=>{this.logger.error(this,"error event received",t)}),this.webSocket=e}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(e){if(this.webSocket)this.webSocket.send(JSON.stringify(e));else throw new Error("WebSocket is not connected")}};pf=HB([(0,zB.injectable)()],pf);Xi.WebSocketDiagramServerProxy=pf;Xi.WebSocketDiagramServer=pf});var EP=f(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.ColorMap=Ji.toSVG=Ji.rgb=void 0;function kB(i,e,t){return{red:i,green:e,blue:t}}Ji.rgb=kB;function UB(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}Ji.toSVG=UB;var j_=class{constructor(e){this.stops=e}getColor(e){e=Math.max(0,Math.min(.99999999,e));let t=Math.floor(e*this.stops.length);return this.stops[t]}};Ji.ColorMap=j_});var PP=f(wP=>{"use strict";Object.defineProperty(wP,"__esModule",{value:!0})});var gf=f(h=>{"use strict";var GB=h&&h.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),g=h&&h.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&GB(e,i,t)},Se=h&&h.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(h,"__esModule",{value:!0});h.modelSourceModule=h.zorderModule=h.viewportModule=h.updateModule=h.undoRedoModule=h.selectModule=h.routingModule=h.openModule=h.moveModule=h.hoverModule=h.fadeModule=h.exportModule=h.expandModule=h.edgeLayoutModule=h.edgeIntersectionModule=h.decorationModule=h.contextMenuModule=h.commandPaletteModule=h.buttonModule=h.boundsModule=h.graphModule=h.defaultModule=void 0;g(uc(),h);g(iu(),h);g(Ds(),h);g(nh(),h);g(Wr(),h);g(rr(),h);g(ih(),h);g(pe(),h);g(gt(),h);g(hb(),h);g(hh(),h);g(Ns(),h);g(vu(),h);g(Ab(),h);g(wn(),h);g(Ke(),h);g(G(),h);g(Oh(),h);g(bu(),h);g(Ks(),h);g(Ru(),h);g(sn(),h);g(Mt(),h);g(kh(),h);g(uo(),h);g(Jh(),h);g(Zh(),h);g(Qh(),h);g(tp(),h);g(Ne(),h);g(P(),h);var WB=Se(up());h.defaultModule=WB.default;g($u(),h);g(pp(),h);g(Zu(),h);g(ae(),h);g(_p(),h);g(vp(),h);g(bp(),h);g(ra(),h);g(sa(),h);g(cd(),h);g(ud(),h);g(Np(),h);g(GS(),h);g(gd(),h);g(Hp(),h);g(qd(),h);g(Xp(),h);g(Do(),h);g(I0(),h);g(Qp(),h);g(Og(),h);g(Co(),h);g(Vd(),h);g(Eg(),h);g(Ma(),h);g(qo(),h);g(Ud(),h);g(Tg(),h);g(Wd(),h);g(eE(),h);g(Dg(),h);g(bd(),h);g(Ir(),h);g(tl(),h);g(Oo(),h);g(Fg(),h);g(_r(),h);g(rl(),h);g(Yg(),h);g(kg(),h);g(al(),h);g(Xg(),h);g(Oi(),h);g(Va(),h);g(PE(),h);g(Ip(),h);g(om(),h);g(im(),h);g(gl(),h);g(xE(),h);g(ei(),h);g(ga(),h);g(Im(),h);g(Sl(),h);g(qm(),h);g(wl(),h);g(me(),h);g(yl(),h);g(ya(),h);g(ln(),h);g(Nm(),h);g(bt(),h);g(Bl(),h);g(km(),h);g(Fl(),h);g(Hl(),h);g(Wl(),h);g(Tn(),h);g(ry(),h);g(wd(),h);g(cs(),h);g(kd(),h);g(oy(),h);var $B=Se(Rw());h.graphModule=$B.default;var XB=Se(ly());h.boundsModule=XB.default;var JB=Se(hy());h.buttonModule=JB.default;var ZB=Se(my());h.commandPaletteModule=ZB.default;var QB=Se(_y());h.contextMenuModule=QB.default;var eF=Se(by());h.decorationModule=eF.default;var tF=Se(Lw());h.edgeIntersectionModule=tF.default;var nF=Se(qd());h.edgeLayoutModule=nF.default;var iF=Se(wy());h.expandModule=iF.default;var rF=Se(Ry());h.exportModule=rF.default;var oF=Se(Oy());h.fadeModule=oF.default;var sF=Se(Ay());h.hoverModule=sF.default;var aF=Se(Dy());h.moveModule=aF.default;var cF=Se(jy());h.openModule=cF.default;var uF=Se(Ky());h.routingModule=uF.default;var dF=Se(Yy());h.selectModule=dF.default;var lF=Se(Uy());h.undoRedoModule=lF.default;var fF=Se(Wy());h.updateModule=fF.default;var hF=Se(Jy());h.viewportModule=hF.default;var pF=Se(Qy());h.zorderModule=pF.default;g(ay(),h);g(Sr(),h);g(eP(),h);g(tP(),h);g(cP(),h);g(uP(),h);g(Ut(),h);g(__(),h);g(cg(),h);g(wa(),h);g(A_(),h);g(mP(),h);g(bP(),h);g(Fo(),h);g(SP(),h);var gF=Se(s_());h.modelSourceModule=gF.default;g(Pn(),h);g(Ap(),h);g(EP(),h);g(Pr(),h);g(ir(),h);g(PP(),h);g(Vu(),h);g(En(),h)});var K_;(function(i){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return bf(Object.create(null))}:a?function(){return bf({__proto__:null})}:function(){return bf({})},has:c?function(p,y){return t.call(p,y)}:function(p,y){return y in p},get:c?function(p,y){return t.call(p,y)?p[y]:void 0}:function(p,y){return p[y]}},d=Object.getPrototypeOf(Function),l=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",S=!l&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:DP(),R=!l&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:qP(),v=!l&&typeof WeakMap=="function"?WeakMap:jP(),m=new v;function O(p,y,w,I){if(q(w)){if(!N_(p))throw new TypeError;if(!L_(y))throw new TypeError;return we(p,y)}else{if(!N_(p))throw new TypeError;if(!k(y))throw new TypeError;if(!k(I)&&!q(I)&&!se(I))throw new TypeError;return se(I)&&(I=void 0),w=it(w),le(p,y,w,I)}}e("decorate",O);function A(p,y){function w(I,C){if(!k(I))throw new TypeError;if(!q(C)&&!OP(C))throw new TypeError;ws(p,y,I,C)}return w}e("metadata",A);function K(p,y,w,I){if(!k(w))throw new TypeError;return q(I)||(I=it(I)),ws(p,y,w,I)}e("defineMetadata",K);function U(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=it(w)),Ue(p,y,w)}e("hasMetadata",U);function D(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=it(w)),mn(p,y,w)}e("hasOwnMetadata",D);function F(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=it(w)),si(p,y,w)}e("getMetadata",F);function H(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=it(w)),Es(p,y,w)}e("getOwnMetadata",H);function W(p,y){if(!k(p))throw new TypeError;return q(y)||(y=it(y)),Ps(p,y)}e("getMetadataKeys",W);function z(p,y){if(!k(p))throw new TypeError;return q(y)||(y=it(y)),oc(p,y)}e("getOwnMetadataKeys",z);function oe(p,y,w){if(!k(y))throw new TypeError;q(w)||(w=it(w));var I=_e(y,w,!1);if(q(I)||!I.delete(p))return!1;if(I.size>0)return!0;var C=m.get(y);return C.delete(w),C.size>0||m.delete(y),!0}e("deleteMetadata",oe);function we(p,y){for(var w=p.length-1;w>=0;--w){var I=p[w],C=I(y);if(!q(C)&&!se(C)){if(!L_(C))throw new TypeError;y=C}}return y}function le(p,y,w,I){for(var C=p.length-1;C>=0;--C){var Ve=p[C],V=Ve(y,w,I);if(!q(V)&&!se(V)){if(!k(V))throw new TypeError;I=V}}return I}function _e(p,y,w){var I=m.get(p);if(q(I)){if(!w)return;I=new S,m.set(p,I)}var C=I.get(y);if(q(C)){if(!w)return;C=new S,I.set(y,C)}return C}function Ue(p,y,w){var I=mn(p,y,w);if(I)return!0;var C=vf(y);return se(C)?!1:Ue(p,C,w)}function mn(p,y,w){var I=_e(y,w,!1);return q(I)?!1:on(I.has(p))}function si(p,y,w){var I=mn(p,y,w);if(I)return Es(p,y,w);var C=vf(y);if(!se(C))return si(p,C,w)}function Es(p,y,w){var I=_e(y,w,!1);if(!q(I))return I.get(p)}function ws(p,y,w,I){var C=_e(w,I,!0);C.set(p,y)}function Ps(p,y){var w=oc(p,y),I=vf(p);if(I===null)return w;var C=Ps(I,y);if(C.length<=0)return w;if(w.length<=0)return C;for(var Ve=new R,V=[],Y=0,j=w;Y<j.length;Y++){var $=j[Y],X=Ve.has($);X||(Ve.add($),V.push($))}for(var ci=0,F_=C;ci<F_.length;ci++){var $=F_[ci],X=Ve.has($);X||(Ve.add($),V.push($))}return V}function oc(p,y){var w=[],I=_e(p,y,!1);if(q(I))return w;for(var C=I.keys(),Ve=TP(C),V=0;;){var Y=CP(Ve);if(!Y)return w.length=V,w;var j=AP(Y);try{w[V]=j}catch($){try{xP(Ve)}finally{throw $}}V++}}function N(p){if(p===null)return 1;switch(typeof p){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return p===null?1:6;default:return 6}}function q(p){return p===void 0}function se(p){return p===null}function qe(p){return typeof p=="symbol"}function k(p){return typeof p=="object"?p!==null:typeof p=="function"}function Fe(p,y){switch(N(p)){case 0:return p;case 1:return p;case 2:return p;case 3:return p;case 4:return p;case 5:return p}var w=y===3?"string":y===5?"number":"default",I=B_(p,r);if(I!==void 0){var C=I.call(p,w);if(k(C))throw new TypeError;return C}return ai(p,w==="default"?"number":w)}function ai(p,y){if(y==="string"){var w=p.toString;if(Br(w)){var I=w.call(p);if(!k(I))return I}var C=p.valueOf;if(Br(C)){var I=C.call(p);if(!k(I))return I}}else{var C=p.valueOf;if(Br(C)){var I=C.call(p);if(!k(I))return I}var Ve=p.toString;if(Br(Ve)){var I=Ve.call(p);if(!k(I))return I}}throw new TypeError}function on(p){return!!p}function Ge(p){return""+p}function it(p){var y=Fe(p,3);return qe(y)?y:Ge(y)}function N_(p){return Array.isArray?Array.isArray(p):p instanceof Object?p instanceof Array:Object.prototype.toString.call(p)==="[object Array]"}function Br(p){return typeof p=="function"}function L_(p){return typeof p=="function"}function OP(p){switch(N(p)){case 3:return!0;case 4:return!0;default:return!1}}function B_(p,y){var w=p[y];if(w!=null){if(!Br(w))throw new TypeError;return w}}function TP(p){var y=B_(p,o);if(!Br(y))throw new TypeError;var w=y.call(p);if(!k(w))throw new TypeError;return w}function AP(p){return p.value}function CP(p){var y=p.next();return y.done?!1:y}function xP(p){var y=p.return;y&&y.call(p)}function vf(p){var y=Object.getPrototypeOf(p);if(typeof p!="function"||p===d||y!==d)return y;var w=p.prototype,I=w&&Object.getPrototypeOf(w);if(I==null||I===Object.prototype)return y;var C=I.constructor;return typeof C!="function"||C===p?y:C}function DP(){var p={},y=[],w=function(){function V(Y,j,$){this._index=0,this._keys=Y,this._values=j,this._selector=$}return V.prototype["@@iterator"]=function(){return this},V.prototype[o]=function(){return this},V.prototype.next=function(){var Y=this._index;if(Y>=0&&Y<this._keys.length){var j=this._selector(this._keys[Y],this._values[Y]);return Y+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:j,done:!1}}return{value:void 0,done:!0}},V.prototype.throw=function(Y){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),Y},V.prototype.return=function(Y){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:Y,done:!0}},V}();return function(){function V(){this._keys=[],this._values=[],this._cacheKey=p,this._cacheIndex=-2}return Object.defineProperty(V.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),V.prototype.has=function(Y){return this._find(Y,!1)>=0},V.prototype.get=function(Y){var j=this._find(Y,!1);return j>=0?this._values[j]:void 0},V.prototype.set=function(Y,j){var $=this._find(Y,!0);return this._values[$]=j,this},V.prototype.delete=function(Y){var j=this._find(Y,!1);if(j>=0){for(var $=this._keys.length,X=j+1;X<$;X++)this._keys[X-1]=this._keys[X],this._values[X-1]=this._values[X];return this._keys.length--,this._values.length--,Y===this._cacheKey&&(this._cacheKey=p,this._cacheIndex=-2),!0}return!1},V.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=p,this._cacheIndex=-2},V.prototype.keys=function(){return new w(this._keys,this._values,I)},V.prototype.values=function(){return new w(this._keys,this._values,C)},V.prototype.entries=function(){return new w(this._keys,this._values,Ve)},V.prototype["@@iterator"]=function(){return this.entries()},V.prototype[o]=function(){return this.entries()},V.prototype._find=function(Y,j){return this._cacheKey!==Y&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Y)),this._cacheIndex<0&&j&&(this._cacheIndex=this._keys.length,this._keys.push(Y),this._values.push(void 0)),this._cacheIndex},V}();function I(V,Y){return V}function C(V,Y){return Y}function Ve(V,Y){return[V,Y]}}function qP(){return function(){function p(){this._map=new S}return Object.defineProperty(p.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),p.prototype.has=function(y){return this._map.has(y)},p.prototype.add=function(y){return this._map.set(y,y),this},p.prototype.delete=function(y){return this._map.delete(y)},p.prototype.clear=function(){this._map.clear()},p.prototype.keys=function(){return this._map.keys()},p.prototype.values=function(){return this._map.values()},p.prototype.entries=function(){return this._map.entries()},p.prototype["@@iterator"]=function(){return this.keys()},p.prototype[o]=function(){return this.keys()},p}()}function jP(){var p=16,y=u.create(),w=I();return function(){function j(){this._key=I()}return j.prototype.has=function($){var X=C($,!1);return X!==void 0?u.has(X,this._key):!1},j.prototype.get=function($){var X=C($,!1);return X!==void 0?u.get(X,this._key):void 0},j.prototype.set=function($,X){var ci=C($,!0);return ci[this._key]=X,this},j.prototype.delete=function($){var X=C($,!1);return X!==void 0?delete X[this._key]:!1},j.prototype.clear=function(){this._key=I()},j}();function I(){var j;do j="@@WeakMap@@"+Y();while(u.has(y,j));return y[j]=!0,j}function C(j,$){if(!t.call(j,w)){if(!$)return;Object.defineProperty(j,w,{value:u.create()})}return j[w]}function Ve(j,$){for(var X=0;X<$;++X)j[X]=Math.random()*255|0;return j}function V(j){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(j)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(j)):Ve(new Uint8Array(j),j):Ve(new Array(j),j)}function Y(){var j=V(p);j[6]=j[6]&79|64,j[8]=j[8]&191|128;for(var $="",X=0;X<p;++X){var ci=j[X];(X===4||X===6||X===8)&&($+="-"),ci<16&&($+="0"),$+=ci.toString(16).toLowerCase()}return $}}function bf(p){return p.__=void 0,delete p.__,p}})})(K_||(K_={}));var RP=Fr(gf());var _f=Fr(_()),L=Fr(gf());var Bt=Fr(Ut()),mf=Fr(_()),yf=Fr(gf());var vs=class extends yf.RectangularNodeView{render(e,t,n){return(0,Bt.svg)("g",null,(0,Bt.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width-(e.arrow!==0?10:0),height:e.size.height}),(0,Bt.svg)("rect",{"class-input-back":!0,width:"10",height:e.size.height}),e.arrow!==0&&(0,Bt.svg)("polygon",{"class-input-arrow-full":e.arrow===1,"class-input-arrow-stroke":e.arrow===2,points:e.size.width-10+",0 "+e.size.width+","+e.size.height/2+" "+(e.size.width-10)+","+e.size.height}),(0,Bt.svg)("text",{x:"0",y:e.size.height+15,"class-sprotty-text":!0},e.text))}};vs=sc([(0,mf.injectable)()],vs);var bs=class extends yf.RectangularNodeView{render(e,t,n){return(0,Bt.svg)("g",null,(0,Bt.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),(0,Bt.svg)("rect",{"class-controller-marker":!0,width:"10",height:"10",x:e.size.width/2-5,y:"-5"}),(0,Bt.svg)("text",{x:"0",y:e.size.height+20,"class-sprotty-text":!0},e.text))}};bs=sc([(0,mf.injectable)()],bs);var Ss=class extends yf.RectangularNodeView{render(e,t,n){return(0,Bt.svg)("g",null,(0,Bt.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width,height:e.size.height}),(0,Bt.svg)("text",{x:2,y:e.size.height,w:!0,"class-operand-symbol":!0},e.operand))}};Ss=sc([(0,mf.injectable)()],Ss);var IP=i=>{let e=new _f.ContainerModule((n,r,o,s)=>{n(L.TYPES.ModelSource).to(L.LocalModelSource).inSingletonScope(),s(L.TYPES.ILogger).to(L.ConsoleLogger).inSingletonScope(),s(L.TYPES.LogLevel).toConstantValue(L.LogLevel.log);let a={bind:n,unbind:r,isBound:o,rebind:s};(0,L.configureModelElement)(a,"graph",L.SGraph,L.SGraphView),(0,L.configureModelElement)(a,"node:input",L.RectangularNode,vs),(0,L.configureModelElement)(a,"node:controller",L.RectangularNode,bs),(0,L.configureModelElement)(a,"node:operand",L.RectangularNode,Ss),(0,L.configureModelElement)(a,"edge:straight",L.SEdge,L.PolylineEdgeView),(0,L.configureModelElement)(a,"label:text",L.SLabel,L.SLabelView),(0,L.configureModelElement)(a,"routing-point",L.SRoutingHandle,L.SRoutingHandleView),(0,L.configureModelElement)(a,"volatile-routing-point",L.SRoutingHandle,L.SRoutingHandleView),(0,L.configureViewerOptions)(a,{needsClientLayout:!1,baseDiv:i})}),t=new _f.Container;return(0,L.loadDefaultModules)(t),t.load(e),t};function MP(){IP("sprotty-showcase").get(RP.TYPES.ModelSource).setModel({type:"graph",id:"graph",children:[{id:"targetPosEdge",type:"edge:straight",sourceId:"target_pos",targetId:"AddOperand",routerKind:"manhattan"},{id:"MaxPosEdge",type:"edge:straight",sourceId:"MaxPosition",targetId:"limiter",routerKind:"manhattan",routingPoints:[{x:260,y:207}]},{id:"AddLimiterEdge",type:"edge:straight",sourceId:"AddOperand",targetId:"limiter",routerKind:"manhattan"},{id:"OffsetPosEdge",type:"edge:straight",sourceId:"offset_pos",targetId:"AddOperand",routerKind:"manhattan",routingPoints:[{x:145,y:367}]},{id:"limiterEdge",type:"edge:straight",sourceId:"limiter",targetId:"SubOperand",routerKind:"manhattan"},{id:"actualPosEdge",type:"edge:straight",sourceId:"actual_pos",targetId:"SubOperand",routerKind:"manhattan",routingPoints:[{x:335,y:407}]},{id:"SubToDivEdge",type:"edge:straight",sourceId:"SubOperand",targetId:"DivOperand",routerKind:"manhattan"},{id:"DivToPIDTEdge",type:"edge:straight",sourceId:"DivOperand",targetId:"pidt",routerKind:"manhattan"},{id:"outputEdge",type:"edge:straight",sourceId:"pidt",targetId:"new_pos",routerKind:"manhattan"},{id:"T_lEdge",type:"edge:straight",sourceId:"T_l",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:660,y:37}]},{id:"T_dEdge",type:"edge:straight",sourceId:"T_d",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:630,y:77}]},{id:"T_iEdge",type:"edge:straight",sourceId:"T_i",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:590,y:117}]},{id:"P_GainEdge",type:"edge:straight",sourceId:"P_Gain",targetId:"MNOperand",routerKind:"manhattan"},{id:"P_MaxEdge",type:"edge:straight",sourceId:"P_max",targetId:"MNOperand",routerKind:"manhattan"},{id:"MNOperandEdge",type:"edge:straight",sourceId:"MNOperand",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:560,y:190}]},{id:"cf_Degree2RadEdge",type:"edge:straight",sourceId:"cf_Degree2Rad",targetId:"DivOperand",routerKind:"manhattan",routingPoints:[{x:475,y:357}]},{id:"limiter",text:"limiter",type:"node:controller",position:{x:200,y:285},size:{width:80,height:60}},{id:"pidt",text:"pidt1",type:"node:controller",position:{x:550,y:275},size:{width:120,height:80}},{id:"MaxPosition",type:"node:input",text:"MaxPosition",arrow:2,position:{x:100,y:200},size:{width:40,height:15}},{id:"target_pos",type:"node:input",text:"target_pos",arrow:1,position:{x:0,y:307.5},size:{width:40,height:15}},{id:"offset_pos",type:"node:input",text:"offset_pos",arrow:0,position:{x:50,y:360},size:{width:40,height:15}},{id:"actual_pos",type:"node:input",text:"actual_position",arrow:1,position:{x:0,y:400},size:{width:40,height:15}},{id:"new_pos",type:"node:input",text:"new_position",arrow:1,position:{x:700,y:307.5},size:{width:40,height:15}},{id:"T_l",type:"node:input",text:"T_l",arrow:0,position:{x:350,y:30},size:{width:40,height:15}},{id:"T_d",type:"node:input",text:"T_d",arrow:0,position:{x:350,y:70},size:{width:40,height:15}},{id:"T_i",type:"node:input",text:"T_i",arrow:0,position:{x:350,y:110},size:{width:40,height:15}},{id:"P_Gain",type:"node:input",text:"P_Gain",arrow:0,position:{x:350,y:150},size:{width:40,height:15}},{id:"P_max",type:"node:input",text:"P_max",arrow:2,position:{x:350,y:190},size:{width:40,height:15}},{id:"cf_Degree2Rad",type:"node:input",text:"cf_Degree2Rad",arrow:2,position:{x:380,y:350},size:{width:40,height:15}},{id:"AddOperand",type:"node:operand",operand:"+",position:{x:130,y:300},size:{width:30,height:30}},{id:"SubOperand",type:"node:operand",operand:"-",position:{x:320,y:300},size:{width:30,height:30}},{id:"DivOperand",type:"node:operand",operand:"\xF7",position:{x:460,y:300},size:{width:30,height:30}},{id:"MNOperand",type:"node:operand",operand:"MN",position:{x:440,y:160},size:{width:40,height:50}}]})}document.addEventListener("DOMContentLoaded",()=>MP());})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=bundle.js.map
