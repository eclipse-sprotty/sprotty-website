(()=>{var HP=Object.create;var Mf=Object.defineProperty;var U_=Object.getOwnPropertyDescriptor;var zP=Object.getOwnPropertyNames;var YP=Object.getPrototypeOf,kP=Object.prototype.hasOwnProperty;var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var UP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of zP(e))!kP.call(i,r)&&r!==t&&Mf(i,r,{get:()=>e[r],enumerable:!(n=U_(e,r))||n.enumerable});return i};var zr=(i,e,t)=>(t=i!=null?HP(YP(i)):{},UP(e||!i||!i.__esModule?Mf(t,"default",{value:i,enumerable:!0}):t,i));var kn=(i,e,t,n)=>{for(var r=n>1?void 0:n?U_(e,t):e,o=i.length-1,s;o>=0;o--)(s=i[o])&&(r=(n?s(e,t,r):s(r))||r);return n&&r&&Mf(e,t,r),r};var _n=f(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.safeAssign=hi.hasOwnProperty=hi.isObject=void 0;function W_(i){return typeof i=="object"&&i!==null}hi.isObject=W_;function GP(i,e,t){if(!W_(i))return!1;if(Array.isArray(e))for(let n of e){if(!Object.prototype.hasOwnProperty.call(i,n)||typeof t=="string"&&typeof i[n]!==t)return!1;if(typeof t=="function"&&!t(i[n]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,e))return!1;if(typeof t=="string")return typeof i[e]===t;if(typeof t=="function")return t(i[e])}return!0}hi.hasOwnProperty=GP;function WP(i,e){return Object.assign(i,e)}hi.safeAssign=WP});var te=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ReconnectAction=E.ApplyLabelEditAction=E.DeleteElementAction=E.CreateElementAction=E.HoverFeedbackAction=E.MoveAction=E.RedoAction=E.UndoAction=E.BringToFrontAction=E.SetViewportAction=E.FitToScreenAction=E.CenterAction=E.LayoutAction=E.OpenAction=E.CollapseExpandAllAction=E.CollapseExpandAction=E.SelectAllAction=E.SelectAction=E.LoggingAction=E.ComputedBoundsAction=E.RequestBoundsAction=E.SetBoundsAction=E.SetPopupModelAction=E.RequestPopupModelAction=E.UpdateModelAction=E.SetModelAction=E.RequestModelAction=E.RejectAction=E.isResponseAction=E.generateRequestId=E.isRequestAction=E.isAction=E.isActionMessage=void 0;var gc=_n();function $P(i){return(0,gc.hasOwnProperty)(i,"action")}E.isActionMessage=$P;function XP(i){return(0,gc.hasOwnProperty)(i,"kind","string")}E.isAction=XP;function JP(i){return(0,gc.hasOwnProperty)(i,"requestId","string")}E.isRequestAction=JP;var ZP=1;function mc(){return(ZP++).toString()}E.generateRequestId=mc;function QP(i){return(0,gc.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}E.isResponseAction=QP;var eI;(function(i){i.KIND="rejectRequest";function e(t){return{kind:i.KIND,message:t.message,detail:t.detail,responseId:t.requestId}}i.create=e})(eI=E.RejectAction||(E.RejectAction={}));var tI;(function(i){i.KIND="requestModel";function e(t){return{kind:i.KIND,options:t,requestId:mc()}}i.create=e})(tI=E.RequestModelAction||(E.RequestModelAction={}));var nI;(function(i){i.KIND="setModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(nI=E.SetModelAction||(E.SetModelAction={}));var iI;(function(i){i.KIND="updateModel";function e(t,n={}){return Array.isArray(t)?{kind:i.KIND,matches:t,animate:n.animate,cause:n.cause}:{kind:i.KIND,newRoot:t,animate:n.animate,cause:n.cause}}i.create=e})(iI=E.UpdateModelAction||(E.UpdateModelAction={}));var rI;(function(i){i.KIND="requestPopupModel";function e(t){return{kind:i.KIND,elementId:t.elementId,bounds:t.bounds,requestId:mc()}}i.create=e})(rI=E.RequestPopupModelAction||(E.RequestPopupModelAction={}));var oI;(function(i){i.KIND="setPopupModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(oI=E.SetPopupModelAction||(E.SetPopupModelAction={}));var sI;(function(i){i.KIND="setBounds";function e(t){return{kind:i.KIND,bounds:t}}i.create=e})(sI=E.SetBoundsAction||(E.SetBoundsAction={}));var aI;(function(i){i.KIND="requestBounds";function e(t){return{kind:i.KIND,newRoot:t,requestId:mc()}}i.create=e})(aI=E.RequestBoundsAction||(E.RequestBoundsAction={}));var cI;(function(i){i.KIND="computedBounds";function e(t,n={}){var r;return{kind:i.KIND,bounds:t,revision:n.revision,alignments:n.alignments,responseId:(r=n.requestId)!==null&&r!==void 0?r:""}}i.create=e})(cI=E.ComputedBoundsAction||(E.ComputedBoundsAction={}));var uI;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(uI=E.LoggingAction||(E.LoggingAction={}));var dI;(function(i){i.KIND="elementSelected";function e(t){var n,r;return{kind:i.KIND,selectedElementsIDs:(n=t.selectedElementsIDs)!==null&&n!==void 0?n:[],deselectedElementsIDs:(r=t.deselectedElementsIDs)!==null&&r!==void 0?r:[]}}i.create=e})(dI=E.SelectAction||(E.SelectAction={}));var lI;(function(i){i.KIND="allSelected";function e(t={}){var n;return{kind:i.KIND,select:(n=t.select)!==null&&n!==void 0?n:!0}}i.create=e})(lI=E.SelectAllAction||(E.SelectAllAction={}));var fI;(function(i){i.KIND="collapseExpand";function e(t){var n,r;return{kind:i.KIND,expandIds:(n=t.expandIds)!==null&&n!==void 0?n:[],collapseIds:(r=t.collapseIds)!==null&&r!==void 0?r:[]}}i.create=e})(fI=E.CollapseExpandAction||(E.CollapseExpandAction={}));var hI;(function(i){i.KIND="collapseExpandAll";function e(t={}){var n;return{kind:i.KIND,expand:(n=t.expand)!==null&&n!==void 0?n:!0}}i.create=e})(hI=E.CollapseExpandAllAction||(E.CollapseExpandAllAction={}));var pI;(function(i){i.KIND="open";function e(t){return{kind:i.KIND,elementId:t}}i.create=e})(pI=E.OpenAction||(E.OpenAction={}));var gI;(function(i){i.KIND="layout";function e(t={}){return{kind:i.KIND,layoutType:t.layoutType,elementIds:t.elementIds}}i.create=e})(gI=E.LayoutAction||(E.LayoutAction={}));var mI;(function(i){i.KIND="center";function e(t,n={}){var r,o;return{kind:i.KIND,elementIds:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,retainZoom:(o=n.retainZoom)!==null&&o!==void 0?o:!1}}i.create=e})(mI=E.CenterAction||(E.CenterAction={}));var yI;(function(i){i.KIND="fit";function e(t,n={}){var r;return{kind:i.KIND,elementIds:t,padding:n.padding,maxZoom:n.maxZoom,animate:(r=n.animate)!==null&&r!==void 0?r:!0}}i.create=e})(yI=E.FitToScreenAction||(E.FitToScreenAction={}));var _I;(function(i){i.KIND="viewport";function e(t,n,r={}){var o;return{kind:i.KIND,elementId:t,newViewport:n,animate:(o=r.animate)!==null&&o!==void 0?o:!0}}i.create=e})(_I=E.SetViewportAction||(E.SetViewportAction={}));var vI;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(vI=E.BringToFrontAction||(E.BringToFrontAction={}));var bI;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(bI=E.UndoAction||(E.UndoAction={}));var SI;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(SI=E.RedoAction||(E.RedoAction={}));var EI;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(EI=E.MoveAction||(E.MoveAction={}));var wI;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(wI=E.HoverFeedbackAction||(E.HoverFeedbackAction={}));var PI;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(PI=E.CreateElementAction||(E.CreateElementAction={}));var II;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(II=E.DeleteElementAction||(E.DeleteElementAction={}));var RI;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(RI=E.ApplyLabelEditAction||(E.ApplyLabelEditAction={}));var MI;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(MI=E.ReconnectAction||(E.ReconnectAction={}))});var yc=f($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.isLabeledAction=$e.LabeledAction=$e.RejectAction=$e.isResponseAction=$e.generateRequestId=$e.isRequestAction=$e.isAction=void 0;var OI=te(),Tf=_n();function Af(i){return(0,Tf.hasOwnProperty)(i,"kind","string")}$e.isAction=Af;function TI(i){return Af(i)&&(0,Tf.hasOwnProperty)(i,"requestId","string")}$e.isRequestAction=TI;$e.generateRequestId=OI.generateRequestId;function AI(i){return Af(i)&&(0,Tf.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}$e.isResponseAction=AI;var Yr=class{constructor(e,t,n){this.message=e,this.responseId=t,this.detail=n,this.kind=Yr.KIND}};$e.RejectAction=Yr;Yr.KIND="rejectRequest";var Of=class{constructor(e,t,n){this.label=e,this.actions=t,this.icon=n}};$e.LabeledAction=Of;function CI(i){return i!==void 0&&i.label!==void 0&&i.actions!==void 0}$e.isLabeledAction=CI});var xe=f(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0;J.NAMED_TAG="named";J.NAME_TAG="name";J.UNMANAGED_TAG="unmanaged";J.OPTIONAL_TAG="optional";J.INJECT_TAG="inject";J.MULTI_INJECT_TAG="multi_inject";J.TAGGED="inversify:tagged";J.TAGGED_PROP="inversify:tagged_props";J.PARAM_TYPES="inversify:paramtypes";J.DESIGN_PARAM_TYPES="design:paramtypes";J.POST_CONSTRUCT="post_construct";function xI(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=xI()});var vn=f(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.TargetTypeEnum=pi.BindingTypeEnum=pi.BindingScopeEnum=void 0;var DI={Request:"Request",Singleton:"Singleton",Transient:"Transient"};pi.BindingScopeEnum=DI;var qI={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};pi.BindingTypeEnum=qI;var jI={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};pi.TargetTypeEnum=jI});var gi=f(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.id=void 0;var NI=0;function LI(){return NI++}_c.id=LI});var X_=f(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});vc.Binding=void 0;var $_=vn(),BI=gi(),FI=function(){function i(e,t){this.id=BI.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=$_.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return i.prototype.clone=function(){var e=new i(this.serviceIdentifier,this.scope);return e.activated=e.scope===$_.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},i}();vc.Binding=FI});var ht=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.STACK_OVERFLOW=T.CIRCULAR_DEPENDENCY_IN_FACTORY=T.POST_CONSTRUCT_ERROR=T.MULTIPLE_POST_CONSTRUCT_METHODS=T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=T.ARGUMENTS_LENGTH_MISMATCH=T.INVALID_DECORATOR_OPERATION=T.INVALID_TO_SELF_VALUE=T.INVALID_FUNCTION_BINDING=T.INVALID_MIDDLEWARE_RETURN=T.NO_MORE_SNAPSHOTS_AVAILABLE=T.INVALID_BINDING_TYPE=T.NOT_IMPLEMENTED=T.CIRCULAR_DEPENDENCY=T.UNDEFINED_INJECT_ANNOTATION=T.MISSING_INJECT_ANNOTATION=T.MISSING_INJECTABLE_ANNOTATION=T.NOT_REGISTERED=T.CANNOT_UNBIND=T.AMBIGUOUS_MATCH=T.KEY_NOT_FOUND=T.NULL_ARGUMENT=T.DUPLICATED_METADATA=T.DUPLICATED_INJECTABLE_DECORATOR=void 0;T.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";T.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";T.NULL_ARGUMENT="NULL argument";T.KEY_NOT_FOUND="Key Not Found";T.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";T.CANNOT_UNBIND="Could not unbind serviceIdentifier:";T.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";T.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";T.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var VI=function(i){return"@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};T.UNDEFINED_INJECT_ANNOTATION=VI;T.CIRCULAR_DEPENDENCY="Circular dependency found:";T.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";T.INVALID_BINDING_TYPE="Invalid binding type:";T.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";T.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";T.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";T.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";T.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var KI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"The number of constructor arguments in the derived class "+(i[0]+" must be >= than the number of constructor arguments of its base class.")};T.ARGUMENTS_LENGTH_MISMATCH=KI;T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";T.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var HI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"@postConstruct error in class "+i[0]+": "+i[1]};T.POST_CONSTRUCT_ERROR=HI;var zI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"It looks like there is a circular dependency "+("in one of the '"+i[0]+"' bindings. Please investigate bindings with")+("service identifier '"+i[1]+"'.")};T.CIRCULAR_DEPENDENCY_IN_FACTORY=zI;T.STACK_OVERFLOW="Maximum call stack size exceeded"});var xf=f(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.MetadataReader=void 0;var Cf=xe(),YI=function(){function i(){}return i.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(Cf.PARAM_TYPES,e),n=Reflect.getMetadata(Cf.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},i.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(Cf.TAGGED_PROP,e)||[];return t},i}();bc.MetadataReader=YI});var J_=f(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.BindingCount=void 0;var kI={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Sc.BindingCount=kI});var Df=f(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.isStackOverflowExeption=void 0;var UI=ht();function GI(i){return i instanceof RangeError||i.message===UI.STACK_OVERFLOW}Ec.isStackOverflowExeption=GI});var kr=f(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.circularDependencyToException=Vt.listMetadataForTarget=Vt.listRegisteredBindingsForServiceIdentifier=Vt.getServiceIdentifierAsString=Vt.getFunctionName=void 0;var WI=ht();function Z_(i){if(typeof i=="function"){var e=i;return e.name}else{if(typeof i=="symbol")return i.toString();var e=i;return e}}Vt.getServiceIdentifierAsString=Z_;function $I(i,e,t){var n="",r=t(i,e);return r.length!==0&&(n=`
Registered bindings:`,r.forEach(function(o){var s="Object";o.implementationType!==null&&(s=tv(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Vt.listRegisteredBindingsForServiceIdentifier=$I;function Q_(i,e){return i.parentRequest===null?!1:i.parentRequest.serviceIdentifier===e?!0:Q_(i.parentRequest,e)}function XI(i){function e(n,r){r===void 0&&(r=[]);var o=Z_(n.serviceIdentifier);return r.push(o),n.parentRequest!==null?e(n.parentRequest,r):r}var t=e(i);return t.reverse().join(" --> ")}function ev(i){i.childRequests.forEach(function(e){if(Q_(e,e.serviceIdentifier)){var t=XI(e);throw new Error(WI.CIRCULAR_DEPENDENCY+" "+t)}else ev(e)})}Vt.circularDependencyToException=ev;function JI(i,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),r=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),r!==null&&r.forEach(function(o){t+=o.toString()+`
`})," "+i+`
 `+i+" - "+t}else return" "+i}Vt.listMetadataForTarget=JI;function tv(i){if(i.name)return i.name;var e=i.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Vt.getFunctionName=tv});var nv=f(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.Context=void 0;var ZI=gi(),QI=function(){function i(e){this.id=ZI.id(),this.container=e}return i.prototype.addPlan=function(e){this.plan=e},i.prototype.setCurrentRequest=function(e){this.currentRequest=e},i}();wc.Context=QI});var Kt=f(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.Metadata=void 0;var eR=xe(),tR=function(){function i(e,t){this.key=e,this.value=t}return i.prototype.toString=function(){return this.key===eR.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},i}();Pc.Metadata=tR});var iv=f(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.Plan=void 0;var nR=function(){function i(e,t){this.parentContext=e,this.rootRequest=t}return i}();Ic.Plan=nR});var Un=f(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.tagProperty=mi.tagParameter=mi.decorate=void 0;var rv=ht(),sv=xe();function iR(i,e,t,n){var r=sv.TAGGED;av(r,i,e,n,t)}mi.tagParameter=iR;function rR(i,e,t){var n=sv.TAGGED_PROP;av(n,i.constructor,e,t)}mi.tagProperty=rR;function av(i,e,t,n,r){var o={},s=typeof r=="number",a=r!==void 0&&s?r.toString():t;if(s&&t!==void 0)throw new Error(rv.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(i,e)&&(o=Reflect.getMetadata(i,e));var c=o[a];if(!Array.isArray(c))c=[];else for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===n.key)throw new Error(rv.DUPLICATED_METADATA+" "+l.key.toString())}c.push(n),o[a]=c,Reflect.defineMetadata(i,o,e)}function ov(i,e){Reflect.decorate(i,e)}function oR(i,e){return function(t,n){e(t,n,i)}}function sR(i,e,t){typeof t=="number"?ov([oR(t,i)],e):typeof t=="string"?Reflect.decorate([i],e,t):ov([i],e)}mi.decorate=sR});var qf=f(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.inject=Ur.LazyServiceIdentifer=void 0;var aR=ht(),cR=xe(),uR=Kt(),cv=Un(),dR=function(){function i(e){this._cb=e}return i.prototype.unwrap=function(){return this._cb()},i}();Ur.LazyServiceIdentifer=dR;function lR(i){return function(e,t,n){if(i===void 0)throw new Error(aR.UNDEFINED_INJECT_ANNOTATION(e.name));var r=new uR.Metadata(cR.INJECT_TAG,i);typeof n=="number"?cv.tagParameter(e,t,n,r):cv.tagProperty(e,t,r)}}Ur.inject=lR});var uv=f(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.QueryableString=void 0;var fR=function(){function i(e){this.str=e}return i.prototype.startsWith=function(e){return this.str.indexOf(e)===0},i.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},i.prototype.contains=function(e){return this.str.indexOf(e)!==-1},i.prototype.equals=function(e){return this.str===e},i.prototype.value=function(){return this.str},i}();Rc.QueryableString=fR});var jf=f(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.Target=void 0;var Gn=xe(),hR=gi(),dv=Kt(),pR=uv(),gR=function(){function i(e,t,n,r){this.id=hR.id(),this.type=e,this.serviceIdentifier=n,this.name=new pR.QueryableString(t||""),this.metadata=new Array;var o=null;typeof r=="string"?o=new dv.Metadata(Gn.NAMED_TAG,r):r instanceof dv.Metadata&&(o=r),o!==null&&this.metadata.push(o)}return i.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var r=n[t];if(r.key===e)return!0}return!1},i.prototype.isArray=function(){return this.hasTag(Gn.MULTI_INJECT_TAG)},i.prototype.matchesArray=function(e){return this.matchesTag(Gn.MULTI_INJECT_TAG)(e)},i.prototype.isNamed=function(){return this.hasTag(Gn.NAMED_TAG)},i.prototype.isTagged=function(){return this.metadata.some(function(e){return Gn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},i.prototype.isOptional=function(){return this.matchesTag(Gn.OPTIONAL_TAG)(!0)},i.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Gn.NAMED_TAG})[0]:null},i.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Gn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},i.prototype.matchesNamedTag=function(e){return this.matchesTag(Gn.NAMED_TAG)(e)},i.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var s=o[r];if(s.key===e&&s.value===n)return!0}return!1}},i}();Mc.Target=gR});var _v=f(bn=>{"use strict";var Oc=bn&&bn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(bn,"__esModule",{value:!0});bn.getFunctionName=bn.getBaseClassDependencyCount=bn.getDependencies=void 0;var mR=qf(),lv=ht(),fv=vn(),qs=xe(),Nf=kr();Object.defineProperty(bn,"getFunctionName",{enumerable:!0,get:function(){return Nf.getFunctionName}});var hv=jf();function yR(i,e){var t=Nf.getFunctionName(e),n=pv(i,t,e,!1);return n}bn.getDependencies=yR;function pv(i,e,t,n){var r=i.getConstructorMetadata(t),o=r.compilerGeneratedMetadata;if(o===void 0){var s=lv.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=r.userGeneratedMetadata,c=Object.keys(a),u=t.length===0&&c.length>0,d=c.length>t.length,l=u||d?c.length:t.length,S=vR(n,e,o,a,l),R=gv(i,t),v=Oc(Oc([],S),R);return v}function _R(i,e,t,n,r){var o=r[i.toString()]||[],s=yv(o),a=s.unmanaged!==!0,c=n[i],u=s.inject||s.multiInject;if(c=u||c,c instanceof mR.LazyServiceIdentifer&&(c=c.unwrap()),a){var d=c===Object,l=c===Function,S=c===void 0,R=d||l||S;if(!e&&R){var v=lv.MISSING_INJECT_ANNOTATION+" argument "+i+" in class "+t+".";throw new Error(v)}var m=new hv.Target(fv.TargetTypeEnum.ConstructorArgument,s.targetName,c);return m.metadata=o,m}return null}function vR(i,e,t,n,r){for(var o=[],s=0;s<r;s++){var a=s,c=_R(a,i,e,t,n);c!==null&&o.push(c)}return o}function gv(i,e){for(var t=i.getPropertiesMetadata(e),n=[],r=Object.keys(t),o=0,s=r;o<s.length;o++){var a=s[o],c=t[a],u=yv(t[a]),d=u.targetName||a,l=u.inject||u.multiInject,S=new hv.Target(fv.TargetTypeEnum.ClassProperty,d,l);S.metadata=c,n.push(S)}var R=Object.getPrototypeOf(e.prototype).constructor;if(R!==Object){var v=gv(i,R);n=Oc(Oc([],n),v)}return n}function mv(i,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=Nf.getFunctionName(t),r=pv(i,n,t,!0),o=r.map(function(c){return c.metadata.filter(function(u){return u.key===qs.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=r.length-s;return a>0?a:mv(i,t)}else return 0}bn.getBaseClassDependencyCount=mv;function yv(i){var e={};return i.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[qs.INJECT_TAG],multiInject:e[qs.MULTI_INJECT_TAG],targetName:e[qs.NAME_TAG],unmanaged:e[qs.UNMANAGED_TAG]}}});var vv=f(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.Request=void 0;var bR=gi(),SR=function(){function i(e,t,n,r,o){this.id=bR.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=n===null?new Map:null}return i.prototype.addChildRequest=function(e,t,n){var r=new i(e,this.parentContext,this,t,n);return this.childRequests.push(r),r},i}();Tc.Request=SR});var Mv=f(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.getBindingDictionary=yi.createMockRequest=yi.plan=void 0;var Ac=J_(),Bf=ht(),Ev=vn(),bv=xe(),ER=Df(),Gr=kr(),wv=nv(),Ff=Kt(),wR=iv(),Lf=_v(),Vf=vv(),Pv=jf();function Iv(i){return i._bindingDictionary}yi.getBindingDictionary=Iv;function PR(i,e,t,n,r,o){var s=i?bv.MULTI_INJECT_TAG:bv.INJECT_TAG,a=new Ff.Metadata(s,t),c=new Pv.Target(e,n,t,a);if(r!==void 0){var u=new Ff.Metadata(r,o);c.metadata.push(u)}return c}function Sv(i,e,t,n,r){var o=js(t.container,r.serviceIdentifier),s=[];return o.length===Ac.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(r.serviceIdentifier).toSelf(),o=js(t.container,r.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new Vf.Request(a.serviceIdentifier,t,n,a,r);return a.constraint(c)}),IR(r.serviceIdentifier,s,r,t.container),s}function IR(i,e,t,n){switch(e.length){case Ac.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var r=Gr.getServiceIdentifierAsString(i),o=Bf.NOT_REGISTERED;throw o+=Gr.listMetadataForTarget(r,t),o+=Gr.listRegisteredBindingsForServiceIdentifier(n,r,js),new Error(o);case Ac.BindingCount.OnlyOneBindingAvailable:if(!t.isArray())return e;case Ac.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var r=Gr.getServiceIdentifierAsString(i),o=Bf.AMBIGUOUS_MATCH+" "+r;throw o+=Gr.listRegisteredBindingsForServiceIdentifier(n,r,js),new Error(o)}}function Rv(i,e,t,n,r,o){var s,a;if(r===null){s=Sv(i,e,n,null,o),a=new Vf.Request(t,n,null,s,o);var c=new wR.Plan(n,a);n.addPlan(c)}else s=Sv(i,e,n,r,o),a=r.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(u){var d=null;if(o.isArray())d=a.addChildRequest(u.serviceIdentifier,u,o);else{if(u.cache)return;d=a}if(u.type===Ev.BindingTypeEnum.Instance&&u.implementationType!==null){var l=Lf.getDependencies(i,u.implementationType);if(!n.container.options.skipBaseClassChecks){var S=Lf.getBaseClassDependencyCount(i,u.implementationType);if(l.length<S){var R=Bf.ARGUMENTS_LENGTH_MISMATCH(Lf.getFunctionName(u.implementationType));throw new Error(R)}}l.forEach(function(v){Rv(i,!1,v.serviceIdentifier,n,d,v)})}})}function js(i,e){var t=[],n=Iv(i);return n.hasKey(e)?t=n.get(e):i.parent!==null&&(t=js(i.parent,e)),t}function RR(i,e,t,n,r,o,s,a){a===void 0&&(a=!1);var c=new wv.Context(e),u=PR(t,n,r,"",o,s);try{return Rv(i,a,r,c,null,u),c}catch(d){throw ER.isStackOverflowExeption(d)&&c.plan&&Gr.circularDependencyToException(c.plan.rootRequest),d}}yi.plan=RR;function MR(i,e,t,n){var r=new Pv.Target(Ev.TargetTypeEnum.Variable,"",e,new Ff.Metadata(t,n)),o=new wv.Context(i),s=new Vf.Request(e,o,null,[],r);return s}yi.createMockRequest=MR});var Av=f(Wr=>{"use strict";var OR=Wr&&Wr.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.resolveInstance=void 0;var TR=ht(),Tv=vn(),Ov=xe();function AR(i,e,t){var n=e.filter(function(o){return o.target!==null&&o.target.type===Tv.TargetTypeEnum.ClassProperty}),r=n.map(t);return n.forEach(function(o,s){var a="";a=o.target.name.value();var c=r[s];i[a]=c}),i}function CR(i,e){return new(i.bind.apply(i,OR([void 0],e)))}function xR(i,e){if(Reflect.hasMetadata(Ov.POST_CONSTRUCT,i)){var t=Reflect.getMetadata(Ov.POST_CONSTRUCT,i);try{e[t.value]()}catch(n){throw new Error(TR.POST_CONSTRUCT_ERROR(i.name,n.message))}}}function DR(i,e,t){var n=null;if(e.length>0){var r=e.filter(function(s){return s.target!==null&&s.target.type===Tv.TargetTypeEnum.ConstructorArgument}),o=r.map(t);n=CR(i,o),n=AR(n,e,t)}else n=new i;return xR(i,n),n}Wr.resolveInstance=DR});var xv=f(Cc=>{"use strict";Object.defineProperty(Cc,"__esModule",{value:!0});Cc.resolve=void 0;var Cv=ht(),Wn=vn(),qR=Df(),jR=kr(),NR=Av(),Kf=function(i,e,t){try{return t()}catch(n){throw qR.isStackOverflowExeption(n)?new Error(Cv.CIRCULAR_DEPENDENCY_IN_FACTORY(i,e.toString())):n}},Hf=function(i){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,r=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(r&&o)return n.map(function(l){var S=Hf(i);return S(l)});var s=null;if(e.target.isOptional()&&t.length===0)return;var a=t[0],c=a.scope===Wn.BindingScopeEnum.Singleton,u=a.scope===Wn.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&i!==null&&i.has(a.id))return i.get(a.id);if(a.type===Wn.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===Wn.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===Wn.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===Wn.BindingTypeEnum.DynamicValue&&a.dynamicValue!==null)s=Kf("toDynamicValue",a.serviceIdentifier,function(){return a.dynamicValue(e.parentContext)});else if(a.type===Wn.BindingTypeEnum.Factory&&a.factory!==null)s=Kf("toFactory",a.serviceIdentifier,function(){return a.factory(e.parentContext)});else if(a.type===Wn.BindingTypeEnum.Provider&&a.provider!==null)s=Kf("toProvider",a.serviceIdentifier,function(){return a.provider(e.parentContext)});else if(a.type===Wn.BindingTypeEnum.Instance&&a.implementationType!==null)s=NR.resolveInstance(a.implementationType,n,Hf(i));else{var d=jR.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(Cv.INVALID_BINDING_TYPE+" "+d)}return typeof a.onActivation=="function"&&(s=a.onActivation(e.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&i!==null&&!i.has(a.id)&&i.set(a.id,s),s}};function LR(i){var e=Hf(i.plan.rootRequest.requestScope);return e(i.plan.rootRequest)}Cc.resolve=LR});var zf=f(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.typeConstraint=Sn.namedConstraint=Sn.taggedConstraint=Sn.traverseAncerstors=void 0;var BR=xe(),FR=Kt(),Dv=function(i,e){var t=i.parentRequest;return t!==null?e(t)?!0:Dv(t,e):!1};Sn.traverseAncerstors=Dv;var qv=function(i){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(i)(e)};return t.metaData=new FR.Metadata(i,e),t}};Sn.taggedConstraint=qv;var VR=qv(BR.NAMED_TAG);Sn.namedConstraint=VR;var KR=function(i){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof i=="string"){var n=t.serviceIdentifier;return n===i}else{var r=e.bindings[0].implementationType;return i===r}return!1}};Sn.typeConstraint=KR});var Dc=f(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.BindingWhenSyntax=void 0;var st=qc(),De=zf(),HR=function(){function i(e){this._binding=e}return i.prototype.when=function(e){return this._binding.constraint=e,new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetNamed=function(e){return this._binding.constraint=De.namedConstraint(e),new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=De.taggedConstraint(e)(t),new st.BindingOnSyntax(this._binding)},i.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return De.typeConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return De.namedConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return De.taggedConstraint(e)(t)(n.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i}();xc.BindingWhenSyntax=HR});var qc=f(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.BindingOnSyntax=void 0;var zR=Dc(),YR=function(){function i(e){this._binding=e}return i.prototype.onActivation=function(e){return this._binding.onActivation=e,new zR.BindingWhenSyntax(this._binding)},i}();jc.BindingOnSyntax=YR});var Yf=f(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.BindingWhenOnSyntax=void 0;var kR=qc(),UR=Dc(),GR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new UR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kR.BindingOnSyntax(this._binding)}return i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Nc.BindingWhenOnSyntax=GR});var jv=f(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.BindingInSyntax=void 0;var kf=vn(),Uf=Yf(),WR=function(){function i(e){this._binding=e}return i.prototype.inRequestScope=function(){return this._binding.scope=kf.BindingScopeEnum.Request,new Uf.BindingWhenOnSyntax(this._binding)},i.prototype.inSingletonScope=function(){return this._binding.scope=kf.BindingScopeEnum.Singleton,new Uf.BindingWhenOnSyntax(this._binding)},i.prototype.inTransientScope=function(){return this._binding.scope=kf.BindingScopeEnum.Transient,new Uf.BindingWhenOnSyntax(this._binding)},i}();Lc.BindingInSyntax=WR});var Nv=f(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.BindingInWhenOnSyntax=void 0;var $R=jv(),XR=qc(),JR=Dc(),ZR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new JR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new XR.BindingOnSyntax(this._binding),this._bindingInSyntax=new $R.BindingInSyntax(e)}return i.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},i.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},i.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Bc.BindingInWhenOnSyntax=ZR});var Fv=f(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.BindingToSyntax=void 0;var Lv=ht(),pt=vn(),Bv=Nv(),Ns=Yf(),QR=function(){function i(e){this._binding=e}return i.prototype.to=function(e){return this._binding.type=pt.BindingTypeEnum.Instance,this._binding.implementationType=e,new Bv.BindingInWhenOnSyntax(this._binding)},i.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Lv.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},i.prototype.toConstantValue=function(e){return this._binding.type=pt.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pt.BindingScopeEnum.Singleton,new Ns.BindingWhenOnSyntax(this._binding)},i.prototype.toDynamicValue=function(e){return this._binding.type=pt.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Bv.BindingInWhenOnSyntax(this._binding)},i.prototype.toConstructor=function(e){return this._binding.type=pt.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Ns.BindingWhenOnSyntax(this._binding)},i.prototype.toFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Ns.BindingWhenOnSyntax(this._binding)},i.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Lv.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=pt.BindingTypeEnum.Function,this._binding.scope=pt.BindingScopeEnum.Singleton,t},i.prototype.toAutoFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=pt.BindingScopeEnum.Singleton,new Ns.BindingWhenOnSyntax(this._binding)},i.prototype.toProvider=function(e){return this._binding.type=pt.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Ns.BindingWhenOnSyntax(this._binding)},i.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},i}();Fc.BindingToSyntax=QR});var Vv=f(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.ContainerSnapshot=void 0;var eM=function(){function i(){}return i.of=function(e,t){var n=new i;return n.bindings=e,n.middleware=t,n},i}();Vc.ContainerSnapshot=eM});var Kv=f(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.Lookup=void 0;var nr=ht(),tM=function(){function i(){this._map=new Map}return i.prototype.getMap=function(){return this._map},i.prototype.add=function(e,t){if(e==null)throw new Error(nr.NULL_ARGUMENT);if(t==null)throw new Error(nr.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},i.prototype.get=function(e){if(e==null)throw new Error(nr.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(nr.KEY_NOT_FOUND)},i.prototype.remove=function(e){if(e==null)throw new Error(nr.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(nr.KEY_NOT_FOUND)},i.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var o=n.filter(function(s){return!e(s)});o.length>0?t._map.set(r,o):t._map.delete(r)})},i.prototype.hasKey=function(e){if(e==null)throw new Error(nr.NULL_ARGUMENT);return this._map.has(e)},i.prototype.clone=function(){var e=new i;return this._map.forEach(function(t,n){t.forEach(function(r){return e.add(n,r.clone())})}),e},i.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},i}();Kc.Lookup=tM});var zv=f(En=>{"use strict";var nM=En&&En.__awaiter||function(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(l){s(l)}}function c(d){try{u(n.throw(d))}catch(l){s(l)}}function u(d){d.done?o(d.value):r(d.value).then(a,c)}u((n=n.apply(i,e||[])).next())})},iM=En&&En.__generator||function(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},rM=En&&En.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(En,"__esModule",{value:!0});En.Container=void 0;var oM=X_(),ir=ht(),$n=vn(),Gf=xe(),sM=xf(),Hc=Mv(),aM=xv(),cM=Fv(),uM=gi(),dM=kr(),lM=Vv(),Hv=Kv(),fM=function(){function i(e){this._appliedMiddleware=[];var t=e||{};if(typeof t!="object")throw new Error(""+ir.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=$n.BindingScopeEnum.Transient;else if(t.defaultScope!==$n.BindingScopeEnum.Singleton&&t.defaultScope!==$n.BindingScopeEnum.Transient&&t.defaultScope!==$n.BindingScopeEnum.Request)throw new Error(""+ir.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+ir.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+ir.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=uM.id(),this._bindingDictionary=new Hv.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new sM.MetadataReader}return i.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i,s=rM([e,t],n).map(function(u){return Hc.getBindingDictionary(u)}),a=Hc.getBindingDictionary(o);function c(u,d){u.traverse(function(l,S){S.forEach(function(R){d.add(R.serviceIdentifier,R.clone())})})}return s.forEach(function(u){c(u,a)}),o},i.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var s=o[r],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},i.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return nM(this,void 0,void 0,function(){var n,r,o,s,a;return iM(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(o){return function(s){return s.moduleId===o}};t.forEach(function(o){var s=r(o.id);e._bindingDictionary.removeByCondition(s)})},i.prototype.bind=function(e){var t=this.options.defaultScope||$n.BindingScopeEnum.Transient,n=new oM.Binding(e,t);return this._bindingDictionary.add(e,n),new cM.BindingToSyntax(n)},i.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},i.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(ir.CANNOT_UNBIND+" "+dM.getServiceIdentifierAsString(e))}},i.prototype.unbindAll=function(){this._bindingDictionary=new Hv.Lookup},i.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},i.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Gf.NAMED_TAG,t)},i.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=Hc.createMockRequest(this,e,t,n);r=o.some(function(a){return a.constraint(s)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},i.prototype.snapshot=function(){this._snapshots.push(lM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},i.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(ir.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},i.prototype.createChild=function(e){var t=new i(e||this.options);return t.parent=this,t},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(r,o){return o(r)},n)},i.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},i.prototype.get=function(e){return this._get(!1,!1,$n.TargetTypeEnum.Variable,e)},i.prototype.getTagged=function(e,t,n){return this._get(!1,!1,$n.TargetTypeEnum.Variable,e,t,n)},i.prototype.getNamed=function(e,t){return this.getTagged(e,Gf.NAMED_TAG,t)},i.prototype.getAll=function(e){return this._get(!0,!0,$n.TargetTypeEnum.Variable,e)},i.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,$n.TargetTypeEnum.Variable,e,t,n)},i.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Gf.NAMED_TAG,t)},i.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(e)},i.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(a,c){a._binding.moduleId=c},n=function(a){return function(c){var u=e.bind.bind(e),d=u(c);return t(d,a),d}},r=function(a){return function(c){var u=e.unbind.bind(e);u(c)}},o=function(a){return function(c){var u=e.isBound.bind(e);return u(c)}},s=function(a){return function(c){var u=e.rebind.bind(e),d=u(c);return t(d,a),d}};return function(a){return{bindFunction:n(a),isboundFunction:o(a),rebindFunction:s(a),unbindFunction:r(a)}}},i.prototype._get=function(e,t,n,r,o,s){var a=null,c={avoidConstraints:e,contextInterceptor:function(u){return u},isMultiInject:t,key:o,serviceIdentifier:r,targetType:n,value:s};if(this._middleware){if(a=this._middleware(c),a==null)throw new Error(ir.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},i.prototype._planAndResolve=function(){var e=this;return function(t){var n=Hc.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var r=aM.resolve(n);return r}},i}();En.Container=fM});var kv=f($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.AsyncContainerModule=$r.ContainerModule=void 0;var Yv=gi(),hM=function(){function i(e){this.id=Yv.id(),this.registry=e}return i}();$r.ContainerModule=hM;var pM=function(){function i(e){this.id=Yv.id(),this.registry=e}return i}();$r.AsyncContainerModule=pM});var Uv=f(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.injectable=void 0;var gM=ht(),Wf=xe();function mM(){return function(i){if(Reflect.hasOwnMetadata(Wf.PARAM_TYPES,i))throw new Error(gM.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(Wf.DESIGN_PARAM_TYPES,i)||[];return Reflect.defineMetadata(Wf.PARAM_TYPES,e,i),i}}zc.injectable=mM});var Wv=f(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.tagged=void 0;var yM=Kt(),Gv=Un();function _M(i,e){return function(t,n,r){var o=new yM.Metadata(i,e);typeof r=="number"?Gv.tagParameter(t,n,r,o):Gv.tagProperty(t,n,o)}}Yc.tagged=_M});var Xv=f(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.named=void 0;var vM=xe(),bM=Kt(),$v=Un();function SM(i){return function(e,t,n){var r=new bM.Metadata(vM.NAMED_TAG,i);typeof n=="number"?$v.tagParameter(e,t,n,r):$v.tagProperty(e,t,r)}}kc.named=SM});var Zv=f(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.optional=void 0;var EM=xe(),wM=Kt(),Jv=Un();function PM(){return function(i,e,t){var n=new wM.Metadata(EM.OPTIONAL_TAG,!0);typeof t=="number"?Jv.tagParameter(i,e,t,n):Jv.tagProperty(i,e,n)}}Uc.optional=PM});var Qv=f(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.unmanaged=void 0;var IM=xe(),RM=Kt(),MM=Un();function OM(){return function(i,e,t){var n=new RM.Metadata(IM.UNMANAGED_TAG,!0);MM.tagParameter(i,e,t,n)}}Gc.unmanaged=OM});var tb=f(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});Wc.multiInject=void 0;var TM=xe(),AM=Kt(),eb=Un();function CM(i){return function(e,t,n){var r=new AM.Metadata(TM.MULTI_INJECT_TAG,i);typeof n=="number"?eb.tagParameter(e,t,n,r):eb.tagProperty(e,t,r)}}Wc.multiInject=CM});var nb=f($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.targetName=void 0;var xM=xe(),DM=Kt(),qM=Un();function jM(i){return function(e,t,n){var r=new DM.Metadata(xM.NAME_TAG,i);qM.tagParameter(e,t,n,r)}}$c.targetName=jM});var ib=f(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.postConstruct=void 0;var NM=ht(),$f=xe(),LM=Kt();function BM(){return function(i,e,t){var n=new LM.Metadata($f.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata($f.POST_CONSTRUCT,i.constructor))throw new Error(NM.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata($f.POST_CONSTRUCT,n,i.constructor)}}Xc.postConstruct=BM});var rb=f(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.multiBindToService=void 0;var FM=function(i){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(r){return i.bind(r).toService(e)})}}};Jc.multiBindToService=FM});var _=f(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.multiBindToService=D.getServiceIdentifierAsString=D.typeConstraint=D.namedConstraint=D.taggedConstraint=D.traverseAncerstors=D.decorate=D.id=D.MetadataReader=D.postConstruct=D.targetName=D.multiInject=D.unmanaged=D.optional=D.LazyServiceIdentifer=D.inject=D.named=D.tagged=D.injectable=D.ContainerModule=D.AsyncContainerModule=D.TargetTypeEnum=D.BindingTypeEnum=D.BindingScopeEnum=D.Container=D.METADATA_KEY=void 0;var VM=xe();D.METADATA_KEY=VM;var KM=zv();Object.defineProperty(D,"Container",{enumerable:!0,get:function(){return KM.Container}});var Xf=vn();Object.defineProperty(D,"BindingScopeEnum",{enumerable:!0,get:function(){return Xf.BindingScopeEnum}});Object.defineProperty(D,"BindingTypeEnum",{enumerable:!0,get:function(){return Xf.BindingTypeEnum}});Object.defineProperty(D,"TargetTypeEnum",{enumerable:!0,get:function(){return Xf.TargetTypeEnum}});var ob=kv();Object.defineProperty(D,"AsyncContainerModule",{enumerable:!0,get:function(){return ob.AsyncContainerModule}});Object.defineProperty(D,"ContainerModule",{enumerable:!0,get:function(){return ob.ContainerModule}});var HM=Uv();Object.defineProperty(D,"injectable",{enumerable:!0,get:function(){return HM.injectable}});var zM=Wv();Object.defineProperty(D,"tagged",{enumerable:!0,get:function(){return zM.tagged}});var YM=Xv();Object.defineProperty(D,"named",{enumerable:!0,get:function(){return YM.named}});var sb=qf();Object.defineProperty(D,"inject",{enumerable:!0,get:function(){return sb.inject}});Object.defineProperty(D,"LazyServiceIdentifer",{enumerable:!0,get:function(){return sb.LazyServiceIdentifer}});var kM=Zv();Object.defineProperty(D,"optional",{enumerable:!0,get:function(){return kM.optional}});var UM=Qv();Object.defineProperty(D,"unmanaged",{enumerable:!0,get:function(){return UM.unmanaged}});var GM=tb();Object.defineProperty(D,"multiInject",{enumerable:!0,get:function(){return GM.multiInject}});var WM=nb();Object.defineProperty(D,"targetName",{enumerable:!0,get:function(){return WM.targetName}});var $M=ib();Object.defineProperty(D,"postConstruct",{enumerable:!0,get:function(){return $M.postConstruct}});var XM=xf();Object.defineProperty(D,"MetadataReader",{enumerable:!0,get:function(){return XM.MetadataReader}});var JM=gi();Object.defineProperty(D,"id",{enumerable:!0,get:function(){return JM.id}});var ZM=Un();Object.defineProperty(D,"decorate",{enumerable:!0,get:function(){return ZM.decorate}});var Zc=zf();Object.defineProperty(D,"traverseAncerstors",{enumerable:!0,get:function(){return Zc.traverseAncerstors}});Object.defineProperty(D,"taggedConstraint",{enumerable:!0,get:function(){return Zc.taggedConstraint}});Object.defineProperty(D,"namedConstraint",{enumerable:!0,get:function(){return Zc.namedConstraint}});Object.defineProperty(D,"typeConstraint",{enumerable:!0,get:function(){return Zc.typeConstraint}});var QM=kr();Object.defineProperty(D,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return QM.getServiceIdentifierAsString}});var eO=rb();Object.defineProperty(D,"multiBindToService",{enumerable:!0,get:function(){return eO.multiBindToService}})});var eu=f(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.Deferred=void 0;var Jf=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};Qc.Deferred=Jf});var P=f(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.TYPES=void 0;tu.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandler:Symbol("IButtonHandler"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),IToolManager:Symbol("IToolManager"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}});var wn=f(Ht=>{"use strict";var nu=Ht&&Ht.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.MultiInstanceRegistry=Ht.InstanceRegistry=Ht.FactoryRegistry=Ht.ProviderRegistry=void 0;var iu=_(),Zf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?new n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};Zf=nu([(0,iu.injectable)()],Zf);Ht.ProviderRegistry=Zf;var Qf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};Qf=nu([(0,iu.injectable)()],Qf);Ht.FactoryRegistry=Qf;var eh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e){let t=this.elements.get(e);return t||this.missing(e)}missing(e){throw new Error("Unknown registry key: "+e)}};eh=nu([(0,iu.injectable)()],eh);Ht.InstanceRegistry=eh;var th=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");let n=this.elements.get(e);n!==void 0?n.push(t):this.elements.set(e,[t])}deregisterAll(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}get(e){let t=this.elements.get(e);return t!==void 0?t:[]}};th=nu([(0,iu.injectable)()],th);Ht.MultiInstanceRegistry=th});var Q=f(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.almostEquals=le.toRadians=le.toDegrees=le.Bounds=le.isBounds=le.Dimension=le.centerOfLine=le.angleBetweenPoints=le.angleOfPoint=le.Point=void 0;var tO=_n(),nO;(function(i){i.ORIGIN=Object.freeze({x:0,y:0});function e(l,S){return{x:l.x+S.x,y:l.y+S.y}}i.add=e;function t(l,S){return{x:l.x-S.x,y:l.y-S.y}}i.subtract=t;function n(l,S){return l.x===S.x&&l.y===S.y}i.equals=n;function r(l,S,R){let v=t(S,l),m=o(v),O={x:m.x*R,y:m.y*R};return e(l,O)}i.shiftTowards=r;function o(l){let S=s(l);return S===0||S===1?i.ORIGIN:{x:l.x/S,y:l.y/S}}i.normalize=o;function s(l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))}i.magnitude=s;function a(l,S,R){return{x:(1-R)*l.x+R*S.x,y:(1-R)*l.y+R*S.y}}i.linear=a;function c(l,S){let R=S.x-l.x,v=S.y-l.y;return Math.sqrt(R*R+v*v)}i.euclideanDistance=c;function u(l,S){return Math.abs(S.x-l.x)+Math.abs(S.y-l.y)}i.manhattanDistance=u;function d(l,S){return Math.max(Math.abs(S.x-l.x),Math.abs(S.y-l.y))}i.maxDistance=d})(nO=le.Point||(le.Point={}));function iO(i){return Math.atan2(i.y,i.x)}le.angleOfPoint=iO;function rO(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}le.angleBetweenPoints=rO;function oO(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return ab.center(t)}le.centerOfLine=oO;var ru;(function(i){i.EMPTY=Object.freeze({width:-1,height:-1});function e(t){return t.width>=0&&t.height>=0}i.isValid=e})(ru=le.Dimension||(le.Dimension={}));function sO(i){return(0,tO.hasOwnProperty)(i,["x","y","width","height"])}le.isBounds=sO;var ab;(function(i){i.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function e(o,s){if(!ru.isValid(o))return ru.isValid(s)?s:i.EMPTY;if(!ru.isValid(s))return o;let a=Math.min(o.x,s.x),c=Math.min(o.y,s.y),u=Math.max(o.x+(o.width>=0?o.width:0),s.x+(s.width>=0?s.width:0)),d=Math.max(o.y+(o.height>=0?o.height:0),s.y+(s.height>=0?s.height:0));return{x:a,y:c,width:u-a,height:d-c}}i.combine=e;function t(o,s){return{x:o.x+s.x,y:o.y+s.y,width:o.width,height:o.height}}i.translate=t;function n(o){return{x:o.x+(o.width>=0?.5*o.width:0),y:o.y+(o.height>=0?.5*o.height:0)}}i.center=n;function r(o,s){return s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height}i.includes=r})(ab=le.Bounds||(le.Bounds={}));function aO(i){return i*180/Math.PI}le.toDegrees=aO;function cO(i){return i*Math.PI/180}le.toRadians=cO;function uO(i,e){return Math.abs(i-e)<.001}le.almostEquals=uO});var rr=f(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.mapIterable=at.filterIterable=at.DONE_RESULT=at.toArray=at.FluentIterableImpl=void 0;var Ls=class{constructor(e,t){this.startFn=e,this.nextFn=t}[Symbol.iterator](){let e={state:this.startFn(),next:()=>this.nextFn(e.state),[Symbol.iterator]:()=>e};return e}filter(e){return cb(this,e)}map(e){return ub(this,e)}forEach(e){let t=this[Symbol.iterator](),n=0,r;do r=t.next(),r.value!==void 0&&e(r.value,n),n++;while(!r.done)}indexOf(e){let t=this[Symbol.iterator](),n=0,r;do{if(r=t.next(),r.value===e)return n;n++}while(!r.done);return-1}};at.FluentIterableImpl=Ls;function dO(i){if(i.constructor===Array)return i;let e=[];return i.forEach(t=>e.push(t)),e}at.toArray=dO;at.DONE_RESULT=Object.freeze({done:!0,value:void 0});function cb(i,e){return new Ls(()=>db(i),t=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n})}at.filterIterable=cb;function ub(i,e){return new Ls(()=>db(i),t=>{let{done:n,value:r}=t.next();return n?at.DONE_RESULT:{done:!1,value:e(r)}})}at.mapIterable=ub;function db(i){let e=i[Symbol.iterator];if(typeof e=="function")return e.call(i);let t=i.length;return typeof t=="number"&&t>=0?new nh(i):{next:()=>at.DONE_RESULT}}var nh=class{constructor(e){this.array=e,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:at.DONE_RESULT}[Symbol.iterator](){return this}}});var G=f(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.ModelIndexImpl=Xe.createRandomId=Xe.SModelRoot=Xe.SChildElement=Xe.SParentElement=Xe.isParent=Xe.SModelElement=void 0;var ih=Q(),lO=rr(),ou=class{get root(){let e=this;for(;e;){if(e instanceof au)return e;e instanceof su?e=e.parent:e=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(e){return this.features!==void 0&&this.features.has(e)}};Xe.SModelElement=ou;function fO(i){let e=i.children;return e!==void 0&&e.constructor===Array}Xe.isParent=fO;var or=class extends ou{constructor(){super(...arguments),this.children=[]}add(e,t){let n=this.children;if(t===void 0)n.push(e);else{if(t<0||t>this.children.length)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(t,0,e)}e.parent=this,this.index.add(e)}remove(e){let t=this.children,n=t.indexOf(e);if(n<0)throw new Error(`No such child ${e.id}`);t.splice(n,1),this.index.remove(e)}removeAll(e){let t=this.children;if(e!==void 0){for(let n=t.length-1;n>=0;n--)if(e(t[n])){let r=t.splice(n,1)[0];this.index.remove(r)}}else t.forEach(n=>{this.index.remove(n)}),t.splice(0,t.length)}move(e,t){let n=this.children,r=n.indexOf(e);if(r===-1)throw new Error(`No such child ${e.id}`);if(t<0||t>n.length-1)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(r,1),n.splice(t,0,e)}localToParent(e){return(0,ih.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}parentToLocal(e){return(0,ih.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}};Xe.SParentElement=or;var su=class extends or{};Xe.SChildElement=su;var au=class extends or{constructor(e=new cu){super(),this.canvasBounds=ih.Bounds.EMPTY,Object.defineProperty(this,"index",{value:e,writable:!1})}};Xe.SModelRoot=au;var lb="0123456789abcdefghijklmnopqrstuvwxyz";function fb(i=8){let e="";for(let t=0;t<i;t++)e+=lb.charAt(Math.floor(Math.random()*lb.length));return e}Xe.createRandomId=fb;var cu=class{constructor(){this.id2element=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else do e.id=fb();while(this.contains(e));if(this.id2element.set(e.id,e),e instanceof or)for(let t of e.children)this.add(t)}remove(e){if(this.id2element.delete(e.id),e instanceof or)for(let t of e.children)this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getAttachedElements(e){return[]}all(){return(0,lO.mapIterable)(this.id2element,([e,t])=>t)}};Xe.ModelIndexImpl=cu});var Pn=f(Je=>{"use strict";var rh=Je&&Je.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},pb=Je&&Je.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},hb=Je&&Je.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Je,"__esModule",{value:!0});Je.createFeatureSet=Je.EMPTY_ROOT=Je.SModelFactory=Je.SModelRegistry=void 0;var Bs=_(),gb=P(),hO=wn(),Xr=G(),uu=class extends hO.FactoryRegistry{constructor(e){super(),e.forEach(t=>{let n=this.getDefaultFeatures(t.constr);if(!n&&t.features&&t.features.enable&&(n=[]),n){let r=mb(n,t.features);this.register(t.type,()=>{let o=new t.constr;return o.features=r,o})}else this.register(t.type,()=>new t.constr)})}getDefaultFeatures(e){let t=e;do{let n=t.DEFAULT_FEATURES;if(n)return n;t=Object.getPrototypeOf(t)}while(t)}};uu=rh([(0,Bs.injectable)(),hb(0,(0,Bs.multiInject)(gb.TYPES.SModelElementRegistration)),hb(0,(0,Bs.optional)()),pb("design:paramtypes",[Array])],uu);Je.SModelRegistry=uu;var du=class{createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Xr.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else n=new Xr.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Xr.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else t=new Xr.SModelRoot;return this.initializeRoot(t,e)}createSchema(e){let t={};for(let n in e)if(!this.isReserved(e,n)){let r=e[n];typeof r!="function"&&(t[n]=r)}return e instanceof Xr.SParentElement&&(t.children=e.children.map(n=>this.createSchema(n))),t}initializeElement(e,t){for(let n in t)if(!this.isReserved(e,n)){let r=t[n];typeof r!="function"&&(e[n]=r)}return e}isReserved(e,t){if(["children","parent","index"].indexOf(t)>=0)return!0;let n=e;do{let r=Object.getOwnPropertyDescriptor(n,t);if(r!==void 0)return r.get!==void 0;n=Object.getPrototypeOf(n)}while(n);return!1}initializeParent(e,t){return this.initializeElement(e,t),(0,Xr.isParent)(t)&&(e.children=t.children.map(n=>this.createElement(n,e))),e}initializeChild(e,t,n){return this.initializeParent(e,t),n!==void 0&&(e.parent=n),e}initializeRoot(e,t){return this.initializeParent(e,t),e.index.add(e),e}};rh([(0,Bs.inject)(gb.TYPES.SModelRegistry),pb("design:type",uu)],du.prototype,"registry",void 0);du=rh([(0,Bs.injectable)()],du);Je.SModelFactory=du;Je.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function mb(i,e){let t=new Set(i);if(e&&e.enable)for(let n of e.enable)t.add(n);if(e&&e.disable)for(let n of e.disable)t.delete(n);return t}Je.createFeatureSet=mb});var Zr=f(Jr=>{"use strict";var pO=Jr&&Jr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.AnimationFrameSyncer=void 0;var gO=_(),oh=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(e){this.tasks.push(e),this.trigger()}onEndOfNextFrame(e){this.endTasks.push(e),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(e=>this.run(e)):setTimeout(e=>this.run(e)))}run(e){let t=this.tasks,n=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],t.forEach(r=>r.call(void 0,e)),n.forEach(r=>r.call(void 0,e))}};oh=pO([(0,gO.injectable)()],oh);Jr.AnimationFrameSyncer=oh});var lu=f(vi=>{"use strict";var Qr=vi&&vi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Fs=vi&&vi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(vi,"__esModule",{value:!0});vi.ActionDispatcher=void 0;var eo=_(),sr=te(),mO=eu(),Vs=P(),yO=Pn(),_O=Zr(),_i=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(e=>{this.actionHandlerRegistry=e,this.handleAction(sr.SetModelAction.create(yO.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(e){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(e,this.blockUntil);if(this.diagramLocker.isAllowed(e))return this.handleAction(e)})}dispatchAll(e){return Promise.all(e.map(t=>this.dispatch(t)))}request(e){if(!e.requestId)return Promise.reject(new Error("Request without requestId"));let t=new mO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(()=>{}),t.promise}handleAction(e){if(e.kind===sr.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(e.kind===sr.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,sr.isResponseAction)(e)){let r=this.requests.get(e.responseId);if(r!==void 0){if(this.requests.delete(e.responseId),e.kind===sr.RejectAction.KIND){let o=e;r.reject(new Error(o.message)),this.logger.warn(this,`Request with id ${e.responseId} failed.`,o.message,o.detail)}else r.resolve(e);return Promise.resolve()}this.logger.log(this,"No matching request for response",e)}let t=this.actionHandlerRegistry.get(e.kind);if(t.length===0){this.logger.warn(this,"Missing handler for action",e);let r=new Error(`Missing handler for action '${e.kind}'`);if((0,sr.isRequestAction)(e)){let o=this.requests.get(e.requestId);o!==void 0&&(this.requests.delete(e.requestId),o.reject(r))}return Promise.reject(r)}this.logger.log(this,"Handle",e);let n=[];for(let r of t){let o=r.handle(e);(0,sr.isAction)(o)?n.push(this.dispatch(o)):o!==void 0&&(n.push(this.commandStack.execute(o)),this.blockUntil=o.blockUntil)}return Promise.all(n)}handleBlocked(e,t){if(t(e)){this.blockUntil=void 0;let n=this.handleAction(e),r=this.postponedActions;this.postponedActions=[];for(let o of r)this.dispatch(o.action).then(o.resolve,o.reject);return n}else return this.logger.log(this,"Action is postponed due to block condition",e),new Promise((n,r)=>{this.postponedActions.push({action:e,resolve:n,reject:r})})}};Qr([(0,eo.inject)(Vs.TYPES.ActionHandlerRegistryProvider),Fs("design:type",Function)],_i.prototype,"actionHandlerRegistryProvider",void 0);Qr([(0,eo.inject)(Vs.TYPES.ICommandStack),Fs("design:type",Object)],_i.prototype,"commandStack",void 0);Qr([(0,eo.inject)(Vs.TYPES.ILogger),Fs("design:type",Object)],_i.prototype,"logger",void 0);Qr([(0,eo.inject)(Vs.TYPES.AnimationFrameSyncer),Fs("design:type",_O.AnimationFrameSyncer)],_i.prototype,"syncer",void 0);Qr([(0,eo.inject)(Vs.TYPES.IDiagramLocker),Fs("design:type",Object)],_i.prototype,"diagramLocker",void 0);_i=Qr([(0,eo.injectable)()],_i);vi.ActionDispatcher=_i});var ar=f(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});fu.isInjectable=void 0;function vO(i){return Reflect.getMetadata("inversify:paramtypes",i)!==void 0}fu.isInjectable=vO});var Hs=f(gt=>{"use strict";var bO=gt&&gt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},SO=gt&&gt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},hu=gt&&gt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(gt,"__esModule",{value:!0});gt.onAction=gt.configureActionHandler=gt.ActionHandlerRegistry=void 0;var Ks=_(),pu=P(),EO=wn(),wO=ar(),sh=class extends EO.MultiInstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.actionKind,n.factory())),t.forEach(n=>this.initializeActionHandler(n))}initializeActionHandler(e){e.initialize(this)}};sh=bO([(0,Ks.injectable)(),hu(0,(0,Ks.multiInject)(pu.TYPES.ActionHandlerRegistration)),hu(0,(0,Ks.optional)()),hu(1,(0,Ks.multiInject)(pu.TYPES.IActionHandlerInitializer)),hu(1,(0,Ks.optional)()),SO("design:paramtypes",[Array,Array])],sh);gt.ActionHandlerRegistry=sh;function PO(i,e,t){if(typeof t=="function"){if(!(0,wO.isInjectable)(t))throw new Error(`Action handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(pu.TYPES.ActionHandlerRegistration).toDynamicValue(n=>({actionKind:e,factory:()=>n.container.get(t)}))}gt.configureActionHandler=PO;function IO(i,e,t){i.bind(pu.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:e,factory:()=>({handle:t})})}gt.onAction=IO});var ch=f(to=>{"use strict";var RO=to&&to.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(to,"__esModule",{value:!0});to.DefaultDiagramLocker=void 0;var MO=_(),ah=class{isAllowed(e){return!0}};ah=RO([(0,MO.injectable)()],ah);to.DefaultDiagramLocker=ah});var uh=f(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.easeInOut=void 0;function OO(i){return i<.5?i*i*2:1-(1-i)*(1-i)*2}gu.easeInOut=OO});var cr=f(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.CompoundAnimation=no.Animation=void 0;var yb=uh(),mu=class{constructor(e,t=yb.easeInOut){this.context=e,this.ease=t}start(){return new Promise((e,t)=>{let n,r=0,o=s=>{r++;let a;n===void 0?(n=s,a=0):a=s-n;let c=Math.min(1,a/this.context.duration),u=this.tween(this.ease(c),this.context);this.context.modelChanged.update(u),c===1?(this.context.logger.log(this,r*1e3/this.context.duration+" fps"),e(u)):this.context.syncer.onNextFrame(o)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(o);else{let s=this.tween(1,this.context);e(s)}})}};no.Animation=mu;var dh=class extends mu{constructor(e,t,n=[],r=yb.easeInOut){super(t,r),this.model=e,this.context=t,this.components=n,this.ease=r}include(e){return this.components.push(e),this}tween(e,t){for(let n of this.components)n.tween(e,t);return this.model}};no.CompoundAnimation=dh});var ge=f(Ze=>{"use strict";var io=Ze&&Ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.ResetCommand=Ze.SystemCommand=Ze.PopupCommand=Ze.HiddenCommand=Ze.MergeableCommand=Ze.Command=void 0;var ro=_(),bi=class{};bi=io([(0,ro.injectable)()],bi);Ze.Command=bi;var lh=class extends bi{merge(e,t){return!1}};lh=io([(0,ro.injectable)()],lh);Ze.MergeableCommand=lh;var fh=class extends bi{undo(e){return e.logger.error(this,"Cannot undo a hidden command"),e.root}redo(e){return e.logger.error(this,"Cannot redo a hidden command"),e.root}};fh=io([(0,ro.injectable)()],fh);Ze.HiddenCommand=fh;var hh=class extends bi{};hh=io([(0,ro.injectable)()],hh);Ze.PopupCommand=hh;var ph=class extends bi{};ph=io([(0,ro.injectable)()],ph);Ze.SystemCommand=ph;var gh=class extends bi{};gh=io([(0,ro.injectable)()],gh);Ze.ResetCommand=gh});var yt=f(mt=>{"use strict";var TO=mt&&mt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},AO=mt&&mt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},_b=mt&&mt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(mt,"__esModule",{value:!0});mt.configureCommand=mt.CommandActionHandlerInitializer=mt.CommandActionHandler=void 0;var yu=_(),CO=ar(),mh=P(),_u=class{constructor(e){this.commandRegistration=e}handle(e){return this.commandRegistration.factory(e)}};mt.CommandActionHandler=_u;var yh=class{constructor(e){this.registrations=e}initialize(e){this.registrations.forEach(t=>e.register(t.kind,new _u(t)))}};yh=TO([(0,yu.injectable)(),_b(0,(0,yu.multiInject)(mh.TYPES.CommandRegistration)),_b(0,(0,yu.optional)()),AO("design:paramtypes",[Array])],yh);mt.CommandActionHandlerInitializer=yh;function xO(i,e){if(!(0,CO.isInjectable)(e))throw new Error(`Commands should be @injectable: ${e.name}`);i.isBound(e)||i.bind(e).toSelf(),i.bind(mh.TYPES.CommandRegistration).toDynamicValue(t=>({kind:e.KIND,factory:n=>{let r=new yu.Container;return r.parent=t.container,r.bind(mh.TYPES.Action).toConstantValue(n),r.get(e)}}))}mt.configureCommand=xO});var vb=f(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.overrideCommandStackOptions=void 0;var DO=_n(),qO=P();function jO(i,e){let t=i.get(qO.TYPES.CommandStackOptions);return(0,DO.safeAssign)(t,e),t}vu.overrideCommandStackOptions=jO});var vh=f(Ei=>{"use strict";var dr=Ei&&Ei.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Si=Ei&&Ei.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.CommandStack=void 0;var lr=_(),zs=P(),_h=Pn(),NO=G(),LO=Zr(),ur=ge(),Xn=class{constructor(){this.undoStack=[],this.redoStack=[],this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(_h.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(_h.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(_h.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(e=>e.main.model)}executeAll(e){return e.forEach(t=>{this.logger.log(this,"Executing",t),this.handleCommand(t,t.execute,this.mergeOrPush)}),this.thenUpdate()}execute(e){return this.logger.log(this,"Executing",e),this.handleCommand(e,e.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();let e=this.undoStack[this.undoStack.length-1];return e!==void 0&&!this.isBlockUndo(e)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();let e=this.redoStack.pop();return e!==void 0&&(this.logger.log(this,"Redoing",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(e,t,n){this.currentPromise=this.currentPromise.then(r=>new Promise(o=>{let s;e instanceof ur.HiddenCommand?s="hidden":e instanceof ur.PopupCommand?s="popup":s="main";let a=this.createContext(r.main.model),c;try{c=t.call(e,a)}catch(d){this.logger.error(this,"Failed to execute command:",d),c=r[s].model}let u=bb(r);c instanceof Promise?c.then(d=>{s==="main"&&n.call(this,e,a),u[s]={model:d,modelChanged:!0},o(u)}):c instanceof NO.SModelRoot?(s==="main"&&n.call(this,e,a),u[s]={model:c,modelChanged:!0},o(u)):(s==="main"&&n.call(this,e,a),u[s]={model:c.model,modelChanged:r[s].modelChanged||c.modelChanged,cause:c.cause},o(u))}))}pushToUndoStack(e){this.undoStack.push(e),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(e=>{let t=bb(e);return e.hidden.modelChanged&&(this.updateHidden(e.hidden.model,e.hidden.cause),t.hidden.modelChanged=!1,t.hidden.cause=void 0),e.main.modelChanged&&(this.update(e.main.model,e.main.cause),t.main.modelChanged=!1,t.main.cause=void 0),e.popup.modelChanged&&(this.updatePopup(e.popup.model,e.popup.cause),t.popup.modelChanged=!1,t.popup.cause=void 0),t}),this.currentModel}update(e,t){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(e,t)}updateHidden(e,t){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(e,t)}updatePopup(e,t){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(e,t)}mergeOrPush(e,t){if(this.isBlockUndo(e)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(e);return}if(this.isPushToOffStack(e)&&this.redoStack.length>0){if(this.offStack.length>0){let n=this.offStack[this.offStack.length-1];if(n instanceof ur.MergeableCommand&&n.merge(e,t))return}this.offStack.push(e);return}if(this.isPushToUndoStack(e)){if(this.offStack.forEach(n=>this.undoStack.push(n)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){let n=this.undoStack[this.undoStack.length-1];if(n instanceof ur.MergeableCommand&&n.merge(e,t))return}this.pushToUndoStack(e)}}undoOffStackSystemCommands(){let e=this.offStack.pop();for(;e!==void 0;)this.logger.log(this,"Undoing off-stack",e),this.handleCommand(e,e.undo,()=>{}),e=this.offStack.pop()}undoPreceedingSystemCommands(){let e=this.undoStack[this.undoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)}),e=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let e=this.redoStack[this.redoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.redoStack.pop(),this.logger.log(this,"Redoing ",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)}),e=this.redoStack[this.redoStack.length-1]}createContext(e){return{root:e,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(e){return e instanceof ur.SystemCommand}isPushToUndoStack(e){return!(e instanceof ur.HiddenCommand)}isBlockUndo(e){return e instanceof ur.ResetCommand}};dr([(0,lr.inject)(zs.TYPES.IModelFactory),Si("design:type",Object)],Xn.prototype,"modelFactory",void 0);dr([(0,lr.inject)(zs.TYPES.IViewerProvider),Si("design:type",Object)],Xn.prototype,"viewerProvider",void 0);dr([(0,lr.inject)(zs.TYPES.ILogger),Si("design:type",Object)],Xn.prototype,"logger",void 0);dr([(0,lr.inject)(zs.TYPES.AnimationFrameSyncer),Si("design:type",LO.AnimationFrameSyncer)],Xn.prototype,"syncer",void 0);dr([(0,lr.inject)(zs.TYPES.CommandStackOptions),Si("design:type",Object)],Xn.prototype,"options",void 0);dr([(0,lr.postConstruct)(),Si("design:type",Function),Si("design:paramtypes",[]),Si("design:returntype",void 0)],Xn.prototype,"initialize",null);Xn=dr([(0,lr.injectable)()],Xn);Ei.CommandStack=Xn;function bb(i){return{main:Object.assign({},i.main),hidden:Object.assign({},i.hidden),popup:Object.assign({},i.popup)}}});var Sb=f(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.ServerActionHandlerRegistry=void 0;var bh=class{constructor(){this.handlers=new Map}getHandler(e){return this.handlers.get(e)}onAction(e,t){this.handlers.has(e)?this.handlers.get(e).push(t):this.handlers.set(e,[t])}removeActionHandler(e,t){let n=this.handlers.get(e);if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}};bu.ServerActionHandlerRegistry=bh});var wi=f(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.SModelIndex=_t.findElement=_t.getSubType=_t.getBasicType=_t.applyBounds=_t.cloneModel=void 0;function BO(i){return JSON.parse(JSON.stringify(i))}_t.cloneModel=BO;function FO(i,e){let t=new Su;t.add(i);for(let n of e.bounds){let r=t.getById(n.elementId);if(r){let o=r;n.newPosition&&(o.position={x:n.newPosition.x,y:n.newPosition.y}),n.newSize&&(o.size={width:n.newSize.width,height:n.newSize.height})}}if(e.alignments)for(let n of e.alignments){let r=t.getById(n.elementId);if(r){let o=r;o.alignment={x:n.newAlignment.x,y:n.newAlignment.y}}}}_t.applyBounds=FO;function VO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}_t.getBasicType=VO;function KO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}_t.getSubType=KO;function Eb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Eb(t,e);if(n!==void 0)return n}}_t.findElement=Eb;var Su=class{constructor(){this.id2element=new Map,this.id2parent=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(e.id,e),Array.isArray(e.children))for(let t of e.children)this.add(t),this.id2parent.set(t.id,e)}remove(e){if(this.id2element.delete(e.id),Array.isArray(e.children))for(let t of e.children)this.id2parent.delete(t.id),this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getParent(e){return this.id2parent.get(e)}getRoot(e){let t=e;for(;t;){let n=this.id2parent.get(t.id);if(n===void 0)return t;t=n}throw new Error("Element has no root")}};_t.SModelIndex=Su});var wb=f(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.DiagramServer=void 0;var HO=Sb(),vt=te(),zO=eu(),Sh=wi(),Eh=class{constructor(e,t){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=e,this.diagramGenerator=t.DiagramGenerator,this.layoutEngine=t.ModelLayoutEngine,this.actionHandlerRegistry=t.ServerActionHandlerRegistry}onAction(e,t){this.actionHandlerRegistry||(this.actionHandlerRegistry=new HO.ServerActionHandlerRegistry),this.actionHandlerRegistry.onAction(e,t)}removeActionHandler(e,t){this.actionHandlerRegistry&&this.actionHandlerRegistry.removeActionHandler(e,t)}setModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!1)}updateModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(e){if((0,vt.isResponseAction)(e)){let t=e.responseId,n=this.requests.get(t);if(n){if(this.requests.delete(t),e.kind===vt.RejectAction.KIND){let r=e;n.reject(new Error(r.message)),console.warn(`Request with id ${e.responseId} failed: ${r.message}`,r.detail)}else n.resolve(e);return Promise.resolve()}console.info("No matching request for response:",e)}return this.handleAction(e)}request(e){e.requestId||(e.requestId="server_"+(0,vt.generateRequestId)());let t=new zO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(n=>{this.requests.delete(e.requestId),t.reject(n)}),t.promise}rejectRemoteRequest(e,t){e&&(0,vt.isRequestAction)(e)&&this.dispatch({kind:vt.RejectAction.KIND,responseId:e.requestId,message:t.message,detail:t.stack})}handleAction(e){var t;let n=(t=this.actionHandlerRegistry)===null||t===void 0?void 0:t.getHandler(e.kind);if(n&&n.length===1)return n[0](e,this.state,this);if(n&&n.length>1)return Promise.all(n.map(r=>r(e,this.state,this)));switch(e.kind){case vt.RequestModelAction.KIND:return this.handleRequestModel(e);case vt.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case vt.LayoutAction.KIND:return this.handleLayout(e)}return console.warn(`Unhandled action from client: ${e.kind}`),Promise.resolve()}async handleRequestModel(e){var t;this.state.options=e.options;try{let n=await this.diagramGenerator.generate({options:(t=this.state.options)!==null&&t!==void 0?t:{},state:this.state});n.revision=++this.state.revision,this.state.currentRoot=n,await this.submitModel(this.state.currentRoot,!1,e)}catch(n){this.rejectRemoteRequest(e,n),console.error("Failed to generate diagram:",n)}}async submitModel(e,t,n){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:vt.RequestBoundsAction.KIND,newRoot:e});else{let r=vt.RequestBoundsAction.create(e),o=await this.request(r),s=this.state.currentRoot;o.revision===s.revision?((0,Sh.applyBounds)(s,o),await this.doSubmitModel(s,t,n)):this.rejectRemoteRequest(n,new Error(`Model revision does not match: ${o.revision}`))}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n){if(e.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(e=await this.layoutEngine.layout(e));let r=e.type;if(n&&n.kind===vt.RequestModelAction.KIND){let o=n.requestId,s=vt.SetModelAction.create(e,o);await this.dispatch(s)}else t&&r===this.state.lastSubmittedModelType?await this.dispatch({kind:vt.UpdateModelAction.KIND,newRoot:e,cause:n}):await this.dispatch({kind:vt.SetModelAction.KIND,newRoot:e});this.state.lastSubmittedModelType=r}handleComputedBounds(e){return e.revision!==this.state.currentRoot.revision?Promise.reject():((0,Sh.applyBounds)(this.state.currentRoot,e),Promise.resolve())}async handleLayout(e){if(this.layoutEngine){if(!this.needsServerLayout){let t=(0,Sh.cloneModel)(this.state.currentRoot);t=await this.layoutEngine.layout(t),t.revision=++this.state.revision,this.state.currentRoot=t}await this.doSubmitModel(this.state.currentRoot,!0,e)}}};Eu.DiagramServer=Eh});var Ib=f(Pb=>{"use strict";Object.defineProperty(Pb,"__esModule",{value:!0})});var Mb=f(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.isZoomable=oo.isScrollable=void 0;var Rb=_n();function YO(i){return(0,Rb.hasOwnProperty)(i,"scroll")}oo.isScrollable=YO;function kO(i){return(0,Rb.hasOwnProperty)(i,"zoom")}oo.isZoomable=kO});var Tb=f(Ob=>{"use strict";Object.defineProperty(Ob,"__esModule",{value:!0})});var fr=f(ct=>{"use strict";var UO=ct&&ct.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Jn=ct&&ct.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&UO(e,i,t)};Object.defineProperty(ct,"__esModule",{value:!0});Jn(te(),ct);Jn(wb(),ct);Jn(Ib(),ct);Jn(Mb(),ct);Jn(eu(),ct);Jn(Q(),ct);Jn(Tb(),ct);Jn(wi(),ct);Jn(_n(),ct)});var In=f(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.hitsMouseEvent=zt.getWindowScroll=zt.isCrossSite=zt.isMac=zt.isCtrlOrCmd=void 0;var GO=fr();function WO(i){return Ab()?i.metaKey:i.ctrlKey}zt.isCtrlOrCmd=WO;function Ab(){return window.navigator.userAgent.indexOf("Mac")!==-1}zt.isMac=Ab;function $O(i){if(i&&typeof window<"u"&&window.location){let e="";return window.location.protocol&&(e+=window.location.protocol+"//"),window.location.host&&(e+=window.location.host),e.length>0&&!i.startsWith(e)}return!1}zt.isCrossSite=$O;function XO(){return typeof window>"u"?GO.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}zt.getWindowScroll=XO;function JO(i,e){let t=i.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}zt.hitsMouseEvent=JO});var ks=f(ut=>{"use strict";var wh=ut&&ut.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Cb=ut&&ut.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ZO=ut&&ut.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ut,"__esModule",{value:!0});ut.InitializeCanvasBoundsCommand=ut.InitializeCanvasBoundsAction=ut.CanvasBoundsInitializer=void 0;var wu=_(),Ys=Q(),xb=P(),QO=G(),eT=ge(),tT=In(),Pu=class{decorate(e,t){return t instanceof QO.SModelRoot&&!Ys.Dimension.isValid(t.canvasBounds)&&(this.rootAndVnode=[t,e]),e}postUpdate(){if(this.rootAndVnode!==void 0){let e=this.rootAndVnode[1].elm,t=this.rootAndVnode[0].canvasBounds;if(e!==void 0){let n=this.getBoundsInPage(e);(0,Ys.almostEquals)(n.x,t.x)&&(0,Ys.almostEquals)(n.y,t.y)&&(0,Ys.almostEquals)(n.width,t.width)&&(0,Ys.almostEquals)(n.height,t.width)||this.actionDispatcher.dispatch(Ph.create(n))}this.rootAndVnode=void 0}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,tT.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};wh([(0,wu.inject)(xb.TYPES.IActionDispatcher),Cb("design:type",Object)],Pu.prototype,"actionDispatcher",void 0);Pu=wh([(0,wu.injectable)()],Pu);ut.CanvasBoundsInitializer=Pu;var Ph;(function(i){i.KIND="initializeCanvasBounds";function e(t){return{kind:i.KIND,newCanvasBounds:t}}i.create=e})(Ph=ut.InitializeCanvasBoundsAction||(ut.InitializeCanvasBoundsAction={}));var Iu=class extends eT.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newCanvasBounds=this.action.newCanvasBounds,e.root.canvasBounds=this.newCanvasBounds,e.root}undo(e){return e.root}redo(e){return e.root}};Iu.KIND=Ph.KIND;Iu=wh([(0,wu.injectable)(),ZO(0,(0,wu.inject)(xb.TYPES.Action)),Cb("design:paramtypes",[Object])],Iu);ut.InitializeCanvasBoundsCommand=Iu});var Mu=f(bt=>{"use strict";var nT=bt&&bt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},iT=bt&&bt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},rT=bt&&bt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(bt,"__esModule",{value:!0});bt.SetModelCommand=bt.SetModelAction=bt.RequestModelAction=void 0;var Db=_(),qb=te(),oT=ge(),sT=P(),aT=ks(),hr=class{constructor(e,t=""){this.options=e,this.requestId=t,this.kind=hr.KIND}static create(e){return new hr(e,(0,qb.generateRequestId)())}};bt.RequestModelAction=hr;hr.KIND="requestModel";var so=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=so.KIND}};bt.SetModelAction=so;so.KIND="setModel";var Ru=class extends oT.ResetCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.modelFactory.createRoot(e.root),this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}get blockUntil(){return e=>e.kind===aT.InitializeCanvasBoundsCommand.KIND}};Ru.KIND=qb.SetModelAction.KIND;Ru=nT([(0,Db.injectable)(),rT(0,(0,Db.inject)(sT.TYPES.Action)),iT("design:paramtypes",[Object])],Ru);bt.SetModelCommand=Ru});var Nb=f(jb=>{"use strict";Object.defineProperty(jb,"__esModule",{value:!0})});var He=f(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.transformToRootBounds=be.containsSome=be.translateBounds=be.translatePoint=be.findParentByFeature=be.findParent=be.findElement=be.getSubType=be.getBasicType=be.registerModelElement=void 0;var cT=P(),Us=G();function uT(i,e,t,n){i.bind(cT.TYPES.SModelElementRegistration).toConstantValue({type:e,constr:t,features:n})}be.registerModelElement=uT;function dT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}be.getBasicType=dT;function lT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}be.getSubType=lT;function Lb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Lb(t,e);if(n!==void 0)return n}}be.findElement=Lb;function fT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Us.SChildElement?t=t.parent:t=void 0}return t}be.findParent=fT;function hT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Us.SChildElement?t=t.parent:t=void 0}return t}be.findParentByFeature=hT;function Ih(i,e,t){if(e!==t){for(;e instanceof Us.SChildElement;)if(i=e.localToParent(i),e=e.parent,e===t)return i;let n=[];for(;t instanceof Us.SChildElement;)n.push(t),t=t.parent;if(e!==t)throw new Error("Incompatible source and target: "+e.id+", "+t.id);for(let r=n.length-1;r>=0;r--)i=n[r].parentToLocal(i)}return i}be.translatePoint=Ih;function pT(i,e,t){let n=Ih(i,e,t),r=Ih({x:i.x+i.width,y:i.y+i.height},e,t);return{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y}}be.translateBounds=pT;function gT(i,e){let t=r=>i.index.getById(r.id)!==void 0,n=r=>r.some(o=>t(o)||n(o.children));return n([e])}be.containsSome=gT;function mT(i,e){for(;i instanceof Us.SChildElement;)e=i.localToParent(e),i=i.parent;return e}be.transformToRootBounds=mT});var Ou=f(Pi=>{"use strict";Object.defineProperty(Pi,"__esModule",{value:!0});Pi.EnableDefaultToolsAction=Pi.EnableToolsAction=void 0;var yT;(function(i){i.KIND="enable-tools";function e(t){return{kind:i.KIND,toolIds:t}}i.create=e})(yT=Pi.EnableToolsAction||(Pi.EnableToolsAction={}));var _T;(function(i){i.KIND="enable-default-tools";function e(){return{kind:i.KIND}}i.create=e})(_T=Pi.EnableDefaultToolsAction||(Pi.EnableDefaultToolsAction={}))});var Le=f(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.getAttrs=Ne.on=Ne.mergeStyle=Ne.copyClassesFromElement=Ne.copyClassesFromVNode=Ne.setNamespace=Ne.setClass=Ne.setAttr=void 0;function vT(i,e,t){Fb(i)[e]=t}Ne.setAttr=vT;function Rh(i,e,t){Vb(i)[e]=t}Ne.setClass=Rh;function Bb(i,e){i.data===void 0&&(i.data={}),i.data.ns=e;let t=i.children;if(t!==void 0)for(let n=0;n<t.length;n++){let r=t[n];typeof r!="string"&&Bb(r,e)}}Ne.setNamespace=Bb;function bT(i,e){let t=Vb(i);Object.keys(t).forEach(n=>Rh(e,n,!0))}Ne.copyClassesFromVNode=bT;function ST(i,e){let t=i.classList;for(let n=0;n<t.length;n++){let r=t.item(n);r&&Rh(e,r,!0)}}Ne.copyClassesFromElement=ST;function ET(i,e){Gs(i).style=Object.assign(Object.assign({},Gs(i).style||{}),e)}Ne.mergeStyle=ET;function wT(i,e,t){let n=PT(i);if(n[e])throw new Error("EventListener for "+e+" already registered on VNode");n[e]=t}Ne.on=wT;function Fb(i){let e=Gs(i);return e.attrs||(e.attrs={}),e.attrs}Ne.getAttrs=Fb;function Gs(i){return i.data||(i.data={}),i.data}function Vb(i){let e=Gs(i);return e.class||(e.class={}),e.class}function PT(i){let e=Gs(i);return e.on||(e.on={}),e.on}});var an=f(Yt=>{"use strict";var Th=Yt&&Yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Hb=Yt&&Yt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Kb=Yt&&Yt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.KeyListener=Yt.KeyTool=void 0;var Ws=_(),zb=P(),IT=G(),Mh=Le(),Tu=class{constructor(e=[]){this.keyListeners=e}register(e){this.keyListeners.push(e)}deregister(e){let t=this.keyListeners.indexOf(e);t>=0&&this.keyListeners.splice(t,1)}handleEvent(e,t,n){let r=this.keyListeners.map(o=>o[e].apply(o,[t,n])).reduce((o,s)=>o.concat(s));r.length>0&&(n.preventDefault(),this.actionDispatcher.dispatchAll(r))}keyDown(e,t){this.handleEvent("keyDown",e,t)}keyUp(e,t){this.handleEvent("keyUp",e,t)}focus(){}decorate(e,t){return t instanceof IT.SModelRoot&&((0,Mh.on)(e,"focus",this.focus.bind(this,t)),(0,Mh.on)(e,"keydown",this.keyDown.bind(this,t)),(0,Mh.on)(e,"keyup",this.keyUp.bind(this,t))),e}postUpdate(){}};Th([(0,Ws.inject)(zb.TYPES.IActionDispatcher),Hb("design:type",Object)],Tu.prototype,"actionDispatcher",void 0);Tu=Th([(0,Ws.injectable)(),Kb(0,(0,Ws.multiInject)(zb.TYPES.KeyListener)),Kb(0,(0,Ws.optional)()),Hb("design:paramtypes",[Array])],Tu);Yt.KeyTool=Tu;var Oh=class{keyDown(e,t){return[]}keyUp(e,t){return[]}};Oh=Th([(0,Ws.injectable)()],Oh);Yt.KeyListener=Oh});var Rn=f(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.getActualCode=ao.matchesKeystroke=void 0;var RT=In();function MT(i,e,...t){if(Yb(i)!==e)return!1;if((0,RT.isMac)()){if(i.ctrlKey!==t.findIndex(n=>n==="ctrl")>=0||i.metaKey!==t.findIndex(n=>n==="meta"||n==="ctrlCmd")>=0)return!1}else if(i.ctrlKey!==t.findIndex(n=>n==="ctrl"||n==="ctrlCmd")>=0||i.metaKey!==t.findIndex(n=>n==="meta")>=0)return!1;return!(i.altKey!==t.findIndex(n=>n==="alt")>=0||i.shiftKey!==t.findIndex(n=>n==="shift")>=0)}ao.matchesKeystroke=MT;function Yb(i){if(i.keyCode){let e=Ah[i.keyCode];if(e!==void 0)return e}return i.code}ao.getActualCode=Yb;var Ah=new Array(256);(()=>{function i(e,t){Ah[t]===void 0&&(Ah[t]=e)}i("Pause",3),i("Backspace",8),i("Tab",9),i("Enter",13),i("ShiftLeft",16),i("ShiftRight",16),i("ControlLeft",17),i("ControlRight",17),i("AltLeft",18),i("AltRight",18),i("CapsLock",20),i("Escape",27),i("Space",32),i("PageUp",33),i("PageDown",34),i("End",35),i("Home",36),i("ArrowLeft",37),i("ArrowUp",38),i("ArrowRight",39),i("ArrowDown",40),i("Insert",45),i("Delete",46),i("Digit1",49),i("Digit2",50),i("Digit3",51),i("Digit4",52),i("Digit5",53),i("Digit6",54),i("Digit7",55),i("Digit8",56),i("Digit9",57),i("Digit0",48),i("KeyA",65),i("KeyB",66),i("KeyC",67),i("KeyD",68),i("KeyE",69),i("KeyF",70),i("KeyG",71),i("KeyH",72),i("KeyI",73),i("KeyJ",74),i("KeyK",75),i("KeyL",76),i("KeyM",77),i("KeyN",78),i("KeyO",79),i("KeyP",80),i("KeyQ",81),i("KeyR",82),i("KeyS",83),i("KeyT",84),i("KeyU",85),i("KeyV",86),i("KeyW",87),i("KeyX",88),i("KeyY",89),i("KeyZ",90),i("OSLeft",91),i("MetaLeft",91),i("OSRight",92),i("MetaRight",92),i("ContextMenu",93),i("Numpad0",96),i("Numpad1",97),i("Numpad2",98),i("Numpad3",99),i("Numpad4",100),i("Numpad5",101),i("Numpad6",102),i("Numpad7",103),i("Numpad8",104),i("Numpad9",105),i("NumpadMultiply",106),i("NumpadAdd",107),i("NumpadSeparator",108),i("NumpadSubtract",109),i("NumpadDecimal",110),i("NumpadDivide",111),i("F1",112),i("F2",113),i("F3",114),i("F4",115),i("F5",116),i("F6",117),i("F7",118),i("F8",119),i("F9",120),i("F10",121),i("F11",122),i("F12",123),i("F13",124),i("F14",125),i("F15",126),i("F16",127),i("F17",128),i("F18",129),i("F19",130),i("F20",131),i("F21",132),i("F22",133),i("F23",134),i("F24",135),i("NumLock",144),i("ScrollLock",145),i("Semicolon",186),i("Equal",187),i("Comma",188),i("Minus",189),i("Period",190),i("Slash",191),i("Backquote",192),i("IntlRo",193),i("BracketLeft",219),i("Backslash",220),i("BracketRight",221),i("Quote",222),i("IntlYen",255)})()});var qh=f(kt=>{"use strict";var Cu=kt&&kt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},OT=kt&&kt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(kt,"__esModule",{value:!0});kt.DefaultToolsEnablingKeyListener=kt.ToolManagerActionHandler=kt.ToolManager=void 0;var xu=_(),TT=P(),Ch=Ou(),AT=an(),CT=Rn(),xh=class{constructor(){this.tools=[],this.defaultTools=[],this.actives=[]}get managedTools(){return this.defaultTools.concat(this.tools)}get activeTools(){return this.actives}disableActiveTools(){this.actives.forEach(e=>e.disable()),this.actives.splice(0,this.actives.length)}enableDefaultTools(){this.enable(this.defaultTools.map(e=>e.id))}enable(e){this.disableActiveTools(),e.map(n=>this.tool(n)).forEach(n=>{n!==void 0&&(n.enable(),this.actives.push(n))})}tool(e){return this.managedTools.find(t=>t.id===e)}registerDefaultTools(...e){for(let t of e)this.defaultTools.push(t)}registerTools(...e){for(let t of e)this.tools.push(t)}};xh=Cu([(0,xu.injectable)()],xh);kt.ToolManager=xh;var Au=class{handle(e){switch(e.kind){case Ch.EnableDefaultToolsAction.KIND:this.toolManager.enableDefaultTools();break;case Ch.EnableToolsAction.KIND:this.toolManager.enable(e.toolIds);break}}};Cu([(0,xu.inject)(TT.TYPES.IToolManager),OT("design:type",Object)],Au.prototype,"toolManager",void 0);Au=Cu([(0,xu.injectable)()],Au);kt.ToolManagerActionHandler=Au;var Dh=class extends AT.KeyListener{keyDown(e,t){return(0,CT.matchesKeystroke)(t,"Escape")?[Ch.EnableDefaultToolsAction.create()]:[]}};Dh=Cu([(0,xu.injectable)()],Dh);kt.DefaultToolsEnablingKeyListener=Dh});var Xs=f(dt=>{"use strict";var Nh=dt&&dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Lh=dt&&dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},jh=dt&&dt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(dt,"__esModule",{value:!0});dt.SetUIExtensionVisibilityCommand=dt.SetUIExtensionVisibilityAction=dt.UIExtensionRegistry=void 0;var co=_(),xT=wn(),DT=ge(),Bh=P(),Du=class extends xT.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>this.register(t.id(),t))}};Du=Nh([(0,co.injectable)(),jh(0,(0,co.multiInject)(Bh.TYPES.IUIExtension)),jh(0,(0,co.optional)()),Lh("design:paramtypes",[Array])],Du);dt.UIExtensionRegistry=Du;var kb;(function(i){i.KIND="setUIExtensionVisibility";function e(t){var n;return{kind:i.KIND,extensionId:t.extensionId,visible:t.visible,contextElementsId:(n=t.contextElementsId)!==null&&n!==void 0?n:[]}}i.create=e})(kb=dt.SetUIExtensionVisibilityAction||(dt.SetUIExtensionVisibilityAction={}));var $s=class extends DT.SystemCommand{constructor(e){super(),this.action=e}execute(e){let t=this.registry.get(this.action.extensionId);return t&&(this.action.visible?t.show(e.root,...this.action.contextElementsId):t.hide()),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};$s.KIND=kb.KIND;Nh([(0,co.inject)(Bh.TYPES.UIExtensionRegistry),Lh("design:type",Du)],$s.prototype,"registry",void 0);$s=Nh([(0,co.injectable)(),jh(0,(0,co.inject)(Bh.TYPES.Action)),Lh("design:paramtypes",[Object])],$s);dt.SetUIExtensionVisibilityCommand=$s});var qu=f(Ii=>{"use strict";var Fh=Ii&&Ii.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ub=Ii&&Ii.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.AbstractUIExtension=void 0;var Vh=_(),Gb=P(),Js=class{show(e,...t){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,e,...t),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){let e=this.activeElement;e&&e.focus()}initialize(){let e=document.getElementById(this.options.baseDiv);return e?(this.containerElement=this.getOrCreateContainer(e.id),this.initializeContents(this.containerElement),e&&e.insertBefore(this.containerElement,e.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(e){let t=document.getElementById(this.id());return t===null&&(t=document.createElement("div"),t.id=e+"_"+this.id(),t.classList.add(this.containerClass())),t}setContainerVisible(e){this.containerElement&&(e?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(e,t,...n){}};Fh([(0,Vh.inject)(Gb.TYPES.ViewerOptions),Ub("design:type",Object)],Js.prototype,"options",void 0);Fh([(0,Vh.inject)(Gb.TYPES.ILogger),Ub("design:type",Object)],Js.prototype,"logger",void 0);Js=Fh([(0,Vh.injectable)()],Js);Ii.AbstractUIExtension=Js});var uo=f(Ri=>{"use strict";var Wb=Ri&&Ri.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},qT=Ri&&Ri.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.DOMHelper=void 0;var $b=_(),jT=P(),ju=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(e){return this.getPrefix()+e.id}findSModelIdByDOMElement(e){return e.id.replace(this.getPrefix(),"")}};Wb([(0,$b.inject)(jT.TYPES.ViewerOptions),qT("design:type",Object)],ju.prototype,"viewerOptions",void 0);ju=Wb([(0,$b.injectable)()],ju);Ri.DOMHelper=ju});var Tt=f(Qe=>{"use strict";var fo=Qe&&Qe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Bu=Qe&&Qe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Nu=Qe&&Qe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.MousePositionTracker=Qe.MouseListener=Qe.PopupMouseTool=Qe.MouseTool=void 0;var Mn=_(),NT=te(),LT=G(),Fu=P(),BT=uo(),Ut=Le(),lo=class{constructor(e=[]){this.mouseListeners=e}register(e){this.mouseListeners.push(e)}deregister(e){let t=this.mouseListeners.indexOf(e);t>=0&&this.mouseListeners.splice(t,1)}getTargetElement(e,t){let n=t.target,r=e.index;for(;n;){if(n.id){let o=r.getById(this.domHelper.findSModelIdByDOMElement(n));if(o!==void 0)return o}n=n.parentNode}}handleEvent(e,t,n){this.focusOnMouseEvent(e,t);let r=this.getTargetElement(t,n);if(!r)return;let o=this.mouseListeners.map(s=>s[e](r,n)).reduce((s,a)=>s.concat(a));if(o.length>0){n.preventDefault();for(let s of o)(0,NT.isAction)(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}focusOnMouseEvent(e,t){if(document&&e==="mouseDown"){let n=document.getElementById(this.domHelper.createUniqueDOMElementId(t));n!==null&&typeof n.focus=="function"&&n.focus()}}mouseOver(e,t){this.handleEvent("mouseOver",e,t)}mouseOut(e,t){this.handleEvent("mouseOut",e,t)}mouseEnter(e,t){this.handleEvent("mouseEnter",e,t)}mouseLeave(e,t){this.handleEvent("mouseLeave",e,t)}mouseDown(e,t){this.handleEvent("mouseDown",e,t)}mouseMove(e,t){this.handleEvent("mouseMove",e,t)}mouseUp(e,t){this.handleEvent("mouseUp",e,t)}wheel(e,t){this.handleEvent("wheel",e,t)}contextMenu(e,t){t.preventDefault(),this.handleEvent("contextMenu",e,t)}doubleClick(e,t){this.handleEvent("doubleClick",e,t)}decorate(e,t){return t instanceof LT.SModelRoot&&((0,Ut.on)(e,"mouseover",this.mouseOver.bind(this,t)),(0,Ut.on)(e,"mouseout",this.mouseOut.bind(this,t)),(0,Ut.on)(e,"mouseenter",this.mouseEnter.bind(this,t)),(0,Ut.on)(e,"mouseleave",this.mouseLeave.bind(this,t)),(0,Ut.on)(e,"mousedown",this.mouseDown.bind(this,t)),(0,Ut.on)(e,"mouseup",this.mouseUp.bind(this,t)),(0,Ut.on)(e,"mousemove",this.mouseMove.bind(this,t)),(0,Ut.on)(e,"wheel",this.wheel.bind(this,t)),(0,Ut.on)(e,"contextmenu",this.contextMenu.bind(this,t)),(0,Ut.on)(e,"dblclick",this.doubleClick.bind(this,t)),(0,Ut.on)(e,"dragover",n=>this.handleEvent("dragOver",t,n)),(0,Ut.on)(e,"drop",n=>this.handleEvent("drop",t,n))),e=this.mouseListeners.reduce((n,r)=>r.decorate(n,t),e),e}postUpdate(){}};fo([(0,Mn.inject)(Fu.TYPES.IActionDispatcher),Bu("design:type",Object)],lo.prototype,"actionDispatcher",void 0);fo([(0,Mn.inject)(Fu.TYPES.DOMHelper),Bu("design:type",BT.DOMHelper)],lo.prototype,"domHelper",void 0);lo=fo([(0,Mn.injectable)(),Nu(0,(0,Mn.multiInject)(Fu.TYPES.MouseListener)),Nu(0,(0,Mn.optional)()),Bu("design:paramtypes",[Array])],lo);Qe.MouseTool=lo;var Kh=class extends lo{constructor(e=[]){super(e),this.mouseListeners=e}};Kh=fo([(0,Mn.injectable)(),Nu(0,(0,Mn.multiInject)(Fu.TYPES.PopupMouseListener)),Nu(0,(0,Mn.optional)()),Bu("design:paramtypes",[Array])],Kh);Qe.PopupMouseTool=Kh;var Lu=class{mouseOver(e,t){return[]}mouseOut(e,t){return[]}mouseEnter(e,t){return[]}mouseLeave(e,t){return[]}mouseDown(e,t){return[]}mouseMove(e,t){return[]}mouseUp(e,t){return[]}wheel(e,t){return[]}doubleClick(e,t){return[]}contextMenu(e,t){return[]}dragOver(e,t){return[]}drop(e,t){return[]}decorate(e,t){return e}};Lu=fo([(0,Mn.injectable)()],Lu);Qe.MouseListener=Lu;var Hh=class extends Lu{mouseMove(e,t){return this.lastPosition=e.root.parentToLocal({x:t.offsetX,y:t.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};Hh=fo([(0,Mn.injectable)()],Hh);Qe.MousePositionTracker=Hh});var ho=f(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});function FT(i,e){return document.createElement(i,e)}function VT(i,e,t){return document.createElementNS(i,e,t)}function KT(){return pr(document.createDocumentFragment())}function HT(i){return document.createTextNode(i)}function zT(i){return document.createComment(i)}function YT(i,e,t){if(Zn(i)){let n=i;for(;n&&Zn(n);)n=pr(n).parent;i=n??i}Zn(e)&&(e=pr(e,i)),t&&Zn(t)&&(t=pr(t).firstChildNode),i.insertBefore(e,t)}function kT(i,e){i.removeChild(e)}function UT(i,e){Zn(e)&&(e=pr(e,i)),i.appendChild(e)}function rS(i){if(Zn(i)){for(;i&&Zn(i);)i=pr(i).parent;return i??null}return i.parentNode}function GT(i){var e;if(Zn(i)){let t=pr(i),n=rS(t);if(n&&t.lastChildNode){let r=Array.from(n.childNodes),o=r.indexOf(t.lastChildNode);return(e=r[o+1])!==null&&e!==void 0?e:null}return null}return i.nextSibling}function WT(i){return i.tagName}function $T(i,e){i.textContent=e}function XT(i){return i.textContent}function JT(i){return i.nodeType===1}function ZT(i){return i.nodeType===3}function QT(i){return i.nodeType===8}function Zn(i){return i.nodeType===11}function pr(i,e){var t,n,r;let o=i;return(t=o.parent)!==null&&t!==void 0||(o.parent=e??null),(n=o.firstChildNode)!==null&&n!==void 0||(o.firstChildNode=i.firstChild),(r=o.lastChildNode)!==null&&r!==void 0||(o.lastChildNode=i.lastChild),o}var Wh={createElement:FT,createElementNS:VT,createTextNode:HT,createDocumentFragment:KT,createComment:zT,insertBefore:YT,removeChild:kT,appendChild:UT,parentNode:rS,nextSibling:GT,tagName:WT,setTextContent:$T,getTextContent:XT,isElement:JT,isText:ZT,isComment:QT,isDocumentFragment:Zn};function lt(i,e,t,n,r){let o=e===void 0?void 0:e.key;return{sel:i,data:e,children:t,text:n,elm:r,key:o}}var Qs=Array.isArray;function gr(i){return typeof i=="string"||typeof i=="number"||i instanceof String||i instanceof Number}function zh(i){return i===void 0}function St(i){return i!==void 0}var Yh=lt("",{},[],void 0,void 0);function Zs(i,e){var t,n;let r=i.key===e.key,o=((t=i.data)===null||t===void 0?void 0:t.is)===((n=e.data)===null||n===void 0?void 0:n.is),s=i.sel===e.sel,a=!i.sel&&i.sel===e.sel?typeof i.text==typeof e.text:!0;return s&&r&&o&&a}function eA(){throw new Error("The document fragment is not supported on this platform.")}function tA(i,e){return i.isElement(e)}function nA(i,e){return i.isDocumentFragment(e)}function iA(i,e,t){var n;let r={};for(let o=e;o<=t;++o){let s=(n=i[o])===null||n===void 0?void 0:n.key;s!==void 0&&(r[s]=o)}return r}var rA=["create","update","remove","destroy","pre","post"];function oA(i,e,t){let n={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:Wh;for(let v of rA)for(let m of i){let O=m[v];O!==void 0&&n[v].push(O)}function o(v){let m=v.id?"#"+v.id:"",O=v.getAttribute("class"),C=O?"."+O.split(" ").join("."):"";return lt(r.tagName(v).toLowerCase()+m+C,{},[],void 0,v)}function s(v){return lt(void 0,{},[],void 0,v)}function a(v,m){return function(){if(--m===0){let C=r.parentNode(v);r.removeChild(C,v)}}}function c(v,m){var O,C,K,U;let q,F=v.data;if(F!==void 0){let z=(O=F.hook)===null||O===void 0?void 0:O.init;St(z)&&(z(v),F=v.data)}let H=v.children,W=v.sel;if(W==="!")zh(v.text)&&(v.text=""),v.elm=r.createComment(v.text);else if(W!==void 0){let z=W.indexOf("#"),se=W.indexOf(".",z),Pe=z>0?z:W.length,fe=se>0?se:W.length,ve=z!==-1||se!==-1?W.slice(0,Math.min(Pe,fe)):W,Ge=v.elm=St(F)&&St(q=F.ns)?r.createElementNS(q,ve,F):r.createElement(ve,F);for(Pe<fe&&Ge.setAttribute("id",W.slice(Pe+1,fe)),se>0&&Ge.setAttribute("class",W.slice(fe+1).replace(/\./g," ")),q=0;q<n.create.length;++q)n.create[q](Yh,v);if(Qs(H))for(q=0;q<H.length;++q){let di=H[q];di!=null&&r.appendChild(Ge,c(di,m))}else gr(v.text)&&r.appendChild(Ge,r.createTextNode(v.text));let yn=v.data.hook;St(yn)&&((C=yn.create)===null||C===void 0||C.call(yn,Yh,v),yn.insert&&m.push(v))}else if(!((K=t?.experimental)===null||K===void 0)&&K.fragments&&v.children){for(v.elm=((U=r.createDocumentFragment)!==null&&U!==void 0?U:eA)(),q=0;q<n.create.length;++q)n.create[q](Yh,v);for(q=0;q<v.children.length;++q){let z=v.children[q];z!=null&&r.appendChild(v.elm,c(z,m))}}else v.elm=r.createTextNode(v.text);return v.elm}function u(v,m,O,C,K,U){for(;C<=K;++C){let q=O[C];q!=null&&r.insertBefore(v,c(q,U),m)}}function d(v){var m,O;let C=v.data;if(C!==void 0){(O=(m=C?.hook)===null||m===void 0?void 0:m.destroy)===null||O===void 0||O.call(m,v);for(let K=0;K<n.destroy.length;++K)n.destroy[K](v);if(v.children!==void 0)for(let K=0;K<v.children.length;++K){let U=v.children[K];U!=null&&typeof U!="string"&&d(U)}}}function l(v,m,O,C){for(var K,U;O<=C;++O){let q,F,H=m[O];if(H!=null)if(St(H.sel)){d(H),q=n.remove.length+1,F=a(H.elm,q);for(let z=0;z<n.remove.length;++z)n.remove[z](H,F);let W=(U=(K=H?.data)===null||K===void 0?void 0:K.hook)===null||U===void 0?void 0:U.remove;St(W)?W(H,F):F()}else H.children?(d(H),l(v,H.children,0,H.children.length-1)):r.removeChild(v,H.elm)}}function S(v,m,O,C){let K=0,U=0,q=m.length-1,F=m[0],H=m[q],W=O.length-1,z=O[0],se=O[W],Pe,fe,ve,Ge;for(;K<=q&&U<=W;)F==null?F=m[++K]:H==null?H=m[--q]:z==null?z=O[++U]:se==null?se=O[--W]:Zs(F,z)?(R(F,z,C),F=m[++K],z=O[++U]):Zs(H,se)?(R(H,se,C),H=m[--q],se=O[--W]):Zs(F,se)?(R(F,se,C),r.insertBefore(v,F.elm,r.nextSibling(H.elm)),F=m[++K],se=O[--W]):Zs(H,z)?(R(H,z,C),r.insertBefore(v,H.elm,F.elm),H=m[--q],z=O[++U]):(Pe===void 0&&(Pe=iA(m,K,q)),fe=Pe[z.key],zh(fe)?r.insertBefore(v,c(z,C),F.elm):(ve=m[fe],ve.sel!==z.sel?r.insertBefore(v,c(z,C),F.elm):(R(ve,z,C),m[fe]=void 0,r.insertBefore(v,ve.elm,F.elm))),z=O[++U]);U<=W&&(Ge=O[W+1]==null?null:O[W+1].elm,u(v,Ge,O,U,W,C)),K<=q&&l(v,m,K,q)}function R(v,m,O){var C,K,U,q,F,H,W,z;let se=(C=m.data)===null||C===void 0?void 0:C.hook;(K=se?.prepatch)===null||K===void 0||K.call(se,v,m);let Pe=m.elm=v.elm;if(v===m)return;if(m.data!==void 0||St(m.text)&&m.text!==v.text){(U=m.data)!==null&&U!==void 0||(m.data={}),(q=v.data)!==null&&q!==void 0||(v.data={});for(let Ge=0;Ge<n.update.length;++Ge)n.update[Ge](v,m);(W=(H=(F=m.data)===null||F===void 0?void 0:F.hook)===null||H===void 0?void 0:H.update)===null||W===void 0||W.call(H,v,m)}let fe=v.children,ve=m.children;zh(m.text)?St(fe)&&St(ve)?fe!==ve&&S(Pe,fe,ve,O):St(ve)?(St(v.text)&&r.setTextContent(Pe,""),u(Pe,null,ve,0,ve.length-1,O)):St(fe)?l(Pe,fe,0,fe.length-1):St(v.text)&&r.setTextContent(Pe,""):v.text!==m.text&&(St(fe)&&l(Pe,fe,0,fe.length-1),r.setTextContent(Pe,m.text)),(z=se?.postpatch)===null||z===void 0||z.call(se,v,m)}return function(m,O){let C,K,U,q=[];for(C=0;C<n.pre.length;++C)n.pre[C]();for(tA(r,m)?m=o(m):nA(r,m)&&(m=s(m)),Zs(m,O)?R(m,O,q):(K=m.elm,U=r.parentNode(K),c(O,q),U!==null&&(r.insertBefore(U,O.elm,r.nextSibling(K)),l(U,[m],0,0))),C=0;C<q.length;++C)q[C].data.hook.insert(q[C]);for(C=0;C<n.post.length;++C)n.post[C]();return O}}function Hu(i,e,t){if(i.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let n=0;n<e.length;++n){let r=e[n];if(typeof r=="string")continue;let o=r.data;o!==void 0&&Hu(o,r.children,r.sel)}}function Ku(i,e,t){let n={},r,o,s;if(t!==void 0?(e!==null&&(n=e),Qs(t)?r=t:gr(t)?o=t.toString():t&&t.sel&&(r=[t])):e!=null&&(Qs(e)?r=e:gr(e)?o=e.toString():e&&e.sel?r=[e]:n=e),r!==void 0)for(s=0;s<r.length;++s)gr(r[s])&&(r[s]=lt(void 0,void 0,void 0,r[s],void 0));return i[0]==="s"&&i[1]==="v"&&i[2]==="g"&&(i.length===3||i[3]==="."||i[3]==="#")&&Hu(n,r,i),lt(i,n,r,o,void 0)}function sA(i){let e,t;if(Qs(i)?e=i:gr(e)?t=i:e&&e.sel&&(e=[i]),e!==void 0)for(let n=0;n<e.length;++n)gr(e[n])&&(e[n]=lt(void 0,void 0,void 0,e[n],void 0));return lt(void 0,{},e,t,void 0)}function Vu(i,e){var t;let n=(t=e.data)===null||t===void 0?void 0:t.ns;i.data.fn=e.data.fn,i.data.args=e.data.args,e.data=i.data,e.children=i.children,e.text=i.text,e.elm=i.elm,n&&Hu(e.data,e.children,e.sel)}function aA(i){let e=i.data,t=e.fn(...e.args);Vu(t,i)}function cA(i,e){let t,n=i.data,r=e.data,o=n.args,s=r.args;if(n.fn!==r.fn||o.length!==s.length){Vu(r.fn(...s),e);return}for(t=0;t<s.length;++t)if(o[t]!==s[t]){Vu(r.fn(...s),e);return}Vu(i,e)}var uA=function(e,t,n,r){return r===void 0&&(r=n,n=t,t=void 0),Ku(e,{key:t,hook:{init:aA,prepatch:cA},fn:n,args:r})};function dA(i,e){let t=i.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,i.elm=i.data.attachData.real}function lA(i,e){e.elm=e.data.attachData.placeholder}function fA(i){i.elm!==void 0&&i.elm.parentNode.removeChild(i.elm),i.elm=i.data.attachData.real}function hA(i,e){let t=e.elm,n=e.data.attachData,r=document.createElement("span");e.elm=r,n.target.appendChild(t),n.real=t,n.placeholder=r}function pA(i,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});let t=e.data,n=e.data.hook;return t.attachData={target:i,placeholder:void 0,real:void 0},n.create=hA,n.prepatch=dA,n.postpatch=lA,n.destroy=fA,e}function oS(i,e){let t=e!==void 0?e:Wh,n;if(t.isElement(i)){let r=i.id?"#"+i.id:"",o=i.getAttribute("class"),s=o?"."+o.split(" ").join("."):"",a=t.tagName(i).toLowerCase()+r+s,c={},u={},d={},l=[],S,R,v,m=i.attributes,O=i.childNodes;for(R=0,v=m.length;R<v;R++)S=m[R].nodeName,S[0]==="d"&&S[1]==="a"&&S[2]==="t"&&S[3]==="a"&&S[4]==="-"?u[S.slice(5)]=m[R].nodeValue||"":S!=="id"&&S!=="class"&&(c[S]=m[R].nodeValue);for(R=0,v=O.length;R<v;R++)l.push(oS(O[R],e));return Object.keys(c).length>0&&(d.attrs=c),Object.keys(u).length>0&&(d.dataset=u),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&Hu(d,l,a),lt(a,d,l,void 0,i)}else return t.isText(i)?(n=t.getTextContent(i),lt(void 0,void 0,void 0,n,i)):t.isComment(i)?(n=t.getTextContent(i),lt("!",{},[],n,i)):lt("",{},[],void 0,i)}var gA="http://www.w3.org/1999/xlink",mA="http://www.w3.org/XML/1998/namespace",Xb=58,yA=120;function Jb(i,e){let t,n=e.elm,r=i.data.attrs,o=e.data.attrs;if(!(!r&&!o)&&r!==o){r=r||{},o=o||{};for(t in o){let s=o[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==yA?n.setAttribute(t,s):t.charCodeAt(3)===Xb?n.setAttributeNS(mA,t,s):t.charCodeAt(5)===Xb?n.setAttributeNS(gA,t,s):n.setAttribute(t,s))}for(t in r)t in o||n.removeAttribute(t)}}var _A={create:Jb,update:Jb};function Zb(i,e){let t,n,r=e.elm,o=i.data.class,s=e.data.class;if(!(!o&&!s)&&o!==s){o=o||{},s=s||{};for(n in o)o[n]&&!Object.prototype.hasOwnProperty.call(s,n)&&r.classList.remove(n);for(n in s)t=s[n],t!==o[n]&&r.classList[t?"add":"remove"](n)}}var vA={create:Zb,update:Zb},Qb=/[A-Z]/g;function eS(i,e){let t=e.elm,n=i.data.dataset,r=e.data.dataset,o;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(o in n)r[o]||(s?o in s&&delete s[o]:t.removeAttribute("data-"+o.replace(Qb,"-$&").toLowerCase()));for(o in r)n[o]!==r[o]&&(s?s[o]=r[o]:t.setAttribute("data-"+o.replace(Qb,"-$&").toLowerCase(),r[o]))}var bA={create:eS,update:eS};function sS(i,e,t){if(typeof i=="function")i.call(e,t,e);else if(typeof i=="object")for(let n=0;n<i.length;n++)sS(i[n],e,t)}function SA(i,e){let t=i.type,n=e.data.on;n&&n[t]&&sS(n[t],e,i)}function EA(){return function i(e){SA(e,i.vnode)}}function kh(i,e){let t=i.data.on,n=i.listener,r=i.elm,o=e&&e.data.on,s=e&&e.elm,a;if(t!==o){if(t&&n)if(o)for(a in t)o[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(o){let c=e.listener=i.listener||EA();if(c.vnode=e,t)for(a in o)t[a]||s.addEventListener(a,c,!1);else for(a in o)s.addEventListener(a,c,!1)}}}var wA={create:kh,update:kh,destroy:kh};function tS(i,e){let t,n,r,o=e.elm,s=i.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||o[t]!==n)&&(o[t]=n)}}var PA={create:tS,update:tS},nS=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,IA=function(i){nS(function(){nS(i)})},Uh=!1;function RA(i,e,t){IA(function(){i[e]=t})}function iS(i,e){let t,n,r=e.elm,o=i.data.style,s=e.data.style;if(!o&&!s||o===s)return;o=o||{},s=s||{};let a="delayed"in o;for(n in o)s[n]||(n[0]==="-"&&n[1]==="-"?r.style.removeProperty(n):r.style[n]="");for(n in s)if(t=s[n],n==="delayed"&&s.delayed)for(let c in s.delayed)t=s.delayed[c],(!a||t!==o.delayed[c])&&RA(r.style,c,t);else n!=="remove"&&t!==o[n]&&(n[0]==="-"&&n[1]==="-"?r.style.setProperty(n,t):r.style[n]=t)}function MA(i){let e,t,n=i.elm,r=i.data.style;if(!(!r||!(e=r.destroy)))for(t in e)n.style[t]=e[t]}function OA(i,e){let t=i.data.style;if(!t||!t.remove){e();return}Uh||(i.elm.offsetLeft,Uh=!0);let n,r=i.elm,o=0,s=t.remove,a=0,c=[];for(n in s)c.push(n),r.style[n]=s[n];let d=getComputedStyle(r)["transition-property"].split(", ");for(;o<d.length;++o)c.indexOf(d[o])!==-1&&a++;r.addEventListener("transitionend",function(l){l.target===r&&--a,a===0&&e()})}function TA(){Uh=!1}var AA={pre:TA,create:iS,update:iS,destroy:MA,remove:OA};function CA(i,...e){let t=$h(e,[]);return t.length===1&&!t[0].sel&&t[0].text?lt(void 0,void 0,void 0,t[0].text,void 0):lt(void 0,i??{},t,void 0,void 0)}function $h(i,e){for(let t of i)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?$h(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(lt(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function Gh(i,e,...t){let n=$h(t,[]);return typeof i=="function"?i(e,n):n.length===1&&!n[0].sel&&n[0].text?Ku(i,e,n[0].text):Ku(i,e,n)}(function(i){})(Gh||(Gh={}));Ie.Fragment=CA;Ie.array=Qs;Ie.attachTo=pA;Ie.attributesModule=_A;Ie.classModule=vA;Ie.datasetModule=bA;Ie.eventListenersModule=wA;Ie.fragment=sA;Ie.h=Ku;Ie.htmlDomApi=Wh;Ie.init=oA;Ie.jsx=Gh;Ie.primitive=gr;Ie.propsModule=PA;Ie.styleModule=AA;Ie.thunk=uA;Ie.toVNode=oS;Ie.vnode=lt});var Jh=f(Mi=>{"use strict";var xA=Mi&&Mi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.isThunk=Mi.ThunkView=void 0;var DA=ho(),qA=_(),Xh=class{render(e,t){return(0,DA.h)(this.selector(e),{key:e.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(e,t),args:this.watchedArgs(e),thunk:!0})}renderAndDecorate(e,t){let n=this.doRender(e,t);return t.decorate(n,e),n}copyToThunk(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}init(e){let t=e.data,n=t.fn.apply(void 0,t.args);this.copyToThunk(n,e)}prepatch(e,t){let n=e.data,r=t.data;this.equals(n.args,r.args)?this.copyToThunk(e,t):this.copyToThunk(r.fn.apply(void 0,r.args),t)}equals(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<t.length;++n)if(!this.equals(e[n],t[n]))return!1}else if(typeof e=="object"&&typeof t=="object"){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(n!=="parent"&&n!=="root"&&(!(n in t)||!this.equals(e[n],t[n])))return!1}else if(e!==t)return!1;return!0}};Xh=xA([(0,qA.injectable)()],Xh);Mi.ThunkView=Xh;function jA(i){return"thunk"in i}Mi.isThunk=jA});var Gt=f(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.JSX=Oi.svg=Oi.html=void 0;var NA=ho(),LA=["hook","on","style","class","props","attrs","dataset"],BA="http://www.w3.org/2000/svg";function FA(i,e,t){let n={};if(t&&(n.ns=t),i===null)return n;return LA.forEach(o=>{i[o]&&(n[o]=i[o])}),Object.keys(i).forEach(o=>{if(o==="key"||o==="classNames"||o==="selector")return;let s=o.indexOf("-");s>0?r(o.slice(0,s),o.slice(s+1),i[o]):n[o]||r(e,o,i[o])}),n;function r(o,s,a){let c=n[o]||(n[o]={});c[s]=a}}function Zh(i,e="props"){return(t,n,...r)=>(0,NA.jsx)(t,FA(n,e,i),r)}Oi.JSX=Zh;var VA=Zh();Oi.html=VA;var KA=Zh(BA,"attrs");Oi.svg=KA});var po=f(Re=>{"use strict";var ep=Re&&Re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},HA=Re&&Re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},aS=Re&&Re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Re,"__esModule",{value:!0});Re.MissingView=Re.EmptyView=Re.configureView=Re.configureModelElement=Re.ViewRegistry=Re.findArgValue=void 0;var cS=Gt(),ea=_(),uS=P(),zA=wn(),YA=ar(),kA=Pn(),UA=He(),GA=fr();function WA(i,e){for(;i!==void 0&&!(e in i)&&i.parentArgs;)i=i.parentArgs;return i?i[e]:void 0}Re.findArgValue=WA;var Qh=class extends zA.InstanceRegistry{constructor(e){super(),this.registerDefaults(),e.forEach(t=>this.register(t.type,t.factory()))}registerDefaults(){this.register(kA.EMPTY_ROOT.type,new zu)}missing(e){return new Yu}};Qh=ep([(0,ea.injectable)(),aS(0,(0,ea.multiInject)(uS.TYPES.ViewRegistration)),aS(0,(0,ea.optional)()),HA("design:paramtypes",[Array])],Qh);Re.ViewRegistry=Qh;function $A(i,e,t,n,r){(0,UA.registerModelElement)(i,e,t,r),dS(i,e,n)}Re.configureModelElement=$A;function dS(i,e,t){if(typeof t=="function"){if(!(0,YA.isInjectable)(t))throw new Error(`Views should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(uS.TYPES.ViewRegistration).toDynamicValue(n=>({type:e,factory:()=>n.container.get(t)}))}Re.configureView=dS;var zu=class{render(e,t){return(0,cS.svg)("svg",{"class-sprotty-empty":!0})}};zu=ep([(0,ea.injectable)()],zu);Re.EmptyView=zu;var Yu=class{render(e,t){let n=e.position||GA.Point.ORIGIN;return(0,cS.svg)("text",{"class-sprotty-missing":!0,x:n.x,y:n.y},"?",e.id,"?")}};Yu=ep([(0,ea.injectable)()],Yu);Re.MissingView=Yu});var ip=f(Ti=>{"use strict";var tp=Ti&&Ti.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},lS=Ti&&Ti.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.ViewerCache=void 0;var np=_(),fS=P(),XA=Zr(),ta=class{update(e,t){if(t!==void 0)this.delegate.update(e,t),this.cachedModel=void 0;else{let n=this.cachedModel===void 0;this.cachedModel=e,n&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};tp([(0,np.inject)(fS.TYPES.IViewer),lS("design:type",Object)],ta.prototype,"delegate",void 0);tp([(0,np.inject)(fS.TYPES.AnimationFrameSyncer),lS("design:type",XA.AnimationFrameSyncer)],ta.prototype,"syncer",void 0);ta=tp([(0,np.injectable)()],ta);Ti.ViewerCache=ta});var rp=f(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.overrideViewerOptions=Qn.configureViewerOptions=Qn.defaultViewerOptions=void 0;var JA=_n(),ku=P(),ZA=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300});Qn.defaultViewerOptions=ZA;function QA(i,e){let t=Object.assign(Object.assign({},(0,Qn.defaultViewerOptions)()),e);i.isBound(ku.TYPES.ViewerOptions)?i.rebind(ku.TYPES.ViewerOptions).toConstantValue(t):i.bind(ku.TYPES.ViewerOptions).toConstantValue(t)}Qn.configureViewerOptions=QA;function eC(i,e){let t=i.get(ku.TYPES.ViewerOptions);return(0,JA.safeAssign)(t,e),t}Qn.overrideViewerOptions=eC});var op=f(Be=>{"use strict";var cn=Be&&Be.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},un=Be&&Be.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Wt=Be&&Be.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Be,"__esModule",{value:!0});Be.PopupModelViewer=Be.HiddenModelViewer=Be.ModelViewer=Be.PatcherProvider=Be.ModelRenderer=void 0;var me=_(),go=ho(),na=Gt(),tC=In(),nC=ks(),hS=Pn(),et=P(),iC=Jh(),At=Le(),ia=class{constructor(e,t,n,r={}){this.viewRegistry=e,this.targetKind=t,this.postprocessors=n,this.args=r}decorate(e,t){return(0,iC.isThunk)(e)?e:this.postprocessors.reduce((n,r)=>r.decorate(n,t),e)}renderElement(e){let n=this.viewRegistry.get(e.type).render(e,this,this.args);if(n)return this.decorate(n,e)}renderChildren(e,t){let n=t?new ia(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map(r=>n.renderElement(r)).filter(r=>r!==void 0)}postUpdate(e){this.postprocessors.forEach(t=>t.postUpdate(e))}};Be.ModelRenderer=ia;var mo=class{constructor(){this.patcher=(0,go.init)(this.createModules())}createModules(){return[go.propsModule,go.attributesModule,go.classModule,go.styleModule,go.eventListenersModule]}};mo=cn([(0,me.injectable)(),un("design:paramtypes",[])],mo);Be.PatcherProvider=mo;var yo=class{constructor(e,t,n){this.renderer=e("main",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering",e);let n=(0,na.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(e));if(this.lastVDOM!==void 0){let r=this.hasFocus();(0,At.copyClassesFromVNode)(this.lastVDOM,n),this.lastVDOM=this.patcher.call(this,this.lastVDOM,n),this.restoreFocus(r)}else if(typeof document<"u"){let r=document.getElementById(this.options.baseDiv);r!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(n)}),(0,At.copyClassesFromElement)(r,n),(0,At.setClass)(n,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,r,n)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(t)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let e=this.lastVDOM.children[0];if(typeof e=="object"){let t=e.elm;return document.activeElement===t}}return!1}restoreFocus(e){if(e&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let t=this.lastVDOM.children[0];if(typeof t=="object"){let n=t.elm;n&&typeof n.focus=="function"&&n.focus()}}}onWindowResize(e){let t=document.getElementById(this.options.baseDiv);if(t!==null){let n=this.getBoundsInPage(t);this.actiondispatcher.dispatch(nC.InitializeCanvasBoundsAction.create(n))}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,tC.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};cn([(0,me.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],yo.prototype,"options",void 0);cn([(0,me.inject)(et.TYPES.ILogger),un("design:type",Object)],yo.prototype,"logger",void 0);cn([(0,me.inject)(et.TYPES.IActionDispatcher),un("design:type",Object)],yo.prototype,"actiondispatcher",void 0);yo=cn([(0,me.injectable)(),Wt(0,(0,me.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,me.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,me.multiInject)(et.TYPES.IVNodePostprocessor)),Wt(2,(0,me.optional)()),un("design:paramtypes",[Function,mo,Array])],yo);Be.ModelViewer=yo;var ra=class{constructor(e,t,n){this.hiddenRenderer=e("hidden",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering hidden");let n;if(e.type===hS.EMPTY_ROOT.type)n=(0,na.html)("div",{id:this.options.hiddenDiv});else{let r=this.hiddenRenderer.renderElement(e);r&&(0,At.setAttr)(r,"opacity",0),n=(0,na.html)("div",{id:this.options.hiddenDiv},r)}if(this.lastHiddenVDOM!==void 0)(0,At.copyClassesFromVNode)(this.lastHiddenVDOM,n),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,n);else{let r=document.getElementById(this.options.hiddenDiv);r===null?(r=document.createElement("div"),document.body.appendChild(r)):(0,At.copyClassesFromElement)(r,n),(0,At.setClass)(n,this.options.baseClass,!0),(0,At.setClass)(n,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,r,n)}this.hiddenRenderer.postUpdate(t)}};cn([(0,me.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],ra.prototype,"options",void 0);cn([(0,me.inject)(et.TYPES.ILogger),un("design:type",Object)],ra.prototype,"logger",void 0);ra=cn([(0,me.injectable)(),Wt(0,(0,me.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,me.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,me.multiInject)(et.TYPES.HiddenVNodePostprocessor)),Wt(2,(0,me.optional)()),un("design:paramtypes",[Function,mo,Array])],ra);Be.HiddenModelViewer=ra;var oa=class{constructor(e,t,n){this.modelRendererFactory=e,this.popupRenderer=this.modelRendererFactory("popup",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering popup",e);let n=e.type===hS.EMPTY_ROOT.type,r;if(n)r=(0,na.html)("div",{id:this.options.popupDiv});else{let o=e.canvasBounds,s={top:o.y+"px",left:o.x+"px"};r=(0,na.html)("div",{id:this.options.popupDiv,style:s},this.popupRenderer.renderElement(e))}if(this.lastPopupVDOM!==void 0)(0,At.copyClassesFromVNode)(this.lastPopupVDOM,r),(0,At.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,r);else if(typeof document<"u"){let o=document.getElementById(this.options.popupDiv);o===null?(o=document.createElement("div"),document.body.appendChild(o)):(0,At.copyClassesFromElement)(o,r),(0,At.setClass)(r,this.options.popupClass,!0),(0,At.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,o,r)}this.popupRenderer.postUpdate(t)}};cn([(0,me.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],oa.prototype,"options",void 0);cn([(0,me.inject)(et.TYPES.ILogger),un("design:type",Object)],oa.prototype,"logger",void 0);oa=cn([(0,me.injectable)(),Wt(0,(0,me.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,me.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,me.multiInject)(et.TYPES.PopupVNodePostprocessor)),Wt(2,(0,me.optional)()),un("design:paramtypes",[Function,mo,Array])],oa);Be.PopupModelViewer=oa});var ap=f(_o=>{"use strict";var rC=_o&&_o.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(_o,"__esModule",{value:!0});_o.FocusFixPostprocessor=void 0;var oC=_(),sC=Le(),sp=class{decorate(e,t){return e.sel&&e.sel.startsWith("svg")&&(0,sC.setAttr)(e,"tabindex",0),e}postUpdate(){}};sp=rC([(0,oC.injectable)()],sp);_o.FocusFixPostprocessor=sp});var Wu=f(Ct=>{"use strict";var Uu=Ct&&Ct.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},pS=Ct&&Ct.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.ConsoleLogger=Ct.NullLogger=Ct.LogLevel=void 0;var Gu=_(),gS=P(),mr;(function(i){i[i.none=0]="none",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i[i.log=4]="log"})(mr=Ct.LogLevel||(Ct.LogLevel={}));var cp=class{constructor(){this.logLevel=mr.none}error(e,t,...n){}warn(e,t,...n){}info(e,t,...n){}log(e,t,...n){}};cp=Uu([(0,Gu.injectable)()],cp);Ct.NullLogger=cp;var sa=class{constructor(){this.logLevel=mr.log,this.viewOptions={baseDiv:""}}error(e,t,...n){if(this.logLevel>=mr.error)try{console.error.apply(e,this.consoleArguments(e,t,n))}catch{}}warn(e,t,...n){if(this.logLevel>=mr.warn)try{console.warn.apply(e,this.consoleArguments(e,t,n))}catch{}}info(e,t,...n){if(this.logLevel>=mr.info)try{console.info.apply(e,this.consoleArguments(e,t,n))}catch{}}log(e,t,...n){if(this.logLevel>=mr.log)try{console.log.apply(e,this.consoleArguments(e,t,n))}catch{}}consoleArguments(e,t,n){let r;return typeof e=="object"?r=e.constructor.name:r=e,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+r+": "+t,...n]}};Uu([(0,Gu.inject)(gS.TYPES.LogLevel),pS("design:type",Number)],sa.prototype,"logLevel",void 0);Uu([(0,Gu.inject)(gS.TYPES.ViewerOptions),pS("design:type",Object)],sa.prototype,"viewOptions",void 0);sa=Uu([(0,Gu.injectable)()],sa);Ct.ConsoleLogger=sa});var _S=f(Ai=>{"use strict";var up=Ai&&Ai.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},mS=Ai&&Ai.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ai,"__esModule",{value:!0});Ai.IdPostprocessor=void 0;var dp=_(),yS=P(),aC=uo(),cC=Le(),aa=class{decorate(e,t){let n=(0,cC.getAttrs)(e);return n.id!==void 0&&this.logger.warn(e,"Overriding id of vnode ("+n.id+"). Make sure not to set it manually in view."),n.id=this.domHelper.createUniqueDOMElementId(t),e.key||(e.key=t.id),e}postUpdate(){}};up([(0,dp.inject)(yS.TYPES.ILogger),mS("design:type",Object)],aa.prototype,"logger",void 0);up([(0,dp.inject)(yS.TYPES.DOMHelper),mS("design:type",aC.DOMHelper)],aa.prototype,"domHelper",void 0);aa=up([(0,dp.injectable)()],aa);Ai.IdPostprocessor=aa});var bS=f(vo=>{"use strict";var uC=vo&&vo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(vo,"__esModule",{value:!0});vo.CssClassPostprocessor=void 0;var dC=wi(),vS=Le(),lC=_(),lp=class{decorate(e,t){if(t.cssClasses)for(let r of t.cssClasses)(0,vS.setClass)(e,r,!0);let n=(0,dC.getSubType)(t);return n&&n!==t.type&&(0,vS.setClass)(e,n,!0),e}postUpdate(){}};lp=uC([(0,lC.injectable)()],lp);vo.CssClassPostprocessor=lp});var gp=f(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});var fC=_(),B=P(),fp=ks(),SS=Wu(),hC=lu(),$u=Hs(),pC=vh(),ES=Pn(),gC=Zr(),Ci=op(),mC=rp(),bo=Tt(),wS=an(),PS=ap(),yC=po(),Xu=ip(),_C=uo(),Ju=_S(),Zu=yt(),hp=bS(),So=qh(),IS=Ou(),vC=Mu(),RS=Xs(),bC=ch(),SC=new fC.ContainerModule((i,e,t)=>{i(B.TYPES.ILogger).to(SS.NullLogger).inSingletonScope(),i(B.TYPES.LogLevel).toConstantValue(SS.LogLevel.warn),i(B.TYPES.SModelRegistry).to(ES.SModelRegistry).inSingletonScope(),i($u.ActionHandlerRegistry).toSelf().inSingletonScope(),i(B.TYPES.ActionHandlerRegistryProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get($u.ActionHandlerRegistry))})),i(B.TYPES.ViewRegistry).to(yC.ViewRegistry).inSingletonScope(),i(B.TYPES.IModelFactory).to(ES.SModelFactory).inSingletonScope(),i(B.TYPES.IActionDispatcher).to(hC.ActionDispatcher).inSingletonScope(),i(B.TYPES.IActionDispatcherProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.IActionDispatcher))})),i(B.TYPES.IDiagramLocker).to(bC.DefaultDiagramLocker).inSingletonScope(),i(B.TYPES.IActionHandlerInitializer).to(Zu.CommandActionHandlerInitializer),i(B.TYPES.ICommandStack).to(pC.CommandStack).inSingletonScope(),i(B.TYPES.ICommandStackProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.ICommandStack))})),i(B.TYPES.CommandStackOptions).toConstantValue({defaultDuration:250,undoHistoryLimit:50}),i(Ci.ModelViewer).toSelf().inSingletonScope(),i(Ci.HiddenModelViewer).toSelf().inSingletonScope(),i(Ci.PopupModelViewer).toSelf().inSingletonScope(),i(B.TYPES.ModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Ci.ModelViewer),o.bind(Xu.ViewerCache).toSelf(),o.get(Xu.ViewerCache)}).inSingletonScope(),i(B.TYPES.PopupModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Ci.PopupModelViewer),o.bind(Xu.ViewerCache).toSelf(),o.get(Xu.ViewerCache)}).inSingletonScope(),i(B.TYPES.HiddenModelViewer).toService(Ci.HiddenModelViewer),i(B.TYPES.IViewerProvider).toDynamicValue(r=>({get modelViewer(){return r.container.get(B.TYPES.ModelViewer)},get hiddenModelViewer(){return r.container.get(B.TYPES.HiddenModelViewer)},get popupModelViewer(){return r.container.get(B.TYPES.PopupModelViewer)}})),i(B.TYPES.ViewerOptions).toConstantValue((0,mC.defaultViewerOptions)()),i(B.TYPES.PatcherProvider).to(Ci.PatcherProvider).inSingletonScope(),i(B.TYPES.DOMHelper).to(_C.DOMHelper).inSingletonScope(),i(B.TYPES.ModelRendererFactory).toFactory(r=>(o,s,a={})=>{let c=r.container.get(B.TYPES.ViewRegistry);return new Ci.ModelRenderer(c,o,s,a)}),i(Ju.IdPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(Ju.IdPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(Ju.IdPostprocessor),i(hp.CssClassPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(hp.CssClassPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(hp.CssClassPostprocessor),i(bo.MouseTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(bo.MouseTool),i(wS.KeyTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(wS.KeyTool),i(PS.FocusFixPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(PS.FocusFixPostprocessor),i(B.TYPES.PopupVNodePostprocessor).toService(Ju.IdPostprocessor),i(bo.PopupMouseTool).toSelf().inSingletonScope(),i(B.TYPES.PopupVNodePostprocessor).toService(bo.PopupMouseTool),i(B.TYPES.AnimationFrameSyncer).to(gC.AnimationFrameSyncer).inSingletonScope();let n={bind:i,isBound:t};(0,Zu.configureCommand)(n,fp.InitializeCanvasBoundsCommand),i(fp.CanvasBoundsInitializer).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(fp.CanvasBoundsInitializer),(0,Zu.configureCommand)(n,vC.SetModelCommand),i(B.TYPES.IToolManager).to(So.ToolManager).inSingletonScope(),i(So.DefaultToolsEnablingKeyListener).toSelf().inSingletonScope(),i(B.TYPES.KeyListener).toService(So.DefaultToolsEnablingKeyListener),i(So.ToolManagerActionHandler).toSelf().inSingletonScope(),(0,$u.configureActionHandler)(n,IS.EnableDefaultToolsAction.KIND,So.ToolManagerActionHandler),(0,$u.configureActionHandler)(n,IS.EnableToolsAction.KIND,So.ToolManagerActionHandler),i(B.TYPES.UIExtensionRegistry).to(RS.UIExtensionRegistry).inSingletonScope(),(0,Zu.configureCommand)(n,RS.SetUIExtensionVisibilityCommand),i(bo.MousePositionTracker).toSelf().inSingletonScope(),i(B.TYPES.MouseListener).toService(bo.MousePositionTracker)});pp.default=SC});var ce=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.SShapeElement=Z.findChildrenAtPosition=Z.getAbsoluteClientBounds=Z.getAbsoluteBounds=Z.isAlignable=Z.isSizeable=Z.isLayoutableChild=Z.isLayoutContainer=Z.isBoundsAware=Z.alignFeature=Z.layoutableChildFeature=Z.layoutContainerFeature=Z.boundsFeature=void 0;var Eo=Q(),Qu=G(),EC=He(),wC=In();Z.boundsFeature=Symbol("boundsFeature");Z.layoutContainerFeature=Symbol("layoutContainerFeature");Z.layoutableChildFeature=Symbol("layoutableChildFeature");Z.alignFeature=Symbol("alignFeature");function wo(i){return"bounds"in i}Z.isBoundsAware=wo;function PC(i){return wo(i)&&i.hasFeature(Z.layoutContainerFeature)&&"layout"in i}Z.isLayoutContainer=PC;function IC(i){return wo(i)&&i.hasFeature(Z.layoutableChildFeature)}Z.isLayoutableChild=IC;function RC(i){return i.hasFeature(Z.boundsFeature)&&wo(i)}Z.isSizeable=RC;function MC(i){return i.hasFeature(Z.alignFeature)&&"alignment"in i}Z.isAlignable=MC;function OC(i){let e=(0,EC.findParentByFeature)(i,wo);if(e!==void 0){let t=e.bounds,n=e;for(;n instanceof Qu.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}else if(i instanceof Qu.SModelRoot){let t=i.canvasBounds;return{x:0,y:0,width:t.width,height:t.height}}else return Eo.Bounds.EMPTY}Z.getAbsoluteBounds=OC;function TC(i,e,t){let n=0,r=0,o=0,s=0,a=e.createUniqueDOMElementId(i),c=document.getElementById(a);if(c){let d=c.getBoundingClientRect(),l=(0,wC.getWindowScroll)();n=d.left+l.x,r=d.top+l.y,o=d.width,s=d.height}let u=document.getElementById(t.baseDiv);if(u)for(;u.offsetParent instanceof HTMLElement&&(u=u.offsetParent);)n-=u.offsetLeft,r-=u.offsetTop;return{x:n,y:r,width:o,height:s}}Z.getAbsoluteClientBounds=TC;function AC(i,e){let t=[];return MS(i,e,t),t}Z.findChildrenAtPosition=AC;function MS(i,e,t){i.children.forEach(n=>{if(wo(n)&&Eo.Bounds.includes(n.bounds,e)&&t.push(n),n instanceof Qu.SParentElement){let r=n.parentToLocal(e);MS(n,r,t)}})}var mp=class extends Qu.SChildElement{constructor(){super(...arguments),this.position=Eo.Point.ORIGIN,this.size=Eo.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:e.x+this.position.x,y:e.y+this.position.y,width:-1,height:-1};return(0,Eo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}parentToLocal(e){let t={x:e.x-this.position.x,y:e.y-this.position.y,width:-1,height:-1};return(0,Eo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}};Z.SShapeElement=mp});var id=f(ue=>{"use strict";var CC=ue&&ue.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),xC=ue&&ue.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),OS=ue&&ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},DC=ue&&ue.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&CC(e,i,t);return xC(e,i),e},TS=ue&&ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},AS=ue&&ue.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ue,"__esModule",{value:!0});ue.RequestBoundsCommand=ue.SetBoundsCommand=ue.LayoutAction=ue.ComputedBoundsAction=ue.RequestBoundsAction=ue.SetBoundsAction=void 0;var ed=_(),qC=te(),CS=DC(te()),xS=ge(),DS=P(),jC=ce(),Po=class{constructor(e){this.bounds=e,this.kind=Po.KIND}};ue.SetBoundsAction=Po;Po.KIND="setBounds";var yr=class{constructor(e,t=""){this.newRoot=e,this.requestId=t,this.kind=yr.KIND}static create(e){return new yr(e,(0,qC.generateRequestId)())}};ue.RequestBoundsAction=yr;yr.KIND="requestBounds";var _r=class{constructor(e,t,n,r=""){this.bounds=e,this.revision=t,this.alignments=n,this.responseId=r,this.kind=_r.KIND}};ue.ComputedBoundsAction=_r;_r.KIND="computedBounds";var Io=class{constructor(){this.kind=Io.KIND}};ue.LayoutAction=Io;Io.KIND="layout";var td=class extends xS.SystemCommand{constructor(e){super(),this.action=e,this.bounds=[]}execute(e){return this.action.bounds.forEach(t=>{let n=e.root.index.getById(t.elementId);n&&(0,jC.isBoundsAware)(n)&&this.bounds.push({element:n,oldBounds:n.bounds,newPosition:t.newPosition,newSize:t.newSize})}),this.redo(e)}undo(e){return this.bounds.forEach(t=>t.element.bounds=t.oldBounds),e.root}redo(e){return this.bounds.forEach(t=>{t.newPosition?t.element.bounds=Object.assign(Object.assign({},t.newPosition),t.newSize):t.element.bounds=Object.assign({x:t.element.bounds.x,y:t.element.bounds.y},t.newSize)}),e.root}};td.KIND=CS.SetBoundsAction.KIND;td=OS([(0,ed.injectable)(),AS(0,(0,ed.inject)(DS.TYPES.Action)),TS("design:paramtypes",[Object])],td);ue.SetBoundsCommand=td;var nd=class extends xS.HiddenCommand{constructor(e){super(),this.action=e}execute(e){return{model:e.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return e=>e.kind===_r.KIND}};nd.KIND=CS.RequestBoundsAction.KIND;nd=OS([(0,ed.injectable)(),AS(0,(0,ed.inject)(DS.TYPES.Action)),TS("design:paramtypes",[Object])],nd);ue.RequestBoundsCommand=nd});var sd=f(tt=>{"use strict";var da=tt&&tt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},od=tt&&tt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},qS=tt&&tt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tt,"__esModule",{value:!0});tt.configureLayout=tt.StatefulLayouter=tt.Layouter=tt.LayoutRegistry=void 0;var vr=_(),NC=Q(),la=P(),LC=wn(),jS=ce(),BC=ar(),ca=class extends LC.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>{this.hasKey(t.layoutKind)?this.logger.warn("Layout kind is already defined: ",t.layoutKind):this.register(t.layoutKind,t.factory())})}};da([(0,vr.inject)(la.TYPES.ILogger),od("design:type",Object)],ca.prototype,"logger",void 0);ca=da([(0,vr.injectable)(),qS(0,(0,vr.multiInject)(la.TYPES.LayoutRegistration)),qS(0,(0,vr.optional)()),od("design:paramtypes",[Array])],ca);tt.LayoutRegistry=ca;var ua=class{layout(e){new rd(e,this.layoutRegistry,this.logger).layout()}};da([(0,vr.inject)(la.TYPES.LayoutRegistry),od("design:type",ca)],ua.prototype,"layoutRegistry",void 0);da([(0,vr.inject)(la.TYPES.ILogger),od("design:type",Object)],ua.prototype,"logger",void 0);ua=da([(0,vr.injectable)()],ua);tt.Layouter=ua;var rd=class{constructor(e,t,n){this.element2boundsData=e,this.layoutRegistry=t,this.log=n,this.toBeLayouted=[],e.forEach((r,o)=>{(0,jS.isLayoutContainer)(o)&&this.toBeLayouted.push(o)})}getBoundsData(e){let t=this.element2boundsData.get(e),n=e.bounds;return(0,jS.isLayoutContainer)(e)&&this.toBeLayouted.indexOf(e)>=0&&(n=this.doLayout(e)),t||(t={bounds:n,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(e,t)),t}layout(){for(;this.toBeLayouted.length>0;){let e=this.toBeLayouted[0];this.doLayout(e)}}doLayout(e){let t=this.toBeLayouted.indexOf(e);t>=0&&this.toBeLayouted.splice(t,1);let n=this.layoutRegistry.get(e.layout);n&&n.layout(e,this);let r=this.element2boundsData.get(e);return r!==void 0&&r.bounds!==void 0?r.bounds:(this.log.error(e,"Layout failed"),NC.Bounds.EMPTY)}};tt.StatefulLayouter=rd;function FC(i,e,t){if(typeof t=="function"){if(!(0,BC.isInjectable)(t))throw new Error(`Layouts be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(la.TYPES.LayoutRegistration).toDynamicValue(n=>({layoutKind:e,factory:()=>n.container.get(t)}))}tt.configureLayout=FC});var bp=f(On=>{"use strict";var ad=On&&On.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_p=On&&On.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(On,"__esModule",{value:!0});On.HiddenBoundsUpdater=On.BoundsData=void 0;var cd=_(),NS=te(),br=Q(),LS=G(),vp=P(),VC=sd(),fa=ce(),yp=class{};On.BoundsData=yp;var Ro=class{constructor(){this.element2boundsData=new Map}decorate(e,t){return((0,fa.isSizeable)(t)||(0,fa.isLayoutContainer)(t))&&this.element2boundsData.set(t,{vnode:e,bounds:t.bounds,boundsChanged:!1,alignmentChanged:!1}),t instanceof LS.SModelRoot&&(this.root=t),e}postUpdate(e){if(e===void 0||e.kind!==NS.RequestBoundsAction.KIND)return;let t=e;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);let n=[],r=[];this.element2boundsData.forEach((s,a)=>{if(s.boundsChanged&&s.bounds!==void 0){let c={elementId:a.id,newSize:{width:s.bounds.width,height:s.bounds.height}};a instanceof LS.SChildElement&&(0,fa.isLayoutContainer)(a.parent)&&(c.newPosition={x:s.bounds.x,y:s.bounds.y}),n.push(c)}s.alignmentChanged&&s.alignment!==void 0&&r.push({elementId:a.id,newAlignment:s.alignment})});let o=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(NS.ComputedBoundsAction.create(n,{revision:o,alignments:r,requestId:t.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((e,t)=>{if(e.bounds&&(0,fa.isSizeable)(t)){let n=e.vnode;if(n&&n.elm){let r=this.getBounds(n.elm,t);(0,fa.isAlignable)(t)&&!((0,br.almostEquals)(r.x,0)&&(0,br.almostEquals)(r.y,0))&&(e.alignment={x:-r.x,y:-r.y},e.alignmentChanged=!0);let o={x:t.bounds.x,y:t.bounds.y,width:r.width,height:r.height};(0,br.almostEquals)(o.x,t.bounds.x)&&(0,br.almostEquals)(o.y,t.bounds.y)&&(0,br.almostEquals)(o.width,t.bounds.width)&&(0,br.almostEquals)(o.height,t.bounds.height)||(e.bounds=o,e.boundsChanged=!0)}}})}getBounds(e,t){if(typeof e.getBBox!="function")return this.logger.error(this,"Not an SVG element:",e),br.Bounds.EMPTY;let n=e.getBBox();return{x:n.x,y:n.y,width:n.width,height:n.height}}};ad([(0,cd.inject)(vp.TYPES.ILogger),_p("design:type",Object)],Ro.prototype,"logger",void 0);ad([(0,cd.inject)(vp.TYPES.IActionDispatcher),_p("design:type",Object)],Ro.prototype,"actionDispatcher",void 0);ad([(0,cd.inject)(vp.TYPES.Layouter),_p("design:type",VC.Layouter)],Ro.prototype,"layouter",void 0);Ro=ad([(0,cd.injectable)()],Ro);On.HiddenBoundsUpdater=Ro});var ud=f(Mo=>{"use strict";var KC=Mo&&Mo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.AbstractLayout=void 0;var Sp=Q(),BS=G(),Ep=ce(),HC=_(),wp=class{layout(e,t){let n=t.getBoundsData(e),r=this.getLayoutOptions(e),o=this.getChildrenSize(e,r,t),s=r.paddingFactor*(r.resizeContainer?o.width:Math.max(0,this.getFixedContainerBounds(e,r,t).width)-r.paddingLeft-r.paddingRight),a=r.paddingFactor*(r.resizeContainer?o.height:Math.max(0,this.getFixedContainerBounds(e,r,t).height)-r.paddingTop-r.paddingBottom);if(s>0&&a>0){let c=this.layoutChildren(e,t,r,s,a);n.bounds=this.getFinalContainerBounds(e,c,r,s,a),n.boundsChanged=!0}}getFinalContainerBounds(e,t,n,r,o){return{x:e.bounds.x,y:e.bounds.y,width:Math.max(n.minWidth,r+n.paddingLeft+n.paddingRight),height:Math.max(n.minHeight,o+n.paddingTop+n.paddingBottom)}}getFixedContainerBounds(e,t,n){let r=e;for(;;){if((0,Ep.isBoundsAware)(r)){let o=r.bounds;if((0,Ep.isLayoutContainer)(r)&&t.resizeContainer&&n.log.error(r,"Resizable container found while detecting fixed bounds"),Sp.Dimension.isValid(o))return o}if(r instanceof BS.SChildElement)r=r.parent;else return n.log.error(r,"Cannot detect fixed bounds"),Sp.Bounds.EMPTY}}layoutChildren(e,t,n,r,o){let s={x:n.paddingLeft+.5*(r-r/n.paddingFactor),y:n.paddingTop+.5*(o-o/n.paddingFactor)};return e.children.forEach(a=>{if((0,Ep.isLayoutableChild)(a)){let c=t.getBoundsData(a),u=c.bounds,d=this.getChildLayoutOptions(a,n);u!==void 0&&Sp.Dimension.isValid(u)&&(s=this.layoutChild(a,c,u,d,n,s,r,o))}}),s}getDx(e,t,n){switch(e){case"left":return 0;case"center":return .5*(n-t.width);case"right":return n-t.width}}getDy(e,t,n){switch(e){case"top":return 0;case"center":return .5*(n-t.height);case"bottom":return n-t.height}}getChildLayoutOptions(e,t){let n=e.layoutOptions;return n===void 0?t:this.spread(t,n)}getLayoutOptions(e){let t=e,n=[];for(;t!==void 0;){let r=t.layoutOptions;if(r!==void 0&&n.push(r),t instanceof BS.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>this.spread(r,o),this.getDefaultLayoutOptions())}};wp=KC([(0,HC.injectable)()],wp);Mo.AbstractLayout=wp});var Pp=f(Oo=>{"use strict";var zC=Oo&&Oo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.VBoxLayouter=void 0;var YC=_(),kC=Q(),UC=ud(),GC=ce(),dd=class extends UC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=0,s=!0;return e.children.forEach(a=>{if((0,GC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&kC.Dimension.isValid(c)&&(o+=c.height,s?s=!1:o+=t.vGap,r=Math.max(r,c.width))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:s.y+e.bounds.y-n.y,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x,y:s.y+n.height+o.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};dd.KIND="vbox";dd=zC([(0,YC.injectable)()],dd);Oo.VBoxLayouter=dd});var Ip=f(To=>{"use strict";var WC=To&&To.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(To,"__esModule",{value:!0});To.HBoxLayouter=void 0;var $C=_(),XC=Q(),JC=ud(),ZC=ce(),ld=class extends JC.AbstractLayout{getChildrenSize(e,t,n){let r=0,o=-1,s=!0;return e.children.forEach(a=>{if((0,ZC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&XC.Dimension.isValid(c)&&(s?s=!1:r+=t.hGap,r+=c.width,o=Math.max(o,c.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDy(r.vAlign,n,c);return t.bounds={x:s.x+e.bounds.x-n.x,y:o.paddingTop+e.bounds.y-n.y+u,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x+n.width+o.hGap,y:s.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};ld.KIND="hbox";ld=WC([(0,$C.injectable)()],ld);To.HBoxLayouter=ld});var Rp=f(Ao=>{"use strict";var QC=Ao&&Ao.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.StackLayouter=void 0;var ex=_(),tx=Q(),nx=ud(),ix=ce(),fd=class extends nx.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=-1;return e.children.forEach(s=>{if((0,ix.isLayoutableChild)(s)){let a=n.getBoundsData(s).bounds;a!==void 0&&tx.Dimension.isValid(a)&&(r=Math.max(r,a.width),o=Math.max(o,a.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a),d=this.getDy(r.vAlign,n,c);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:o.paddingTop+e.bounds.y-n.y+d,width:n.width,height:n.height},t.boundsChanged=!0,s}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};fd.KIND="stack";fd=QC([(0,ex.injectable)()],fd);Ao.StackLayouter=fd});var ha=f(Co=>{"use strict";var rx=Co&&Co.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Co,"__esModule",{value:!0});Co.ShapeView=void 0;var ox=_(),sx=Q(),ax=ce(),Mp=class{isVisible(e,t){if(t.targetKind==="hidden"||!sx.Dimension.isValid(e.bounds))return!0;let n=(0,ax.getAbsoluteBounds)(e),r=e.root.canvasBounds;return n.x<=r.width&&n.x+n.width>=0&&n.y<=r.height&&n.y+n.height>=0}};Mp=rx([(0,ox.injectable)()],Mp);Co.ShapeView=Mp});var ga=f($t=>{"use strict";var cx=$t&&$t.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ux=$t&&$t.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},hd=$t&&$t.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty($t,"__esModule",{value:!0});$t.configureButtonHandler=$t.ButtonHandlerRegistry=void 0;var pa=_(),dx=wn(),Op=P(),lx=ar(),Tp=class extends dx.InstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.TYPE,n.factory())),t.forEach(n=>this.register(n.TYPE,new n))}};Tp=cx([(0,pa.injectable)(),hd(0,(0,pa.multiInject)(Op.TYPES.IButtonHandlerRegistration)),hd(0,(0,pa.optional)()),hd(1,(0,pa.multiInject)(Op.TYPES.IButtonHandler)),hd(1,(0,pa.optional)()),ux("design:paramtypes",[Array,Array])],Tp);$t.ButtonHandlerRegistry=Tp;function fx(i,e,t){if(typeof t=="function"){if(!(0,lx.isInjectable)(t))throw new Error(`Button handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(Op.TYPES.IButtonHandlerRegistration).toDynamicValue(n=>({TYPE:e,factory:()=>n.container.get(t)}))}$t.configureButtonHandler=fx});var xo=f(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.isFadeable=Sr.fadeFeature=void 0;Sr.fadeFeature=Symbol("fadeFeature");function hx(i){return i.hasFeature(Sr.fadeFeature)&&i.opacity!==void 0}Sr.isFadeable=hx});var md=f(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});gd.SButton=void 0;var Ap=ce(),px=xo(),pd=class extends Ap.SShapeElement{constructor(){super(...arguments),this.enabled=!0}};gd.SButton=pd;pd.DEFAULT_FEATURES=[Ap.boundsFeature,Ap.layoutableChildFeature,px.fadeFeature]});var Cp=f(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.name=ei.isNameable=ei.nameFeature=void 0;ei.nameFeature=Symbol("nameableFeature");function FS(i){return i.hasFeature(ei.nameFeature)}ei.isNameable=FS;function gx(i){if(FS(i))return i.name}ei.name=gx});var yd=f(Xt=>{"use strict";var HS=Xt&&Xt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},zS=Xt&&Xt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Dp=Xt&&Xt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.RevealNamedElementActionProvider=Xt.CommandPaletteActionProviderRegistry=void 0;var ma=_(),xp=te(),VS=yc(),YS=P(),mx=rr(),KS=Cp(),qp=class{constructor(e=[]){this.actionProviders=e}getActions(e,t,n,r){let o=this.actionProviders.map(s=>s.getActions(e,t,n,r));return Promise.all(o).then(s=>s.reduce((a,c)=>c!==void 0?a.concat(c):a))}};qp=HS([(0,ma.injectable)(),Dp(0,(0,ma.multiInject)(YS.TYPES.ICommandPaletteActionProvider)),Dp(0,(0,ma.optional)()),zS("design:paramtypes",[Array])],qp);Xt.CommandPaletteActionProviderRegistry=qp;var jp=class{constructor(e){this.logger=e}getActions(e,t,n,r){return r!==void 0&&r%2===0?Promise.resolve(this.createSelectActions(e)):Promise.resolve([new VS.LabeledAction("Select all",[xp.SelectAllAction.create()])])}createSelectActions(e){return(0,mx.toArray)(e.index.all().filter(n=>(0,KS.isNameable)(n))).map(n=>new VS.LabeledAction(`Reveal ${(0,KS.name)(n)}`,[xp.SelectAction.create({selectedElementsIDs:[n.id]}),xp.CenterAction.create([n.id])],"eye"))}};jp=HS([(0,ma.injectable)(),Dp(0,(0,ma.inject)(YS.TYPES.ILogger)),zS("design:paramtypes",[Object])],jp);Xt.RevealNamedElementActionProvider=jp});var Np=f(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.codiconCSSClasses=Jt.codiconCSSString=Jt.ANIMATION_SPIN=Jt.ACTION_ITEM=void 0;Jt.ACTION_ITEM="action-item";Jt.ANIMATION_SPIN="animation-spin";function yx(i,e=!1,t=!1,n=[]){return kS(i,e,t,n).join(" ")}Jt.codiconCSSString=yx;function kS(i,e=!1,t=!1,n=[]){let r=["codicon",`codicon-${i}`];return e&&r.push(Jt.ACTION_ITEM),t&&r.push(Jt.ANIMATION_SPIN),n.length>0&&r.push(...n),r}Jt.codiconCSSClasses=kS});var Et=f(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.isSelected=ti.isSelectable=ti.selectFeature=void 0;ti.selectFeature=Symbol("selectFeature");function US(i){return i.hasFeature(ti.selectFeature)}ti.isSelectable=US;function _x(i){return i!==void 0&&US(i)&&i.selected}ti.isSelected=_x});var GS=f((Lp,Bp)=>{(function(i,e){typeof Lp=="object"&&typeof Bp<"u"?Bp.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self,i.autocomplete=e())})(Lp,function(){"use strict";function i(e){var t=document,n=e.container||t.createElement("div");n.id=n.id||"autocomplete-"+O();var r=n.style,o=e.debounceWaitMs||0,s=e.preventSubmit||!1,a=e.disableAutoSelect||!1,c=[],u="",d=2,l=e.showOnFocus,S,R=0,v;if(e.minLength!==void 0&&(d=e.minLength),!e.input)throw new Error("input undefined");var m=e.input;n.className="autocomplete "+(e.className||""),n.setAttribute("role","listbox"),m.setAttribute("role","combobox"),m.setAttribute("aria-expanded","false"),m.setAttribute("aria-autocomplete","list"),m.setAttribute("aria-controls",n.id),m.setAttribute("aria-owns",n.id),m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-haspopup","listbox"),r.position="absolute";function O(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function C(){var L=n.parentNode;L&&L.removeChild(n)}function K(){v&&window.clearTimeout(v)}function U(){n.parentNode||t.body.appendChild(n)}function q(){return!!n.parentNode}function F(){R++,c=[],u="",S=void 0,m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-expanded","false"),C()}function H(){if(!q())return;m.setAttribute("aria-expanded","true"),r.height="auto",r.width=m.offsetWidth+"px";var L=0,j;function ae(){var je=t.documentElement,k=je.clientTop||t.body.clientTop||0,Ve=je.clientLeft||t.body.clientLeft||0,li=window.pageYOffset||je.scrollTop,sn=window.pageXOffset||je.scrollLeft;j=m.getBoundingClientRect();var We=j.top+m.offsetHeight+li-k,ot=j.left+sn-Ve;r.top=We+"px",r.left=ot+"px",L=window.innerHeight-(j.top+m.offsetHeight),L<0&&(L=0),r.top=We+"px",r.bottom="",r.left=ot+"px",r.maxHeight=L+"px"}ae(),ae(),e.customize&&j&&e.customize(m,j,n,L)}function W(){for(;n.firstChild;)n.removeChild(n.firstChild);m.setAttribute("aria-activedescendant","");var L=function(Ve,li,sn){var We=t.createElement("div");return We.textContent=Ve.label||"",We};e.render&&(L=e.render);var j=function(Ve,li){var sn=t.createElement("div");return sn.textContent=Ve,sn};e.renderGroup&&(j=e.renderGroup);var ae=t.createDocumentFragment(),je="#9?$";if(c.forEach(function(Ve,li){if(Ve.group&&Ve.group!==je){je=Ve.group;var sn=j(Ve.group,u);sn&&(sn.className+=" group",ae.appendChild(sn))}var We=L(Ve,u,li);We&&(We.id=n.id+"_"+li,We.setAttribute("role","option"),We.addEventListener("click",function(ot){e.onSelect(Ve,m),F(),ot.preventDefault(),ot.stopPropagation()}),Ve===S&&(We.className+=" selected",We.setAttribute("aria-selected","true"),m.setAttribute("aria-activedescendant",We.id)),ae.appendChild(We))}),n.appendChild(ae),c.length<1)if(e.emptyMsg){var k=t.createElement("div");k.id=n.id+"_"+O(),k.className="empty",k.textContent=e.emptyMsg,n.appendChild(k),m.setAttribute("aria-activedescendant",k.id)}else{F();return}U(),H(),ve()}function z(){q()&&W()}function se(){z()}function Pe(L){L.target!==n?z():L.preventDefault()}function fe(L){for(var j=L.which||L.keyCode||0,ae=e.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9],je=0,k=ae;je<k.length;je++){var Ve=k[je];if(j===Ve)return}j>=112&&j<=123&&!e.keysToIgnore||j===40&&q()||xs(0)}function ve(){var L=n.getElementsByClassName("selected");if(L.length>0){var j=L[0],ae=j.previousElementSibling;if(ae&&ae.className.indexOf("group")!==-1&&!ae.previousElementSibling&&(j=ae),j.offsetTop<n.scrollTop)n.scrollTop=j.offsetTop;else{var je=j.offsetTop+j.offsetHeight,k=n.scrollTop+n.offsetHeight;je>k&&(n.scrollTop+=je-k)}}}function Ge(){if(c.length<1)S=void 0;else if(S===c[0])S=c[c.length-1];else for(var L=c.length-1;L>0;L--)if(S===c[L]||L===1){S=c[L-1];break}}function yn(){if(c.length<1&&(S=void 0),!S||S===c[c.length-1]){S=c[0];return}for(var L=0;L<c.length-1;L++)if(S===c[L]){S=c[L+1];break}}function di(L){var j=L.which||L.keyCode||0;if(j===38||j===40||j===27){var ae=q();if(j===27)F();else{if(!ae||c.length<1)return;j===38?Ge():yn(),W()}L.preventDefault(),ae&&L.stopPropagation();return}j===13&&(S&&(e.onSelect(S,m),F()),s&&L.preventDefault())}function Cs(){l&&xs(1)}function xs(L){var j=++R,ae=m.value,je=m.selectionStart||0;ae.length>=d||L===1?(K(),v=window.setTimeout(function(){e.fetch(ae,function(k){R===j&&k&&(c=k,u=ae,S=c.length<1||a?void 0:c[0],W())},L,je)},L===0?o:0)):F()}function Ds(){setTimeout(function(){t.activeElement!==m&&F()},200)}n.addEventListener("mousedown",function(L){L.stopPropagation(),L.preventDefault()}),n.addEventListener("focus",function(){return m.focus()});function pc(){m.removeEventListener("focus",Cs),m.removeEventListener("keydown",di),m.removeEventListener("keyup",fe),m.removeEventListener("blur",Ds),window.removeEventListener("resize",se),t.removeEventListener("scroll",Pe,!0),m.removeAttribute("role"),m.removeAttribute("aria-expanded"),m.removeAttribute("aria-autocomplete"),m.removeAttribute("aria-controls"),m.removeAttribute("aria-activedescendant"),m.removeAttribute("aria-owns"),m.removeAttribute("aria-haspopup"),K(),F()}return m.addEventListener("keydown",di),m.addEventListener("keyup",fe),m.addEventListener("blur",Ds),m.addEventListener("focus",Cs),window.addEventListener("resize",se),t.addEventListener("scroll",Pe,!0),{destroy:pc}}return i})});var Hp=f(Zt=>{"use strict";var Do=Zt&&Zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ya=Zt&&Zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},vx=Zt&&Zt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},_d;Object.defineProperty(Zt,"__esModule",{value:!0});Zt.CommandPaletteKeyListener=Zt.CommandPalette=void 0;var qo=_(),bx=te(),Sx=yc(),vd=P(),Ex=qu(),WS=Xs(),wx=uo(),Px=an(),$S=Np(),Fp=rr(),Kp=Rn(),XS=ce(),ZS=Et(),Ix=yd(),JS=Tt(),Rx=vx(GS()),xt=_d=class extends Ex.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,$S.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return _d.ID}containerClass(){return"command-palette"}show(e,...t){super.show(e,...t),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,Rx.default)(this.autocompleteSettings(e)),this.inputElement.focus()}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",t=>this.hideIfEscapeEvent(t)),this.inputElement.addEventListener("keydown",t=>this.cylceIfInvokePaletteKey(t)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),e.appendChild(this.inputElement)}hideIfEscapeEvent(e){(0,Kp.matchesKeystroke)(e,"Escape")&&this.hide()}cylceIfInvokePaletteKey(e){_d.isInvokePaletteKey(e)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(e,t,...n){let r=this.xOffset,o=this.yOffset,s=(0,Fp.toArray)(t.index.all().filter(a=>(0,ZS.isSelectable)(a)&&a.selected));if(s.length===1){let a=(0,XS.getAbsoluteClientBounds)(s[0],this.domHelper,this.viewerOptions);r+=a.x+a.width,o+=a.y}else{let a=(0,XS.getAbsoluteClientBounds)(t,this.domHelper,this.viewerOptions);r+=a.x,o+=a.y}e.style.left=`${r}px`,e.style.top=`${o}px`,e.style.width=`${this.defaultWidth}px`}autocompleteSettings(e){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(t,n)=>this.updateAutoCompleteActions(n,t,e),onSelect:t=>this.onSelect(t),render:(t,n)=>this.renderLabeledActionSuggestion(t,n),customize:(t,n,r,o)=>{this.customizeSuggestionContainer(r,n,o)}}}onSelect(e){this.executeAction(e),this.hide()}updateAutoCompleteActions(e,t,n){this.onLoading(),this.contextActions?(e(this.filterActions(t,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(n,t,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(r=>{this.contextActions=r,e(this.filterActions(t,r)),this.onLoaded("success")}).catch(r=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",r),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(e){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(e,t){let n=document.createElement("div"),r=Ox(t).split(" ").join("|"),o=new RegExp(r,"gi");return e.icon&&this.renderIcon(n,e.icon),t.length>0?n.innerHTML+=e.label.replace(o,s=>"<em>"+s+"</em>").replace(/ /g,"&nbsp;"):n.innerHTML+=e.label.replace(/ /g,"&nbsp;"),n}renderIcon(e,t){e.innerHTML+=`<span class="icon ${this.getCodicon(t)}"></span>`}getFontAwesomeIcon(e){return`fa fa-${e}`}getCodicon(e){return(0,$S.codiconCSSString)(e)}filterActions(e,t){return(0,Fp.toArray)(t.filter(n=>{let r=n.label.toLowerCase();return e.split(" ").every(s=>r.indexOf(s.toLowerCase())!==-1)}))}customizeSuggestionContainer(e,t,n){this.containerElement&&this.containerElement.appendChild(e)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(e){this.actionDispatcherProvider().then(t=>t.dispatchAll(Mx(e))).catch(t=>this.logger.error(this,"No action dispatcher available to execute command palette action",t))}};xt.ID="command-palette";xt.isInvokePaletteKey=i=>(0,Kp.matchesKeystroke)(i,"Space","ctrl");Do([(0,qo.inject)(vd.TYPES.IActionDispatcherProvider),ya("design:type",Function)],xt.prototype,"actionDispatcherProvider",void 0);Do([(0,qo.inject)(vd.TYPES.ICommandPaletteActionProviderRegistry),ya("design:type",Ix.CommandPaletteActionProviderRegistry)],xt.prototype,"actionProviderRegistry",void 0);Do([(0,qo.inject)(vd.TYPES.ViewerOptions),ya("design:type",Object)],xt.prototype,"viewerOptions",void 0);Do([(0,qo.inject)(vd.TYPES.DOMHelper),ya("design:type",wx.DOMHelper)],xt.prototype,"domHelper",void 0);Do([(0,qo.inject)(JS.MousePositionTracker),ya("design:type",JS.MousePositionTracker)],xt.prototype,"mousePositionTracker",void 0);xt=_d=Do([(0,qo.injectable)()],xt);Zt.CommandPalette=xt;function Mx(i){return(0,Sx.isLabeledAction)(i)?i.actions:(0,bx.isAction)(i)?[i]:[]}function Ox(i){return i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var Vp=class extends Px.KeyListener{keyDown(e,t){if((0,Kp.matchesKeystroke)(t,"Escape"))return[WS.SetUIExtensionVisibilityAction.create({extensionId:xt.ID,visible:!1,contextElementsId:[]})];if(xt.isInvokePaletteKey(t)){let n=(0,Fp.toArray)(e.index.all().filter(r=>(0,ZS.isSelectable)(r)&&r.selected).map(r=>r.id));return[WS.SetUIExtensionVisibilityAction.create({extensionId:xt.ID,visible:!0,contextElementsId:n})]}return[]}};Zt.CommandPaletteKeyListener=Vp});var QS=f(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});bd.toAnchor=void 0;function Tx(i){return i instanceof HTMLElement?{x:i.offsetLeft,y:i.offsetTop}:i}bd.toAnchor=Tx});var jo=f(Me=>{"use strict";var Ax=Me&&Me.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Cx=Me&&Me.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},xx=Me&&Me.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Me,"__esModule",{value:!0});Me.DeleteElementCommand=Me.ResolvedDelete=Me.DeleteElementAction=Me.isDeletable=Me.deletableFeature=void 0;var e0=_(),Dx=ge(),qx=G(),jx=P();Me.deletableFeature=Symbol("deletableFeature");function t0(i){return i instanceof qx.SChildElement&&i.hasFeature(Me.deletableFeature)}Me.isDeletable=t0;var n0;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(n0=Me.DeleteElementAction||(Me.DeleteElementAction={}));var zp=class{};Me.ResolvedDelete=zp;var Sd=class extends Dx.Command{constructor(e){super(),this.action=e,this.resolvedDeletes=[]}execute(e){let t=e.root.index;for(let n of this.action.elementIds){let r=t.getById(n);r&&t0(r)&&(this.resolvedDeletes.push({child:r,parent:r.parent}),r.parent.remove(r))}return e.root}undo(e){for(let t of this.resolvedDeletes)t.parent.add(t.child);return e.root}redo(e){for(let t of this.resolvedDeletes)t.parent.remove(t.child);return e.root}};Sd.KIND=n0.KIND;Sd=Ax([(0,e0.injectable)(),xx(0,(0,e0.inject)(jx.TYPES.Action)),Cx("design:paramtypes",[Object])],Sd);Me.DeleteElementCommand=Sd});var wd=f(Qt=>{"use strict";var r0=Qt&&Qt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nx=Qt&&Qt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},i0=Qt&&Qt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.DeleteContextMenuItemProvider=Qt.ContextMenuProviderRegistry=void 0;var Ed=_(),Lx=P(),Bx=jo(),Fx=Et(),Vx=fr(),Yp=class{constructor(e=[]){this.menuProviders=e}getItems(e,t){let n=this.menuProviders.map(r=>r.getItems(e,t));return Promise.all(n).then(this.flattenAndRestructure)}flattenAndRestructure(e){let t=e.reduce((r,o)=>o!==void 0?r.concat(o):r,[]),n=t.filter(r=>r.parentId);for(let r of n)if(r.parentId){let o=r.parentId.split("."),s,a=t;for(let c of o)s=a.find(u=>c===u.id),s&&s.children&&(a=s.children);s&&(s.children?s.children.push(r):s.children=[r],t=t.filter(c=>c!==r))}return t}};Yp=r0([(0,Ed.injectable)(),i0(0,(0,Ed.multiInject)(Lx.TYPES.IContextMenuItemProvider)),i0(0,(0,Ed.optional)()),Nx("design:paramtypes",[Array])],Yp);Qt.ContextMenuProviderRegistry=Yp;var kp=class{getItems(e,t){let n=Array.from(e.index.all().filter(Fx.isSelected).filter(Bx.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[Vx.DeleteElementAction.create(n.map(r=>r.id))],isEnabled:()=>n.length>0}])}};kp=r0([(0,Ed.injectable)()],kp);Qt.DeleteContextMenuItemProvider=kp});var Wp=f(Tn=>{"use strict";var s0=Tn&&Tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},a0=Tn&&Tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},o0=Tn&&Tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Tn,"__esModule",{value:!0});Tn.ContextMenuMouseListener=void 0;var Up=_(),Kx=te(),Hx=wd(),zx=Tt(),Gp=P(),Pd=Et(),Yx=He(),Id=class extends zx.MouseListener{constructor(e,t){super(),this.contextMenuService=e,this.menuProvider=t}contextMenu(e,t){return this.showContextMenu(e,t),[]}async showContextMenu(e,t){let n;try{n=await this.contextMenuService()}catch{return}let r={x:t.x,y:t.y},o=e.root,s=e.id,a=!1,c=(0,Yx.findParentByFeature)(e,Pd.isSelectable);c&&(a=c.selected,c.selected=!0);let u=()=>{c&&(c.selected=a)};if((0,Pd.isSelectable)(e))if((0,Pd.isSelected)(e)){let d=await this.menuProvider.getItems(e.root,r);n.show(d,r,u)}else{let d={selectedElementsIDs:[s],deselectedElementsIDs:Array.from(o.index.all().filter(Pd.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(Kx.SelectAction.create(d));let l=await this.menuProvider.getItems(o,r);n.show(l,r)}}};s0([(0,Up.inject)(Gp.TYPES.IActionDispatcher),a0("design:type",Object)],Id.prototype,"actionDispatcher",void 0);Id=s0([o0(0,(0,Up.inject)(Gp.TYPES.IContextMenuServiceProvider)),o0(1,(0,Up.inject)(Gp.TYPES.IContextMenuProviderRegistry)),a0("design:paramtypes",[Function,Hx.ContextMenuProviderRegistry])],Id);Tn.ContextMenuMouseListener=Id});var Er=f(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.hasPopupFeature=en.popupFeature=en.isHoverable=en.hoverFeedbackFeature=void 0;en.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function kx(i){return i.hasFeature(en.hoverFeedbackFeature)}en.isHoverable=kx;en.popupFeature=Symbol("popupFeature");function Ux(i){return i.hasFeature(en.popupFeature)}en.hasPopupFeature=Ux});var xi=f(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.isMoveable=ni.isLocateable=ni.moveFeature=void 0;ni.moveFeature=Symbol("moveFeature");function c0(i){return i.position!==void 0}ni.isLocateable=c0;function Gx(i){return i.hasFeature(ni.moveFeature)&&c0(i)}ni.isMoveable=Gx});var ye=f(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.edgeInProgressTargetHandleID=he.edgeInProgressID=he.SDanglingAnchor=he.SRoutingHandle=he.SConnectableElement=he.getRouteBounds=he.getAbsoluteRouteBounds=he.isConnectable=he.connectableFeature=he.SRoutableElement=void 0;var u0=Q(),$p=G(),Wx=ce(),$x=jo(),Xx=Et(),Jx=Er(),Zx=xi(),_a=class extends $p.SChildElement{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((e,t)=>u0.Bounds.combine(e,{x:t.x,y:t.y,width:0,height:0}),u0.Bounds.EMPTY)}};he.SRoutableElement=_a;he.connectableFeature=Symbol("connectableFeature");function Qx(i){return i.hasFeature(he.connectableFeature)&&i.canConnect}he.isConnectable=Qx;function e1(i,e=i.routingPoints){let t=d0(e),n=i;for(;n instanceof $p.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}he.getAbsoluteRouteBounds=e1;function d0(i){let e={x:NaN,y:NaN,width:0,height:0};for(let t of i)isNaN(e.x)?(e.x=t.x,e.y=t.y):(t.x<e.x?(e.width+=e.x-t.x,e.x=t.x):t.x>e.x+e.width&&(e.width=t.x-e.x),t.y<e.y?(e.height+=e.y-t.y,e.y=t.y):t.y>e.y+e.height&&(e.height=t.y-e.y));return e}he.getRouteBounds=d0;var Rd=class extends Wx.SShapeElement{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(t=>t instanceof _a).filter(t=>t.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(t=>t instanceof _a).filter(t=>t.sourceId===this.id)}canConnect(e,t){return!0}};he.SConnectableElement=Rd;var No=class extends $p.SChildElement{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(e){return No.DEFAULT_FEATURES.indexOf(e)!==-1}};he.SRoutingHandle=No;No.DEFAULT_FEATURES=[Xx.selectFeature,Zx.moveFeature,Jx.hoverFeedbackFeature];var Md=class extends Rd{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}};he.SDanglingAnchor=Md;Md.DEFAULT_FEATURES=[$x.deletableFeature];he.edgeInProgressID="edge-in-progress";he.edgeInProgressTargetHandleID=he.edgeInProgressID+"-target-anchor"});var Lo=f(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.DEFAULT_EDGE_PLACEMENT=dn.EdgePlacement=dn.isEdgeLayoutable=dn.edgeLayoutFeature=void 0;var t1=G(),n1=ce(),i1=ye();dn.edgeLayoutFeature=Symbol("edgeLayout");function r1(i){return i instanceof t1.SChildElement&&i.parent instanceof i1.SRoutableElement&&o1(i)&&(0,n1.isBoundsAware)(i)&&i.hasFeature(dn.edgeLayoutFeature)}dn.isEdgeLayoutable=r1;function o1(i){return"edgePlacement"in i}var Xp=class extends Object{};dn.EdgePlacement=Xp;dn.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}});var Bo=f(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.isWithEditableLabel=ze.withEditLabelFeature=ze.isEditableLabel=ze.editLabelFeature=ze.canEditRouting=ze.editFeature=void 0;var s1=ye();ze.editFeature=Symbol("editFeature");function a1(i){return i instanceof s1.SRoutableElement&&i.hasFeature(ze.editFeature)}ze.canEditRouting=a1;ze.editLabelFeature=Symbol("editLabelFeature");function c1(i){return"text"in i&&i.hasFeature(ze.editLabelFeature)}ze.isEditableLabel=c1;ze.withEditLabelFeature=Symbol("withEditLabelFeature");function u1(i){return"editableLabel"in i&&i.hasFeature(ze.withEditLabelFeature)}ze.isWithEditableLabel=u1});var An=f(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.isViewport=wr.viewportFeature=void 0;var d1=G();wr.viewportFeature=Symbol("viewportFeature");function l1(i){return i instanceof d1.SModelRoot&&i.hasFeature(wr.viewportFeature)&&"zoom"in i&&"scroll"in i}wr.isViewport=l1});var Od=f(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.isExportable=Pr.exportFeature=void 0;Pr.exportFeature=Symbol("exportFeature");function f1(i){return i.hasFeature(Pr.exportFeature)}Pr.isExportable=f1});var Cd=f(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.ViewportRootElement=void 0;var va=Q(),h1=G(),p1=An(),g1=Od(),Td=class extends h1.SModelRoot{constructor(e){super(e),this.scroll={x:0,y:0},this.zoom=1,this.position=va.Point.ORIGIN,this.size=va.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:(e.x-this.scroll.x)*this.zoom,y:(e.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,va.isBounds)(e)&&(t.width=e.width*this.zoom,t.height=e.height*this.zoom),t}parentToLocal(e){let t={x:e.x/this.zoom+this.scroll.x,y:e.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,va.isBounds)(e)&&va.Dimension.isValid(e)&&(t.width=e.width/this.zoom,t.height=e.height/this.zoom),t}};Ad.ViewportRootElement=Td;Td.DEFAULT_FEATURES=[p1.viewportFeature,g1.exportFeature]});var Ir=f(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.SGraphIndex=nt.SCompartment=nt.SLabel=nt.SEdge=nt.SPort=nt.SNode=nt.SGraph=void 0;var m1=Q(),y1=G(),ln=ce(),_1=Lo(),l0=jo(),v1=Bo(),Sa=xo(),xd=Er(),b1=xi(),Ea=ye(),Zp=Et(),S1=Cd(),E1=rr(),Jp=class extends S1.ViewportRootElement{constructor(e=new Di){super(e)}};nt.SGraph=Jp;var Dd=class extends Ea.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(e,t){return this.children.find(n=>n instanceof ba)===void 0}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):this.index.all().filter(n=>n instanceof Cn).filter(n=>n.targetId===this.id)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):this.index.all().filter(n=>n instanceof Cn).filter(n=>n.sourceId===this.id)}};nt.SNode=Dd;Dd.DEFAULT_FEATURES=[Ea.connectableFeature,l0.deletableFeature,Zp.selectFeature,ln.boundsFeature,b1.moveFeature,ln.layoutContainerFeature,Sa.fadeFeature,xd.hoverFeedbackFeature,xd.popupFeature];var ba=class extends Ea.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):super.incomingEdges.filter(t=>t instanceof Cn)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):super.outgoingEdges.filter(t=>t instanceof Cn)}};nt.SPort=ba;ba.DEFAULT_FEATURES=[Ea.connectableFeature,Zp.selectFeature,ln.boundsFeature,Sa.fadeFeature,xd.hoverFeedbackFeature];var Cn=class extends Ea.SRoutableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}};nt.SEdge=Cn;Cn.DEFAULT_FEATURES=[v1.editFeature,l0.deletableFeature,Zp.selectFeature,Sa.fadeFeature,xd.hoverFeedbackFeature];var qd=class extends ln.SShapeElement{constructor(){super(...arguments),this.selected=!1,this.alignment=m1.Point.ORIGIN,this.opacity=1}};nt.SLabel=qd;qd.DEFAULT_FEATURES=[ln.boundsFeature,ln.alignFeature,ln.layoutableChildFeature,_1.edgeLayoutFeature,Sa.fadeFeature];var jd=class extends ln.SShapeElement{constructor(){super(...arguments),this.opacity=1}};nt.SCompartment=jd;jd.DEFAULT_FEATURES=[ln.boundsFeature,ln.layoutContainerFeature,ln.layoutableChildFeature,Sa.fadeFeature];var Di=class extends y1.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(e){if(super.add(e),e instanceof Cn){if(e.sourceId){let t=this.outgoing.get(e.sourceId);t===void 0?this.outgoing.set(e.sourceId,[e]):t.push(e)}if(e.targetId){let t=this.incoming.get(e.targetId);t===void 0?this.incoming.set(e.targetId,[e]):t.push(e)}}}remove(e){if(super.remove(e),e instanceof Cn){let t=this.outgoing.get(e.sourceId);if(t!==void 0){let r=t.indexOf(e);r>=0&&(t.length===1?this.outgoing.delete(e.sourceId):t.splice(r,1))}let n=this.incoming.get(e.targetId);if(n!==void 0){let r=n.indexOf(e);r>=0&&(n.length===1?this.incoming.delete(e.targetId):n.splice(r,1))}}}getAttachedElements(e){return new E1.FluentIterableImpl(()=>({outgoing:this.outgoing.get(e.id),incoming:this.incoming.get(e.id),nextOutgoingIndex:0,nextIncomingIndex:0}),t=>{let n=t.nextOutgoingIndex;if(t.outgoing!==void 0&&n<t.outgoing.length)return t.nextOutgoingIndex=n+1,{done:!1,value:t.outgoing[n]};if(n=t.nextIncomingIndex,t.incoming!==void 0)for(;n<t.incoming.length;){let r=t.incoming[n];if(r.sourceId!==r.targetId)return t.nextIncomingIndex=n+1,{done:!1,value:r};n++}return{done:!0,value:void 0}})}getIncomingEdges(e){return this.incoming.get(e.id)||[]}getOutgoingEdges(e){return this.outgoing.get(e.id)||[]}};nt.SGraphIndex=Di});var ii=f(Ye=>{"use strict";var w1=Ye&&Ye.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},P1=Ye&&Ye.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},I1=Ye&&Ye.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.AnchorComputerRegistry=Ye.RECTANGULAR_ANCHOR_KIND=Ye.ELLIPTIC_ANCHOR_KIND=Ye.DIAMOND_ANCHOR_KIND=void 0;var f0=_(),R1=P(),M1=wn();Ye.DIAMOND_ANCHOR_KIND="diamond";Ye.ELLIPTIC_ANCHOR_KIND="elliptic";Ye.RECTANGULAR_ANCHOR_KIND="rectangular";var Qp=class extends M1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultAnchorKind(){return Ye.RECTANGULAR_ANCHOR_KIND}get(e,t){return super.get(`${e}:${t||this.defaultAnchorKind}`)}};Qp=w1([(0,f0.injectable)(),I1(0,(0,f0.multiInject)(R1.TYPES.IAnchorComputer)),P1("design:paramtypes",[Array])],Qp);Ye.AnchorComputerRegistry=Qp});var Pa=f(Dt=>{"use strict";var g0=Dt&&Dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},O1=Dt&&Dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.AbstractEdgeRouter=Dt.DefaultAnchors=Dt.Side=void 0;var m0=_(),Fo=Q(),eg=He(),wt=ye(),h0=ii(),p0=ye(),ee;(function(i){i[i.RIGHT=0]="RIGHT",i[i.LEFT=1]="LEFT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM"})(ee=Dt.Side||(Dt.Side={}));var wa=class{constructor(e,t,n){this.element=e,this.kind=n;let r=e.bounds;this.bounds=(0,eg.translateBounds)(r,e.parent,t),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:n},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:n},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:n},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:n}}get(e){return this[ee[e].toLowerCase()]}getNearestSide(e){let t=Fo.Point.euclideanDistance(e,this.left),n=Fo.Point.euclideanDistance(e,this.right),r=Fo.Point.euclideanDistance(e,this.top),o=Fo.Point.euclideanDistance(e,this.bottom),s=ee.LEFT,a=t;return n<a&&(a=n,s=ee.RIGHT),r<a&&(a=r,s=ee.TOP),o<a&&(a=o,s=ee.BOTTOM),s}};Dt.DefaultAnchors=wa;var Nd=class{pointAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o,lambda:s}=n;return Fo.Point.linear(r,o,s)}derivativeAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o}=n;return{x:o.x-r.x,y:o.y-r.y}}calculateSegment(e,t){if(t<0||t>1)return;let n=this.route(e);if(n.length<2)return;let r=[],o=0;for(let c=0;c<n.length-1;++c)r[c]=Fo.Point.euclideanDistance(n[c],n[c+1]),o+=r[c];let s=0,a=t*o;for(let c=0;c<n.length-1;++c){let u=s+r[c];if(r[c]>1e-8&&u>=a){let d=Math.max(0,a-s)/r[c];return{segmentStart:n[c],segmentEnd:n[c+1],lambda:d}}s=u}return{segmentEnd:n.pop(),segmentStart:n.pop(),lambda:1}}addHandle(e,t,n,r){let o=new wt.SRoutingHandle;return o.kind=t,o.pointIndex=r,o.type=n,t==="target"&&e.id===wt.edgeInProgressID&&(o.id=wt.edgeInProgressTargetHandleID),e.add(o),o}getHandlePosition(e,t,n){switch(n.kind){case"source":return e.source instanceof wt.SDanglingAnchor?e.source.position:t[0];case"target":return e.target instanceof wt.SDanglingAnchor?e.target.position:t[t.length-1];default:let r=this.getInnerHandlePosition(e,t,n);if(r!==void 0)return r;if(n.pointIndex>=0&&n.pointIndex<e.routingPoints.length)return e.routingPoints[n.pointIndex]}}findRouteSegment(e,t,n){let r=a=>a.pointIndex!==void 0?a.pointIndex:a.kind==="target"?e.routingPoints.length:-2,o,s;for(let a of t){let c=r(a);c<=n&&(o===void 0||c>r(o))&&(o=a),c>n&&(s===void 0||c<r(s))&&(s=a)}return{start:o,end:s}}getTranslatedAnchor(e,t,n,r,o=0){let s=(0,eg.translatePoint)(t,n,e.parent),a=this.getAnchorComputer(e),c=.5*e.strokeWidth,u=a.getAnchor(e,s,o+c);return(0,eg.translatePoint)(u,e.parent,r.parent)}getAnchorComputer(e){return this.anchorRegistry.get(this.kind,e.anchorKind)}applyHandleMoves(e,t){let n=t.slice();t.forEach(r=>{let o=r.handle;if(o.kind==="source"&&!(e.source instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-source",s.original=e.source,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.sourceId=s.id}else if(o.kind==="target"&&!(e.target instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-target",s.original=e.target,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.targetId=s.id}o.danglingAnchor&&(o.danglingAnchor.position=r.toPosition,n.splice(n.indexOf(r),1))}),n.length>0&&this.applyInnerHandleMoves(e,n),this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)}cleanupRoutingPoints(e,t,n,r){let o=new wa(e.source,e.parent,"source"),s=new wa(e.target,e.parent,"target");this.resetRoutingPointsOnReconnect(e,t,n,o,s)}resetRoutingPointsOnReconnect(e,t,n,r,o){if(t.length===0||e.source instanceof wt.SDanglingAnchor||e.target instanceof wt.SDanglingAnchor){let s=this.getOptions(e),a=this.calculateDefaultCorners(e,r,o,s);if(t.splice(0,t.length,...a),n){let c=-2;e.children.forEach(u=>{u instanceof wt.SRoutingHandle&&(u.kind==="target"?u.pointIndex=t.length:u.kind==="line"&&u.pointIndex>=t.length?e.remove(u):c=Math.max(u.pointIndex,c))});for(let u=c;u<t.length-1;++u)this.addHandle(e,"manhattan-50%","volatile-routing-point",u)}return!0}return!1}applyReconnect(e,t,n){let r=!1;if(t){let o=e.root.index.getById(t);o instanceof p0.SConnectableElement&&(e.sourceId=o.id,r=!0)}if(n){let o=e.root.index.getById(n);o instanceof p0.SConnectableElement&&(e.targetId=o.id,r=!0)}r&&(e.index.remove(e),e.index.add(e),this.getSelfEdgeIndex(e)>-1&&(e.routingPoints=[],this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)))}takeSnapshot(e){return{routingPoints:e.routingPoints.slice(),routingHandles:e.children.filter(t=>t instanceof wt.SRoutingHandle).map(t=>t),routedPoints:this.route(e),router:this,source:e.source,target:e.target}}applySnapshot(e,t){e.routingPoints=t.routingPoints,e.removeAll(n=>n instanceof wt.SRoutingHandle),e.routerKind=t.router.kind,t.routingHandles.forEach(n=>e.add(n)),t.source&&(e.sourceId=t.source.id),t.target&&(e.targetId=t.target.id),e.root.index.remove(e),e.root.index.add(e)}calculateDefaultCorners(e,t,n,r){let o=this.getSelfEdgeIndex(e);if(o>=0){let s=r.standardDistance,a=r.selfEdgeOffset*Math.min(t.bounds.width,t.bounds.height);switch(o%4){case 0:return[{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y+a},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.BOTTOM).x+a,y:t.get(ee.BOTTOM).y+s}];case 1:return[{x:t.get(ee.BOTTOM).x-a,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y+a}];case 2:return[{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y-a},{x:t.get(ee.LEFT).x-s,y:t.get(ee.TOP).y-s},{x:t.get(ee.TOP).x-a,y:t.get(ee.TOP).y-s}];case 3:return[{x:t.get(ee.TOP).x+a,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y-a}]}}return[]}getSelfEdgeIndex(e){return!e.source||e.source!==e.target?-1:e.source.outgoingEdges.filter(t=>t.target===e.source).indexOf(e)}commitRoute(e,t){let n=[];for(let r=1;r<t.length-1;++r)n.push({x:t[r].x,y:t[r].y});e.routingPoints=n}};g0([(0,m0.inject)(h0.AnchorComputerRegistry),O1("design:type",h0.AnchorComputerRegistry)],Nd.prototype,"anchorRegistry",void 0);Nd=g0([(0,m0.injectable)()],Nd);Dt.AbstractEdgeRouter=Nd});var Ra=f(qi=>{"use strict";var v0=qi&&qi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},T1=qi&&qi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},tg;Object.defineProperty(qi,"__esModule",{value:!0});qi.PolylineEdgeRouter=void 0;var b0=_(),Vo=Q(),y0=ye(),_0=ii(),A1=Pa(),Ia=tg=class extends A1.AbstractEdgeRouter{get kind(){return tg.KIND}getOptions(e){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(e){let t=e.source,n=e.target;if(t===void 0||n===void 0)return[];let r,o,s=this.getOptions(e),a=e.routingPoints.length>0?e.routingPoints:[];this.cleanupRoutingPoints(e,a,!1,!1);let c=a!==void 0?a.length:0;if(c===0){let d=Vo.Bounds.center(n.bounds);r=this.getTranslatedAnchor(t,d,n.parent,e,e.sourceAnchorCorrection);let l=Vo.Bounds.center(t.bounds);o=this.getTranslatedAnchor(n,l,t.parent,e,e.targetAnchorCorrection)}else{let d=a[0];r=this.getTranslatedAnchor(t,d,e.parent,e,e.sourceAnchorCorrection);let l=a[c-1];o=this.getTranslatedAnchor(n,l,e.parent,e,e.targetAnchorCorrection)}let u=[];u.push({kind:"source",x:r.x,y:r.y});for(let d=0;d<c;d++){let l=a[d];(d>0&&d<c-1||d===0&&Vo.Point.maxDistance(r,l)>=s.minimalPointDistance+(e.sourceAnchorCorrection||0)||d===c-1&&Vo.Point.maxDistance(l,o)>=s.minimalPointDistance+(e.targetAnchorCorrection||0))&&u.push({kind:"linear",x:l.x,y:l.y,pointIndex:d})}return u.push({kind:"target",x:o.x,y:o.y}),this.filterEditModeHandles(u,e,s)}filterEditModeHandles(e,t,n){if(t.children.length===0)return e;let r=0;for(;r<e.length;){let o=e[r];if(o.pointIndex!==void 0){let s=t.children.find(a=>a instanceof y0.SRoutingHandle&&a.kind==="junction"&&a.pointIndex===o.pointIndex);if(s!==void 0&&s.editMode&&r>0&&r<e.length-1){let a=e[r-1],c=e[r+1],u={x:a.x-o.x,y:a.y-o.y},d={x:c.x-o.x,y:c.y-o.y},l=(0,Vo.angleBetweenPoints)(u,d);if(Math.abs(Math.PI-l)<n.removeAngleThreshold){e.splice(r,1);continue}}}r++}return e}createRoutingHandles(e){let t=e.routingPoints.length;this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"line","volatile-routing-point",-1);for(let n=0;n<t;n++)this.addHandle(e,"junction","routing-point",n),this.addHandle(e,"line","volatile-routing-point",n);this.addHandle(e,"target","routing-point",t)}getInnerHandlePosition(e,t,n){if(n.kind==="line"){let{start:r,end:o}=this.findRouteSegment(e,t,n.pointIndex);if(r!==void 0&&o!==void 0)return(0,Vo.centerOfLine)(r,o)}}applyInnerHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o=e.routingPoints,s=r.pointIndex;r.kind==="line"&&(r.kind="junction",r.type="routing-point",o.splice(s+1,0,n.fromPosition||o[Math.max(s,0)]),e.children.forEach(a=>{a instanceof y0.SRoutingHandle&&(a===r||a.pointIndex>s)&&a.pointIndex++}),this.addHandle(e,"line","volatile-routing-point",s),s++,this.addHandle(e,"line","volatile-routing-point",s)),s>=0&&s<o.length&&(o[s]=n.toPosition)})}};Ia.KIND="polyline";v0([(0,b0.inject)(_0.AnchorComputerRegistry),T1("design:type",_0.AnchorComputerRegistry)],Ia.prototype,"anchorRegistry",void 0);Ia=tg=v0([(0,b0.injectable)()],Ia);qi.PolylineEdgeRouter=Ia});var fn=f(tn=>{"use strict";var S0=tn&&tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},E0=tn&&tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},C1=tn&&tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.EdgeRouting=tn.EdgeRouterRegistry=void 0;var Ld=_(),x1=G(),w0=P(),D1=po(),q1=wn(),j1=ye(),N1=Ra();function L1(i){return i.routeAll!==void 0}var Bd=class extends q1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultKind(){return N1.PolylineEdgeRouter.KIND}get(e){return super.get(e||this.defaultKind)}routeAllChildren(e){let t=this.doRouteAllChildren(e);for(let n of this.postProcessors)n.apply(t);return t}doRouteAllChildren(e){let t=new Fd,n=new Map,r=[e];for(;r.length>0;){let o=r.shift();for(let s of o.children){if(s instanceof j1.SRoutableElement){let a=s.routerKind||this.defaultKind;n.has(a)?n.get(a).push(s):n.set(a,[s])}s instanceof x1.SParentElement&&r.push(s)}}return n.forEach((o,s)=>{let a=this.get(s);if(L1(a))t.setAll(a.routeAll(o,e));else for(let c of o)t.set(c.id,this.route(c))}),t}route(e,t){let n=(0,D1.findArgValue)(t,"edgeRouting");if(n){let o=n.get(e.id);if(o)return o}return this.get(e.routerKind).route(e)}};S0([(0,Ld.multiInject)(w0.TYPES.IEdgeRoutePostprocessor),(0,Ld.optional)(),E0("design:type",Array)],Bd.prototype,"postProcessors",void 0);Bd=S0([(0,Ld.injectable)(),C1(0,(0,Ld.multiInject)(w0.TYPES.IEdgeRouter)),E0("design:paramtypes",[Array])],Bd);tn.EdgeRouterRegistry=Bd;var Fd=class{constructor(){this.routesMap=new Map}set(e,t){this.routesMap.set(e,t)}setAll(e){e.routes.forEach((t,n)=>this.set(n,t))}get(e){return this.routesMap.get(e)}get routes(){return this.routesMap}};tn.EdgeRouting=Fd});var ng=f(ji=>{"use strict";var R0=ji&&ji.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},B1=ji&&ji.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(ji,"__esModule",{value:!0});ji.EdgeLayoutPostprocessor=void 0;var M0=_(),it=Q(),F1=G(),V1=Le(),K1=Ir(),Vd=ce(),P0=Lo(),I0=fn(),Kd=class{decorate(e,t){if((0,P0.isEdgeLayoutable)(t)&&t.parent instanceof K1.SEdge&&t.bounds!==it.Bounds.EMPTY){let n=this.getEdgePlacement(t),r=t.parent,o=Math.min(1,Math.max(0,n.position)),s=this.edgeRouterRegistry.get(r.routerKind),a=s.pointAt(r,o),c=s.derivativeAt(r,o),u="";if(a&&c){u+=`translate(${a.x}, ${a.y})`;let d=(0,it.toDegrees)(Math.atan2(c.y,c.x));if(n.rotate){let l=d;Math.abs(d)>90&&(d<0?l+=180:d>0&&(l-=180)),u+=` rotate(${l})`;let S=this.getRotatedAlignment(t,n,l!==d);u+=` translate(${S.x}, ${S.y})`}else{let l=this.getAlignment(t,n,d);u+=` translate(${l.x}, ${l.y})`}(0,V1.setAttr)(e,"transform",u)}}return e}getRotatedAlignment(e,t,n){let r=(0,Vd.isAlignable)(e)?e.alignment.x:0,o=(0,Vd.isAlignable)(e)?e.alignment.y:0,s=e.bounds;if(t.side==="on")return{x:r-.5*s.height,y:o-.5*s.height};if(n)switch(t.position<.3333333?r-=s.width+t.offset:t.position<.6666666?r-=.5*s.width:r+=t.offset,t.side){case"left":case"bottom":o-=t.offset+s.height;break;case"right":case"top":o+=t.offset}else switch(t.position<.3333333?r+=t.offset:t.position<.6666666?r-=.5*s.width:r-=s.width+t.offset,t.side){case"right":case"bottom":o+=-t.offset-s.height;break;case"left":case"top":o+=t.offset}return{x:r,y:o}}getEdgePlacement(e){let t=e,n=[];for(;t!==void 0;){let r=t.edgePlacement;if(r!==void 0&&n.push(r),t instanceof F1.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>Object.assign(Object.assign({},r),o),P0.DEFAULT_EDGE_PLACEMENT)}getAlignment(e,t,n){let r=e.bounds,o=(0,Vd.isAlignable)(e)?e.alignment.x-r.width:0,s=(0,Vd.isAlignable)(e)?e.alignment.y-r.height:0;if(t.side==="on")return{x:o+.5*r.height,y:s+.5*r.height};let a=this.getQuadrant(n),c={x:t.offset,y:s+.5*r.height},u={x:t.offset,y:s+r.height+t.offset},d={x:-r.width-t.offset,y:s+r.height+t.offset},l={x:-r.width-t.offset,y:s+.5*r.height},S={x:-r.width-t.offset,y:s-t.offset},R={x:t.offset,y:s-t.offset};switch(t.side){case"left":switch(a.orientation){case"west":return it.Point.linear(u,d,a.position);case"north":return it.Point.linear(d,S,a.position);case"east":return it.Point.linear(S,R,a.position);case"south":return it.Point.linear(R,u,a.position)}break;case"right":switch(a.orientation){case"west":return it.Point.linear(S,R,a.position);case"north":return it.Point.linear(R,u,a.position);case"east":return it.Point.linear(u,d,a.position);case"south":return it.Point.linear(d,S,a.position)}break;case"top":switch(a.orientation){case"west":return it.Point.linear(S,R,a.position);case"north":return this.linearFlip(R,c,l,S,a.position);case"east":return it.Point.linear(S,R,a.position);case"south":return this.linearFlip(R,c,l,S,a.position)}break;case"bottom":switch(a.orientation){case"west":return it.Point.linear(u,d,a.position);case"north":return this.linearFlip(d,l,c,u,a.position);case"east":return it.Point.linear(u,d,a.position);case"south":return this.linearFlip(d,l,c,u,a.position)}break}return{x:0,y:0}}getQuadrant(e){return Math.abs(e)>135?{orientation:"west",position:(e>0?e-135:e+225)/90}:e<-45?{orientation:"north",position:(e+135)/90}:e<45?{orientation:"east",position:(e+45)/90}:{orientation:"south",position:(e-45)/90}}linearFlip(e,t,n,r,o){return o<.5?it.Point.linear(e,t,2*o):it.Point.linear(n,r,2*o-1)}postUpdate(){}};R0([(0,M0.inject)(I0.EdgeRouterRegistry),B1("design:type",I0.EdgeRouterRegistry)],Kd.prototype,"edgeRouterRegistry",void 0);Kd=R0([(0,M0.injectable)()],Kd);ji.EdgeLayoutPostprocessor=Kd});var Hd=f(rg=>{"use strict";Object.defineProperty(rg,"__esModule",{value:!0});var H1=_(),O0=P(),ig=ng(),z1=new H1.ContainerModule(i=>{i(ig.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),i(O0.TYPES.IVNodePostprocessor).toService(ig.EdgeLayoutPostprocessor),i(O0.TYPES.HiddenVNodePostprocessor).toService(ig.EdgeLayoutPostprocessor)});rg.default=z1});var C0=f(qt=>{"use strict";var Y1=qt&&qt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},k1=qt&&qt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},U1=qt&&qt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(qt,"__esModule",{value:!0});qt.CreateElementCommand=qt.CreateElementAction=void 0;var T0=_(),G1=ge(),W1=G(),$1=P(),A0;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(A0=qt.CreateElementAction||(qt.CreateElementAction={}));var zd=class extends G1.Command{constructor(e){super(),this.action=e}execute(e){let t=e.root.index.getById(this.action.containerId);return t instanceof W1.SParentElement&&(this.container=t,this.newElement=e.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),e.root}undo(e){return this.container.remove(this.newElement),e.root}redo(e){return this.container.add(this.newElement),e.root}};zd.KIND=A0.KIND;zd=Y1([(0,T0.injectable)(),U1(0,(0,T0.inject)($1.TYPES.Action)),k1("design:paramtypes",[Object])],zd);qt.CreateElementCommand=zd});var og=f(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.isCreatingOnDrag=Rr.creatingOnDragFeature=void 0;Rr.creatingOnDragFeature=Symbol("creatingOnDragFeature");function X1(i){return i.hasFeature(Rr.creatingOnDragFeature)&&i.createAction!==void 0}Rr.isCreatingOnDrag=X1});var Or=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.intersection=M.PointToPointLine=M.Diamond=M.linear=M.almostEquals=M.toRadians=M.toDegrees=M.magnitude=M.normalize=M.shiftTowards=M.angleBetweenPoints=M.angleOfPoint=M.maxDistance=M.manhattanDistance=M.euclideanDistance=M.Direction=M.includes=M.centerOfLine=M.center=M.translate=M.combine=M.isBounds=M.EMPTY_BOUNDS=M.isValidDimension=M.EMPTY_DIMENSION=M.pointEquals=M.subtract=M.add=M.ORIGIN_POINT=void 0;M.ORIGIN_POINT=Object.freeze({x:0,y:0});function x0(i,e){return{x:i.x+e.x,y:i.y+e.y}}M.add=x0;function D0(i,e){return{x:i.x-e.x,y:i.y-e.y}}M.subtract=D0;function Ma(i,e){return i.x===e.x&&i.y===e.y}M.pointEquals=Ma;M.EMPTY_DIMENSION=Object.freeze({width:-1,height:-1});function Yd(i){return i.width>=0&&i.height>=0}M.isValidDimension=Yd;M.EMPTY_BOUNDS=Object.freeze({x:0,y:0,width:-1,height:-1});function J1(i){return"x"in i&&"y"in i&&"width"in i&&"height"in i}M.isBounds=J1;function Z1(i,e){if(!Yd(i))return Yd(e)?e:M.EMPTY_BOUNDS;if(!Yd(e))return i;let t=Math.min(i.x,e.x),n=Math.min(i.y,e.y),r=Math.max(i.x+(i.width>=0?i.width:0),e.x+(e.width>=0?e.width:0)),o=Math.max(i.y+(i.height>=0?i.height:0),e.y+(e.height>=0?e.height:0));return{x:t,y:n,width:r-t,height:o-n}}M.combine=Z1;function Q1(i,e){return{x:i.x+e.x,y:i.y+e.y,width:i.width,height:i.height}}M.translate=Q1;function ag(i){return{x:i.x+(i.width>=0?.5*i.width:0),y:i.y+(i.height>=0?.5*i.height:0)}}M.center=ag;function eD(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return ag(t)}M.centerOfLine=eD;function tD(i,e){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}M.includes=tD;var nD;(function(i){i[i.left=0]="left",i[i.right=1]="right",i[i.up=2]="up",i[i.down=3]="down"})(nD=M.Direction||(M.Direction={}));function iD(i,e){let t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}M.euclideanDistance=iD;function rD(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}M.manhattanDistance=rD;function oD(i,e){return Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y))}M.maxDistance=oD;function sD(i){return Math.atan2(i.y,i.x)}M.angleOfPoint=sD;function aD(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}M.angleBetweenPoints=aD;function cD(i,e,t){let n=D0(e,i),r=q0(n),o={x:r.x*t,y:r.y*t};return x0(i,o)}M.shiftTowards=cD;function q0(i){let e=j0(i);return e===0||e===1?M.ORIGIN_POINT:{x:i.x/e,y:i.y/e}}M.normalize=q0;function j0(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}M.magnitude=j0;function N0(i){return i*180/Math.PI}M.toDegrees=N0;function uD(i){return i*Math.PI/180}M.toRadians=uD;function dD(i,e){return Math.abs(i-e)<.001}M.almostEquals=dD;function lD(i,e,t){return{x:(1-t)*i.x+t*e.x,y:(1-t)*i.y+t*e.y}}M.linear=lD;var sg=class{constructor(e){this.bounds=e}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new Mr(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new Mr(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new Mr(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new Mr(this.bottomPoint,this.leftPoint)}closestSideLine(e){let t=ag(this.bounds);return e.x>t.x?e.y>t.y?this.bottomRightSideLine:this.topRightSideLine:e.y>t.y?this.bottomLeftSideLine:this.topLeftSideLine}};M.Diamond=sg;var Mr=class{constructor(e,t){this.p1=e,this.p2=t}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){let e=N0(this.angle),t=e<0?360+e:e;if(t===90)return"south";if(t===0||t===360)return"east";if(t===270)return"north";if(t===180)return"west";if(t>0&&t<90)return"south-east";if(t>90&&t<180)return"south-west";if(t>180&&t<270)return"north-west";if(t>270&&t<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(e){if(this.hasIndistinctPoints(e))return;let t=this.p1.x,n=this.p1.y,r=this.p2.x,o=this.p2.y,s=e.p1.x,a=e.p1.y,c=e.p2.x,u=e.p2.y,d=(u-a)*(r-t)-(c-s)*(o-n);if(d===0)return;let l=(c-s)*(n-a)-(u-a)*(t-s),S=(r-t)*(n-a)-(o-n)*(t-s);if(l===0&&S===0)return;let R=l/d,v=S/d;if(R<0||R>1||v<0||v>1)return;let m=t+R*(r-t),O=n+R*(o-n);return{x:m,y:O}}hasIndistinctPoints(e){return Ma(this.p1,e.p1)||Ma(this.p1,e.p2)||Ma(this.p2,e.p1)||Ma(this.p2,e.p2)}};M.PointToPointLine=Mr;function fD(i,e){return{x:(i.c*e.b-e.c*i.b)/(i.a*e.b-e.a*i.b),y:(i.a*e.c-e.a*i.c)/(i.a*e.b-e.a*i.b)}}M.intersection=fD});var pg=f(Pt=>{"use strict";var Oa=Pt&&Pt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.EmptyGroupView=Pt.DiamondNodeView=Pt.RectangularNodeView=Pt.CircularNodeView=Pt.SvgViewportView=void 0;var ri=Gt(),Ko=Ir(),hg=ha(),hD=Or(),Ta=_(),cg=class{render(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,ri.svg)("svg",null,(0,ri.svg)("g",{transform:r},t.renderChildren(e)))}};cg=Oa([(0,Ta.injectable)()],cg);Pt.SvgViewportView=cg;var ug=class extends hg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=this.getRadius(e);return(0,ri.svg)("g",null,(0,ri.svg)("circle",{"class-sprotty-node":e instanceof Ko.SNode,"class-sprotty-port":e instanceof Ko.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r,cx:r,cy:r}),t.renderChildren(e))}getRadius(e){let t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};ug=Oa([(0,Ta.injectable)()],ug);Pt.CircularNodeView=ug;var dg=class extends hg.ShapeView{render(e,t,n){if(this.isVisible(e,t))return(0,ri.svg)("g",null,(0,ri.svg)("rect",{"class-sprotty-node":e instanceof Ko.SNode,"class-sprotty-port":e instanceof Ko.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};dg=Oa([(0,Ta.injectable)()],dg);Pt.RectangularNodeView=dg;var lg=class extends hg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=new hD.Diamond({height:Math.max(e.size.height,0),width:Math.max(e.size.width,0),x:0,y:0}),o=`${kd(r.topPoint)} ${kd(r.rightPoint)} ${kd(r.bottomPoint)} ${kd(r.leftPoint)}`;return(0,ri.svg)("g",null,(0,ri.svg)("polygon",{"class-sprotty-node":e instanceof Ko.SNode,"class-sprotty-port":e instanceof Ko.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,points:o}),t.renderChildren(e))}};lg=Oa([(0,Ta.injectable)()],lg);Pt.DiamondNodeView=lg;function kd(i){return`${i.x},${i.y}`}var fg=class{render(e,t){return(0,ri.svg)("g",null)}};fg=Oa([(0,Ta.injectable)()],fg);Pt.EmptyGroupView=fg});var Wd=f(ie=>{"use strict";var pD=ie&&ie.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gD=ie&&ie.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},mD=ie&&ie.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ie,"__esModule",{value:!0});ie.getEditableLabel=ie.EditLabelKeyListener=ie.EditLabelMouseListener=ie.ApplyLabelEditCommand=ie.ResolvedLabelEdit=ie.isApplyLabelEditAction=ie.ApplyLabelEditAction=ie.isEditLabelAction=ie.EditLabelAction=void 0;var yD=_(),L0=te(),_D=ge(),vD=P(),bD=Tt(),SD=an(),ED=Rn(),wD=Et(),PD=rr(),gg=Bo(),Gd;(function(i){i.KIND="EditLabel";function e(t){return{kind:i.KIND,labelId:t}}i.create=e})(Gd=ie.EditLabelAction||(ie.EditLabelAction={}));function ID(i){return(0,L0.isAction)(i)&&i.kind===Gd.KIND&&"labelId"in i}ie.isEditLabelAction=ID;var vg;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(vg=ie.ApplyLabelEditAction||(ie.ApplyLabelEditAction={}));function RD(i){return(0,L0.isAction)(i)&&i.kind===vg.KIND&&"labelId"in i&&"text"in i}ie.isApplyLabelEditAction=RD;var mg=class{};ie.ResolvedLabelEdit=mg;var Ud=class extends _D.Command{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.labelId);return n&&(0,gg.isEditableLabel)(n)&&(this.resolvedLabelEdit={label:n,oldLabel:n.text,newLabel:this.action.text},n.text=this.action.text),e.root}undo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),e.root}redo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),e.root}};Ud.KIND=vg.KIND;Ud=pD([mD(0,(0,yD.inject)(vD.TYPES.Action)),gD("design:paramtypes",[Object])],Ud);ie.ApplyLabelEditCommand=Ud;var yg=class extends bD.MouseListener{doubleClick(e,t){let n=bg(e);return n?[Gd.create(n.id)]:[]}};ie.EditLabelMouseListener=yg;var _g=class extends SD.KeyListener{keyDown(e,t){if((0,ED.matchesKeystroke)(t,"F2")){let n=(0,PD.toArray)(e.index.all().filter(r=>(0,wD.isSelectable)(r)&&r.selected)).map(bg).filter(r=>r!==void 0);if(n.length===1)return[Gd.create(n[0].id)]}return[]}};ie.EditLabelKeyListener=_g;function bg(i){if((0,gg.isEditableLabel)(i))return i;if((0,gg.isWithEditableLabel)(i)&&i.editableLabel)return i.editableLabel}ie.getEditableLabel=bg});var Tr=f(hn=>{"use strict";var $d=hn&&hn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Sg=hn&&hn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(hn,"__esModule",{value:!0});hn.SvgExporter=hn.ExportSvgAction=void 0;var Xd=_(),B0=Q(),MD=ce(),OD=lu(),Eg=P(),F0;(function(i){i.KIND="exportSvg";function e(t,n){return{kind:i.KIND,svg:t,responseId:n}}i.create=e})(F0=hn.ExportSvgAction||(hn.ExportSvgAction={}));var Ho=class{export(e,t){if(typeof document<"u"){let n=document.getElementById(this.options.hiddenDiv);if(n!==null&&n.firstElementChild&&n.firstElementChild.tagName==="svg"){let r=n.firstElementChild,o=this.createSvg(r,e);this.actionDispatcher.dispatch(F0.create(o,t?t.requestId:""))}}}createSvg(e,t){let n=new XMLSerializer,r=n.serializeToString(e),o=document.createElement("iframe");if(document.body.appendChild(o),!o.contentWindow)throw new Error("IFrame has no contentWindow");let s=o.contentWindow.document;s.open(),s.write(r),s.close();let a=s.getElementById(e.id);a.removeAttribute("opacity"),this.copyStyles(e,a,["width","height","opacity"]),a.setAttribute("version","1.1");let c=this.getBounds(t);a.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`);let u=n.serializeToString(a);return document.body.removeChild(o),u}copyStyles(e,t,n){let r=getComputedStyle(e),o=getComputedStyle(t),s="";for(let a=0;a<r.length;a++){let c=r[a];if(n.indexOf(c)===-1){let u=r.getPropertyValue(c);o.getPropertyValue(c)!==u&&(s+=c+":"+u+";")}}s!==""&&t.setAttribute("style",s);for(let a=0;a<e.childNodes.length;++a){let c=e.childNodes[a],u=t.childNodes[a];c instanceof Element&&this.copyStyles(c,u,[])}}getBounds(e){let t=[B0.Bounds.EMPTY];return e.children.forEach(n=>{(0,MD.isBoundsAware)(n)&&t.push(n.bounds)}),t.reduce((n,r)=>B0.Bounds.combine(n,r))}};$d([(0,Xd.inject)(Eg.TYPES.ViewerOptions),Sg("design:type",Object)],Ho.prototype,"options",void 0);$d([(0,Xd.inject)(Eg.TYPES.IActionDispatcher),Sg("design:type",OD.ActionDispatcher)],Ho.prototype,"actionDispatcher",void 0);$d([(0,Xd.inject)(Eg.TYPES.ILogger),Sg("design:type",Object)],Ho.prototype,"log",void 0);Ho=$d([(0,Xd.injectable)()],Ho);hn.SvgExporter=Ho});var zo=f(xn=>{"use strict";var Jd=xn&&xn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},V0=xn&&xn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xn,"__esModule",{value:!0});xn.ComputedBoundsApplicator=xn.ModelSource=void 0;var Zd=_(),TD=te(),AD=wi(),K0=P(),CD=Tr(),Aa=class{initialize(e){e.register(TD.RequestModelAction.KIND,this),e.register(CD.ExportSvgAction.KIND,this)}};Jd([(0,Zd.inject)(K0.TYPES.IActionDispatcher),V0("design:type",Object)],Aa.prototype,"actionDispatcher",void 0);Jd([(0,Zd.inject)(K0.TYPES.ViewerOptions),V0("design:type",Object)],Aa.prototype,"viewerOptions",void 0);Aa=Jd([(0,Zd.injectable)()],Aa);xn.ModelSource=Aa;var wg=class{apply(e,t){let n=new AD.SModelIndex;n.add(e);for(let r of t.bounds){let o=n.getById(r.elementId);o!==void 0&&this.applyBounds(o,r.newPosition,r.newSize)}if(t.alignments!==void 0)for(let r of t.alignments){let o=n.getById(r.elementId);o!==void 0&&this.applyAlignment(o,r.newAlignment)}return n}applyAlignment(e,t){let n=e;n.alignment={x:t.x,y:t.y}}applyBounds(e,t,n){let r=e;t&&(r.position=Object.assign({},t)),r.size=Object.assign({},n)}};wg=Jd([(0,Zd.injectable)()],wg);xn.ComputedBoundsApplicator=wg});var xa=f(jt=>{"use strict";var H0=jt&&jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},z0=jt&&jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},xD=jt&&jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.CommitModelCommand=jt.CommitModelAction=void 0;var Pg=_(),DD=ge(),Y0=P(),qD=zo(),k0;(function(i){i.KIND="commitModel";function e(){return{kind:i.KIND}}i.create=e})(k0=jt.CommitModelAction||(jt.CommitModelAction={}));var Ca=class extends DD.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newModel=e.modelFactory.createSchema(e.root),this.doCommit(this.newModel,e.root,!0)}doCommit(e,t,n){let r=this.modelSource.commitModel(e);return r instanceof Promise?r.then(o=>(n&&(this.originalModel=o),t)):(n&&(this.originalModel=r),t)}undo(e){return this.doCommit(this.originalModel,e.root,!1)}redo(e){return this.doCommit(this.newModel,e.root,!1)}};Ca.KIND=k0.KIND;H0([(0,Pg.inject)(Y0.TYPES.ModelSource),z0("design:type",qD.ModelSource)],Ca.prototype,"modelSource",void 0);Ca=H0([(0,Pg.injectable)(),xD(0,(0,Pg.inject)(Y0.TYPES.Action)),z0("design:paramtypes",[Object])],Ca);jt.CommitModelCommand=Ca});var Qd=f(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.ZoomMouseListener=Ni.getZoom=Ni.isZoomable=void 0;var jD=te(),ND=In(),LD=Tt(),U0=He(),G0=An();function BD(i){return"zoom"in i}Ni.isZoomable=BD;function FD(i){let e=1,t=(0,U0.findParentByFeature)(i,G0.isViewport);return t&&(e=t.zoom),e}Ni.getZoom=FD;var Ig=class extends LD.MouseListener{wheel(e,t){let n=(0,U0.findParentByFeature)(e,G0.isViewport);if(n){let r=this.getZoomFactor(t),o=this.getViewportOffset(e.root,t),s=1/(r*n.zoom)-1/n.zoom,a={scroll:{x:n.scroll.x-s*o.x,y:n.scroll.y-s*o.y},zoom:n.zoom*r};return[jD.SetViewportAction.create(n.id,a,{animate:!1})]}return[]}getViewportOffset(e,t){let n=e.canvasBounds,r=(0,ND.getWindowScroll)();return{x:t.clientX+r.x-n.x,y:t.clientY+r.y-n.y}}getZoomFactor(e){return e.deltaMode===e.DOM_DELTA_PAGE?Math.exp(-e.deltaY*.5):e.deltaMode===e.DOM_DELTA_LINE?Math.exp(-e.deltaY*.05):Math.exp(-e.deltaY*.005)}};Ni.ZoomMouseListener=Ig});var Og=f(qn=>{"use strict";var Ar=qn&&qn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Da=qn&&qn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Rg;Object.defineProperty(qn,"__esModule",{value:!0});qn.EditLabelUI=qn.EditLabelActionHandler=void 0;var oi=_(),VD=te(),qa=P(),KD=qu(),HD=Xs(),zD=uo(),YD=xa(),W0=Rn(),kD=ce(),$0=Qd(),UD=Wd(),GD=Bo(),Mg=class{handle(e){if((0,UD.isEditLabelAction)(e))return HD.SetUIExtensionVisibilityAction.create({extensionId:Dn.ID,visible:!0,contextElementsId:[e.labelId]})}};Mg=Ar([(0,oi.injectable)()],Mg);qn.EditLabelActionHandler=Mg;var Dn=Rg=class extends KD.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return Rg.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(t=>{t.onkeydown=n=>this.applyLabelEditOnEvent(n,"Enter"),this.configureAndAdd(t,e)})}configureAndAdd(e,t){e.style.visibility="hidden",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.addEventListener("keydown",n=>this.hideIfEscapeEvent(n)),e.addEventListener("keyup",n=>this.validateLabelIfContentChange(n,e.value)),e.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),t.appendChild(e)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(e){(0,W0.matchesKeystroke)(e,"Escape")&&this.hide()}applyLabelEditOnEvent(e,t,...n){(0,W0.matchesKeystroke)(e,t||"Enter",...n)&&(e.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(e,t){(this.previousLabelContent===void 0||this.previousLabelContent!==t)&&(this.previousLabelContent=t,this.performLabelValidation(e,this.editControl.value))}async applyLabelEdit(){var e;if(this.isActive){if(((e=this.label)===null||e===void 0?void 0:e.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(t=>t.dispatchAll([VD.ApplyLabelEditAction.create(this.labelId,this.editControl.value),YD.CommitModelAction.create()])).catch(t=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",t)),this.hide()}}performLabelValidation(e,t){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(t),200)}async validateLabel(e){if(this.labelValidator&&this.label)try{let t=await this.labelValidator.validate(e,this.label);return this.isCurrentLabelValid=t.severity!=="error",this.showValidationResult(t),t}catch(t){this.logger.error(this,"Error validating edited label",t)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(e){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,e)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(e,...t){!WD(t,e)||this.isActive||(super.show(e,...t),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(e,t,...n){this.label=X0(n,t)[0],this.previousLabelContent=this.label.text,this.setPosition(e),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(e){let t=0,n=0,r=100,o=20;if(this.label){let s=(0,$0.getZoom)(this.label),a=(0,kD.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);t=a.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*s,n=a.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*s,o=(this.label.editControlDimension?this.label.editControlDimension.height:o)*s,r=(this.label.editControlDimension?this.label.editControlDimension.width:r)*s}e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=`${r}px`,this.editControl.style.width=`${r}px`,e.style.height=`${o}px`,this.editControl.style.height=`${o}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";let e=window.getComputedStyle(this.labelElement);this.editControl.style.font=e.font,this.editControl.style.fontStyle=e.fontStyle,this.editControl.style.fontFamily=e.fontFamily,this.editControl.style.fontSize=$D(e.fontSize,(0,$0.getZoom)(this.label)),this.editControl.style.fontWeight=e.fontWeight,this.editControl.style.lineHeight=e.lineHeight}}};Dn.ID="editLabelUi";Ar([(0,oi.inject)(qa.TYPES.IActionDispatcherProvider),Da("design:type",Function)],Dn.prototype,"actionDispatcherProvider",void 0);Ar([(0,oi.inject)(qa.TYPES.ViewerOptions),Da("design:type",Object)],Dn.prototype,"viewerOptions",void 0);Ar([(0,oi.inject)(qa.TYPES.DOMHelper),Da("design:type",zD.DOMHelper)],Dn.prototype,"domHelper",void 0);Ar([(0,oi.inject)(qa.TYPES.IEditLabelValidator),(0,oi.optional)(),Da("design:type",Object)],Dn.prototype,"labelValidator",void 0);Ar([(0,oi.inject)(qa.TYPES.IEditLabelValidationDecorator),(0,oi.optional)(),Da("design:type",Object)],Dn.prototype,"validationDecorator",void 0);Dn=Rg=Ar([(0,oi.injectable)()],Dn);qn.EditLabelUI=Dn;function WD(i,e){return X0(i,e).length===1}function X0(i,e){return i.map(t=>e.index.getById(t)).filter(GD.isEditableLabel)}function $D(i,e){return i.replace(/([0-9]+)/,t=>String(Number.parseInt(t,10)*e))}});var Na=f(Nt=>{"use strict";var Q0=Nt&&Nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},eE=Nt&&Nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},XD=Nt&&Nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.SwitchEditModeCommand=Nt.SwitchEditModeAction=void 0;var Tg=_(),JD=ge(),ZD=G(),QD=P(),pn=ye(),J0=fn(),Z0=Bo(),tE;(function(i){i.KIND="switchEditMode";function e(t){var n,r;return{kind:i.KIND,elementsToActivate:(n=t.elementsToActivate)!==null&&n!==void 0?n:[],elementsToDeactivate:(r=t.elementsToDeactivate)!==null&&r!==void 0?r:[]}}i.create=e})(tE=Nt.SwitchEditModeAction||(Nt.SwitchEditModeAction={}));var ja=class extends JD.Command{constructor(e){super(),this.action=e,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(e){let t=e.root.index;return this.action.elementsToActivate.forEach(n=>{let r=t.getById(n);r!==void 0&&this.elementsToActivate.push(r)}),this.action.elementsToDeactivate.forEach(n=>{let r=t.getById(n);if(r!==void 0&&this.elementsToDeactivate.push(r),r instanceof pn.SRoutingHandle&&r.parent instanceof pn.SRoutableElement){let o=r.parent;this.shouldRemoveHandle(r,o)&&(this.handlesToRemove.push({handle:r,parent:o}),this.elementsToDeactivate.push(o),this.elementsToActivate.push(o))}}),this.doExecute(e)}doExecute(e){return this.handlesToRemove.forEach(t=>{t.point=t.parent.routingPoints.splice(t.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(t=>{t instanceof pn.SRoutableElement?t.removeAll(n=>n instanceof pn.SRoutingHandle):t instanceof pn.SRoutingHandle&&(t.editMode=!1,t.danglingAnchor&&t.parent instanceof pn.SRoutableElement&&t.danglingAnchor.original&&(t.parent.source===t.danglingAnchor?t.parent.sourceId=t.danglingAnchor.original.id:t.parent.target===t.danglingAnchor&&(t.parent.targetId=t.danglingAnchor.original.id),t.danglingAnchor.parent.remove(t.danglingAnchor),t.danglingAnchor=void 0))}),this.elementsToActivate.forEach(t=>{(0,Z0.canEditRouting)(t)&&t instanceof ZD.SParentElement?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof pn.SRoutingHandle&&(t.editMode=!0)}),e.root}shouldRemoveHandle(e,t){return e.kind==="junction"?this.edgeRouterRegistry.route(t).find(r=>r.pointIndex===e.pointIndex)===void 0:!1}undo(e){return this.handlesToRemove.forEach(t=>{t.point!==void 0&&t.parent.routingPoints.splice(t.handle.pointIndex,0,t.point)}),this.elementsToActivate.forEach(t=>{t instanceof pn.SRoutableElement?t.removeAll(n=>n instanceof pn.SRoutingHandle):t instanceof pn.SRoutingHandle&&(t.editMode=!1)}),this.elementsToDeactivate.forEach(t=>{(0,Z0.canEditRouting)(t)?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof pn.SRoutingHandle&&(t.editMode=!0)}),e.root}redo(e){return this.doExecute(e)}};ja.KIND=tE.KIND;Q0([(0,Tg.inject)(J0.EdgeRouterRegistry),eE("design:type",J0.EdgeRouterRegistry)],ja.prototype,"edgeRouterRegistry",void 0);ja=Q0([(0,Tg.injectable)(),XD(0,(0,Tg.inject)(QD.TYPES.Action)),eE("design:paramtypes",[Object])],ja);Nt.SwitchEditModeCommand=ja});var el=f(Lt=>{"use strict";var iE=Lt&&Lt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},rE=Lt&&Lt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},eq=Lt&&Lt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.ReconnectCommand=Lt.ReconnectAction=void 0;var Ag=_(),tq=ge(),nq=P(),iq=ye(),nE=fn(),oE;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(oE=Lt.ReconnectAction||(Lt.ReconnectAction={}));var La=class extends tq.Command{constructor(e){super(),this.action=e}execute(e){return this.doExecute(e),e.root}doExecute(e){let n=e.root.index.getById(this.action.routableId);if(n instanceof iq.SRoutableElement){let r=this.edgeRouterRegistry.get(n.routerKind),o=r.takeSnapshot(n);r.applyReconnect(n,this.action.newSourceId,this.action.newTargetId);let s=r.takeSnapshot(n);this.memento={edge:n,before:o,after:s}}}undo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),e.root}redo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),e.root}};La.KIND=oE.KIND;iE([(0,Ag.inject)(nE.EdgeRouterRegistry),rE("design:type",nE.EdgeRouterRegistry)],La.prototype,"edgeRouterRegistry",void 0);La=iE([(0,Ag.injectable)(),eq(0,(0,Ag.inject)(nq.TYPES.Action)),rE("design:paramtypes",[Object])],La);Lt.ReconnectCommand=La});var qg=f(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.labelEditUiModule=Li.labelEditModule=Li.edgeEditModule=void 0;var Dg=_(),xg=P(),tl=yt(),rq=Hs(),oq=po(),sq=ye(),aq=pg(),cq=jo(),Yo=Wd(),Cg=Og(),uq=Na(),dq=el();Li.edgeEditModule=new Dg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,tl.configureCommand)(n,uq.SwitchEditModeCommand),(0,tl.configureCommand)(n,dq.ReconnectCommand),(0,tl.configureCommand)(n,cq.DeleteElementCommand),(0,oq.configureModelElement)(n,"dangling-anchor",sq.SDanglingAnchor,aq.EmptyGroupView)});Li.labelEditModule=new Dg.ContainerModule((i,e,t)=>{i(Yo.EditLabelMouseListener).toSelf().inSingletonScope(),i(xg.TYPES.MouseListener).toService(Yo.EditLabelMouseListener),i(Yo.EditLabelKeyListener).toSelf().inSingletonScope(),i(xg.TYPES.KeyListener).toService(Yo.EditLabelKeyListener),(0,tl.configureCommand)({bind:i,isBound:t},Yo.ApplyLabelEditCommand)});Li.labelEditUiModule=new Dg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,rq.configureActionHandler)(n,Yo.EditLabelAction.KIND,Cg.EditLabelActionHandler),i(Cg.EditLabelUI).toSelf().inSingletonScope(),i(xg.TYPES.IUIExtension).toService(Cg.EditLabelUI)})});var nl=f(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.isExpandable=Cr.expandFeature=void 0;Cr.expandFeature=Symbol("expandFeature");function lq(i){return i.hasFeature(Cr.expandFeature)&&"expanded"in i}Cr.isExpandable=lq});var jg=f(jn=>{"use strict";var fq=jn&&jn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(jn,"__esModule",{value:!0});jn.ExpandButtonHandler=jn.CollapseExpandAllAction=jn.CollapseExpandAction=void 0;var hq=_(),pq=te(),gq=He(),mq=nl(),ko=class{constructor(e,t){this.expandIds=e,this.collapseIds=t,this.kind=ko.KIND}};jn.CollapseExpandAction=ko;ko.KIND="collapseExpand";var Uo=class{constructor(e=!0){this.expand=e,this.kind=Uo.KIND}};jn.CollapseExpandAllAction=Uo;Uo.KIND="collapseExpandAll";var il=class{buttonPressed(e){let t=(0,gq.findParentByFeature)(e,mq.isExpandable);return t!==void 0?[pq.CollapseExpandAction.create({expandIds:t.expanded?[]:[t.id],collapseIds:t.expanded?[t.id]:[]})]:[]}};il.TYPE="button:expand";il=fq([(0,hq.injectable)()],il);jn.ExpandButtonHandler=il});var sE=f(Go=>{"use strict";var yq=Go&&Go.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Go,"__esModule",{value:!0});Go.ExpandButtonView=void 0;var Ng=Gt(),_q=nl(),vq=He(),bq=_(),Lg=class{render(e,t){let n=(0,vq.findParentByFeature)(e,_q.isExpandable),r=n!==void 0&&n.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,Ng.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,Ng.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,Ng.svg)("path",{d:r}))}};Lg=yq([(0,bq.injectable)()],Lg);Go.ExpandButtonView=Lg});var Fg=f(ke=>{"use strict";var sl=ke&&ke.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cE=ke&&ke.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Sq=ke&&ke.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ke,"__esModule",{value:!0});ke.ExportSvgPostprocessor=ke.ExportSvgCommand=ke.RequestExportSvgAction=ke.ExportSvgKeyListener=void 0;var al=_(),Eq=te(),wq=ge(),Pq=Et(),Iq=G(),Rq=an(),Mq=Rn(),aE=Od(),Oq=Tr(),Tq=An(),Aq=Er(),uE=P(),Bg=class extends Rq.KeyListener{keyDown(e,t){return(0,Mq.matchesKeystroke)(t,"KeyE","ctrlCmd","shift")?[cl.create()]:[]}};Bg=sl([(0,al.injectable)()],Bg);ke.ExportSvgKeyListener=Bg;var cl;(function(i){i.KIND="requestExportSvg";function e(){return{kind:i.KIND,requestId:(0,Eq.generateRequestId)()}}i.create=e})(cl=ke.RequestExportSvgAction||(ke.RequestExportSvgAction={}));var rl=class extends wq.HiddenCommand{constructor(e){super(),this.action=e}execute(e){if((0,aE.isExportable)(e.root)){let t=e.modelFactory.createRoot(e.root);if((0,aE.isExportable)(t))return(0,Tq.isViewport)(t)&&(t.zoom=1,t.scroll={x:0,y:0}),t.index.all().forEach(n=>{(0,Pq.isSelectable)(n)&&n.selected&&(n.selected=!1),(0,Aq.isHoverable)(n)&&n.hoverFeedback&&(n.hoverFeedback=!1)}),{model:t,modelChanged:!0,cause:this.action}}return{model:e.root,modelChanged:!1}}};rl.KIND=cl.KIND;rl=sl([Sq(0,(0,al.inject)(uE.TYPES.Action)),cE("design:paramtypes",[Object])],rl);ke.ExportSvgCommand=rl;var ol=class{decorate(e,t){return t instanceof Iq.SModelRoot&&(this.root=t),e}postUpdate(e){this.root&&e!==void 0&&e.kind===cl.KIND&&this.svgExporter.export(this.root,e)}};sl([(0,al.inject)(uE.TYPES.SvgExporter),cE("design:type",Oq.SvgExporter)],ol.prototype,"svgExporter",void 0);ol=sl([(0,al.injectable)()],ol);ke.ExportSvgPostprocessor=ol});var ul=f(Bi=>{"use strict";var Cq=Bi&&Bi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.ElementFader=Bi.FadeAnimation=void 0;var xq=_(),Dq=cr(),qq=G(),jq=Le(),Nq=xo(),Vg=class extends Dq.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementFades=t,this.removeAfterFadeOut=r}tween(e,t){for(let n of this.elementFades){let r=n.element;n.type==="in"?r.opacity=e:n.type==="out"&&(r.opacity=1-e,e===1&&this.removeAfterFadeOut&&r instanceof qq.SChildElement&&r.parent.remove(r))}return this.model}};Bi.FadeAnimation=Vg;var Kg=class{decorate(e,t){return(0,Nq.isFadeable)(t)&&t.opacity!==1&&(0,jq.setAttr)(e,"opacity",t.opacity),e}postUpdate(){}};Kg=Cq([(0,xq.injectable)()],Kg);Bi.ElementFader=Kg});var kg=f(ne=>{"use strict";var Vi=ne&&ne.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Va=ne&&ne.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},lE=ne&&ne.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ne,"__esModule",{value:!0});ne.ClosePopupActionHandler=ne.HoverKeyListener=ne.PopupHoverMouseListener=ne.HoverMouseListener=ne.AbstractHoverMouseListener=ne.SetPopupModelCommand=ne.SetPopupModelAction=ne.RequestPopupModelAction=ne.HoverFeedbackCommand=ne.HoverFeedbackAction=void 0;var Nn=_(),fE=te(),Lq=Q(),Bq=Rn(),Ka=P(),dE=G(),Fq=Tt(),hE=ge(),xr=Pn(),Vq=an(),Ba=He(),Kq=ce(),Wo=Er(),$o;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})($o=ne.HoverFeedbackAction||(ne.HoverFeedbackAction={}));var dl=class extends hE.SystemCommand{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.mouseoverElement);return n&&(0,Wo.isHoverable)(n)&&(n.hoverFeedback=this.action.mouseIsOver),this.redo(e)}undo(e){return e.root}redo(e){return e.root}};dl.KIND=$o.KIND;dl=Vi([(0,Nn.injectable)(),lE(0,(0,Nn.inject)(Ka.TYPES.Action)),Va("design:paramtypes",[Object])],dl);ne.HoverFeedbackCommand=dl;var Fi=class{constructor(e,t,n=""){this.elementId=e,this.bounds=t,this.requestId=n,this.kind=Fi.KIND}static create(e,t){return new Fi(e,t,(0,fE.generateRequestId)())}};ne.RequestPopupModelAction=Fi;Fi.KIND="requestPopupModel";var si=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=si.KIND}};ne.SetPopupModelAction=si;si.KIND="setPopupModel";var Fa=class extends hE.PopupCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.root,this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}};Fa.KIND=fE.SetPopupModelAction.KIND;Fa=Vi([(0,Nn.injectable)(),lE(0,(0,Nn.inject)(Ka.TYPES.Action)),Va("design:paramtypes",[Object])],Fa);ne.SetPopupModelCommand=Fa;var Dr=class extends Fq.MouseListener{mouseDown(e,t){return this.mouseIsDown=!0,[]}mouseUp(e,t){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(e=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,e(new si({type:xr.EMPTY_ROOT.type,id:xr.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}};Vi([(0,Nn.inject)(Ka.TYPES.ViewerOptions),Va("design:type",Object)],Dr.prototype,"options",void 0);Vi([(0,Nn.inject)(Ka.TYPES.HoverState),Va("design:type",Object)],Dr.prototype,"state",void 0);ne.AbstractHoverMouseListener=Dr;var ll=class extends Dr{computePopupBounds(e,t){let n={x:-5,y:20},r=(0,Kq.getAbsoluteBounds)(e),o=e.root.canvasBounds,s=Lq.Bounds.translate(r,o),a=s.x+s.width-t.x,c=s.y+s.height-t.y;c<=a&&this.allowSidePosition(e,"below",c)?n={x:-5,y:Math.round(c+5)}:a<=c&&this.allowSidePosition(e,"right",a)&&(n={x:Math.round(a+5),y:-5});let u=t.x+n.x,d=o.x+o.width;u>d&&(u=d);let l=t.y+n.y,S=o.y+o.height;return l>S&&(l=S),{x:u,y:l,width:-1,height:-1}}allowSidePosition(e,t,n){return!(e instanceof dE.SModelRoot)&&n<=150}startMouseOverTimer(e,t){return this.stopMouseOverTimer(),new Promise(n=>{this.state.mouseOverTimer=window.setTimeout(()=>{let r=this.computePopupBounds(e,{x:t.pageX,y:t.pageY});n(new Fi(e.id,r)),this.state.popupOpen=!0,this.state.previousPopupElement=e},this.options.popupOpenDelay)})}mouseOver(e,t){let n=[];if(!this.mouseIsDown){let r=(0,Ba.findParent)(e,Wo.hasPopupFeature);this.state.popupOpen&&(r===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==r.id)?n.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t)),this.lastHoverFeedbackElementId&&(n.push($o.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);let o=(0,Ba.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push($o.create({mouseoverElement:o.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=o.id)}return n}mouseOut(e,t){let n=[];if(!this.mouseIsDown){let r=this.getElementFromEventPosition(t);if(!this.isSprottyPopup(r)){if(this.state.popupOpen){let s=(0,Ba.findParent)(e,Wo.hasPopupFeature);this.state.previousPopupElement!==void 0&&s!==void 0&&this.state.previousPopupElement.id===s.id&&n.push(this.startMouseOutTimer())}this.stopMouseOverTimer();let o=(0,Ba.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push($o.create({mouseoverElement:o.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==o.id&&n.push($o.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return n}getElementFromEventPosition(e){return document.elementFromPoint(e.x,e.y)}isSprottyPopup(e){return e?e.id===this.options.popupDiv||!!e.parentElement&&this.isSprottyPopup(e.parentElement):!1}mouseMove(e,t){let n=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,t)&&n.push(this.startMouseOutTimer());let r=(0,Ba.findParent)(e,Wo.hasPopupFeature);r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t))}return n}closeOnMouseMove(e,t){return e instanceof dE.SModelRoot}};Vi([(0,Nn.inject)(Ka.TYPES.ViewerOptions),Va("design:type",Object)],ll.prototype,"options",void 0);ll=Vi([(0,Nn.injectable)()],ll);ne.HoverMouseListener=ll;var Hg=class extends Dr{mouseOut(e,t){return[this.startMouseOutTimer()]}mouseOver(e,t){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};Hg=Vi([(0,Nn.injectable)()],Hg);ne.PopupHoverMouseListener=Hg;var zg=class extends Vq.KeyListener{keyDown(e,t){return(0,Bq.matchesKeystroke)(t,"Escape")?[new si({type:xr.EMPTY_ROOT.type,id:xr.EMPTY_ROOT.id})]:[]}};ne.HoverKeyListener=zg;var Yg=class{constructor(){this.popupOpen=!1}handle(e){if(e.kind===Fa.KIND)this.popupOpen=e.newRoot.type!==xr.EMPTY_ROOT.type;else if(this.popupOpen)return new si({id:xr.EMPTY_ROOT.id,type:xr.EMPTY_ROOT.type})}};Yg=Vi([(0,Nn.injectable)()],Yg);ne.ClosePopupActionHandler=Yg});var fl=f(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.SIssue=It.SIssueMarker=It.SDecoration=It.isDecoration=It.decorationFeature=void 0;var gE=ce(),pE=Er();It.decorationFeature=Symbol("decorationFeature");function Hq(i){return i.hasFeature(It.decorationFeature)}It.isDecoration=Hq;var Ha=class extends gE.SShapeElement{};It.SDecoration=Ha;Ha.DEFAULT_FEATURES=[It.decorationFeature,gE.boundsFeature,pE.hoverFeedbackFeature,pE.popupFeature];var Ug=class extends Ha{};It.SIssueMarker=Ug;var Gg=class{};It.SIssue=Gg});var Xg=f(Xo=>{"use strict";var zq=Xo&&Xo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Xo,"__esModule",{value:!0});Xo.IssueMarkerView=void 0;var Wg=Gt(),Yq=Le(),kq=_(),$g=class{render(e,t){let n=.008928571428571428,r=`scale(${n}, ${n})`,o=this.getMaxSeverity(e),s=(0,Wg.svg)("g",{"class-sprotty-issue":!0},(0,Wg.svg)("g",{transform:r},(0,Wg.svg)("path",{d:this.getPath(o)})));return(0,Yq.setClass)(s,"sprotty-"+o,!0),s}getMaxSeverity(e){let t="info";for(let n of e.issues.map(r=>r.severity))(n==="error"||n==="warning"&&t==="info")&&(t=n);return t}getPath(e){switch(e){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};$g=zq([(0,kq.injectable)()],$g);Xo.IssueMarkerView=$g});var Jg=f(Ki=>{"use strict";var vE=Ki&&Ki.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Uq=Ki&&Ki.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.DecorationPlacer=void 0;var bE=_(),Gq=G(),Wq=fl(),$q=Le(),mE=ce(),Xq=ye(),yE=fn(),_E=fr(),hl=class{decorate(e,t){if((0,Wq.isDecoration)(t)){let n=this.getPosition(t),r="translate("+n.x+", "+n.y+")";(0,$q.setAttr)(e,"transform",r)}return e}getPosition(e){if(e instanceof Gq.SChildElement&&e.parent instanceof Xq.SRoutableElement){let t=this.edgeRouterRegistry.route(e.parent);if(t.length>1){let n=Math.floor(.5*(t.length-1)),r=(0,mE.isSizeable)(e)?{x:-.5*e.bounds.width,y:-.5*e.bounds.width}:_E.Point.ORIGIN;return{x:.5*(t[n].x+t[n+1].x)+r.x,y:.5*(t[n].y+t[n+1].y)+r.y}}}return(0,mE.isSizeable)(e)?{x:-.666*e.bounds.width,y:-.666*e.bounds.height}:_E.Point.ORIGIN}postUpdate(){}};vE([(0,bE.inject)(yE.EdgeRouterRegistry),Uq("design:type",yE.EdgeRouterRegistry)],hl.prototype,"edgeRouterRegistry",void 0);hl=vE([(0,bE.injectable)()],hl);Ki.DecorationPlacer=hl});var em=f((Zg,Qg)=>{(function(i,e){typeof Zg=="object"&&typeof Qg<"u"?Qg.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self,i.TinyQueue=e())})(Zg,function(){"use strict";var i=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var r=this,o=r.data,s=r.compare,a=o[n];n>0;){var c=n-1>>1,u=o[c];if(s(a,u)>=0)break;o[n]=u,n=c}o[n]=a},i.prototype._down=function(n){for(var r=this,o=r.data,s=r.compare,a=this.length>>1,c=o[n];n<a;){var u=(n<<1)+1,d=o[u],l=u+1;if(l<this.length&&s(o[l],d)<0&&(u=l,d=o[l]),s(d,c)>=0)break;o[n]=d,n=u}o[n]=c};function e(t,n){return t<n?-1:t>n?1:0}return i})});var nm=f(Oe=>{"use strict";var Jq=Oe&&Oe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.intersectionOfSegments=Oe.getSegmentIndex=Oe.checkWhichSegmentHasRightEndpointFirst=Oe.runSweep=Oe.Segment=Oe.SweepEvent=Oe.checkWhichEventIsLeft=Oe.addRoute=void 0;var Zq=Jq(em()),SE=Or();function Qq(i,e,t){if(e.length<1)return;let n=e[0],r;for(let o=0;o<e.length-1;o++){r=e[o+1];let s=new za(i,n,o),a=new za(i,r,o+1);s.otherEvent=a,a.otherEvent=s,EE(s,a)>0?(a.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,a.isLeftEndpoint=!1),t.push(s),t.push(a),n=r}}Oe.addRoute=Qq;function EE(i,e){return i.point.x>e.point.x?1:i.point.x<e.point.x?-1:i.point.y!==e.point.y?i.point.y>e.point.y?1:-1:1}Oe.checkWhichEventIsLeft=EE;var za=class{constructor(e,t,n){this.edgeId=e,this.point=t,this.segmentIndex=n}};Oe.SweepEvent=za;var pl=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};Oe.Segment=pl;function ej(i){let e=[],t=new Zq.default([],wE);for(;i.length;){let n=i.pop();if(n?.isLeftEndpoint){let r=new pl(n);for(let o=0;o<t.data.length;o++){let s=t.data[o],a=PE(r,s);a&&e.push({routable1:n.edgeId,routable2:s.leftSweepEvent.edgeId,segmentIndex1:tm(r),segmentIndex2:tm(s),intersectionPoint:a})}t.push(r)}else n?.isLeftEndpoint===!1&&t.pop()}return e}Oe.runSweep=ej;function wE(i,e){return i.rightSweepEvent.point.x>e.rightSweepEvent.point.x?1:i.rightSweepEvent.point.x<e.rightSweepEvent.point.x?-1:i.rightSweepEvent.point.y!==e.rightSweepEvent.point.y?i.rightSweepEvent.point.y<e.rightSweepEvent.point.y?1:-1:1}Oe.checkWhichSegmentHasRightEndpointFirst=wE;function tm(i){return Math.min(i.leftSweepEvent.segmentIndex,i.rightSweepEvent.segmentIndex)}Oe.getSegmentIndex=tm;function PE(i,e){if(i.leftSweepEvent.edgeId===e.leftSweepEvent.edgeId)return;let t=new SE.PointToPointLine(i.leftSweepEvent.point,i.rightSweepEvent.point),n=new SE.PointToPointLine(e.leftSweepEvent.point,e.rightSweepEvent.point);return t.intersection(n)}Oe.intersectionOfSegments=PE});var gl=f(Fe=>{"use strict";var tj=Fe&&Fe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},nj=Fe&&Fe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.IntersectionFinder=Fe.BY_DESCENDING_X_THEN_DESCENDING_Y=Fe.BY_X_THEN_DESCENDING_Y=Fe.BY_DESCENDING_X_THEN_Y=Fe.BY_X_THEN_Y=Fe.isIntersectingRoutedPoint=void 0;var ij=_(),rj=nj(em()),im=nm();function IE(i){return i!==void 0&&"intersections"in i&&"kind"in i}Fe.isIntersectingRoutedPoint=IE;var oj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Fe.BY_X_THEN_Y=oj;var sj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Fe.BY_DESCENDING_X_THEN_Y=sj;var aj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Fe.BY_X_THEN_DESCENDING_Y=aj;var cj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Fe.BY_DESCENDING_X_THEN_DESCENDING_Y=cj;var rm=class{apply(e){let t=this.find(e);this.addToRouting(t,e)}find(e){let t=new rj.default(void 0,im.checkWhichEventIsLeft);return e.routes.forEach((n,r)=>{this.isSupportedRoute(n)&&(0,im.addRoute)(r,n,t)}),(0,im.runSweep)(t)}isSupportedRoute(e){return e.find(t=>t.kind!=="source"&&t.kind!=="target"&&t.kind!=="linear")===void 0}addToRouting(e,t){for(let n of e){let r=t.get(n.routable1),o=t.get(n.routable2);this.addIntersectionToRoutedPoint(n,r,n.segmentIndex1),this.addIntersectionToRoutedPoint(n,o,n.segmentIndex2)}}addIntersectionToRoutedPoint(e,t,n){if(t&&t.length>n){let r=t[n+1];if(IE(r))r.intersections.push(e);else{let o=Object.assign(Object.assign({},r),{intersections:[e]});t[n+1]=o}}}};rm=tj([(0,ij.injectable)()],rm);Fe.IntersectionFinder=rm});var $a=f(we=>{"use strict";var Wa=we&&we.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vl=we&&we.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},uj=we&&we.__param||function(i,e){return function(t,n){e(t,n,i)}},om;Object.defineProperty(we,"__esModule",{value:!0});we.LocationPostprocessor=we.MoveMouseListener=we.MorphEdgesAnimation=we.MoveAnimation=we.MoveCommand=we.MoveAction=void 0;var ai=_(),Hi=Q(),Jo=te(),Ya=cr(),dj=ge(),yl=G(),ka=He(),ME=P(),lj=Tt(),fj=Le(),hj=Ir(),pj=xa(),OE=ce(),RE=og(),ml=Na(),gj=el(),qe=ye(),_l=fn(),mj=Lo(),TE=Et(),yj=An(),Zo=xi(),am;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(am=we.MoveAction||(we.MoveAction={}));var Ua=om=class extends dj.MergeableCommand{constructor(e){super(),this.action=e,this.resolvedMoves=new Map,this.edgeMementi=[]}execute(e){let t=e.root.index,n=new Map,r=new Map;return this.action.moves.forEach(o=>{let s=t.getById(o.elementId);if(s instanceof qe.SRoutingHandle&&this.edgeRouterRegistry){let a=s.parent;if(a instanceof qe.SRoutableElement){let c=this.resolveHandleMove(s,a,o);if(c){let u=n.get(a);u||(u=[],n.set(a,u)),u.push(c)}}}else if(s&&(0,Zo.isLocateable)(s)){let a=this.resolveElementMove(s,o);a&&(this.resolvedMoves.set(a.element.id,a),this.edgeRouterRegistry&&t.getAttachedElements(s).forEach(c=>{if(c instanceof qe.SRoutableElement){let u=r.get(c),d=Hi.Point.subtract(a.toPosition,a.fromPosition),l=u?Hi.Point.linear(u,d,.5):d;r.set(c,l)}}))}}),this.doMove(n,r),this.action.animate?(this.undoMove(),new Ya.CompoundAnimation(e.root,e,[new Qo(e.root,this.resolvedMoves,e,!1),new es(e.root,this.edgeMementi,e,!1)]).start()):e.root}resolveHandleMove(e,t,n){let r=n.fromPosition;if(!r){let o=this.edgeRouterRegistry.get(t.routerKind);r=o.getHandlePosition(t,o.route(t),e)}if(r)return{handle:e,fromPosition:r,toPosition:n.toPosition}}resolveElementMove(e,t){let n=t.fromPosition||{x:e.position.x,y:e.position.y};return{element:e,fromPosition:n,toPosition:t.toPosition}}doMove(e,t){this.resolvedMoves.forEach(n=>{n.element.position=n.toPosition}),e.forEach((n,r)=>{let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);o.applyHandleMoves(r,n);let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}),t.forEach((n,r)=>{if(!e.get(r)){let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);if(r.source&&r.target&&this.resolvedMoves.get(r.source.id)&&this.resolvedMoves.get(r.target.id))r.routingPoints=r.routingPoints.map(c=>Hi.Point.add(c,n));else{let c=(0,TE.isSelectable)(r)&&r.selected;o.cleanupRoutingPoints(r,r.routingPoints,c,this.action.finished)}let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}})}undoMove(){this.resolvedMoves.forEach(e=>{e.element.position=e.fromPosition}),this.edgeMementi.forEach(e=>{this.edgeRouterRegistry.get(e.edge.routerKind).applySnapshot(e.edge,e.before)})}undo(e){return new Ya.CompoundAnimation(e.root,e,[new Qo(e.root,this.resolvedMoves,e,!0),new es(e.root,this.edgeMementi,e,!0)]).start()}redo(e){return new Ya.CompoundAnimation(e.root,e,[new Qo(e.root,this.resolvedMoves,e,!1),new es(e.root,this.edgeMementi,e,!1)]).start()}merge(e,t){if(!this.action.animate&&e instanceof om)return e.resolvedMoves.forEach((n,r)=>{let o=this.resolvedMoves.get(r);o?o.toPosition=n.toPosition:this.resolvedMoves.set(r,n)}),e.edgeMementi.forEach(n=>{let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}),!0;if(e instanceof gj.ReconnectCommand){let n=e.memento;if(n){let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}return!0}return!1}};Ua.KIND=am.KIND;Wa([(0,ai.inject)(_l.EdgeRouterRegistry),(0,ai.optional)(),vl("design:type",_l.EdgeRouterRegistry)],Ua.prototype,"edgeRouterRegistry",void 0);Ua=om=Wa([(0,ai.injectable)(),uj(0,(0,ai.inject)(ME.TYPES.Action)),vl("design:paramtypes",[Object])],Ua);we.MoveCommand=Ua;var Qo=class extends Ya.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementMoves=t,this.reverse=r}tween(e){return this.elementMoves.forEach(t=>{this.reverse?t.element.position={x:(1-e)*t.toPosition.x+e*t.fromPosition.x,y:(1-e)*t.toPosition.y+e*t.fromPosition.y}:t.element.position={x:(1-e)*t.fromPosition.x+e*t.toPosition.x,y:(1-e)*t.fromPosition.y+e*t.toPosition.y}}),this.model}};we.MoveAnimation=Qo;var es=class extends Ya.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.reverse=r,this.expanded=[],t.forEach(o=>{let s=this.reverse?o.after:o.before,a=this.reverse?o.before:o.after,c=s.routedPoints,u=a.routedPoints,d=Math.max(c.length,u.length);this.expanded.push({startExpandedRoute:this.growToSize(c,d),endExpandedRoute:this.growToSize(u,d),memento:o})})}midPoint(e){let t=e.edge,n=e.edge.source,r=e.edge.target;return Hi.Point.linear((0,ka.translatePoint)(Hi.Bounds.center(n.bounds),n.parent,t.parent),(0,ka.translatePoint)(Hi.Bounds.center(r.bounds),r.parent,t.parent),.5)}start(){return this.expanded.forEach(e=>{e.memento.edge.removeAll(t=>t instanceof qe.SRoutingHandle)}),super.start()}tween(e){return e===1?this.expanded.forEach(t=>{let n=t.memento;this.reverse?n.before.router.applySnapshot(n.edge,n.before):n.after.router.applySnapshot(n.edge,n.after)}):this.expanded.forEach(t=>{let n=[];for(let s=1;s<t.startExpandedRoute.length-1;++s)n.push(Hi.Point.linear(t.startExpandedRoute[s],t.endExpandedRoute[s],e));let r=e<.5?t.memento.before:t.memento.after,o=Object.assign(Object.assign({},r),{routingPoints:n,routingHandles:[]});r.router.applySnapshot(t.memento.edge,o)}),this.model}growToSize(e,t){let n=t-e.length;if(n<=0)return e;let r=[];r.push(e[0]);let o=1/(n+1),s=1/(e.length-1),a=1;for(let c=1;c<e.length;++c){let u=s*c,d=0;for(;u>(a+d)*o;)++d;a+=d;for(let l=0;l<d;++l){let S=Hi.Point.linear(e[c-1],e[c],(l+1)/(d+1));r.push(S)}r.push(e[c])}return r}};we.MorphEdgesAnimation=es;var Ga=class extends lj.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(e,t){if(t.button===0){let n=(0,ka.findParentByFeature)(e,Zo.isMoveable),r=e instanceof qe.SRoutingHandle;n!==void 0||r||(0,RE.isCreatingOnDrag)(e)?this.startDragPosition={x:t.pageX,y:t.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,RE.isCreatingOnDrag)(e)?this.startCreatingOnDrag(e,t):r&&this.activateRoutingHandle(e,t)}return[]}startCreatingOnDrag(e,t){let n=[];return n.push(Jo.SelectAllAction.create({select:!1})),n.push(e.createAction(qe.edgeInProgressID)),n.push(Jo.SelectAction.create({selectedElementsIDs:[qe.edgeInProgressID]})),n.push(ml.SwitchEditModeAction.create({elementsToActivate:[qe.edgeInProgressID]})),n.push(Jo.SelectAction.create({selectedElementsIDs:[qe.edgeInProgressTargetHandleID]})),n.push(ml.SwitchEditModeAction.create({elementsToActivate:[qe.edgeInProgressTargetHandleID]})),n}activateRoutingHandle(e,t){return[ml.SwitchEditModeAction.create({elementsToActivate:[e.id]})]}mouseMove(e,t){let n=[];if(t.buttons===0)this.mouseUp(e,t);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(e.root),this.hasDragged=!0;let r=this.getElementMoves(e,t,!1);r&&n.push(r)}return n}collectStartPositions(e){let t=new Set(e.index.all().filter(n=>(0,TE.isSelectable)(n)&&n.selected));t.forEach(n=>{if(!this.isChildOfSelected(t,n)){if((0,Zo.isMoveable)(n))this.elementId2startPos.set(n.id,n.position);else if(n instanceof qe.SRoutingHandle){let r=this.getHandlePosition(n);r&&this.elementId2startPos.set(n.id,r)}}})}isChildOfSelected(e,t){for(;t instanceof yl.SChildElement;)if(t=t.parent,(0,Zo.isMoveable)(t)&&e.has(t))return!0;return!1}getElementMoves(e,t,n){if(!this.startDragPosition)return;let r=[],o=(0,ka.findParentByFeature)(e,yj.isViewport),s=o?o.zoom:1,a={x:(t.pageX-this.startDragPosition.x)/s,y:(t.pageY-this.startDragPosition.y)/s};if(this.elementId2startPos.forEach((c,u)=>{let d=e.root.index.getById(u);if(d){let l=this.createElementMove(d,c,a,t);l&&r.push(l)}}),r.length>0)return am.create(r,{animate:!1,finished:n})}createElementMove(e,t,n,r){let o=this.snap({x:t.x+n.x,y:t.y+n.y},e,!r.shiftKey);if((0,Zo.isMoveable)(e))return{elementId:e.id,elementType:e.type,fromPosition:{x:e.position.x,y:e.position.y},toPosition:o};if(e instanceof qe.SRoutingHandle){let s=this.getHandlePosition(e);if(s!==void 0)return{elementId:e.id,elementType:e.type,fromPosition:s,toPosition:o}}}snap(e,t,n){return n&&this.snapper?this.snapper.snap(e,t):e}getHandlePosition(e){if(this.edgeRouterRegistry){let t=e.parent;if(!(t instanceof qe.SRoutableElement))return;let n=this.edgeRouterRegistry.get(t.routerKind),r=n.route(t);return n.getHandlePosition(t,r,e)}}mouseEnter(e,t){return e instanceof yl.SModelRoot&&t.buttons===0&&!this.startDragPosition&&this.mouseUp(e,t),[]}mouseUp(e,t){let n=[];if(this.startDragPosition){let r=this.getElementMoves(e,t,!0);r&&n.push(r),e.root.index.all().forEach(o=>{o instanceof qe.SRoutingHandle&&n.push(...this.deactivateRoutingHandle(o,e,t))})}if(!n.some(r=>r.kind===Jo.ReconnectAction.KIND)){let r=e.root.index.getById(qe.edgeInProgressID);r instanceof yl.SChildElement&&n.push(this.deleteEdgeInProgress(r))}return this.hasDragged&&n.push(pj.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),n}deactivateRoutingHandle(e,t,n){let r=[],o=e.parent;if(o instanceof qe.SRoutableElement&&e.danglingAnchor){let s=this.getHandlePosition(e);if(s){let a=(0,ka.translatePoint)(s,e.parent,e.root),c=(0,OE.findChildrenAtPosition)(t.root,a).find(u=>(0,qe.isConnectable)(u)&&u.canConnect(o,e.kind));c&&this.hasDragged&&r.push(Jo.ReconnectAction.create({routableId:e.parent.id,newSourceId:e.kind==="source"?c.id:o.sourceId,newTargetId:e.kind==="target"?c.id:o.targetId}))}}return e.editMode&&r.push(ml.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),r}deleteEdgeInProgress(e){let t=[];return t.push(qe.edgeInProgressID),e.children.forEach(n=>{n instanceof qe.SRoutingHandle&&n.danglingAnchor&&t.push(n.danglingAnchor.id)}),Jo.DeleteElementAction.create(t)}decorate(e,t){return e}};Wa([(0,ai.inject)(_l.EdgeRouterRegistry),(0,ai.optional)(),vl("design:type",_l.EdgeRouterRegistry)],Ga.prototype,"edgeRouterRegistry",void 0);Wa([(0,ai.inject)(ME.TYPES.ISnapper),(0,ai.optional)(),vl("design:type",Object)],Ga.prototype,"snapper",void 0);we.MoveMouseListener=Ga;var sm=class{decorate(e,t){if((0,mj.isEdgeLayoutable)(t)&&t.parent instanceof hj.SEdge)return e;let n="";if((0,Zo.isLocateable)(t)&&t instanceof yl.SChildElement&&t.parent!==void 0){let r=t.position;(r.x!==0||r.y!==0)&&(n="translate("+r.x+", "+r.y+")")}if((0,OE.isAlignable)(t)){let r=t.alignment;(r.x!==0||r.y!==0)&&(n.length>0&&(n+=" "),n+="translate("+r.x+", "+r.y+")")}return n.length>0&&(0,fj.setAttr)(e,"transform",n),e}postUpdate(){}};sm=Wa([(0,ai.injectable)()],sm);we.LocationPostprocessor=sm});var AE=f(ts=>{"use strict";var _j=ts&&ts.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ts,"__esModule",{value:!0});ts.CenterGridSnapper=void 0;var vj=_(),bj=ce(),cm=class{get gridX(){return 10}get gridY(){return 10}snap(e,t){return t&&(0,bj.isBoundsAware)(t)?{x:Math.round((e.x+.5*t.bounds.width)/this.gridX)*this.gridX-.5*t.bounds.width,y:Math.round((e.y+.5*t.bounds.height)/this.gridY)*this.gridY-.5*t.bounds.height}:{x:Math.round(e.x/this.gridX)*this.gridX,y:Math.round(e.y/this.gridY)*this.gridY}}};cm=_j([(0,vj.injectable)()],cm);ts.CenterGridSnapper=cm});var um=f(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.isOpenable=qr.openFeature=void 0;qr.openFeature=Symbol("openFeature");function Sj(i){return i.hasFeature(qr.openFeature)}qr.isOpenable=Sj});var lm=f(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.OpenMouseListener=void 0;var Ej=te(),wj=Tt(),Pj=He(),Ij=um(),dm=class extends wj.MouseListener{doubleClick(e,t){let n=(0,Pj.findParentByFeature)(e,Ij.isOpenable);return n!==void 0?[Ej.OpenAction.create(n.id)]:[]}};bl.OpenMouseListener=dm});var wl=f(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.getModelBounds=Ln.getProjectedBounds=Ln.getProjections=Ln.isProjectable=void 0;var Rj=Q(),Mj=_n(),CE=He(),El=ce();function xE(i){return(0,Mj.hasOwnProperty)(i,"projectionCssClasses")}Ln.isProjectable=xE;function DE(i){let e;for(let t of i.children){if(xE(t)&&t.projectionCssClasses.length>0){let n=qE(t);if(n){let r={elementId:t.id,projectedBounds:n,cssClasses:t.projectionCssClasses};e?e.push(r):e=[r]}}if(t.children.length>0){let n=DE(t);n&&(e?e.push(...n):e=n)}}return e}Ln.getProjections=DE;function qE(i){let e=i.parent;if(i.projectedBounds){let t=i.projectedBounds;return(0,El.isBoundsAware)(e)&&(t=(0,CE.transformToRootBounds)(e,t)),t}else if((0,El.isBoundsAware)(i)){let t=i.bounds;return t=(0,CE.transformToRootBounds)(e,t),t}}Ln.getProjectedBounds=qE;var Sl=1e9;function Oj(i){let e=Sl,t=Sl,n=-Sl,r=-Sl,o=(0,El.isBoundsAware)(i)?i.bounds:void 0;if(o&&Rj.Dimension.isValid(o))e=o.x,t=o.y,n=e+o.width,r=t+o.height;else for(let s of i.children)if((0,El.isBoundsAware)(s)){let a=s.bounds;e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x+a.width),r=Math.max(r,a.y+a.height)}if(e=Math.min(e,i.scroll.x),t=Math.min(t,i.scroll.y),n=Math.max(n,i.scroll.x+i.canvasBounds.width/i.zoom),r=Math.max(r,i.scroll.y+i.canvasBounds.height/i.zoom),e<n&&t<r)return{x:e,y:t,width:n-e,height:r-t}}Ln.getModelBounds=Oj});var BE=f(ns=>{"use strict";var Tj=ns&&ns.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ns,"__esModule",{value:!0});ns.ProjectedViewportView=void 0;var Pl=Gt(),Aj=_(),jE=ho(),NE=Le(),LE=wl(),fm=class{render(e,t,n){let r=(0,Pl.html)("div",{"class-sprotty-root":!0},this.renderSvg(e,t,n),this.renderProjections(e,t,n));return(0,NE.setAttr)(r,"tabindex",0),r}renderSvg(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`,o="http://www.w3.org/2000/svg";return(0,jE.h)("svg",{ns:o},(0,jE.h)("g",{ns:o,attrs:{transform:r}},t.renderChildren(e)))}renderProjections(e,t,n){var r;if(e.zoom<=0)return[];let o=(0,LE.getModelBounds)(e);if(!o)return[];let s=(r=(0,LE.getProjections)(e))!==null&&r!==void 0?r:[];return[this.renderProjectionBar(s,e,o,"vertical"),this.renderProjectionBar(s,e,o,"horizontal")]}renderProjectionBar(e,t,n,r){let o={modelBounds:n,orientation:r};return o.factor=r==="horizontal"?t.canvasBounds.width/n.width:t.canvasBounds.height/n.height,o.zoomedFactor=o.factor/t.zoom,(0,Pl.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":r==="horizontal","class-vertical":r==="vertical"},this.renderViewport(t,o),e.map(s=>this.renderProjection(s,t,o)))}renderViewport(e,t){let n,r;t.orientation==="horizontal"?(n=e.canvasBounds.width,r=(e.scroll.x-t.modelBounds.x)*t.factor):(n=e.canvasBounds.height,r=(e.scroll.y-t.modelBounds.y)*t.factor);let o=n*t.zoomedFactor;r<0?(o+=r,r=0):r>n&&(r=n),o<0?o=0:r+o>n&&(o=n-r);let s=t.orientation==="horizontal"?{left:`${r}px`,width:`${o}px`}:{top:`${r}px`,height:`${o}px`};return(0,Pl.html)("div",{"class-sprotty-viewport":!0,style:s})}renderProjection(e,t,n){let r,o,s;n.orientation==="horizontal"?(r=t.canvasBounds.width,o=(e.projectedBounds.x-n.modelBounds.x)*n.factor,s=e.projectedBounds.width*n.factor):(r=t.canvasBounds.height,o=(e.projectedBounds.y-n.modelBounds.y)*n.factor,s=e.projectedBounds.height*n.factor),o<0?(s+=o,o=0):o>r&&(o=r),s<0?s=0:o+s>r&&(s=r-o);let a=n.orientation==="horizontal"?{left:`${o}px`,width:`${s}px`}:{top:`${o}px`,height:`${s}px`},c=(0,Pl.html)("div",{id:`${n.orientation}-projection:${e.elementId}`,"class-sprotty-projection":!0,style:a});return e.cssClasses.forEach(u=>(0,NE.setClass)(c,u,!0)),c}};fm=Tj([(0,Aj.injectable)()],fm);ns.ProjectedViewportView=fm});var Il=f(Bn=>{"use strict";var _m=Bn&&Bn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.DiamondAnchor=Bn.RectangleAnchor=Bn.EllipseAnchor=void 0;var vm=ii(),hm=Or(),bm=_(),Sm=Ra(),is=Q(),pm=class{get kind(){return Sm.PolylineEdgeRouter.KIND+":"+vm.ELLIPTIC_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=is.Bounds.center(r),s=o.x-t.x,a=o.y-t.y,c=Math.sqrt(s*s+a*a),u=s/c||0,d=a/c||0;return{x:o.x-u*(.5*r.width+n),y:o.y-d*(.5*r.height+n)}}};pm=_m([(0,bm.injectable)()],pm);Bn.EllipseAnchor=pm;var gm=class{get kind(){return Sm.PolylineEdgeRouter.KIND+":"+vm.RECTANGULAR_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=is.Bounds.center(r),s=new mm(o,t);if(!(0,is.almostEquals)(o.y,t.y)){let a=this.getXIntersection(r.y,o,t);a>=r.x&&a<=r.x+r.width&&s.addCandidate(a,r.y-n);let c=this.getXIntersection(r.y+r.height,o,t);c>=r.x&&c<=r.x+r.width&&s.addCandidate(c,r.y+r.height+n)}if(!(0,is.almostEquals)(o.x,t.x)){let a=this.getYIntersection(r.x,o,t);a>=r.y&&a<=r.y+r.height&&s.addCandidate(r.x-n,a);let c=this.getYIntersection(r.x+r.width,o,t);c>=r.y&&c<=r.y+r.height&&s.addCandidate(r.x+r.width+n,c)}return s.best}getXIntersection(e,t,n){let r=(e-t.y)/(n.y-t.y);return(n.x-t.x)*r+t.x}getYIntersection(e,t,n){let r=(e-t.x)/(n.x-t.x);return(n.y-t.y)*r+t.y}};gm=_m([(0,bm.injectable)()],gm);Bn.RectangleAnchor=gm;var mm=class{constructor(e,t){this.centerPoint=e,this.refPoint=t,this.currentDist=-1}addCandidate(e,t){let n=this.refPoint.x-e,r=this.refPoint.y-t,o=n*n+r*r;(this.currentDist<0||o<this.currentDist)&&(this.currentBest={x:e,y:t},this.currentDist=o)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}},ym=class{get kind(){return Sm.PolylineEdgeRouter.KIND+":"+vm.DIAMOND_ANCHOR_KIND}getAnchor(e,t,n){let r=e.bounds,o=new hm.PointToPointLine(is.Bounds.center(r),t),s=new hm.Diamond(r).closestSideLine(t),a=(0,hm.intersection)(s,o);return is.Point.shiftTowards(a,t,n)}};ym=_m([(0,bm.injectable)()],ym);Bn.DiamondAnchor=ym});var Tl=f(Ue=>{"use strict";var HE=Ue&&Ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Cj=Ue&&Ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},FE=Ue&&Ue.__param||function(i,e){return function(t,n){e(t,n,i)}},Xa;Object.defineProperty(Ue,"__esModule",{value:!0});Ue.AddRemoveBezierSegmentCommand=Ue.AddRemoveBezierSegmentAction=Ue.BezierMouseListener=Ue.BezierEdgeRouter=void 0;var Rl=_(),VE=Q(),zi=ye(),KE=fn(),xj=Pa(),Dj=Tt(),qj=ge(),jj=P(),rs=Xa=class extends xj.AbstractEdgeRouter{get kind(){return Xa.KIND}route(e){if(!e.source||!e.target)return[];let t=e.routingPoints.length,n=e.source,r=e.target,o=[];if(o.push({kind:"source",x:0,y:0}),t===0){let[d,l]=this.createDefaultBezierHandles(n.position,r.position);o.push({kind:"bezier-control-after",x:d.x,y:d.y,pointIndex:0}),o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:1}),e.routingPoints.push(d),e.routingPoints.push(l)}else if(t>=2)for(let d=0;d<t;d++){let l=e.routingPoints[d];d%3===0&&o.push({kind:"bezier-control-after",x:l.x,y:l.y,pointIndex:d}),(d+1)%3===0?o.push({kind:"bezier-junction",x:l.x,y:l.y,pointIndex:d}):(d+2)%3===0&&o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:d})}o.push({kind:"target",x:0,y:0});let s=t>2?e.routingPoints[2]:r.position,a=t>2?e.routingPoints[e.routingPoints.length-3]:n.position,c=this.getTranslatedAnchor(n,s,r.parent,e,e.sourceAnchorCorrection),u=this.getTranslatedAnchor(r,a,n.parent,e,e.targetAnchorCorrection);return o[0]={kind:"source",x:c.x,y:c.y},o[o.length-1]={kind:"target",x:u.x,y:u.y},o}createDefaultBezierHandles(e,t){let n={x:e.x-Xa.DEFAULT_BEZIER_HANDLE_OFFSET,y:e.y},r={x:t.x+Xa.DEFAULT_BEZIER_HANDLE_OFFSET,y:t.y};return[n,r]}createRoutingHandles(e){this.route(e),this.rebuildHandles(e)}rebuildHandles(e){this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"bezier-control-after","bezier-routing-point",0),this.addHandle(e,"bezier-add","bezier-create-routing-point",0);let t=e.routingPoints.length;if(t>2)for(let n=1;n<t-1;n+=3)this.addHandle(e,"bezier-control-before","bezier-routing-point",n),this.addHandle(e,"bezier-add","bezier-create-routing-point",n+1),this.addHandle(e,"bezier-junction","routing-point",n+1),this.addHandle(e,"bezier-remove","bezier-remove-routing-point",n+1),this.addHandle(e,"bezier-control-after","bezier-routing-point",n+2),this.moveBezierControlPair(e.routingPoints[n],n,e);this.addHandle(e,"bezier-control-before","bezier-routing-point",t-1),this.addHandle(e,"target","routing-point",-1)}getInnerHandlePosition(e,t,n){if(n.kind==="bezier-control-before"||n.kind==="bezier-junction"||n.kind==="bezier-control-after")for(let r=0;r<t.length;r++){let o=t[r];if(o.pointIndex===n.pointIndex&&o.kind===n.kind)return o}else if(n.kind==="bezier-add"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y+12.5}}else if(n.kind==="bezier-remove"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y-12.5}}}findBezierControl(e,t,n){let r={x:t[0].x,y:t[0].y};if(n>0){for(let o of t)if(o.pointIndex!==void 0&&o.pointIndex===n&&o.kind==="bezier-junction"){r={x:o.x,y:o.y};break}}return r}applyHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o={x:0,y:0},s,a,c,u=n.toPosition;switch(r.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(u,n.handle.pointIndex,e);break;case"bezier-junction":let d=r.pointIndex;d>=0&&d<e.routingPoints.length&&(c=d-1,o=e.routingPoints[d],s=e.routingPoints[c],a=this.calcRelativeMove(o,u,s),e.routingPoints[d]=u,this.moveBezierControlPair(a,c,e));break;case"source":if(c=0,s=e.routingPoints[c],e.source instanceof zi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new zi.SDanglingAnchor;l.id=e.id+"_dangling-source",l.original=e.source,l.position=n.toPosition,r.root.add(l),r.danglingAnchor=l,e.sourceId=l.id,e.source&&(o=e.source.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;case"target":if(c=e.routingPoints.length-1,s=e.routingPoints[c],e.target instanceof zi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new zi.SDanglingAnchor;l.id=e.id+"_dangling-target",l.original=e.target,l.position=u,r.root.add(l),r.danglingAnchor=l,e.targetId=l.id,e.target&&(o=e.target.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;default:break}})}applyInnerHandleMoves(e,t){}getOptions(e){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(e,t,n){return{x:n.x-(e.x-t.x),y:n.y-(e.y-t.y)}}createNewBezierSegment(e,t){let n=t.routingPoints,r,o,s;n.length===2?(o=n[e<0?0:e],s=n[n.length-1],r=(0,VE.centerOfLine)(o,s)):(o=n[e],s=n[e+2],r=(0,VE.centerOfLine)(o,s));let[a,c]=this.createDefaultBezierHandles(r,r);n.splice(e+1,0,a),n.splice(e+2,0,r),n.splice(e+3,0,c),this.moveBezierControlPair(a,e+1,t),t.removeAll(u=>u instanceof zi.SRoutingHandle),this.rebuildHandles(t)}removeBezierSegment(e,t){t.routingPoints.splice(e-1,3),t.removeAll(r=>r instanceof zi.SRoutingHandle),this.rebuildHandles(t)}moveBezierControlPair(e,t,n){if(t>=0&&t<n.routingPoints.length){let r=t-1,o=t+1;r<0||o===n.routingPoints.length?n.routingPoints[t]=e:t%3===0?this.setBezierMirror(n,e,t,!1):(t+2)%3===0&&this.setBezierMirror(n,e,t,!0)}}setBezierMirror(e,t,n,r){e.routingPoints[n]=t;let o=e.routingPoints[r?n+1:n-1];e.routingPoints[r?n+2:n-2]={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)}}};rs.KIND="bezier";rs.DEFAULT_BEZIER_HANDLE_OFFSET=25;rs=Xa=HE([(0,Rl.injectable)()],rs);Ue.BezierEdgeRouter=rs;var Em=class extends Dj.MouseListener{mouseDown(e,t){let n=[];return e instanceof zi.SRoutingHandle&&(e.kind==="bezier-add"||e.kind==="bezier-remove")&&(e.type==="bezier-create-routing-point"?n.push(Ml.create("add",e.id)):e.type==="bezier-remove-routing-point"&&n.push(Ml.create("remove",e.id))),n}};Ue.BezierMouseListener=Em;var Ml;(function(i){i.KIND="addRemoveBezierSegment";function e(t,n){return{kind:i.KIND,actionTask:t,targetId:n}}i.create=e})(Ml=Ue.AddRemoveBezierSegmentAction||(Ue.AddRemoveBezierSegmentAction={}));var Ol=class extends qj.Command{constructor(e,t){super(),this.action=e,this.edgeRouterRegistry=t}execute(e){let n=e.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&n instanceof zi.SRoutingHandle){let r=this.edgeRouterRegistry.get(n.parent.routerKind);if(r instanceof rs){let o=r;for(let s of e.root.children)if(s.id===n.parent.id){this.action.actionTask==="add"?o.createNewBezierSegment(n.pointIndex,s):this.action.actionTask==="remove"&&o.removeBezierSegment(n.pointIndex,s);break}}}return e.root}undo(e){throw new Error("Method not implemented.")}redo(e){throw new Error("Method not implemented.")}};Ol.KIND=Ml.KIND;Ol=HE([(0,Rl.injectable)(),FE(0,(0,Rl.inject)(jj.TYPES.Action)),FE(1,(0,Rl.inject)(KE.EdgeRouterRegistry)),Cj("design:paramtypes",[Object,KE.EdgeRouterRegistry])],Ol);Ue.AddRemoveBezierSegmentCommand=Ol});var Cm=f(Fn=>{"use strict";var Rm=Fn&&Fn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.BezierDiamondAnchor=Fn.BezierRectangleAnchor=Fn.BezierEllipseAnchor=void 0;var Mm=ii(),Om=_(),Tm=Il(),Am=Tl(),wm=class extends Tm.EllipseAnchor{get kind(){return Am.BezierEdgeRouter.KIND+":"+Mm.ELLIPTIC_ANCHOR_KIND}};wm=Rm([(0,Om.injectable)()],wm);Fn.BezierEllipseAnchor=wm;var Pm=class extends Tm.RectangleAnchor{get kind(){return Am.BezierEdgeRouter.KIND+":"+Mm.RECTANGULAR_ANCHOR_KIND}};Pm=Rm([(0,Om.injectable)()],Pm);Fn.BezierRectangleAnchor=Pm;var Im=class extends Tm.DiamondAnchor{get kind(){return Am.BezierEdgeRouter.KIND+":"+Mm.DIAMOND_ANCHOR_KIND}};Im=Rm([(0,Om.injectable)()],Im);Fn.BezierDiamondAnchor=Im});var Cl=f(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});Al.ManhattanEdgeRouter=void 0;var _e=Q(),zE=He(),b=Pa(),xm=ye(),os=class extends b.AbstractEdgeRouter{get kind(){return os.KIND}getOptions(e){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(e){if(!e.source||!e.target)return[];let t=this.createRoutedCorners(e),n=t[0]||(0,zE.translatePoint)(_e.Bounds.center(e.target.bounds),e.target.parent,e.parent),r=this.getTranslatedAnchor(e.source,n,e.parent,e,e.sourceAnchorCorrection),o=t[t.length-1]||(0,zE.translatePoint)(_e.Bounds.center(e.source.bounds),e.source.parent,e.parent),s=this.getTranslatedAnchor(e.target,o,e.parent,e,e.targetAnchorCorrection);if(!r||!s)return[];let a=[];return a.push(Object.assign({kind:"source"},r)),t.forEach(c=>a.push(c)),a.push(Object.assign({kind:"target"},s)),a}createRoutedCorners(e){let t=new b.DefaultAnchors(e.source,e.parent,"source"),n=new b.DefaultAnchors(e.target,e.parent,"target");if(e.routingPoints.length>0){let s=e.routingPoints.slice();if(this.cleanupRoutingPoints(e,s,!1,!0),s.length>0)return s.map((a,c)=>Object.assign({kind:"linear",pointIndex:c},a))}let r=this.getOptions(e);return this.calculateDefaultCorners(e,t,n,r).map(s=>Object.assign({kind:"linear"},s))}createRoutingHandles(e){let t=this.route(e);if(this.commitRoute(e,t),t.length>0){this.addHandle(e,"source","routing-point",-2);for(let n=0;n<t.length-1;++n)this.addHandle(e,"manhattan-50%","volatile-routing-point",n-1);this.addHandle(e,"target","routing-point",t.length-2)}}getInnerHandlePosition(e,t,n){let r=this.getFraction(n.kind);if(r!==void 0){let{start:o,end:s}=this.findRouteSegment(e,t,n.pointIndex);if(o!==void 0&&s!==void 0)return _e.Point.linear(o,s,r)}}getFraction(e){switch(e){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(e,t){let n=this.route(e),r=e.routingPoints,o=this.getOptions(e).minimalPointDistance;t.forEach(s=>{let a=s.handle,c=a.pointIndex,u=this.correctX(r,c,s.toPosition.x,o),d=this.correctY(r,c,s.toPosition.y,o);switch(a.kind){case"manhattan-50%":c<0?(0,_e.almostEquals)(n[0].x,n[1].x)?this.alignX(r,0,u):this.alignY(r,0,d):c<r.length-1?(0,_e.almostEquals)(r[c].x,r[c+1].x)?(this.alignX(r,c,u),this.alignX(r,c+1,u)):(this.alignY(r,c,d),this.alignY(r,c+1,d)):(0,_e.almostEquals)(n[n.length-2].x,n[n.length-1].x)?this.alignX(r,r.length-1,u):this.alignY(r,r.length-1,d);break}})}correctX(e,t,n,r){return t>0&&Math.abs(n-e[t-1].x)<r?e[t-1].x:t<e.length-2&&Math.abs(n-e[t+2].x)<r?e[t+2].x:n}alignX(e,t,n){t>=0&&t<e.length&&(e[t]={x:n,y:e[t].y})}correctY(e,t,n,r){return t>0&&Math.abs(n-e[t-1].y)<r?e[t-1].y:t<e.length-2&&Math.abs(n-e[t+2].y)<r?e[t+2].y:n}alignY(e,t,n){t>=0&&t<e.length&&(e[t]={x:e[t].x,y:n})}cleanupRoutingPoints(e,t,n,r){let o=new b.DefaultAnchors(e.source,e.parent,"source"),s=new b.DefaultAnchors(e.target,e.parent,"target");if(!this.resetRoutingPointsOnReconnect(e,t,n,o,s)){for(let a=0;a<t.length&&_e.Bounds.includes(o.bounds,t[a]);++a)t.splice(0,1),n&&this.removeHandle(e,-1);for(let a=t.length-1;a>=0&&_e.Bounds.includes(s.bounds,t[a]);--a)t.splice(a,1),n&&this.removeHandle(e,a);if(t.length>=2){let a=this.getOptions(e);for(let c=t.length-2;c>=0;--c)_e.Point.manhattanDistance(t[c],t[c+1])<a.minimalPointDistance&&(t.splice(c,2),--c,n&&(this.removeHandle(e,c-1),this.removeHandle(e,c)))}r&&(this.addAdditionalCorner(e,t,o,s,n),this.addAdditionalCorner(e,t,s,o,n),this.manhattanify(e,t))}}removeHandle(e,t){let n=[];e.children.forEach(r=>{r instanceof xm.SRoutingHandle&&(r.pointIndex>t?--r.pointIndex:r.pointIndex===t&&n.push(r))}),n.forEach(r=>e.remove(r))}addAdditionalCorner(e,t,n,r,o){if(t.length===0)return;let s=n.kind==="source"?t[0]:t[t.length-1],a=n.kind==="source"?0:t.length,c=a-(n.kind==="source"?1:0),u;if(t.length>1)u=a===0?(0,_e.almostEquals)(t[0].x,t[1].x):(0,_e.almostEquals)(t[t.length-1].x,t[t.length-2].x);else{let d=r.getNearestSide(s);u=d===b.Side.TOP||d===b.Side.BOTTOM}if(u){if(s.y<n.get(b.Side.TOP).y||s.y>n.get(b.Side.BOTTOM).y){let d={x:n.get(b.Side.TOP).x,y:s.y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof xm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}else if(s.x<n.get(b.Side.LEFT).x||s.x>n.get(b.Side.RIGHT).x){let d={x:s.x,y:n.get(b.Side.LEFT).y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof xm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}manhattanify(e,t){for(let n=1;n<t.length;++n){let r=Math.abs(t[n-1].x-t[n].x)<1,o=Math.abs(t[n-1].y-t[n].y)<1;!r&&!o&&(t.splice(n,0,{x:t[n-1].x,y:t[n].y}),++n)}}calculateDefaultCorners(e,t,n,r){let o=super.calculateDefaultCorners(e,t,n,r);if(o.length>0)return o;let s=this.getBestConnectionAnchors(e,t,n,r),a=s.source,c=s.target,u=[],d=t.get(a),l=n.get(c);switch(a){case b.Side.RIGHT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;case b.Side.RIGHT:u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:d.y}),u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:l.y});break;case b.Side.LEFT:l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.LEFT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;default:l=n.get(b.Side.RIGHT),l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.TOP:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.TOP:u.push({x:d.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance}),u.push({x:l.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance});break;case b.Side.BOTTOM:l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break;case b.Side.BOTTOM:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;default:l=n.get(b.Side.TOP),l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break}return u}getBestConnectionAnchors(e,t,n,r){let o=t.get(b.Side.RIGHT),s=n.get(b.Side.LEFT);if(s.x-o.x>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.LEFT};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.RIGHT),o.x-s.x>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.RIGHT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.BOTTOM),o.y-s.y>r.standardDistance)return{source:b.Side.TOP,target:b.Side.BOTTOM};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.TOP),s.y-o.y>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.TOP};if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.TOP),s.x-o.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.TOP};if(s=n.get(b.Side.BOTTOM),s.x-o.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.BOTTOM};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.BOTTOM),o.x-s.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.BOTTOM};if(s=n.get(b.Side.TOP),o.x-s.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.TOP};if(o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),o.y-s.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),o.y-s.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.LEFT};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),s.y-o.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),s.y-o.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.LEFT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.TOP),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)){if(o.y-s.y<0){if(Math.abs(o.x-s.x)>(t.bounds.width+r.standardDistance)/2)return{source:b.Side.TOP,target:b.Side.TOP}}else if(Math.abs(o.x-s.x)>n.bounds.width/2)return{source:b.Side.TOP,target:b.Side.TOP}}if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.RIGHT),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)){if(o.x-s.x>0){if(Math.abs(o.y-s.y)>(t.bounds.height+r.standardDistance)/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}else if(Math.abs(o.y-s.y)>n.bounds.height/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}return o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.LEFT}:(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!_e.Bounds.includes(n.bounds,o)&&!_e.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.LEFT}:{source:b.Side.RIGHT,target:b.Side.BOTTOM})))}};Al.ManhattanEdgeRouter=os;os.KIND="manhattan"});var Vm=f(Vn=>{"use strict";var Nm=Vn&&Vn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Dm,qm,jm;Object.defineProperty(Vn,"__esModule",{value:!0});Vn.ManhattanEllipticAnchor=Vn.ManhattanDiamondAnchor=Vn.ManhattanRectangularAnchor=void 0;var xl=Q(),Bt=Or(),Lm=ii(),Bm=Cl(),Fm=_(),Dl=Dm=class{get kind(){return Dm.KIND}getAnchor(e,t,n){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n};return t.x>=o.x&&o.x+o.width>=t.x?t.y<o.y+.5*o.height?{x:t.x,y:o.y}:{x:t.x,y:o.y+o.height}:t.y>=o.y&&o.y+o.height>=t.y?t.x<o.x+.5*o.width?{x:o.x,y:t.y}:{x:o.x+o.width,y:t.y}:xl.Bounds.center(o)}};Dl.KIND=Bm.ManhattanEdgeRouter.KIND+":"+Lm.RECTANGULAR_ANCHOR_KIND;Dl=Dm=Nm([(0,Fm.injectable)()],Dl);Vn.ManhattanRectangularAnchor=Dl;var ql=qm=class{get kind(){return qm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=xl.Bounds.center(o),a,c;return t.x>=o.x&&t.x<=o.x+o.width?o.x+.5*o.width>=t.x?(c=new Bt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height})):(c=new Bt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height})):t.y>=o.y&&t.y<=o.y+o.height&&(o.y+.5*o.height>=t.y?(c=new Bt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y})):(c=new Bt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height}))),c&&a?(0,Bt.intersection)(a,c):s}};ql.KIND=Bm.ManhattanEdgeRouter.KIND+":"+Lm.DIAMOND_ANCHOR_KIND;ql=qm=Nm([(0,Fm.injectable)()],ql);Vn.ManhattanDiamondAnchor=ql;var jl=jm=class{get kind(){return jm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=xl.Bounds.center(o),a=xl.Point.subtract(t,s),c=s.x,u=s.y;if(t.x>=o.x&&o.x+o.width>=t.x){c+=a.x;let d=.5*o.height*Math.sqrt(1-a.x*a.x/(.25*o.width*o.width));a.y<0?u-=d:u+=d}else if(t.y>=o.y&&o.y+o.height>=t.y){u+=a.y;let d=.5*o.width*Math.sqrt(1-a.y*a.y/(.25*o.height*o.height));a.x<0?c-=d:c+=d}return{x:c,y:u}}};jl.KIND=Bm.ManhattanEdgeRouter.KIND+":"+Lm.ELLIPTIC_ANCHOR_KIND;jl=jm=Nm([(0,Fm.injectable)()],jl);Vn.ManhattanEllipticAnchor=jl});var Hm=f(ss=>{"use strict";var Nj=ss&&ss.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ss,"__esModule",{value:!0});ss.RoutableView=void 0;var Lj=_(),Bj=ye(),Km=class{isVisible(e,t,n){if(n.targetKind==="hidden"||t.length===0)return!0;let r=(0,Bj.getAbsoluteRouteBounds)(e,t),o=e.root.canvasBounds;return r.x<=o.width&&r.x+r.width>=0&&r.y<=o.height&&r.y+r.height>=0}};Km=Nj([(0,Lj.injectable)()],Km);ss.RoutableView=Km});var zm=f(Yi=>{"use strict";var YE=Yi&&Yi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Fj=Yi&&Yi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Yi,"__esModule",{value:!0});Yi.ModelRequestCommand=void 0;var kE=_(),Vj=P(),Kj=ge(),Nl=class extends Kj.SystemCommand{execute(e){let t=this.retrieveResult(e);return this.actionDispatcher.dispatch(t),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};YE([(0,kE.inject)(Vj.TYPES.IActionDispatcher),Fj("design:type",Object)],Nl.prototype,"actionDispatcher",void 0);Nl=YE([(0,kE.injectable)()],Nl);Yi.ModelRequestCommand=Nl});var Ul=f(re=>{"use strict";var zl=re&&re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Yl=re&&re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Gm=re&&re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(re,"__esModule",{value:!0});re.SelectKeyboardListener=re.GetSelectionCommand=re.SelectMouseListener=re.SelectAllCommand=re.SelectCommand=re.SelectionResult=re.GetSelectionAction=re.SelectAllAction=re.SelectAction=void 0;var ki=_(),kl=te(),WE=ge(),Hj=zm(),km=G(),Ym=He(),Wm=P(),zj=an(),Yj=Tt(),kj=Le(),UE=In(),$E=rr(),Uj=Rn(),GE=ga(),Gj=md(),Ll=Na(),Wj=ye(),Bl=ye(),ci=Et(),Kn=class{constructor(e=[],t=[]){this.selectedElementsIDs=e,this.deselectedElementsIDs=t,this.kind=Kn.KIND}};re.SelectAction=Kn;Kn.KIND="elementSelected";var jr=class{constructor(e=!0){this.select=e,this.kind=jr.KIND}};re.SelectAllAction=jr;jr.KIND="allSelected";var XE;(function(i){i.KIND="getSelection";function e(){return{kind:i.KIND,requestId:(0,kl.generateRequestId)()}}i.create=e})(XE=re.GetSelectionAction||(re.GetSelectionAction={}));var JE;(function(i){i.KIND="selectionResult";function e(t,n){return{kind:i.KIND,selectedElementsIDs:t,responseId:n}}i.create=e})(JE=re.SelectionResult||(re.SelectionResult={}));var Fl=class extends WE.Command{constructor(e){super(),this.action=e,this.selected=[],this.deselected=[]}execute(e){let t=e.root;return this.action.selectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof km.SChildElement&&(0,ci.isSelectable)(r)&&this.selected.push(r)}),this.action.deselectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof km.SChildElement&&(0,ci.isSelectable)(r)&&this.deselected.push(r)}),this.redo(e)}undo(e){for(let t of this.selected)t.selected=!1;for(let t of this.deselected)t.selected=!0;return e.root}redo(e){for(let t of this.deselected)t.selected=!1;for(let t of this.selected)t.selected=!0;return e.root}};Fl.KIND=kl.SelectAction.KIND;Fl=zl([(0,ki.injectable)(),Gm(0,(0,ki.inject)(Wm.TYPES.Action)),Yl("design:paramtypes",[Object])],Fl);re.SelectCommand=Fl;var Vl=class extends WE.Command{constructor(e){super(),this.action=e,this.previousSelection={}}execute(e){return this.selectAll(e.root,this.action.select),e.root}selectAll(e,t){(0,ci.isSelectable)(e)&&(this.previousSelection[e.id]=e.selected,e.selected=t);for(let n of e.children)this.selectAll(n,t)}undo(e){let t=e.root.index;return Object.keys(this.previousSelection).forEach(n=>{let r=t.getById(n);r!==void 0&&(0,ci.isSelectable)(r)&&(r.selected=this.previousSelection[n])}),e.root}redo(e){return this.selectAll(e.root,this.action.select),e.root}};Vl.KIND=kl.SelectAllAction.KIND;Vl=zl([(0,ki.injectable)(),Gm(0,(0,ki.inject)(Wm.TYPES.Action)),Yl("design:paramtypes",[Object])],Vl);re.SelectAllCommand=Vl;var Kl=class extends Yj.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1}mouseDown(e,t){if(t.button!==0)return[];let n=this.handleButton(e,t);if(n)return n;let r=(0,Ym.findParentByFeature)(e,ci.isSelectable);if(r!==void 0||e instanceof km.SModelRoot){this.hasDragged=!1;let o=[];if((0,UE.isCtrlOrCmd)(t)||(o=(0,$E.toArray)(e.root.index.all().filter(s=>(0,ci.isSelectable)(s)&&s.selected&&!(r instanceof Wj.SRoutingHandle&&s===r.parent)))),r!==void 0)if(r.selected){if((0,UE.isCtrlOrCmd)(t))return this.wasSelected=!1,this.handleDeselectTarget(r,t);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(r,o,t);else return this.handleDeselectAll(o,t)}return[]}handleButton(e,t){if(this.buttonHandlerRegistry!==void 0&&e instanceof Gj.SButton&&e.enabled){let n=this.buttonHandlerRegistry.get(e.type);if(n!==void 0)return n.buttonPressed(e)}}handleSelectTarget(e,t,n){let r=[];r.push(new Kn([e.id],t.map(s=>s.id))),r.push(kl.BringToFrontAction.create([e.id]));let o=t.filter(s=>s instanceof Bl.SRoutableElement).map(s=>s.id);return e instanceof Bl.SRoutableElement?r.push(Ll.SwitchEditModeAction.create({elementsToActivate:[e.id],elementsToDeactivate:o})):o.length>0&&r.push(Ll.SwitchEditModeAction.create({elementsToDeactivate:o})),r}handleDeselectTarget(e,t){let n=[];return n.push(new Kn([],[e.id])),e instanceof Bl.SRoutableElement&&n.push(Ll.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),n}handleDeselectAll(e,t){let n=[];n.push(new Kn([],e.map(o=>o.id)));let r=e.filter(o=>o instanceof Bl.SRoutableElement).map(o=>o.id);return r.length>0&&n.push(Ll.SwitchEditModeAction.create({elementsToDeactivate:r})),n}mouseMove(e,t){return this.hasDragged=!0,[]}mouseUp(e,t){if(t.button===0&&!this.hasDragged){let n=(0,Ym.findParentByFeature)(e,ci.isSelectable);if(n!==void 0&&this.wasSelected)return[new Kn([n.id],[])]}return this.hasDragged=!1,[]}decorate(e,t){let n=(0,Ym.findParentByFeature)(t,ci.isSelectable);return n!==void 0&&(0,kj.setClass)(e,"selected",n.selected),e}};zl([(0,ki.inject)(GE.ButtonHandlerRegistry),(0,ki.optional)(),Yl("design:type",GE.ButtonHandlerRegistry)],Kl.prototype,"buttonHandlerRegistry",void 0);re.SelectMouseListener=Kl;var Hl=class extends Hj.ModelRequestCommand{constructor(e){super(),this.action=e,this.previousSelection={}}retrieveResult(e){let t=e.root.index.all().filter(n=>(0,ci.isSelectable)(n)&&n.selected).map(n=>n.id);return JE.create((0,$E.toArray)(t),this.action.requestId)}};Hl.KIND=XE.KIND;Hl=zl([(0,ki.injectable)(),Gm(0,(0,ki.inject)(Wm.TYPES.Action)),Yl("design:paramtypes",[Object])],Hl);re.GetSelectionCommand=Hl;var Um=class extends zj.KeyListener{keyDown(e,t){return(0,Uj.matchesKeystroke)(t,"KeyA","ctrlCmd")?[new jr]:[]}};re.SelectKeyboardListener=Um});var Jm=f(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.UndoRedoKeyListener=Hn.RedoAction=Hn.UndoAction=void 0;var $m=Rn(),$j=an(),Xj=In(),ZE;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(ZE=Hn.UndoAction||(Hn.UndoAction={}));var QE;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(QE=Hn.RedoAction||(Hn.RedoAction={}));var Xm=class extends $j.KeyListener{keyDown(e,t){return(0,$m.matchesKeystroke)(t,"KeyZ","ctrlCmd")?[ZE.create()]:(0,$m.matchesKeystroke)(t,"KeyZ","ctrlCmd","shift")||!(0,Xj.isMac)()&&(0,$m.matchesKeystroke)(t,"KeyY","ctrlCmd")?[QE.create()]:[]}};Hn.UndoRedoKeyListener=Xm});var Gl=f(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.applyMatches=Ui.ModelMatcher=Ui.forEachMatch=void 0;var Zm=G(),Jj=fr();function Zj(i,e){Object.keys(i).forEach(t=>e(t,i[t]))}Ui.forEachMatch=Zj;var Qm=class{match(e,t){let n={};return this.matchLeft(e,n),this.matchRight(t,n),n}matchLeft(e,t,n){let r=t[e.id];if(r!==void 0?(r.left=e,r.leftParentId=n):(r={left:e,leftParentId:n},t[e.id]=r),(0,Zm.isParent)(e))for(let o of e.children)this.matchLeft(o,t,e.id)}matchRight(e,t,n){let r=t[e.id];if(r!==void 0?(r.right=e,r.rightParentId=n):(r={right:e,rightParentId:n},t[e.id]=r),(0,Zm.isParent)(e))for(let o of e.children)this.matchRight(o,t,e.id)}};Ui.ModelMatcher=Qm;function Qj(i,e,t){i instanceof Zm.SModelRoot?t=i.index:t===void 0&&(t=new Jj.SModelIndex,t.add(i));for(let n of e){let r=!1;if(n.left!==void 0&&n.leftParentId!==void 0){let o=t.getById(n.leftParentId);if(o!==void 0&&o.children!==void 0){let s=o.children.indexOf(n.left);s>=0&&(n.right!==void 0&&n.leftParentId===n.rightParentId?(o.children.splice(s,1,n.right),r=!0):o.children.splice(s,1)),t.remove(n.left)}}if(!r&&n.right!==void 0&&n.rightParentId!==void 0){let o=t.getById(n.rightParentId);o!==void 0&&(o.children===void 0&&(o.children=[]),o.children.push(n.right))}}}Ui.applyMatches=Qj});var ew=f(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});Wl.ResizeAnimation=void 0;var eN=cr(),ey=class extends eN.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementResizes=t,this.reverse=r}tween(e){return this.elementResizes.forEach(t=>{let n=t.element,r=this.reverse?{width:(1-e)*t.toDimension.width+e*t.fromDimension.width,height:(1-e)*t.toDimension.height+e*t.fromDimension.height}:{width:(1-e)*t.fromDimension.width+e*t.toDimension.width,height:(1-e)*t.fromDimension.height+e*t.toDimension.height};n.bounds={x:n.bounds.x,y:n.bounds.y,width:r.width,height:r.height}}),this.model}};Wl.ResizeAnimation=ey});var Xl=f(nn=>{"use strict";var fw=nn&&nn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},hw=nn&&nn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},tN=nn&&nn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(nn,"__esModule",{value:!0});nn.UpdateModelCommand=nn.UpdateModelAction=void 0;var $l=_(),nN=te(),as=Q(),tw=cr(),iN=ge(),rN=ul(),cs=G(),nw=$a(),iw=xo(),rw=xi(),ow=ce(),sw=Cd(),aw=Et(),cw=Gl(),oN=ew(),sN=P(),uw=An(),dw=fn(),lw=ye(),aN=He(),us=class{constructor(e,t=!0,n){this.animate=t,this.cause=n,this.kind=us.KIND,e.id!==void 0?this.newRoot=e:this.matches=e}};nn.UpdateModelAction=us;us.KIND="updateModel";var Ja=class extends iN.Command{constructor(e){super(),this.action=e}execute(e){let t;return this.action.newRoot!==void 0?t=e.modelFactory.createRoot(this.action.newRoot):(t=e.modelFactory.createRoot(e.root),this.action.matches!==void 0&&this.applyMatches(t,this.action.matches,e)),this.oldRoot=e.root,this.newRoot=t,this.performUpdate(this.oldRoot,this.newRoot,e)}performUpdate(e,t,n){if((this.action.animate===void 0||this.action.animate)&&e.id===t.id){let r;this.action.matches===void 0?r=new cw.ModelMatcher().match(e,t):r=this.convertToMatchResult(this.action.matches,e,t);let o=this.computeAnimation(t,r,n);return o instanceof tw.Animation?o.start():o}else return e.type===t.type&&as.Dimension.isValid(e.canvasBounds)&&(t.canvasBounds=e.canvasBounds),(0,uw.isViewport)(e)&&(0,uw.isViewport)(t)&&(t.zoom=e.zoom,t.scroll=e.scroll),t}applyMatches(e,t,n){let r=e.index;for(let o of t)if(o.left!==void 0){let s=r.getById(o.left.id);s instanceof cs.SChildElement&&s.parent.remove(s)}for(let o of t)if(o.right!==void 0){let s=n.modelFactory.createElement(o.right),a;o.rightParentId!==void 0&&(a=r.getById(o.rightParentId)),a instanceof cs.SParentElement?a.add(s):e.add(s)}}convertToMatchResult(e,t,n){let r={};for(let o of e){let s={},a;o.left!==void 0&&(a=o.left.id,s.left=t.index.getById(a),s.leftParentId=o.leftParentId),o.right!==void 0&&(a=o.right.id,s.right=n.index.getById(a),s.rightParentId=o.rightParentId),a!==void 0&&(r[a]=s)}return r}computeAnimation(e,t,n){let r={fades:[]};(0,cw.forEachMatch)(t,(s,a)=>{if(a.left!==void 0&&a.right!==void 0)this.updateElement(a.left,a.right,r);else if(a.right!==void 0){let c=a.right;(0,iw.isFadeable)(c)&&(c.opacity=0,r.fades.push({element:c,type:"in"}))}else if(a.left instanceof cs.SChildElement){let c=a.left;if((0,iw.isFadeable)(c)&&a.leftParentId!==void 0&&!(0,aN.containsSome)(e,c)){let u=e.index.getById(a.leftParentId);if(u instanceof cs.SParentElement){let d=n.modelFactory.createElement(c);u.add(d),r.fades.push({element:d,type:"out"})}}}});let o=this.createAnimations(r,e,n);return o.length>=2?new tw.CompoundAnimation(e,n,o):o.length===1?o[0]:e}updateElement(e,t,n){if((0,rw.isLocateable)(e)&&(0,rw.isLocateable)(t)){let r=e.position,o=t.position;(!(0,as.almostEquals)(r.x,o.x)||!(0,as.almostEquals)(r.y,o.y))&&(n.moves===void 0&&(n.moves=[]),n.moves.push({element:t,fromPosition:r,toPosition:o}),t.position=r)}(0,ow.isSizeable)(e)&&(0,ow.isSizeable)(t)&&(as.Dimension.isValid(t.bounds)?(!(0,as.almostEquals)(e.bounds.width,t.bounds.width)||!(0,as.almostEquals)(e.bounds.height,t.bounds.height))&&(n.resizes===void 0&&(n.resizes=[]),n.resizes.push({element:t,fromDimension:{width:e.bounds.width,height:e.bounds.height},toDimension:{width:t.bounds.width,height:t.bounds.height}})):t.bounds={x:t.bounds.x,y:t.bounds.y,width:e.bounds.width,height:e.bounds.height}),e instanceof lw.SRoutableElement&&t instanceof lw.SRoutableElement&&this.edgeRouterRegistry&&(n.edgeMementi===void 0&&(n.edgeMementi=[]),n.edgeMementi.push({edge:t,before:this.takeSnapshot(e),after:this.takeSnapshot(t)})),(0,aw.isSelectable)(e)&&(0,aw.isSelectable)(t)&&(t.selected=e.selected),e instanceof cs.SModelRoot&&t instanceof cs.SModelRoot&&(t.canvasBounds=e.canvasBounds),e instanceof sw.ViewportRootElement&&t instanceof sw.ViewportRootElement&&(t.scroll=e.scroll,t.zoom=e.zoom)}takeSnapshot(e){return this.edgeRouterRegistry.get(e.routerKind).takeSnapshot(e)}createAnimations(e,t,n){let r=[];if(e.fades.length>0&&r.push(new rN.FadeAnimation(t,e.fades,n,!0)),e.moves!==void 0&&e.moves.length>0){let o=new Map;for(let s of e.moves)o.set(s.element.id,s);r.push(new nw.MoveAnimation(t,o,n,!1))}if(e.resizes!==void 0&&e.resizes.length>0){let o=new Map;for(let s of e.resizes)o.set(s.element.id,s);r.push(new oN.ResizeAnimation(t,o,n,!1))}return e.edgeMementi!==void 0&&e.edgeMementi.length>0&&r.push(new nw.MorphEdgesAnimation(t,e.edgeMementi,n,!1)),r}undo(e){return this.performUpdate(this.newRoot,this.oldRoot,e)}redo(e){return this.performUpdate(this.oldRoot,this.newRoot,e)}};Ja.KIND=nN.UpdateModelAction.KIND;fw([(0,$l.inject)(dw.EdgeRouterRegistry),(0,$l.optional)(),hw("design:type",dw.EdgeRouterRegistry)],Ja.prototype,"edgeRouterRegistry",void 0);Ja=fw([(0,$l.injectable)(),tN(0,(0,$l.inject)(sN.TYPES.Action)),hw("design:paramtypes",[Object])],Ja);nn.UpdateModelCommand=Ja});var fs=f(Se=>{"use strict";var pw=Se&&Se.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gw=Se&&Se.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},mw=Se&&Se.__param||function(i,e){return function(t,n){e(t,n,i)}},ty;Object.defineProperty(Se,"__esModule",{value:!0});Se.ViewportAnimation=Se.GetViewportCommand=Se.SetViewportCommand=Se.ViewportResult=Se.GetViewportAction=Se.SetViewportAction=void 0;var ny=_(),yw=te(),cN=Q(),uN=ge(),dN=cr(),_w=An(),vw=P(),lN=zm(),ls=class{constructor(e,t,n){this.elementId=e,this.newViewport=t,this.animate=n,this.kind=ls.KIND}};Se.SetViewportAction=ls;ls.KIND="viewport";var bw;(function(i){i.KIND="getViewport";function e(){return{kind:i.KIND,requestId:(0,yw.generateRequestId)()}}i.create=e})(bw=Se.GetViewportAction||(Se.GetViewportAction={}));var Sw;(function(i){i.KIND="viewportResult";function e(t,n,r){return{kind:i.KIND,viewport:t,canvasBounds:n,responseId:r}}i.create=e})(Sw=Se.ViewportResult||(Se.ViewportResult={}));var Jl=ty=class extends uN.MergeableCommand{constructor(e){super(),this.action=e,this.newViewport=e.newViewport}execute(e){let t=e.root,n=t.index.getById(this.action.elementId);if(n&&(0,_w.isViewport)(n)){if(this.element=n,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom},this.action.animate)return new ds(this.element,this.oldViewport,this.newViewport,e).start();this.element.scroll=this.newViewport.scroll,this.element.zoom=this.newViewport.zoom}return t}undo(e){return new ds(this.element,this.newViewport,this.oldViewport,e).start()}redo(e){return new ds(this.element,this.oldViewport,this.newViewport,e).start()}merge(e,t){return!this.action.animate&&e instanceof ty&&this.element===e.element?(this.newViewport=e.newViewport,!0):!1}};Jl.KIND=yw.SetViewportAction.KIND;Jl=ty=pw([(0,ny.injectable)(),mw(0,(0,ny.inject)(vw.TYPES.Action)),gw("design:paramtypes",[Object])],Jl);Se.SetViewportCommand=Jl;var Zl=class extends lN.ModelRequestCommand{constructor(e){super(),this.action=e}retrieveResult(e){let t=e.root,n;return(0,_w.isViewport)(t)?n={scroll:t.scroll,zoom:t.zoom}:n={scroll:cN.Point.ORIGIN,zoom:1},Sw.create(n,t.canvasBounds,this.action.requestId)}};Zl.KIND=bw.KIND;Zl=pw([mw(0,(0,ny.inject)(vw.TYPES.Action)),gw("design:paramtypes",[Object])],Zl);Se.GetViewportCommand=Zl;var ds=class extends dN.Animation{constructor(e,t,n,r){super(r),this.element=e,this.oldViewport=t,this.newViewport=n,this.context=r,this.zoomFactor=Math.log(n.zoom/t.zoom)}tween(e,t){return this.element.scroll={x:(1-e)*this.oldViewport.scroll.x+e*this.newViewport.scroll.x,y:(1-e)*this.oldViewport.scroll.y+e*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(e*this.zoomFactor),t.root}};Se.ViewportAnimation=ds});var nf=f(Te=>{"use strict";var oy=Te&&Te.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},sy=Te&&Te.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Pw=Te&&Te.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Te,"__esModule",{value:!0});Te.CenterKeyboardListener=Te.FitToScreenCommand=Te.CenterCommand=Te.BoundsAwareViewportCommand=Te.FitToScreenAction=Te.CenterAction=void 0;var Iw=te(),hs=Q(),Ew=Rn(),fN=G(),hN=ge(),pN=an(),iy=ce(),gN=Et(),ww=fs(),Ql=An(),ay=_(),Rw=P(),Nr=class{constructor(e,t=!0,n=!1){this.elementIds=e,this.animate=t,this.retainZoom=n,this.kind=Nr.KIND}};Te.CenterAction=Nr;Nr.KIND="center";var Lr=class{constructor(e,t,n,r=!0){this.elementIds=e,this.padding=t,this.maxZoom=n,this.animate=r,this.kind=Lr.KIND}};Te.FitToScreenAction=Lr;Lr.KIND="fit";var Za=class extends hN.Command{constructor(e){super(),this.animate=e}initialize(e){if((0,Ql.isViewport)(e)){this.oldViewport={scroll:e.scroll,zoom:e.zoom};let t=[];if(this.getElementIds().forEach(n=>{let r=e.index.getById(n);r&&(0,iy.isBoundsAware)(r)&&t.push(this.boundsInViewport(r,r.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,gN.isSelectable)(n)&&n.selected&&(0,iy.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,iy.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length!==0){let n=t.reduce((r,o)=>hs.Bounds.combine(r,o));hs.Dimension.isValid(n)&&(this.newViewport=this.getNewViewport(n,e))}}}boundsInViewport(e,t,n){return e instanceof fN.SChildElement&&e.parent!==n?this.boundsInViewport(e.parent,e.parent.localToParent(t),n):t}execute(e){return this.initialize(e.root),this.redo(e)}undo(e){let t=e.root;if((0,Ql.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new ww.ViewportAnimation(t,this.newViewport,this.oldViewport,e).start();t.scroll=this.oldViewport.scroll,t.zoom=this.oldViewport.zoom}return t}redo(e){let t=e.root;if((0,Ql.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new ww.ViewportAnimation(t,this.oldViewport,this.newViewport,e).start();t.scroll=this.newViewport.scroll,t.zoom=this.newViewport.zoom}return t}equal(e,t){return e.zoom===t.zoom&&e.scroll.x===t.scroll.x&&e.scroll.y===t.scroll.y}};Za=oy([(0,ay.injectable)(),sy("design:paramtypes",[Boolean])],Za);Te.BoundsAwareViewportCommand=Za;var ef=class extends Za{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!hs.Dimension.isValid(t.canvasBounds))return;let n=this.action.retainZoom&&(0,Ql.isViewport)(t)?t.zoom:1,r=hs.Bounds.center(e);return{scroll:{x:r.x-.5*t.canvasBounds.width/n,y:r.y-.5*t.canvasBounds.height/n},zoom:n}}};ef.KIND=Iw.CenterAction.KIND;ef=oy([Pw(0,(0,ay.inject)(Rw.TYPES.Action)),sy("design:paramtypes",[Object])],ef);Te.CenterCommand=ef;var tf=class extends Za{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!hs.Dimension.isValid(t.canvasBounds))return;let n=hs.Bounds.center(e),r=this.action.padding===void 0?0:2*this.action.padding,o=Math.min(t.canvasBounds.width/(e.width+r),t.canvasBounds.height/(e.height+r));return this.action.maxZoom!==void 0&&(o=Math.min(o,this.action.maxZoom)),o===1/0&&(o=1),{scroll:{x:n.x-.5*t.canvasBounds.width/o,y:n.y-.5*t.canvasBounds.height/o},zoom:o}}};tf.KIND=Iw.FitToScreenAction.KIND;tf=oy([Pw(0,(0,ay.inject)(Rw.TYPES.Action)),sy("design:paramtypes",[Object])],tf);Te.FitToScreenCommand=tf;var ry=class extends pN.KeyListener{keyDown(e,t){return(0,Ew.matchesKeystroke)(t,"KeyC","ctrlCmd","shift")?[new Nr([])]:(0,Ew.matchesKeystroke)(t,"KeyF","ctrlCmd","shift")?[new Lr([])]:[]}};Te.CenterKeyboardListener=ry});var dy=f(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.ScrollMouseListener=ps.isScrollable=void 0;var cy=te(),mN=G(),yN=Tt(),Qa=He(),rf=An(),_N=xi(),vN=ye(),bN=wl(),SN=In();function EN(i){return"scroll"in i}ps.isScrollable=EN;var uy=class extends yN.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(e,t){if((0,Qa.findParentByFeature)(e,_N.isMoveable)===void 0&&!(e instanceof vN.SRoutingHandle)){let r=(0,Qa.findParentByFeature)(e,rf.isViewport);if(r){if(this.lastScrollPosition={x:t.pageX,y:t.pageY},this.scrollbar=this.getScrollbar(t),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(r,t,this.scrollbar,!0).map(o=>new Promise(s=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>s(o),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(e,t){if(t.buttons===0)return this.mouseUp(e,t);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);let n=(0,Qa.findParentByFeature)(e,rf.isViewport);if(n)return this.moveScrollBar(n,t,this.scrollbar)}if(this.lastScrollPosition){let n=(0,Qa.findParentByFeature)(e,rf.isViewport);if(n)return this.dragCanvas(n,t,this.lastScrollPosition)}return[]}mouseEnter(e,t){return e instanceof mN.SModelRoot&&t.buttons===0&&this.mouseUp(e,t),[]}mouseUp(e,t){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(e,t){if((0,Qa.findParentByFeature)(e,rf.isViewport)){let r=this.getScrollbar(t);if(r){window.clearTimeout(this.scrollbarMouseDownTimeout);let o=this.findClickTarget(r,t),s;if(o&&o.id.startsWith("horizontal-projection:")?s=o.id.substring(22):o&&o.id.startsWith("vertical-projection:")&&(s=o.id.substring(20)),s)return[cy.CenterAction.create([s],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(e,t,n){let r=(t.pageX-n.x)/e.zoom,o=(t.pageY-n.y)/e.zoom,s={scroll:{x:e.scroll.x-r,y:e.scroll.y-o},zoom:e.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[cy.SetViewportAction.create(e.id,s,{animate:!1})]}moveScrollBar(e,t,n,r=!1){let o=(0,bN.getModelBounds)(e);if(!o||e.zoom<=0)return[];let s=n.getBoundingClientRect(),a;if(this.getScrollbarOrientation(n)==="horizontal"){if(s.width<=0)return[];let c=e.canvasBounds.width/(e.zoom*o.width)*s.width,u=t.clientX-s.x-c/2;u<0?u=0:u>s.width-c&&(u=s.width-c),a={x:o.x+u/s.width*o.width,y:e.scroll.y}}else{if(s.height<=0)return[];let c=e.canvasBounds.height/(e.zoom*o.height)*s.height,u=t.clientY-s.y-c/2;u<0?u=0:u>s.height-c&&(u=s.height-c),a={x:e.scroll.x,y:o.y+u/s.height*o.height}}return[cy.SetViewportAction.create(e.id,{scroll:a,zoom:e.zoom},{animate:r})]}getScrollbar(e){let t=e.target;for(;t;){if(t.classList&&t.classList.contains("sprotty-projection-bar"))return t;t=t.parentElement}}getScrollbarOrientation(e){return e.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(e,t){let n=Array.from(e.children).filter(r=>r.id&&r.classList.contains("sprotty-projection")&&(0,SN.hitsMouseEvent)(r,t));if(n.length>0)return n[n.length-1]}};ps.ScrollMouseListener=uy});var ly=f(Ft=>{"use strict";var wN=Ft&&Ft.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},PN=Ft&&Ft.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},IN=Ft&&Ft.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.BringToFrontCommand=Ft.BringToFrontAction=void 0;var Mw=_(),RN=P(),Ow=G(),MN=ge(),Tw=ye(),Aw;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(Aw=Ft.BringToFrontAction||(Ft.BringToFrontAction={}));var of=class extends MN.Command{constructor(e){super(),this.action=e,this.selected=[]}execute(e){let t=e.root;return this.action.elementIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Tw.SRoutableElement&&(r.source&&this.addToSelection(r.source),r.target&&this.addToSelection(r.target)),r instanceof Ow.SChildElement&&this.addToSelection(r),this.includeConnectedEdges(r)}),this.redo(e)}includeConnectedEdges(e){if(e instanceof Tw.SConnectableElement&&(e.incomingEdges.forEach(t=>this.addToSelection(t)),e.outgoingEdges.forEach(t=>this.addToSelection(t))),e instanceof Ow.SParentElement)for(let t of e.children)this.includeConnectedEdges(t)}addToSelection(e){this.selected.push({element:e,index:e.parent.children.indexOf(e)})}undo(e){for(let t=this.selected.length-1;t>=0;t--){let n=this.selected[t],r=n.element;r.parent.move(r,n.index)}return e.root}redo(e){for(let t=0;t<this.selected.length;t++)this.bringToFront(this.selected[t]);return e.root}bringToFront(e){let t=e.element,n=t.parent.children.length;t.parent.move(t,n-1)}};of.KIND=Aw.KIND;of=wN([(0,Mw.injectable)(),IN(0,(0,Mw.inject)(RN.TYPES.Action)),PN("design:paramtypes",[Object])],of);Ft.BringToFrontCommand=of});var hy=f(gs=>{"use strict";var ON=gs&&gs.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(gs,"__esModule",{value:!0});gs.SGraphFactory=void 0;var TN=_(),Br=wi(),Gi=Pn(),sf=G(),rn=Ir(),Cw=md(),fy=class extends Gi.SModelFactory{constructor(){super(...arguments),this.defaultGraphFeatures=(0,Gi.createFeatureSet)(rn.SGraph.DEFAULT_FEATURES),this.defaultNodeFeatures=(0,Gi.createFeatureSet)(rn.SNode.DEFAULT_FEATURES),this.defaultPortFeatures=(0,Gi.createFeatureSet)(rn.SPort.DEFAULT_FEATURES),this.defaultEdgeFeatures=(0,Gi.createFeatureSet)(rn.SEdge.DEFAULT_FEATURES),this.defaultLabelFeatures=(0,Gi.createFeatureSet)(rn.SLabel.DEFAULT_FEATURES),this.defaultCompartmentFeatures=(0,Gi.createFeatureSet)(rn.SCompartment.DEFAULT_FEATURES),this.defaultButtonFeatures=(0,Gi.createFeatureSet)(Cw.SButton.DEFAULT_FEATURES)}createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof sf.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else this.isNodeSchema(e)?(n=new rn.SNode,n.features=this.defaultNodeFeatures):this.isPortSchema(e)?(n=new rn.SPort,n.features=this.defaultPortFeatures):this.isEdgeSchema(e)?(n=new rn.SEdge,n.features=this.defaultEdgeFeatures):this.isLabelSchema(e)?(n=new rn.SLabel,n.features=this.defaultLabelFeatures):this.isCompartmentSchema(e)?(n=new rn.SCompartment,n.features=this.defaultCompartmentFeatures):this.isButtonSchema(e)?(n=new Cw.SButton,n.features=this.defaultButtonFeatures):n=new sf.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof sf.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else this.isGraphSchema(e)?(t=new rn.SGraph,t.features=this.defaultGraphFeatures):t=new sf.SModelRoot;return this.initializeRoot(t,e)}isGraphSchema(e){return(0,Br.getBasicType)(e)==="graph"}isNodeSchema(e){return(0,Br.getBasicType)(e)==="node"}isPortSchema(e){return(0,Br.getBasicType)(e)==="port"}isEdgeSchema(e){return(0,Br.getBasicType)(e)==="edge"}isLabelSchema(e){return(0,Br.getBasicType)(e)==="label"}isCompartmentSchema(e){return(0,Br.getBasicType)(e)==="comp"}isButtonSchema(e){return(0,Br.getBasicType)(e)==="button"}};fy=ON([(0,TN.injectable)()],fy);gs.SGraphFactory=fy});var xw=f(py=>{"use strict";Object.defineProperty(py,"__esModule",{value:!0});var AN=_(),CN=P(),xN=hy(),DN=new AN.ContainerModule((i,e,t,n)=>{n(CN.TYPES.IModelFactory).to(xN.SGraphFactory).inSingletonScope()});py.default=DN});var yy=f(my=>{"use strict";Object.defineProperty(my,"__esModule",{value:!0});var qN=_(),gy=P(),Dw=id(),qw=bp(),ec=sd(),jw=yt(),Nw=Ip(),Lw=Pp(),Bw=Rp(),jN=new qN.ContainerModule((i,e,t)=>{(0,jw.configureCommand)({bind:i,isBound:t},Dw.SetBoundsCommand),(0,jw.configureCommand)({bind:i,isBound:t},Dw.RequestBoundsCommand),i(qw.HiddenBoundsUpdater).toSelf().inSingletonScope(),i(gy.TYPES.HiddenVNodePostprocessor).toService(qw.HiddenBoundsUpdater),i(gy.TYPES.Layouter).to(ec.Layouter).inSingletonScope(),i(gy.TYPES.LayoutRegistry).to(ec.LayoutRegistry).inSingletonScope(),(0,ec.configureLayout)({bind:i,isBound:t},Lw.VBoxLayouter.KIND,Lw.VBoxLayouter),(0,ec.configureLayout)({bind:i,isBound:t},Nw.HBoxLayouter.KIND,Nw.HBoxLayouter),(0,ec.configureLayout)({bind:i,isBound:t},Bw.StackLayouter.KIND,Bw.StackLayouter)});my.default=jN});var vy=f(_y=>{"use strict";Object.defineProperty(_y,"__esModule",{value:!0});var NN=_(),LN=ga(),BN=new NN.ContainerModule(i=>{i(LN.ButtonHandlerRegistry).toSelf().inSingletonScope()});_y.default=BN});var Ey=f(Sy=>{"use strict";Object.defineProperty(Sy,"__esModule",{value:!0});var FN=_(),by=P(),Fw=yd(),af=Hp(),VN=new FN.ContainerModule(i=>{i(af.CommandPalette).toSelf().inSingletonScope(),i(by.TYPES.IUIExtension).toService(af.CommandPalette),i(af.CommandPaletteKeyListener).toSelf().inSingletonScope(),i(by.TYPES.KeyListener).toService(af.CommandPaletteKeyListener),i(Fw.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),i(by.TYPES.ICommandPaletteActionProviderRegistry).toService(Fw.CommandPaletteActionProviderRegistry)});Sy.default=VN});var Py=f(wy=>{"use strict";Object.defineProperty(wy,"__esModule",{value:!0});var KN=_(),HN=wd(),Vw=Wp(),tc=P(),zN=new KN.ContainerModule(i=>{i(tc.TYPES.IContextMenuServiceProvider).toProvider(e=>()=>new Promise((t,n)=>{e.container.isBound(tc.TYPES.IContextMenuService)?t(e.container.get(tc.TYPES.IContextMenuService)):n()})),i(Vw.ContextMenuMouseListener).toSelf().inSingletonScope(),i(tc.TYPES.MouseListener).toService(Vw.ContextMenuMouseListener),i(tc.TYPES.IContextMenuProviderRegistry).to(HN.ContextMenuProviderRegistry)});wy.default=zN});var Ry=f(Iy=>{"use strict";Object.defineProperty(Iy,"__esModule",{value:!0});var YN=po(),kN=_(),UN=fl(),GN=Xg(),WN=P(),Kw=Jg(),$N=new kN.ContainerModule((i,e,t)=>{(0,YN.configureModelElement)({bind:i,isBound:t},"marker",UN.SIssueMarker,GN.IssueMarkerView),i(Kw.DecorationPlacer).toSelf().inSingletonScope(),i(WN.TYPES.IVNodePostprocessor).toService(Kw.DecorationPlacer)});Iy.default=$N});var zw=f(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});var XN=_(),JN=P(),Hw=gl(),ZN=new XN.ContainerModule(i=>{i(Hw.IntersectionFinder).toSelf().inSingletonScope(),i(JN.TYPES.IEdgeRoutePostprocessor).toService(Hw.IntersectionFinder)});My.default=ZN});var Ty=f(Oy=>{"use strict";Object.defineProperty(Oy,"__esModule",{value:!0});var QN=_(),eL=ga(),Yw=jg(),tL=new QN.ContainerModule((i,e,t)=>{(0,eL.configureButtonHandler)({bind:i,isBound:t},Yw.ExpandButtonHandler.TYPE,Yw.ExpandButtonHandler)});Oy.default=tL});var xy=f(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var nL=_(),Ay=P(),cf=Fg(),iL=Tr(),rL=yt(),oL=new nL.ContainerModule((i,e,t)=>{i(cf.ExportSvgKeyListener).toSelf().inSingletonScope(),i(Ay.TYPES.KeyListener).toService(cf.ExportSvgKeyListener),i(Ay.TYPES.HiddenVNodePostprocessor).to(cf.ExportSvgPostprocessor).inSingletonScope(),(0,rL.configureCommand)({bind:i,isBound:t},cf.ExportSvgCommand),i(Ay.TYPES.SvgExporter).to(iL.SvgExporter).inSingletonScope()});Cy.default=oL});var qy=f(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});var sL=_(),aL=P(),cL=ul(),uL=new sL.ContainerModule(i=>{i(aL.TYPES.IVNodePostprocessor).to(cL.ElementFader).inSingletonScope()});Dy.default=uL});var Gw=f(Wi=>{"use strict";var kw=Wi&&Wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},dL=Wi&&Wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.PopupPositionUpdater=void 0;var Uw=_(),lL=P(),uf=class{decorate(e,t){return e}postUpdate(){let e=document.getElementById(this.options.popupDiv);if(e!==null&&typeof window<"u"){let t=e.getBoundingClientRect();window.innerHeight<t.height+t.top&&(e.style.top=window.pageYOffset+window.innerHeight-t.height-5+"px"),window.innerWidth<t.left+t.width&&(e.style.left=window.pageXOffset+window.innerWidth-t.width-5+"px"),t.left<0&&(e.style.left="0px"),t.top<0&&(e.style.top="0px")}}};kw([(0,Uw.inject)(lL.TYPES.ViewerOptions),dL("design:type",Object)],uf.prototype,"options",void 0);uf=kw([(0,Uw.injectable)()],uf);Wi.PopupPositionUpdater=uf});var Ny=f(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});var fL=_(),nc=P(),ft=kg(),hL=Gw(),Ww=yt(),ic=Hs(),$w=nf(),pL=fs(),gL=$a(),mL=new fL.ContainerModule((i,e,t)=>{i(nc.TYPES.PopupVNodePostprocessor).to(hL.PopupPositionUpdater).inSingletonScope(),i(ft.HoverMouseListener).toSelf().inSingletonScope(),i(nc.TYPES.MouseListener).toService(ft.HoverMouseListener),i(ft.PopupHoverMouseListener).toSelf().inSingletonScope(),i(nc.TYPES.PopupMouseListener).toService(ft.PopupHoverMouseListener),i(ft.HoverKeyListener).toSelf().inSingletonScope(),i(nc.TYPES.KeyListener).toService(ft.HoverKeyListener),i(nc.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),i(ft.ClosePopupActionHandler).toSelf().inSingletonScope();let n={bind:i,isBound:t};(0,Ww.configureCommand)(n,ft.HoverFeedbackCommand),(0,Ww.configureCommand)(n,ft.SetPopupModelCommand),(0,ic.configureActionHandler)(n,ft.SetPopupModelCommand.KIND,ft.ClosePopupActionHandler),(0,ic.configureActionHandler)(n,$w.FitToScreenCommand.KIND,ft.ClosePopupActionHandler),(0,ic.configureActionHandler)(n,$w.CenterCommand.KIND,ft.ClosePopupActionHandler),(0,ic.configureActionHandler)(n,pL.SetViewportCommand.KIND,ft.ClosePopupActionHandler),(0,ic.configureActionHandler)(n,gL.MoveCommand.KIND,ft.ClosePopupActionHandler)});jy.default=mL});var Fy=f(By=>{"use strict";Object.defineProperty(By,"__esModule",{value:!0});var yL=_(),Ly=P(),ms=$a(),_L=yt(),vL=new yL.ContainerModule((i,e,t)=>{i(ms.MoveMouseListener).toSelf().inSingletonScope(),i(Ly.TYPES.MouseListener).toService(ms.MoveMouseListener),(0,_L.configureCommand)({bind:i,isBound:t},ms.MoveCommand),i(ms.LocationPostprocessor).toSelf().inSingletonScope(),i(Ly.TYPES.IVNodePostprocessor).toService(ms.LocationPostprocessor),i(Ly.TYPES.HiddenVNodePostprocessor).toService(ms.LocationPostprocessor)});By.default=vL});var Ky=f(Vy=>{"use strict";Object.defineProperty(Vy,"__esModule",{value:!0});var bL=_(),SL=P(),Xw=lm(),EL=new bL.ContainerModule(i=>{i(Xw.OpenMouseListener).toSelf().inSingletonScope(),i(SL.TYPES.MouseListener).toService(Xw.OpenMouseListener)});Vy.default=EL});var Gy=f(Uy=>{"use strict";Object.defineProperty(Uy,"__esModule",{value:!0});var wL=_(),on=P(),Jw=Cl(),Zw=Ra(),Hy=Vm(),zy=Il(),PL=ii(),IL=fn(),Yy=Tl(),ky=Cm(),RL=yt(),ML=new wL.ContainerModule((i,e,t)=>{i(IL.EdgeRouterRegistry).toSelf().inSingletonScope(),i(PL.AnchorComputerRegistry).toSelf().inSingletonScope(),i(Jw.ManhattanEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Jw.ManhattanEdgeRouter),i(on.TYPES.IAnchorComputer).to(Hy.ManhattanEllipticAnchor).inSingletonScope(),i(on.TYPES.IAnchorComputer).to(Hy.ManhattanRectangularAnchor).inSingletonScope(),i(on.TYPES.IAnchorComputer).to(Hy.ManhattanDiamondAnchor).inSingletonScope(),i(Zw.PolylineEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Zw.PolylineEdgeRouter),i(on.TYPES.IAnchorComputer).to(zy.EllipseAnchor),i(on.TYPES.IAnchorComputer).to(zy.RectangleAnchor),i(on.TYPES.IAnchorComputer).to(zy.DiamondAnchor),i(Yy.BezierEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Yy.BezierEdgeRouter),i(on.TYPES.IAnchorComputer).to(ky.BezierEllipseAnchor),i(on.TYPES.IAnchorComputer).to(ky.BezierRectangleAnchor),i(on.TYPES.IAnchorComputer).to(ky.BezierDiamondAnchor),(0,RL.configureCommand)({bind:i,isBound:t},Yy.AddRemoveBezierSegmentCommand)});Uy.default=ML});var Xy=f($y=>{"use strict";Object.defineProperty($y,"__esModule",{value:!0});var OL=_(),Qw=P(),Fr=Ul(),Wy=yt(),TL=new OL.ContainerModule((i,e,t)=>{(0,Wy.configureCommand)({bind:i,isBound:t},Fr.SelectCommand),(0,Wy.configureCommand)({bind:i,isBound:t},Fr.SelectAllCommand),(0,Wy.configureCommand)({bind:i,isBound:t},Fr.GetSelectionCommand),i(Fr.SelectKeyboardListener).toSelf().inSingletonScope(),i(Qw.TYPES.KeyListener).toService(Fr.SelectKeyboardListener),i(Fr.SelectMouseListener).toSelf().inSingletonScope(),i(Qw.TYPES.MouseListener).toService(Fr.SelectMouseListener)});$y.default=TL});var Zy=f(Jy=>{"use strict";Object.defineProperty(Jy,"__esModule",{value:!0});var AL=_(),CL=P(),eP=Jm(),xL=new AL.ContainerModule(i=>{i(eP.UndoRedoKeyListener).toSelf().inSingletonScope(),i(CL.TYPES.KeyListener).toService(eP.UndoRedoKeyListener)});Jy.default=xL});var e_=f(Qy=>{"use strict";Object.defineProperty(Qy,"__esModule",{value:!0});var DL=_(),qL=yt(),jL=Xl(),NL=new DL.ContainerModule((i,e,t)=>{(0,qL.configureCommand)({bind:i,isBound:t},jL.UpdateModelCommand)});Qy.default=NL});var i_=f(n_=>{"use strict";Object.defineProperty(n_,"__esModule",{value:!0});var LL=_(),t_=P(),df=nf(),tP=fs(),nP=dy(),iP=Qd(),lf=yt(),BL=new LL.ContainerModule((i,e,t)=>{(0,lf.configureCommand)({bind:i,isBound:t},df.CenterCommand),(0,lf.configureCommand)({bind:i,isBound:t},df.FitToScreenCommand),(0,lf.configureCommand)({bind:i,isBound:t},tP.SetViewportCommand),(0,lf.configureCommand)({bind:i,isBound:t},tP.GetViewportCommand),i(df.CenterKeyboardListener).toSelf().inSingletonScope(),i(t_.TYPES.KeyListener).toService(df.CenterKeyboardListener),i(nP.ScrollMouseListener).toSelf().inSingletonScope(),i(iP.ZoomMouseListener).toSelf().inSingletonScope(),i(t_.TYPES.MouseListener).toService(nP.ScrollMouseListener),i(t_.TYPES.MouseListener).toService(iP.ZoomMouseListener)});n_.default=BL});var o_=f(r_=>{"use strict";Object.defineProperty(r_,"__esModule",{value:!0});var FL=_(),VL=yt(),KL=ly(),HL=new FL.ContainerModule((i,e,t)=>{(0,VL.configureCommand)({bind:i,isBound:t},KL.BringToFrontCommand)});r_.default=HL});var sP=f(de=>{"use strict";var Rt=de&&de.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gf=de&&de.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(de,"__esModule",{value:!0});de.SBezierControlHandleView=de.SBezierCreateHandleView=de.SCompartmentView=de.SLabelView=de.SRoutingHandleView=de.BezierCurveEdgeView=de.PolylineEdgeViewWithGapsOnIntersections=de.JumpingPolylineEdgeView=de.PolylineEdgeView=de.SGraphView=void 0;var Mt=_(),ys=Q(),rP=wi(),sc=Le(),zL=ha(),rc=gl(),YL=Lo(),mf=ye(),$i=fn(),oP=Hm(),pe=Gt(),kL=Or(),ff=class{render(e,t){let n=this.edgeRouterRegistry.routeAllChildren(e),r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,pe.svg)("svg",{"class-sprotty-graph":!0},(0,pe.svg)("g",{transform:r},t.renderChildren(e,{edgeRouting:n})))}};Rt([(0,Mt.inject)($i.EdgeRouterRegistry),gf("design:type",$i.EdgeRouterRegistry)],ff.prototype,"edgeRouterRegistry",void 0);ff=Rt([(0,Mt.injectable)()],ff);de.SGraphView=ff;var oc=class extends oP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,pe.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,pe.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o=t[0],s=`M ${o.x},${o.y}`;for(let a=1;a<t.length;a++){let c=t[a];s+=` L ${c.x},${c.y}`}return(0,pe.svg)("path",{d:s})}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,pe.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)($i.EdgeRouterRegistry),gf("design:type",$i.EdgeRouterRegistry)],oc.prototype,"edgeRouterRegistry",void 0);oc=Rt([(0,Mt.injectable)()],oc);de.PolylineEdgeView=oc;var hf=class extends oc{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(e,t,n,r){let o="";for(let s=0;s<t.length;s++){let a=t[s];s===0&&(o=`M ${a.x},${a.y}`),(0,rc.isIntersectingRoutedPoint)(a)&&(o+=this.intersectionPath(e,t,a,r)),s!==0&&(o+=` L ${a.x},${a.y}`)}return(0,pe.svg)("path",{d:o})}intersectionPath(e,t,n,r){if(n.intersections.length<1)return"";let o=this.getLineSegment(e,n.intersections[0],r,t),s=this.getIntersectionsSortedBySegmentDirection(o,n),a="";for(let c of s){let u=this.getOtherLineSegment(e,c,r);if(u===void 0)continue;let d=this.getLineSegment(e,c,r,t),l=c.intersectionPoint;this.shouldDrawLineJumpOnIntersection(d,u)?a+=this.createJumpPath(l,d):this.shouldDrawLineGapOnIntersection(d,u)&&(a+=this.createGapPath(l,d))}return a}getIntersectionsSortedBySegmentDirection(e,t){switch(e.direction){case"north":case"north-east":return t.intersections.sort(rc.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return t.intersections.sort(rc.BY_X_THEN_Y);case"south-west":case"west":return t.intersections.sort(rc.BY_DESCENDING_X_THEN_Y);case"north-west":return t.intersections.sort(rc.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(e,t){return Math.abs(e.slopeOrMax)<Math.abs(t.slopeOrMax)}shouldDrawLineGapOnIntersection(e,t){return!this.shouldDrawLineJumpOnIntersection(e,t)}getLineSegment(e,t,n,r){let o=r||this.edgeRouterRegistry.route(e,n),s=t.routable1===e.id?t.segmentIndex1:t.segmentIndex2;return new kL.PointToPointLine(o[s],o[s+1])}getOtherLineSegment(e,t,n){let r=t.routable1===e.id?t.routable2:t.routable1,o=e.index.getById(r);if(o instanceof mf.SRoutableElement)return this.getLineSegment(o,t,n)}createJumpPath(e,t){let n=ys.Point.shiftTowards(e,t.p1,this.jumpOffsetBefore),r=ys.Point.shiftTowards(e,t.p2,this.jumpOffsetAfter),o=t.p1.x<t.p2.x?1:0;return` L ${n.x},${n.y} A 1,1 0,0 ${o} ${r.x},${r.y}`}createGapPath(e,t){let n,r;e.y<t.p1.y?(n=-this.skipOffsetBefore,r=this.jumpOffsetAfter+this.skipOffsetAfter):(n=this.jumpOffsetBefore+this.skipOffsetAfter,r=-this.skipOffsetBefore);let o=ys.Point.shiftTowards(e,t.p1,n),s=ys.Point.shiftTowards(e,t.p2,r);return` L ${o.x},${o.y} M ${s.x},${s.y}`}};hf=Rt([(0,Mt.injectable)()],hf);de.JumpingPolylineEdgeView=hf;var s_=class extends hf{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(e,t){return!1}shouldDrawLineGapOnIntersection(e,t){return Math.abs(e.slopeOrMax)>=Math.abs(t.slopeOrMax)}createGapPath(e,t){let n=ys.Point.shiftTowards(e,t.p1,this.skipOffsetBefore),r=ys.Point.shiftTowards(e,t.p2,this.skipOffsetAfter);return` L ${n.x},${n.y} M ${r.x},${r.y}`}};s_=Rt([(0,Mt.injectable)()],s_);de.PolylineEdgeViewWithGapsOnIntersections=s_;var pf=class extends oP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,pe.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,pe.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o="";if(t.length>=4){o+=this.buildMainSegment(t);let s=t.length-4;if(s>0&&s%3===0)for(let a=4;a<t.length;a+=3)o+=this.addSpline(t,a)}return(0,pe.svg)("path",{d:o})}buildMainSegment(e){let t=e[0],n=e[1],r=e[2],o=e[3];return`M${t.x},${t.y} C${n.x},${n.y} ${r.x},${r.y} ${o.x},${o.y}`}addSpline(e,t){let n=e[t+1],r=e[t+2];return` S${n.x},${n.y} ${r.x},${r.y}`}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,pe.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)($i.EdgeRouterRegistry),gf("design:type",$i.EdgeRouterRegistry)],pf.prototype,"edgeRouterRegistry",void 0);pf=Rt([(0,Mt.injectable)()],pf);de.BezierCurveEdgeView=pf;var _s=class{constructor(){this.minimalPointDistance=10}render(e,t,n){if(n&&n.route&&e.parent instanceof mf.SRoutableElement){let r=this.edgeRouterRegistry.get(e.parent.routerKind),o=n.route===void 0?this.edgeRouterRegistry.route(e.parent,n):n.route,s=r.getHandlePosition(e.parent,o,e);if(s!==void 0){let a=(0,pe.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,sc.setAttr)(a,"data-kind",e.kind),a}}return(0,pe.svg)("g",null)}getRadius(){return 7}};Rt([(0,Mt.inject)($i.EdgeRouterRegistry),gf("design:type",$i.EdgeRouterRegistry)],_s.prototype,"edgeRouterRegistry",void 0);_s=Rt([(0,Mt.injectable)()],_s);de.SRoutingHandleView=_s;var a_=class extends zL.ShapeView{render(e,t){if(!(0,YL.isEdgeLayoutable)(e)&&!this.isVisible(e,t))return;let n=(0,pe.svg)("text",{"class-sprotty-label":!0},e.text),r=(0,rP.getSubType)(e);return r&&(0,sc.setAttr)(n,"class",r),n}};a_=Rt([(0,Mt.injectable)()],a_);de.SLabelView=a_;var c_=class{render(e,t,n){let r=`translate(${e.bounds.x}, ${e.bounds.y})`,o=(0,pe.svg)("g",{transform:r,"class-sprotty-comp":"{true}"},t.renderChildren(e)),s=(0,rP.getSubType)(e);return s&&(0,sc.setAttr)(o,"class",s),o}};c_=Rt([(0,Mt.injectable)()],c_);de.SCompartmentView=c_;var u_=class extends _s{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof mf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a="translate("+s.x+", "+s.y+")",c=-5.5,u=5.5,d=e.kind==="bezier-add"?"+":"-",l=(0,pe.svg)("g",{transform:a,"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,pe.svg)("circle",{r:this.getRadius()}),(0,pe.svg)("text",{x:c,y:u,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},d));return(0,sc.setAttr)(l,"data-kind",e.kind),l}}}return(0,pe.svg)("g",null)}};u_=Rt([(0,Mt.injectable)()],u_);de.SBezierCreateHandleView=u_;var d_=class extends _s{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof mf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a;for(let u=0;u<r.length;u++){let d=r[u];if(d.kind===s.kind&&d.pointIndex===s.pointIndex){e.kind==="bezier-control-before"?a=r[u+1]:a=r[u-1];break}}let c;if(a){let u=`M ${s.x}, ${s.y} L ${a.x}, ${a.y}`;c=(0,pe.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,pe.svg)("path",{d:u,stroke:"grey","style-stroke-width":"2px"}),(0,pe.svg)("circle",{cx:s.x,cy:s.y,r:this.getRadius()}))}else c=(0,pe.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,sc.setAttr)(c,"data-kind",e.kind),c}}}return(0,pe.svg)("g",null)}};d_=Rt([(0,Mt.injectable)()],d_);de.SBezierControlHandleView=d_});var f_=f(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});var UL=_(),GL=yt(),yf=P(),WL=xa(),$L=zo(),XL=new UL.ContainerModule((i,e,t)=>{i(yf.TYPES.ModelSourceProvider).toProvider(n=>()=>new Promise(r=>{r(n.container.get(yf.TYPES.ModelSource))})),(0,GL.configureCommand)({bind:i,isBound:t},WL.CommitModelCommand),i(yf.TYPES.IActionHandlerInitializer).toService(yf.TYPES.ModelSource),i($L.ComputedBoundsApplicator).toSelf().inSingletonScope()});l_.default=XL});var aP=f(vs=>{"use strict";var Ae=vs&&vs.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vs,"__esModule",{value:!0});vs.loadDefaultModules=void 0;var JL=Ae(gp()),ZL=Ae(f_()),QL=Ae(yy()),eB=Ae(vy()),tB=Ae(Ey()),nB=Ae(Py()),iB=Ae(Ry()),rB=Ae(Hd()),h_=qg(),oB=Ae(Ty()),sB=Ae(xy()),aB=Ae(qy()),cB=Ae(Ny()),uB=Ae(Fy()),dB=Ae(Ky()),lB=Ae(Gy()),fB=Ae(Xy()),hB=Ae(Zy()),pB=Ae(e_()),gB=Ae(i_()),mB=Ae(o_());function yB(i,e){let t=[JL.default,ZL.default,QL.default,eB.default,tB.default,nB.default,iB.default,h_.edgeEditModule,rB.default,oB.default,sB.default,aB.default,cB.default,h_.labelEditModule,h_.labelEditUiModule,uB.default,dB.default,lB.default,fB.default,hB.default,pB.default,gB.default,mB.default];if(e&&e.exclude)for(let n of e.exclude){let r=t.indexOf(n);r>=0&&t.splice(r,1)}i.load(...t)}vs.loadDefaultModules=yB});var cP=f(g_=>{"use strict";Object.defineProperty(g_,"__esModule",{value:!0});var _f=ho();function _B(i){let e={},t=(s,a)=>{if(a!=="style"&&a!=="class"){let c=wB(i[a]);s?s[a]=c:s={[a]:c}}return s},n=Object.keys(i).reduce(t,null);n&&(e.attrs=n);let r=vB(i);r&&(e.style=r);let o=bB(i);return o&&(e.class=o),e}function vB(i){let e=(t,n)=>{let r=n.split(":"),o=SB(r[0].trim());if(o){let s=r[1].replace("!important","").trim();t?t[o]=s:t={[o]:s}}return t};try{return i.style.split(";").reduce(e,null)}catch{return null}}function bB(i){let e=(t,n)=>(n=n.trim(),n&&(t?t[n]=!0:t={[n]:!0}),t);try{return i.class.split(" ").reduce(e,null)}catch{return null}}function SB(i){return i=i.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),`${i.charAt(0).toLowerCase()}${i.substring(1)}`}var EB=new RegExp("&[a-z0-9#]+;","gi"),bs=null;function wB(i){return bs||(bs=document.createElement("div")),i.replace(EB,e=>bs===null?"":(bs.innerHTML=e,bs.textContent===null?"":bs.textContent))}function PB(i,e){let t=i,n=null,r=[],o=s=>{let a=s.firstChild;a!==null&&(n=s),t=a};for(e(t,n),o(t);;){for(;t;)r.push(t),e(t,n),o(t);let s=r.pop();if(t=s||null,!r.length)break;if(n=r[r.length-1],t){let a=t.nextSibling;a==null&&(n=r[r.length-1]),t=a}}}var ac=null,p_=new Map,vf=!1;function IB(i,e){let t;switch(e!==null&&(t=p_.get(e)),i?.nodeType){case 1:{if(t===void 0)return;t.children=t.children?t.children:[];let n=t.children,r=i.attributes,o={};for(let a=0;a<r.length;a++){let c=r.item(a);c&&(o[c.name]=c.value)}let s=(0,_f.h)(i.nodeName,_B(o));n.push(s),p_.set(i,s);break}case 3:{let n=i.textContent;if(n!==null&&t!==void 0){t.children=t.children?t.children:[];let r=t.children,o=r.length>0?r[r.length-1]:null;!vf&&typeof o!="string"&&o!==null&&o.sel===void 0?o.text=o.text+n:r.push((0,_f.vnode)(void 0,void 0,void 0,n,void 0)),vf=!1}break}case 8:{vf=!0;break}case 9:{ac=(0,_f.vnode)(void 0,void 0,[],void 0,void 0),p_.set(i,ac);break}default:break}}function RB(i){let e=i?.children;return typeof e>"u"?null:e.length===1&&typeof e[0]!="string"?e[0]:null}function MB(i){var e,t;let n=new window.DOMParser;if(n===void 0||i===void 0||i==="")return null;let r=n.parseFromString(i,"application/xml");if(((e=r?.firstChild)===null||e===void 0?void 0:e.nodeName)==="parsererror"){let o=`${(t=r?.firstChild)===null||t===void 0?void 0:t.textContent}`;return(0,_f.h)("parsererror",[o])}return vf=!1,ac=null,PB(r,IB),ac===null?null:RB(ac)}g_.default=MB});var P_=f(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.ForeignObjectElement=Ce.ShapedPreRenderedElement=Ce.PreRenderedElement=Ce.HtmlRoot=Ce.RectangularPort=Ce.CircularPort=Ce.DiamondNode=Ce.RectangularNode=Ce.CircularNode=void 0;var cc=Q(),uP=G(),m_=ce(),OB=xi(),TB=Et(),dc=Ir(),lc=ii(),y_=class extends dc.SNode{get anchorKind(){return lc.ELLIPTIC_ANCHOR_KIND}};Ce.CircularNode=y_;var __=class extends dc.SNode{get anchorKind(){return lc.RECTANGULAR_ANCHOR_KIND}};Ce.RectangularNode=__;var v_=class extends dc.SNode{get anchorKind(){return lc.DIAMOND_ANCHOR_KIND}};Ce.DiamondNode=v_;var b_=class extends dc.SPort{get anchorKind(){return lc.ELLIPTIC_ANCHOR_KIND}};Ce.CircularPort=b_;var S_=class extends dc.SPort{get anchorKind(){return lc.RECTANGULAR_ANCHOR_KIND}};Ce.RectangularPort=S_;var E_=class extends uP.SModelRoot{constructor(){super(...arguments),this.classes=[]}};Ce.HtmlRoot=E_;var bf=class extends uP.SChildElement{};Ce.PreRenderedElement=bf;var uc=class extends bf{constructor(){super(...arguments),this.position=cc.Point.ORIGIN,this.size=cc.Dimension.EMPTY,this.selected=!1,this.alignment=cc.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}};Ce.ShapedPreRenderedElement=uc;uc.DEFAULT_FEATURES=[OB.moveFeature,m_.boundsFeature,TB.selectFeature,m_.alignFeature];var w_=class extends uc{get bounds(){return cc.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,m_.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:cc.Bounds.EMPTY}};Ce.ForeignObjectElement=w_});var pP=f(zn=>{"use strict";var lP=zn&&zn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},AB=zn&&zn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zn,"__esModule",{value:!0});zn.ForeignObjectView=zn.PreRenderedView=void 0;var dP=Gt(),fP=_(),hP=AB(cP()),I_=Le(),CB=ha(),xB=P_(),R_=class extends CB.ShapeView{render(e,t){if(e instanceof xB.ShapedPreRenderedElement&&!this.isVisible(e,t))return;let n=(0,hP.default)(e.code);if(n!==null)return this.correctNamespace(n),n}correctNamespace(e){(e.sel==="svg"||e.sel==="g")&&(0,I_.setNamespace)(e,"http://www.w3.org/2000/svg")}};R_=lP([(0,fP.injectable)()],R_);zn.PreRenderedView=R_;var M_=class{render(e,t){let n=(0,hP.default)(e.code);if(n===null)return;let r=(0,dP.svg)("g",null,(0,dP.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.bounds.height,width:e.bounds.width,x:0,y:0},n),t.renderChildren(e));return(0,I_.setAttr)(r,"class",e.type),(0,I_.setNamespace)(n,e.namespace),r}};M_=lP([(0,fP.injectable)()],M_);zn.ForeignObjectView=M_});var gP=f(Ss=>{"use strict";var DB=Ss&&Ss.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ss,"__esModule",{value:!0});Ss.HtmlRootView=void 0;var qB=Gt(),jB=_(),NB=Le(),O_=class{render(e,t){let n=(0,qB.html)("div",null,t.renderChildren(e));for(let r of e.classes)(0,NB.setClass)(n,r,!0);return n}};O_=DB([(0,jB.injectable)()],O_);Ss.HtmlRootView=O_});var C_=f((T_,A_)=>{(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof T_<"u"?e():(e(),i.FileSaver={})})(T_,function(){"use strict";function i(a,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function e(a,c,u){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){s(d.response,c,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(a){var c=new XMLHttpRequest;c.open("HEAD",a,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(a,c,u){var d=r.URL||r.webkitURL,l=document.createElement("a");c=c||a.name||"download",l.download=c,l.rel="noopener",typeof a=="string"?(l.href=a,l.origin===location.origin?n(l):t(l.href)?e(a,c,u):n(l,l.target="_blank")):(l.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(a,c,u){if(c=c||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,u),c);else if(t(a))e(a,c,u);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){n(d)})}}:function(a,c,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return e(a,c,u);var l=a.type==="application/octet-stream",S=/constructor/i.test(r.HTMLElement)||r.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||l&&S||o)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var C=v.result;C=R?C:C.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=C:location=C,d=null},v.readAsDataURL(a)}else{var m=r.URL||r.webkitURL,O=m.createObjectURL(a);d?d.location=O:location.href=O,d=null,setTimeout(function(){m.revokeObjectURL(O)},4e4)}});r.saveAs=s.saveAs=s,typeof A_<"u"&&(A_.exports=s)})});var N_=f(Ot=>{"use strict";var q_=Ot&&Ot.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vP=Ot&&Ot.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.DiagramServer=Ot.DiagramServerProxy=Ot.ServerStatusAction=Ot.isActionMessage=void 0;var LB=C_(),j_=_(),BB=fr(),Xi=te(),FB=_n(),mP=Mu(),VB=P(),x_=id(),KB=Tr(),yP=Xl(),D_=zo();function bP(i){return(0,FB.hasOwnProperty)(i,"action")}Ot.isActionMessage=bP;var Ji=class{constructor(){this.kind=Ji.KIND}};Ot.ServerStatusAction=Ji;Ji.KIND="serverStatus";var _P="__receivedFromServer",Es=class extends D_.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}initialize(e){super.initialize(e),e.register(Xi.ComputedBoundsAction.KIND,this),e.register(x_.RequestBoundsCommand.KIND,this),e.register(Xi.RequestPopupModelAction.KIND,this),e.register(Xi.CollapseExpandAction.KIND,this),e.register(Xi.CollapseExpandAllAction.KIND,this),e.register(BB.OpenAction.KIND,this),e.register(Ji.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(e){this.handleLocally(e)&&this.forwardToServer(e)}forwardToServer(e){let t={clientId:this.clientId,action:e};this.logger.log(this,"sending",t),this.sendMessage(t)}messageReceived(e){let t=typeof e=="string"?JSON.parse(e):e;bP(t)&&t.action?(!t.clientId||t.clientId===this.clientId)&&(t.action[_P]=!0,this.logger.log(this,"receiving",t),this.actionDispatcher.dispatch(t.action).then(()=>{this.storeNewModel(t.action)})):this.logger.error(this,"received data is not an action message",t)}handleLocally(e){switch(this.storeNewModel(e),e.kind){case Xi.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case Xi.RequestModelAction.KIND:return this.handleRequestModel(e);case x_.RequestBoundsCommand.KIND:return!1;case KB.ExportSvgAction.KIND:return this.handleExportSvgAction(e);case Ji.KIND:return this.handleServerStateAction(e)}return!e[_P]}storeNewModel(e){if(e.kind===mP.SetModelCommand.KIND||e.kind===yP.UpdateModelCommand.KIND||e.kind===x_.RequestBoundsCommand.KIND){let t=e.newRoot;t&&(this.currentRoot=t,(e.kind===mP.SetModelCommand.KIND||e.kind===yP.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=t.type))}}handleRequestModel(e){let t=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},e.options),n=Object.assign(Object.assign({},e),{options:t});return this.forwardToServer(n),!1}handleComputedBounds(e){if(this.viewerOptions.needsServerLayout)return!0;{let t=this.currentRoot;return this.computedBoundsApplicator.apply(t,e),t.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(Xi.UpdateModelAction.create(t)):this.actionDispatcher.dispatch(Xi.SetModelAction.create(t)),this.lastSubmittedModelType=t.type,!1}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});return(0,LB.saveAs)(t,"diagram.svg"),!1}handleServerStateAction(e){return!1}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}};q_([(0,j_.inject)(VB.TYPES.ILogger),vP("design:type",Object)],Es.prototype,"logger",void 0);q_([(0,j_.inject)(D_.ComputedBoundsApplicator),vP("design:type",D_.ComputedBoundsApplicator)],Es.prototype,"computedBoundsApplicator",void 0);Es=q_([(0,j_.injectable)()],Es);Ot.DiagramServerProxy=Es;Ot.DiagramServer=Es});var EP=f(Zi=>{"use strict";var fc=Zi&&Zi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Sf=Zi&&Zi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Zi,"__esModule",{value:!0});Zi.LocalModelSource=void 0;var HB=C_(),Vr=_(),gn=te(),SP=wi(),B_=P(),zB=Pn(),YB=fs(),kB=Tr(),UB=Gl(),GB=Ul(),L_=zo(),Kr=class extends L_.ModelSource{constructor(){super(...arguments),this.currentRoot=zB.EMPTY_ROOT}get model(){return this.currentRoot}set model(e){this.setModel(e)}initialize(e){super.initialize(e),e.register(gn.ComputedBoundsAction.KIND,this),e.register(gn.RequestPopupModelAction.KIND,this)}setModel(e){return this.currentRoot=e,this.submitModel(e,!1)}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}updateModel(e){return e===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=e,this.submitModel(e,!0))}async getSelection(){let e=await this.actionDispatcher.request(GB.GetSelectionAction.create()),t=[];return this.gatherSelectedElements(this.currentRoot,new Set(e.selectedElementsIDs),t),t}gatherSelectedElements(e,t,n){if(t.has(e.id)&&n.push(e),e.children)for(let r of e.children)this.gatherSelectedElements(r,t,n)}async getViewport(){let e=await this.actionDispatcher.request(YB.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}async submitModel(e,t,n){if(this.viewerOptions.needsClientLayout){let r=await this.actionDispatcher.request(gn.RequestBoundsAction.create(e)),o=this.computedBoundsApplicator.apply(this.currentRoot,r);await this.doSubmitModel(e,!0,n,o)}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n,r){if(this.layoutEngine!==void 0)try{let s=this.layoutEngine.layout(e,r);s instanceof Promise?e=await s:s!==void 0&&(e=s)}catch(s){this.logger.error(this,s.toString(),s.stack)}let o=this.lastSubmittedModelType;if(this.lastSubmittedModelType=e.type,n&&n.kind===gn.RequestModelAction.KIND&&n.requestId){let s=n;await this.actionDispatcher.dispatch(gn.SetModelAction.create(e,s.requestId))}else if(t&&e.type===o){let s=Array.isArray(t)?t:e;await this.actionDispatcher.dispatch(gn.UpdateModelAction.create(s,{animate:!0,cause:n}))}else await this.actionDispatcher.dispatch(gn.SetModelAction.create(e))}applyMatches(e){let t=this.currentRoot;return(0,UB.applyMatches)(t,e),this.submitModel(t,e)}addElements(e){let t=[];for(let n of e){let r=n;r.element!==void 0&&r.parentId!==void 0?t.push({right:r.element,rightParentId:r.parentId}):r.id!==void 0&&t.push({right:r,rightParentId:this.currentRoot.id})}return this.applyMatches(t)}removeElements(e){let t=[],n=new SP.SModelIndex;n.add(this.currentRoot);for(let r of e){let o=r;if(o.elementId!==void 0&&o.parentId!==void 0){let s=n.getById(o.elementId);s!==void 0&&t.push({left:s,leftParentId:o.parentId})}else{let s=n.getById(o);s!==void 0&&t.push({left:s,leftParentId:this.currentRoot.id})}}return this.applyMatches(t)}handle(e){switch(e.kind){case gn.RequestModelAction.KIND:this.handleRequestModel(e);break;case gn.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,e);break;case gn.RequestPopupModelAction.KIND:this.handleRequestPopupModel(e);break;case kB.ExportSvgAction.KIND:this.handleExportSvgAction(e);break}}handleRequestModel(e){this.submitModel(this.currentRoot,!1,e)}handleRequestPopupModel(e){if(this.popupModelProvider!==void 0){let t=(0,SP.findElement)(this.currentRoot,e.elementId),n=this.popupModelProvider.getPopupModel(e,t);n!==void 0&&(n.canvasBounds=e.bounds,this.actionDispatcher.dispatch(gn.SetPopupModelAction.create(n,e.requestId)))}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});(0,HB.saveAs)(t,"diagram.svg")}};fc([(0,Vr.inject)(B_.TYPES.ILogger),Sf("design:type",Object)],Kr.prototype,"logger",void 0);fc([(0,Vr.inject)(L_.ComputedBoundsApplicator),Sf("design:type",L_.ComputedBoundsApplicator)],Kr.prototype,"computedBoundsApplicator",void 0);fc([(0,Vr.inject)(B_.TYPES.IPopupModelProvider),(0,Vr.optional)(),Sf("design:type",Object)],Kr.prototype,"popupModelProvider",void 0);fc([(0,Vr.inject)(B_.TYPES.IModelLayoutEngine),(0,Vr.optional)(),Sf("design:type",Object)],Kr.prototype,"layoutEngine",void 0);Kr=fc([(0,Vr.injectable)()],Kr);Zi.LocalModelSource=Kr});var RP=f(mn=>{"use strict";var F_=mn&&mn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},wP=mn&&mn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(mn,"__esModule",{value:!0});mn.ForwardingLogger=mn.LoggingAction=void 0;var V_=_(),Qi=Wu(),PP=P(),IP;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(IP=mn.LoggingAction||(mn.LoggingAction={}));var hc=class{error(e,t,...n){this.logLevel>=Qi.LogLevel.error&&this.forward(e,t,Qi.LogLevel.error,n)}warn(e,t,...n){this.logLevel>=Qi.LogLevel.warn&&this.forward(e,t,Qi.LogLevel.warn,n)}info(e,t,...n){this.logLevel>=Qi.LogLevel.info&&this.forward(e,t,Qi.LogLevel.info,n)}log(e,t,...n){if(this.logLevel>=Qi.LogLevel.log)try{let r=typeof e=="object"?e.constructor.name:String(e);console.log.apply(e,[r+": "+t,...n])}catch{}}forward(e,t,n,r){let o=new Date,s=IP.create({message:t,severity:Qi.LogLevel[n],time:o.toLocaleTimeString(),caller:typeof e=="object"?e.constructor.name:String(e),params:r.map(a=>JSON.stringify(a))});this.modelSourceProvider().then(a=>{try{a.handle(s)}catch(c){try{console.log.apply(e,[t,s,c])}catch{}}})}};F_([(0,V_.inject)(PP.TYPES.ModelSourceProvider),wP("design:type",Function)],hc.prototype,"modelSourceProvider",void 0);F_([(0,V_.inject)(PP.TYPES.LogLevel),wP("design:type",Number)],hc.prototype,"logLevel",void 0);hc=F_([(0,V_.injectable)()],hc);mn.ForwardingLogger=hc});var MP=f(er=>{"use strict";var WB=er&&er.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(er,"__esModule",{value:!0});er.WebSocketDiagramServer=er.WebSocketDiagramServerProxy=void 0;var $B=_(),XB=N_(),Ef=class extends XB.DiagramServerProxy{listen(e){e.addEventListener("message",t=>{this.messageReceived(t.data)}),e.addEventListener("error",t=>{this.logger.error(this,"error event received",t)}),this.webSocket=e}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(e){if(this.webSocket)this.webSocket.send(JSON.stringify(e));else throw new Error("WebSocket is not connected")}};Ef=WB([(0,$B.injectable)()],Ef);er.WebSocketDiagramServerProxy=Ef;er.WebSocketDiagramServer=Ef});var OP=f(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.ColorMap=tr.toSVG=tr.rgb=void 0;function JB(i,e,t){return{red:i,green:e,blue:t}}tr.rgb=JB;function ZB(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}tr.toSVG=ZB;var K_=class{constructor(e){this.stops=e}getColor(e){e=Math.max(0,Math.min(.99999999,e));let t=Math.floor(e*this.stops.length);return this.stops[t]}};tr.ColorMap=K_});var AP=f(TP=>{"use strict";Object.defineProperty(TP,"__esModule",{value:!0})});var wf=f(h=>{"use strict";var QB=h&&h.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),g=h&&h.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&QB(e,i,t)},Ee=h&&h.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(h,"__esModule",{value:!0});h.modelSourceModule=h.zorderModule=h.viewportModule=h.updateModule=h.undoRedoModule=h.selectModule=h.routingModule=h.openModule=h.moveModule=h.hoverModule=h.fadeModule=h.exportModule=h.expandModule=h.edgeLayoutModule=h.edgeIntersectionModule=h.decorationModule=h.contextMenuModule=h.commandPaletteModule=h.buttonModule=h.boundsModule=h.graphModule=h.defaultModule=void 0;g(yc(),h);g(lu(),h);g(Hs(),h);g(ch(),h);g(Zr(),h);g(cr(),h);g(uh(),h);g(ge(),h);g(yt(),h);g(vb(),h);g(vh(),h);g(ks(),h);g(Mu(),h);g(Nb(),h);g(Pn(),h);g(He(),h);g(G(),h);g(qh(),h);g(Ou(),h);g(Xs(),h);g(qu(),h);g(an(),h);g(Tt(),h);g(Jh(),h);g(po(),h);g(ip(),h);g(rp(),h);g(op(),h);g(ap(),h);g(Le(),h);g(P(),h);var eF=Ee(gp());h.defaultModule=eF.default;g(id(),h);g(bp(),h);g(sd(),h);g(ce(),h);g(Pp(),h);g(Ip(),h);g(Rp(),h);g(ha(),h);g(ga(),h);g(md(),h);g(yd(),h);g(Hp(),h);g(QS(),h);g(wd(),h);g(Wp(),h);g(Hd(),h);g(ng(),h);g(Lo(),h);g(C0(),h);g(og(),h);g(qg(),h);g(jo(),h);g(Wd(),h);g(Og(),h);g(Na(),h);g(Bo(),h);g(el(),h);g(jg(),h);g(nl(),h);g(sE(),h);g(Fg(),h);g(Od(),h);g(Tr(),h);g(ul(),h);g(xo(),h);g(kg(),h);g(Er(),h);g(fl(),h);g(Xg(),h);g(Jg(),h);g(gl(),h);g(nm(),h);g(xi(),h);g($a(),h);g(AE(),h);g(Cp(),h);g(lm(),h);g(um(),h);g(wl(),h);g(BE(),h);g(ii(),h);g(Pa(),h);g(Cm(),h);g(Tl(),h);g(Vm(),h);g(Cl(),h);g(ye(),h);g(Il(),h);g(Ra(),h);g(fn(),h);g(Hm(),h);g(Et(),h);g(Ul(),h);g(Jm(),h);g(Gl(),h);g(Xl(),h);g(nf(),h);g(An(),h);g(dy(),h);g(Cd(),h);g(fs(),h);g(Qd(),h);g(ly(),h);var tF=Ee(xw());h.graphModule=tF.default;var nF=Ee(yy());h.boundsModule=nF.default;var iF=Ee(vy());h.buttonModule=iF.default;var rF=Ee(Ey());h.commandPaletteModule=rF.default;var oF=Ee(Py());h.contextMenuModule=oF.default;var sF=Ee(Ry());h.decorationModule=sF.default;var aF=Ee(zw());h.edgeIntersectionModule=aF.default;var cF=Ee(Hd());h.edgeLayoutModule=cF.default;var uF=Ee(Ty());h.expandModule=uF.default;var dF=Ee(xy());h.exportModule=dF.default;var lF=Ee(qy());h.fadeModule=lF.default;var fF=Ee(Ny());h.hoverModule=fF.default;var hF=Ee(Fy());h.moveModule=hF.default;var pF=Ee(Ky());h.openModule=pF.default;var gF=Ee(Gy());h.routingModule=gF.default;var mF=Ee(Xy());h.selectModule=mF.default;var yF=Ee(Zy());h.undoRedoModule=yF.default;var _F=Ee(e_());h.updateModule=_F.default;var vF=Ee(i_());h.viewportModule=vF.default;var bF=Ee(o_());h.zorderModule=bF.default;g(hy(),h);g(Ir(),h);g(sP(),h);g(aP(),h);g(pP(),h);g(gP(),h);g(Gt(),h);g(P_(),h);g(pg(),h);g(xa(),h);g(N_(),h);g(EP(),h);g(RP(),h);g(zo(),h);g(MP(),h);var SF=Ee(f_());h.modelSourceModule=SF.default;g(In(),h);g(Np(),h);g(OP(),h);g(Or(),h);g(ar(),h);g(AP(),h);g(Wu(),h);g(wn(),h)});var G_;(function(i){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return Rf(Object.create(null))}:a?function(){return Rf({__proto__:null})}:function(){return Rf({})},has:c?function(p,y){return t.call(p,y)}:function(p,y){return y in p},get:c?function(p,y){return t.call(p,y)?p[y]:void 0}:function(p,y){return p[y]}},d=Object.getPrototypeOf(Function),l=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",S=!l&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:FP(),R=!l&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:VP(),v=!l&&typeof WeakMap=="function"?WeakMap:KP(),m=new v;function O(p,y,w,I){if(j(w)){if(!H_(p))throw new TypeError;if(!z_(y))throw new TypeError;return Pe(p,y)}else{if(!H_(p))throw new TypeError;if(!k(y))throw new TypeError;if(!k(I)&&!j(I)&&!ae(I))throw new TypeError;return ae(I)&&(I=void 0),w=ot(w),fe(p,y,w,I)}}e("decorate",O);function C(p,y){function w(I,x){if(!k(I))throw new TypeError;if(!j(x)&&!qP(x))throw new TypeError;xs(p,y,I,x)}return w}e("metadata",C);function K(p,y,w,I){if(!k(w))throw new TypeError;return j(I)||(I=ot(I)),xs(p,y,w,I)}e("defineMetadata",K);function U(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),Ge(p,y,w)}e("hasMetadata",U);function q(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),yn(p,y,w)}e("hasOwnMetadata",q);function F(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),di(p,y,w)}e("getMetadata",F);function H(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),Cs(p,y,w)}e("getOwnMetadata",H);function W(p,y){if(!k(p))throw new TypeError;return j(y)||(y=ot(y)),Ds(p,y)}e("getMetadataKeys",W);function z(p,y){if(!k(p))throw new TypeError;return j(y)||(y=ot(y)),pc(p,y)}e("getOwnMetadataKeys",z);function se(p,y,w){if(!k(y))throw new TypeError;j(w)||(w=ot(w));var I=ve(y,w,!1);if(j(I)||!I.delete(p))return!1;if(I.size>0)return!0;var x=m.get(y);return x.delete(w),x.size>0||m.delete(y),!0}e("deleteMetadata",se);function Pe(p,y){for(var w=p.length-1;w>=0;--w){var I=p[w],x=I(y);if(!j(x)&&!ae(x)){if(!z_(x))throw new TypeError;y=x}}return y}function fe(p,y,w,I){for(var x=p.length-1;x>=0;--x){var Ke=p[x],V=Ke(y,w,I);if(!j(V)&&!ae(V)){if(!k(V))throw new TypeError;I=V}}return I}function ve(p,y,w){var I=m.get(p);if(j(I)){if(!w)return;I=new S,m.set(p,I)}var x=I.get(y);if(j(x)){if(!w)return;x=new S,I.set(y,x)}return x}function Ge(p,y,w){var I=yn(p,y,w);if(I)return!0;var x=If(y);return ae(x)?!1:Ge(p,x,w)}function yn(p,y,w){var I=ve(y,w,!1);return j(I)?!1:sn(I.has(p))}function di(p,y,w){var I=yn(p,y,w);if(I)return Cs(p,y,w);var x=If(y);if(!ae(x))return di(p,x,w)}function Cs(p,y,w){var I=ve(y,w,!1);if(!j(I))return I.get(p)}function xs(p,y,w,I){var x=ve(w,I,!0);x.set(p,y)}function Ds(p,y){var w=pc(p,y),I=If(p);if(I===null)return w;var x=Ds(I,y);if(x.length<=0)return w;if(w.length<=0)return x;for(var Ke=new R,V=[],Y=0,N=w;Y<N.length;Y++){var $=N[Y],X=Ke.has($);X||(Ke.add($),V.push($))}for(var fi=0,k_=x;fi<k_.length;fi++){var $=k_[fi],X=Ke.has($);X||(Ke.add($),V.push($))}return V}function pc(p,y){var w=[],I=ve(p,y,!1);if(j(I))return w;for(var x=I.keys(),Ke=jP(x),V=0;;){var Y=LP(Ke);if(!Y)return w.length=V,w;var N=NP(Y);try{w[V]=N}catch($){try{BP(Ke)}finally{throw $}}V++}}function L(p){if(p===null)return 1;switch(typeof p){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return p===null?1:6;default:return 6}}function j(p){return p===void 0}function ae(p){return p===null}function je(p){return typeof p=="symbol"}function k(p){return typeof p=="object"?p!==null:typeof p=="function"}function Ve(p,y){switch(L(p)){case 0:return p;case 1:return p;case 2:return p;case 3:return p;case 4:return p;case 5:return p}var w=y===3?"string":y===5?"number":"default",I=Y_(p,r);if(I!==void 0){var x=I.call(p,w);if(k(x))throw new TypeError;return x}return li(p,w==="default"?"number":w)}function li(p,y){if(y==="string"){var w=p.toString;if(Hr(w)){var I=w.call(p);if(!k(I))return I}var x=p.valueOf;if(Hr(x)){var I=x.call(p);if(!k(I))return I}}else{var x=p.valueOf;if(Hr(x)){var I=x.call(p);if(!k(I))return I}var Ke=p.toString;if(Hr(Ke)){var I=Ke.call(p);if(!k(I))return I}}throw new TypeError}function sn(p){return!!p}function We(p){return""+p}function ot(p){var y=Ve(p,3);return je(y)?y:We(y)}function H_(p){return Array.isArray?Array.isArray(p):p instanceof Object?p instanceof Array:Object.prototype.toString.call(p)==="[object Array]"}function Hr(p){return typeof p=="function"}function z_(p){return typeof p=="function"}function qP(p){switch(L(p)){case 3:return!0;case 4:return!0;default:return!1}}function Y_(p,y){var w=p[y];if(w!=null){if(!Hr(w))throw new TypeError;return w}}function jP(p){var y=Y_(p,o);if(!Hr(y))throw new TypeError;var w=y.call(p);if(!k(w))throw new TypeError;return w}function NP(p){return p.value}function LP(p){var y=p.next();return y.done?!1:y}function BP(p){var y=p.return;y&&y.call(p)}function If(p){var y=Object.getPrototypeOf(p);if(typeof p!="function"||p===d||y!==d)return y;var w=p.prototype,I=w&&Object.getPrototypeOf(w);if(I==null||I===Object.prototype)return y;var x=I.constructor;return typeof x!="function"||x===p?y:x}function FP(){var p={},y=[],w=function(){function V(Y,N,$){this._index=0,this._keys=Y,this._values=N,this._selector=$}return V.prototype["@@iterator"]=function(){return this},V.prototype[o]=function(){return this},V.prototype.next=function(){var Y=this._index;if(Y>=0&&Y<this._keys.length){var N=this._selector(this._keys[Y],this._values[Y]);return Y+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:N,done:!1}}return{value:void 0,done:!0}},V.prototype.throw=function(Y){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),Y},V.prototype.return=function(Y){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:Y,done:!0}},V}();return function(){function V(){this._keys=[],this._values=[],this._cacheKey=p,this._cacheIndex=-2}return Object.defineProperty(V.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),V.prototype.has=function(Y){return this._find(Y,!1)>=0},V.prototype.get=function(Y){var N=this._find(Y,!1);return N>=0?this._values[N]:void 0},V.prototype.set=function(Y,N){var $=this._find(Y,!0);return this._values[$]=N,this},V.prototype.delete=function(Y){var N=this._find(Y,!1);if(N>=0){for(var $=this._keys.length,X=N+1;X<$;X++)this._keys[X-1]=this._keys[X],this._values[X-1]=this._values[X];return this._keys.length--,this._values.length--,Y===this._cacheKey&&(this._cacheKey=p,this._cacheIndex=-2),!0}return!1},V.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=p,this._cacheIndex=-2},V.prototype.keys=function(){return new w(this._keys,this._values,I)},V.prototype.values=function(){return new w(this._keys,this._values,x)},V.prototype.entries=function(){return new w(this._keys,this._values,Ke)},V.prototype["@@iterator"]=function(){return this.entries()},V.prototype[o]=function(){return this.entries()},V.prototype._find=function(Y,N){return this._cacheKey!==Y&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Y)),this._cacheIndex<0&&N&&(this._cacheIndex=this._keys.length,this._keys.push(Y),this._values.push(void 0)),this._cacheIndex},V}();function I(V,Y){return V}function x(V,Y){return Y}function Ke(V,Y){return[V,Y]}}function VP(){return function(){function p(){this._map=new S}return Object.defineProperty(p.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),p.prototype.has=function(y){return this._map.has(y)},p.prototype.add=function(y){return this._map.set(y,y),this},p.prototype.delete=function(y){return this._map.delete(y)},p.prototype.clear=function(){this._map.clear()},p.prototype.keys=function(){return this._map.keys()},p.prototype.values=function(){return this._map.values()},p.prototype.entries=function(){return this._map.entries()},p.prototype["@@iterator"]=function(){return this.keys()},p.prototype[o]=function(){return this.keys()},p}()}function KP(){var p=16,y=u.create(),w=I();return function(){function N(){this._key=I()}return N.prototype.has=function($){var X=x($,!1);return X!==void 0?u.has(X,this._key):!1},N.prototype.get=function($){var X=x($,!1);return X!==void 0?u.get(X,this._key):void 0},N.prototype.set=function($,X){var fi=x($,!0);return fi[this._key]=X,this},N.prototype.delete=function($){var X=x($,!1);return X!==void 0?delete X[this._key]:!1},N.prototype.clear=function(){this._key=I()},N}();function I(){var N;do N="@@WeakMap@@"+Y();while(u.has(y,N));return y[N]=!0,N}function x(N,$){if(!t.call(N,w)){if(!$)return;Object.defineProperty(N,w,{value:u.create()})}return N[w]}function Ke(N,$){for(var X=0;X<$;++X)N[X]=Math.random()*255|0;return N}function V(N){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(N)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(N)):Ke(new Uint8Array(N),N):Ke(new Array(N),N)}function Y(){var N=V(p);N[6]=N[6]&79|64,N[8]=N[8]&191|128;for(var $="",X=0;X<p;++X){var fi=N[X];(X===4||X===6||X===8)&&($+="-"),fi<16&&($+="0"),$+=fi.toString(16).toLowerCase()}return $}}function Rf(p){return p.__=void 0,delete p.__,p}})})(G_||(G_={}));var xP=zr(wf());var Pf=zr(_()),A=zr(wf());var oe=zr(Gt()),ui=zr(_()),Yn=zr(wf());var ws=class extends Yn.ShapeView{render(e,t,n){return(0,oe.svg)("polygon",{points:"-6,-4 0,0 -6,4",style:{fill:"black"}})}};ws=kn([(0,ui.injectable)()],ws);var Ps=class extends Yn.RectangularNodeView{render(e,t,n){return(0,oe.svg)("g",null,(0,oe.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width-(e.arrow!==0?10:0),height:e.size.height}),(0,oe.svg)("rect",{"class-input-back":!0,width:"10",height:e.size.height}),e.arrow!==0&&(0,oe.svg)("polygon",{"class-input-arrow-full":e.arrow===1,"class-input-arrow-stroke":e.arrow===2,points:`${e.size.width-10},0 ${e.size.width},${e.size.height/2} ${e.size.width-10},${e.size.height}`}),(0,oe.svg)("g",{transform:`translate(${e.size.width/2+(e.arrow!==0?0:5)},${e.size.height/2})`},t.renderChildren(e,n)),(0,oe.svg)("text",{x:"0",y:e.size.height+15,"class-sprotty-text":!0},e.text))}};Ps=kn([(0,ui.injectable)()],Ps);var Is=class extends Yn.RectangularNodeView{render(e,t,n){return(0,oe.svg)("g",null,(0,oe.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),(0,oe.svg)("rect",{"class-controller-marker":!0,width:"10",height:"10",x:e.size.width/2-5,y:"-5"}),(0,oe.svg)("text",{x:"0",y:e.size.height+20,"class-sprotty-text":!0},e.text))}};Is=kn([(0,ui.injectable)()],Is);var Rs=class extends Yn.RectangularNodeView{render(e,t,n){return(0,oe.svg)("g",null,(0,oe.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width,height:e.size.height}),e.operand==="+"&&(0,oe.svg)("text",{x:2,y:e.size.height+1,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="\xF7"&&(0,oe.svg)("text",{x:3,y:e.size.height,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="-"&&(0,oe.svg)("text",{x:5,y:30,w:!0,"class-operand-symbol":!0,style:{fontSize:"54"}},e.operand),e.operand==="MN"&&(0,oe.svg)("text",{x:2,y:35,w:!0,"class-operand-symbol":!0,style:{fontSize:"30",transform:"scaleX(0.8)"}},e.operand))}};Rs=kn([(0,ui.injectable)()],Rs);var Ms=class extends Yn.ShapeView{render(e,t,n){let r=e.parent.size;return(0,oe.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{stroke:"lightgrey",fill:"lightblue"}})}};Ms=kn([(0,ui.injectable)()],Ms);var Os=class extends Yn.ShapeView{render(e,t,n){let r=e.parent.size;return(0,oe.svg)("g",null,(0,oe.svg)("polygon",{points:"-4,-4 4,-4 4,4",style:{stroke:"lightgrey",fill:"none"}}),(0,oe.svg)("polygon",{points:"-4,-4 -4,4 4,4",style:{stroke:"lightgrey",fill:"orange"}}))}};Os=kn([(0,ui.injectable)()],Os);var Ts=class extends Yn.ShapeView{render(e,t,n){let r=e.parent.size;return(0,oe.svg)("g",null,(0,oe.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{stroke:"lightgrey",fill:"lightblue"}}),(0,oe.svg)("text",{transform:"translate(-2.8, 3.2)",style:{fontSize:"10",fontWeight:"bold"}},"="))}};Ts=kn([(0,ui.injectable)()],Ts);var As=class extends Yn.ShapeView{render(e,t,n){let r=e.parent.size;return(0,oe.svg)("g",null,(0,oe.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{stroke:"lightgrey",fill:"lightblue"}}),(0,oe.svg)("text",{transform:"translate(-2.8, 3.2)",style:{fontSize:"10",fontWeight:"bold"}},"+"))}};As=kn([(0,ui.injectable)()],As);var CP=i=>{let e=new Pf.ContainerModule((n,r,o,s)=>{n(A.TYPES.ModelSource).to(A.LocalModelSource).inSingletonScope(),s(A.TYPES.ILogger).to(A.ConsoleLogger).inSingletonScope(),s(A.TYPES.LogLevel).toConstantValue(A.LogLevel.log);let a={bind:n,unbind:r,isBound:o,rebind:s};(0,A.configureModelElement)(a,"graph",A.SGraph,A.SGraphView),(0,A.configureModelElement)(a,"node:input",A.RectangularNode,Ps),(0,A.configureModelElement)(a,"node:controller",A.RectangularNode,Is),(0,A.configureModelElement)(a,"node:operand",A.RectangularNode,Rs),(0,A.configureModelElement)(a,"edge:straight",A.SEdge,A.PolylineEdgeView),(0,A.configureModelElement)(a,"label:arrow",A.SLabel,ws),(0,A.configureModelElement)(a,"label:text",A.SLabel,A.SLabelView),(0,A.configureModelElement)(a,"routing-point",A.SRoutingHandle,A.SRoutingHandleView),(0,A.configureModelElement)(a,"volatile-routing-point",A.SRoutingHandle,A.SRoutingHandleView),(0,A.configureModelElement)(a,"label:icon1",A.SChildElement,Ms),(0,A.configureModelElement)(a,"label:icon2",A.SChildElement,Os),(0,A.configureModelElement)(a,"label:icon3",A.SChildElement,Ts),(0,A.configureModelElement)(a,"label:icon4",A.SChildElement,As),(0,A.configureViewerOptions)(a,{needsClientLayout:!1,baseDiv:i})}),t=new Pf.Container;return(0,A.loadDefaultModules)(t),t.load(e),t};function DP(){CP("sprotty-showcase").get(xP.TYPES.ModelSource).setModel({type:"graph",id:"graph",children:[{id:"targetPosEdge",type:"edge:straight",sourceId:"target_pos",targetId:"AddOperand",routerKind:"manhattan",children:rt()},{id:"MaxPosEdge",type:"edge:straight",sourceId:"MaxPosition",targetId:"limiter",routerKind:"manhattan",routingPoints:[{x:260,y:207}],children:rt()},{id:"AddLimiterEdge",type:"edge:straight",sourceId:"AddOperand",targetId:"limiter",routerKind:"manhattan",children:rt()},{id:"OffsetPosEdge",type:"edge:straight",sourceId:"offset_pos",targetId:"AddOperand",routerKind:"manhattan",routingPoints:[{x:145,y:367}],children:rt()},{id:"limiterEdge",type:"edge:straight",sourceId:"limiter",targetId:"SubOperand",routerKind:"manhattan",children:rt()},{id:"actualPosEdge",type:"edge:straight",sourceId:"actual_pos",targetId:"SubOperand",routerKind:"manhattan",routingPoints:[{x:335,y:407}],children:rt()},{id:"SubToDivEdge",type:"edge:straight",sourceId:"SubOperand",targetId:"DivOperand",routerKind:"manhattan",children:rt()},{id:"DivToPIDTEdge",type:"edge:straight",sourceId:"DivOperand",targetId:"pidt",routerKind:"manhattan",children:rt()},{id:"outputEdge",type:"edge:straight",sourceId:"pidt",targetId:"new_pos",routerKind:"manhattan",children:rt()},{id:"T_lEdge",type:"edge:straight",sourceId:"T_l",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:660,y:37}],children:rt()},{id:"T_dEdge",type:"edge:straight",sourceId:"T_d",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:630,y:77}],children:rt()},{id:"T_iEdge",type:"edge:straight",sourceId:"T_i",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:590,y:117}],children:rt()},{id:"P_GainEdge",type:"edge:straight",sourceId:"P_Gain",targetId:"MNOperand",routerKind:"manhattan",children:rt()},{id:"P_MaxEdge",type:"edge:straight",sourceId:"P_max",targetId:"MNOperand",routerKind:"manhattan",children:rt()},{id:"MNOperandEdge",type:"edge:straight",sourceId:"MNOperand",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:560,y:190}],children:rt()},{id:"cf_Degree2RadEdge",type:"edge:straight",sourceId:"cf_Degree2Rad",targetId:"DivOperand",routerKind:"manhattan",routingPoints:[{x:475,y:357}],children:rt()},{id:"limiter",text:"limiter",type:"node:controller",position:{x:200,y:285},size:{width:80,height:60}},{id:"pidt",text:"pidt1",type:"node:controller",position:{x:550,y:275},size:{width:120,height:80}},{id:"MaxPosition",type:"node:input",text:"MaxPosition",arrow:2,position:{x:100,y:200},size:{width:40,height:15},children:[{id:"MaxPositionIcon",type:"label:icon3"}]},{id:"target_pos",type:"node:input",text:"target_pos",arrow:1,position:{x:0,y:307.5},size:{width:40,height:15},children:[{id:"target_posIcon",type:"label:icon2"}]},{id:"offset_pos",type:"node:input",text:"offset_pos",arrow:0,position:{x:50,y:360},size:{width:40,height:15},children:[{id:"offset_posIcon",type:"label:icon1"}]},{id:"actual_pos",type:"node:input",text:"actual_position",arrow:1,position:{x:0,y:400},size:{width:40,height:15},children:[{id:"actual_posIcon",type:"label:icon2"}]},{id:"new_pos",type:"node:input",text:"new_position",arrow:1,position:{x:700,y:307.5},size:{width:40,height:15},children:[{id:"new_posIcon",type:"label:icon2"}]},{id:"T_l",type:"node:input",text:"T_l",arrow:0,position:{x:350,y:30},size:{width:40,height:15},children:[{id:"T_lIcon",type:"label:icon1"}]},{id:"T_d",type:"node:input",text:"T_d",arrow:0,position:{x:350,y:70},size:{width:40,height:15},children:[{id:"T_dIcon",type:"label:icon1"}]},{id:"T_i",type:"node:input",text:"T_i",arrow:0,position:{x:350,y:110},size:{width:40,height:15},children:[{id:"T_iIcon",type:"label:icon1"}]},{id:"P_Gain",type:"node:input",text:"P_Gain",arrow:0,position:{x:350,y:150},size:{width:40,height:15},children:[{id:"P_GainsIcon",type:"label:icon1"}]},{id:"P_max",type:"node:input",text:"P_max",arrow:2,position:{x:350,y:190},size:{width:40,height:15},children:[{id:"P_maxIcon",type:"label:icon3"}]},{id:"cf_Degree2Rad",type:"node:input",text:"cf_Degree2Rad",arrow:2,position:{x:380,y:350},size:{width:40,height:15},children:[{id:"cf_Degree2RadIcon",type:"label:icon4"}]},{id:"AddOperand",type:"node:operand",operand:"+",position:{x:130,y:300},size:{width:30,height:30}},{id:"SubOperand",type:"node:operand",operand:"-",position:{x:320,y:300},size:{width:30,height:30}},{id:"DivOperand",type:"node:operand",operand:"\xF7",position:{x:460,y:300},size:{width:30,height:30}},{id:"MNOperand",type:"node:operand",operand:"MN",position:{x:440,y:160},size:{width:40,height:50}}]})}var PF=0;function rt(){return[{id:"arrow"+PF++,type:"label:arrow",text:"",edgePlacement:{position:1,side:"on",rotate:!0}}]}document.addEventListener("DOMContentLoaded",()=>DP());})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=bundle.js.map
