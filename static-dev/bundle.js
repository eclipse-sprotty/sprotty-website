(()=>{var kP=Object.create;var Af=Object.defineProperty;var W_=Object.getOwnPropertyDescriptor;var GP=Object.getOwnPropertyNames;var $P=Object.getPrototypeOf,WP=Object.prototype.hasOwnProperty;var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var XP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of GP(e))!WP.call(i,r)&&r!==t&&Af(i,r,{get:()=>e[r],enumerable:!(n=W_(e,r))||n.enumerable});return i};var Yr=(i,e,t)=>(t=i!=null?kP($P(i)):{},XP(e||!i||!i.__esModule?Af(t,"default",{value:i,enumerable:!0}):t,i));var bn=(i,e,t,n)=>{for(var r=n>1?void 0:n?W_(e,t):e,o=i.length-1,s;o>=0;o--)(s=i[o])&&(r=(n?s(e,t,r):s(r))||r);return n&&r&&Af(e,t,r),r};var Sn=f(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.safeAssign=pi.hasOwnProperty=pi.isObject=void 0;function J_(i){return typeof i=="object"&&i!==null}pi.isObject=J_;function JP(i,e,t){if(!J_(i))return!1;if(Array.isArray(e))for(let n of e){if(!Object.prototype.hasOwnProperty.call(i,n)||typeof t=="string"&&typeof i[n]!==t)return!1;if(typeof t=="function"&&!t(i[n]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,e))return!1;if(typeof t=="string")return typeof i[e]===t;if(typeof t=="function")return t(i[e])}return!0}pi.hasOwnProperty=JP;function ZP(i,e){return Object.assign(i,e)}pi.safeAssign=ZP});var ie=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ReconnectAction=E.ApplyLabelEditAction=E.DeleteElementAction=E.CreateElementAction=E.HoverFeedbackAction=E.MoveAction=E.RedoAction=E.UndoAction=E.BringToFrontAction=E.SetViewportAction=E.FitToScreenAction=E.CenterAction=E.LayoutAction=E.OpenAction=E.CollapseExpandAllAction=E.CollapseExpandAction=E.SelectAllAction=E.SelectAction=E.LoggingAction=E.ComputedBoundsAction=E.RequestBoundsAction=E.SetBoundsAction=E.SetPopupModelAction=E.RequestPopupModelAction=E.UpdateModelAction=E.SetModelAction=E.RequestModelAction=E.RejectAction=E.isResponseAction=E.generateRequestId=E.isRequestAction=E.isAction=E.isActionMessage=void 0;var _c=Sn();function QP(i){return(0,_c.hasOwnProperty)(i,"action")}E.isActionMessage=QP;function eI(i){return(0,_c.hasOwnProperty)(i,"kind","string")}E.isAction=eI;function tI(i){return(0,_c.hasOwnProperty)(i,"requestId","string")}E.isRequestAction=tI;var nI=1;function vc(){return(nI++).toString()}E.generateRequestId=vc;function iI(i){return(0,_c.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}E.isResponseAction=iI;var rI;(function(i){i.KIND="rejectRequest";function e(t){return{kind:i.KIND,message:t.message,detail:t.detail,responseId:t.requestId}}i.create=e})(rI=E.RejectAction||(E.RejectAction={}));var oI;(function(i){i.KIND="requestModel";function e(t){return{kind:i.KIND,options:t,requestId:vc()}}i.create=e})(oI=E.RequestModelAction||(E.RequestModelAction={}));var sI;(function(i){i.KIND="setModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(sI=E.SetModelAction||(E.SetModelAction={}));var aI;(function(i){i.KIND="updateModel";function e(t,n={}){return Array.isArray(t)?{kind:i.KIND,matches:t,animate:n.animate,cause:n.cause}:{kind:i.KIND,newRoot:t,animate:n.animate,cause:n.cause}}i.create=e})(aI=E.UpdateModelAction||(E.UpdateModelAction={}));var cI;(function(i){i.KIND="requestPopupModel";function e(t){return{kind:i.KIND,elementId:t.elementId,bounds:t.bounds,requestId:vc()}}i.create=e})(cI=E.RequestPopupModelAction||(E.RequestPopupModelAction={}));var uI;(function(i){i.KIND="setPopupModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(uI=E.SetPopupModelAction||(E.SetPopupModelAction={}));var dI;(function(i){i.KIND="setBounds";function e(t){return{kind:i.KIND,bounds:t}}i.create=e})(dI=E.SetBoundsAction||(E.SetBoundsAction={}));var lI;(function(i){i.KIND="requestBounds";function e(t){return{kind:i.KIND,newRoot:t,requestId:vc()}}i.create=e})(lI=E.RequestBoundsAction||(E.RequestBoundsAction={}));var fI;(function(i){i.KIND="computedBounds";function e(t,n={}){var r;return{kind:i.KIND,bounds:t,revision:n.revision,alignments:n.alignments,responseId:(r=n.requestId)!==null&&r!==void 0?r:""}}i.create=e})(fI=E.ComputedBoundsAction||(E.ComputedBoundsAction={}));var hI;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(hI=E.LoggingAction||(E.LoggingAction={}));var pI;(function(i){i.KIND="elementSelected";function e(t){var n,r;return{kind:i.KIND,selectedElementsIDs:(n=t.selectedElementsIDs)!==null&&n!==void 0?n:[],deselectedElementsIDs:(r=t.deselectedElementsIDs)!==null&&r!==void 0?r:[]}}i.create=e})(pI=E.SelectAction||(E.SelectAction={}));var gI;(function(i){i.KIND="allSelected";function e(t={}){var n;return{kind:i.KIND,select:(n=t.select)!==null&&n!==void 0?n:!0}}i.create=e})(gI=E.SelectAllAction||(E.SelectAllAction={}));var mI;(function(i){i.KIND="collapseExpand";function e(t){var n,r;return{kind:i.KIND,expandIds:(n=t.expandIds)!==null&&n!==void 0?n:[],collapseIds:(r=t.collapseIds)!==null&&r!==void 0?r:[]}}i.create=e})(mI=E.CollapseExpandAction||(E.CollapseExpandAction={}));var yI;(function(i){i.KIND="collapseExpandAll";function e(t={}){var n;return{kind:i.KIND,expand:(n=t.expand)!==null&&n!==void 0?n:!0}}i.create=e})(yI=E.CollapseExpandAllAction||(E.CollapseExpandAllAction={}));var _I;(function(i){i.KIND="open";function e(t){return{kind:i.KIND,elementId:t}}i.create=e})(_I=E.OpenAction||(E.OpenAction={}));var vI;(function(i){i.KIND="layout";function e(t={}){return{kind:i.KIND,layoutType:t.layoutType,elementIds:t.elementIds}}i.create=e})(vI=E.LayoutAction||(E.LayoutAction={}));var bI;(function(i){i.KIND="center";function e(t,n={}){var r,o;return{kind:i.KIND,elementIds:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,retainZoom:(o=n.retainZoom)!==null&&o!==void 0?o:!1}}i.create=e})(bI=E.CenterAction||(E.CenterAction={}));var SI;(function(i){i.KIND="fit";function e(t,n={}){var r;return{kind:i.KIND,elementIds:t,padding:n.padding,maxZoom:n.maxZoom,animate:(r=n.animate)!==null&&r!==void 0?r:!0}}i.create=e})(SI=E.FitToScreenAction||(E.FitToScreenAction={}));var EI;(function(i){i.KIND="viewport";function e(t,n,r={}){var o;return{kind:i.KIND,elementId:t,newViewport:n,animate:(o=r.animate)!==null&&o!==void 0?o:!0}}i.create=e})(EI=E.SetViewportAction||(E.SetViewportAction={}));var wI;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(wI=E.BringToFrontAction||(E.BringToFrontAction={}));var PI;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(PI=E.UndoAction||(E.UndoAction={}));var II;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(II=E.RedoAction||(E.RedoAction={}));var RI;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(RI=E.MoveAction||(E.MoveAction={}));var MI;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(MI=E.HoverFeedbackAction||(E.HoverFeedbackAction={}));var TI;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(TI=E.CreateElementAction||(E.CreateElementAction={}));var OI;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(OI=E.DeleteElementAction||(E.DeleteElementAction={}));var AI;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(AI=E.ApplyLabelEditAction||(E.ApplyLabelEditAction={}));var CI;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(CI=E.ReconnectAction||(E.ReconnectAction={}))});var bc=f(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.isLabeledAction=Xe.LabeledAction=Xe.RejectAction=Xe.isResponseAction=Xe.generateRequestId=Xe.isRequestAction=Xe.isAction=void 0;var xI=ie(),xf=Sn();function qf(i){return(0,xf.hasOwnProperty)(i,"kind","string")}Xe.isAction=qf;function qI(i){return qf(i)&&(0,xf.hasOwnProperty)(i,"requestId","string")}Xe.isRequestAction=qI;Xe.generateRequestId=xI.generateRequestId;function DI(i){return qf(i)&&(0,xf.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}Xe.isResponseAction=DI;var Ur=class{constructor(e,t,n){this.message=e,this.responseId=t,this.detail=n,this.kind=Ur.KIND}};Xe.RejectAction=Ur;Ur.KIND="rejectRequest";var Cf=class{constructor(e,t,n){this.label=e,this.actions=t,this.icon=n}};Xe.LabeledAction=Cf;function jI(i){return i!==void 0&&i.label!==void 0&&i.actions!==void 0}Xe.isLabeledAction=jI});var qe=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.NON_CUSTOM_TAG_KEYS=Z.POST_CONSTRUCT=Z.DESIGN_PARAM_TYPES=Z.PARAM_TYPES=Z.TAGGED_PROP=Z.TAGGED=Z.MULTI_INJECT_TAG=Z.INJECT_TAG=Z.OPTIONAL_TAG=Z.UNMANAGED_TAG=Z.NAME_TAG=Z.NAMED_TAG=void 0;Z.NAMED_TAG="named";Z.NAME_TAG="name";Z.UNMANAGED_TAG="unmanaged";Z.OPTIONAL_TAG="optional";Z.INJECT_TAG="inject";Z.MULTI_INJECT_TAG="multi_inject";Z.TAGGED="inversify:tagged";Z.TAGGED_PROP="inversify:tagged_props";Z.PARAM_TYPES="inversify:paramtypes";Z.DESIGN_PARAM_TYPES="design:paramtypes";Z.POST_CONSTRUCT="post_construct";function NI(){return[Z.INJECT_TAG,Z.MULTI_INJECT_TAG,Z.NAME_TAG,Z.UNMANAGED_TAG,Z.NAMED_TAG,Z.OPTIONAL_TAG]}Z.NON_CUSTOM_TAG_KEYS=NI()});var En=f(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.TargetTypeEnum=gi.BindingTypeEnum=gi.BindingScopeEnum=void 0;var LI={Request:"Request",Singleton:"Singleton",Transient:"Transient"};gi.BindingScopeEnum=LI;var BI={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};gi.BindingTypeEnum=BI;var FI={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};gi.TargetTypeEnum=FI});var mi=f(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.id=void 0;var VI=0;function KI(){return VI++}Sc.id=KI});var Q_=f(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.Binding=void 0;var Z_=En(),HI=mi(),zI=function(){function i(e,t){this.id=HI.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Z_.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return i.prototype.clone=function(){var e=new i(this.serviceIdentifier,this.scope);return e.activated=e.scope===Z_.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},i}();Ec.Binding=zI});var ht=f(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0;O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";O.NULL_ARGUMENT="NULL argument";O.KEY_NOT_FOUND="Key Not Found";O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";O.CANNOT_UNBIND="Could not unbind serviceIdentifier:";O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var YI=function(i){return"@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};O.UNDEFINED_INJECT_ANNOTATION=YI;O.CIRCULAR_DEPENDENCY="Circular dependency found:";O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";O.INVALID_BINDING_TYPE="Invalid binding type:";O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var UI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"The number of constructor arguments in the derived class "+(i[0]+" must be >= than the number of constructor arguments of its base class.")};O.ARGUMENTS_LENGTH_MISMATCH=UI;O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var kI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"@postConstruct error in class "+i[0]+": "+i[1]};O.POST_CONSTRUCT_ERROR=kI;var GI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"It looks like there is a circular dependency "+("in one of the '"+i[0]+"' bindings. Please investigate bindings with")+("service identifier '"+i[1]+"'.")};O.CIRCULAR_DEPENDENCY_IN_FACTORY=GI;O.STACK_OVERFLOW="Maximum call stack size exceeded"});var jf=f(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.MetadataReader=void 0;var Df=qe(),$I=function(){function i(){}return i.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(Df.PARAM_TYPES,e),n=Reflect.getMetadata(Df.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},i.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(Df.TAGGED_PROP,e)||[];return t},i}();wc.MetadataReader=$I});var ev=f(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.BindingCount=void 0;var WI={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Pc.BindingCount=WI});var Nf=f(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.isStackOverflowExeption=void 0;var XI=ht();function JI(i){return i instanceof RangeError||i.message===XI.STACK_OVERFLOW}Ic.isStackOverflowExeption=JI});var kr=f(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.circularDependencyToException=Ht.listMetadataForTarget=Ht.listRegisteredBindingsForServiceIdentifier=Ht.getServiceIdentifierAsString=Ht.getFunctionName=void 0;var ZI=ht();function tv(i){if(typeof i=="function"){var e=i;return e.name}else{if(typeof i=="symbol")return i.toString();var e=i;return e}}Ht.getServiceIdentifierAsString=tv;function QI(i,e,t){var n="",r=t(i,e);return r.length!==0&&(n=`
Registered bindings:`,r.forEach(function(o){var s="Object";o.implementationType!==null&&(s=rv(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Ht.listRegisteredBindingsForServiceIdentifier=QI;function nv(i,e){return i.parentRequest===null?!1:i.parentRequest.serviceIdentifier===e?!0:nv(i.parentRequest,e)}function eR(i){function e(n,r){r===void 0&&(r=[]);var o=tv(n.serviceIdentifier);return r.push(o),n.parentRequest!==null?e(n.parentRequest,r):r}var t=e(i);return t.reverse().join(" --> ")}function iv(i){i.childRequests.forEach(function(e){if(nv(e,e.serviceIdentifier)){var t=eR(e);throw new Error(ZI.CIRCULAR_DEPENDENCY+" "+t)}else iv(e)})}Ht.circularDependencyToException=iv;function tR(i,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),r=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),r!==null&&r.forEach(function(o){t+=o.toString()+`
`})," "+i+`
 `+i+" - "+t}else return" "+i}Ht.listMetadataForTarget=tR;function rv(i){if(i.name)return i.name;var e=i.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Ht.getFunctionName=rv});var ov=f(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.Context=void 0;var nR=mi(),iR=function(){function i(e){this.id=nR.id(),this.container=e}return i.prototype.addPlan=function(e){this.plan=e},i.prototype.setCurrentRequest=function(e){this.currentRequest=e},i}();Rc.Context=iR});var zt=f(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.Metadata=void 0;var rR=qe(),oR=function(){function i(e,t){this.key=e,this.value=t}return i.prototype.toString=function(){return this.key===rR.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},i}();Mc.Metadata=oR});var sv=f(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.Plan=void 0;var sR=function(){function i(e,t){this.parentContext=e,this.rootRequest=t}return i}();Tc.Plan=sR});var $n=f(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.tagProperty=yi.tagParameter=yi.decorate=void 0;var av=ht(),uv=qe();function aR(i,e,t,n){var r=uv.TAGGED;dv(r,i,e,n,t)}yi.tagParameter=aR;function cR(i,e,t){var n=uv.TAGGED_PROP;dv(n,i.constructor,e,t)}yi.tagProperty=cR;function dv(i,e,t,n,r){var o={},s=typeof r=="number",a=r!==void 0&&s?r.toString():t;if(s&&t!==void 0)throw new Error(av.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(i,e)&&(o=Reflect.getMetadata(i,e));var c=o[a];if(!Array.isArray(c))c=[];else for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===n.key)throw new Error(av.DUPLICATED_METADATA+" "+l.key.toString())}c.push(n),o[a]=c,Reflect.defineMetadata(i,o,e)}function cv(i,e){Reflect.decorate(i,e)}function uR(i,e){return function(t,n){e(t,n,i)}}function dR(i,e,t){typeof t=="number"?cv([uR(t,i)],e):typeof t=="string"?Reflect.decorate([i],e,t):cv([i],e)}yi.decorate=dR});var Lf=f(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.inject=Gr.LazyServiceIdentifer=void 0;var lR=ht(),fR=qe(),hR=zt(),lv=$n(),pR=function(){function i(e){this._cb=e}return i.prototype.unwrap=function(){return this._cb()},i}();Gr.LazyServiceIdentifer=pR;function gR(i){return function(e,t,n){if(i===void 0)throw new Error(lR.UNDEFINED_INJECT_ANNOTATION(e.name));var r=new hR.Metadata(fR.INJECT_TAG,i);typeof n=="number"?lv.tagParameter(e,t,n,r):lv.tagProperty(e,t,r)}}Gr.inject=gR});var fv=f(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.QueryableString=void 0;var mR=function(){function i(e){this.str=e}return i.prototype.startsWith=function(e){return this.str.indexOf(e)===0},i.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},i.prototype.contains=function(e){return this.str.indexOf(e)!==-1},i.prototype.equals=function(e){return this.str===e},i.prototype.value=function(){return this.str},i}();Oc.QueryableString=mR});var Bf=f(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.Target=void 0;var Wn=qe(),yR=mi(),hv=zt(),_R=fv(),vR=function(){function i(e,t,n,r){this.id=yR.id(),this.type=e,this.serviceIdentifier=n,this.name=new _R.QueryableString(t||""),this.metadata=new Array;var o=null;typeof r=="string"?o=new hv.Metadata(Wn.NAMED_TAG,r):r instanceof hv.Metadata&&(o=r),o!==null&&this.metadata.push(o)}return i.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var r=n[t];if(r.key===e)return!0}return!1},i.prototype.isArray=function(){return this.hasTag(Wn.MULTI_INJECT_TAG)},i.prototype.matchesArray=function(e){return this.matchesTag(Wn.MULTI_INJECT_TAG)(e)},i.prototype.isNamed=function(){return this.hasTag(Wn.NAMED_TAG)},i.prototype.isTagged=function(){return this.metadata.some(function(e){return Wn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},i.prototype.isOptional=function(){return this.matchesTag(Wn.OPTIONAL_TAG)(!0)},i.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Wn.NAMED_TAG})[0]:null},i.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Wn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},i.prototype.matchesNamedTag=function(e){return this.matchesTag(Wn.NAMED_TAG)(e)},i.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var s=o[r];if(s.key===e&&s.value===n)return!0}return!1}},i}();Ac.Target=vR});var Sv=f(wn=>{"use strict";var Cc=wn&&wn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(wn,"__esModule",{value:!0});wn.getFunctionName=wn.getBaseClassDependencyCount=wn.getDependencies=void 0;var bR=Lf(),pv=ht(),gv=En(),Ls=qe(),Ff=kr();Object.defineProperty(wn,"getFunctionName",{enumerable:!0,get:function(){return Ff.getFunctionName}});var mv=Bf();function SR(i,e){var t=Ff.getFunctionName(e),n=yv(i,t,e,!1);return n}wn.getDependencies=SR;function yv(i,e,t,n){var r=i.getConstructorMetadata(t),o=r.compilerGeneratedMetadata;if(o===void 0){var s=pv.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=r.userGeneratedMetadata,c=Object.keys(a),u=t.length===0&&c.length>0,d=c.length>t.length,l=u||d?c.length:t.length,S=wR(n,e,o,a,l),R=_v(i,t),v=Cc(Cc([],S),R);return v}function ER(i,e,t,n,r){var o=r[i.toString()]||[],s=bv(o),a=s.unmanaged!==!0,c=n[i],u=s.inject||s.multiInject;if(c=u||c,c instanceof bR.LazyServiceIdentifer&&(c=c.unwrap()),a){var d=c===Object,l=c===Function,S=c===void 0,R=d||l||S;if(!e&&R){var v=pv.MISSING_INJECT_ANNOTATION+" argument "+i+" in class "+t+".";throw new Error(v)}var m=new mv.Target(gv.TargetTypeEnum.ConstructorArgument,s.targetName,c);return m.metadata=o,m}return null}function wR(i,e,t,n,r){for(var o=[],s=0;s<r;s++){var a=s,c=ER(a,i,e,t,n);c!==null&&o.push(c)}return o}function _v(i,e){for(var t=i.getPropertiesMetadata(e),n=[],r=Object.keys(t),o=0,s=r;o<s.length;o++){var a=s[o],c=t[a],u=bv(t[a]),d=u.targetName||a,l=u.inject||u.multiInject,S=new mv.Target(gv.TargetTypeEnum.ClassProperty,d,l);S.metadata=c,n.push(S)}var R=Object.getPrototypeOf(e.prototype).constructor;if(R!==Object){var v=_v(i,R);n=Cc(Cc([],n),v)}return n}function vv(i,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=Ff.getFunctionName(t),r=yv(i,n,t,!0),o=r.map(function(c){return c.metadata.filter(function(u){return u.key===Ls.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=r.length-s;return a>0?a:vv(i,t)}else return 0}wn.getBaseClassDependencyCount=vv;function bv(i){var e={};return i.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[Ls.INJECT_TAG],multiInject:e[Ls.MULTI_INJECT_TAG],targetName:e[Ls.NAME_TAG],unmanaged:e[Ls.UNMANAGED_TAG]}}});var Ev=f(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.Request=void 0;var PR=mi(),IR=function(){function i(e,t,n,r,o){this.id=PR.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=n===null?new Map:null}return i.prototype.addChildRequest=function(e,t,n){var r=new i(e,this.parentContext,this,t,n);return this.childRequests.push(r),r},i}();xc.Request=IR});var Av=f(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.getBindingDictionary=_i.createMockRequest=_i.plan=void 0;var qc=ev(),Kf=ht(),Iv=En(),wv=qe(),RR=Nf(),$r=kr(),Rv=ov(),Hf=zt(),MR=sv(),Vf=Sv(),zf=Ev(),Mv=Bf();function Tv(i){return i._bindingDictionary}_i.getBindingDictionary=Tv;function TR(i,e,t,n,r,o){var s=i?wv.MULTI_INJECT_TAG:wv.INJECT_TAG,a=new Hf.Metadata(s,t),c=new Mv.Target(e,n,t,a);if(r!==void 0){var u=new Hf.Metadata(r,o);c.metadata.push(u)}return c}function Pv(i,e,t,n,r){var o=Bs(t.container,r.serviceIdentifier),s=[];return o.length===qc.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(r.serviceIdentifier).toSelf(),o=Bs(t.container,r.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new zf.Request(a.serviceIdentifier,t,n,a,r);return a.constraint(c)}),OR(r.serviceIdentifier,s,r,t.container),s}function OR(i,e,t,n){switch(e.length){case qc.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var r=$r.getServiceIdentifierAsString(i),o=Kf.NOT_REGISTERED;throw o+=$r.listMetadataForTarget(r,t),o+=$r.listRegisteredBindingsForServiceIdentifier(n,r,Bs),new Error(o);case qc.BindingCount.OnlyOneBindingAvailable:if(!t.isArray())return e;case qc.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var r=$r.getServiceIdentifierAsString(i),o=Kf.AMBIGUOUS_MATCH+" "+r;throw o+=$r.listRegisteredBindingsForServiceIdentifier(n,r,Bs),new Error(o)}}function Ov(i,e,t,n,r,o){var s,a;if(r===null){s=Pv(i,e,n,null,o),a=new zf.Request(t,n,null,s,o);var c=new MR.Plan(n,a);n.addPlan(c)}else s=Pv(i,e,n,r,o),a=r.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(u){var d=null;if(o.isArray())d=a.addChildRequest(u.serviceIdentifier,u,o);else{if(u.cache)return;d=a}if(u.type===Iv.BindingTypeEnum.Instance&&u.implementationType!==null){var l=Vf.getDependencies(i,u.implementationType);if(!n.container.options.skipBaseClassChecks){var S=Vf.getBaseClassDependencyCount(i,u.implementationType);if(l.length<S){var R=Kf.ARGUMENTS_LENGTH_MISMATCH(Vf.getFunctionName(u.implementationType));throw new Error(R)}}l.forEach(function(v){Ov(i,!1,v.serviceIdentifier,n,d,v)})}})}function Bs(i,e){var t=[],n=Tv(i);return n.hasKey(e)?t=n.get(e):i.parent!==null&&(t=Bs(i.parent,e)),t}function AR(i,e,t,n,r,o,s,a){a===void 0&&(a=!1);var c=new Rv.Context(e),u=TR(t,n,r,"",o,s);try{return Ov(i,a,r,c,null,u),c}catch(d){throw RR.isStackOverflowExeption(d)&&c.plan&&$r.circularDependencyToException(c.plan.rootRequest),d}}_i.plan=AR;function CR(i,e,t,n){var r=new Mv.Target(Iv.TargetTypeEnum.Variable,"",e,new Hf.Metadata(t,n)),o=new Rv.Context(i),s=new zf.Request(e,o,null,[],r);return s}_i.createMockRequest=CR});var qv=f(Wr=>{"use strict";var xR=Wr&&Wr.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.resolveInstance=void 0;var qR=ht(),xv=En(),Cv=qe();function DR(i,e,t){var n=e.filter(function(o){return o.target!==null&&o.target.type===xv.TargetTypeEnum.ClassProperty}),r=n.map(t);return n.forEach(function(o,s){var a="";a=o.target.name.value();var c=r[s];i[a]=c}),i}function jR(i,e){return new(i.bind.apply(i,xR([void 0],e)))}function NR(i,e){if(Reflect.hasMetadata(Cv.POST_CONSTRUCT,i)){var t=Reflect.getMetadata(Cv.POST_CONSTRUCT,i);try{e[t.value]()}catch(n){throw new Error(qR.POST_CONSTRUCT_ERROR(i.name,n.message))}}}function LR(i,e,t){var n=null;if(e.length>0){var r=e.filter(function(s){return s.target!==null&&s.target.type===xv.TargetTypeEnum.ConstructorArgument}),o=r.map(t);n=jR(i,o),n=DR(n,e,t)}else n=new i;return NR(i,n),n}Wr.resolveInstance=LR});var jv=f(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.resolve=void 0;var Dv=ht(),Xn=En(),BR=Nf(),FR=kr(),VR=qv(),Yf=function(i,e,t){try{return t()}catch(n){throw BR.isStackOverflowExeption(n)?new Error(Dv.CIRCULAR_DEPENDENCY_IN_FACTORY(i,e.toString())):n}},Uf=function(i){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,r=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(r&&o)return n.map(function(l){var S=Uf(i);return S(l)});var s=null;if(e.target.isOptional()&&t.length===0)return;var a=t[0],c=a.scope===Xn.BindingScopeEnum.Singleton,u=a.scope===Xn.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&i!==null&&i.has(a.id))return i.get(a.id);if(a.type===Xn.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===Xn.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===Xn.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===Xn.BindingTypeEnum.DynamicValue&&a.dynamicValue!==null)s=Yf("toDynamicValue",a.serviceIdentifier,function(){return a.dynamicValue(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Factory&&a.factory!==null)s=Yf("toFactory",a.serviceIdentifier,function(){return a.factory(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Provider&&a.provider!==null)s=Yf("toProvider",a.serviceIdentifier,function(){return a.provider(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Instance&&a.implementationType!==null)s=VR.resolveInstance(a.implementationType,n,Uf(i));else{var d=FR.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(Dv.INVALID_BINDING_TYPE+" "+d)}return typeof a.onActivation=="function"&&(s=a.onActivation(e.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&i!==null&&!i.has(a.id)&&i.set(a.id,s),s}};function KR(i){var e=Uf(i.plan.rootRequest.requestScope);return e(i.plan.rootRequest)}Dc.resolve=KR});var kf=f(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.typeConstraint=Pn.namedConstraint=Pn.taggedConstraint=Pn.traverseAncerstors=void 0;var HR=qe(),zR=zt(),Nv=function(i,e){var t=i.parentRequest;return t!==null?e(t)?!0:Nv(t,e):!1};Pn.traverseAncerstors=Nv;var Lv=function(i){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(i)(e)};return t.metaData=new zR.Metadata(i,e),t}};Pn.taggedConstraint=Lv;var YR=Lv(HR.NAMED_TAG);Pn.namedConstraint=YR;var UR=function(i){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof i=="string"){var n=t.serviceIdentifier;return n===i}else{var r=e.bindings[0].implementationType;return i===r}return!1}};Pn.typeConstraint=UR});var Nc=f(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.BindingWhenSyntax=void 0;var st=Lc(),De=kf(),kR=function(){function i(e){this._binding=e}return i.prototype.when=function(e){return this._binding.constraint=e,new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetNamed=function(e){return this._binding.constraint=De.namedConstraint(e),new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=De.taggedConstraint(e)(t),new st.BindingOnSyntax(this._binding)},i.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return De.typeConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return De.namedConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return De.taggedConstraint(e)(t)(n.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i}();jc.BindingWhenSyntax=kR});var Lc=f(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.BindingOnSyntax=void 0;var GR=Nc(),$R=function(){function i(e){this._binding=e}return i.prototype.onActivation=function(e){return this._binding.onActivation=e,new GR.BindingWhenSyntax(this._binding)},i}();Bc.BindingOnSyntax=$R});var Gf=f(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.BindingWhenOnSyntax=void 0;var WR=Lc(),XR=Nc(),JR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new XR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new WR.BindingOnSyntax(this._binding)}return i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Fc.BindingWhenOnSyntax=JR});var Bv=f(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.BindingInSyntax=void 0;var $f=En(),Wf=Gf(),ZR=function(){function i(e){this._binding=e}return i.prototype.inRequestScope=function(){return this._binding.scope=$f.BindingScopeEnum.Request,new Wf.BindingWhenOnSyntax(this._binding)},i.prototype.inSingletonScope=function(){return this._binding.scope=$f.BindingScopeEnum.Singleton,new Wf.BindingWhenOnSyntax(this._binding)},i.prototype.inTransientScope=function(){return this._binding.scope=$f.BindingScopeEnum.Transient,new Wf.BindingWhenOnSyntax(this._binding)},i}();Vc.BindingInSyntax=ZR});var Fv=f(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.BindingInWhenOnSyntax=void 0;var QR=Bv(),eM=Lc(),tM=Nc(),nM=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new tM.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new eM.BindingOnSyntax(this._binding),this._bindingInSyntax=new QR.BindingInSyntax(e)}return i.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},i.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},i.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Kc.BindingInWhenOnSyntax=nM});var Hv=f(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.BindingToSyntax=void 0;var Vv=ht(),pt=En(),Kv=Fv(),Fs=Gf(),iM=function(){function i(e){this._binding=e}return i.prototype.to=function(e){return this._binding.type=pt.BindingTypeEnum.Instance,this._binding.implementationType=e,new Kv.BindingInWhenOnSyntax(this._binding)},i.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Vv.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},i.prototype.toConstantValue=function(e){return this._binding.type=pt.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pt.BindingScopeEnum.Singleton,new Fs.BindingWhenOnSyntax(this._binding)},i.prototype.toDynamicValue=function(e){return this._binding.type=pt.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Kv.BindingInWhenOnSyntax(this._binding)},i.prototype.toConstructor=function(e){return this._binding.type=pt.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Fs.BindingWhenOnSyntax(this._binding)},i.prototype.toFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Fs.BindingWhenOnSyntax(this._binding)},i.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Vv.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=pt.BindingTypeEnum.Function,this._binding.scope=pt.BindingScopeEnum.Singleton,t},i.prototype.toAutoFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=pt.BindingScopeEnum.Singleton,new Fs.BindingWhenOnSyntax(this._binding)},i.prototype.toProvider=function(e){return this._binding.type=pt.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Fs.BindingWhenOnSyntax(this._binding)},i.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},i}();Hc.BindingToSyntax=iM});var zv=f(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.ContainerSnapshot=void 0;var rM=function(){function i(){}return i.of=function(e,t){var n=new i;return n.bindings=e,n.middleware=t,n},i}();zc.ContainerSnapshot=rM});var Yv=f(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.Lookup=void 0;var ir=ht(),oM=function(){function i(){this._map=new Map}return i.prototype.getMap=function(){return this._map},i.prototype.add=function(e,t){if(e==null)throw new Error(ir.NULL_ARGUMENT);if(t==null)throw new Error(ir.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},i.prototype.get=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(ir.KEY_NOT_FOUND)},i.prototype.remove=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(ir.KEY_NOT_FOUND)},i.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var o=n.filter(function(s){return!e(s)});o.length>0?t._map.set(r,o):t._map.delete(r)})},i.prototype.hasKey=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);return this._map.has(e)},i.prototype.clone=function(){var e=new i;return this._map.forEach(function(t,n){t.forEach(function(r){return e.add(n,r.clone())})}),e},i.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},i}();Yc.Lookup=oM});var kv=f(In=>{"use strict";var sM=In&&In.__awaiter||function(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(l){s(l)}}function c(d){try{u(n.throw(d))}catch(l){s(l)}}function u(d){d.done?o(d.value):r(d.value).then(a,c)}u((n=n.apply(i,e||[])).next())})},aM=In&&In.__generator||function(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},cM=In&&In.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(In,"__esModule",{value:!0});In.Container=void 0;var uM=Q_(),rr=ht(),Jn=En(),Xf=qe(),dM=jf(),Uc=Av(),lM=jv(),fM=Hv(),hM=mi(),pM=kr(),gM=zv(),Uv=Yv(),mM=function(){function i(e){this._appliedMiddleware=[];var t=e||{};if(typeof t!="object")throw new Error(""+rr.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Jn.BindingScopeEnum.Transient;else if(t.defaultScope!==Jn.BindingScopeEnum.Singleton&&t.defaultScope!==Jn.BindingScopeEnum.Transient&&t.defaultScope!==Jn.BindingScopeEnum.Request)throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=hM.id(),this._bindingDictionary=new Uv.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new dM.MetadataReader}return i.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i,s=cM([e,t],n).map(function(u){return Uc.getBindingDictionary(u)}),a=Uc.getBindingDictionary(o);function c(u,d){u.traverse(function(l,S){S.forEach(function(R){d.add(R.serviceIdentifier,R.clone())})})}return s.forEach(function(u){c(u,a)}),o},i.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var s=o[r],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},i.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return sM(this,void 0,void 0,function(){var n,r,o,s,a;return aM(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(o){return function(s){return s.moduleId===o}};t.forEach(function(o){var s=r(o.id);e._bindingDictionary.removeByCondition(s)})},i.prototype.bind=function(e){var t=this.options.defaultScope||Jn.BindingScopeEnum.Transient,n=new uM.Binding(e,t);return this._bindingDictionary.add(e,n),new fM.BindingToSyntax(n)},i.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},i.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(rr.CANNOT_UNBIND+" "+pM.getServiceIdentifierAsString(e))}},i.prototype.unbindAll=function(){this._bindingDictionary=new Uv.Lookup},i.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},i.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Xf.NAMED_TAG,t)},i.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=Uc.createMockRequest(this,e,t,n);r=o.some(function(a){return a.constraint(s)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},i.prototype.snapshot=function(){this._snapshots.push(gM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},i.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(rr.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},i.prototype.createChild=function(e){var t=new i(e||this.options);return t.parent=this,t},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(r,o){return o(r)},n)},i.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},i.prototype.get=function(e){return this._get(!1,!1,Jn.TargetTypeEnum.Variable,e)},i.prototype.getTagged=function(e,t,n){return this._get(!1,!1,Jn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getNamed=function(e,t){return this.getTagged(e,Xf.NAMED_TAG,t)},i.prototype.getAll=function(e){return this._get(!0,!0,Jn.TargetTypeEnum.Variable,e)},i.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,Jn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Xf.NAMED_TAG,t)},i.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(e)},i.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(a,c){a._binding.moduleId=c},n=function(a){return function(c){var u=e.bind.bind(e),d=u(c);return t(d,a),d}},r=function(a){return function(c){var u=e.unbind.bind(e);u(c)}},o=function(a){return function(c){var u=e.isBound.bind(e);return u(c)}},s=function(a){return function(c){var u=e.rebind.bind(e),d=u(c);return t(d,a),d}};return function(a){return{bindFunction:n(a),isboundFunction:o(a),rebindFunction:s(a),unbindFunction:r(a)}}},i.prototype._get=function(e,t,n,r,o,s){var a=null,c={avoidConstraints:e,contextInterceptor:function(u){return u},isMultiInject:t,key:o,serviceIdentifier:r,targetType:n,value:s};if(this._middleware){if(a=this._middleware(c),a==null)throw new Error(rr.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},i.prototype._planAndResolve=function(){var e=this;return function(t){var n=Uc.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var r=lM.resolve(n);return r}},i}();In.Container=mM});var $v=f(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.AsyncContainerModule=Xr.ContainerModule=void 0;var Gv=mi(),yM=function(){function i(e){this.id=Gv.id(),this.registry=e}return i}();Xr.ContainerModule=yM;var _M=function(){function i(e){this.id=Gv.id(),this.registry=e}return i}();Xr.AsyncContainerModule=_M});var Wv=f(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.injectable=void 0;var vM=ht(),Jf=qe();function bM(){return function(i){if(Reflect.hasOwnMetadata(Jf.PARAM_TYPES,i))throw new Error(vM.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(Jf.DESIGN_PARAM_TYPES,i)||[];return Reflect.defineMetadata(Jf.PARAM_TYPES,e,i),i}}kc.injectable=bM});var Jv=f(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.tagged=void 0;var SM=zt(),Xv=$n();function EM(i,e){return function(t,n,r){var o=new SM.Metadata(i,e);typeof r=="number"?Xv.tagParameter(t,n,r,o):Xv.tagProperty(t,n,o)}}Gc.tagged=EM});var Qv=f($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.named=void 0;var wM=qe(),PM=zt(),Zv=$n();function IM(i){return function(e,t,n){var r=new PM.Metadata(wM.NAMED_TAG,i);typeof n=="number"?Zv.tagParameter(e,t,n,r):Zv.tagProperty(e,t,r)}}$c.named=IM});var tb=f(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});Wc.optional=void 0;var RM=qe(),MM=zt(),eb=$n();function TM(){return function(i,e,t){var n=new MM.Metadata(RM.OPTIONAL_TAG,!0);typeof t=="number"?eb.tagParameter(i,e,t,n):eb.tagProperty(i,e,n)}}Wc.optional=TM});var nb=f(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.unmanaged=void 0;var OM=qe(),AM=zt(),CM=$n();function xM(){return function(i,e,t){var n=new AM.Metadata(OM.UNMANAGED_TAG,!0);CM.tagParameter(i,e,t,n)}}Xc.unmanaged=xM});var rb=f(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.multiInject=void 0;var qM=qe(),DM=zt(),ib=$n();function jM(i){return function(e,t,n){var r=new DM.Metadata(qM.MULTI_INJECT_TAG,i);typeof n=="number"?ib.tagParameter(e,t,n,r):ib.tagProperty(e,t,r)}}Jc.multiInject=jM});var ob=f(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.targetName=void 0;var NM=qe(),LM=zt(),BM=$n();function FM(i){return function(e,t,n){var r=new LM.Metadata(NM.NAME_TAG,i);BM.tagParameter(e,t,n,r)}}Zc.targetName=FM});var sb=f(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.postConstruct=void 0;var VM=ht(),Zf=qe(),KM=zt();function HM(){return function(i,e,t){var n=new KM.Metadata(Zf.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(Zf.POST_CONSTRUCT,i.constructor))throw new Error(VM.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Zf.POST_CONSTRUCT,n,i.constructor)}}Qc.postConstruct=HM});var ab=f(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.multiBindToService=void 0;var zM=function(i){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(r){return i.bind(r).toService(e)})}}};eu.multiBindToService=zM});var _=f(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.multiBindToService=q.getServiceIdentifierAsString=q.typeConstraint=q.namedConstraint=q.taggedConstraint=q.traverseAncerstors=q.decorate=q.id=q.MetadataReader=q.postConstruct=q.targetName=q.multiInject=q.unmanaged=q.optional=q.LazyServiceIdentifer=q.inject=q.named=q.tagged=q.injectable=q.ContainerModule=q.AsyncContainerModule=q.TargetTypeEnum=q.BindingTypeEnum=q.BindingScopeEnum=q.Container=q.METADATA_KEY=void 0;var YM=qe();q.METADATA_KEY=YM;var UM=kv();Object.defineProperty(q,"Container",{enumerable:!0,get:function(){return UM.Container}});var Qf=En();Object.defineProperty(q,"BindingScopeEnum",{enumerable:!0,get:function(){return Qf.BindingScopeEnum}});Object.defineProperty(q,"BindingTypeEnum",{enumerable:!0,get:function(){return Qf.BindingTypeEnum}});Object.defineProperty(q,"TargetTypeEnum",{enumerable:!0,get:function(){return Qf.TargetTypeEnum}});var cb=$v();Object.defineProperty(q,"AsyncContainerModule",{enumerable:!0,get:function(){return cb.AsyncContainerModule}});Object.defineProperty(q,"ContainerModule",{enumerable:!0,get:function(){return cb.ContainerModule}});var kM=Wv();Object.defineProperty(q,"injectable",{enumerable:!0,get:function(){return kM.injectable}});var GM=Jv();Object.defineProperty(q,"tagged",{enumerable:!0,get:function(){return GM.tagged}});var $M=Qv();Object.defineProperty(q,"named",{enumerable:!0,get:function(){return $M.named}});var ub=Lf();Object.defineProperty(q,"inject",{enumerable:!0,get:function(){return ub.inject}});Object.defineProperty(q,"LazyServiceIdentifer",{enumerable:!0,get:function(){return ub.LazyServiceIdentifer}});var WM=tb();Object.defineProperty(q,"optional",{enumerable:!0,get:function(){return WM.optional}});var XM=nb();Object.defineProperty(q,"unmanaged",{enumerable:!0,get:function(){return XM.unmanaged}});var JM=rb();Object.defineProperty(q,"multiInject",{enumerable:!0,get:function(){return JM.multiInject}});var ZM=ob();Object.defineProperty(q,"targetName",{enumerable:!0,get:function(){return ZM.targetName}});var QM=sb();Object.defineProperty(q,"postConstruct",{enumerable:!0,get:function(){return QM.postConstruct}});var eT=jf();Object.defineProperty(q,"MetadataReader",{enumerable:!0,get:function(){return eT.MetadataReader}});var tT=mi();Object.defineProperty(q,"id",{enumerable:!0,get:function(){return tT.id}});var nT=$n();Object.defineProperty(q,"decorate",{enumerable:!0,get:function(){return nT.decorate}});var tu=kf();Object.defineProperty(q,"traverseAncerstors",{enumerable:!0,get:function(){return tu.traverseAncerstors}});Object.defineProperty(q,"taggedConstraint",{enumerable:!0,get:function(){return tu.taggedConstraint}});Object.defineProperty(q,"namedConstraint",{enumerable:!0,get:function(){return tu.namedConstraint}});Object.defineProperty(q,"typeConstraint",{enumerable:!0,get:function(){return tu.typeConstraint}});var iT=kr();Object.defineProperty(q,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return iT.getServiceIdentifierAsString}});var rT=ab();Object.defineProperty(q,"multiBindToService",{enumerable:!0,get:function(){return rT.multiBindToService}})});var iu=f(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});nu.Deferred=void 0;var eh=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};nu.Deferred=eh});var P=f(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.TYPES=void 0;ru.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandler:Symbol("IButtonHandler"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),IToolManager:Symbol("IToolManager"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}});var Rn=f(Yt=>{"use strict";var ou=Yt&&Yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.MultiInstanceRegistry=Yt.InstanceRegistry=Yt.FactoryRegistry=Yt.ProviderRegistry=void 0;var su=_(),th=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?new n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};th=ou([(0,su.injectable)()],th);Yt.ProviderRegistry=th;var nh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};nh=ou([(0,su.injectable)()],nh);Yt.FactoryRegistry=nh;var ih=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e){let t=this.elements.get(e);return t||this.missing(e)}missing(e){throw new Error("Unknown registry key: "+e)}};ih=ou([(0,su.injectable)()],ih);Yt.InstanceRegistry=ih;var rh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");let n=this.elements.get(e);n!==void 0?n.push(t):this.elements.set(e,[t])}deregisterAll(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}get(e){let t=this.elements.get(e);return t!==void 0?t:[]}};rh=ou([(0,su.injectable)()],rh);Yt.MultiInstanceRegistry=rh});var ee=f(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.almostEquals=fe.toRadians=fe.toDegrees=fe.Bounds=fe.isBounds=fe.Dimension=fe.centerOfLine=fe.angleBetweenPoints=fe.angleOfPoint=fe.Point=void 0;var oT=Sn(),sT;(function(i){i.ORIGIN=Object.freeze({x:0,y:0});function e(l,S){return{x:l.x+S.x,y:l.y+S.y}}i.add=e;function t(l,S){return{x:l.x-S.x,y:l.y-S.y}}i.subtract=t;function n(l,S){return l.x===S.x&&l.y===S.y}i.equals=n;function r(l,S,R){let v=t(S,l),m=o(v),T={x:m.x*R,y:m.y*R};return e(l,T)}i.shiftTowards=r;function o(l){let S=s(l);return S===0||S===1?i.ORIGIN:{x:l.x/S,y:l.y/S}}i.normalize=o;function s(l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))}i.magnitude=s;function a(l,S,R){return{x:(1-R)*l.x+R*S.x,y:(1-R)*l.y+R*S.y}}i.linear=a;function c(l,S){let R=S.x-l.x,v=S.y-l.y;return Math.sqrt(R*R+v*v)}i.euclideanDistance=c;function u(l,S){return Math.abs(S.x-l.x)+Math.abs(S.y-l.y)}i.manhattanDistance=u;function d(l,S){return Math.max(Math.abs(S.x-l.x),Math.abs(S.y-l.y))}i.maxDistance=d})(sT=fe.Point||(fe.Point={}));function aT(i){return Math.atan2(i.y,i.x)}fe.angleOfPoint=aT;function cT(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}fe.angleBetweenPoints=cT;function uT(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return db.center(t)}fe.centerOfLine=uT;var au;(function(i){i.EMPTY=Object.freeze({width:-1,height:-1});function e(t){return t.width>=0&&t.height>=0}i.isValid=e})(au=fe.Dimension||(fe.Dimension={}));function dT(i){return(0,oT.hasOwnProperty)(i,["x","y","width","height"])}fe.isBounds=dT;var db;(function(i){i.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function e(o,s){if(!au.isValid(o))return au.isValid(s)?s:i.EMPTY;if(!au.isValid(s))return o;let a=Math.min(o.x,s.x),c=Math.min(o.y,s.y),u=Math.max(o.x+(o.width>=0?o.width:0),s.x+(s.width>=0?s.width:0)),d=Math.max(o.y+(o.height>=0?o.height:0),s.y+(s.height>=0?s.height:0));return{x:a,y:c,width:u-a,height:d-c}}i.combine=e;function t(o,s){return{x:o.x+s.x,y:o.y+s.y,width:o.width,height:o.height}}i.translate=t;function n(o){return{x:o.x+(o.width>=0?.5*o.width:0),y:o.y+(o.height>=0?.5*o.height:0)}}i.center=n;function r(o,s){return s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height}i.includes=r})(db=fe.Bounds||(fe.Bounds={}));function lT(i){return i*180/Math.PI}fe.toDegrees=lT;function fT(i){return i*Math.PI/180}fe.toRadians=fT;function hT(i,e){return Math.abs(i-e)<.001}fe.almostEquals=hT});var or=f(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.mapIterable=at.filterIterable=at.DONE_RESULT=at.toArray=at.FluentIterableImpl=void 0;var Vs=class{constructor(e,t){this.startFn=e,this.nextFn=t}[Symbol.iterator](){let e={state:this.startFn(),next:()=>this.nextFn(e.state),[Symbol.iterator]:()=>e};return e}filter(e){return lb(this,e)}map(e){return fb(this,e)}forEach(e){let t=this[Symbol.iterator](),n=0,r;do r=t.next(),r.value!==void 0&&e(r.value,n),n++;while(!r.done)}indexOf(e){let t=this[Symbol.iterator](),n=0,r;do{if(r=t.next(),r.value===e)return n;n++}while(!r.done);return-1}};at.FluentIterableImpl=Vs;function pT(i){if(i.constructor===Array)return i;let e=[];return i.forEach(t=>e.push(t)),e}at.toArray=pT;at.DONE_RESULT=Object.freeze({done:!0,value:void 0});function lb(i,e){return new Vs(()=>hb(i),t=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n})}at.filterIterable=lb;function fb(i,e){return new Vs(()=>hb(i),t=>{let{done:n,value:r}=t.next();return n?at.DONE_RESULT:{done:!1,value:e(r)}})}at.mapIterable=fb;function hb(i){let e=i[Symbol.iterator];if(typeof e=="function")return e.call(i);let t=i.length;return typeof t=="number"&&t>=0?new oh(i):{next:()=>at.DONE_RESULT}}var oh=class{constructor(e){this.array=e,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:at.DONE_RESULT}[Symbol.iterator](){return this}}});var G=f(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.ModelIndexImpl=Je.createRandomId=Je.SModelRoot=Je.SChildElement=Je.SParentElement=Je.isParent=Je.SModelElement=void 0;var sh=ee(),gT=or(),cu=class{get root(){let e=this;for(;e;){if(e instanceof du)return e;e instanceof uu?e=e.parent:e=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(e){return this.features!==void 0&&this.features.has(e)}};Je.SModelElement=cu;function mT(i){let e=i.children;return e!==void 0&&e.constructor===Array}Je.isParent=mT;var sr=class extends cu{constructor(){super(...arguments),this.children=[]}add(e,t){let n=this.children;if(t===void 0)n.push(e);else{if(t<0||t>this.children.length)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(t,0,e)}e.parent=this,this.index.add(e)}remove(e){let t=this.children,n=t.indexOf(e);if(n<0)throw new Error(`No such child ${e.id}`);t.splice(n,1),this.index.remove(e)}removeAll(e){let t=this.children;if(e!==void 0){for(let n=t.length-1;n>=0;n--)if(e(t[n])){let r=t.splice(n,1)[0];this.index.remove(r)}}else t.forEach(n=>{this.index.remove(n)}),t.splice(0,t.length)}move(e,t){let n=this.children,r=n.indexOf(e);if(r===-1)throw new Error(`No such child ${e.id}`);if(t<0||t>n.length-1)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(r,1),n.splice(t,0,e)}localToParent(e){return(0,sh.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}parentToLocal(e){return(0,sh.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}};Je.SParentElement=sr;var uu=class extends sr{};Je.SChildElement=uu;var du=class extends sr{constructor(e=new lu){super(),this.canvasBounds=sh.Bounds.EMPTY,Object.defineProperty(this,"index",{value:e,writable:!1})}};Je.SModelRoot=du;var pb="0123456789abcdefghijklmnopqrstuvwxyz";function gb(i=8){let e="";for(let t=0;t<i;t++)e+=pb.charAt(Math.floor(Math.random()*pb.length));return e}Je.createRandomId=gb;var lu=class{constructor(){this.id2element=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else do e.id=gb();while(this.contains(e));if(this.id2element.set(e.id,e),e instanceof sr)for(let t of e.children)this.add(t)}remove(e){if(this.id2element.delete(e.id),e instanceof sr)for(let t of e.children)this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getAttachedElements(e){return[]}all(){return(0,gT.mapIterable)(this.id2element,([e,t])=>t)}};Je.ModelIndexImpl=lu});var Mn=f(Ze=>{"use strict";var ah=Ze&&Ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yb=Ze&&Ze.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},mb=Ze&&Ze.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.createFeatureSet=Ze.EMPTY_ROOT=Ze.SModelFactory=Ze.SModelRegistry=void 0;var Ks=_(),_b=P(),yT=Rn(),Jr=G(),fu=class extends yT.FactoryRegistry{constructor(e){super(),e.forEach(t=>{let n=this.getDefaultFeatures(t.constr);if(!n&&t.features&&t.features.enable&&(n=[]),n){let r=vb(n,t.features);this.register(t.type,()=>{let o=new t.constr;return o.features=r,o})}else this.register(t.type,()=>new t.constr)})}getDefaultFeatures(e){let t=e;do{let n=t.DEFAULT_FEATURES;if(n)return n;t=Object.getPrototypeOf(t)}while(t)}};fu=ah([(0,Ks.injectable)(),mb(0,(0,Ks.multiInject)(_b.TYPES.SModelElementRegistration)),mb(0,(0,Ks.optional)()),yb("design:paramtypes",[Array])],fu);Ze.SModelRegistry=fu;var hu=class{createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Jr.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else n=new Jr.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Jr.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else t=new Jr.SModelRoot;return this.initializeRoot(t,e)}createSchema(e){let t={};for(let n in e)if(!this.isReserved(e,n)){let r=e[n];typeof r!="function"&&(t[n]=r)}return e instanceof Jr.SParentElement&&(t.children=e.children.map(n=>this.createSchema(n))),t}initializeElement(e,t){for(let n in t)if(!this.isReserved(e,n)){let r=t[n];typeof r!="function"&&(e[n]=r)}return e}isReserved(e,t){if(["children","parent","index"].indexOf(t)>=0)return!0;let n=e;do{let r=Object.getOwnPropertyDescriptor(n,t);if(r!==void 0)return r.get!==void 0;n=Object.getPrototypeOf(n)}while(n);return!1}initializeParent(e,t){return this.initializeElement(e,t),(0,Jr.isParent)(t)&&(e.children=t.children.map(n=>this.createElement(n,e))),e}initializeChild(e,t,n){return this.initializeParent(e,t),n!==void 0&&(e.parent=n),e}initializeRoot(e,t){return this.initializeParent(e,t),e.index.add(e),e}};ah([(0,Ks.inject)(_b.TYPES.SModelRegistry),yb("design:type",fu)],hu.prototype,"registry",void 0);hu=ah([(0,Ks.injectable)()],hu);Ze.SModelFactory=hu;Ze.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function vb(i,e){let t=new Set(i);if(e&&e.enable)for(let n of e.enable)t.add(n);if(e&&e.disable)for(let n of e.disable)t.delete(n);return t}Ze.createFeatureSet=vb});var Qr=f(Zr=>{"use strict";var _T=Zr&&Zr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.AnimationFrameSyncer=void 0;var vT=_(),ch=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(e){this.tasks.push(e),this.trigger()}onEndOfNextFrame(e){this.endTasks.push(e),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(e=>this.run(e)):setTimeout(e=>this.run(e)))}run(e){let t=this.tasks,n=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],t.forEach(r=>r.call(void 0,e)),n.forEach(r=>r.call(void 0,e))}};ch=_T([(0,vT.injectable)()],ch);Zr.AnimationFrameSyncer=ch});var pu=f(bi=>{"use strict";var eo=bi&&bi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Hs=bi&&bi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(bi,"__esModule",{value:!0});bi.ActionDispatcher=void 0;var to=_(),ar=ie(),bT=iu(),zs=P(),ST=Mn(),ET=Qr(),vi=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(e=>{this.actionHandlerRegistry=e,this.handleAction(ar.SetModelAction.create(ST.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(e){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(e,this.blockUntil);if(this.diagramLocker.isAllowed(e))return this.handleAction(e)})}dispatchAll(e){return Promise.all(e.map(t=>this.dispatch(t)))}request(e){if(!e.requestId)return Promise.reject(new Error("Request without requestId"));let t=new bT.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(()=>{}),t.promise}handleAction(e){if(e.kind===ar.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(e.kind===ar.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,ar.isResponseAction)(e)){let r=this.requests.get(e.responseId);if(r!==void 0){if(this.requests.delete(e.responseId),e.kind===ar.RejectAction.KIND){let o=e;r.reject(new Error(o.message)),this.logger.warn(this,`Request with id ${e.responseId} failed.`,o.message,o.detail)}else r.resolve(e);return Promise.resolve()}this.logger.log(this,"No matching request for response",e)}let t=this.actionHandlerRegistry.get(e.kind);if(t.length===0){this.logger.warn(this,"Missing handler for action",e);let r=new Error(`Missing handler for action '${e.kind}'`);if((0,ar.isRequestAction)(e)){let o=this.requests.get(e.requestId);o!==void 0&&(this.requests.delete(e.requestId),o.reject(r))}return Promise.reject(r)}this.logger.log(this,"Handle",e);let n=[];for(let r of t){let o=r.handle(e);(0,ar.isAction)(o)?n.push(this.dispatch(o)):o!==void 0&&(n.push(this.commandStack.execute(o)),this.blockUntil=o.blockUntil)}return Promise.all(n)}handleBlocked(e,t){if(t(e)){this.blockUntil=void 0;let n=this.handleAction(e),r=this.postponedActions;this.postponedActions=[];for(let o of r)this.dispatch(o.action).then(o.resolve,o.reject);return n}else return this.logger.log(this,"Action is postponed due to block condition",e),new Promise((n,r)=>{this.postponedActions.push({action:e,resolve:n,reject:r})})}};eo([(0,to.inject)(zs.TYPES.ActionHandlerRegistryProvider),Hs("design:type",Function)],vi.prototype,"actionHandlerRegistryProvider",void 0);eo([(0,to.inject)(zs.TYPES.ICommandStack),Hs("design:type",Object)],vi.prototype,"commandStack",void 0);eo([(0,to.inject)(zs.TYPES.ILogger),Hs("design:type",Object)],vi.prototype,"logger",void 0);eo([(0,to.inject)(zs.TYPES.AnimationFrameSyncer),Hs("design:type",ET.AnimationFrameSyncer)],vi.prototype,"syncer",void 0);eo([(0,to.inject)(zs.TYPES.IDiagramLocker),Hs("design:type",Object)],vi.prototype,"diagramLocker",void 0);vi=eo([(0,to.injectable)()],vi);bi.ActionDispatcher=vi});var cr=f(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.isInjectable=void 0;function wT(i){return Reflect.getMetadata("inversify:paramtypes",i)!==void 0}gu.isInjectable=wT});var Us=f(gt=>{"use strict";var PT=gt&&gt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},IT=gt&&gt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},mu=gt&&gt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(gt,"__esModule",{value:!0});gt.onAction=gt.configureActionHandler=gt.ActionHandlerRegistry=void 0;var Ys=_(),yu=P(),RT=Rn(),MT=cr(),uh=class extends RT.MultiInstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.actionKind,n.factory())),t.forEach(n=>this.initializeActionHandler(n))}initializeActionHandler(e){e.initialize(this)}};uh=PT([(0,Ys.injectable)(),mu(0,(0,Ys.multiInject)(yu.TYPES.ActionHandlerRegistration)),mu(0,(0,Ys.optional)()),mu(1,(0,Ys.multiInject)(yu.TYPES.IActionHandlerInitializer)),mu(1,(0,Ys.optional)()),IT("design:paramtypes",[Array,Array])],uh);gt.ActionHandlerRegistry=uh;function TT(i,e,t){if(typeof t=="function"){if(!(0,MT.isInjectable)(t))throw new Error(`Action handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(yu.TYPES.ActionHandlerRegistration).toDynamicValue(n=>({actionKind:e,factory:()=>n.container.get(t)}))}gt.configureActionHandler=TT;function OT(i,e,t){i.bind(yu.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:e,factory:()=>({handle:t})})}gt.onAction=OT});var lh=f(no=>{"use strict";var AT=no&&no.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(no,"__esModule",{value:!0});no.DefaultDiagramLocker=void 0;var CT=_(),dh=class{isAllowed(e){return!0}};dh=AT([(0,CT.injectable)()],dh);no.DefaultDiagramLocker=dh});var fh=f(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.easeInOut=void 0;function xT(i){return i<.5?i*i*2:1-(1-i)*(1-i)*2}_u.easeInOut=xT});var ur=f(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.CompoundAnimation=io.Animation=void 0;var bb=fh(),vu=class{constructor(e,t=bb.easeInOut){this.context=e,this.ease=t}start(){return new Promise((e,t)=>{let n,r=0,o=s=>{r++;let a;n===void 0?(n=s,a=0):a=s-n;let c=Math.min(1,a/this.context.duration),u=this.tween(this.ease(c),this.context);this.context.modelChanged.update(u),c===1?(this.context.logger.log(this,r*1e3/this.context.duration+" fps"),e(u)):this.context.syncer.onNextFrame(o)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(o);else{let s=this.tween(1,this.context);e(s)}})}};io.Animation=vu;var hh=class extends vu{constructor(e,t,n=[],r=bb.easeInOut){super(t,r),this.model=e,this.context=t,this.components=n,this.ease=r}include(e){return this.components.push(e),this}tween(e,t){for(let n of this.components)n.tween(e,t);return this.model}};io.CompoundAnimation=hh});var me=f(Qe=>{"use strict";var ro=Qe&&Qe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.ResetCommand=Qe.SystemCommand=Qe.PopupCommand=Qe.HiddenCommand=Qe.MergeableCommand=Qe.Command=void 0;var oo=_(),Si=class{};Si=ro([(0,oo.injectable)()],Si);Qe.Command=Si;var ph=class extends Si{merge(e,t){return!1}};ph=ro([(0,oo.injectable)()],ph);Qe.MergeableCommand=ph;var gh=class extends Si{undo(e){return e.logger.error(this,"Cannot undo a hidden command"),e.root}redo(e){return e.logger.error(this,"Cannot redo a hidden command"),e.root}};gh=ro([(0,oo.injectable)()],gh);Qe.HiddenCommand=gh;var mh=class extends Si{};mh=ro([(0,oo.injectable)()],mh);Qe.PopupCommand=mh;var yh=class extends Si{};yh=ro([(0,oo.injectable)()],yh);Qe.SystemCommand=yh;var _h=class extends Si{};_h=ro([(0,oo.injectable)()],_h);Qe.ResetCommand=_h});var yt=f(mt=>{"use strict";var qT=mt&&mt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},DT=mt&&mt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Sb=mt&&mt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(mt,"__esModule",{value:!0});mt.configureCommand=mt.CommandActionHandlerInitializer=mt.CommandActionHandler=void 0;var bu=_(),jT=cr(),vh=P(),Su=class{constructor(e){this.commandRegistration=e}handle(e){return this.commandRegistration.factory(e)}};mt.CommandActionHandler=Su;var bh=class{constructor(e){this.registrations=e}initialize(e){this.registrations.forEach(t=>e.register(t.kind,new Su(t)))}};bh=qT([(0,bu.injectable)(),Sb(0,(0,bu.multiInject)(vh.TYPES.CommandRegistration)),Sb(0,(0,bu.optional)()),DT("design:paramtypes",[Array])],bh);mt.CommandActionHandlerInitializer=bh;function NT(i,e){if(!(0,jT.isInjectable)(e))throw new Error(`Commands should be @injectable: ${e.name}`);i.isBound(e)||i.bind(e).toSelf(),i.bind(vh.TYPES.CommandRegistration).toDynamicValue(t=>({kind:e.KIND,factory:n=>{let r=new bu.Container;return r.parent=t.container,r.bind(vh.TYPES.Action).toConstantValue(n),r.get(e)}}))}mt.configureCommand=NT});var Eb=f(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.overrideCommandStackOptions=void 0;var LT=Sn(),BT=P();function FT(i,e){let t=i.get(BT.TYPES.CommandStackOptions);return(0,LT.safeAssign)(t,e),t}Eu.overrideCommandStackOptions=FT});var Eh=f(wi=>{"use strict";var lr=wi&&wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ei=wi&&wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(wi,"__esModule",{value:!0});wi.CommandStack=void 0;var fr=_(),ks=P(),Sh=Mn(),VT=G(),KT=Qr(),dr=me(),Zn=class{constructor(){this.undoStack=[],this.redoStack=[],this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(Sh.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(Sh.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(Sh.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(e=>e.main.model)}executeAll(e){return e.forEach(t=>{this.logger.log(this,"Executing",t),this.handleCommand(t,t.execute,this.mergeOrPush)}),this.thenUpdate()}execute(e){return this.logger.log(this,"Executing",e),this.handleCommand(e,e.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();let e=this.undoStack[this.undoStack.length-1];return e!==void 0&&!this.isBlockUndo(e)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();let e=this.redoStack.pop();return e!==void 0&&(this.logger.log(this,"Redoing",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(e,t,n){this.currentPromise=this.currentPromise.then(r=>new Promise(o=>{let s;e instanceof dr.HiddenCommand?s="hidden":e instanceof dr.PopupCommand?s="popup":s="main";let a=this.createContext(r.main.model),c;try{c=t.call(e,a)}catch(d){this.logger.error(this,"Failed to execute command:",d),c=r[s].model}let u=wb(r);c instanceof Promise?c.then(d=>{s==="main"&&n.call(this,e,a),u[s]={model:d,modelChanged:!0},o(u)}):c instanceof VT.SModelRoot?(s==="main"&&n.call(this,e,a),u[s]={model:c,modelChanged:!0},o(u)):(s==="main"&&n.call(this,e,a),u[s]={model:c.model,modelChanged:r[s].modelChanged||c.modelChanged,cause:c.cause},o(u))}))}pushToUndoStack(e){this.undoStack.push(e),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(e=>{let t=wb(e);return e.hidden.modelChanged&&(this.updateHidden(e.hidden.model,e.hidden.cause),t.hidden.modelChanged=!1,t.hidden.cause=void 0),e.main.modelChanged&&(this.update(e.main.model,e.main.cause),t.main.modelChanged=!1,t.main.cause=void 0),e.popup.modelChanged&&(this.updatePopup(e.popup.model,e.popup.cause),t.popup.modelChanged=!1,t.popup.cause=void 0),t}),this.currentModel}update(e,t){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(e,t)}updateHidden(e,t){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(e,t)}updatePopup(e,t){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(e,t)}mergeOrPush(e,t){if(this.isBlockUndo(e)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(e);return}if(this.isPushToOffStack(e)&&this.redoStack.length>0){if(this.offStack.length>0){let n=this.offStack[this.offStack.length-1];if(n instanceof dr.MergeableCommand&&n.merge(e,t))return}this.offStack.push(e);return}if(this.isPushToUndoStack(e)){if(this.offStack.forEach(n=>this.undoStack.push(n)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){let n=this.undoStack[this.undoStack.length-1];if(n instanceof dr.MergeableCommand&&n.merge(e,t))return}this.pushToUndoStack(e)}}undoOffStackSystemCommands(){let e=this.offStack.pop();for(;e!==void 0;)this.logger.log(this,"Undoing off-stack",e),this.handleCommand(e,e.undo,()=>{}),e=this.offStack.pop()}undoPreceedingSystemCommands(){let e=this.undoStack[this.undoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)}),e=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let e=this.redoStack[this.redoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.redoStack.pop(),this.logger.log(this,"Redoing ",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)}),e=this.redoStack[this.redoStack.length-1]}createContext(e){return{root:e,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(e){return e instanceof dr.SystemCommand}isPushToUndoStack(e){return!(e instanceof dr.HiddenCommand)}isBlockUndo(e){return e instanceof dr.ResetCommand}};lr([(0,fr.inject)(ks.TYPES.IModelFactory),Ei("design:type",Object)],Zn.prototype,"modelFactory",void 0);lr([(0,fr.inject)(ks.TYPES.IViewerProvider),Ei("design:type",Object)],Zn.prototype,"viewerProvider",void 0);lr([(0,fr.inject)(ks.TYPES.ILogger),Ei("design:type",Object)],Zn.prototype,"logger",void 0);lr([(0,fr.inject)(ks.TYPES.AnimationFrameSyncer),Ei("design:type",KT.AnimationFrameSyncer)],Zn.prototype,"syncer",void 0);lr([(0,fr.inject)(ks.TYPES.CommandStackOptions),Ei("design:type",Object)],Zn.prototype,"options",void 0);lr([(0,fr.postConstruct)(),Ei("design:type",Function),Ei("design:paramtypes",[]),Ei("design:returntype",void 0)],Zn.prototype,"initialize",null);Zn=lr([(0,fr.injectable)()],Zn);wi.CommandStack=Zn;function wb(i){return{main:Object.assign({},i.main),hidden:Object.assign({},i.hidden),popup:Object.assign({},i.popup)}}});var Pb=f(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.ServerActionHandlerRegistry=void 0;var wh=class{constructor(){this.handlers=new Map}getHandler(e){return this.handlers.get(e)}onAction(e,t){this.handlers.has(e)?this.handlers.get(e).push(t):this.handlers.set(e,[t])}removeActionHandler(e,t){let n=this.handlers.get(e);if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}};wu.ServerActionHandlerRegistry=wh});var Pi=f(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.SModelIndex=_t.findElement=_t.getSubType=_t.getBasicType=_t.applyBounds=_t.cloneModel=void 0;function HT(i){return JSON.parse(JSON.stringify(i))}_t.cloneModel=HT;function zT(i,e){let t=new Pu;t.add(i);for(let n of e.bounds){let r=t.getById(n.elementId);if(r){let o=r;n.newPosition&&(o.position={x:n.newPosition.x,y:n.newPosition.y}),n.newSize&&(o.size={width:n.newSize.width,height:n.newSize.height})}}if(e.alignments)for(let n of e.alignments){let r=t.getById(n.elementId);if(r){let o=r;o.alignment={x:n.newAlignment.x,y:n.newAlignment.y}}}}_t.applyBounds=zT;function YT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}_t.getBasicType=YT;function UT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}_t.getSubType=UT;function Ib(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Ib(t,e);if(n!==void 0)return n}}_t.findElement=Ib;var Pu=class{constructor(){this.id2element=new Map,this.id2parent=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(e.id,e),Array.isArray(e.children))for(let t of e.children)this.add(t),this.id2parent.set(t.id,e)}remove(e){if(this.id2element.delete(e.id),Array.isArray(e.children))for(let t of e.children)this.id2parent.delete(t.id),this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getParent(e){return this.id2parent.get(e)}getRoot(e){let t=e;for(;t;){let n=this.id2parent.get(t.id);if(n===void 0)return t;t=n}throw new Error("Element has no root")}};_t.SModelIndex=Pu});var Rb=f(Iu=>{"use strict";Object.defineProperty(Iu,"__esModule",{value:!0});Iu.DiagramServer=void 0;var kT=Pb(),vt=ie(),GT=iu(),Ph=Pi(),Ih=class{constructor(e,t){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=e,this.diagramGenerator=t.DiagramGenerator,this.layoutEngine=t.ModelLayoutEngine,this.actionHandlerRegistry=t.ServerActionHandlerRegistry}onAction(e,t){this.actionHandlerRegistry||(this.actionHandlerRegistry=new kT.ServerActionHandlerRegistry),this.actionHandlerRegistry.onAction(e,t)}removeActionHandler(e,t){this.actionHandlerRegistry&&this.actionHandlerRegistry.removeActionHandler(e,t)}setModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!1)}updateModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(e){if((0,vt.isResponseAction)(e)){let t=e.responseId,n=this.requests.get(t);if(n){if(this.requests.delete(t),e.kind===vt.RejectAction.KIND){let r=e;n.reject(new Error(r.message)),console.warn(`Request with id ${e.responseId} failed: ${r.message}`,r.detail)}else n.resolve(e);return Promise.resolve()}console.info("No matching request for response:",e)}return this.handleAction(e)}request(e){e.requestId||(e.requestId="server_"+(0,vt.generateRequestId)());let t=new GT.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(n=>{this.requests.delete(e.requestId),t.reject(n)}),t.promise}rejectRemoteRequest(e,t){e&&(0,vt.isRequestAction)(e)&&this.dispatch({kind:vt.RejectAction.KIND,responseId:e.requestId,message:t.message,detail:t.stack})}handleAction(e){var t;let n=(t=this.actionHandlerRegistry)===null||t===void 0?void 0:t.getHandler(e.kind);if(n&&n.length===1)return n[0](e,this.state,this);if(n&&n.length>1)return Promise.all(n.map(r=>r(e,this.state,this)));switch(e.kind){case vt.RequestModelAction.KIND:return this.handleRequestModel(e);case vt.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case vt.LayoutAction.KIND:return this.handleLayout(e)}return console.warn(`Unhandled action from client: ${e.kind}`),Promise.resolve()}async handleRequestModel(e){var t;this.state.options=e.options;try{let n=await this.diagramGenerator.generate({options:(t=this.state.options)!==null&&t!==void 0?t:{},state:this.state});n.revision=++this.state.revision,this.state.currentRoot=n,await this.submitModel(this.state.currentRoot,!1,e)}catch(n){this.rejectRemoteRequest(e,n),console.error("Failed to generate diagram:",n)}}async submitModel(e,t,n){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:vt.RequestBoundsAction.KIND,newRoot:e});else{let r=vt.RequestBoundsAction.create(e),o=await this.request(r),s=this.state.currentRoot;o.revision===s.revision?((0,Ph.applyBounds)(s,o),await this.doSubmitModel(s,t,n)):this.rejectRemoteRequest(n,new Error(`Model revision does not match: ${o.revision}`))}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n){if(e.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(e=await this.layoutEngine.layout(e));let r=e.type;if(n&&n.kind===vt.RequestModelAction.KIND){let o=n.requestId,s=vt.SetModelAction.create(e,o);await this.dispatch(s)}else t&&r===this.state.lastSubmittedModelType?await this.dispatch({kind:vt.UpdateModelAction.KIND,newRoot:e,cause:n}):await this.dispatch({kind:vt.SetModelAction.KIND,newRoot:e});this.state.lastSubmittedModelType=r}handleComputedBounds(e){return e.revision!==this.state.currentRoot.revision?Promise.reject():((0,Ph.applyBounds)(this.state.currentRoot,e),Promise.resolve())}async handleLayout(e){if(this.layoutEngine){if(!this.needsServerLayout){let t=(0,Ph.cloneModel)(this.state.currentRoot);t=await this.layoutEngine.layout(t),t.revision=++this.state.revision,this.state.currentRoot=t}await this.doSubmitModel(this.state.currentRoot,!0,e)}}};Iu.DiagramServer=Ih});var Tb=f(Mb=>{"use strict";Object.defineProperty(Mb,"__esModule",{value:!0})});var Ab=f(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.isZoomable=so.isScrollable=void 0;var Ob=Sn();function $T(i){return(0,Ob.hasOwnProperty)(i,"scroll")}so.isScrollable=$T;function WT(i){return(0,Ob.hasOwnProperty)(i,"zoom")}so.isZoomable=WT});var xb=f(Cb=>{"use strict";Object.defineProperty(Cb,"__esModule",{value:!0})});var hr=f(ct=>{"use strict";var XT=ct&&ct.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Qn=ct&&ct.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&XT(e,i,t)};Object.defineProperty(ct,"__esModule",{value:!0});Qn(ie(),ct);Qn(Rb(),ct);Qn(Tb(),ct);Qn(Ab(),ct);Qn(iu(),ct);Qn(ee(),ct);Qn(xb(),ct);Qn(Pi(),ct);Qn(Sn(),ct)});var Tn=f(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.hitsMouseEvent=Ut.getWindowScroll=Ut.isCrossSite=Ut.isMac=Ut.isCtrlOrCmd=void 0;var JT=hr();function ZT(i){return qb()?i.metaKey:i.ctrlKey}Ut.isCtrlOrCmd=ZT;function qb(){return window.navigator.userAgent.indexOf("Mac")!==-1}Ut.isMac=qb;function QT(i){if(i&&typeof window<"u"&&window.location){let e="";return window.location.protocol&&(e+=window.location.protocol+"//"),window.location.host&&(e+=window.location.host),e.length>0&&!i.startsWith(e)}return!1}Ut.isCrossSite=QT;function eO(){return typeof window>"u"?JT.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}Ut.getWindowScroll=eO;function tO(i,e){let t=i.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}Ut.hitsMouseEvent=tO});var $s=f(ut=>{"use strict";var Rh=ut&&ut.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Db=ut&&ut.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},nO=ut&&ut.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ut,"__esModule",{value:!0});ut.InitializeCanvasBoundsCommand=ut.InitializeCanvasBoundsAction=ut.CanvasBoundsInitializer=void 0;var Ru=_(),Gs=ee(),jb=P(),iO=G(),rO=me(),oO=Tn(),Mu=class{decorate(e,t){return t instanceof iO.SModelRoot&&!Gs.Dimension.isValid(t.canvasBounds)&&(this.rootAndVnode=[t,e]),e}postUpdate(){if(this.rootAndVnode!==void 0){let e=this.rootAndVnode[1].elm,t=this.rootAndVnode[0].canvasBounds;if(e!==void 0){let n=this.getBoundsInPage(e);(0,Gs.almostEquals)(n.x,t.x)&&(0,Gs.almostEquals)(n.y,t.y)&&(0,Gs.almostEquals)(n.width,t.width)&&(0,Gs.almostEquals)(n.height,t.width)||this.actionDispatcher.dispatch(Mh.create(n))}this.rootAndVnode=void 0}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,oO.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};Rh([(0,Ru.inject)(jb.TYPES.IActionDispatcher),Db("design:type",Object)],Mu.prototype,"actionDispatcher",void 0);Mu=Rh([(0,Ru.injectable)()],Mu);ut.CanvasBoundsInitializer=Mu;var Mh;(function(i){i.KIND="initializeCanvasBounds";function e(t){return{kind:i.KIND,newCanvasBounds:t}}i.create=e})(Mh=ut.InitializeCanvasBoundsAction||(ut.InitializeCanvasBoundsAction={}));var Tu=class extends rO.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newCanvasBounds=this.action.newCanvasBounds,e.root.canvasBounds=this.newCanvasBounds,e.root}undo(e){return e.root}redo(e){return e.root}};Tu.KIND=Mh.KIND;Tu=Rh([(0,Ru.injectable)(),nO(0,(0,Ru.inject)(jb.TYPES.Action)),Db("design:paramtypes",[Object])],Tu);ut.InitializeCanvasBoundsCommand=Tu});var Au=f(bt=>{"use strict";var sO=bt&&bt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},aO=bt&&bt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},cO=bt&&bt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(bt,"__esModule",{value:!0});bt.SetModelCommand=bt.SetModelAction=bt.RequestModelAction=void 0;var Nb=_(),Lb=ie(),uO=me(),dO=P(),lO=$s(),pr=class{constructor(e,t=""){this.options=e,this.requestId=t,this.kind=pr.KIND}static create(e){return new pr(e,(0,Lb.generateRequestId)())}};bt.RequestModelAction=pr;pr.KIND="requestModel";var ao=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ao.KIND}};bt.SetModelAction=ao;ao.KIND="setModel";var Ou=class extends uO.ResetCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.modelFactory.createRoot(e.root),this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}get blockUntil(){return e=>e.kind===lO.InitializeCanvasBoundsCommand.KIND}};Ou.KIND=Lb.SetModelAction.KIND;Ou=sO([(0,Nb.injectable)(),cO(0,(0,Nb.inject)(dO.TYPES.Action)),aO("design:paramtypes",[Object])],Ou);bt.SetModelCommand=Ou});var Fb=f(Bb=>{"use strict";Object.defineProperty(Bb,"__esModule",{value:!0})});var ze=f(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.transformToRootBounds=Se.containsSome=Se.translateBounds=Se.translatePoint=Se.findParentByFeature=Se.findParent=Se.findElement=Se.getSubType=Se.getBasicType=Se.registerModelElement=void 0;var fO=P(),Ws=G();function hO(i,e,t,n){i.bind(fO.TYPES.SModelElementRegistration).toConstantValue({type:e,constr:t,features:n})}Se.registerModelElement=hO;function pO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}Se.getBasicType=pO;function gO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}Se.getSubType=gO;function Vb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Vb(t,e);if(n!==void 0)return n}}Se.findElement=Vb;function mO(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ws.SChildElement?t=t.parent:t=void 0}return t}Se.findParent=mO;function yO(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ws.SChildElement?t=t.parent:t=void 0}return t}Se.findParentByFeature=yO;function Th(i,e,t){if(e!==t){for(;e instanceof Ws.SChildElement;)if(i=e.localToParent(i),e=e.parent,e===t)return i;let n=[];for(;t instanceof Ws.SChildElement;)n.push(t),t=t.parent;if(e!==t)throw new Error("Incompatible source and target: "+e.id+", "+t.id);for(let r=n.length-1;r>=0;r--)i=n[r].parentToLocal(i)}return i}Se.translatePoint=Th;function _O(i,e,t){let n=Th(i,e,t),r=Th({x:i.x+i.width,y:i.y+i.height},e,t);return{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y}}Se.translateBounds=_O;function vO(i,e){let t=r=>i.index.getById(r.id)!==void 0,n=r=>r.some(o=>t(o)||n(o.children));return n([e])}Se.containsSome=vO;function bO(i,e){for(;i instanceof Ws.SChildElement;)e=i.localToParent(e),i=i.parent;return e}Se.transformToRootBounds=bO});var Cu=f(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.EnableDefaultToolsAction=Ii.EnableToolsAction=void 0;var SO;(function(i){i.KIND="enable-tools";function e(t){return{kind:i.KIND,toolIds:t}}i.create=e})(SO=Ii.EnableToolsAction||(Ii.EnableToolsAction={}));var EO;(function(i){i.KIND="enable-default-tools";function e(){return{kind:i.KIND}}i.create=e})(EO=Ii.EnableDefaultToolsAction||(Ii.EnableDefaultToolsAction={}))});var Be=f(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.getAttrs=Le.on=Le.mergeStyle=Le.copyClassesFromElement=Le.copyClassesFromVNode=Le.setNamespace=Le.setClass=Le.setAttr=void 0;function wO(i,e,t){Hb(i)[e]=t}Le.setAttr=wO;function Oh(i,e,t){zb(i)[e]=t}Le.setClass=Oh;function Kb(i,e){i.data===void 0&&(i.data={}),i.data.ns=e;let t=i.children;if(t!==void 0)for(let n=0;n<t.length;n++){let r=t[n];typeof r!="string"&&Kb(r,e)}}Le.setNamespace=Kb;function PO(i,e){let t=zb(i);Object.keys(t).forEach(n=>Oh(e,n,!0))}Le.copyClassesFromVNode=PO;function IO(i,e){let t=i.classList;for(let n=0;n<t.length;n++){let r=t.item(n);r&&Oh(e,r,!0)}}Le.copyClassesFromElement=IO;function RO(i,e){Xs(i).style=Object.assign(Object.assign({},Xs(i).style||{}),e)}Le.mergeStyle=RO;function MO(i,e,t){let n=TO(i);if(n[e])throw new Error("EventListener for "+e+" already registered on VNode");n[e]=t}Le.on=MO;function Hb(i){let e=Xs(i);return e.attrs||(e.attrs={}),e.attrs}Le.getAttrs=Hb;function Xs(i){return i.data||(i.data={}),i.data}function zb(i){let e=Xs(i);return e.class||(e.class={}),e.class}function TO(i){let e=Xs(i);return e.on||(e.on={}),e.on}});var un=f(kt=>{"use strict";var xh=kt&&kt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ub=kt&&kt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Yb=kt&&kt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(kt,"__esModule",{value:!0});kt.KeyListener=kt.KeyTool=void 0;var Js=_(),kb=P(),OO=G(),Ah=Be(),xu=class{constructor(e=[]){this.keyListeners=e}register(e){this.keyListeners.push(e)}deregister(e){let t=this.keyListeners.indexOf(e);t>=0&&this.keyListeners.splice(t,1)}handleEvent(e,t,n){let r=this.keyListeners.map(o=>o[e].apply(o,[t,n])).reduce((o,s)=>o.concat(s));r.length>0&&(n.preventDefault(),this.actionDispatcher.dispatchAll(r))}keyDown(e,t){this.handleEvent("keyDown",e,t)}keyUp(e,t){this.handleEvent("keyUp",e,t)}focus(){}decorate(e,t){return t instanceof OO.SModelRoot&&((0,Ah.on)(e,"focus",this.focus.bind(this,t)),(0,Ah.on)(e,"keydown",this.keyDown.bind(this,t)),(0,Ah.on)(e,"keyup",this.keyUp.bind(this,t))),e}postUpdate(){}};xh([(0,Js.inject)(kb.TYPES.IActionDispatcher),Ub("design:type",Object)],xu.prototype,"actionDispatcher",void 0);xu=xh([(0,Js.injectable)(),Yb(0,(0,Js.multiInject)(kb.TYPES.KeyListener)),Yb(0,(0,Js.optional)()),Ub("design:paramtypes",[Array])],xu);kt.KeyTool=xu;var Ch=class{keyDown(e,t){return[]}keyUp(e,t){return[]}};Ch=xh([(0,Js.injectable)()],Ch);kt.KeyListener=Ch});var On=f(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.getActualCode=co.matchesKeystroke=void 0;var AO=Tn();function CO(i,e,...t){if(Gb(i)!==e)return!1;if((0,AO.isMac)()){if(i.ctrlKey!==t.findIndex(n=>n==="ctrl")>=0||i.metaKey!==t.findIndex(n=>n==="meta"||n==="ctrlCmd")>=0)return!1}else if(i.ctrlKey!==t.findIndex(n=>n==="ctrl"||n==="ctrlCmd")>=0||i.metaKey!==t.findIndex(n=>n==="meta")>=0)return!1;return!(i.altKey!==t.findIndex(n=>n==="alt")>=0||i.shiftKey!==t.findIndex(n=>n==="shift")>=0)}co.matchesKeystroke=CO;function Gb(i){if(i.keyCode){let e=qh[i.keyCode];if(e!==void 0)return e}return i.code}co.getActualCode=Gb;var qh=new Array(256);(()=>{function i(e,t){qh[t]===void 0&&(qh[t]=e)}i("Pause",3),i("Backspace",8),i("Tab",9),i("Enter",13),i("ShiftLeft",16),i("ShiftRight",16),i("ControlLeft",17),i("ControlRight",17),i("AltLeft",18),i("AltRight",18),i("CapsLock",20),i("Escape",27),i("Space",32),i("PageUp",33),i("PageDown",34),i("End",35),i("Home",36),i("ArrowLeft",37),i("ArrowUp",38),i("ArrowRight",39),i("ArrowDown",40),i("Insert",45),i("Delete",46),i("Digit1",49),i("Digit2",50),i("Digit3",51),i("Digit4",52),i("Digit5",53),i("Digit6",54),i("Digit7",55),i("Digit8",56),i("Digit9",57),i("Digit0",48),i("KeyA",65),i("KeyB",66),i("KeyC",67),i("KeyD",68),i("KeyE",69),i("KeyF",70),i("KeyG",71),i("KeyH",72),i("KeyI",73),i("KeyJ",74),i("KeyK",75),i("KeyL",76),i("KeyM",77),i("KeyN",78),i("KeyO",79),i("KeyP",80),i("KeyQ",81),i("KeyR",82),i("KeyS",83),i("KeyT",84),i("KeyU",85),i("KeyV",86),i("KeyW",87),i("KeyX",88),i("KeyY",89),i("KeyZ",90),i("OSLeft",91),i("MetaLeft",91),i("OSRight",92),i("MetaRight",92),i("ContextMenu",93),i("Numpad0",96),i("Numpad1",97),i("Numpad2",98),i("Numpad3",99),i("Numpad4",100),i("Numpad5",101),i("Numpad6",102),i("Numpad7",103),i("Numpad8",104),i("Numpad9",105),i("NumpadMultiply",106),i("NumpadAdd",107),i("NumpadSeparator",108),i("NumpadSubtract",109),i("NumpadDecimal",110),i("NumpadDivide",111),i("F1",112),i("F2",113),i("F3",114),i("F4",115),i("F5",116),i("F6",117),i("F7",118),i("F8",119),i("F9",120),i("F10",121),i("F11",122),i("F12",123),i("F13",124),i("F14",125),i("F15",126),i("F16",127),i("F17",128),i("F18",129),i("F19",130),i("F20",131),i("F21",132),i("F22",133),i("F23",134),i("F24",135),i("NumLock",144),i("ScrollLock",145),i("Semicolon",186),i("Equal",187),i("Comma",188),i("Minus",189),i("Period",190),i("Slash",191),i("Backquote",192),i("IntlRo",193),i("BracketLeft",219),i("Backslash",220),i("BracketRight",221),i("Quote",222),i("IntlYen",255)})()});var Lh=f(Gt=>{"use strict";var Du=Gt&&Gt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},xO=Gt&&Gt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.DefaultToolsEnablingKeyListener=Gt.ToolManagerActionHandler=Gt.ToolManager=void 0;var ju=_(),qO=P(),Dh=Cu(),DO=un(),jO=On(),jh=class{constructor(){this.tools=[],this.defaultTools=[],this.actives=[]}get managedTools(){return this.defaultTools.concat(this.tools)}get activeTools(){return this.actives}disableActiveTools(){this.actives.forEach(e=>e.disable()),this.actives.splice(0,this.actives.length)}enableDefaultTools(){this.enable(this.defaultTools.map(e=>e.id))}enable(e){this.disableActiveTools(),e.map(n=>this.tool(n)).forEach(n=>{n!==void 0&&(n.enable(),this.actives.push(n))})}tool(e){return this.managedTools.find(t=>t.id===e)}registerDefaultTools(...e){for(let t of e)this.defaultTools.push(t)}registerTools(...e){for(let t of e)this.tools.push(t)}};jh=Du([(0,ju.injectable)()],jh);Gt.ToolManager=jh;var qu=class{handle(e){switch(e.kind){case Dh.EnableDefaultToolsAction.KIND:this.toolManager.enableDefaultTools();break;case Dh.EnableToolsAction.KIND:this.toolManager.enable(e.toolIds);break}}};Du([(0,ju.inject)(qO.TYPES.IToolManager),xO("design:type",Object)],qu.prototype,"toolManager",void 0);qu=Du([(0,ju.injectable)()],qu);Gt.ToolManagerActionHandler=qu;var Nh=class extends DO.KeyListener{keyDown(e,t){return(0,jO.matchesKeystroke)(t,"Escape")?[Dh.EnableDefaultToolsAction.create()]:[]}};Nh=Du([(0,ju.injectable)()],Nh);Gt.DefaultToolsEnablingKeyListener=Nh});var Qs=f(dt=>{"use strict";var Fh=dt&&dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Vh=dt&&dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Bh=dt&&dt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(dt,"__esModule",{value:!0});dt.SetUIExtensionVisibilityCommand=dt.SetUIExtensionVisibilityAction=dt.UIExtensionRegistry=void 0;var uo=_(),NO=Rn(),LO=me(),Kh=P(),Nu=class extends NO.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>this.register(t.id(),t))}};Nu=Fh([(0,uo.injectable)(),Bh(0,(0,uo.multiInject)(Kh.TYPES.IUIExtension)),Bh(0,(0,uo.optional)()),Vh("design:paramtypes",[Array])],Nu);dt.UIExtensionRegistry=Nu;var $b;(function(i){i.KIND="setUIExtensionVisibility";function e(t){var n;return{kind:i.KIND,extensionId:t.extensionId,visible:t.visible,contextElementsId:(n=t.contextElementsId)!==null&&n!==void 0?n:[]}}i.create=e})($b=dt.SetUIExtensionVisibilityAction||(dt.SetUIExtensionVisibilityAction={}));var Zs=class extends LO.SystemCommand{constructor(e){super(),this.action=e}execute(e){let t=this.registry.get(this.action.extensionId);return t&&(this.action.visible?t.show(e.root,...this.action.contextElementsId):t.hide()),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};Zs.KIND=$b.KIND;Fh([(0,uo.inject)(Kh.TYPES.UIExtensionRegistry),Vh("design:type",Nu)],Zs.prototype,"registry",void 0);Zs=Fh([(0,uo.injectable)(),Bh(0,(0,uo.inject)(Kh.TYPES.Action)),Vh("design:paramtypes",[Object])],Zs);dt.SetUIExtensionVisibilityCommand=Zs});var Lu=f(Ri=>{"use strict";var Hh=Ri&&Ri.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Wb=Ri&&Ri.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.AbstractUIExtension=void 0;var zh=_(),Xb=P(),ea=class{show(e,...t){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,e,...t),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){let e=this.activeElement;e&&e.focus()}initialize(){let e=document.getElementById(this.options.baseDiv);return e?(this.containerElement=this.getOrCreateContainer(e.id),this.initializeContents(this.containerElement),e&&e.insertBefore(this.containerElement,e.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(e){let t=document.getElementById(this.id());return t===null&&(t=document.createElement("div"),t.id=e+"_"+this.id(),t.classList.add(this.containerClass())),t}setContainerVisible(e){this.containerElement&&(e?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(e,t,...n){}};Hh([(0,zh.inject)(Xb.TYPES.ViewerOptions),Wb("design:type",Object)],ea.prototype,"options",void 0);Hh([(0,zh.inject)(Xb.TYPES.ILogger),Wb("design:type",Object)],ea.prototype,"logger",void 0);ea=Hh([(0,zh.injectable)()],ea);Ri.AbstractUIExtension=ea});var lo=f(Mi=>{"use strict";var Jb=Mi&&Mi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},BO=Mi&&Mi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.DOMHelper=void 0;var Zb=_(),FO=P(),Bu=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(e){return this.getPrefix()+e.id}findSModelIdByDOMElement(e){return e.id.replace(this.getPrefix(),"")}};Jb([(0,Zb.inject)(FO.TYPES.ViewerOptions),BO("design:type",Object)],Bu.prototype,"viewerOptions",void 0);Bu=Jb([(0,Zb.injectable)()],Bu);Mi.DOMHelper=Bu});var At=f(et=>{"use strict";var ho=et&&et.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ku=et&&et.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Fu=et&&et.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(et,"__esModule",{value:!0});et.MousePositionTracker=et.MouseListener=et.PopupMouseTool=et.MouseTool=void 0;var An=_(),VO=ie(),KO=G(),Hu=P(),HO=lo(),$t=Be(),fo=class{constructor(e=[]){this.mouseListeners=e}register(e){this.mouseListeners.push(e)}deregister(e){let t=this.mouseListeners.indexOf(e);t>=0&&this.mouseListeners.splice(t,1)}getTargetElement(e,t){let n=t.target,r=e.index;for(;n;){if(n.id){let o=r.getById(this.domHelper.findSModelIdByDOMElement(n));if(o!==void 0)return o}n=n.parentNode}}handleEvent(e,t,n){this.focusOnMouseEvent(e,t);let r=this.getTargetElement(t,n);if(!r)return;let o=this.mouseListeners.map(s=>s[e](r,n)).reduce((s,a)=>s.concat(a));if(o.length>0){n.preventDefault();for(let s of o)(0,VO.isAction)(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}focusOnMouseEvent(e,t){if(document&&e==="mouseDown"){let n=document.getElementById(this.domHelper.createUniqueDOMElementId(t));n!==null&&typeof n.focus=="function"&&n.focus()}}mouseOver(e,t){this.handleEvent("mouseOver",e,t)}mouseOut(e,t){this.handleEvent("mouseOut",e,t)}mouseEnter(e,t){this.handleEvent("mouseEnter",e,t)}mouseLeave(e,t){this.handleEvent("mouseLeave",e,t)}mouseDown(e,t){this.handleEvent("mouseDown",e,t)}mouseMove(e,t){this.handleEvent("mouseMove",e,t)}mouseUp(e,t){this.handleEvent("mouseUp",e,t)}wheel(e,t){this.handleEvent("wheel",e,t)}contextMenu(e,t){t.preventDefault(),this.handleEvent("contextMenu",e,t)}doubleClick(e,t){this.handleEvent("doubleClick",e,t)}decorate(e,t){return t instanceof KO.SModelRoot&&((0,$t.on)(e,"mouseover",this.mouseOver.bind(this,t)),(0,$t.on)(e,"mouseout",this.mouseOut.bind(this,t)),(0,$t.on)(e,"mouseenter",this.mouseEnter.bind(this,t)),(0,$t.on)(e,"mouseleave",this.mouseLeave.bind(this,t)),(0,$t.on)(e,"mousedown",this.mouseDown.bind(this,t)),(0,$t.on)(e,"mouseup",this.mouseUp.bind(this,t)),(0,$t.on)(e,"mousemove",this.mouseMove.bind(this,t)),(0,$t.on)(e,"wheel",this.wheel.bind(this,t)),(0,$t.on)(e,"contextmenu",this.contextMenu.bind(this,t)),(0,$t.on)(e,"dblclick",this.doubleClick.bind(this,t)),(0,$t.on)(e,"dragover",n=>this.handleEvent("dragOver",t,n)),(0,$t.on)(e,"drop",n=>this.handleEvent("drop",t,n))),e=this.mouseListeners.reduce((n,r)=>r.decorate(n,t),e),e}postUpdate(){}};ho([(0,An.inject)(Hu.TYPES.IActionDispatcher),Ku("design:type",Object)],fo.prototype,"actionDispatcher",void 0);ho([(0,An.inject)(Hu.TYPES.DOMHelper),Ku("design:type",HO.DOMHelper)],fo.prototype,"domHelper",void 0);fo=ho([(0,An.injectable)(),Fu(0,(0,An.multiInject)(Hu.TYPES.MouseListener)),Fu(0,(0,An.optional)()),Ku("design:paramtypes",[Array])],fo);et.MouseTool=fo;var Yh=class extends fo{constructor(e=[]){super(e),this.mouseListeners=e}};Yh=ho([(0,An.injectable)(),Fu(0,(0,An.multiInject)(Hu.TYPES.PopupMouseListener)),Fu(0,(0,An.optional)()),Ku("design:paramtypes",[Array])],Yh);et.PopupMouseTool=Yh;var Vu=class{mouseOver(e,t){return[]}mouseOut(e,t){return[]}mouseEnter(e,t){return[]}mouseLeave(e,t){return[]}mouseDown(e,t){return[]}mouseMove(e,t){return[]}mouseUp(e,t){return[]}wheel(e,t){return[]}doubleClick(e,t){return[]}contextMenu(e,t){return[]}dragOver(e,t){return[]}drop(e,t){return[]}decorate(e,t){return e}};Vu=ho([(0,An.injectable)()],Vu);et.MouseListener=Vu;var Uh=class extends Vu{mouseMove(e,t){return this.lastPosition=e.root.parentToLocal({x:t.offsetX,y:t.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};Uh=ho([(0,An.injectable)()],Uh);et.MousePositionTracker=Uh});var po=f(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});function zO(i,e){return document.createElement(i,e)}function YO(i,e,t){return document.createElementNS(i,e,t)}function UO(){return gr(document.createDocumentFragment())}function kO(i){return document.createTextNode(i)}function GO(i){return document.createComment(i)}function $O(i,e,t){if(ei(i)){let n=i;for(;n&&ei(n);)n=gr(n).parent;i=n??i}ei(e)&&(e=gr(e,i)),t&&ei(t)&&(t=gr(t).firstChildNode),i.insertBefore(e,t)}function WO(i,e){i.removeChild(e)}function XO(i,e){ei(e)&&(e=gr(e,i)),i.appendChild(e)}function aS(i){if(ei(i)){for(;i&&ei(i);)i=gr(i).parent;return i??null}return i.parentNode}function JO(i){var e;if(ei(i)){let t=gr(i),n=aS(t);if(n&&t.lastChildNode){let r=Array.from(n.childNodes),o=r.indexOf(t.lastChildNode);return(e=r[o+1])!==null&&e!==void 0?e:null}return null}return i.nextSibling}function ZO(i){return i.tagName}function QO(i,e){i.textContent=e}function eA(i){return i.textContent}function tA(i){return i.nodeType===1}function nA(i){return i.nodeType===3}function iA(i){return i.nodeType===8}function ei(i){return i.nodeType===11}function gr(i,e){var t,n,r;let o=i;return(t=o.parent)!==null&&t!==void 0||(o.parent=e??null),(n=o.firstChildNode)!==null&&n!==void 0||(o.firstChildNode=i.firstChild),(r=o.lastChildNode)!==null&&r!==void 0||(o.lastChildNode=i.lastChild),o}var Jh={createElement:zO,createElementNS:YO,createTextNode:kO,createDocumentFragment:UO,createComment:GO,insertBefore:$O,removeChild:WO,appendChild:XO,parentNode:aS,nextSibling:JO,tagName:ZO,setTextContent:QO,getTextContent:eA,isElement:tA,isText:nA,isComment:iA,isDocumentFragment:ei};function lt(i,e,t,n,r){let o=e===void 0?void 0:e.key;return{sel:i,data:e,children:t,text:n,elm:r,key:o}}var na=Array.isArray;function mr(i){return typeof i=="string"||typeof i=="number"||i instanceof String||i instanceof Number}function kh(i){return i===void 0}function St(i){return i!==void 0}var Gh=lt("",{},[],void 0,void 0);function ta(i,e){var t,n;let r=i.key===e.key,o=((t=i.data)===null||t===void 0?void 0:t.is)===((n=e.data)===null||n===void 0?void 0:n.is),s=i.sel===e.sel,a=!i.sel&&i.sel===e.sel?typeof i.text==typeof e.text:!0;return s&&r&&o&&a}function rA(){throw new Error("The document fragment is not supported on this platform.")}function oA(i,e){return i.isElement(e)}function sA(i,e){return i.isDocumentFragment(e)}function aA(i,e,t){var n;let r={};for(let o=e;o<=t;++o){let s=(n=i[o])===null||n===void 0?void 0:n.key;s!==void 0&&(r[s]=o)}return r}var cA=["create","update","remove","destroy","pre","post"];function uA(i,e,t){let n={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:Jh;for(let v of cA)for(let m of i){let T=m[v];T!==void 0&&n[v].push(T)}function o(v){let m=v.id?"#"+v.id:"",T=v.getAttribute("class"),C=T?"."+T.split(" ").join("."):"";return lt(r.tagName(v).toLowerCase()+m+C,{},[],void 0,v)}function s(v){return lt(void 0,{},[],void 0,v)}function a(v,m){return function(){if(--m===0){let C=r.parentNode(v);r.removeChild(C,v)}}}function c(v,m){var T,C,K,k;let D,F=v.data;if(F!==void 0){let z=(T=F.hook)===null||T===void 0?void 0:T.init;St(z)&&(z(v),F=v.data)}let H=v.children,$=v.sel;if($==="!")kh(v.text)&&(v.text=""),v.elm=r.createComment(v.text);else if($!==void 0){let z=$.indexOf("#"),ae=$.indexOf(".",z),Ie=z>0?z:$.length,he=ae>0?ae:$.length,be=z!==-1||ae!==-1?$.slice(0,Math.min(Ie,he)):$,$e=v.elm=St(F)&&St(D=F.ns)?r.createElementNS(D,be,F):r.createElement(be,F);for(Ie<he&&$e.setAttribute("id",$.slice(Ie+1,he)),ae>0&&$e.setAttribute("class",$.slice(he+1).replace(/\./g," ")),D=0;D<n.create.length;++D)n.create[D](Gh,v);if(na(H))for(D=0;D<H.length;++D){let li=H[D];li!=null&&r.appendChild($e,c(li,m))}else mr(v.text)&&r.appendChild($e,r.createTextNode(v.text));let vn=v.data.hook;St(vn)&&((C=vn.create)===null||C===void 0||C.call(vn,Gh,v),vn.insert&&m.push(v))}else if(!((K=t?.experimental)===null||K===void 0)&&K.fragments&&v.children){for(v.elm=((k=r.createDocumentFragment)!==null&&k!==void 0?k:rA)(),D=0;D<n.create.length;++D)n.create[D](Gh,v);for(D=0;D<v.children.length;++D){let z=v.children[D];z!=null&&r.appendChild(v.elm,c(z,m))}}else v.elm=r.createTextNode(v.text);return v.elm}function u(v,m,T,C,K,k){for(;C<=K;++C){let D=T[C];D!=null&&r.insertBefore(v,c(D,k),m)}}function d(v){var m,T;let C=v.data;if(C!==void 0){(T=(m=C?.hook)===null||m===void 0?void 0:m.destroy)===null||T===void 0||T.call(m,v);for(let K=0;K<n.destroy.length;++K)n.destroy[K](v);if(v.children!==void 0)for(let K=0;K<v.children.length;++K){let k=v.children[K];k!=null&&typeof k!="string"&&d(k)}}}function l(v,m,T,C){for(var K,k;T<=C;++T){let D,F,H=m[T];if(H!=null)if(St(H.sel)){d(H),D=n.remove.length+1,F=a(H.elm,D);for(let z=0;z<n.remove.length;++z)n.remove[z](H,F);let $=(k=(K=H?.data)===null||K===void 0?void 0:K.hook)===null||k===void 0?void 0:k.remove;St($)?$(H,F):F()}else H.children?(d(H),l(v,H.children,0,H.children.length-1)):r.removeChild(v,H.elm)}}function S(v,m,T,C){let K=0,k=0,D=m.length-1,F=m[0],H=m[D],$=T.length-1,z=T[0],ae=T[$],Ie,he,be,$e;for(;K<=D&&k<=$;)F==null?F=m[++K]:H==null?H=m[--D]:z==null?z=T[++k]:ae==null?ae=T[--$]:ta(F,z)?(R(F,z,C),F=m[++K],z=T[++k]):ta(H,ae)?(R(H,ae,C),H=m[--D],ae=T[--$]):ta(F,ae)?(R(F,ae,C),r.insertBefore(v,F.elm,r.nextSibling(H.elm)),F=m[++K],ae=T[--$]):ta(H,z)?(R(H,z,C),r.insertBefore(v,H.elm,F.elm),H=m[--D],z=T[++k]):(Ie===void 0&&(Ie=aA(m,K,D)),he=Ie[z.key],kh(he)?r.insertBefore(v,c(z,C),F.elm):(be=m[he],be.sel!==z.sel?r.insertBefore(v,c(z,C),F.elm):(R(be,z,C),m[he]=void 0,r.insertBefore(v,be.elm,F.elm))),z=T[++k]);k<=$&&($e=T[$+1]==null?null:T[$+1].elm,u(v,$e,T,k,$,C)),K<=D&&l(v,m,K,D)}function R(v,m,T){var C,K,k,D,F,H,$,z;let ae=(C=m.data)===null||C===void 0?void 0:C.hook;(K=ae?.prepatch)===null||K===void 0||K.call(ae,v,m);let Ie=m.elm=v.elm;if(v===m)return;if(m.data!==void 0||St(m.text)&&m.text!==v.text){(k=m.data)!==null&&k!==void 0||(m.data={}),(D=v.data)!==null&&D!==void 0||(v.data={});for(let $e=0;$e<n.update.length;++$e)n.update[$e](v,m);($=(H=(F=m.data)===null||F===void 0?void 0:F.hook)===null||H===void 0?void 0:H.update)===null||$===void 0||$.call(H,v,m)}let he=v.children,be=m.children;kh(m.text)?St(he)&&St(be)?he!==be&&S(Ie,he,be,T):St(be)?(St(v.text)&&r.setTextContent(Ie,""),u(Ie,null,be,0,be.length-1,T)):St(he)?l(Ie,he,0,he.length-1):St(v.text)&&r.setTextContent(Ie,""):v.text!==m.text&&(St(he)&&l(Ie,he,0,he.length-1),r.setTextContent(Ie,m.text)),(z=ae?.postpatch)===null||z===void 0||z.call(ae,v,m)}return function(m,T){let C,K,k,D=[];for(C=0;C<n.pre.length;++C)n.pre[C]();for(oA(r,m)?m=o(m):sA(r,m)&&(m=s(m)),ta(m,T)?R(m,T,D):(K=m.elm,k=r.parentNode(K),c(T,D),k!==null&&(r.insertBefore(k,T.elm,r.nextSibling(K)),l(k,[m],0,0))),C=0;C<D.length;++C)D[C].data.hook.insert(D[C]);for(C=0;C<n.post.length;++C)n.post[C]();return T}}function Uu(i,e,t){if(i.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let n=0;n<e.length;++n){let r=e[n];if(typeof r=="string")continue;let o=r.data;o!==void 0&&Uu(o,r.children,r.sel)}}function Yu(i,e,t){let n={},r,o,s;if(t!==void 0?(e!==null&&(n=e),na(t)?r=t:mr(t)?o=t.toString():t&&t.sel&&(r=[t])):e!=null&&(na(e)?r=e:mr(e)?o=e.toString():e&&e.sel?r=[e]:n=e),r!==void 0)for(s=0;s<r.length;++s)mr(r[s])&&(r[s]=lt(void 0,void 0,void 0,r[s],void 0));return i[0]==="s"&&i[1]==="v"&&i[2]==="g"&&(i.length===3||i[3]==="."||i[3]==="#")&&Uu(n,r,i),lt(i,n,r,o,void 0)}function dA(i){let e,t;if(na(i)?e=i:mr(e)?t=i:e&&e.sel&&(e=[i]),e!==void 0)for(let n=0;n<e.length;++n)mr(e[n])&&(e[n]=lt(void 0,void 0,void 0,e[n],void 0));return lt(void 0,{},e,t,void 0)}function zu(i,e){var t;let n=(t=e.data)===null||t===void 0?void 0:t.ns;i.data.fn=e.data.fn,i.data.args=e.data.args,e.data=i.data,e.children=i.children,e.text=i.text,e.elm=i.elm,n&&Uu(e.data,e.children,e.sel)}function lA(i){let e=i.data,t=e.fn(...e.args);zu(t,i)}function fA(i,e){let t,n=i.data,r=e.data,o=n.args,s=r.args;if(n.fn!==r.fn||o.length!==s.length){zu(r.fn(...s),e);return}for(t=0;t<s.length;++t)if(o[t]!==s[t]){zu(r.fn(...s),e);return}zu(i,e)}var hA=function(e,t,n,r){return r===void 0&&(r=n,n=t,t=void 0),Yu(e,{key:t,hook:{init:lA,prepatch:fA},fn:n,args:r})};function pA(i,e){let t=i.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,i.elm=i.data.attachData.real}function gA(i,e){e.elm=e.data.attachData.placeholder}function mA(i){i.elm!==void 0&&i.elm.parentNode.removeChild(i.elm),i.elm=i.data.attachData.real}function yA(i,e){let t=e.elm,n=e.data.attachData,r=document.createElement("span");e.elm=r,n.target.appendChild(t),n.real=t,n.placeholder=r}function _A(i,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});let t=e.data,n=e.data.hook;return t.attachData={target:i,placeholder:void 0,real:void 0},n.create=yA,n.prepatch=pA,n.postpatch=gA,n.destroy=mA,e}function cS(i,e){let t=e!==void 0?e:Jh,n;if(t.isElement(i)){let r=i.id?"#"+i.id:"",o=i.getAttribute("class"),s=o?"."+o.split(" ").join("."):"",a=t.tagName(i).toLowerCase()+r+s,c={},u={},d={},l=[],S,R,v,m=i.attributes,T=i.childNodes;for(R=0,v=m.length;R<v;R++)S=m[R].nodeName,S[0]==="d"&&S[1]==="a"&&S[2]==="t"&&S[3]==="a"&&S[4]==="-"?u[S.slice(5)]=m[R].nodeValue||"":S!=="id"&&S!=="class"&&(c[S]=m[R].nodeValue);for(R=0,v=T.length;R<v;R++)l.push(cS(T[R],e));return Object.keys(c).length>0&&(d.attrs=c),Object.keys(u).length>0&&(d.dataset=u),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&Uu(d,l,a),lt(a,d,l,void 0,i)}else return t.isText(i)?(n=t.getTextContent(i),lt(void 0,void 0,void 0,n,i)):t.isComment(i)?(n=t.getTextContent(i),lt("!",{},[],n,i)):lt("",{},[],void 0,i)}var vA="http://www.w3.org/1999/xlink",bA="http://www.w3.org/XML/1998/namespace",Qb=58,SA=120;function eS(i,e){let t,n=e.elm,r=i.data.attrs,o=e.data.attrs;if(!(!r&&!o)&&r!==o){r=r||{},o=o||{};for(t in o){let s=o[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==SA?n.setAttribute(t,s):t.charCodeAt(3)===Qb?n.setAttributeNS(bA,t,s):t.charCodeAt(5)===Qb?n.setAttributeNS(vA,t,s):n.setAttribute(t,s))}for(t in r)t in o||n.removeAttribute(t)}}var EA={create:eS,update:eS};function tS(i,e){let t,n,r=e.elm,o=i.data.class,s=e.data.class;if(!(!o&&!s)&&o!==s){o=o||{},s=s||{};for(n in o)o[n]&&!Object.prototype.hasOwnProperty.call(s,n)&&r.classList.remove(n);for(n in s)t=s[n],t!==o[n]&&r.classList[t?"add":"remove"](n)}}var wA={create:tS,update:tS},nS=/[A-Z]/g;function iS(i,e){let t=e.elm,n=i.data.dataset,r=e.data.dataset,o;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(o in n)r[o]||(s?o in s&&delete s[o]:t.removeAttribute("data-"+o.replace(nS,"-$&").toLowerCase()));for(o in r)n[o]!==r[o]&&(s?s[o]=r[o]:t.setAttribute("data-"+o.replace(nS,"-$&").toLowerCase(),r[o]))}var PA={create:iS,update:iS};function uS(i,e,t){if(typeof i=="function")i.call(e,t,e);else if(typeof i=="object")for(let n=0;n<i.length;n++)uS(i[n],e,t)}function IA(i,e){let t=i.type,n=e.data.on;n&&n[t]&&uS(n[t],e,i)}function RA(){return function i(e){IA(e,i.vnode)}}function $h(i,e){let t=i.data.on,n=i.listener,r=i.elm,o=e&&e.data.on,s=e&&e.elm,a;if(t!==o){if(t&&n)if(o)for(a in t)o[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(o){let c=e.listener=i.listener||RA();if(c.vnode=e,t)for(a in o)t[a]||s.addEventListener(a,c,!1);else for(a in o)s.addEventListener(a,c,!1)}}}var MA={create:$h,update:$h,destroy:$h};function rS(i,e){let t,n,r,o=e.elm,s=i.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||o[t]!==n)&&(o[t]=n)}}var TA={create:rS,update:rS},oS=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,OA=function(i){oS(function(){oS(i)})},Wh=!1;function AA(i,e,t){OA(function(){i[e]=t})}function sS(i,e){let t,n,r=e.elm,o=i.data.style,s=e.data.style;if(!o&&!s||o===s)return;o=o||{},s=s||{};let a="delayed"in o;for(n in o)s[n]||(n[0]==="-"&&n[1]==="-"?r.style.removeProperty(n):r.style[n]="");for(n in s)if(t=s[n],n==="delayed"&&s.delayed)for(let c in s.delayed)t=s.delayed[c],(!a||t!==o.delayed[c])&&AA(r.style,c,t);else n!=="remove"&&t!==o[n]&&(n[0]==="-"&&n[1]==="-"?r.style.setProperty(n,t):r.style[n]=t)}function CA(i){let e,t,n=i.elm,r=i.data.style;if(!(!r||!(e=r.destroy)))for(t in e)n.style[t]=e[t]}function xA(i,e){let t=i.data.style;if(!t||!t.remove){e();return}Wh||(i.elm.offsetLeft,Wh=!0);let n,r=i.elm,o=0,s=t.remove,a=0,c=[];for(n in s)c.push(n),r.style[n]=s[n];let d=getComputedStyle(r)["transition-property"].split(", ");for(;o<d.length;++o)c.indexOf(d[o])!==-1&&a++;r.addEventListener("transitionend",function(l){l.target===r&&--a,a===0&&e()})}function qA(){Wh=!1}var DA={pre:qA,create:sS,update:sS,destroy:CA,remove:xA};function jA(i,...e){let t=Zh(e,[]);return t.length===1&&!t[0].sel&&t[0].text?lt(void 0,void 0,void 0,t[0].text,void 0):lt(void 0,i??{},t,void 0,void 0)}function Zh(i,e){for(let t of i)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?Zh(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(lt(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function Xh(i,e,...t){let n=Zh(t,[]);return typeof i=="function"?i(e,n):n.length===1&&!n[0].sel&&n[0].text?Yu(i,e,n[0].text):Yu(i,e,n)}(function(i){})(Xh||(Xh={}));Re.Fragment=jA;Re.array=na;Re.attachTo=_A;Re.attributesModule=EA;Re.classModule=wA;Re.datasetModule=PA;Re.eventListenersModule=MA;Re.fragment=dA;Re.h=Yu;Re.htmlDomApi=Jh;Re.init=uA;Re.jsx=Xh;Re.primitive=mr;Re.propsModule=TA;Re.styleModule=DA;Re.thunk=hA;Re.toVNode=cS;Re.vnode=lt});var ep=f(Ti=>{"use strict";var NA=Ti&&Ti.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.isThunk=Ti.ThunkView=void 0;var LA=po(),BA=_(),Qh=class{render(e,t){return(0,LA.h)(this.selector(e),{key:e.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(e,t),args:this.watchedArgs(e),thunk:!0})}renderAndDecorate(e,t){let n=this.doRender(e,t);return t.decorate(n,e),n}copyToThunk(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}init(e){let t=e.data,n=t.fn.apply(void 0,t.args);this.copyToThunk(n,e)}prepatch(e,t){let n=e.data,r=t.data;this.equals(n.args,r.args)?this.copyToThunk(e,t):this.copyToThunk(r.fn.apply(void 0,r.args),t)}equals(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<t.length;++n)if(!this.equals(e[n],t[n]))return!1}else if(typeof e=="object"&&typeof t=="object"){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(n!=="parent"&&n!=="root"&&(!(n in t)||!this.equals(e[n],t[n])))return!1}else if(e!==t)return!1;return!0}};Qh=NA([(0,BA.injectable)()],Qh);Ti.ThunkView=Qh;function FA(i){return"thunk"in i}Ti.isThunk=FA});var Wt=f(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.JSX=Oi.svg=Oi.html=void 0;var VA=po(),KA=["hook","on","style","class","props","attrs","dataset"],HA="http://www.w3.org/2000/svg";function zA(i,e,t){let n={};if(t&&(n.ns=t),i===null)return n;return KA.forEach(o=>{i[o]&&(n[o]=i[o])}),Object.keys(i).forEach(o=>{if(o==="key"||o==="classNames"||o==="selector")return;let s=o.indexOf("-");s>0?r(o.slice(0,s),o.slice(s+1),i[o]):n[o]||r(e,o,i[o])}),n;function r(o,s,a){let c=n[o]||(n[o]={});c[s]=a}}function tp(i,e="props"){return(t,n,...r)=>(0,VA.jsx)(t,zA(n,e,i),r)}Oi.JSX=tp;var YA=tp();Oi.html=YA;var UA=tp(HA,"attrs");Oi.svg=UA});var go=f(Me=>{"use strict";var ip=Me&&Me.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},kA=Me&&Me.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},dS=Me&&Me.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Me,"__esModule",{value:!0});Me.MissingView=Me.EmptyView=Me.configureView=Me.configureModelElement=Me.ViewRegistry=Me.findArgValue=void 0;var lS=Wt(),ia=_(),fS=P(),GA=Rn(),$A=cr(),WA=Mn(),XA=ze(),JA=hr();function ZA(i,e){for(;i!==void 0&&!(e in i)&&i.parentArgs;)i=i.parentArgs;return i?i[e]:void 0}Me.findArgValue=ZA;var np=class extends GA.InstanceRegistry{constructor(e){super(),this.registerDefaults(),e.forEach(t=>this.register(t.type,t.factory()))}registerDefaults(){this.register(WA.EMPTY_ROOT.type,new ku)}missing(e){return new Gu}};np=ip([(0,ia.injectable)(),dS(0,(0,ia.multiInject)(fS.TYPES.ViewRegistration)),dS(0,(0,ia.optional)()),kA("design:paramtypes",[Array])],np);Me.ViewRegistry=np;function QA(i,e,t,n,r){(0,XA.registerModelElement)(i,e,t,r),hS(i,e,n)}Me.configureModelElement=QA;function hS(i,e,t){if(typeof t=="function"){if(!(0,$A.isInjectable)(t))throw new Error(`Views should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(fS.TYPES.ViewRegistration).toDynamicValue(n=>({type:e,factory:()=>n.container.get(t)}))}Me.configureView=hS;var ku=class{render(e,t){return(0,lS.svg)("svg",{"class-sprotty-empty":!0})}};ku=ip([(0,ia.injectable)()],ku);Me.EmptyView=ku;var Gu=class{render(e,t){let n=e.position||JA.Point.ORIGIN;return(0,lS.svg)("text",{"class-sprotty-missing":!0,x:n.x,y:n.y},"?",e.id,"?")}};Gu=ip([(0,ia.injectable)()],Gu);Me.MissingView=Gu});var sp=f(Ai=>{"use strict";var rp=Ai&&Ai.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},pS=Ai&&Ai.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ai,"__esModule",{value:!0});Ai.ViewerCache=void 0;var op=_(),gS=P(),eC=Qr(),ra=class{update(e,t){if(t!==void 0)this.delegate.update(e,t),this.cachedModel=void 0;else{let n=this.cachedModel===void 0;this.cachedModel=e,n&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};rp([(0,op.inject)(gS.TYPES.IViewer),pS("design:type",Object)],ra.prototype,"delegate",void 0);rp([(0,op.inject)(gS.TYPES.AnimationFrameSyncer),pS("design:type",eC.AnimationFrameSyncer)],ra.prototype,"syncer",void 0);ra=rp([(0,op.injectable)()],ra);Ai.ViewerCache=ra});var ap=f(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.overrideViewerOptions=ti.configureViewerOptions=ti.defaultViewerOptions=void 0;var tC=Sn(),$u=P(),nC=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300});ti.defaultViewerOptions=nC;function iC(i,e){let t=Object.assign(Object.assign({},(0,ti.defaultViewerOptions)()),e);i.isBound($u.TYPES.ViewerOptions)?i.rebind($u.TYPES.ViewerOptions).toConstantValue(t):i.bind($u.TYPES.ViewerOptions).toConstantValue(t)}ti.configureViewerOptions=iC;function rC(i,e){let t=i.get($u.TYPES.ViewerOptions);return(0,tC.safeAssign)(t,e),t}ti.overrideViewerOptions=rC});var cp=f(Fe=>{"use strict";var dn=Fe&&Fe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ln=Fe&&Fe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Xt=Fe&&Fe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.PopupModelViewer=Fe.HiddenModelViewer=Fe.ModelViewer=Fe.PatcherProvider=Fe.ModelRenderer=void 0;var ye=_(),mo=po(),oa=Wt(),oC=Tn(),sC=$s(),mS=Mn(),tt=P(),aC=ep(),Ct=Be(),sa=class{constructor(e,t,n,r={}){this.viewRegistry=e,this.targetKind=t,this.postprocessors=n,this.args=r}decorate(e,t){return(0,aC.isThunk)(e)?e:this.postprocessors.reduce((n,r)=>r.decorate(n,t),e)}renderElement(e){let n=this.viewRegistry.get(e.type).render(e,this,this.args);if(n)return this.decorate(n,e)}renderChildren(e,t){let n=t?new sa(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map(r=>n.renderElement(r)).filter(r=>r!==void 0)}postUpdate(e){this.postprocessors.forEach(t=>t.postUpdate(e))}};Fe.ModelRenderer=sa;var yo=class{constructor(){this.patcher=(0,mo.init)(this.createModules())}createModules(){return[mo.propsModule,mo.attributesModule,mo.classModule,mo.styleModule,mo.eventListenersModule]}};yo=dn([(0,ye.injectable)(),ln("design:paramtypes",[])],yo);Fe.PatcherProvider=yo;var _o=class{constructor(e,t,n){this.renderer=e("main",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering",e);let n=(0,oa.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(e));if(this.lastVDOM!==void 0){let r=this.hasFocus();(0,Ct.copyClassesFromVNode)(this.lastVDOM,n),this.lastVDOM=this.patcher.call(this,this.lastVDOM,n),this.restoreFocus(r)}else if(typeof document<"u"){let r=document.getElementById(this.options.baseDiv);r!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(n)}),(0,Ct.copyClassesFromElement)(r,n),(0,Ct.setClass)(n,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,r,n)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(t)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let e=this.lastVDOM.children[0];if(typeof e=="object"){let t=e.elm;return document.activeElement===t}}return!1}restoreFocus(e){if(e&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let t=this.lastVDOM.children[0];if(typeof t=="object"){let n=t.elm;n&&typeof n.focus=="function"&&n.focus()}}}onWindowResize(e){let t=document.getElementById(this.options.baseDiv);if(t!==null){let n=this.getBoundsInPage(t);this.actiondispatcher.dispatch(sC.InitializeCanvasBoundsAction.create(n))}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,oC.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};dn([(0,ye.inject)(tt.TYPES.ViewerOptions),ln("design:type",Object)],_o.prototype,"options",void 0);dn([(0,ye.inject)(tt.TYPES.ILogger),ln("design:type",Object)],_o.prototype,"logger",void 0);dn([(0,ye.inject)(tt.TYPES.IActionDispatcher),ln("design:type",Object)],_o.prototype,"actiondispatcher",void 0);_o=dn([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.IVNodePostprocessor)),Xt(2,(0,ye.optional)()),ln("design:paramtypes",[Function,yo,Array])],_o);Fe.ModelViewer=_o;var aa=class{constructor(e,t,n){this.hiddenRenderer=e("hidden",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering hidden");let n;if(e.type===mS.EMPTY_ROOT.type)n=(0,oa.html)("div",{id:this.options.hiddenDiv});else{let r=this.hiddenRenderer.renderElement(e);r&&(0,Ct.setAttr)(r,"opacity",0),n=(0,oa.html)("div",{id:this.options.hiddenDiv},r)}if(this.lastHiddenVDOM!==void 0)(0,Ct.copyClassesFromVNode)(this.lastHiddenVDOM,n),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,n);else{let r=document.getElementById(this.options.hiddenDiv);r===null?(r=document.createElement("div"),document.body.appendChild(r)):(0,Ct.copyClassesFromElement)(r,n),(0,Ct.setClass)(n,this.options.baseClass,!0),(0,Ct.setClass)(n,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,r,n)}this.hiddenRenderer.postUpdate(t)}};dn([(0,ye.inject)(tt.TYPES.ViewerOptions),ln("design:type",Object)],aa.prototype,"options",void 0);dn([(0,ye.inject)(tt.TYPES.ILogger),ln("design:type",Object)],aa.prototype,"logger",void 0);aa=dn([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.HiddenVNodePostprocessor)),Xt(2,(0,ye.optional)()),ln("design:paramtypes",[Function,yo,Array])],aa);Fe.HiddenModelViewer=aa;var ca=class{constructor(e,t,n){this.modelRendererFactory=e,this.popupRenderer=this.modelRendererFactory("popup",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering popup",e);let n=e.type===mS.EMPTY_ROOT.type,r;if(n)r=(0,oa.html)("div",{id:this.options.popupDiv});else{let o=e.canvasBounds,s={top:o.y+"px",left:o.x+"px"};r=(0,oa.html)("div",{id:this.options.popupDiv,style:s},this.popupRenderer.renderElement(e))}if(this.lastPopupVDOM!==void 0)(0,Ct.copyClassesFromVNode)(this.lastPopupVDOM,r),(0,Ct.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,r);else if(typeof document<"u"){let o=document.getElementById(this.options.popupDiv);o===null?(o=document.createElement("div"),document.body.appendChild(o)):(0,Ct.copyClassesFromElement)(o,r),(0,Ct.setClass)(r,this.options.popupClass,!0),(0,Ct.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,o,r)}this.popupRenderer.postUpdate(t)}};dn([(0,ye.inject)(tt.TYPES.ViewerOptions),ln("design:type",Object)],ca.prototype,"options",void 0);dn([(0,ye.inject)(tt.TYPES.ILogger),ln("design:type",Object)],ca.prototype,"logger",void 0);ca=dn([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.PopupVNodePostprocessor)),Xt(2,(0,ye.optional)()),ln("design:paramtypes",[Function,yo,Array])],ca);Fe.PopupModelViewer=ca});var dp=f(vo=>{"use strict";var cC=vo&&vo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(vo,"__esModule",{value:!0});vo.FocusFixPostprocessor=void 0;var uC=_(),dC=Be(),up=class{decorate(e,t){return e.sel&&e.sel.startsWith("svg")&&(0,dC.setAttr)(e,"tabindex",0),e}postUpdate(){}};up=cC([(0,uC.injectable)()],up);vo.FocusFixPostprocessor=up});var Ju=f(xt=>{"use strict";var Wu=xt&&xt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yS=xt&&xt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xt,"__esModule",{value:!0});xt.ConsoleLogger=xt.NullLogger=xt.LogLevel=void 0;var Xu=_(),_S=P(),yr;(function(i){i[i.none=0]="none",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i[i.log=4]="log"})(yr=xt.LogLevel||(xt.LogLevel={}));var lp=class{constructor(){this.logLevel=yr.none}error(e,t,...n){}warn(e,t,...n){}info(e,t,...n){}log(e,t,...n){}};lp=Wu([(0,Xu.injectable)()],lp);xt.NullLogger=lp;var ua=class{constructor(){this.logLevel=yr.log,this.viewOptions={baseDiv:""}}error(e,t,...n){if(this.logLevel>=yr.error)try{console.error.apply(e,this.consoleArguments(e,t,n))}catch{}}warn(e,t,...n){if(this.logLevel>=yr.warn)try{console.warn.apply(e,this.consoleArguments(e,t,n))}catch{}}info(e,t,...n){if(this.logLevel>=yr.info)try{console.info.apply(e,this.consoleArguments(e,t,n))}catch{}}log(e,t,...n){if(this.logLevel>=yr.log)try{console.log.apply(e,this.consoleArguments(e,t,n))}catch{}}consoleArguments(e,t,n){let r;return typeof e=="object"?r=e.constructor.name:r=e,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+r+": "+t,...n]}};Wu([(0,Xu.inject)(_S.TYPES.LogLevel),yS("design:type",Number)],ua.prototype,"logLevel",void 0);Wu([(0,Xu.inject)(_S.TYPES.ViewerOptions),yS("design:type",Object)],ua.prototype,"viewOptions",void 0);ua=Wu([(0,Xu.injectable)()],ua);xt.ConsoleLogger=ua});var SS=f(Ci=>{"use strict";var fp=Ci&&Ci.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vS=Ci&&Ci.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.IdPostprocessor=void 0;var hp=_(),bS=P(),lC=lo(),fC=Be(),da=class{decorate(e,t){let n=(0,fC.getAttrs)(e);return n.id!==void 0&&this.logger.warn(e,"Overriding id of vnode ("+n.id+"). Make sure not to set it manually in view."),n.id=this.domHelper.createUniqueDOMElementId(t),e.key||(e.key=t.id),e}postUpdate(){}};fp([(0,hp.inject)(bS.TYPES.ILogger),vS("design:type",Object)],da.prototype,"logger",void 0);fp([(0,hp.inject)(bS.TYPES.DOMHelper),vS("design:type",lC.DOMHelper)],da.prototype,"domHelper",void 0);da=fp([(0,hp.injectable)()],da);Ci.IdPostprocessor=da});var wS=f(bo=>{"use strict";var hC=bo&&bo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(bo,"__esModule",{value:!0});bo.CssClassPostprocessor=void 0;var pC=Pi(),ES=Be(),gC=_(),pp=class{decorate(e,t){if(t.cssClasses)for(let r of t.cssClasses)(0,ES.setClass)(e,r,!0);let n=(0,pC.getSubType)(t);return n&&n!==t.type&&(0,ES.setClass)(e,n,!0),e}postUpdate(){}};pp=hC([(0,gC.injectable)()],pp);bo.CssClassPostprocessor=pp});var _p=f(yp=>{"use strict";Object.defineProperty(yp,"__esModule",{value:!0});var mC=_(),B=P(),gp=$s(),PS=Ju(),yC=pu(),Zu=Us(),_C=Eh(),IS=Mn(),vC=Qr(),xi=cp(),bC=ap(),So=At(),RS=un(),MS=dp(),SC=go(),Qu=sp(),EC=lo(),ed=SS(),td=yt(),mp=wS(),Eo=Lh(),TS=Cu(),wC=Au(),OS=Qs(),PC=lh(),IC=new mC.ContainerModule((i,e,t)=>{i(B.TYPES.ILogger).to(PS.NullLogger).inSingletonScope(),i(B.TYPES.LogLevel).toConstantValue(PS.LogLevel.warn),i(B.TYPES.SModelRegistry).to(IS.SModelRegistry).inSingletonScope(),i(Zu.ActionHandlerRegistry).toSelf().inSingletonScope(),i(B.TYPES.ActionHandlerRegistryProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(Zu.ActionHandlerRegistry))})),i(B.TYPES.ViewRegistry).to(SC.ViewRegistry).inSingletonScope(),i(B.TYPES.IModelFactory).to(IS.SModelFactory).inSingletonScope(),i(B.TYPES.IActionDispatcher).to(yC.ActionDispatcher).inSingletonScope(),i(B.TYPES.IActionDispatcherProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.IActionDispatcher))})),i(B.TYPES.IDiagramLocker).to(PC.DefaultDiagramLocker).inSingletonScope(),i(B.TYPES.IActionHandlerInitializer).to(td.CommandActionHandlerInitializer),i(B.TYPES.ICommandStack).to(_C.CommandStack).inSingletonScope(),i(B.TYPES.ICommandStackProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.ICommandStack))})),i(B.TYPES.CommandStackOptions).toConstantValue({defaultDuration:250,undoHistoryLimit:50}),i(xi.ModelViewer).toSelf().inSingletonScope(),i(xi.HiddenModelViewer).toSelf().inSingletonScope(),i(xi.PopupModelViewer).toSelf().inSingletonScope(),i(B.TYPES.ModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(xi.ModelViewer),o.bind(Qu.ViewerCache).toSelf(),o.get(Qu.ViewerCache)}).inSingletonScope(),i(B.TYPES.PopupModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(xi.PopupModelViewer),o.bind(Qu.ViewerCache).toSelf(),o.get(Qu.ViewerCache)}).inSingletonScope(),i(B.TYPES.HiddenModelViewer).toService(xi.HiddenModelViewer),i(B.TYPES.IViewerProvider).toDynamicValue(r=>({get modelViewer(){return r.container.get(B.TYPES.ModelViewer)},get hiddenModelViewer(){return r.container.get(B.TYPES.HiddenModelViewer)},get popupModelViewer(){return r.container.get(B.TYPES.PopupModelViewer)}})),i(B.TYPES.ViewerOptions).toConstantValue((0,bC.defaultViewerOptions)()),i(B.TYPES.PatcherProvider).to(xi.PatcherProvider).inSingletonScope(),i(B.TYPES.DOMHelper).to(EC.DOMHelper).inSingletonScope(),i(B.TYPES.ModelRendererFactory).toFactory(r=>(o,s,a={})=>{let c=r.container.get(B.TYPES.ViewRegistry);return new xi.ModelRenderer(c,o,s,a)}),i(ed.IdPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(ed.IdPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(ed.IdPostprocessor),i(mp.CssClassPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(mp.CssClassPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(mp.CssClassPostprocessor),i(So.MouseTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(So.MouseTool),i(RS.KeyTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(RS.KeyTool),i(MS.FocusFixPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(MS.FocusFixPostprocessor),i(B.TYPES.PopupVNodePostprocessor).toService(ed.IdPostprocessor),i(So.PopupMouseTool).toSelf().inSingletonScope(),i(B.TYPES.PopupVNodePostprocessor).toService(So.PopupMouseTool),i(B.TYPES.AnimationFrameSyncer).to(vC.AnimationFrameSyncer).inSingletonScope();let n={bind:i,isBound:t};(0,td.configureCommand)(n,gp.InitializeCanvasBoundsCommand),i(gp.CanvasBoundsInitializer).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(gp.CanvasBoundsInitializer),(0,td.configureCommand)(n,wC.SetModelCommand),i(B.TYPES.IToolManager).to(Eo.ToolManager).inSingletonScope(),i(Eo.DefaultToolsEnablingKeyListener).toSelf().inSingletonScope(),i(B.TYPES.KeyListener).toService(Eo.DefaultToolsEnablingKeyListener),i(Eo.ToolManagerActionHandler).toSelf().inSingletonScope(),(0,Zu.configureActionHandler)(n,TS.EnableDefaultToolsAction.KIND,Eo.ToolManagerActionHandler),(0,Zu.configureActionHandler)(n,TS.EnableToolsAction.KIND,Eo.ToolManagerActionHandler),i(B.TYPES.UIExtensionRegistry).to(OS.UIExtensionRegistry).inSingletonScope(),(0,td.configureCommand)(n,OS.SetUIExtensionVisibilityCommand),i(So.MousePositionTracker).toSelf().inSingletonScope(),i(B.TYPES.MouseListener).toService(So.MousePositionTracker)});yp.default=IC});var ue=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.SShapeElement=Q.findChildrenAtPosition=Q.getAbsoluteClientBounds=Q.getAbsoluteBounds=Q.isAlignable=Q.isSizeable=Q.isLayoutableChild=Q.isLayoutContainer=Q.isBoundsAware=Q.alignFeature=Q.layoutableChildFeature=Q.layoutContainerFeature=Q.boundsFeature=void 0;var wo=ee(),nd=G(),RC=ze(),MC=Tn();Q.boundsFeature=Symbol("boundsFeature");Q.layoutContainerFeature=Symbol("layoutContainerFeature");Q.layoutableChildFeature=Symbol("layoutableChildFeature");Q.alignFeature=Symbol("alignFeature");function Po(i){return"bounds"in i}Q.isBoundsAware=Po;function TC(i){return Po(i)&&i.hasFeature(Q.layoutContainerFeature)&&"layout"in i}Q.isLayoutContainer=TC;function OC(i){return Po(i)&&i.hasFeature(Q.layoutableChildFeature)}Q.isLayoutableChild=OC;function AC(i){return i.hasFeature(Q.boundsFeature)&&Po(i)}Q.isSizeable=AC;function CC(i){return i.hasFeature(Q.alignFeature)&&"alignment"in i}Q.isAlignable=CC;function xC(i){let e=(0,RC.findParentByFeature)(i,Po);if(e!==void 0){let t=e.bounds,n=e;for(;n instanceof nd.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}else if(i instanceof nd.SModelRoot){let t=i.canvasBounds;return{x:0,y:0,width:t.width,height:t.height}}else return wo.Bounds.EMPTY}Q.getAbsoluteBounds=xC;function qC(i,e,t){let n=0,r=0,o=0,s=0,a=e.createUniqueDOMElementId(i),c=document.getElementById(a);if(c){let d=c.getBoundingClientRect(),l=(0,MC.getWindowScroll)();n=d.left+l.x,r=d.top+l.y,o=d.width,s=d.height}let u=document.getElementById(t.baseDiv);if(u)for(;u.offsetParent instanceof HTMLElement&&(u=u.offsetParent);)n-=u.offsetLeft,r-=u.offsetTop;return{x:n,y:r,width:o,height:s}}Q.getAbsoluteClientBounds=qC;function DC(i,e){let t=[];return AS(i,e,t),t}Q.findChildrenAtPosition=DC;function AS(i,e,t){i.children.forEach(n=>{if(Po(n)&&wo.Bounds.includes(n.bounds,e)&&t.push(n),n instanceof nd.SParentElement){let r=n.parentToLocal(e);AS(n,r,t)}})}var vp=class extends nd.SChildElement{constructor(){super(...arguments),this.position=wo.Point.ORIGIN,this.size=wo.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:e.x+this.position.x,y:e.y+this.position.y,width:-1,height:-1};return(0,wo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}parentToLocal(e){let t={x:e.x-this.position.x,y:e.y-this.position.y,width:-1,height:-1};return(0,wo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}};Q.SShapeElement=vp});var sd=f(de=>{"use strict";var jC=de&&de.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),NC=de&&de.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),CS=de&&de.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},LC=de&&de.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&jC(e,i,t);return NC(e,i),e},xS=de&&de.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},qS=de&&de.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(de,"__esModule",{value:!0});de.RequestBoundsCommand=de.SetBoundsCommand=de.LayoutAction=de.ComputedBoundsAction=de.RequestBoundsAction=de.SetBoundsAction=void 0;var id=_(),BC=ie(),DS=LC(ie()),jS=me(),NS=P(),FC=ue(),Io=class{constructor(e){this.bounds=e,this.kind=Io.KIND}};de.SetBoundsAction=Io;Io.KIND="setBounds";var _r=class{constructor(e,t=""){this.newRoot=e,this.requestId=t,this.kind=_r.KIND}static create(e){return new _r(e,(0,BC.generateRequestId)())}};de.RequestBoundsAction=_r;_r.KIND="requestBounds";var vr=class{constructor(e,t,n,r=""){this.bounds=e,this.revision=t,this.alignments=n,this.responseId=r,this.kind=vr.KIND}};de.ComputedBoundsAction=vr;vr.KIND="computedBounds";var Ro=class{constructor(){this.kind=Ro.KIND}};de.LayoutAction=Ro;Ro.KIND="layout";var rd=class extends jS.SystemCommand{constructor(e){super(),this.action=e,this.bounds=[]}execute(e){return this.action.bounds.forEach(t=>{let n=e.root.index.getById(t.elementId);n&&(0,FC.isBoundsAware)(n)&&this.bounds.push({element:n,oldBounds:n.bounds,newPosition:t.newPosition,newSize:t.newSize})}),this.redo(e)}undo(e){return this.bounds.forEach(t=>t.element.bounds=t.oldBounds),e.root}redo(e){return this.bounds.forEach(t=>{t.newPosition?t.element.bounds=Object.assign(Object.assign({},t.newPosition),t.newSize):t.element.bounds=Object.assign({x:t.element.bounds.x,y:t.element.bounds.y},t.newSize)}),e.root}};rd.KIND=DS.SetBoundsAction.KIND;rd=CS([(0,id.injectable)(),qS(0,(0,id.inject)(NS.TYPES.Action)),xS("design:paramtypes",[Object])],rd);de.SetBoundsCommand=rd;var od=class extends jS.HiddenCommand{constructor(e){super(),this.action=e}execute(e){return{model:e.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return e=>e.kind===vr.KIND}};od.KIND=DS.RequestBoundsAction.KIND;od=CS([(0,id.injectable)(),qS(0,(0,id.inject)(NS.TYPES.Action)),xS("design:paramtypes",[Object])],od);de.RequestBoundsCommand=od});var ud=f(nt=>{"use strict";var ha=nt&&nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cd=nt&&nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},LS=nt&&nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(nt,"__esModule",{value:!0});nt.configureLayout=nt.StatefulLayouter=nt.Layouter=nt.LayoutRegistry=void 0;var br=_(),VC=ee(),pa=P(),KC=Rn(),BS=ue(),HC=cr(),la=class extends KC.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>{this.hasKey(t.layoutKind)?this.logger.warn("Layout kind is already defined: ",t.layoutKind):this.register(t.layoutKind,t.factory())})}};ha([(0,br.inject)(pa.TYPES.ILogger),cd("design:type",Object)],la.prototype,"logger",void 0);la=ha([(0,br.injectable)(),LS(0,(0,br.multiInject)(pa.TYPES.LayoutRegistration)),LS(0,(0,br.optional)()),cd("design:paramtypes",[Array])],la);nt.LayoutRegistry=la;var fa=class{layout(e){new ad(e,this.layoutRegistry,this.logger).layout()}};ha([(0,br.inject)(pa.TYPES.LayoutRegistry),cd("design:type",la)],fa.prototype,"layoutRegistry",void 0);ha([(0,br.inject)(pa.TYPES.ILogger),cd("design:type",Object)],fa.prototype,"logger",void 0);fa=ha([(0,br.injectable)()],fa);nt.Layouter=fa;var ad=class{constructor(e,t,n){this.element2boundsData=e,this.layoutRegistry=t,this.log=n,this.toBeLayouted=[],e.forEach((r,o)=>{(0,BS.isLayoutContainer)(o)&&this.toBeLayouted.push(o)})}getBoundsData(e){let t=this.element2boundsData.get(e),n=e.bounds;return(0,BS.isLayoutContainer)(e)&&this.toBeLayouted.indexOf(e)>=0&&(n=this.doLayout(e)),t||(t={bounds:n,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(e,t)),t}layout(){for(;this.toBeLayouted.length>0;){let e=this.toBeLayouted[0];this.doLayout(e)}}doLayout(e){let t=this.toBeLayouted.indexOf(e);t>=0&&this.toBeLayouted.splice(t,1);let n=this.layoutRegistry.get(e.layout);n&&n.layout(e,this);let r=this.element2boundsData.get(e);return r!==void 0&&r.bounds!==void 0?r.bounds:(this.log.error(e,"Layout failed"),VC.Bounds.EMPTY)}};nt.StatefulLayouter=ad;function zC(i,e,t){if(typeof t=="function"){if(!(0,HC.isInjectable)(t))throw new Error(`Layouts be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(pa.TYPES.LayoutRegistration).toDynamicValue(n=>({layoutKind:e,factory:()=>n.container.get(t)}))}nt.configureLayout=zC});var wp=f(Cn=>{"use strict";var dd=Cn&&Cn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Sp=Cn&&Cn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Cn,"__esModule",{value:!0});Cn.HiddenBoundsUpdater=Cn.BoundsData=void 0;var ld=_(),FS=ie(),Sr=ee(),VS=G(),Ep=P(),YC=ud(),ga=ue(),bp=class{};Cn.BoundsData=bp;var Mo=class{constructor(){this.element2boundsData=new Map}decorate(e,t){return((0,ga.isSizeable)(t)||(0,ga.isLayoutContainer)(t))&&this.element2boundsData.set(t,{vnode:e,bounds:t.bounds,boundsChanged:!1,alignmentChanged:!1}),t instanceof VS.SModelRoot&&(this.root=t),e}postUpdate(e){if(e===void 0||e.kind!==FS.RequestBoundsAction.KIND)return;let t=e;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);let n=[],r=[];this.element2boundsData.forEach((s,a)=>{if(s.boundsChanged&&s.bounds!==void 0){let c={elementId:a.id,newSize:{width:s.bounds.width,height:s.bounds.height}};a instanceof VS.SChildElement&&(0,ga.isLayoutContainer)(a.parent)&&(c.newPosition={x:s.bounds.x,y:s.bounds.y}),n.push(c)}s.alignmentChanged&&s.alignment!==void 0&&r.push({elementId:a.id,newAlignment:s.alignment})});let o=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(FS.ComputedBoundsAction.create(n,{revision:o,alignments:r,requestId:t.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((e,t)=>{if(e.bounds&&(0,ga.isSizeable)(t)){let n=e.vnode;if(n&&n.elm){let r=this.getBounds(n.elm,t);(0,ga.isAlignable)(t)&&!((0,Sr.almostEquals)(r.x,0)&&(0,Sr.almostEquals)(r.y,0))&&(e.alignment={x:-r.x,y:-r.y},e.alignmentChanged=!0);let o={x:t.bounds.x,y:t.bounds.y,width:r.width,height:r.height};(0,Sr.almostEquals)(o.x,t.bounds.x)&&(0,Sr.almostEquals)(o.y,t.bounds.y)&&(0,Sr.almostEquals)(o.width,t.bounds.width)&&(0,Sr.almostEquals)(o.height,t.bounds.height)||(e.bounds=o,e.boundsChanged=!0)}}})}getBounds(e,t){if(typeof e.getBBox!="function")return this.logger.error(this,"Not an SVG element:",e),Sr.Bounds.EMPTY;let n=e.getBBox();return{x:n.x,y:n.y,width:n.width,height:n.height}}};dd([(0,ld.inject)(Ep.TYPES.ILogger),Sp("design:type",Object)],Mo.prototype,"logger",void 0);dd([(0,ld.inject)(Ep.TYPES.IActionDispatcher),Sp("design:type",Object)],Mo.prototype,"actionDispatcher",void 0);dd([(0,ld.inject)(Ep.TYPES.Layouter),Sp("design:type",YC.Layouter)],Mo.prototype,"layouter",void 0);Mo=dd([(0,ld.injectable)()],Mo);Cn.HiddenBoundsUpdater=Mo});var fd=f(To=>{"use strict";var UC=To&&To.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(To,"__esModule",{value:!0});To.AbstractLayout=void 0;var Pp=ee(),KS=G(),Ip=ue(),kC=_(),Rp=class{layout(e,t){let n=t.getBoundsData(e),r=this.getLayoutOptions(e),o=this.getChildrenSize(e,r,t),s=r.paddingFactor*(r.resizeContainer?o.width:Math.max(0,this.getFixedContainerBounds(e,r,t).width)-r.paddingLeft-r.paddingRight),a=r.paddingFactor*(r.resizeContainer?o.height:Math.max(0,this.getFixedContainerBounds(e,r,t).height)-r.paddingTop-r.paddingBottom);if(s>0&&a>0){let c=this.layoutChildren(e,t,r,s,a);n.bounds=this.getFinalContainerBounds(e,c,r,s,a),n.boundsChanged=!0}}getFinalContainerBounds(e,t,n,r,o){return{x:e.bounds.x,y:e.bounds.y,width:Math.max(n.minWidth,r+n.paddingLeft+n.paddingRight),height:Math.max(n.minHeight,o+n.paddingTop+n.paddingBottom)}}getFixedContainerBounds(e,t,n){let r=e;for(;;){if((0,Ip.isBoundsAware)(r)){let o=r.bounds;if((0,Ip.isLayoutContainer)(r)&&t.resizeContainer&&n.log.error(r,"Resizable container found while detecting fixed bounds"),Pp.Dimension.isValid(o))return o}if(r instanceof KS.SChildElement)r=r.parent;else return n.log.error(r,"Cannot detect fixed bounds"),Pp.Bounds.EMPTY}}layoutChildren(e,t,n,r,o){let s={x:n.paddingLeft+.5*(r-r/n.paddingFactor),y:n.paddingTop+.5*(o-o/n.paddingFactor)};return e.children.forEach(a=>{if((0,Ip.isLayoutableChild)(a)){let c=t.getBoundsData(a),u=c.bounds,d=this.getChildLayoutOptions(a,n);u!==void 0&&Pp.Dimension.isValid(u)&&(s=this.layoutChild(a,c,u,d,n,s,r,o))}}),s}getDx(e,t,n){switch(e){case"left":return 0;case"center":return .5*(n-t.width);case"right":return n-t.width}}getDy(e,t,n){switch(e){case"top":return 0;case"center":return .5*(n-t.height);case"bottom":return n-t.height}}getChildLayoutOptions(e,t){let n=e.layoutOptions;return n===void 0?t:this.spread(t,n)}getLayoutOptions(e){let t=e,n=[];for(;t!==void 0;){let r=t.layoutOptions;if(r!==void 0&&n.push(r),t instanceof KS.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>this.spread(r,o),this.getDefaultLayoutOptions())}};Rp=UC([(0,kC.injectable)()],Rp);To.AbstractLayout=Rp});var Mp=f(Oo=>{"use strict";var GC=Oo&&Oo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.VBoxLayouter=void 0;var $C=_(),WC=ee(),XC=fd(),JC=ue(),hd=class extends XC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=0,s=!0;return e.children.forEach(a=>{if((0,JC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&WC.Dimension.isValid(c)&&(o+=c.height,s?s=!1:o+=t.vGap,r=Math.max(r,c.width))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:s.y+e.bounds.y-n.y,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x,y:s.y+n.height+o.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};hd.KIND="vbox";hd=GC([(0,$C.injectable)()],hd);Oo.VBoxLayouter=hd});var Tp=f(Ao=>{"use strict";var ZC=Ao&&Ao.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.HBoxLayouter=void 0;var QC=_(),ex=ee(),tx=fd(),nx=ue(),pd=class extends tx.AbstractLayout{getChildrenSize(e,t,n){let r=0,o=-1,s=!0;return e.children.forEach(a=>{if((0,nx.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&ex.Dimension.isValid(c)&&(s?s=!1:r+=t.hGap,r+=c.width,o=Math.max(o,c.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDy(r.vAlign,n,c);return t.bounds={x:s.x+e.bounds.x-n.x,y:o.paddingTop+e.bounds.y-n.y+u,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x+n.width+o.hGap,y:s.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};pd.KIND="hbox";pd=ZC([(0,QC.injectable)()],pd);Ao.HBoxLayouter=pd});var Op=f(Co=>{"use strict";var ix=Co&&Co.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Co,"__esModule",{value:!0});Co.StackLayouter=void 0;var rx=_(),ox=ee(),sx=fd(),ax=ue(),gd=class extends sx.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=-1;return e.children.forEach(s=>{if((0,ax.isLayoutableChild)(s)){let a=n.getBoundsData(s).bounds;a!==void 0&&ox.Dimension.isValid(a)&&(r=Math.max(r,a.width),o=Math.max(o,a.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a),d=this.getDy(r.vAlign,n,c);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:o.paddingTop+e.bounds.y-n.y+d,width:n.width,height:n.height},t.boundsChanged=!0,s}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};gd.KIND="stack";gd=ix([(0,rx.injectable)()],gd);Co.StackLayouter=gd});var ma=f(xo=>{"use strict";var cx=xo&&xo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(xo,"__esModule",{value:!0});xo.ShapeView=void 0;var ux=_(),dx=ee(),lx=ue(),Ap=class{isVisible(e,t){if(t.targetKind==="hidden"||!dx.Dimension.isValid(e.bounds))return!0;let n=(0,lx.getAbsoluteBounds)(e),r=e.root.canvasBounds;return n.x<=r.width&&n.x+n.width>=0&&n.y<=r.height&&n.y+n.height>=0}};Ap=cx([(0,ux.injectable)()],Ap);xo.ShapeView=Ap});var _a=f(Jt=>{"use strict";var fx=Jt&&Jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},hx=Jt&&Jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},md=Jt&&Jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.configureButtonHandler=Jt.ButtonHandlerRegistry=void 0;var ya=_(),px=Rn(),Cp=P(),gx=cr(),xp=class extends px.InstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.TYPE,n.factory())),t.forEach(n=>this.register(n.TYPE,new n))}};xp=fx([(0,ya.injectable)(),md(0,(0,ya.multiInject)(Cp.TYPES.IButtonHandlerRegistration)),md(0,(0,ya.optional)()),md(1,(0,ya.multiInject)(Cp.TYPES.IButtonHandler)),md(1,(0,ya.optional)()),hx("design:paramtypes",[Array,Array])],xp);Jt.ButtonHandlerRegistry=xp;function mx(i,e,t){if(typeof t=="function"){if(!(0,gx.isInjectable)(t))throw new Error(`Button handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(Cp.TYPES.IButtonHandlerRegistration).toDynamicValue(n=>({TYPE:e,factory:()=>n.container.get(t)}))}Jt.configureButtonHandler=mx});var qo=f(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.isFadeable=Er.fadeFeature=void 0;Er.fadeFeature=Symbol("fadeFeature");function yx(i){return i.hasFeature(Er.fadeFeature)&&i.opacity!==void 0}Er.isFadeable=yx});var vd=f(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.SButton=void 0;var qp=ue(),_x=qo(),yd=class extends qp.SShapeElement{constructor(){super(...arguments),this.enabled=!0}};_d.SButton=yd;yd.DEFAULT_FEATURES=[qp.boundsFeature,qp.layoutableChildFeature,_x.fadeFeature]});var Dp=f(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.name=ni.isNameable=ni.nameFeature=void 0;ni.nameFeature=Symbol("nameableFeature");function HS(i){return i.hasFeature(ni.nameFeature)}ni.isNameable=HS;function vx(i){if(HS(i))return i.name}ni.name=vx});var bd=f(Zt=>{"use strict";var US=Zt&&Zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},kS=Zt&&Zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Np=Zt&&Zt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.RevealNamedElementActionProvider=Zt.CommandPaletteActionProviderRegistry=void 0;var va=_(),jp=ie(),zS=bc(),GS=P(),bx=or(),YS=Dp(),Lp=class{constructor(e=[]){this.actionProviders=e}getActions(e,t,n,r){let o=this.actionProviders.map(s=>s.getActions(e,t,n,r));return Promise.all(o).then(s=>s.reduce((a,c)=>c!==void 0?a.concat(c):a))}};Lp=US([(0,va.injectable)(),Np(0,(0,va.multiInject)(GS.TYPES.ICommandPaletteActionProvider)),Np(0,(0,va.optional)()),kS("design:paramtypes",[Array])],Lp);Zt.CommandPaletteActionProviderRegistry=Lp;var Bp=class{constructor(e){this.logger=e}getActions(e,t,n,r){return r!==void 0&&r%2===0?Promise.resolve(this.createSelectActions(e)):Promise.resolve([new zS.LabeledAction("Select all",[jp.SelectAllAction.create()])])}createSelectActions(e){return(0,bx.toArray)(e.index.all().filter(n=>(0,YS.isNameable)(n))).map(n=>new zS.LabeledAction(`Reveal ${(0,YS.name)(n)}`,[jp.SelectAction.create({selectedElementsIDs:[n.id]}),jp.CenterAction.create([n.id])],"eye"))}};Bp=US([(0,va.injectable)(),Np(0,(0,va.inject)(GS.TYPES.ILogger)),kS("design:paramtypes",[Object])],Bp);Zt.RevealNamedElementActionProvider=Bp});var Fp=f(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.codiconCSSClasses=Qt.codiconCSSString=Qt.ANIMATION_SPIN=Qt.ACTION_ITEM=void 0;Qt.ACTION_ITEM="action-item";Qt.ANIMATION_SPIN="animation-spin";function Sx(i,e=!1,t=!1,n=[]){return $S(i,e,t,n).join(" ")}Qt.codiconCSSString=Sx;function $S(i,e=!1,t=!1,n=[]){let r=["codicon",`codicon-${i}`];return e&&r.push(Qt.ACTION_ITEM),t&&r.push(Qt.ANIMATION_SPIN),n.length>0&&r.push(...n),r}Qt.codiconCSSClasses=$S});var Et=f(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.isSelected=ii.isSelectable=ii.selectFeature=void 0;ii.selectFeature=Symbol("selectFeature");function WS(i){return i.hasFeature(ii.selectFeature)}ii.isSelectable=WS;function Ex(i){return i!==void 0&&WS(i)&&i.selected}ii.isSelected=Ex});var XS=f((Vp,Kp)=>{(function(i,e){typeof Vp=="object"&&typeof Kp<"u"?Kp.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self,i.autocomplete=e())})(Vp,function(){"use strict";function i(e){var t=document,n=e.container||t.createElement("div");n.id=n.id||"autocomplete-"+T();var r=n.style,o=e.debounceWaitMs||0,s=e.preventSubmit||!1,a=e.disableAutoSelect||!1,c=[],u="",d=2,l=e.showOnFocus,S,R=0,v;if(e.minLength!==void 0&&(d=e.minLength),!e.input)throw new Error("input undefined");var m=e.input;n.className="autocomplete "+(e.className||""),n.setAttribute("role","listbox"),m.setAttribute("role","combobox"),m.setAttribute("aria-expanded","false"),m.setAttribute("aria-autocomplete","list"),m.setAttribute("aria-controls",n.id),m.setAttribute("aria-owns",n.id),m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-haspopup","listbox"),r.position="absolute";function T(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function C(){var L=n.parentNode;L&&L.removeChild(n)}function K(){v&&window.clearTimeout(v)}function k(){n.parentNode||t.body.appendChild(n)}function D(){return!!n.parentNode}function F(){R++,c=[],u="",S=void 0,m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-expanded","false"),C()}function H(){if(!D())return;m.setAttribute("aria-expanded","true"),r.height="auto",r.width=m.offsetWidth+"px";var L=0,j;function ce(){var Ne=t.documentElement,U=Ne.clientTop||t.body.clientTop||0,Ke=Ne.clientLeft||t.body.clientLeft||0,fi=window.pageYOffset||Ne.scrollTop,cn=window.pageXOffset||Ne.scrollLeft;j=m.getBoundingClientRect();var We=j.top+m.offsetHeight+fi-U,ot=j.left+cn-Ke;r.top=We+"px",r.left=ot+"px",L=window.innerHeight-(j.top+m.offsetHeight),L<0&&(L=0),r.top=We+"px",r.bottom="",r.left=ot+"px",r.maxHeight=L+"px"}ce(),ce(),e.customize&&j&&e.customize(m,j,n,L)}function $(){for(;n.firstChild;)n.removeChild(n.firstChild);m.setAttribute("aria-activedescendant","");var L=function(Ke,fi,cn){var We=t.createElement("div");return We.textContent=Ke.label||"",We};e.render&&(L=e.render);var j=function(Ke,fi){var cn=t.createElement("div");return cn.textContent=Ke,cn};e.renderGroup&&(j=e.renderGroup);var ce=t.createDocumentFragment(),Ne="#9?$";if(c.forEach(function(Ke,fi){if(Ke.group&&Ke.group!==Ne){Ne=Ke.group;var cn=j(Ke.group,u);cn&&(cn.className+=" group",ce.appendChild(cn))}var We=L(Ke,u,fi);We&&(We.id=n.id+"_"+fi,We.setAttribute("role","option"),We.addEventListener("click",function(ot){e.onSelect(Ke,m),F(),ot.preventDefault(),ot.stopPropagation()}),Ke===S&&(We.className+=" selected",We.setAttribute("aria-selected","true"),m.setAttribute("aria-activedescendant",We.id)),ce.appendChild(We))}),n.appendChild(ce),c.length<1)if(e.emptyMsg){var U=t.createElement("div");U.id=n.id+"_"+T(),U.className="empty",U.textContent=e.emptyMsg,n.appendChild(U),m.setAttribute("aria-activedescendant",U.id)}else{F();return}k(),H(),be()}function z(){D()&&$()}function ae(){z()}function Ie(L){L.target!==n?z():L.preventDefault()}function he(L){for(var j=L.which||L.keyCode||0,ce=e.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9],Ne=0,U=ce;Ne<U.length;Ne++){var Ke=U[Ne];if(j===Ke)return}j>=112&&j<=123&&!e.keysToIgnore||j===40&&D()||js(0)}function be(){var L=n.getElementsByClassName("selected");if(L.length>0){var j=L[0],ce=j.previousElementSibling;if(ce&&ce.className.indexOf("group")!==-1&&!ce.previousElementSibling&&(j=ce),j.offsetTop<n.scrollTop)n.scrollTop=j.offsetTop;else{var Ne=j.offsetTop+j.offsetHeight,U=n.scrollTop+n.offsetHeight;Ne>U&&(n.scrollTop+=Ne-U)}}}function $e(){if(c.length<1)S=void 0;else if(S===c[0])S=c[c.length-1];else for(var L=c.length-1;L>0;L--)if(S===c[L]||L===1){S=c[L-1];break}}function vn(){if(c.length<1&&(S=void 0),!S||S===c[c.length-1]){S=c[0];return}for(var L=0;L<c.length-1;L++)if(S===c[L]){S=c[L+1];break}}function li(L){var j=L.which||L.keyCode||0;if(j===38||j===40||j===27){var ce=D();if(j===27)F();else{if(!ce||c.length<1)return;j===38?$e():vn(),$()}L.preventDefault(),ce&&L.stopPropagation();return}j===13&&(S&&(e.onSelect(S,m),F()),s&&L.preventDefault())}function Ds(){l&&js(1)}function js(L){var j=++R,ce=m.value,Ne=m.selectionStart||0;ce.length>=d||L===1?(K(),v=window.setTimeout(function(){e.fetch(ce,function(U){R===j&&U&&(c=U,u=ce,S=c.length<1||a?void 0:c[0],$())},L,Ne)},L===0?o:0)):F()}function Ns(){setTimeout(function(){t.activeElement!==m&&F()},200)}n.addEventListener("mousedown",function(L){L.stopPropagation(),L.preventDefault()}),n.addEventListener("focus",function(){return m.focus()});function yc(){m.removeEventListener("focus",Ds),m.removeEventListener("keydown",li),m.removeEventListener("keyup",he),m.removeEventListener("blur",Ns),window.removeEventListener("resize",ae),t.removeEventListener("scroll",Ie,!0),m.removeAttribute("role"),m.removeAttribute("aria-expanded"),m.removeAttribute("aria-autocomplete"),m.removeAttribute("aria-controls"),m.removeAttribute("aria-activedescendant"),m.removeAttribute("aria-owns"),m.removeAttribute("aria-haspopup"),K(),F()}return m.addEventListener("keydown",li),m.addEventListener("keyup",he),m.addEventListener("blur",Ns),m.addEventListener("focus",Ds),window.addEventListener("resize",ae),t.addEventListener("scroll",Ie,!0),{destroy:yc}}return i})});var Up=f(en=>{"use strict";var Do=en&&en.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ba=en&&en.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},wx=en&&en.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},Sd;Object.defineProperty(en,"__esModule",{value:!0});en.CommandPaletteKeyListener=en.CommandPalette=void 0;var jo=_(),Px=ie(),Ix=bc(),Ed=P(),Rx=Lu(),JS=Qs(),Mx=lo(),Tx=un(),ZS=Fp(),Hp=or(),Yp=On(),QS=ue(),tE=Et(),Ox=bd(),eE=At(),Ax=wx(XS()),qt=Sd=class extends Rx.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,ZS.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return Sd.ID}containerClass(){return"command-palette"}show(e,...t){super.show(e,...t),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,Ax.default)(this.autocompleteSettings(e)),this.inputElement.focus()}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",t=>this.hideIfEscapeEvent(t)),this.inputElement.addEventListener("keydown",t=>this.cylceIfInvokePaletteKey(t)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),e.appendChild(this.inputElement)}hideIfEscapeEvent(e){(0,Yp.matchesKeystroke)(e,"Escape")&&this.hide()}cylceIfInvokePaletteKey(e){Sd.isInvokePaletteKey(e)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(e,t,...n){let r=this.xOffset,o=this.yOffset,s=(0,Hp.toArray)(t.index.all().filter(a=>(0,tE.isSelectable)(a)&&a.selected));if(s.length===1){let a=(0,QS.getAbsoluteClientBounds)(s[0],this.domHelper,this.viewerOptions);r+=a.x+a.width,o+=a.y}else{let a=(0,QS.getAbsoluteClientBounds)(t,this.domHelper,this.viewerOptions);r+=a.x,o+=a.y}e.style.left=`${r}px`,e.style.top=`${o}px`,e.style.width=`${this.defaultWidth}px`}autocompleteSettings(e){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(t,n)=>this.updateAutoCompleteActions(n,t,e),onSelect:t=>this.onSelect(t),render:(t,n)=>this.renderLabeledActionSuggestion(t,n),customize:(t,n,r,o)=>{this.customizeSuggestionContainer(r,n,o)}}}onSelect(e){this.executeAction(e),this.hide()}updateAutoCompleteActions(e,t,n){this.onLoading(),this.contextActions?(e(this.filterActions(t,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(n,t,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(r=>{this.contextActions=r,e(this.filterActions(t,r)),this.onLoaded("success")}).catch(r=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",r),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(e){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(e,t){let n=document.createElement("div"),r=xx(t).split(" ").join("|"),o=new RegExp(r,"gi");return e.icon&&this.renderIcon(n,e.icon),t.length>0?n.innerHTML+=e.label.replace(o,s=>"<em>"+s+"</em>").replace(/ /g,"&nbsp;"):n.innerHTML+=e.label.replace(/ /g,"&nbsp;"),n}renderIcon(e,t){e.innerHTML+=`<span class="icon ${this.getCodicon(t)}"></span>`}getFontAwesomeIcon(e){return`fa fa-${e}`}getCodicon(e){return(0,ZS.codiconCSSString)(e)}filterActions(e,t){return(0,Hp.toArray)(t.filter(n=>{let r=n.label.toLowerCase();return e.split(" ").every(s=>r.indexOf(s.toLowerCase())!==-1)}))}customizeSuggestionContainer(e,t,n){this.containerElement&&this.containerElement.appendChild(e)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(e){this.actionDispatcherProvider().then(t=>t.dispatchAll(Cx(e))).catch(t=>this.logger.error(this,"No action dispatcher available to execute command palette action",t))}};qt.ID="command-palette";qt.isInvokePaletteKey=i=>(0,Yp.matchesKeystroke)(i,"Space","ctrl");Do([(0,jo.inject)(Ed.TYPES.IActionDispatcherProvider),ba("design:type",Function)],qt.prototype,"actionDispatcherProvider",void 0);Do([(0,jo.inject)(Ed.TYPES.ICommandPaletteActionProviderRegistry),ba("design:type",Ox.CommandPaletteActionProviderRegistry)],qt.prototype,"actionProviderRegistry",void 0);Do([(0,jo.inject)(Ed.TYPES.ViewerOptions),ba("design:type",Object)],qt.prototype,"viewerOptions",void 0);Do([(0,jo.inject)(Ed.TYPES.DOMHelper),ba("design:type",Mx.DOMHelper)],qt.prototype,"domHelper",void 0);Do([(0,jo.inject)(eE.MousePositionTracker),ba("design:type",eE.MousePositionTracker)],qt.prototype,"mousePositionTracker",void 0);qt=Sd=Do([(0,jo.injectable)()],qt);en.CommandPalette=qt;function Cx(i){return(0,Ix.isLabeledAction)(i)?i.actions:(0,Px.isAction)(i)?[i]:[]}function xx(i){return i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var zp=class extends Tx.KeyListener{keyDown(e,t){if((0,Yp.matchesKeystroke)(t,"Escape"))return[JS.SetUIExtensionVisibilityAction.create({extensionId:qt.ID,visible:!1,contextElementsId:[]})];if(qt.isInvokePaletteKey(t)){let n=(0,Hp.toArray)(e.index.all().filter(r=>(0,tE.isSelectable)(r)&&r.selected).map(r=>r.id));return[JS.SetUIExtensionVisibilityAction.create({extensionId:qt.ID,visible:!0,contextElementsId:n})]}return[]}};en.CommandPaletteKeyListener=zp});var nE=f(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});wd.toAnchor=void 0;function qx(i){return i instanceof HTMLElement?{x:i.offsetLeft,y:i.offsetTop}:i}wd.toAnchor=qx});var No=f(Te=>{"use strict";var Dx=Te&&Te.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jx=Te&&Te.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Nx=Te&&Te.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Te,"__esModule",{value:!0});Te.DeleteElementCommand=Te.ResolvedDelete=Te.DeleteElementAction=Te.isDeletable=Te.deletableFeature=void 0;var iE=_(),Lx=me(),Bx=G(),Fx=P();Te.deletableFeature=Symbol("deletableFeature");function rE(i){return i instanceof Bx.SChildElement&&i.hasFeature(Te.deletableFeature)}Te.isDeletable=rE;var oE;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(oE=Te.DeleteElementAction||(Te.DeleteElementAction={}));var kp=class{};Te.ResolvedDelete=kp;var Pd=class extends Lx.Command{constructor(e){super(),this.action=e,this.resolvedDeletes=[]}execute(e){let t=e.root.index;for(let n of this.action.elementIds){let r=t.getById(n);r&&rE(r)&&(this.resolvedDeletes.push({child:r,parent:r.parent}),r.parent.remove(r))}return e.root}undo(e){for(let t of this.resolvedDeletes)t.parent.add(t.child);return e.root}redo(e){for(let t of this.resolvedDeletes)t.parent.remove(t.child);return e.root}};Pd.KIND=oE.KIND;Pd=Dx([(0,iE.injectable)(),Nx(0,(0,iE.inject)(Fx.TYPES.Action)),jx("design:paramtypes",[Object])],Pd);Te.DeleteElementCommand=Pd});var Rd=f(tn=>{"use strict";var aE=tn&&tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Vx=tn&&tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},sE=tn&&tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.DeleteContextMenuItemProvider=tn.ContextMenuProviderRegistry=void 0;var Id=_(),Kx=P(),Hx=No(),zx=Et(),Yx=hr(),Gp=class{constructor(e=[]){this.menuProviders=e}getItems(e,t){let n=this.menuProviders.map(r=>r.getItems(e,t));return Promise.all(n).then(this.flattenAndRestructure)}flattenAndRestructure(e){let t=e.reduce((r,o)=>o!==void 0?r.concat(o):r,[]),n=t.filter(r=>r.parentId);for(let r of n)if(r.parentId){let o=r.parentId.split("."),s,a=t;for(let c of o)s=a.find(u=>c===u.id),s&&s.children&&(a=s.children);s&&(s.children?s.children.push(r):s.children=[r],t=t.filter(c=>c!==r))}return t}};Gp=aE([(0,Id.injectable)(),sE(0,(0,Id.multiInject)(Kx.TYPES.IContextMenuItemProvider)),sE(0,(0,Id.optional)()),Vx("design:paramtypes",[Array])],Gp);tn.ContextMenuProviderRegistry=Gp;var $p=class{getItems(e,t){let n=Array.from(e.index.all().filter(zx.isSelected).filter(Hx.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[Yx.DeleteElementAction.create(n.map(r=>r.id))],isEnabled:()=>n.length>0}])}};$p=aE([(0,Id.injectable)()],$p);tn.DeleteContextMenuItemProvider=$p});var Jp=f(xn=>{"use strict";var uE=xn&&xn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},dE=xn&&xn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},cE=xn&&xn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(xn,"__esModule",{value:!0});xn.ContextMenuMouseListener=void 0;var Wp=_(),Ux=ie(),kx=Rd(),Gx=At(),Xp=P(),Md=Et(),$x=ze(),Td=class extends Gx.MouseListener{constructor(e,t){super(),this.contextMenuService=e,this.menuProvider=t}contextMenu(e,t){return this.showContextMenu(e,t),[]}async showContextMenu(e,t){let n;try{n=await this.contextMenuService()}catch{return}let r={x:t.x,y:t.y},o=e.root,s=e.id,a=!1,c=(0,$x.findParentByFeature)(e,Md.isSelectable);c&&(a=c.selected,c.selected=!0);let u=()=>{c&&(c.selected=a)};if((0,Md.isSelectable)(e))if((0,Md.isSelected)(e)){let d=await this.menuProvider.getItems(e.root,r);n.show(d,r,u)}else{let d={selectedElementsIDs:[s],deselectedElementsIDs:Array.from(o.index.all().filter(Md.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(Ux.SelectAction.create(d));let l=await this.menuProvider.getItems(o,r);n.show(l,r)}}};uE([(0,Wp.inject)(Xp.TYPES.IActionDispatcher),dE("design:type",Object)],Td.prototype,"actionDispatcher",void 0);Td=uE([cE(0,(0,Wp.inject)(Xp.TYPES.IContextMenuServiceProvider)),cE(1,(0,Wp.inject)(Xp.TYPES.IContextMenuProviderRegistry)),dE("design:paramtypes",[Function,kx.ContextMenuProviderRegistry])],Td);xn.ContextMenuMouseListener=Td});var wr=f(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.hasPopupFeature=nn.popupFeature=nn.isHoverable=nn.hoverFeedbackFeature=void 0;nn.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function Wx(i){return i.hasFeature(nn.hoverFeedbackFeature)}nn.isHoverable=Wx;nn.popupFeature=Symbol("popupFeature");function Xx(i){return i.hasFeature(nn.popupFeature)}nn.hasPopupFeature=Xx});var qi=f(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.isMoveable=ri.isLocateable=ri.moveFeature=void 0;ri.moveFeature=Symbol("moveFeature");function lE(i){return i.position!==void 0}ri.isLocateable=lE;function Jx(i){return i.hasFeature(ri.moveFeature)&&lE(i)}ri.isMoveable=Jx});var _e=f(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.edgeInProgressTargetHandleID=pe.edgeInProgressID=pe.SDanglingAnchor=pe.SRoutingHandle=pe.SConnectableElement=pe.getRouteBounds=pe.getAbsoluteRouteBounds=pe.isConnectable=pe.connectableFeature=pe.SRoutableElement=void 0;var fE=ee(),Zp=G(),Zx=ue(),Qx=No(),e1=Et(),t1=wr(),n1=qi(),Sa=class extends Zp.SChildElement{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((e,t)=>fE.Bounds.combine(e,{x:t.x,y:t.y,width:0,height:0}),fE.Bounds.EMPTY)}};pe.SRoutableElement=Sa;pe.connectableFeature=Symbol("connectableFeature");function i1(i){return i.hasFeature(pe.connectableFeature)&&i.canConnect}pe.isConnectable=i1;function r1(i,e=i.routingPoints){let t=hE(e),n=i;for(;n instanceof Zp.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}pe.getAbsoluteRouteBounds=r1;function hE(i){let e={x:NaN,y:NaN,width:0,height:0};for(let t of i)isNaN(e.x)?(e.x=t.x,e.y=t.y):(t.x<e.x?(e.width+=e.x-t.x,e.x=t.x):t.x>e.x+e.width&&(e.width=t.x-e.x),t.y<e.y?(e.height+=e.y-t.y,e.y=t.y):t.y>e.y+e.height&&(e.height=t.y-e.y));return e}pe.getRouteBounds=hE;var Od=class extends Zx.SShapeElement{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(t=>t instanceof Sa).filter(t=>t.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(t=>t instanceof Sa).filter(t=>t.sourceId===this.id)}canConnect(e,t){return!0}};pe.SConnectableElement=Od;var Lo=class extends Zp.SChildElement{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(e){return Lo.DEFAULT_FEATURES.indexOf(e)!==-1}};pe.SRoutingHandle=Lo;Lo.DEFAULT_FEATURES=[e1.selectFeature,n1.moveFeature,t1.hoverFeedbackFeature];var Ad=class extends Od{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}};pe.SDanglingAnchor=Ad;Ad.DEFAULT_FEATURES=[Qx.deletableFeature];pe.edgeInProgressID="edge-in-progress";pe.edgeInProgressTargetHandleID=pe.edgeInProgressID+"-target-anchor"});var Bo=f(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.DEFAULT_EDGE_PLACEMENT=fn.EdgePlacement=fn.isEdgeLayoutable=fn.edgeLayoutFeature=void 0;var o1=G(),s1=ue(),a1=_e();fn.edgeLayoutFeature=Symbol("edgeLayout");function c1(i){return i instanceof o1.SChildElement&&i.parent instanceof a1.SRoutableElement&&u1(i)&&(0,s1.isBoundsAware)(i)&&i.hasFeature(fn.edgeLayoutFeature)}fn.isEdgeLayoutable=c1;function u1(i){return"edgePlacement"in i}var Qp=class extends Object{};fn.EdgePlacement=Qp;fn.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}});var Fo=f(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.isWithEditableLabel=Ye.withEditLabelFeature=Ye.isEditableLabel=Ye.editLabelFeature=Ye.canEditRouting=Ye.editFeature=void 0;var d1=_e();Ye.editFeature=Symbol("editFeature");function l1(i){return i instanceof d1.SRoutableElement&&i.hasFeature(Ye.editFeature)}Ye.canEditRouting=l1;Ye.editLabelFeature=Symbol("editLabelFeature");function f1(i){return"text"in i&&i.hasFeature(Ye.editLabelFeature)}Ye.isEditableLabel=f1;Ye.withEditLabelFeature=Symbol("withEditLabelFeature");function h1(i){return"editableLabel"in i&&i.hasFeature(Ye.withEditLabelFeature)}Ye.isWithEditableLabel=h1});var qn=f(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.isViewport=Pr.viewportFeature=void 0;var p1=G();Pr.viewportFeature=Symbol("viewportFeature");function g1(i){return i instanceof p1.SModelRoot&&i.hasFeature(Pr.viewportFeature)&&"zoom"in i&&"scroll"in i}Pr.isViewport=g1});var Cd=f(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.isExportable=Ir.exportFeature=void 0;Ir.exportFeature=Symbol("exportFeature");function m1(i){return i.hasFeature(Ir.exportFeature)}Ir.isExportable=m1});var Dd=f(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.ViewportRootElement=void 0;var Ea=ee(),y1=G(),_1=qn(),v1=Cd(),xd=class extends y1.SModelRoot{constructor(e){super(e),this.scroll={x:0,y:0},this.zoom=1,this.position=Ea.Point.ORIGIN,this.size=Ea.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:(e.x-this.scroll.x)*this.zoom,y:(e.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,Ea.isBounds)(e)&&(t.width=e.width*this.zoom,t.height=e.height*this.zoom),t}parentToLocal(e){let t={x:e.x/this.zoom+this.scroll.x,y:e.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,Ea.isBounds)(e)&&Ea.Dimension.isValid(e)&&(t.width=e.width/this.zoom,t.height=e.height/this.zoom),t}};qd.ViewportRootElement=xd;xd.DEFAULT_FEATURES=[_1.viewportFeature,v1.exportFeature]});var Rr=f(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.SGraphIndex=it.SCompartment=it.SLabel=it.SEdge=it.SPort=it.SNode=it.SGraph=void 0;var b1=ee(),S1=G(),hn=ue(),E1=Bo(),pE=No(),w1=Fo(),Pa=qo(),jd=wr(),P1=qi(),Ia=_e(),tg=Et(),I1=Dd(),R1=or(),eg=class extends I1.ViewportRootElement{constructor(e=new Di){super(e)}};it.SGraph=eg;var Nd=class extends Ia.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(e,t){return this.children.find(n=>n instanceof wa)===void 0}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):this.index.all().filter(n=>n instanceof Dn).filter(n=>n.targetId===this.id)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):this.index.all().filter(n=>n instanceof Dn).filter(n=>n.sourceId===this.id)}};it.SNode=Nd;Nd.DEFAULT_FEATURES=[Ia.connectableFeature,pE.deletableFeature,tg.selectFeature,hn.boundsFeature,P1.moveFeature,hn.layoutContainerFeature,Pa.fadeFeature,jd.hoverFeedbackFeature,jd.popupFeature];var wa=class extends Ia.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):super.incomingEdges.filter(t=>t instanceof Dn)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):super.outgoingEdges.filter(t=>t instanceof Dn)}};it.SPort=wa;wa.DEFAULT_FEATURES=[Ia.connectableFeature,tg.selectFeature,hn.boundsFeature,Pa.fadeFeature,jd.hoverFeedbackFeature];var Dn=class extends Ia.SRoutableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}};it.SEdge=Dn;Dn.DEFAULT_FEATURES=[w1.editFeature,pE.deletableFeature,tg.selectFeature,Pa.fadeFeature,jd.hoverFeedbackFeature];var Ld=class extends hn.SShapeElement{constructor(){super(...arguments),this.selected=!1,this.alignment=b1.Point.ORIGIN,this.opacity=1}};it.SLabel=Ld;Ld.DEFAULT_FEATURES=[hn.boundsFeature,hn.alignFeature,hn.layoutableChildFeature,E1.edgeLayoutFeature,Pa.fadeFeature];var Bd=class extends hn.SShapeElement{constructor(){super(...arguments),this.opacity=1}};it.SCompartment=Bd;Bd.DEFAULT_FEATURES=[hn.boundsFeature,hn.layoutContainerFeature,hn.layoutableChildFeature,Pa.fadeFeature];var Di=class extends S1.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(e){if(super.add(e),e instanceof Dn){if(e.sourceId){let t=this.outgoing.get(e.sourceId);t===void 0?this.outgoing.set(e.sourceId,[e]):t.push(e)}if(e.targetId){let t=this.incoming.get(e.targetId);t===void 0?this.incoming.set(e.targetId,[e]):t.push(e)}}}remove(e){if(super.remove(e),e instanceof Dn){let t=this.outgoing.get(e.sourceId);if(t!==void 0){let r=t.indexOf(e);r>=0&&(t.length===1?this.outgoing.delete(e.sourceId):t.splice(r,1))}let n=this.incoming.get(e.targetId);if(n!==void 0){let r=n.indexOf(e);r>=0&&(n.length===1?this.incoming.delete(e.targetId):n.splice(r,1))}}}getAttachedElements(e){return new R1.FluentIterableImpl(()=>({outgoing:this.outgoing.get(e.id),incoming:this.incoming.get(e.id),nextOutgoingIndex:0,nextIncomingIndex:0}),t=>{let n=t.nextOutgoingIndex;if(t.outgoing!==void 0&&n<t.outgoing.length)return t.nextOutgoingIndex=n+1,{done:!1,value:t.outgoing[n]};if(n=t.nextIncomingIndex,t.incoming!==void 0)for(;n<t.incoming.length;){let r=t.incoming[n];if(r.sourceId!==r.targetId)return t.nextIncomingIndex=n+1,{done:!1,value:r};n++}return{done:!0,value:void 0}})}getIncomingEdges(e){return this.incoming.get(e.id)||[]}getOutgoingEdges(e){return this.outgoing.get(e.id)||[]}};it.SGraphIndex=Di});var oi=f(Ue=>{"use strict";var M1=Ue&&Ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},T1=Ue&&Ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},O1=Ue&&Ue.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.AnchorComputerRegistry=Ue.RECTANGULAR_ANCHOR_KIND=Ue.ELLIPTIC_ANCHOR_KIND=Ue.DIAMOND_ANCHOR_KIND=void 0;var gE=_(),A1=P(),C1=Rn();Ue.DIAMOND_ANCHOR_KIND="diamond";Ue.ELLIPTIC_ANCHOR_KIND="elliptic";Ue.RECTANGULAR_ANCHOR_KIND="rectangular";var ng=class extends C1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultAnchorKind(){return Ue.RECTANGULAR_ANCHOR_KIND}get(e,t){return super.get(`${e}:${t||this.defaultAnchorKind}`)}};ng=M1([(0,gE.injectable)(),O1(0,(0,gE.multiInject)(A1.TYPES.IAnchorComputer)),T1("design:paramtypes",[Array])],ng);Ue.AnchorComputerRegistry=ng});var Ma=f(Dt=>{"use strict";var _E=Dt&&Dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},x1=Dt&&Dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.AbstractEdgeRouter=Dt.DefaultAnchors=Dt.Side=void 0;var vE=_(),Vo=ee(),ig=ze(),wt=_e(),mE=oi(),yE=_e(),te;(function(i){i[i.RIGHT=0]="RIGHT",i[i.LEFT=1]="LEFT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM"})(te=Dt.Side||(Dt.Side={}));var Ra=class{constructor(e,t,n){this.element=e,this.kind=n;let r=e.bounds;this.bounds=(0,ig.translateBounds)(r,e.parent,t),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:n},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:n},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:n},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:n}}get(e){return this[te[e].toLowerCase()]}getNearestSide(e){let t=Vo.Point.euclideanDistance(e,this.left),n=Vo.Point.euclideanDistance(e,this.right),r=Vo.Point.euclideanDistance(e,this.top),o=Vo.Point.euclideanDistance(e,this.bottom),s=te.LEFT,a=t;return n<a&&(a=n,s=te.RIGHT),r<a&&(a=r,s=te.TOP),o<a&&(a=o,s=te.BOTTOM),s}};Dt.DefaultAnchors=Ra;var Fd=class{pointAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o,lambda:s}=n;return Vo.Point.linear(r,o,s)}derivativeAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o}=n;return{x:o.x-r.x,y:o.y-r.y}}calculateSegment(e,t){if(t<0||t>1)return;let n=this.route(e);if(n.length<2)return;let r=[],o=0;for(let c=0;c<n.length-1;++c)r[c]=Vo.Point.euclideanDistance(n[c],n[c+1]),o+=r[c];let s=0,a=t*o;for(let c=0;c<n.length-1;++c){let u=s+r[c];if(r[c]>1e-8&&u>=a){let d=Math.max(0,a-s)/r[c];return{segmentStart:n[c],segmentEnd:n[c+1],lambda:d}}s=u}return{segmentEnd:n.pop(),segmentStart:n.pop(),lambda:1}}addHandle(e,t,n,r){let o=new wt.SRoutingHandle;return o.kind=t,o.pointIndex=r,o.type=n,t==="target"&&e.id===wt.edgeInProgressID&&(o.id=wt.edgeInProgressTargetHandleID),e.add(o),o}getHandlePosition(e,t,n){switch(n.kind){case"source":return e.source instanceof wt.SDanglingAnchor?e.source.position:t[0];case"target":return e.target instanceof wt.SDanglingAnchor?e.target.position:t[t.length-1];default:let r=this.getInnerHandlePosition(e,t,n);if(r!==void 0)return r;if(n.pointIndex>=0&&n.pointIndex<e.routingPoints.length)return e.routingPoints[n.pointIndex]}}findRouteSegment(e,t,n){let r=a=>a.pointIndex!==void 0?a.pointIndex:a.kind==="target"?e.routingPoints.length:-2,o,s;for(let a of t){let c=r(a);c<=n&&(o===void 0||c>r(o))&&(o=a),c>n&&(s===void 0||c<r(s))&&(s=a)}return{start:o,end:s}}getTranslatedAnchor(e,t,n,r,o=0){let s=(0,ig.translatePoint)(t,n,e.parent),a=this.getAnchorComputer(e),c=.5*e.strokeWidth,u=a.getAnchor(e,s,o+c);return(0,ig.translatePoint)(u,e.parent,r.parent)}getAnchorComputer(e){return this.anchorRegistry.get(this.kind,e.anchorKind)}applyHandleMoves(e,t){let n=t.slice();t.forEach(r=>{let o=r.handle;if(o.kind==="source"&&!(e.source instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-source",s.original=e.source,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.sourceId=s.id}else if(o.kind==="target"&&!(e.target instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-target",s.original=e.target,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.targetId=s.id}o.danglingAnchor&&(o.danglingAnchor.position=r.toPosition,n.splice(n.indexOf(r),1))}),n.length>0&&this.applyInnerHandleMoves(e,n),this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)}cleanupRoutingPoints(e,t,n,r){let o=new Ra(e.source,e.parent,"source"),s=new Ra(e.target,e.parent,"target");this.resetRoutingPointsOnReconnect(e,t,n,o,s)}resetRoutingPointsOnReconnect(e,t,n,r,o){if(t.length===0||e.source instanceof wt.SDanglingAnchor||e.target instanceof wt.SDanglingAnchor){let s=this.getOptions(e),a=this.calculateDefaultCorners(e,r,o,s);if(t.splice(0,t.length,...a),n){let c=-2;e.children.forEach(u=>{u instanceof wt.SRoutingHandle&&(u.kind==="target"?u.pointIndex=t.length:u.kind==="line"&&u.pointIndex>=t.length?e.remove(u):c=Math.max(u.pointIndex,c))});for(let u=c;u<t.length-1;++u)this.addHandle(e,"manhattan-50%","volatile-routing-point",u)}return!0}return!1}applyReconnect(e,t,n){let r=!1;if(t){let o=e.root.index.getById(t);o instanceof yE.SConnectableElement&&(e.sourceId=o.id,r=!0)}if(n){let o=e.root.index.getById(n);o instanceof yE.SConnectableElement&&(e.targetId=o.id,r=!0)}r&&(e.index.remove(e),e.index.add(e),this.getSelfEdgeIndex(e)>-1&&(e.routingPoints=[],this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)))}takeSnapshot(e){return{routingPoints:e.routingPoints.slice(),routingHandles:e.children.filter(t=>t instanceof wt.SRoutingHandle).map(t=>t),routedPoints:this.route(e),router:this,source:e.source,target:e.target}}applySnapshot(e,t){e.routingPoints=t.routingPoints,e.removeAll(n=>n instanceof wt.SRoutingHandle),e.routerKind=t.router.kind,t.routingHandles.forEach(n=>e.add(n)),t.source&&(e.sourceId=t.source.id),t.target&&(e.targetId=t.target.id),e.root.index.remove(e),e.root.index.add(e)}calculateDefaultCorners(e,t,n,r){let o=this.getSelfEdgeIndex(e);if(o>=0){let s=r.standardDistance,a=r.selfEdgeOffset*Math.min(t.bounds.width,t.bounds.height);switch(o%4){case 0:return[{x:t.get(te.RIGHT).x+s,y:t.get(te.RIGHT).y+a},{x:t.get(te.RIGHT).x+s,y:t.get(te.BOTTOM).y+s},{x:t.get(te.BOTTOM).x+a,y:t.get(te.BOTTOM).y+s}];case 1:return[{x:t.get(te.BOTTOM).x-a,y:t.get(te.BOTTOM).y+s},{x:t.get(te.LEFT).x-s,y:t.get(te.BOTTOM).y+s},{x:t.get(te.LEFT).x-s,y:t.get(te.LEFT).y+a}];case 2:return[{x:t.get(te.LEFT).x-s,y:t.get(te.LEFT).y-a},{x:t.get(te.LEFT).x-s,y:t.get(te.TOP).y-s},{x:t.get(te.TOP).x-a,y:t.get(te.TOP).y-s}];case 3:return[{x:t.get(te.TOP).x+a,y:t.get(te.TOP).y-s},{x:t.get(te.RIGHT).x+s,y:t.get(te.TOP).y-s},{x:t.get(te.RIGHT).x+s,y:t.get(te.RIGHT).y-a}]}}return[]}getSelfEdgeIndex(e){return!e.source||e.source!==e.target?-1:e.source.outgoingEdges.filter(t=>t.target===e.source).indexOf(e)}commitRoute(e,t){let n=[];for(let r=1;r<t.length-1;++r)n.push({x:t[r].x,y:t[r].y});e.routingPoints=n}};_E([(0,vE.inject)(mE.AnchorComputerRegistry),x1("design:type",mE.AnchorComputerRegistry)],Fd.prototype,"anchorRegistry",void 0);Fd=_E([(0,vE.injectable)()],Fd);Dt.AbstractEdgeRouter=Fd});var Oa=f(ji=>{"use strict";var EE=ji&&ji.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},q1=ji&&ji.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},rg;Object.defineProperty(ji,"__esModule",{value:!0});ji.PolylineEdgeRouter=void 0;var wE=_(),Ko=ee(),bE=_e(),SE=oi(),D1=Ma(),Ta=rg=class extends D1.AbstractEdgeRouter{get kind(){return rg.KIND}getOptions(e){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(e){let t=e.source,n=e.target;if(t===void 0||n===void 0)return[];let r,o,s=this.getOptions(e),a=e.routingPoints.length>0?e.routingPoints:[];this.cleanupRoutingPoints(e,a,!1,!1);let c=a!==void 0?a.length:0;if(c===0){let d=Ko.Bounds.center(n.bounds);r=this.getTranslatedAnchor(t,d,n.parent,e,e.sourceAnchorCorrection);let l=Ko.Bounds.center(t.bounds);o=this.getTranslatedAnchor(n,l,t.parent,e,e.targetAnchorCorrection)}else{let d=a[0];r=this.getTranslatedAnchor(t,d,e.parent,e,e.sourceAnchorCorrection);let l=a[c-1];o=this.getTranslatedAnchor(n,l,e.parent,e,e.targetAnchorCorrection)}let u=[];u.push({kind:"source",x:r.x,y:r.y});for(let d=0;d<c;d++){let l=a[d];(d>0&&d<c-1||d===0&&Ko.Point.maxDistance(r,l)>=s.minimalPointDistance+(e.sourceAnchorCorrection||0)||d===c-1&&Ko.Point.maxDistance(l,o)>=s.minimalPointDistance+(e.targetAnchorCorrection||0))&&u.push({kind:"linear",x:l.x,y:l.y,pointIndex:d})}return u.push({kind:"target",x:o.x,y:o.y}),this.filterEditModeHandles(u,e,s)}filterEditModeHandles(e,t,n){if(t.children.length===0)return e;let r=0;for(;r<e.length;){let o=e[r];if(o.pointIndex!==void 0){let s=t.children.find(a=>a instanceof bE.SRoutingHandle&&a.kind==="junction"&&a.pointIndex===o.pointIndex);if(s!==void 0&&s.editMode&&r>0&&r<e.length-1){let a=e[r-1],c=e[r+1],u={x:a.x-o.x,y:a.y-o.y},d={x:c.x-o.x,y:c.y-o.y},l=(0,Ko.angleBetweenPoints)(u,d);if(Math.abs(Math.PI-l)<n.removeAngleThreshold){e.splice(r,1);continue}}}r++}return e}createRoutingHandles(e){let t=e.routingPoints.length;this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"line","volatile-routing-point",-1);for(let n=0;n<t;n++)this.addHandle(e,"junction","routing-point",n),this.addHandle(e,"line","volatile-routing-point",n);this.addHandle(e,"target","routing-point",t)}getInnerHandlePosition(e,t,n){if(n.kind==="line"){let{start:r,end:o}=this.findRouteSegment(e,t,n.pointIndex);if(r!==void 0&&o!==void 0)return(0,Ko.centerOfLine)(r,o)}}applyInnerHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o=e.routingPoints,s=r.pointIndex;r.kind==="line"&&(r.kind="junction",r.type="routing-point",o.splice(s+1,0,n.fromPosition||o[Math.max(s,0)]),e.children.forEach(a=>{a instanceof bE.SRoutingHandle&&(a===r||a.pointIndex>s)&&a.pointIndex++}),this.addHandle(e,"line","volatile-routing-point",s),s++,this.addHandle(e,"line","volatile-routing-point",s)),s>=0&&s<o.length&&(o[s]=n.toPosition)})}};Ta.KIND="polyline";EE([(0,wE.inject)(SE.AnchorComputerRegistry),q1("design:type",SE.AnchorComputerRegistry)],Ta.prototype,"anchorRegistry",void 0);Ta=rg=EE([(0,wE.injectable)()],Ta);ji.PolylineEdgeRouter=Ta});var pn=f(rn=>{"use strict";var PE=rn&&rn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},IE=rn&&rn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},j1=rn&&rn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(rn,"__esModule",{value:!0});rn.EdgeRouting=rn.EdgeRouterRegistry=void 0;var Vd=_(),N1=G(),RE=P(),L1=go(),B1=Rn(),F1=_e(),V1=Oa();function K1(i){return i.routeAll!==void 0}var Kd=class extends B1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultKind(){return V1.PolylineEdgeRouter.KIND}get(e){return super.get(e||this.defaultKind)}routeAllChildren(e){let t=this.doRouteAllChildren(e);for(let n of this.postProcessors)n.apply(t);return t}doRouteAllChildren(e){let t=new Hd,n=new Map,r=[e];for(;r.length>0;){let o=r.shift();for(let s of o.children){if(s instanceof F1.SRoutableElement){let a=s.routerKind||this.defaultKind;n.has(a)?n.get(a).push(s):n.set(a,[s])}s instanceof N1.SParentElement&&r.push(s)}}return n.forEach((o,s)=>{let a=this.get(s);if(K1(a))t.setAll(a.routeAll(o,e));else for(let c of o)t.set(c.id,this.route(c))}),t}route(e,t){let n=(0,L1.findArgValue)(t,"edgeRouting");if(n){let o=n.get(e.id);if(o)return o}return this.get(e.routerKind).route(e)}};PE([(0,Vd.multiInject)(RE.TYPES.IEdgeRoutePostprocessor),(0,Vd.optional)(),IE("design:type",Array)],Kd.prototype,"postProcessors",void 0);Kd=PE([(0,Vd.injectable)(),j1(0,(0,Vd.multiInject)(RE.TYPES.IEdgeRouter)),IE("design:paramtypes",[Array])],Kd);rn.EdgeRouterRegistry=Kd;var Hd=class{constructor(){this.routesMap=new Map}set(e,t){this.routesMap.set(e,t)}setAll(e){e.routes.forEach((t,n)=>this.set(n,t))}get(e){return this.routesMap.get(e)}get routes(){return this.routesMap}};rn.EdgeRouting=Hd});var og=f(Ni=>{"use strict";var OE=Ni&&Ni.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},H1=Ni&&Ni.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.EdgeLayoutPostprocessor=void 0;var AE=_(),rt=ee(),z1=G(),Y1=Be(),U1=Rr(),zd=ue(),ME=Bo(),TE=pn(),Yd=class{decorate(e,t){if((0,ME.isEdgeLayoutable)(t)&&t.parent instanceof U1.SEdge&&t.bounds!==rt.Bounds.EMPTY){let n=this.getEdgePlacement(t),r=t.parent,o=Math.min(1,Math.max(0,n.position)),s=this.edgeRouterRegistry.get(r.routerKind),a=s.pointAt(r,o),c=s.derivativeAt(r,o),u="";if(a&&c){u+=`translate(${a.x}, ${a.y})`;let d=(0,rt.toDegrees)(Math.atan2(c.y,c.x));if(n.rotate){let l=d;Math.abs(d)>90&&(d<0?l+=180:d>0&&(l-=180)),u+=` rotate(${l})`;let S=this.getRotatedAlignment(t,n,l!==d);u+=` translate(${S.x}, ${S.y})`}else{let l=this.getAlignment(t,n,d);u+=` translate(${l.x}, ${l.y})`}(0,Y1.setAttr)(e,"transform",u)}}return e}getRotatedAlignment(e,t,n){let r=(0,zd.isAlignable)(e)?e.alignment.x:0,o=(0,zd.isAlignable)(e)?e.alignment.y:0,s=e.bounds;if(t.side==="on")return{x:r-.5*s.height,y:o-.5*s.height};if(n)switch(t.position<.3333333?r-=s.width+t.offset:t.position<.6666666?r-=.5*s.width:r+=t.offset,t.side){case"left":case"bottom":o-=t.offset+s.height;break;case"right":case"top":o+=t.offset}else switch(t.position<.3333333?r+=t.offset:t.position<.6666666?r-=.5*s.width:r-=s.width+t.offset,t.side){case"right":case"bottom":o+=-t.offset-s.height;break;case"left":case"top":o+=t.offset}return{x:r,y:o}}getEdgePlacement(e){let t=e,n=[];for(;t!==void 0;){let r=t.edgePlacement;if(r!==void 0&&n.push(r),t instanceof z1.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>Object.assign(Object.assign({},r),o),ME.DEFAULT_EDGE_PLACEMENT)}getAlignment(e,t,n){let r=e.bounds,o=(0,zd.isAlignable)(e)?e.alignment.x-r.width:0,s=(0,zd.isAlignable)(e)?e.alignment.y-r.height:0;if(t.side==="on")return{x:o+.5*r.height,y:s+.5*r.height};let a=this.getQuadrant(n),c={x:t.offset,y:s+.5*r.height},u={x:t.offset,y:s+r.height+t.offset},d={x:-r.width-t.offset,y:s+r.height+t.offset},l={x:-r.width-t.offset,y:s+.5*r.height},S={x:-r.width-t.offset,y:s-t.offset},R={x:t.offset,y:s-t.offset};switch(t.side){case"left":switch(a.orientation){case"west":return rt.Point.linear(u,d,a.position);case"north":return rt.Point.linear(d,S,a.position);case"east":return rt.Point.linear(S,R,a.position);case"south":return rt.Point.linear(R,u,a.position)}break;case"right":switch(a.orientation){case"west":return rt.Point.linear(S,R,a.position);case"north":return rt.Point.linear(R,u,a.position);case"east":return rt.Point.linear(u,d,a.position);case"south":return rt.Point.linear(d,S,a.position)}break;case"top":switch(a.orientation){case"west":return rt.Point.linear(S,R,a.position);case"north":return this.linearFlip(R,c,l,S,a.position);case"east":return rt.Point.linear(S,R,a.position);case"south":return this.linearFlip(R,c,l,S,a.position)}break;case"bottom":switch(a.orientation){case"west":return rt.Point.linear(u,d,a.position);case"north":return this.linearFlip(d,l,c,u,a.position);case"east":return rt.Point.linear(u,d,a.position);case"south":return this.linearFlip(d,l,c,u,a.position)}break}return{x:0,y:0}}getQuadrant(e){return Math.abs(e)>135?{orientation:"west",position:(e>0?e-135:e+225)/90}:e<-45?{orientation:"north",position:(e+135)/90}:e<45?{orientation:"east",position:(e+45)/90}:{orientation:"south",position:(e-45)/90}}linearFlip(e,t,n,r,o){return o<.5?rt.Point.linear(e,t,2*o):rt.Point.linear(n,r,2*o-1)}postUpdate(){}};OE([(0,AE.inject)(TE.EdgeRouterRegistry),H1("design:type",TE.EdgeRouterRegistry)],Yd.prototype,"edgeRouterRegistry",void 0);Yd=OE([(0,AE.injectable)()],Yd);Ni.EdgeLayoutPostprocessor=Yd});var Ud=f(ag=>{"use strict";Object.defineProperty(ag,"__esModule",{value:!0});var k1=_(),CE=P(),sg=og(),G1=new k1.ContainerModule(i=>{i(sg.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),i(CE.TYPES.IVNodePostprocessor).toService(sg.EdgeLayoutPostprocessor),i(CE.TYPES.HiddenVNodePostprocessor).toService(sg.EdgeLayoutPostprocessor)});ag.default=G1});var DE=f(jt=>{"use strict";var $1=jt&&jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},W1=jt&&jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},X1=jt&&jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.CreateElementCommand=jt.CreateElementAction=void 0;var xE=_(),J1=me(),Z1=G(),Q1=P(),qE;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(qE=jt.CreateElementAction||(jt.CreateElementAction={}));var kd=class extends J1.Command{constructor(e){super(),this.action=e}execute(e){let t=e.root.index.getById(this.action.containerId);return t instanceof Z1.SParentElement&&(this.container=t,this.newElement=e.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),e.root}undo(e){return this.container.remove(this.newElement),e.root}redo(e){return this.container.add(this.newElement),e.root}};kd.KIND=qE.KIND;kd=$1([(0,xE.injectable)(),X1(0,(0,xE.inject)(Q1.TYPES.Action)),W1("design:paramtypes",[Object])],kd);jt.CreateElementCommand=kd});var cg=f(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.isCreatingOnDrag=Mr.creatingOnDragFeature=void 0;Mr.creatingOnDragFeature=Symbol("creatingOnDragFeature");function eq(i){return i.hasFeature(Mr.creatingOnDragFeature)&&i.createAction!==void 0}Mr.isCreatingOnDrag=eq});var Or=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.intersection=M.PointToPointLine=M.Diamond=M.linear=M.almostEquals=M.toRadians=M.toDegrees=M.magnitude=M.normalize=M.shiftTowards=M.angleBetweenPoints=M.angleOfPoint=M.maxDistance=M.manhattanDistance=M.euclideanDistance=M.Direction=M.includes=M.centerOfLine=M.center=M.translate=M.combine=M.isBounds=M.EMPTY_BOUNDS=M.isValidDimension=M.EMPTY_DIMENSION=M.pointEquals=M.subtract=M.add=M.ORIGIN_POINT=void 0;M.ORIGIN_POINT=Object.freeze({x:0,y:0});function jE(i,e){return{x:i.x+e.x,y:i.y+e.y}}M.add=jE;function NE(i,e){return{x:i.x-e.x,y:i.y-e.y}}M.subtract=NE;function Aa(i,e){return i.x===e.x&&i.y===e.y}M.pointEquals=Aa;M.EMPTY_DIMENSION=Object.freeze({width:-1,height:-1});function Gd(i){return i.width>=0&&i.height>=0}M.isValidDimension=Gd;M.EMPTY_BOUNDS=Object.freeze({x:0,y:0,width:-1,height:-1});function tq(i){return"x"in i&&"y"in i&&"width"in i&&"height"in i}M.isBounds=tq;function nq(i,e){if(!Gd(i))return Gd(e)?e:M.EMPTY_BOUNDS;if(!Gd(e))return i;let t=Math.min(i.x,e.x),n=Math.min(i.y,e.y),r=Math.max(i.x+(i.width>=0?i.width:0),e.x+(e.width>=0?e.width:0)),o=Math.max(i.y+(i.height>=0?i.height:0),e.y+(e.height>=0?e.height:0));return{x:t,y:n,width:r-t,height:o-n}}M.combine=nq;function iq(i,e){return{x:i.x+e.x,y:i.y+e.y,width:i.width,height:i.height}}M.translate=iq;function dg(i){return{x:i.x+(i.width>=0?.5*i.width:0),y:i.y+(i.height>=0?.5*i.height:0)}}M.center=dg;function rq(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return dg(t)}M.centerOfLine=rq;function oq(i,e){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}M.includes=oq;var sq;(function(i){i[i.left=0]="left",i[i.right=1]="right",i[i.up=2]="up",i[i.down=3]="down"})(sq=M.Direction||(M.Direction={}));function aq(i,e){let t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}M.euclideanDistance=aq;function cq(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}M.manhattanDistance=cq;function uq(i,e){return Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y))}M.maxDistance=uq;function dq(i){return Math.atan2(i.y,i.x)}M.angleOfPoint=dq;function lq(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}M.angleBetweenPoints=lq;function fq(i,e,t){let n=NE(e,i),r=LE(n),o={x:r.x*t,y:r.y*t};return jE(i,o)}M.shiftTowards=fq;function LE(i){let e=BE(i);return e===0||e===1?M.ORIGIN_POINT:{x:i.x/e,y:i.y/e}}M.normalize=LE;function BE(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}M.magnitude=BE;function FE(i){return i*180/Math.PI}M.toDegrees=FE;function hq(i){return i*Math.PI/180}M.toRadians=hq;function pq(i,e){return Math.abs(i-e)<.001}M.almostEquals=pq;function gq(i,e,t){return{x:(1-t)*i.x+t*e.x,y:(1-t)*i.y+t*e.y}}M.linear=gq;var ug=class{constructor(e){this.bounds=e}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new Tr(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new Tr(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new Tr(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new Tr(this.bottomPoint,this.leftPoint)}closestSideLine(e){let t=dg(this.bounds);return e.x>t.x?e.y>t.y?this.bottomRightSideLine:this.topRightSideLine:e.y>t.y?this.bottomLeftSideLine:this.topLeftSideLine}};M.Diamond=ug;var Tr=class{constructor(e,t){this.p1=e,this.p2=t}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){let e=FE(this.angle),t=e<0?360+e:e;if(t===90)return"south";if(t===0||t===360)return"east";if(t===270)return"north";if(t===180)return"west";if(t>0&&t<90)return"south-east";if(t>90&&t<180)return"south-west";if(t>180&&t<270)return"north-west";if(t>270&&t<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(e){if(this.hasIndistinctPoints(e))return;let t=this.p1.x,n=this.p1.y,r=this.p2.x,o=this.p2.y,s=e.p1.x,a=e.p1.y,c=e.p2.x,u=e.p2.y,d=(u-a)*(r-t)-(c-s)*(o-n);if(d===0)return;let l=(c-s)*(n-a)-(u-a)*(t-s),S=(r-t)*(n-a)-(o-n)*(t-s);if(l===0&&S===0)return;let R=l/d,v=S/d;if(R<0||R>1||v<0||v>1)return;let m=t+R*(r-t),T=n+R*(o-n);return{x:m,y:T}}hasIndistinctPoints(e){return Aa(this.p1,e.p1)||Aa(this.p1,e.p2)||Aa(this.p2,e.p1)||Aa(this.p2,e.p2)}};M.PointToPointLine=Tr;function mq(i,e){return{x:(i.c*e.b-e.c*i.b)/(i.a*e.b-e.a*i.b),y:(i.a*e.c-e.a*i.c)/(i.a*e.b-e.a*i.b)}}M.intersection=mq});var yg=f(Pt=>{"use strict";var Ca=Pt&&Pt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.EmptyGroupView=Pt.DiamondNodeView=Pt.RectangularNodeView=Pt.CircularNodeView=Pt.SvgViewportView=void 0;var si=Wt(),Ho=Rr(),mg=ma(),yq=Or(),xa=_(),lg=class{render(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,si.svg)("svg",null,(0,si.svg)("g",{transform:r},t.renderChildren(e)))}};lg=Ca([(0,xa.injectable)()],lg);Pt.SvgViewportView=lg;var fg=class extends mg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=this.getRadius(e);return(0,si.svg)("g",null,(0,si.svg)("circle",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r,cx:r,cy:r}),t.renderChildren(e))}getRadius(e){let t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};fg=Ca([(0,xa.injectable)()],fg);Pt.CircularNodeView=fg;var hg=class extends mg.ShapeView{render(e,t,n){if(this.isVisible(e,t))return(0,si.svg)("g",null,(0,si.svg)("rect",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};hg=Ca([(0,xa.injectable)()],hg);Pt.RectangularNodeView=hg;var pg=class extends mg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=new yq.Diamond({height:Math.max(e.size.height,0),width:Math.max(e.size.width,0),x:0,y:0}),o=`${$d(r.topPoint)} ${$d(r.rightPoint)} ${$d(r.bottomPoint)} ${$d(r.leftPoint)}`;return(0,si.svg)("g",null,(0,si.svg)("polygon",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,points:o}),t.renderChildren(e))}};pg=Ca([(0,xa.injectable)()],pg);Pt.DiamondNodeView=pg;function $d(i){return`${i.x},${i.y}`}var gg=class{render(e,t){return(0,si.svg)("g",null)}};gg=Ca([(0,xa.injectable)()],gg);Pt.EmptyGroupView=gg});var Jd=f(oe=>{"use strict";var _q=oe&&oe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vq=oe&&oe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},bq=oe&&oe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(oe,"__esModule",{value:!0});oe.getEditableLabel=oe.EditLabelKeyListener=oe.EditLabelMouseListener=oe.ApplyLabelEditCommand=oe.ResolvedLabelEdit=oe.isApplyLabelEditAction=oe.ApplyLabelEditAction=oe.isEditLabelAction=oe.EditLabelAction=void 0;var Sq=_(),VE=ie(),Eq=me(),wq=P(),Pq=At(),Iq=un(),Rq=On(),Mq=Et(),Tq=or(),_g=Fo(),Xd;(function(i){i.KIND="EditLabel";function e(t){return{kind:i.KIND,labelId:t}}i.create=e})(Xd=oe.EditLabelAction||(oe.EditLabelAction={}));function Oq(i){return(0,VE.isAction)(i)&&i.kind===Xd.KIND&&"labelId"in i}oe.isEditLabelAction=Oq;var Eg;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(Eg=oe.ApplyLabelEditAction||(oe.ApplyLabelEditAction={}));function Aq(i){return(0,VE.isAction)(i)&&i.kind===Eg.KIND&&"labelId"in i&&"text"in i}oe.isApplyLabelEditAction=Aq;var vg=class{};oe.ResolvedLabelEdit=vg;var Wd=class extends Eq.Command{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.labelId);return n&&(0,_g.isEditableLabel)(n)&&(this.resolvedLabelEdit={label:n,oldLabel:n.text,newLabel:this.action.text},n.text=this.action.text),e.root}undo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),e.root}redo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),e.root}};Wd.KIND=Eg.KIND;Wd=_q([bq(0,(0,Sq.inject)(wq.TYPES.Action)),vq("design:paramtypes",[Object])],Wd);oe.ApplyLabelEditCommand=Wd;var bg=class extends Pq.MouseListener{doubleClick(e,t){let n=wg(e);return n?[Xd.create(n.id)]:[]}};oe.EditLabelMouseListener=bg;var Sg=class extends Iq.KeyListener{keyDown(e,t){if((0,Rq.matchesKeystroke)(t,"F2")){let n=(0,Tq.toArray)(e.index.all().filter(r=>(0,Mq.isSelectable)(r)&&r.selected)).map(wg).filter(r=>r!==void 0);if(n.length===1)return[Xd.create(n[0].id)]}return[]}};oe.EditLabelKeyListener=Sg;function wg(i){if((0,_g.isEditableLabel)(i))return i;if((0,_g.isWithEditableLabel)(i)&&i.editableLabel)return i.editableLabel}oe.getEditableLabel=wg});var Ar=f(gn=>{"use strict";var Zd=gn&&gn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Pg=gn&&gn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(gn,"__esModule",{value:!0});gn.SvgExporter=gn.ExportSvgAction=void 0;var Qd=_(),KE=ee(),Cq=ue(),xq=pu(),Ig=P(),HE;(function(i){i.KIND="exportSvg";function e(t,n){return{kind:i.KIND,svg:t,responseId:n}}i.create=e})(HE=gn.ExportSvgAction||(gn.ExportSvgAction={}));var zo=class{export(e,t){if(typeof document<"u"){let n=document.getElementById(this.options.hiddenDiv);if(n!==null&&n.firstElementChild&&n.firstElementChild.tagName==="svg"){let r=n.firstElementChild,o=this.createSvg(r,e);this.actionDispatcher.dispatch(HE.create(o,t?t.requestId:""))}}}createSvg(e,t){let n=new XMLSerializer,r=n.serializeToString(e),o=document.createElement("iframe");if(document.body.appendChild(o),!o.contentWindow)throw new Error("IFrame has no contentWindow");let s=o.contentWindow.document;s.open(),s.write(r),s.close();let a=s.getElementById(e.id);a.removeAttribute("opacity"),this.copyStyles(e,a,["width","height","opacity"]),a.setAttribute("version","1.1");let c=this.getBounds(t);a.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`);let u=n.serializeToString(a);return document.body.removeChild(o),u}copyStyles(e,t,n){let r=getComputedStyle(e),o=getComputedStyle(t),s="";for(let a=0;a<r.length;a++){let c=r[a];if(n.indexOf(c)===-1){let u=r.getPropertyValue(c);o.getPropertyValue(c)!==u&&(s+=c+":"+u+";")}}s!==""&&t.setAttribute("style",s);for(let a=0;a<e.childNodes.length;++a){let c=e.childNodes[a],u=t.childNodes[a];c instanceof Element&&this.copyStyles(c,u,[])}}getBounds(e){let t=[KE.Bounds.EMPTY];return e.children.forEach(n=>{(0,Cq.isBoundsAware)(n)&&t.push(n.bounds)}),t.reduce((n,r)=>KE.Bounds.combine(n,r))}};Zd([(0,Qd.inject)(Ig.TYPES.ViewerOptions),Pg("design:type",Object)],zo.prototype,"options",void 0);Zd([(0,Qd.inject)(Ig.TYPES.IActionDispatcher),Pg("design:type",xq.ActionDispatcher)],zo.prototype,"actionDispatcher",void 0);Zd([(0,Qd.inject)(Ig.TYPES.ILogger),Pg("design:type",Object)],zo.prototype,"log",void 0);zo=Zd([(0,Qd.injectable)()],zo);gn.SvgExporter=zo});var Yo=f(jn=>{"use strict";var el=jn&&jn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},zE=jn&&jn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(jn,"__esModule",{value:!0});jn.ComputedBoundsApplicator=jn.ModelSource=void 0;var tl=_(),qq=ie(),Dq=Pi(),YE=P(),jq=Ar(),qa=class{initialize(e){e.register(qq.RequestModelAction.KIND,this),e.register(jq.ExportSvgAction.KIND,this)}};el([(0,tl.inject)(YE.TYPES.IActionDispatcher),zE("design:type",Object)],qa.prototype,"actionDispatcher",void 0);el([(0,tl.inject)(YE.TYPES.ViewerOptions),zE("design:type",Object)],qa.prototype,"viewerOptions",void 0);qa=el([(0,tl.injectable)()],qa);jn.ModelSource=qa;var Rg=class{apply(e,t){let n=new Dq.SModelIndex;n.add(e);for(let r of t.bounds){let o=n.getById(r.elementId);o!==void 0&&this.applyBounds(o,r.newPosition,r.newSize)}if(t.alignments!==void 0)for(let r of t.alignments){let o=n.getById(r.elementId);o!==void 0&&this.applyAlignment(o,r.newAlignment)}return n}applyAlignment(e,t){let n=e;n.alignment={x:t.x,y:t.y}}applyBounds(e,t,n){let r=e;t&&(r.position=Object.assign({},t)),r.size=Object.assign({},n)}};Rg=el([(0,tl.injectable)()],Rg);jn.ComputedBoundsApplicator=Rg});var ja=f(Nt=>{"use strict";var UE=Nt&&Nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},kE=Nt&&Nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Nq=Nt&&Nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.CommitModelCommand=Nt.CommitModelAction=void 0;var Mg=_(),Lq=me(),GE=P(),Bq=Yo(),$E;(function(i){i.KIND="commitModel";function e(){return{kind:i.KIND}}i.create=e})($E=Nt.CommitModelAction||(Nt.CommitModelAction={}));var Da=class extends Lq.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newModel=e.modelFactory.createSchema(e.root),this.doCommit(this.newModel,e.root,!0)}doCommit(e,t,n){let r=this.modelSource.commitModel(e);return r instanceof Promise?r.then(o=>(n&&(this.originalModel=o),t)):(n&&(this.originalModel=r),t)}undo(e){return this.doCommit(this.originalModel,e.root,!1)}redo(e){return this.doCommit(this.newModel,e.root,!1)}};Da.KIND=$E.KIND;UE([(0,Mg.inject)(GE.TYPES.ModelSource),kE("design:type",Bq.ModelSource)],Da.prototype,"modelSource",void 0);Da=UE([(0,Mg.injectable)(),Nq(0,(0,Mg.inject)(GE.TYPES.Action)),kE("design:paramtypes",[Object])],Da);Nt.CommitModelCommand=Da});var nl=f(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.ZoomMouseListener=Li.getZoom=Li.isZoomable=void 0;var Fq=ie(),Vq=Tn(),Kq=At(),WE=ze(),XE=qn();function Hq(i){return"zoom"in i}Li.isZoomable=Hq;function zq(i){let e=1,t=(0,WE.findParentByFeature)(i,XE.isViewport);return t&&(e=t.zoom),e}Li.getZoom=zq;var Tg=class extends Kq.MouseListener{wheel(e,t){let n=(0,WE.findParentByFeature)(e,XE.isViewport);if(n){let r=this.getZoomFactor(t),o=this.getViewportOffset(e.root,t),s=1/(r*n.zoom)-1/n.zoom,a={scroll:{x:n.scroll.x-s*o.x,y:n.scroll.y-s*o.y},zoom:n.zoom*r};return[Fq.SetViewportAction.create(n.id,a,{animate:!1})]}return[]}getViewportOffset(e,t){let n=e.canvasBounds,r=(0,Vq.getWindowScroll)();return{x:t.clientX+r.x-n.x,y:t.clientY+r.y-n.y}}getZoomFactor(e){return e.deltaMode===e.DOM_DELTA_PAGE?Math.exp(-e.deltaY*.5):e.deltaMode===e.DOM_DELTA_LINE?Math.exp(-e.deltaY*.05):Math.exp(-e.deltaY*.005)}};Li.ZoomMouseListener=Tg});var Cg=f(Ln=>{"use strict";var Cr=Ln&&Ln.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Na=Ln&&Ln.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Og;Object.defineProperty(Ln,"__esModule",{value:!0});Ln.EditLabelUI=Ln.EditLabelActionHandler=void 0;var ai=_(),Yq=ie(),La=P(),Uq=Lu(),kq=Qs(),Gq=lo(),$q=ja(),JE=On(),Wq=ue(),ZE=nl(),Xq=Jd(),Jq=Fo(),Ag=class{handle(e){if((0,Xq.isEditLabelAction)(e))return kq.SetUIExtensionVisibilityAction.create({extensionId:Nn.ID,visible:!0,contextElementsId:[e.labelId]})}};Ag=Cr([(0,ai.injectable)()],Ag);Ln.EditLabelActionHandler=Ag;var Nn=Og=class extends Uq.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return Og.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(t=>{t.onkeydown=n=>this.applyLabelEditOnEvent(n,"Enter"),this.configureAndAdd(t,e)})}configureAndAdd(e,t){e.style.visibility="hidden",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.addEventListener("keydown",n=>this.hideIfEscapeEvent(n)),e.addEventListener("keyup",n=>this.validateLabelIfContentChange(n,e.value)),e.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),t.appendChild(e)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(e){(0,JE.matchesKeystroke)(e,"Escape")&&this.hide()}applyLabelEditOnEvent(e,t,...n){(0,JE.matchesKeystroke)(e,t||"Enter",...n)&&(e.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(e,t){(this.previousLabelContent===void 0||this.previousLabelContent!==t)&&(this.previousLabelContent=t,this.performLabelValidation(e,this.editControl.value))}async applyLabelEdit(){var e;if(this.isActive){if(((e=this.label)===null||e===void 0?void 0:e.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(t=>t.dispatchAll([Yq.ApplyLabelEditAction.create(this.labelId,this.editControl.value),$q.CommitModelAction.create()])).catch(t=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",t)),this.hide()}}performLabelValidation(e,t){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(t),200)}async validateLabel(e){if(this.labelValidator&&this.label)try{let t=await this.labelValidator.validate(e,this.label);return this.isCurrentLabelValid=t.severity!=="error",this.showValidationResult(t),t}catch(t){this.logger.error(this,"Error validating edited label",t)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(e){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,e)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(e,...t){!Zq(t,e)||this.isActive||(super.show(e,...t),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(e,t,...n){this.label=QE(n,t)[0],this.previousLabelContent=this.label.text,this.setPosition(e),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(e){let t=0,n=0,r=100,o=20;if(this.label){let s=(0,ZE.getZoom)(this.label),a=(0,Wq.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);t=a.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*s,n=a.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*s,o=(this.label.editControlDimension?this.label.editControlDimension.height:o)*s,r=(this.label.editControlDimension?this.label.editControlDimension.width:r)*s}e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=`${r}px`,this.editControl.style.width=`${r}px`,e.style.height=`${o}px`,this.editControl.style.height=`${o}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";let e=window.getComputedStyle(this.labelElement);this.editControl.style.font=e.font,this.editControl.style.fontStyle=e.fontStyle,this.editControl.style.fontFamily=e.fontFamily,this.editControl.style.fontSize=Qq(e.fontSize,(0,ZE.getZoom)(this.label)),this.editControl.style.fontWeight=e.fontWeight,this.editControl.style.lineHeight=e.lineHeight}}};Nn.ID="editLabelUi";Cr([(0,ai.inject)(La.TYPES.IActionDispatcherProvider),Na("design:type",Function)],Nn.prototype,"actionDispatcherProvider",void 0);Cr([(0,ai.inject)(La.TYPES.ViewerOptions),Na("design:type",Object)],Nn.prototype,"viewerOptions",void 0);Cr([(0,ai.inject)(La.TYPES.DOMHelper),Na("design:type",Gq.DOMHelper)],Nn.prototype,"domHelper",void 0);Cr([(0,ai.inject)(La.TYPES.IEditLabelValidator),(0,ai.optional)(),Na("design:type",Object)],Nn.prototype,"labelValidator",void 0);Cr([(0,ai.inject)(La.TYPES.IEditLabelValidationDecorator),(0,ai.optional)(),Na("design:type",Object)],Nn.prototype,"validationDecorator",void 0);Nn=Og=Cr([(0,ai.injectable)()],Nn);Ln.EditLabelUI=Nn;function Zq(i,e){return QE(i,e).length===1}function QE(i,e){return i.map(t=>e.index.getById(t)).filter(Jq.isEditableLabel)}function Qq(i,e){return i.replace(/([0-9]+)/,t=>String(Number.parseInt(t,10)*e))}});var Fa=f(Lt=>{"use strict";var n0=Lt&&Lt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},i0=Lt&&Lt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},eD=Lt&&Lt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.SwitchEditModeCommand=Lt.SwitchEditModeAction=void 0;var xg=_(),tD=me(),nD=G(),iD=P(),mn=_e(),e0=pn(),t0=Fo(),r0;(function(i){i.KIND="switchEditMode";function e(t){var n,r;return{kind:i.KIND,elementsToActivate:(n=t.elementsToActivate)!==null&&n!==void 0?n:[],elementsToDeactivate:(r=t.elementsToDeactivate)!==null&&r!==void 0?r:[]}}i.create=e})(r0=Lt.SwitchEditModeAction||(Lt.SwitchEditModeAction={}));var Ba=class extends tD.Command{constructor(e){super(),this.action=e,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(e){let t=e.root.index;return this.action.elementsToActivate.forEach(n=>{let r=t.getById(n);r!==void 0&&this.elementsToActivate.push(r)}),this.action.elementsToDeactivate.forEach(n=>{let r=t.getById(n);if(r!==void 0&&this.elementsToDeactivate.push(r),r instanceof mn.SRoutingHandle&&r.parent instanceof mn.SRoutableElement){let o=r.parent;this.shouldRemoveHandle(r,o)&&(this.handlesToRemove.push({handle:r,parent:o}),this.elementsToDeactivate.push(o),this.elementsToActivate.push(o))}}),this.doExecute(e)}doExecute(e){return this.handlesToRemove.forEach(t=>{t.point=t.parent.routingPoints.splice(t.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(t=>{t instanceof mn.SRoutableElement?t.removeAll(n=>n instanceof mn.SRoutingHandle):t instanceof mn.SRoutingHandle&&(t.editMode=!1,t.danglingAnchor&&t.parent instanceof mn.SRoutableElement&&t.danglingAnchor.original&&(t.parent.source===t.danglingAnchor?t.parent.sourceId=t.danglingAnchor.original.id:t.parent.target===t.danglingAnchor&&(t.parent.targetId=t.danglingAnchor.original.id),t.danglingAnchor.parent.remove(t.danglingAnchor),t.danglingAnchor=void 0))}),this.elementsToActivate.forEach(t=>{(0,t0.canEditRouting)(t)&&t instanceof nD.SParentElement?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof mn.SRoutingHandle&&(t.editMode=!0)}),e.root}shouldRemoveHandle(e,t){return e.kind==="junction"?this.edgeRouterRegistry.route(t).find(r=>r.pointIndex===e.pointIndex)===void 0:!1}undo(e){return this.handlesToRemove.forEach(t=>{t.point!==void 0&&t.parent.routingPoints.splice(t.handle.pointIndex,0,t.point)}),this.elementsToActivate.forEach(t=>{t instanceof mn.SRoutableElement?t.removeAll(n=>n instanceof mn.SRoutingHandle):t instanceof mn.SRoutingHandle&&(t.editMode=!1)}),this.elementsToDeactivate.forEach(t=>{(0,t0.canEditRouting)(t)?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof mn.SRoutingHandle&&(t.editMode=!0)}),e.root}redo(e){return this.doExecute(e)}};Ba.KIND=r0.KIND;n0([(0,xg.inject)(e0.EdgeRouterRegistry),i0("design:type",e0.EdgeRouterRegistry)],Ba.prototype,"edgeRouterRegistry",void 0);Ba=n0([(0,xg.injectable)(),eD(0,(0,xg.inject)(iD.TYPES.Action)),i0("design:paramtypes",[Object])],Ba);Lt.SwitchEditModeCommand=Ba});var il=f(Bt=>{"use strict";var s0=Bt&&Bt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},a0=Bt&&Bt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},rD=Bt&&Bt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.ReconnectCommand=Bt.ReconnectAction=void 0;var qg=_(),oD=me(),sD=P(),aD=_e(),o0=pn(),c0;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(c0=Bt.ReconnectAction||(Bt.ReconnectAction={}));var Va=class extends oD.Command{constructor(e){super(),this.action=e}execute(e){return this.doExecute(e),e.root}doExecute(e){let n=e.root.index.getById(this.action.routableId);if(n instanceof aD.SRoutableElement){let r=this.edgeRouterRegistry.get(n.routerKind),o=r.takeSnapshot(n);r.applyReconnect(n,this.action.newSourceId,this.action.newTargetId);let s=r.takeSnapshot(n);this.memento={edge:n,before:o,after:s}}}undo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),e.root}redo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),e.root}};Va.KIND=c0.KIND;s0([(0,qg.inject)(o0.EdgeRouterRegistry),a0("design:type",o0.EdgeRouterRegistry)],Va.prototype,"edgeRouterRegistry",void 0);Va=s0([(0,qg.injectable)(),rD(0,(0,qg.inject)(sD.TYPES.Action)),a0("design:paramtypes",[Object])],Va);Bt.ReconnectCommand=Va});var Lg=f(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.labelEditUiModule=Bi.labelEditModule=Bi.edgeEditModule=void 0;var Ng=_(),jg=P(),rl=yt(),cD=Us(),uD=go(),dD=_e(),lD=yg(),fD=No(),Uo=Jd(),Dg=Cg(),hD=Fa(),pD=il();Bi.edgeEditModule=new Ng.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,rl.configureCommand)(n,hD.SwitchEditModeCommand),(0,rl.configureCommand)(n,pD.ReconnectCommand),(0,rl.configureCommand)(n,fD.DeleteElementCommand),(0,uD.configureModelElement)(n,"dangling-anchor",dD.SDanglingAnchor,lD.EmptyGroupView)});Bi.labelEditModule=new Ng.ContainerModule((i,e,t)=>{i(Uo.EditLabelMouseListener).toSelf().inSingletonScope(),i(jg.TYPES.MouseListener).toService(Uo.EditLabelMouseListener),i(Uo.EditLabelKeyListener).toSelf().inSingletonScope(),i(jg.TYPES.KeyListener).toService(Uo.EditLabelKeyListener),(0,rl.configureCommand)({bind:i,isBound:t},Uo.ApplyLabelEditCommand)});Bi.labelEditUiModule=new Ng.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,cD.configureActionHandler)(n,Uo.EditLabelAction.KIND,Dg.EditLabelActionHandler),i(Dg.EditLabelUI).toSelf().inSingletonScope(),i(jg.TYPES.IUIExtension).toService(Dg.EditLabelUI)})});var ol=f(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.isExpandable=xr.expandFeature=void 0;xr.expandFeature=Symbol("expandFeature");function gD(i){return i.hasFeature(xr.expandFeature)&&"expanded"in i}xr.isExpandable=gD});var Bg=f(Bn=>{"use strict";var mD=Bn&&Bn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.ExpandButtonHandler=Bn.CollapseExpandAllAction=Bn.CollapseExpandAction=void 0;var yD=_(),_D=ie(),vD=ze(),bD=ol(),ko=class{constructor(e,t){this.expandIds=e,this.collapseIds=t,this.kind=ko.KIND}};Bn.CollapseExpandAction=ko;ko.KIND="collapseExpand";var Go=class{constructor(e=!0){this.expand=e,this.kind=Go.KIND}};Bn.CollapseExpandAllAction=Go;Go.KIND="collapseExpandAll";var sl=class{buttonPressed(e){let t=(0,vD.findParentByFeature)(e,bD.isExpandable);return t!==void 0?[_D.CollapseExpandAction.create({expandIds:t.expanded?[]:[t.id],collapseIds:t.expanded?[t.id]:[]})]:[]}};sl.TYPE="button:expand";sl=mD([(0,yD.injectable)()],sl);Bn.ExpandButtonHandler=sl});var u0=f($o=>{"use strict";var SD=$o&&$o.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty($o,"__esModule",{value:!0});$o.ExpandButtonView=void 0;var Fg=Wt(),ED=ol(),wD=ze(),PD=_(),Vg=class{render(e,t){let n=(0,wD.findParentByFeature)(e,ED.isExpandable),r=n!==void 0&&n.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,Fg.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,Fg.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,Fg.svg)("path",{d:r}))}};Vg=SD([(0,PD.injectable)()],Vg);$o.ExpandButtonView=Vg});var Hg=f(ke=>{"use strict";var ul=ke&&ke.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},l0=ke&&ke.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ID=ke&&ke.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ke,"__esModule",{value:!0});ke.ExportSvgPostprocessor=ke.ExportSvgCommand=ke.RequestExportSvgAction=ke.ExportSvgKeyListener=void 0;var dl=_(),RD=ie(),MD=me(),TD=Et(),OD=G(),AD=un(),CD=On(),d0=Cd(),xD=Ar(),qD=qn(),DD=wr(),f0=P(),Kg=class extends AD.KeyListener{keyDown(e,t){return(0,CD.matchesKeystroke)(t,"KeyE","ctrlCmd","shift")?[ll.create()]:[]}};Kg=ul([(0,dl.injectable)()],Kg);ke.ExportSvgKeyListener=Kg;var ll;(function(i){i.KIND="requestExportSvg";function e(){return{kind:i.KIND,requestId:(0,RD.generateRequestId)()}}i.create=e})(ll=ke.RequestExportSvgAction||(ke.RequestExportSvgAction={}));var al=class extends MD.HiddenCommand{constructor(e){super(),this.action=e}execute(e){if((0,d0.isExportable)(e.root)){let t=e.modelFactory.createRoot(e.root);if((0,d0.isExportable)(t))return(0,qD.isViewport)(t)&&(t.zoom=1,t.scroll={x:0,y:0}),t.index.all().forEach(n=>{(0,TD.isSelectable)(n)&&n.selected&&(n.selected=!1),(0,DD.isHoverable)(n)&&n.hoverFeedback&&(n.hoverFeedback=!1)}),{model:t,modelChanged:!0,cause:this.action}}return{model:e.root,modelChanged:!1}}};al.KIND=ll.KIND;al=ul([ID(0,(0,dl.inject)(f0.TYPES.Action)),l0("design:paramtypes",[Object])],al);ke.ExportSvgCommand=al;var cl=class{decorate(e,t){return t instanceof OD.SModelRoot&&(this.root=t),e}postUpdate(e){this.root&&e!==void 0&&e.kind===ll.KIND&&this.svgExporter.export(this.root,e)}};ul([(0,dl.inject)(f0.TYPES.SvgExporter),l0("design:type",xD.SvgExporter)],cl.prototype,"svgExporter",void 0);cl=ul([(0,dl.injectable)()],cl);ke.ExportSvgPostprocessor=cl});var fl=f(Fi=>{"use strict";var jD=Fi&&Fi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.ElementFader=Fi.FadeAnimation=void 0;var ND=_(),LD=ur(),BD=G(),FD=Be(),VD=qo(),zg=class extends LD.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementFades=t,this.removeAfterFadeOut=r}tween(e,t){for(let n of this.elementFades){let r=n.element;n.type==="in"?r.opacity=e:n.type==="out"&&(r.opacity=1-e,e===1&&this.removeAfterFadeOut&&r instanceof BD.SChildElement&&r.parent.remove(r))}return this.model}};Fi.FadeAnimation=zg;var Yg=class{decorate(e,t){return(0,VD.isFadeable)(t)&&t.opacity!==1&&(0,FD.setAttr)(e,"opacity",t.opacity),e}postUpdate(){}};Yg=jD([(0,ND.injectable)()],Yg);Fi.ElementFader=Yg});var $g=f(re=>{"use strict";var Ki=re&&re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},za=re&&re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},p0=re&&re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(re,"__esModule",{value:!0});re.ClosePopupActionHandler=re.HoverKeyListener=re.PopupHoverMouseListener=re.HoverMouseListener=re.AbstractHoverMouseListener=re.SetPopupModelCommand=re.SetPopupModelAction=re.RequestPopupModelAction=re.HoverFeedbackCommand=re.HoverFeedbackAction=void 0;var Fn=_(),g0=ie(),KD=ee(),HD=On(),Ya=P(),h0=G(),zD=At(),m0=me(),qr=Mn(),YD=un(),Ka=ze(),UD=ue(),Wo=wr(),Xo;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(Xo=re.HoverFeedbackAction||(re.HoverFeedbackAction={}));var hl=class extends m0.SystemCommand{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.mouseoverElement);return n&&(0,Wo.isHoverable)(n)&&(n.hoverFeedback=this.action.mouseIsOver),this.redo(e)}undo(e){return e.root}redo(e){return e.root}};hl.KIND=Xo.KIND;hl=Ki([(0,Fn.injectable)(),p0(0,(0,Fn.inject)(Ya.TYPES.Action)),za("design:paramtypes",[Object])],hl);re.HoverFeedbackCommand=hl;var Vi=class{constructor(e,t,n=""){this.elementId=e,this.bounds=t,this.requestId=n,this.kind=Vi.KIND}static create(e,t){return new Vi(e,t,(0,g0.generateRequestId)())}};re.RequestPopupModelAction=Vi;Vi.KIND="requestPopupModel";var ci=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ci.KIND}};re.SetPopupModelAction=ci;ci.KIND="setPopupModel";var Ha=class extends m0.PopupCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.root,this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}};Ha.KIND=g0.SetPopupModelAction.KIND;Ha=Ki([(0,Fn.injectable)(),p0(0,(0,Fn.inject)(Ya.TYPES.Action)),za("design:paramtypes",[Object])],Ha);re.SetPopupModelCommand=Ha;var Dr=class extends zD.MouseListener{mouseDown(e,t){return this.mouseIsDown=!0,[]}mouseUp(e,t){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(e=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,e(new ci({type:qr.EMPTY_ROOT.type,id:qr.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}};Ki([(0,Fn.inject)(Ya.TYPES.ViewerOptions),za("design:type",Object)],Dr.prototype,"options",void 0);Ki([(0,Fn.inject)(Ya.TYPES.HoverState),za("design:type",Object)],Dr.prototype,"state",void 0);re.AbstractHoverMouseListener=Dr;var pl=class extends Dr{computePopupBounds(e,t){let n={x:-5,y:20},r=(0,UD.getAbsoluteBounds)(e),o=e.root.canvasBounds,s=KD.Bounds.translate(r,o),a=s.x+s.width-t.x,c=s.y+s.height-t.y;c<=a&&this.allowSidePosition(e,"below",c)?n={x:-5,y:Math.round(c+5)}:a<=c&&this.allowSidePosition(e,"right",a)&&(n={x:Math.round(a+5),y:-5});let u=t.x+n.x,d=o.x+o.width;u>d&&(u=d);let l=t.y+n.y,S=o.y+o.height;return l>S&&(l=S),{x:u,y:l,width:-1,height:-1}}allowSidePosition(e,t,n){return!(e instanceof h0.SModelRoot)&&n<=150}startMouseOverTimer(e,t){return this.stopMouseOverTimer(),new Promise(n=>{this.state.mouseOverTimer=window.setTimeout(()=>{let r=this.computePopupBounds(e,{x:t.pageX,y:t.pageY});n(new Vi(e.id,r)),this.state.popupOpen=!0,this.state.previousPopupElement=e},this.options.popupOpenDelay)})}mouseOver(e,t){let n=[];if(!this.mouseIsDown){let r=(0,Ka.findParent)(e,Wo.hasPopupFeature);this.state.popupOpen&&(r===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==r.id)?n.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t)),this.lastHoverFeedbackElementId&&(n.push(Xo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);let o=(0,Ka.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push(Xo.create({mouseoverElement:o.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=o.id)}return n}mouseOut(e,t){let n=[];if(!this.mouseIsDown){let r=this.getElementFromEventPosition(t);if(!this.isSprottyPopup(r)){if(this.state.popupOpen){let s=(0,Ka.findParent)(e,Wo.hasPopupFeature);this.state.previousPopupElement!==void 0&&s!==void 0&&this.state.previousPopupElement.id===s.id&&n.push(this.startMouseOutTimer())}this.stopMouseOverTimer();let o=(0,Ka.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push(Xo.create({mouseoverElement:o.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==o.id&&n.push(Xo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return n}getElementFromEventPosition(e){return document.elementFromPoint(e.x,e.y)}isSprottyPopup(e){return e?e.id===this.options.popupDiv||!!e.parentElement&&this.isSprottyPopup(e.parentElement):!1}mouseMove(e,t){let n=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,t)&&n.push(this.startMouseOutTimer());let r=(0,Ka.findParent)(e,Wo.hasPopupFeature);r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t))}return n}closeOnMouseMove(e,t){return e instanceof h0.SModelRoot}};Ki([(0,Fn.inject)(Ya.TYPES.ViewerOptions),za("design:type",Object)],pl.prototype,"options",void 0);pl=Ki([(0,Fn.injectable)()],pl);re.HoverMouseListener=pl;var Ug=class extends Dr{mouseOut(e,t){return[this.startMouseOutTimer()]}mouseOver(e,t){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};Ug=Ki([(0,Fn.injectable)()],Ug);re.PopupHoverMouseListener=Ug;var kg=class extends YD.KeyListener{keyDown(e,t){return(0,HD.matchesKeystroke)(t,"Escape")?[new ci({type:qr.EMPTY_ROOT.type,id:qr.EMPTY_ROOT.id})]:[]}};re.HoverKeyListener=kg;var Gg=class{constructor(){this.popupOpen=!1}handle(e){if(e.kind===Ha.KIND)this.popupOpen=e.newRoot.type!==qr.EMPTY_ROOT.type;else if(this.popupOpen)return new ci({id:qr.EMPTY_ROOT.id,type:qr.EMPTY_ROOT.type})}};Gg=Ki([(0,Fn.injectable)()],Gg);re.ClosePopupActionHandler=Gg});var gl=f(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.SIssue=It.SIssueMarker=It.SDecoration=It.isDecoration=It.decorationFeature=void 0;var _0=ue(),y0=wr();It.decorationFeature=Symbol("decorationFeature");function kD(i){return i.hasFeature(It.decorationFeature)}It.isDecoration=kD;var Ua=class extends _0.SShapeElement{};It.SDecoration=Ua;Ua.DEFAULT_FEATURES=[It.decorationFeature,_0.boundsFeature,y0.hoverFeedbackFeature,y0.popupFeature];var Wg=class extends Ua{};It.SIssueMarker=Wg;var Xg=class{};It.SIssue=Xg});var Qg=f(Jo=>{"use strict";var GD=Jo&&Jo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Jo,"__esModule",{value:!0});Jo.IssueMarkerView=void 0;var Jg=Wt(),$D=Be(),WD=_(),Zg=class{render(e,t){let n=.008928571428571428,r=`scale(${n}, ${n})`,o=this.getMaxSeverity(e),s=(0,Jg.svg)("g",{"class-sprotty-issue":!0},(0,Jg.svg)("g",{transform:r},(0,Jg.svg)("path",{d:this.getPath(o)})));return(0,$D.setClass)(s,"sprotty-"+o,!0),s}getMaxSeverity(e){let t="info";for(let n of e.issues.map(r=>r.severity))(n==="error"||n==="warning"&&t==="info")&&(t=n);return t}getPath(e){switch(e){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};Zg=GD([(0,WD.injectable)()],Zg);Jo.IssueMarkerView=Zg});var em=f(Hi=>{"use strict";var E0=Hi&&Hi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},XD=Hi&&Hi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Hi,"__esModule",{value:!0});Hi.DecorationPlacer=void 0;var w0=_(),JD=G(),ZD=gl(),QD=Be(),v0=ue(),ej=_e(),b0=pn(),S0=hr(),ml=class{decorate(e,t){if((0,ZD.isDecoration)(t)){let n=this.getPosition(t),r="translate("+n.x+", "+n.y+")";(0,QD.setAttr)(e,"transform",r)}return e}getPosition(e){if(e instanceof JD.SChildElement&&e.parent instanceof ej.SRoutableElement){let t=this.edgeRouterRegistry.route(e.parent);if(t.length>1){let n=Math.floor(.5*(t.length-1)),r=(0,v0.isSizeable)(e)?{x:-.5*e.bounds.width,y:-.5*e.bounds.width}:S0.Point.ORIGIN;return{x:.5*(t[n].x+t[n+1].x)+r.x,y:.5*(t[n].y+t[n+1].y)+r.y}}}return(0,v0.isSizeable)(e)?{x:-.666*e.bounds.width,y:-.666*e.bounds.height}:S0.Point.ORIGIN}postUpdate(){}};E0([(0,w0.inject)(b0.EdgeRouterRegistry),XD("design:type",b0.EdgeRouterRegistry)],ml.prototype,"edgeRouterRegistry",void 0);ml=E0([(0,w0.injectable)()],ml);Hi.DecorationPlacer=ml});var im=f((tm,nm)=>{(function(i,e){typeof tm=="object"&&typeof nm<"u"?nm.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self,i.TinyQueue=e())})(tm,function(){"use strict";var i=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var r=this,o=r.data,s=r.compare,a=o[n];n>0;){var c=n-1>>1,u=o[c];if(s(a,u)>=0)break;o[n]=u,n=c}o[n]=a},i.prototype._down=function(n){for(var r=this,o=r.data,s=r.compare,a=this.length>>1,c=o[n];n<a;){var u=(n<<1)+1,d=o[u],l=u+1;if(l<this.length&&s(o[l],d)<0&&(u=l,d=o[l]),s(d,c)>=0)break;o[n]=d,n=u}o[n]=c};function e(t,n){return t<n?-1:t>n?1:0}return i})});var om=f(Oe=>{"use strict";var tj=Oe&&Oe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.intersectionOfSegments=Oe.getSegmentIndex=Oe.checkWhichSegmentHasRightEndpointFirst=Oe.runSweep=Oe.Segment=Oe.SweepEvent=Oe.checkWhichEventIsLeft=Oe.addRoute=void 0;var nj=tj(im()),P0=Or();function ij(i,e,t){if(e.length<1)return;let n=e[0],r;for(let o=0;o<e.length-1;o++){r=e[o+1];let s=new ka(i,n,o),a=new ka(i,r,o+1);s.otherEvent=a,a.otherEvent=s,I0(s,a)>0?(a.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,a.isLeftEndpoint=!1),t.push(s),t.push(a),n=r}}Oe.addRoute=ij;function I0(i,e){return i.point.x>e.point.x?1:i.point.x<e.point.x?-1:i.point.y!==e.point.y?i.point.y>e.point.y?1:-1:1}Oe.checkWhichEventIsLeft=I0;var ka=class{constructor(e,t,n){this.edgeId=e,this.point=t,this.segmentIndex=n}};Oe.SweepEvent=ka;var yl=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};Oe.Segment=yl;function rj(i){let e=[],t=new nj.default([],R0);for(;i.length;){let n=i.pop();if(n?.isLeftEndpoint){let r=new yl(n);for(let o=0;o<t.data.length;o++){let s=t.data[o],a=M0(r,s);a&&e.push({routable1:n.edgeId,routable2:s.leftSweepEvent.edgeId,segmentIndex1:rm(r),segmentIndex2:rm(s),intersectionPoint:a})}t.push(r)}else n?.isLeftEndpoint===!1&&t.pop()}return e}Oe.runSweep=rj;function R0(i,e){return i.rightSweepEvent.point.x>e.rightSweepEvent.point.x?1:i.rightSweepEvent.point.x<e.rightSweepEvent.point.x?-1:i.rightSweepEvent.point.y!==e.rightSweepEvent.point.y?i.rightSweepEvent.point.y<e.rightSweepEvent.point.y?1:-1:1}Oe.checkWhichSegmentHasRightEndpointFirst=R0;function rm(i){return Math.min(i.leftSweepEvent.segmentIndex,i.rightSweepEvent.segmentIndex)}Oe.getSegmentIndex=rm;function M0(i,e){if(i.leftSweepEvent.edgeId===e.leftSweepEvent.edgeId)return;let t=new P0.PointToPointLine(i.leftSweepEvent.point,i.rightSweepEvent.point),n=new P0.PointToPointLine(e.leftSweepEvent.point,e.rightSweepEvent.point);return t.intersection(n)}Oe.intersectionOfSegments=M0});var _l=f(Ve=>{"use strict";var oj=Ve&&Ve.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},sj=Ve&&Ve.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.IntersectionFinder=Ve.BY_DESCENDING_X_THEN_DESCENDING_Y=Ve.BY_X_THEN_DESCENDING_Y=Ve.BY_DESCENDING_X_THEN_Y=Ve.BY_X_THEN_Y=Ve.isIntersectingRoutedPoint=void 0;var aj=_(),cj=sj(im()),sm=om();function T0(i){return i!==void 0&&"intersections"in i&&"kind"in i}Ve.isIntersectingRoutedPoint=T0;var uj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Ve.BY_X_THEN_Y=uj;var dj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Ve.BY_DESCENDING_X_THEN_Y=dj;var lj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Ve.BY_X_THEN_DESCENDING_Y=lj;var fj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Ve.BY_DESCENDING_X_THEN_DESCENDING_Y=fj;var am=class{apply(e){let t=this.find(e);this.addToRouting(t,e)}find(e){let t=new cj.default(void 0,sm.checkWhichEventIsLeft);return e.routes.forEach((n,r)=>{this.isSupportedRoute(n)&&(0,sm.addRoute)(r,n,t)}),(0,sm.runSweep)(t)}isSupportedRoute(e){return e.find(t=>t.kind!=="source"&&t.kind!=="target"&&t.kind!=="linear")===void 0}addToRouting(e,t){for(let n of e){let r=t.get(n.routable1),o=t.get(n.routable2);this.addIntersectionToRoutedPoint(n,r,n.segmentIndex1),this.addIntersectionToRoutedPoint(n,o,n.segmentIndex2)}}addIntersectionToRoutedPoint(e,t,n){if(t&&t.length>n){let r=t[n+1];if(T0(r))r.intersections.push(e);else{let o=Object.assign(Object.assign({},r),{intersections:[e]});t[n+1]=o}}}};am=oj([(0,aj.injectable)()],am);Ve.IntersectionFinder=am});var Za=f(Pe=>{"use strict";var Ja=Pe&&Pe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},El=Pe&&Pe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},hj=Pe&&Pe.__param||function(i,e){return function(t,n){e(t,n,i)}},cm;Object.defineProperty(Pe,"__esModule",{value:!0});Pe.LocationPostprocessor=Pe.MoveMouseListener=Pe.MorphEdgesAnimation=Pe.MoveAnimation=Pe.MoveCommand=Pe.MoveAction=void 0;var ui=_(),zi=ee(),Zo=ie(),Ga=ur(),pj=me(),bl=G(),$a=ze(),A0=P(),gj=At(),mj=Be(),yj=Rr(),_j=ja(),C0=ue(),O0=cg(),vl=Fa(),vj=il(),je=_e(),Sl=pn(),bj=Bo(),x0=Et(),Sj=qn(),Qo=qi(),dm;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(dm=Pe.MoveAction||(Pe.MoveAction={}));var Wa=cm=class extends pj.MergeableCommand{constructor(e){super(),this.action=e,this.resolvedMoves=new Map,this.edgeMementi=[]}execute(e){let t=e.root.index,n=new Map,r=new Map;return this.action.moves.forEach(o=>{let s=t.getById(o.elementId);if(s instanceof je.SRoutingHandle&&this.edgeRouterRegistry){let a=s.parent;if(a instanceof je.SRoutableElement){let c=this.resolveHandleMove(s,a,o);if(c){let u=n.get(a);u||(u=[],n.set(a,u)),u.push(c)}}}else if(s&&(0,Qo.isLocateable)(s)){let a=this.resolveElementMove(s,o);a&&(this.resolvedMoves.set(a.element.id,a),this.edgeRouterRegistry&&t.getAttachedElements(s).forEach(c=>{if(c instanceof je.SRoutableElement){let u=r.get(c),d=zi.Point.subtract(a.toPosition,a.fromPosition),l=u?zi.Point.linear(u,d,.5):d;r.set(c,l)}}))}}),this.doMove(n,r),this.action.animate?(this.undoMove(),new Ga.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!1),new ts(e.root,this.edgeMementi,e,!1)]).start()):e.root}resolveHandleMove(e,t,n){let r=n.fromPosition;if(!r){let o=this.edgeRouterRegistry.get(t.routerKind);r=o.getHandlePosition(t,o.route(t),e)}if(r)return{handle:e,fromPosition:r,toPosition:n.toPosition}}resolveElementMove(e,t){let n=t.fromPosition||{x:e.position.x,y:e.position.y};return{element:e,fromPosition:n,toPosition:t.toPosition}}doMove(e,t){this.resolvedMoves.forEach(n=>{n.element.position=n.toPosition}),e.forEach((n,r)=>{let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);o.applyHandleMoves(r,n);let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}),t.forEach((n,r)=>{if(!e.get(r)){let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);if(r.source&&r.target&&this.resolvedMoves.get(r.source.id)&&this.resolvedMoves.get(r.target.id))r.routingPoints=r.routingPoints.map(c=>zi.Point.add(c,n));else{let c=(0,x0.isSelectable)(r)&&r.selected;o.cleanupRoutingPoints(r,r.routingPoints,c,this.action.finished)}let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}})}undoMove(){this.resolvedMoves.forEach(e=>{e.element.position=e.fromPosition}),this.edgeMementi.forEach(e=>{this.edgeRouterRegistry.get(e.edge.routerKind).applySnapshot(e.edge,e.before)})}undo(e){return new Ga.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!0),new ts(e.root,this.edgeMementi,e,!0)]).start()}redo(e){return new Ga.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!1),new ts(e.root,this.edgeMementi,e,!1)]).start()}merge(e,t){if(!this.action.animate&&e instanceof cm)return e.resolvedMoves.forEach((n,r)=>{let o=this.resolvedMoves.get(r);o?o.toPosition=n.toPosition:this.resolvedMoves.set(r,n)}),e.edgeMementi.forEach(n=>{let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}),!0;if(e instanceof vj.ReconnectCommand){let n=e.memento;if(n){let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}return!0}return!1}};Wa.KIND=dm.KIND;Ja([(0,ui.inject)(Sl.EdgeRouterRegistry),(0,ui.optional)(),El("design:type",Sl.EdgeRouterRegistry)],Wa.prototype,"edgeRouterRegistry",void 0);Wa=cm=Ja([(0,ui.injectable)(),hj(0,(0,ui.inject)(A0.TYPES.Action)),El("design:paramtypes",[Object])],Wa);Pe.MoveCommand=Wa;var es=class extends Ga.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementMoves=t,this.reverse=r}tween(e){return this.elementMoves.forEach(t=>{this.reverse?t.element.position={x:(1-e)*t.toPosition.x+e*t.fromPosition.x,y:(1-e)*t.toPosition.y+e*t.fromPosition.y}:t.element.position={x:(1-e)*t.fromPosition.x+e*t.toPosition.x,y:(1-e)*t.fromPosition.y+e*t.toPosition.y}}),this.model}};Pe.MoveAnimation=es;var ts=class extends Ga.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.reverse=r,this.expanded=[],t.forEach(o=>{let s=this.reverse?o.after:o.before,a=this.reverse?o.before:o.after,c=s.routedPoints,u=a.routedPoints,d=Math.max(c.length,u.length);this.expanded.push({startExpandedRoute:this.growToSize(c,d),endExpandedRoute:this.growToSize(u,d),memento:o})})}midPoint(e){let t=e.edge,n=e.edge.source,r=e.edge.target;return zi.Point.linear((0,$a.translatePoint)(zi.Bounds.center(n.bounds),n.parent,t.parent),(0,$a.translatePoint)(zi.Bounds.center(r.bounds),r.parent,t.parent),.5)}start(){return this.expanded.forEach(e=>{e.memento.edge.removeAll(t=>t instanceof je.SRoutingHandle)}),super.start()}tween(e){return e===1?this.expanded.forEach(t=>{let n=t.memento;this.reverse?n.before.router.applySnapshot(n.edge,n.before):n.after.router.applySnapshot(n.edge,n.after)}):this.expanded.forEach(t=>{let n=[];for(let s=1;s<t.startExpandedRoute.length-1;++s)n.push(zi.Point.linear(t.startExpandedRoute[s],t.endExpandedRoute[s],e));let r=e<.5?t.memento.before:t.memento.after,o=Object.assign(Object.assign({},r),{routingPoints:n,routingHandles:[]});r.router.applySnapshot(t.memento.edge,o)}),this.model}growToSize(e,t){let n=t-e.length;if(n<=0)return e;let r=[];r.push(e[0]);let o=1/(n+1),s=1/(e.length-1),a=1;for(let c=1;c<e.length;++c){let u=s*c,d=0;for(;u>(a+d)*o;)++d;a+=d;for(let l=0;l<d;++l){let S=zi.Point.linear(e[c-1],e[c],(l+1)/(d+1));r.push(S)}r.push(e[c])}return r}};Pe.MorphEdgesAnimation=ts;var Xa=class extends gj.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(e,t){if(t.button===0){let n=(0,$a.findParentByFeature)(e,Qo.isMoveable),r=e instanceof je.SRoutingHandle;n!==void 0||r||(0,O0.isCreatingOnDrag)(e)?this.startDragPosition={x:t.pageX,y:t.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,O0.isCreatingOnDrag)(e)?this.startCreatingOnDrag(e,t):r&&this.activateRoutingHandle(e,t)}return[]}startCreatingOnDrag(e,t){let n=[];return n.push(Zo.SelectAllAction.create({select:!1})),n.push(e.createAction(je.edgeInProgressID)),n.push(Zo.SelectAction.create({selectedElementsIDs:[je.edgeInProgressID]})),n.push(vl.SwitchEditModeAction.create({elementsToActivate:[je.edgeInProgressID]})),n.push(Zo.SelectAction.create({selectedElementsIDs:[je.edgeInProgressTargetHandleID]})),n.push(vl.SwitchEditModeAction.create({elementsToActivate:[je.edgeInProgressTargetHandleID]})),n}activateRoutingHandle(e,t){return[vl.SwitchEditModeAction.create({elementsToActivate:[e.id]})]}mouseMove(e,t){let n=[];if(t.buttons===0)this.mouseUp(e,t);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(e.root),this.hasDragged=!0;let r=this.getElementMoves(e,t,!1);r&&n.push(r)}return n}collectStartPositions(e){let t=new Set(e.index.all().filter(n=>(0,x0.isSelectable)(n)&&n.selected));t.forEach(n=>{if(!this.isChildOfSelected(t,n)){if((0,Qo.isMoveable)(n))this.elementId2startPos.set(n.id,n.position);else if(n instanceof je.SRoutingHandle){let r=this.getHandlePosition(n);r&&this.elementId2startPos.set(n.id,r)}}})}isChildOfSelected(e,t){for(;t instanceof bl.SChildElement;)if(t=t.parent,(0,Qo.isMoveable)(t)&&e.has(t))return!0;return!1}getElementMoves(e,t,n){if(!this.startDragPosition)return;let r=[],o=(0,$a.findParentByFeature)(e,Sj.isViewport),s=o?o.zoom:1,a={x:(t.pageX-this.startDragPosition.x)/s,y:(t.pageY-this.startDragPosition.y)/s};if(this.elementId2startPos.forEach((c,u)=>{let d=e.root.index.getById(u);if(d){let l=this.createElementMove(d,c,a,t);l&&r.push(l)}}),r.length>0)return dm.create(r,{animate:!1,finished:n})}createElementMove(e,t,n,r){let o=this.snap({x:t.x+n.x,y:t.y+n.y},e,!r.shiftKey);if((0,Qo.isMoveable)(e))return{elementId:e.id,elementType:e.type,fromPosition:{x:e.position.x,y:e.position.y},toPosition:o};if(e instanceof je.SRoutingHandle){let s=this.getHandlePosition(e);if(s!==void 0)return{elementId:e.id,elementType:e.type,fromPosition:s,toPosition:o}}}snap(e,t,n){return n&&this.snapper?this.snapper.snap(e,t):e}getHandlePosition(e){if(this.edgeRouterRegistry){let t=e.parent;if(!(t instanceof je.SRoutableElement))return;let n=this.edgeRouterRegistry.get(t.routerKind),r=n.route(t);return n.getHandlePosition(t,r,e)}}mouseEnter(e,t){return e instanceof bl.SModelRoot&&t.buttons===0&&!this.startDragPosition&&this.mouseUp(e,t),[]}mouseUp(e,t){let n=[];if(this.startDragPosition){let r=this.getElementMoves(e,t,!0);r&&n.push(r),e.root.index.all().forEach(o=>{o instanceof je.SRoutingHandle&&n.push(...this.deactivateRoutingHandle(o,e,t))})}if(!n.some(r=>r.kind===Zo.ReconnectAction.KIND)){let r=e.root.index.getById(je.edgeInProgressID);r instanceof bl.SChildElement&&n.push(this.deleteEdgeInProgress(r))}return this.hasDragged&&n.push(_j.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),n}deactivateRoutingHandle(e,t,n){let r=[],o=e.parent;if(o instanceof je.SRoutableElement&&e.danglingAnchor){let s=this.getHandlePosition(e);if(s){let a=(0,$a.translatePoint)(s,e.parent,e.root),c=(0,C0.findChildrenAtPosition)(t.root,a).find(u=>(0,je.isConnectable)(u)&&u.canConnect(o,e.kind));c&&this.hasDragged&&r.push(Zo.ReconnectAction.create({routableId:e.parent.id,newSourceId:e.kind==="source"?c.id:o.sourceId,newTargetId:e.kind==="target"?c.id:o.targetId}))}}return e.editMode&&r.push(vl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),r}deleteEdgeInProgress(e){let t=[];return t.push(je.edgeInProgressID),e.children.forEach(n=>{n instanceof je.SRoutingHandle&&n.danglingAnchor&&t.push(n.danglingAnchor.id)}),Zo.DeleteElementAction.create(t)}decorate(e,t){return e}};Ja([(0,ui.inject)(Sl.EdgeRouterRegistry),(0,ui.optional)(),El("design:type",Sl.EdgeRouterRegistry)],Xa.prototype,"edgeRouterRegistry",void 0);Ja([(0,ui.inject)(A0.TYPES.ISnapper),(0,ui.optional)(),El("design:type",Object)],Xa.prototype,"snapper",void 0);Pe.MoveMouseListener=Xa;var um=class{decorate(e,t){if((0,bj.isEdgeLayoutable)(t)&&t.parent instanceof yj.SEdge)return e;let n="";if((0,Qo.isLocateable)(t)&&t instanceof bl.SChildElement&&t.parent!==void 0){let r=t.position;(r.x!==0||r.y!==0)&&(n="translate("+r.x+", "+r.y+")")}if((0,C0.isAlignable)(t)){let r=t.alignment;(r.x!==0||r.y!==0)&&(n.length>0&&(n+=" "),n+="translate("+r.x+", "+r.y+")")}return n.length>0&&(0,mj.setAttr)(e,"transform",n),e}postUpdate(){}};um=Ja([(0,ui.injectable)()],um);Pe.LocationPostprocessor=um});var q0=f(ns=>{"use strict";var Ej=ns&&ns.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ns,"__esModule",{value:!0});ns.CenterGridSnapper=void 0;var wj=_(),Pj=ue(),lm=class{get gridX(){return 10}get gridY(){return 10}snap(e,t){return t&&(0,Pj.isBoundsAware)(t)?{x:Math.round((e.x+.5*t.bounds.width)/this.gridX)*this.gridX-.5*t.bounds.width,y:Math.round((e.y+.5*t.bounds.height)/this.gridY)*this.gridY-.5*t.bounds.height}:{x:Math.round(e.x/this.gridX)*this.gridX,y:Math.round(e.y/this.gridY)*this.gridY}}};lm=Ej([(0,wj.injectable)()],lm);ns.CenterGridSnapper=lm});var fm=f(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.isOpenable=jr.openFeature=void 0;jr.openFeature=Symbol("openFeature");function Ij(i){return i.hasFeature(jr.openFeature)}jr.isOpenable=Ij});var pm=f(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.OpenMouseListener=void 0;var Rj=ie(),Mj=At(),Tj=ze(),Oj=fm(),hm=class extends Mj.MouseListener{doubleClick(e,t){let n=(0,Tj.findParentByFeature)(e,Oj.isOpenable);return n!==void 0?[Rj.OpenAction.create(n.id)]:[]}};wl.OpenMouseListener=hm});var Rl=f(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.getModelBounds=Vn.getProjectedBounds=Vn.getProjections=Vn.isProjectable=void 0;var Aj=ee(),Cj=Sn(),D0=ze(),Il=ue();function j0(i){return(0,Cj.hasOwnProperty)(i,"projectionCssClasses")}Vn.isProjectable=j0;function N0(i){let e;for(let t of i.children){if(j0(t)&&t.projectionCssClasses.length>0){let n=L0(t);if(n){let r={elementId:t.id,projectedBounds:n,cssClasses:t.projectionCssClasses};e?e.push(r):e=[r]}}if(t.children.length>0){let n=N0(t);n&&(e?e.push(...n):e=n)}}return e}Vn.getProjections=N0;function L0(i){let e=i.parent;if(i.projectedBounds){let t=i.projectedBounds;return(0,Il.isBoundsAware)(e)&&(t=(0,D0.transformToRootBounds)(e,t)),t}else if((0,Il.isBoundsAware)(i)){let t=i.bounds;return t=(0,D0.transformToRootBounds)(e,t),t}}Vn.getProjectedBounds=L0;var Pl=1e9;function xj(i){let e=Pl,t=Pl,n=-Pl,r=-Pl,o=(0,Il.isBoundsAware)(i)?i.bounds:void 0;if(o&&Aj.Dimension.isValid(o))e=o.x,t=o.y,n=e+o.width,r=t+o.height;else for(let s of i.children)if((0,Il.isBoundsAware)(s)){let a=s.bounds;e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x+a.width),r=Math.max(r,a.y+a.height)}if(e=Math.min(e,i.scroll.x),t=Math.min(t,i.scroll.y),n=Math.max(n,i.scroll.x+i.canvasBounds.width/i.zoom),r=Math.max(r,i.scroll.y+i.canvasBounds.height/i.zoom),e<n&&t<r)return{x:e,y:t,width:n-e,height:r-t}}Vn.getModelBounds=xj});var K0=f(is=>{"use strict";var qj=is&&is.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(is,"__esModule",{value:!0});is.ProjectedViewportView=void 0;var Ml=Wt(),Dj=_(),B0=po(),F0=Be(),V0=Rl(),gm=class{render(e,t,n){let r=(0,Ml.html)("div",{"class-sprotty-root":!0},this.renderSvg(e,t,n),this.renderProjections(e,t,n));return(0,F0.setAttr)(r,"tabindex",0),r}renderSvg(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`,o="http://www.w3.org/2000/svg";return(0,B0.h)("svg",{ns:o},(0,B0.h)("g",{ns:o,attrs:{transform:r}},t.renderChildren(e)))}renderProjections(e,t,n){var r;if(e.zoom<=0)return[];let o=(0,V0.getModelBounds)(e);if(!o)return[];let s=(r=(0,V0.getProjections)(e))!==null&&r!==void 0?r:[];return[this.renderProjectionBar(s,e,o,"vertical"),this.renderProjectionBar(s,e,o,"horizontal")]}renderProjectionBar(e,t,n,r){let o={modelBounds:n,orientation:r};return o.factor=r==="horizontal"?t.canvasBounds.width/n.width:t.canvasBounds.height/n.height,o.zoomedFactor=o.factor/t.zoom,(0,Ml.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":r==="horizontal","class-vertical":r==="vertical"},this.renderViewport(t,o),e.map(s=>this.renderProjection(s,t,o)))}renderViewport(e,t){let n,r;t.orientation==="horizontal"?(n=e.canvasBounds.width,r=(e.scroll.x-t.modelBounds.x)*t.factor):(n=e.canvasBounds.height,r=(e.scroll.y-t.modelBounds.y)*t.factor);let o=n*t.zoomedFactor;r<0?(o+=r,r=0):r>n&&(r=n),o<0?o=0:r+o>n&&(o=n-r);let s=t.orientation==="horizontal"?{left:`${r}px`,width:`${o}px`}:{top:`${r}px`,height:`${o}px`};return(0,Ml.html)("div",{"class-sprotty-viewport":!0,style:s})}renderProjection(e,t,n){let r,o,s;n.orientation==="horizontal"?(r=t.canvasBounds.width,o=(e.projectedBounds.x-n.modelBounds.x)*n.factor,s=e.projectedBounds.width*n.factor):(r=t.canvasBounds.height,o=(e.projectedBounds.y-n.modelBounds.y)*n.factor,s=e.projectedBounds.height*n.factor),o<0?(s+=o,o=0):o>r&&(o=r),s<0?s=0:o+s>r&&(s=r-o);let a=n.orientation==="horizontal"?{left:`${o}px`,width:`${s}px`}:{top:`${o}px`,height:`${s}px`},c=(0,Ml.html)("div",{id:`${n.orientation}-projection:${e.elementId}`,"class-sprotty-projection":!0,style:a});return e.cssClasses.forEach(u=>(0,F0.setClass)(c,u,!0)),c}};gm=qj([(0,Dj.injectable)()],gm);is.ProjectedViewportView=gm});var Tl=f(Kn=>{"use strict";var Sm=Kn&&Kn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.DiamondAnchor=Kn.RectangleAnchor=Kn.EllipseAnchor=void 0;var Em=oi(),mm=Or(),wm=_(),Pm=Oa(),rs=ee(),ym=class{get kind(){return Pm.PolylineEdgeRouter.KIND+":"+Em.ELLIPTIC_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=rs.Bounds.center(r),s=o.x-t.x,a=o.y-t.y,c=Math.sqrt(s*s+a*a),u=s/c||0,d=a/c||0;return{x:o.x-u*(.5*r.width+n),y:o.y-d*(.5*r.height+n)}}};ym=Sm([(0,wm.injectable)()],ym);Kn.EllipseAnchor=ym;var _m=class{get kind(){return Pm.PolylineEdgeRouter.KIND+":"+Em.RECTANGULAR_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=rs.Bounds.center(r),s=new vm(o,t);if(!(0,rs.almostEquals)(o.y,t.y)){let a=this.getXIntersection(r.y,o,t);a>=r.x&&a<=r.x+r.width&&s.addCandidate(a,r.y-n);let c=this.getXIntersection(r.y+r.height,o,t);c>=r.x&&c<=r.x+r.width&&s.addCandidate(c,r.y+r.height+n)}if(!(0,rs.almostEquals)(o.x,t.x)){let a=this.getYIntersection(r.x,o,t);a>=r.y&&a<=r.y+r.height&&s.addCandidate(r.x-n,a);let c=this.getYIntersection(r.x+r.width,o,t);c>=r.y&&c<=r.y+r.height&&s.addCandidate(r.x+r.width+n,c)}return s.best}getXIntersection(e,t,n){let r=(e-t.y)/(n.y-t.y);return(n.x-t.x)*r+t.x}getYIntersection(e,t,n){let r=(e-t.x)/(n.x-t.x);return(n.y-t.y)*r+t.y}};_m=Sm([(0,wm.injectable)()],_m);Kn.RectangleAnchor=_m;var vm=class{constructor(e,t){this.centerPoint=e,this.refPoint=t,this.currentDist=-1}addCandidate(e,t){let n=this.refPoint.x-e,r=this.refPoint.y-t,o=n*n+r*r;(this.currentDist<0||o<this.currentDist)&&(this.currentBest={x:e,y:t},this.currentDist=o)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}},bm=class{get kind(){return Pm.PolylineEdgeRouter.KIND+":"+Em.DIAMOND_ANCHOR_KIND}getAnchor(e,t,n){let r=e.bounds,o=new mm.PointToPointLine(rs.Bounds.center(r),t),s=new mm.Diamond(r).closestSideLine(t),a=(0,mm.intersection)(s,o);return rs.Point.shiftTowards(a,t,n)}};bm=Sm([(0,wm.injectable)()],bm);Kn.DiamondAnchor=bm});var xl=f(Ge=>{"use strict";var U0=Ge&&Ge.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jj=Ge&&Ge.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},H0=Ge&&Ge.__param||function(i,e){return function(t,n){e(t,n,i)}},Qa;Object.defineProperty(Ge,"__esModule",{value:!0});Ge.AddRemoveBezierSegmentCommand=Ge.AddRemoveBezierSegmentAction=Ge.BezierMouseListener=Ge.BezierEdgeRouter=void 0;var Ol=_(),z0=ee(),Yi=_e(),Y0=pn(),Nj=Ma(),Lj=At(),Bj=me(),Fj=P(),os=Qa=class extends Nj.AbstractEdgeRouter{get kind(){return Qa.KIND}route(e){if(!e.source||!e.target)return[];let t=e.routingPoints.length,n=e.source,r=e.target,o=[];if(o.push({kind:"source",x:0,y:0}),t===0){let[d,l]=this.createDefaultBezierHandles(n.position,r.position);o.push({kind:"bezier-control-after",x:d.x,y:d.y,pointIndex:0}),o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:1}),e.routingPoints.push(d),e.routingPoints.push(l)}else if(t>=2)for(let d=0;d<t;d++){let l=e.routingPoints[d];d%3===0&&o.push({kind:"bezier-control-after",x:l.x,y:l.y,pointIndex:d}),(d+1)%3===0?o.push({kind:"bezier-junction",x:l.x,y:l.y,pointIndex:d}):(d+2)%3===0&&o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:d})}o.push({kind:"target",x:0,y:0});let s=t>2?e.routingPoints[2]:r.position,a=t>2?e.routingPoints[e.routingPoints.length-3]:n.position,c=this.getTranslatedAnchor(n,s,r.parent,e,e.sourceAnchorCorrection),u=this.getTranslatedAnchor(r,a,n.parent,e,e.targetAnchorCorrection);return o[0]={kind:"source",x:c.x,y:c.y},o[o.length-1]={kind:"target",x:u.x,y:u.y},o}createDefaultBezierHandles(e,t){let n={x:e.x-Qa.DEFAULT_BEZIER_HANDLE_OFFSET,y:e.y},r={x:t.x+Qa.DEFAULT_BEZIER_HANDLE_OFFSET,y:t.y};return[n,r]}createRoutingHandles(e){this.route(e),this.rebuildHandles(e)}rebuildHandles(e){this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"bezier-control-after","bezier-routing-point",0),this.addHandle(e,"bezier-add","bezier-create-routing-point",0);let t=e.routingPoints.length;if(t>2)for(let n=1;n<t-1;n+=3)this.addHandle(e,"bezier-control-before","bezier-routing-point",n),this.addHandle(e,"bezier-add","bezier-create-routing-point",n+1),this.addHandle(e,"bezier-junction","routing-point",n+1),this.addHandle(e,"bezier-remove","bezier-remove-routing-point",n+1),this.addHandle(e,"bezier-control-after","bezier-routing-point",n+2),this.moveBezierControlPair(e.routingPoints[n],n,e);this.addHandle(e,"bezier-control-before","bezier-routing-point",t-1),this.addHandle(e,"target","routing-point",-1)}getInnerHandlePosition(e,t,n){if(n.kind==="bezier-control-before"||n.kind==="bezier-junction"||n.kind==="bezier-control-after")for(let r=0;r<t.length;r++){let o=t[r];if(o.pointIndex===n.pointIndex&&o.kind===n.kind)return o}else if(n.kind==="bezier-add"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y+12.5}}else if(n.kind==="bezier-remove"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y-12.5}}}findBezierControl(e,t,n){let r={x:t[0].x,y:t[0].y};if(n>0){for(let o of t)if(o.pointIndex!==void 0&&o.pointIndex===n&&o.kind==="bezier-junction"){r={x:o.x,y:o.y};break}}return r}applyHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o={x:0,y:0},s,a,c,u=n.toPosition;switch(r.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(u,n.handle.pointIndex,e);break;case"bezier-junction":let d=r.pointIndex;d>=0&&d<e.routingPoints.length&&(c=d-1,o=e.routingPoints[d],s=e.routingPoints[c],a=this.calcRelativeMove(o,u,s),e.routingPoints[d]=u,this.moveBezierControlPair(a,c,e));break;case"source":if(c=0,s=e.routingPoints[c],e.source instanceof Yi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Yi.SDanglingAnchor;l.id=e.id+"_dangling-source",l.original=e.source,l.position=n.toPosition,r.root.add(l),r.danglingAnchor=l,e.sourceId=l.id,e.source&&(o=e.source.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;case"target":if(c=e.routingPoints.length-1,s=e.routingPoints[c],e.target instanceof Yi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Yi.SDanglingAnchor;l.id=e.id+"_dangling-target",l.original=e.target,l.position=u,r.root.add(l),r.danglingAnchor=l,e.targetId=l.id,e.target&&(o=e.target.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;default:break}})}applyInnerHandleMoves(e,t){}getOptions(e){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(e,t,n){return{x:n.x-(e.x-t.x),y:n.y-(e.y-t.y)}}createNewBezierSegment(e,t){let n=t.routingPoints,r,o,s;n.length===2?(o=n[e<0?0:e],s=n[n.length-1],r=(0,z0.centerOfLine)(o,s)):(o=n[e],s=n[e+2],r=(0,z0.centerOfLine)(o,s));let[a,c]=this.createDefaultBezierHandles(r,r);n.splice(e+1,0,a),n.splice(e+2,0,r),n.splice(e+3,0,c),this.moveBezierControlPair(a,e+1,t),t.removeAll(u=>u instanceof Yi.SRoutingHandle),this.rebuildHandles(t)}removeBezierSegment(e,t){t.routingPoints.splice(e-1,3),t.removeAll(r=>r instanceof Yi.SRoutingHandle),this.rebuildHandles(t)}moveBezierControlPair(e,t,n){if(t>=0&&t<n.routingPoints.length){let r=t-1,o=t+1;r<0||o===n.routingPoints.length?n.routingPoints[t]=e:t%3===0?this.setBezierMirror(n,e,t,!1):(t+2)%3===0&&this.setBezierMirror(n,e,t,!0)}}setBezierMirror(e,t,n,r){e.routingPoints[n]=t;let o=e.routingPoints[r?n+1:n-1];e.routingPoints[r?n+2:n-2]={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)}}};os.KIND="bezier";os.DEFAULT_BEZIER_HANDLE_OFFSET=25;os=Qa=U0([(0,Ol.injectable)()],os);Ge.BezierEdgeRouter=os;var Im=class extends Lj.MouseListener{mouseDown(e,t){let n=[];return e instanceof Yi.SRoutingHandle&&(e.kind==="bezier-add"||e.kind==="bezier-remove")&&(e.type==="bezier-create-routing-point"?n.push(Al.create("add",e.id)):e.type==="bezier-remove-routing-point"&&n.push(Al.create("remove",e.id))),n}};Ge.BezierMouseListener=Im;var Al;(function(i){i.KIND="addRemoveBezierSegment";function e(t,n){return{kind:i.KIND,actionTask:t,targetId:n}}i.create=e})(Al=Ge.AddRemoveBezierSegmentAction||(Ge.AddRemoveBezierSegmentAction={}));var Cl=class extends Bj.Command{constructor(e,t){super(),this.action=e,this.edgeRouterRegistry=t}execute(e){let n=e.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&n instanceof Yi.SRoutingHandle){let r=this.edgeRouterRegistry.get(n.parent.routerKind);if(r instanceof os){let o=r;for(let s of e.root.children)if(s.id===n.parent.id){this.action.actionTask==="add"?o.createNewBezierSegment(n.pointIndex,s):this.action.actionTask==="remove"&&o.removeBezierSegment(n.pointIndex,s);break}}}return e.root}undo(e){throw new Error("Method not implemented.")}redo(e){throw new Error("Method not implemented.")}};Cl.KIND=Al.KIND;Cl=U0([(0,Ol.injectable)(),H0(0,(0,Ol.inject)(Fj.TYPES.Action)),H0(1,(0,Ol.inject)(Y0.EdgeRouterRegistry)),jj("design:paramtypes",[Object,Y0.EdgeRouterRegistry])],Cl);Ge.AddRemoveBezierSegmentCommand=Cl});var Dm=f(Hn=>{"use strict";var Om=Hn&&Hn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.BezierDiamondAnchor=Hn.BezierRectangleAnchor=Hn.BezierEllipseAnchor=void 0;var Am=oi(),Cm=_(),xm=Tl(),qm=xl(),Rm=class extends xm.EllipseAnchor{get kind(){return qm.BezierEdgeRouter.KIND+":"+Am.ELLIPTIC_ANCHOR_KIND}};Rm=Om([(0,Cm.injectable)()],Rm);Hn.BezierEllipseAnchor=Rm;var Mm=class extends xm.RectangleAnchor{get kind(){return qm.BezierEdgeRouter.KIND+":"+Am.RECTANGULAR_ANCHOR_KIND}};Mm=Om([(0,Cm.injectable)()],Mm);Hn.BezierRectangleAnchor=Mm;var Tm=class extends xm.DiamondAnchor{get kind(){return qm.BezierEdgeRouter.KIND+":"+Am.DIAMOND_ANCHOR_KIND}};Tm=Om([(0,Cm.injectable)()],Tm);Hn.BezierDiamondAnchor=Tm});var Dl=f(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.ManhattanEdgeRouter=void 0;var ve=ee(),k0=ze(),b=Ma(),jm=_e(),ss=class extends b.AbstractEdgeRouter{get kind(){return ss.KIND}getOptions(e){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(e){if(!e.source||!e.target)return[];let t=this.createRoutedCorners(e),n=t[0]||(0,k0.translatePoint)(ve.Bounds.center(e.target.bounds),e.target.parent,e.parent),r=this.getTranslatedAnchor(e.source,n,e.parent,e,e.sourceAnchorCorrection),o=t[t.length-1]||(0,k0.translatePoint)(ve.Bounds.center(e.source.bounds),e.source.parent,e.parent),s=this.getTranslatedAnchor(e.target,o,e.parent,e,e.targetAnchorCorrection);if(!r||!s)return[];let a=[];return a.push(Object.assign({kind:"source"},r)),t.forEach(c=>a.push(c)),a.push(Object.assign({kind:"target"},s)),a}createRoutedCorners(e){let t=new b.DefaultAnchors(e.source,e.parent,"source"),n=new b.DefaultAnchors(e.target,e.parent,"target");if(e.routingPoints.length>0){let s=e.routingPoints.slice();if(this.cleanupRoutingPoints(e,s,!1,!0),s.length>0)return s.map((a,c)=>Object.assign({kind:"linear",pointIndex:c},a))}let r=this.getOptions(e);return this.calculateDefaultCorners(e,t,n,r).map(s=>Object.assign({kind:"linear"},s))}createRoutingHandles(e){let t=this.route(e);if(this.commitRoute(e,t),t.length>0){this.addHandle(e,"source","routing-point",-2);for(let n=0;n<t.length-1;++n)this.addHandle(e,"manhattan-50%","volatile-routing-point",n-1);this.addHandle(e,"target","routing-point",t.length-2)}}getInnerHandlePosition(e,t,n){let r=this.getFraction(n.kind);if(r!==void 0){let{start:o,end:s}=this.findRouteSegment(e,t,n.pointIndex);if(o!==void 0&&s!==void 0)return ve.Point.linear(o,s,r)}}getFraction(e){switch(e){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(e,t){let n=this.route(e),r=e.routingPoints,o=this.getOptions(e).minimalPointDistance;t.forEach(s=>{let a=s.handle,c=a.pointIndex,u=this.correctX(r,c,s.toPosition.x,o),d=this.correctY(r,c,s.toPosition.y,o);switch(a.kind){case"manhattan-50%":c<0?(0,ve.almostEquals)(n[0].x,n[1].x)?this.alignX(r,0,u):this.alignY(r,0,d):c<r.length-1?(0,ve.almostEquals)(r[c].x,r[c+1].x)?(this.alignX(r,c,u),this.alignX(r,c+1,u)):(this.alignY(r,c,d),this.alignY(r,c+1,d)):(0,ve.almostEquals)(n[n.length-2].x,n[n.length-1].x)?this.alignX(r,r.length-1,u):this.alignY(r,r.length-1,d);break}})}correctX(e,t,n,r){return t>0&&Math.abs(n-e[t-1].x)<r?e[t-1].x:t<e.length-2&&Math.abs(n-e[t+2].x)<r?e[t+2].x:n}alignX(e,t,n){t>=0&&t<e.length&&(e[t]={x:n,y:e[t].y})}correctY(e,t,n,r){return t>0&&Math.abs(n-e[t-1].y)<r?e[t-1].y:t<e.length-2&&Math.abs(n-e[t+2].y)<r?e[t+2].y:n}alignY(e,t,n){t>=0&&t<e.length&&(e[t]={x:e[t].x,y:n})}cleanupRoutingPoints(e,t,n,r){let o=new b.DefaultAnchors(e.source,e.parent,"source"),s=new b.DefaultAnchors(e.target,e.parent,"target");if(!this.resetRoutingPointsOnReconnect(e,t,n,o,s)){for(let a=0;a<t.length&&ve.Bounds.includes(o.bounds,t[a]);++a)t.splice(0,1),n&&this.removeHandle(e,-1);for(let a=t.length-1;a>=0&&ve.Bounds.includes(s.bounds,t[a]);--a)t.splice(a,1),n&&this.removeHandle(e,a);if(t.length>=2){let a=this.getOptions(e);for(let c=t.length-2;c>=0;--c)ve.Point.manhattanDistance(t[c],t[c+1])<a.minimalPointDistance&&(t.splice(c,2),--c,n&&(this.removeHandle(e,c-1),this.removeHandle(e,c)))}r&&(this.addAdditionalCorner(e,t,o,s,n),this.addAdditionalCorner(e,t,s,o,n),this.manhattanify(e,t))}}removeHandle(e,t){let n=[];e.children.forEach(r=>{r instanceof jm.SRoutingHandle&&(r.pointIndex>t?--r.pointIndex:r.pointIndex===t&&n.push(r))}),n.forEach(r=>e.remove(r))}addAdditionalCorner(e,t,n,r,o){if(t.length===0)return;let s=n.kind==="source"?t[0]:t[t.length-1],a=n.kind==="source"?0:t.length,c=a-(n.kind==="source"?1:0),u;if(t.length>1)u=a===0?(0,ve.almostEquals)(t[0].x,t[1].x):(0,ve.almostEquals)(t[t.length-1].x,t[t.length-2].x);else{let d=r.getNearestSide(s);u=d===b.Side.TOP||d===b.Side.BOTTOM}if(u){if(s.y<n.get(b.Side.TOP).y||s.y>n.get(b.Side.BOTTOM).y){let d={x:n.get(b.Side.TOP).x,y:s.y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof jm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}else if(s.x<n.get(b.Side.LEFT).x||s.x>n.get(b.Side.RIGHT).x){let d={x:s.x,y:n.get(b.Side.LEFT).y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof jm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}manhattanify(e,t){for(let n=1;n<t.length;++n){let r=Math.abs(t[n-1].x-t[n].x)<1,o=Math.abs(t[n-1].y-t[n].y)<1;!r&&!o&&(t.splice(n,0,{x:t[n-1].x,y:t[n].y}),++n)}}calculateDefaultCorners(e,t,n,r){let o=super.calculateDefaultCorners(e,t,n,r);if(o.length>0)return o;let s=this.getBestConnectionAnchors(e,t,n,r),a=s.source,c=s.target,u=[],d=t.get(a),l=n.get(c);switch(a){case b.Side.RIGHT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;case b.Side.RIGHT:u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:d.y}),u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:l.y});break;case b.Side.LEFT:l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.LEFT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;default:l=n.get(b.Side.RIGHT),l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.TOP:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.TOP:u.push({x:d.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance}),u.push({x:l.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance});break;case b.Side.BOTTOM:l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break;case b.Side.BOTTOM:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;default:l=n.get(b.Side.TOP),l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break}return u}getBestConnectionAnchors(e,t,n,r){let o=t.get(b.Side.RIGHT),s=n.get(b.Side.LEFT);if(s.x-o.x>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.LEFT};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.RIGHT),o.x-s.x>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.RIGHT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.BOTTOM),o.y-s.y>r.standardDistance)return{source:b.Side.TOP,target:b.Side.BOTTOM};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.TOP),s.y-o.y>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.TOP};if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.TOP),s.x-o.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.TOP};if(s=n.get(b.Side.BOTTOM),s.x-o.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.BOTTOM};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.BOTTOM),o.x-s.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.BOTTOM};if(s=n.get(b.Side.TOP),o.x-s.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.TOP};if(o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),o.y-s.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),o.y-s.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.LEFT};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),s.y-o.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),s.y-o.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.LEFT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.TOP),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)){if(o.y-s.y<0){if(Math.abs(o.x-s.x)>(t.bounds.width+r.standardDistance)/2)return{source:b.Side.TOP,target:b.Side.TOP}}else if(Math.abs(o.x-s.x)>n.bounds.width/2)return{source:b.Side.TOP,target:b.Side.TOP}}if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)){if(o.x-s.x>0){if(Math.abs(o.y-s.y)>(t.bounds.height+r.standardDistance)/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}else if(Math.abs(o.y-s.y)>n.bounds.height/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}return o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.LEFT}:(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.LEFT}:{source:b.Side.RIGHT,target:b.Side.BOTTOM})))}};ql.ManhattanEdgeRouter=ss;ss.KIND="manhattan"});var zm=f(zn=>{"use strict";var Fm=zn&&zn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nm,Lm,Bm;Object.defineProperty(zn,"__esModule",{value:!0});zn.ManhattanEllipticAnchor=zn.ManhattanDiamondAnchor=zn.ManhattanRectangularAnchor=void 0;var jl=ee(),Ft=Or(),Vm=oi(),Km=Dl(),Hm=_(),Nl=Nm=class{get kind(){return Nm.KIND}getAnchor(e,t,n){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n};return t.x>=o.x&&o.x+o.width>=t.x?t.y<o.y+.5*o.height?{x:t.x,y:o.y}:{x:t.x,y:o.y+o.height}:t.y>=o.y&&o.y+o.height>=t.y?t.x<o.x+.5*o.width?{x:o.x,y:t.y}:{x:o.x+o.width,y:t.y}:jl.Bounds.center(o)}};Nl.KIND=Km.ManhattanEdgeRouter.KIND+":"+Vm.RECTANGULAR_ANCHOR_KIND;Nl=Nm=Fm([(0,Hm.injectable)()],Nl);zn.ManhattanRectangularAnchor=Nl;var Ll=Lm=class{get kind(){return Lm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=jl.Bounds.center(o),a,c;return t.x>=o.x&&t.x<=o.x+o.width?o.x+.5*o.width>=t.x?(c=new Ft.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height})):(c=new Ft.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height})):t.y>=o.y&&t.y<=o.y+o.height&&(o.y+.5*o.height>=t.y?(c=new Ft.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y})):(c=new Ft.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height}))),c&&a?(0,Ft.intersection)(a,c):s}};Ll.KIND=Km.ManhattanEdgeRouter.KIND+":"+Vm.DIAMOND_ANCHOR_KIND;Ll=Lm=Fm([(0,Hm.injectable)()],Ll);zn.ManhattanDiamondAnchor=Ll;var Bl=Bm=class{get kind(){return Bm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=jl.Bounds.center(o),a=jl.Point.subtract(t,s),c=s.x,u=s.y;if(t.x>=o.x&&o.x+o.width>=t.x){c+=a.x;let d=.5*o.height*Math.sqrt(1-a.x*a.x/(.25*o.width*o.width));a.y<0?u-=d:u+=d}else if(t.y>=o.y&&o.y+o.height>=t.y){u+=a.y;let d=.5*o.width*Math.sqrt(1-a.y*a.y/(.25*o.height*o.height));a.x<0?c-=d:c+=d}return{x:c,y:u}}};Bl.KIND=Km.ManhattanEdgeRouter.KIND+":"+Vm.ELLIPTIC_ANCHOR_KIND;Bl=Bm=Fm([(0,Hm.injectable)()],Bl);zn.ManhattanEllipticAnchor=Bl});var Um=f(as=>{"use strict";var Vj=as&&as.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(as,"__esModule",{value:!0});as.RoutableView=void 0;var Kj=_(),Hj=_e(),Ym=class{isVisible(e,t,n){if(n.targetKind==="hidden"||t.length===0)return!0;let r=(0,Hj.getAbsoluteRouteBounds)(e,t),o=e.root.canvasBounds;return r.x<=o.width&&r.x+r.width>=0&&r.y<=o.height&&r.y+r.height>=0}};Ym=Vj([(0,Kj.injectable)()],Ym);as.RoutableView=Ym});var km=f(Ui=>{"use strict";var G0=Ui&&Ui.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},zj=Ui&&Ui.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ui,"__esModule",{value:!0});Ui.ModelRequestCommand=void 0;var $0=_(),Yj=P(),Uj=me(),Fl=class extends Uj.SystemCommand{execute(e){let t=this.retrieveResult(e);return this.actionDispatcher.dispatch(t),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};G0([(0,$0.inject)(Yj.TYPES.IActionDispatcher),zj("design:type",Object)],Fl.prototype,"actionDispatcher",void 0);Fl=G0([(0,$0.injectable)()],Fl);Ui.ModelRequestCommand=Fl});var Wl=f(se=>{"use strict";var kl=se&&se.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Gl=se&&se.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Xm=se&&se.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(se,"__esModule",{value:!0});se.SelectKeyboardListener=se.GetSelectionCommand=se.SelectMouseListener=se.SelectAllCommand=se.SelectCommand=se.SelectionResult=se.GetSelectionAction=se.SelectAllAction=se.SelectAction=void 0;var ki=_(),$l=ie(),J0=me(),kj=km(),$m=G(),Gm=ze(),Jm=P(),Gj=un(),$j=At(),Wj=Be(),W0=Tn(),Z0=or(),Xj=On(),X0=_a(),Jj=vd(),Vl=Fa(),Zj=_e(),Kl=_e(),di=Et(),Yn=class{constructor(e=[],t=[]){this.selectedElementsIDs=e,this.deselectedElementsIDs=t,this.kind=Yn.KIND}};se.SelectAction=Yn;Yn.KIND="elementSelected";var Nr=class{constructor(e=!0){this.select=e,this.kind=Nr.KIND}};se.SelectAllAction=Nr;Nr.KIND="allSelected";var Q0;(function(i){i.KIND="getSelection";function e(){return{kind:i.KIND,requestId:(0,$l.generateRequestId)()}}i.create=e})(Q0=se.GetSelectionAction||(se.GetSelectionAction={}));var ew;(function(i){i.KIND="selectionResult";function e(t,n){return{kind:i.KIND,selectedElementsIDs:t,responseId:n}}i.create=e})(ew=se.SelectionResult||(se.SelectionResult={}));var Hl=class extends J0.Command{constructor(e){super(),this.action=e,this.selected=[],this.deselected=[]}execute(e){let t=e.root;return this.action.selectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof $m.SChildElement&&(0,di.isSelectable)(r)&&this.selected.push(r)}),this.action.deselectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof $m.SChildElement&&(0,di.isSelectable)(r)&&this.deselected.push(r)}),this.redo(e)}undo(e){for(let t of this.selected)t.selected=!1;for(let t of this.deselected)t.selected=!0;return e.root}redo(e){for(let t of this.deselected)t.selected=!1;for(let t of this.selected)t.selected=!0;return e.root}};Hl.KIND=$l.SelectAction.KIND;Hl=kl([(0,ki.injectable)(),Xm(0,(0,ki.inject)(Jm.TYPES.Action)),Gl("design:paramtypes",[Object])],Hl);se.SelectCommand=Hl;var zl=class extends J0.Command{constructor(e){super(),this.action=e,this.previousSelection={}}execute(e){return this.selectAll(e.root,this.action.select),e.root}selectAll(e,t){(0,di.isSelectable)(e)&&(this.previousSelection[e.id]=e.selected,e.selected=t);for(let n of e.children)this.selectAll(n,t)}undo(e){let t=e.root.index;return Object.keys(this.previousSelection).forEach(n=>{let r=t.getById(n);r!==void 0&&(0,di.isSelectable)(r)&&(r.selected=this.previousSelection[n])}),e.root}redo(e){return this.selectAll(e.root,this.action.select),e.root}};zl.KIND=$l.SelectAllAction.KIND;zl=kl([(0,ki.injectable)(),Xm(0,(0,ki.inject)(Jm.TYPES.Action)),Gl("design:paramtypes",[Object])],zl);se.SelectAllCommand=zl;var Yl=class extends $j.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1}mouseDown(e,t){if(t.button!==0)return[];let n=this.handleButton(e,t);if(n)return n;let r=(0,Gm.findParentByFeature)(e,di.isSelectable);if(r!==void 0||e instanceof $m.SModelRoot){this.hasDragged=!1;let o=[];if((0,W0.isCtrlOrCmd)(t)||(o=(0,Z0.toArray)(e.root.index.all().filter(s=>(0,di.isSelectable)(s)&&s.selected&&!(r instanceof Zj.SRoutingHandle&&s===r.parent)))),r!==void 0)if(r.selected){if((0,W0.isCtrlOrCmd)(t))return this.wasSelected=!1,this.handleDeselectTarget(r,t);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(r,o,t);else return this.handleDeselectAll(o,t)}return[]}handleButton(e,t){if(this.buttonHandlerRegistry!==void 0&&e instanceof Jj.SButton&&e.enabled){let n=this.buttonHandlerRegistry.get(e.type);if(n!==void 0)return n.buttonPressed(e)}}handleSelectTarget(e,t,n){let r=[];r.push(new Yn([e.id],t.map(s=>s.id))),r.push($l.BringToFrontAction.create([e.id]));let o=t.filter(s=>s instanceof Kl.SRoutableElement).map(s=>s.id);return e instanceof Kl.SRoutableElement?r.push(Vl.SwitchEditModeAction.create({elementsToActivate:[e.id],elementsToDeactivate:o})):o.length>0&&r.push(Vl.SwitchEditModeAction.create({elementsToDeactivate:o})),r}handleDeselectTarget(e,t){let n=[];return n.push(new Yn([],[e.id])),e instanceof Kl.SRoutableElement&&n.push(Vl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),n}handleDeselectAll(e,t){let n=[];n.push(new Yn([],e.map(o=>o.id)));let r=e.filter(o=>o instanceof Kl.SRoutableElement).map(o=>o.id);return r.length>0&&n.push(Vl.SwitchEditModeAction.create({elementsToDeactivate:r})),n}mouseMove(e,t){return this.hasDragged=!0,[]}mouseUp(e,t){if(t.button===0&&!this.hasDragged){let n=(0,Gm.findParentByFeature)(e,di.isSelectable);if(n!==void 0&&this.wasSelected)return[new Yn([n.id],[])]}return this.hasDragged=!1,[]}decorate(e,t){let n=(0,Gm.findParentByFeature)(t,di.isSelectable);return n!==void 0&&(0,Wj.setClass)(e,"selected",n.selected),e}};kl([(0,ki.inject)(X0.ButtonHandlerRegistry),(0,ki.optional)(),Gl("design:type",X0.ButtonHandlerRegistry)],Yl.prototype,"buttonHandlerRegistry",void 0);se.SelectMouseListener=Yl;var Ul=class extends kj.ModelRequestCommand{constructor(e){super(),this.action=e,this.previousSelection={}}retrieveResult(e){let t=e.root.index.all().filter(n=>(0,di.isSelectable)(n)&&n.selected).map(n=>n.id);return ew.create((0,Z0.toArray)(t),this.action.requestId)}};Ul.KIND=Q0.KIND;Ul=kl([(0,ki.injectable)(),Xm(0,(0,ki.inject)(Jm.TYPES.Action)),Gl("design:paramtypes",[Object])],Ul);se.GetSelectionCommand=Ul;var Wm=class extends Gj.KeyListener{keyDown(e,t){return(0,Xj.matchesKeystroke)(t,"KeyA","ctrlCmd")?[new Nr]:[]}};se.SelectKeyboardListener=Wm});var ey=f(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.UndoRedoKeyListener=Un.RedoAction=Un.UndoAction=void 0;var Zm=On(),Qj=un(),eN=Tn(),tw;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(tw=Un.UndoAction||(Un.UndoAction={}));var nw;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(nw=Un.RedoAction||(Un.RedoAction={}));var Qm=class extends Qj.KeyListener{keyDown(e,t){return(0,Zm.matchesKeystroke)(t,"KeyZ","ctrlCmd")?[tw.create()]:(0,Zm.matchesKeystroke)(t,"KeyZ","ctrlCmd","shift")||!(0,eN.isMac)()&&(0,Zm.matchesKeystroke)(t,"KeyY","ctrlCmd")?[nw.create()]:[]}};Un.UndoRedoKeyListener=Qm});var Xl=f(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});Gi.applyMatches=Gi.ModelMatcher=Gi.forEachMatch=void 0;var ty=G(),tN=hr();function nN(i,e){Object.keys(i).forEach(t=>e(t,i[t]))}Gi.forEachMatch=nN;var ny=class{match(e,t){let n={};return this.matchLeft(e,n),this.matchRight(t,n),n}matchLeft(e,t,n){let r=t[e.id];if(r!==void 0?(r.left=e,r.leftParentId=n):(r={left:e,leftParentId:n},t[e.id]=r),(0,ty.isParent)(e))for(let o of e.children)this.matchLeft(o,t,e.id)}matchRight(e,t,n){let r=t[e.id];if(r!==void 0?(r.right=e,r.rightParentId=n):(r={right:e,rightParentId:n},t[e.id]=r),(0,ty.isParent)(e))for(let o of e.children)this.matchRight(o,t,e.id)}};Gi.ModelMatcher=ny;function iN(i,e,t){i instanceof ty.SModelRoot?t=i.index:t===void 0&&(t=new tN.SModelIndex,t.add(i));for(let n of e){let r=!1;if(n.left!==void 0&&n.leftParentId!==void 0){let o=t.getById(n.leftParentId);if(o!==void 0&&o.children!==void 0){let s=o.children.indexOf(n.left);s>=0&&(n.right!==void 0&&n.leftParentId===n.rightParentId?(o.children.splice(s,1,n.right),r=!0):o.children.splice(s,1)),t.remove(n.left)}}if(!r&&n.right!==void 0&&n.rightParentId!==void 0){let o=t.getById(n.rightParentId);o!==void 0&&(o.children===void 0&&(o.children=[]),o.children.push(n.right))}}}Gi.applyMatches=iN});var iw=f(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.ResizeAnimation=void 0;var rN=ur(),iy=class extends rN.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementResizes=t,this.reverse=r}tween(e){return this.elementResizes.forEach(t=>{let n=t.element,r=this.reverse?{width:(1-e)*t.toDimension.width+e*t.fromDimension.width,height:(1-e)*t.toDimension.height+e*t.fromDimension.height}:{width:(1-e)*t.fromDimension.width+e*t.toDimension.width,height:(1-e)*t.fromDimension.height+e*t.toDimension.height};n.bounds={x:n.bounds.x,y:n.bounds.y,width:r.width,height:r.height}}),this.model}};Jl.ResizeAnimation=iy});var Ql=f(on=>{"use strict";var gw=on&&on.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},mw=on&&on.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},oN=on&&on.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(on,"__esModule",{value:!0});on.UpdateModelCommand=on.UpdateModelAction=void 0;var Zl=_(),sN=ie(),cs=ee(),rw=ur(),aN=me(),cN=fl(),us=G(),ow=Za(),sw=qo(),aw=qi(),cw=ue(),uw=Dd(),dw=Et(),lw=Xl(),uN=iw(),dN=P(),fw=qn(),hw=pn(),pw=_e(),lN=ze(),ds=class{constructor(e,t=!0,n){this.animate=t,this.cause=n,this.kind=ds.KIND,e.id!==void 0?this.newRoot=e:this.matches=e}};on.UpdateModelAction=ds;ds.KIND="updateModel";var ec=class extends aN.Command{constructor(e){super(),this.action=e}execute(e){let t;return this.action.newRoot!==void 0?t=e.modelFactory.createRoot(this.action.newRoot):(t=e.modelFactory.createRoot(e.root),this.action.matches!==void 0&&this.applyMatches(t,this.action.matches,e)),this.oldRoot=e.root,this.newRoot=t,this.performUpdate(this.oldRoot,this.newRoot,e)}performUpdate(e,t,n){if((this.action.animate===void 0||this.action.animate)&&e.id===t.id){let r;this.action.matches===void 0?r=new lw.ModelMatcher().match(e,t):r=this.convertToMatchResult(this.action.matches,e,t);let o=this.computeAnimation(t,r,n);return o instanceof rw.Animation?o.start():o}else return e.type===t.type&&cs.Dimension.isValid(e.canvasBounds)&&(t.canvasBounds=e.canvasBounds),(0,fw.isViewport)(e)&&(0,fw.isViewport)(t)&&(t.zoom=e.zoom,t.scroll=e.scroll),t}applyMatches(e,t,n){let r=e.index;for(let o of t)if(o.left!==void 0){let s=r.getById(o.left.id);s instanceof us.SChildElement&&s.parent.remove(s)}for(let o of t)if(o.right!==void 0){let s=n.modelFactory.createElement(o.right),a;o.rightParentId!==void 0&&(a=r.getById(o.rightParentId)),a instanceof us.SParentElement?a.add(s):e.add(s)}}convertToMatchResult(e,t,n){let r={};for(let o of e){let s={},a;o.left!==void 0&&(a=o.left.id,s.left=t.index.getById(a),s.leftParentId=o.leftParentId),o.right!==void 0&&(a=o.right.id,s.right=n.index.getById(a),s.rightParentId=o.rightParentId),a!==void 0&&(r[a]=s)}return r}computeAnimation(e,t,n){let r={fades:[]};(0,lw.forEachMatch)(t,(s,a)=>{if(a.left!==void 0&&a.right!==void 0)this.updateElement(a.left,a.right,r);else if(a.right!==void 0){let c=a.right;(0,sw.isFadeable)(c)&&(c.opacity=0,r.fades.push({element:c,type:"in"}))}else if(a.left instanceof us.SChildElement){let c=a.left;if((0,sw.isFadeable)(c)&&a.leftParentId!==void 0&&!(0,lN.containsSome)(e,c)){let u=e.index.getById(a.leftParentId);if(u instanceof us.SParentElement){let d=n.modelFactory.createElement(c);u.add(d),r.fades.push({element:d,type:"out"})}}}});let o=this.createAnimations(r,e,n);return o.length>=2?new rw.CompoundAnimation(e,n,o):o.length===1?o[0]:e}updateElement(e,t,n){if((0,aw.isLocateable)(e)&&(0,aw.isLocateable)(t)){let r=e.position,o=t.position;(!(0,cs.almostEquals)(r.x,o.x)||!(0,cs.almostEquals)(r.y,o.y))&&(n.moves===void 0&&(n.moves=[]),n.moves.push({element:t,fromPosition:r,toPosition:o}),t.position=r)}(0,cw.isSizeable)(e)&&(0,cw.isSizeable)(t)&&(cs.Dimension.isValid(t.bounds)?(!(0,cs.almostEquals)(e.bounds.width,t.bounds.width)||!(0,cs.almostEquals)(e.bounds.height,t.bounds.height))&&(n.resizes===void 0&&(n.resizes=[]),n.resizes.push({element:t,fromDimension:{width:e.bounds.width,height:e.bounds.height},toDimension:{width:t.bounds.width,height:t.bounds.height}})):t.bounds={x:t.bounds.x,y:t.bounds.y,width:e.bounds.width,height:e.bounds.height}),e instanceof pw.SRoutableElement&&t instanceof pw.SRoutableElement&&this.edgeRouterRegistry&&(n.edgeMementi===void 0&&(n.edgeMementi=[]),n.edgeMementi.push({edge:t,before:this.takeSnapshot(e),after:this.takeSnapshot(t)})),(0,dw.isSelectable)(e)&&(0,dw.isSelectable)(t)&&(t.selected=e.selected),e instanceof us.SModelRoot&&t instanceof us.SModelRoot&&(t.canvasBounds=e.canvasBounds),e instanceof uw.ViewportRootElement&&t instanceof uw.ViewportRootElement&&(t.scroll=e.scroll,t.zoom=e.zoom)}takeSnapshot(e){return this.edgeRouterRegistry.get(e.routerKind).takeSnapshot(e)}createAnimations(e,t,n){let r=[];if(e.fades.length>0&&r.push(new cN.FadeAnimation(t,e.fades,n,!0)),e.moves!==void 0&&e.moves.length>0){let o=new Map;for(let s of e.moves)o.set(s.element.id,s);r.push(new ow.MoveAnimation(t,o,n,!1))}if(e.resizes!==void 0&&e.resizes.length>0){let o=new Map;for(let s of e.resizes)o.set(s.element.id,s);r.push(new uN.ResizeAnimation(t,o,n,!1))}return e.edgeMementi!==void 0&&e.edgeMementi.length>0&&r.push(new ow.MorphEdgesAnimation(t,e.edgeMementi,n,!1)),r}undo(e){return this.performUpdate(this.newRoot,this.oldRoot,e)}redo(e){return this.performUpdate(this.oldRoot,this.newRoot,e)}};ec.KIND=sN.UpdateModelAction.KIND;gw([(0,Zl.inject)(hw.EdgeRouterRegistry),(0,Zl.optional)(),mw("design:type",hw.EdgeRouterRegistry)],ec.prototype,"edgeRouterRegistry",void 0);ec=gw([(0,Zl.injectable)(),oN(0,(0,Zl.inject)(dN.TYPES.Action)),mw("design:paramtypes",[Object])],ec);on.UpdateModelCommand=ec});var hs=f(Ee=>{"use strict";var yw=Ee&&Ee.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_w=Ee&&Ee.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},vw=Ee&&Ee.__param||function(i,e){return function(t,n){e(t,n,i)}},ry;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ViewportAnimation=Ee.GetViewportCommand=Ee.SetViewportCommand=Ee.ViewportResult=Ee.GetViewportAction=Ee.SetViewportAction=void 0;var oy=_(),bw=ie(),fN=ee(),hN=me(),pN=ur(),Sw=qn(),Ew=P(),gN=km(),fs=class{constructor(e,t,n){this.elementId=e,this.newViewport=t,this.animate=n,this.kind=fs.KIND}};Ee.SetViewportAction=fs;fs.KIND="viewport";var ww;(function(i){i.KIND="getViewport";function e(){return{kind:i.KIND,requestId:(0,bw.generateRequestId)()}}i.create=e})(ww=Ee.GetViewportAction||(Ee.GetViewportAction={}));var Pw;(function(i){i.KIND="viewportResult";function e(t,n,r){return{kind:i.KIND,viewport:t,canvasBounds:n,responseId:r}}i.create=e})(Pw=Ee.ViewportResult||(Ee.ViewportResult={}));var ef=ry=class extends hN.MergeableCommand{constructor(e){super(),this.action=e,this.newViewport=e.newViewport}execute(e){let t=e.root,n=t.index.getById(this.action.elementId);if(n&&(0,Sw.isViewport)(n)){if(this.element=n,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom},this.action.animate)return new ls(this.element,this.oldViewport,this.newViewport,e).start();this.element.scroll=this.newViewport.scroll,this.element.zoom=this.newViewport.zoom}return t}undo(e){return new ls(this.element,this.newViewport,this.oldViewport,e).start()}redo(e){return new ls(this.element,this.oldViewport,this.newViewport,e).start()}merge(e,t){return!this.action.animate&&e instanceof ry&&this.element===e.element?(this.newViewport=e.newViewport,!0):!1}};ef.KIND=bw.SetViewportAction.KIND;ef=ry=yw([(0,oy.injectable)(),vw(0,(0,oy.inject)(Ew.TYPES.Action)),_w("design:paramtypes",[Object])],ef);Ee.SetViewportCommand=ef;var tf=class extends gN.ModelRequestCommand{constructor(e){super(),this.action=e}retrieveResult(e){let t=e.root,n;return(0,Sw.isViewport)(t)?n={scroll:t.scroll,zoom:t.zoom}:n={scroll:fN.Point.ORIGIN,zoom:1},Pw.create(n,t.canvasBounds,this.action.requestId)}};tf.KIND=ww.KIND;tf=yw([vw(0,(0,oy.inject)(Ew.TYPES.Action)),_w("design:paramtypes",[Object])],tf);Ee.GetViewportCommand=tf;var ls=class extends pN.Animation{constructor(e,t,n,r){super(r),this.element=e,this.oldViewport=t,this.newViewport=n,this.context=r,this.zoomFactor=Math.log(n.zoom/t.zoom)}tween(e,t){return this.element.scroll={x:(1-e)*this.oldViewport.scroll.x+e*this.newViewport.scroll.x,y:(1-e)*this.oldViewport.scroll.y+e*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(e*this.zoomFactor),t.root}};Ee.ViewportAnimation=ls});var sf=f(Ae=>{"use strict";var cy=Ae&&Ae.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},uy=Ae&&Ae.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Mw=Ae&&Ae.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.CenterKeyboardListener=Ae.FitToScreenCommand=Ae.CenterCommand=Ae.BoundsAwareViewportCommand=Ae.FitToScreenAction=Ae.CenterAction=void 0;var Tw=ie(),ps=ee(),Iw=On(),mN=G(),yN=me(),_N=un(),sy=ue(),vN=Et(),Rw=hs(),nf=qn(),dy=_(),Ow=P(),Lr=class{constructor(e,t=!0,n=!1){this.elementIds=e,this.animate=t,this.retainZoom=n,this.kind=Lr.KIND}};Ae.CenterAction=Lr;Lr.KIND="center";var Br=class{constructor(e,t,n,r=!0){this.elementIds=e,this.padding=t,this.maxZoom=n,this.animate=r,this.kind=Br.KIND}};Ae.FitToScreenAction=Br;Br.KIND="fit";var tc=class extends yN.Command{constructor(e){super(),this.animate=e}initialize(e){if((0,nf.isViewport)(e)){this.oldViewport={scroll:e.scroll,zoom:e.zoom};let t=[];if(this.getElementIds().forEach(n=>{let r=e.index.getById(n);r&&(0,sy.isBoundsAware)(r)&&t.push(this.boundsInViewport(r,r.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,vN.isSelectable)(n)&&n.selected&&(0,sy.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,sy.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length!==0){let n=t.reduce((r,o)=>ps.Bounds.combine(r,o));ps.Dimension.isValid(n)&&(this.newViewport=this.getNewViewport(n,e))}}}boundsInViewport(e,t,n){return e instanceof mN.SChildElement&&e.parent!==n?this.boundsInViewport(e.parent,e.parent.localToParent(t),n):t}execute(e){return this.initialize(e.root),this.redo(e)}undo(e){let t=e.root;if((0,nf.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new Rw.ViewportAnimation(t,this.newViewport,this.oldViewport,e).start();t.scroll=this.oldViewport.scroll,t.zoom=this.oldViewport.zoom}return t}redo(e){let t=e.root;if((0,nf.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new Rw.ViewportAnimation(t,this.oldViewport,this.newViewport,e).start();t.scroll=this.newViewport.scroll,t.zoom=this.newViewport.zoom}return t}equal(e,t){return e.zoom===t.zoom&&e.scroll.x===t.scroll.x&&e.scroll.y===t.scroll.y}};tc=cy([(0,dy.injectable)(),uy("design:paramtypes",[Boolean])],tc);Ae.BoundsAwareViewportCommand=tc;var rf=class extends tc{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ps.Dimension.isValid(t.canvasBounds))return;let n=this.action.retainZoom&&(0,nf.isViewport)(t)?t.zoom:1,r=ps.Bounds.center(e);return{scroll:{x:r.x-.5*t.canvasBounds.width/n,y:r.y-.5*t.canvasBounds.height/n},zoom:n}}};rf.KIND=Tw.CenterAction.KIND;rf=cy([Mw(0,(0,dy.inject)(Ow.TYPES.Action)),uy("design:paramtypes",[Object])],rf);Ae.CenterCommand=rf;var of=class extends tc{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ps.Dimension.isValid(t.canvasBounds))return;let n=ps.Bounds.center(e),r=this.action.padding===void 0?0:2*this.action.padding,o=Math.min(t.canvasBounds.width/(e.width+r),t.canvasBounds.height/(e.height+r));return this.action.maxZoom!==void 0&&(o=Math.min(o,this.action.maxZoom)),o===1/0&&(o=1),{scroll:{x:n.x-.5*t.canvasBounds.width/o,y:n.y-.5*t.canvasBounds.height/o},zoom:o}}};of.KIND=Tw.FitToScreenAction.KIND;of=cy([Mw(0,(0,dy.inject)(Ow.TYPES.Action)),uy("design:paramtypes",[Object])],of);Ae.FitToScreenCommand=of;var ay=class extends _N.KeyListener{keyDown(e,t){return(0,Iw.matchesKeystroke)(t,"KeyC","ctrlCmd","shift")?[new Lr([])]:(0,Iw.matchesKeystroke)(t,"KeyF","ctrlCmd","shift")?[new Br([])]:[]}};Ae.CenterKeyboardListener=ay});var hy=f(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.ScrollMouseListener=gs.isScrollable=void 0;var ly=ie(),bN=G(),SN=At(),nc=ze(),af=qn(),EN=qi(),wN=_e(),PN=Rl(),IN=Tn();function RN(i){return"scroll"in i}gs.isScrollable=RN;var fy=class extends SN.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(e,t){if((0,nc.findParentByFeature)(e,EN.isMoveable)===void 0&&!(e instanceof wN.SRoutingHandle)){let r=(0,nc.findParentByFeature)(e,af.isViewport);if(r){if(this.lastScrollPosition={x:t.pageX,y:t.pageY},this.scrollbar=this.getScrollbar(t),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(r,t,this.scrollbar,!0).map(o=>new Promise(s=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>s(o),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(e,t){if(t.buttons===0)return this.mouseUp(e,t);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);let n=(0,nc.findParentByFeature)(e,af.isViewport);if(n)return this.moveScrollBar(n,t,this.scrollbar)}if(this.lastScrollPosition){let n=(0,nc.findParentByFeature)(e,af.isViewport);if(n)return this.dragCanvas(n,t,this.lastScrollPosition)}return[]}mouseEnter(e,t){return e instanceof bN.SModelRoot&&t.buttons===0&&this.mouseUp(e,t),[]}mouseUp(e,t){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(e,t){if((0,nc.findParentByFeature)(e,af.isViewport)){let r=this.getScrollbar(t);if(r){window.clearTimeout(this.scrollbarMouseDownTimeout);let o=this.findClickTarget(r,t),s;if(o&&o.id.startsWith("horizontal-projection:")?s=o.id.substring(22):o&&o.id.startsWith("vertical-projection:")&&(s=o.id.substring(20)),s)return[ly.CenterAction.create([s],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(e,t,n){let r=(t.pageX-n.x)/e.zoom,o=(t.pageY-n.y)/e.zoom,s={scroll:{x:e.scroll.x-r,y:e.scroll.y-o},zoom:e.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[ly.SetViewportAction.create(e.id,s,{animate:!1})]}moveScrollBar(e,t,n,r=!1){let o=(0,PN.getModelBounds)(e);if(!o||e.zoom<=0)return[];let s=n.getBoundingClientRect(),a;if(this.getScrollbarOrientation(n)==="horizontal"){if(s.width<=0)return[];let c=e.canvasBounds.width/(e.zoom*o.width)*s.width,u=t.clientX-s.x-c/2;u<0?u=0:u>s.width-c&&(u=s.width-c),a={x:o.x+u/s.width*o.width,y:e.scroll.y}}else{if(s.height<=0)return[];let c=e.canvasBounds.height/(e.zoom*o.height)*s.height,u=t.clientY-s.y-c/2;u<0?u=0:u>s.height-c&&(u=s.height-c),a={x:e.scroll.x,y:o.y+u/s.height*o.height}}return[ly.SetViewportAction.create(e.id,{scroll:a,zoom:e.zoom},{animate:r})]}getScrollbar(e){let t=e.target;for(;t;){if(t.classList&&t.classList.contains("sprotty-projection-bar"))return t;t=t.parentElement}}getScrollbarOrientation(e){return e.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(e,t){let n=Array.from(e.children).filter(r=>r.id&&r.classList.contains("sprotty-projection")&&(0,IN.hitsMouseEvent)(r,t));if(n.length>0)return n[n.length-1]}};gs.ScrollMouseListener=fy});var py=f(Vt=>{"use strict";var MN=Vt&&Vt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},TN=Vt&&Vt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ON=Vt&&Vt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.BringToFrontCommand=Vt.BringToFrontAction=void 0;var Aw=_(),AN=P(),Cw=G(),CN=me(),xw=_e(),qw;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(qw=Vt.BringToFrontAction||(Vt.BringToFrontAction={}));var cf=class extends CN.Command{constructor(e){super(),this.action=e,this.selected=[]}execute(e){let t=e.root;return this.action.elementIDs.forEach(n=>{let r=t.index.getById(n);r instanceof xw.SRoutableElement&&(r.source&&this.addToSelection(r.source),r.target&&this.addToSelection(r.target)),r instanceof Cw.SChildElement&&this.addToSelection(r),this.includeConnectedEdges(r)}),this.redo(e)}includeConnectedEdges(e){if(e instanceof xw.SConnectableElement&&(e.incomingEdges.forEach(t=>this.addToSelection(t)),e.outgoingEdges.forEach(t=>this.addToSelection(t))),e instanceof Cw.SParentElement)for(let t of e.children)this.includeConnectedEdges(t)}addToSelection(e){this.selected.push({element:e,index:e.parent.children.indexOf(e)})}undo(e){for(let t=this.selected.length-1;t>=0;t--){let n=this.selected[t],r=n.element;r.parent.move(r,n.index)}return e.root}redo(e){for(let t=0;t<this.selected.length;t++)this.bringToFront(this.selected[t]);return e.root}bringToFront(e){let t=e.element,n=t.parent.children.length;t.parent.move(t,n-1)}};cf.KIND=qw.KIND;cf=MN([(0,Aw.injectable)(),ON(0,(0,Aw.inject)(AN.TYPES.Action)),TN("design:paramtypes",[Object])],cf);Vt.BringToFrontCommand=cf});var my=f(ms=>{"use strict";var xN=ms&&ms.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ms,"__esModule",{value:!0});ms.SGraphFactory=void 0;var qN=_(),Fr=Pi(),$i=Mn(),uf=G(),sn=Rr(),Dw=vd(),gy=class extends $i.SModelFactory{constructor(){super(...arguments),this.defaultGraphFeatures=(0,$i.createFeatureSet)(sn.SGraph.DEFAULT_FEATURES),this.defaultNodeFeatures=(0,$i.createFeatureSet)(sn.SNode.DEFAULT_FEATURES),this.defaultPortFeatures=(0,$i.createFeatureSet)(sn.SPort.DEFAULT_FEATURES),this.defaultEdgeFeatures=(0,$i.createFeatureSet)(sn.SEdge.DEFAULT_FEATURES),this.defaultLabelFeatures=(0,$i.createFeatureSet)(sn.SLabel.DEFAULT_FEATURES),this.defaultCompartmentFeatures=(0,$i.createFeatureSet)(sn.SCompartment.DEFAULT_FEATURES),this.defaultButtonFeatures=(0,$i.createFeatureSet)(Dw.SButton.DEFAULT_FEATURES)}createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof uf.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else this.isNodeSchema(e)?(n=new sn.SNode,n.features=this.defaultNodeFeatures):this.isPortSchema(e)?(n=new sn.SPort,n.features=this.defaultPortFeatures):this.isEdgeSchema(e)?(n=new sn.SEdge,n.features=this.defaultEdgeFeatures):this.isLabelSchema(e)?(n=new sn.SLabel,n.features=this.defaultLabelFeatures):this.isCompartmentSchema(e)?(n=new sn.SCompartment,n.features=this.defaultCompartmentFeatures):this.isButtonSchema(e)?(n=new Dw.SButton,n.features=this.defaultButtonFeatures):n=new uf.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof uf.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else this.isGraphSchema(e)?(t=new sn.SGraph,t.features=this.defaultGraphFeatures):t=new uf.SModelRoot;return this.initializeRoot(t,e)}isGraphSchema(e){return(0,Fr.getBasicType)(e)==="graph"}isNodeSchema(e){return(0,Fr.getBasicType)(e)==="node"}isPortSchema(e){return(0,Fr.getBasicType)(e)==="port"}isEdgeSchema(e){return(0,Fr.getBasicType)(e)==="edge"}isLabelSchema(e){return(0,Fr.getBasicType)(e)==="label"}isCompartmentSchema(e){return(0,Fr.getBasicType)(e)==="comp"}isButtonSchema(e){return(0,Fr.getBasicType)(e)==="button"}};gy=xN([(0,qN.injectable)()],gy);ms.SGraphFactory=gy});var jw=f(yy=>{"use strict";Object.defineProperty(yy,"__esModule",{value:!0});var DN=_(),jN=P(),NN=my(),LN=new DN.ContainerModule((i,e,t,n)=>{n(jN.TYPES.IModelFactory).to(NN.SGraphFactory).inSingletonScope()});yy.default=LN});var by=f(vy=>{"use strict";Object.defineProperty(vy,"__esModule",{value:!0});var BN=_(),_y=P(),Nw=sd(),Lw=wp(),ic=ud(),Bw=yt(),Fw=Tp(),Vw=Mp(),Kw=Op(),FN=new BN.ContainerModule((i,e,t)=>{(0,Bw.configureCommand)({bind:i,isBound:t},Nw.SetBoundsCommand),(0,Bw.configureCommand)({bind:i,isBound:t},Nw.RequestBoundsCommand),i(Lw.HiddenBoundsUpdater).toSelf().inSingletonScope(),i(_y.TYPES.HiddenVNodePostprocessor).toService(Lw.HiddenBoundsUpdater),i(_y.TYPES.Layouter).to(ic.Layouter).inSingletonScope(),i(_y.TYPES.LayoutRegistry).to(ic.LayoutRegistry).inSingletonScope(),(0,ic.configureLayout)({bind:i,isBound:t},Vw.VBoxLayouter.KIND,Vw.VBoxLayouter),(0,ic.configureLayout)({bind:i,isBound:t},Fw.HBoxLayouter.KIND,Fw.HBoxLayouter),(0,ic.configureLayout)({bind:i,isBound:t},Kw.StackLayouter.KIND,Kw.StackLayouter)});vy.default=FN});var Ey=f(Sy=>{"use strict";Object.defineProperty(Sy,"__esModule",{value:!0});var VN=_(),KN=_a(),HN=new VN.ContainerModule(i=>{i(KN.ButtonHandlerRegistry).toSelf().inSingletonScope()});Sy.default=HN});var Iy=f(Py=>{"use strict";Object.defineProperty(Py,"__esModule",{value:!0});var zN=_(),wy=P(),Hw=bd(),df=Up(),YN=new zN.ContainerModule(i=>{i(df.CommandPalette).toSelf().inSingletonScope(),i(wy.TYPES.IUIExtension).toService(df.CommandPalette),i(df.CommandPaletteKeyListener).toSelf().inSingletonScope(),i(wy.TYPES.KeyListener).toService(df.CommandPaletteKeyListener),i(Hw.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),i(wy.TYPES.ICommandPaletteActionProviderRegistry).toService(Hw.CommandPaletteActionProviderRegistry)});Py.default=YN});var My=f(Ry=>{"use strict";Object.defineProperty(Ry,"__esModule",{value:!0});var UN=_(),kN=Rd(),zw=Jp(),rc=P(),GN=new UN.ContainerModule(i=>{i(rc.TYPES.IContextMenuServiceProvider).toProvider(e=>()=>new Promise((t,n)=>{e.container.isBound(rc.TYPES.IContextMenuService)?t(e.container.get(rc.TYPES.IContextMenuService)):n()})),i(zw.ContextMenuMouseListener).toSelf().inSingletonScope(),i(rc.TYPES.MouseListener).toService(zw.ContextMenuMouseListener),i(rc.TYPES.IContextMenuProviderRegistry).to(kN.ContextMenuProviderRegistry)});Ry.default=GN});var Oy=f(Ty=>{"use strict";Object.defineProperty(Ty,"__esModule",{value:!0});var $N=go(),WN=_(),XN=gl(),JN=Qg(),ZN=P(),Yw=em(),QN=new WN.ContainerModule((i,e,t)=>{(0,$N.configureModelElement)({bind:i,isBound:t},"marker",XN.SIssueMarker,JN.IssueMarkerView),i(Yw.DecorationPlacer).toSelf().inSingletonScope(),i(ZN.TYPES.IVNodePostprocessor).toService(Yw.DecorationPlacer)});Ty.default=QN});var kw=f(Ay=>{"use strict";Object.defineProperty(Ay,"__esModule",{value:!0});var eL=_(),tL=P(),Uw=_l(),nL=new eL.ContainerModule(i=>{i(Uw.IntersectionFinder).toSelf().inSingletonScope(),i(tL.TYPES.IEdgeRoutePostprocessor).toService(Uw.IntersectionFinder)});Ay.default=nL});var xy=f(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var iL=_(),rL=_a(),Gw=Bg(),oL=new iL.ContainerModule((i,e,t)=>{(0,rL.configureButtonHandler)({bind:i,isBound:t},Gw.ExpandButtonHandler.TYPE,Gw.ExpandButtonHandler)});Cy.default=oL});var jy=f(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});var sL=_(),qy=P(),lf=Hg(),aL=Ar(),cL=yt(),uL=new sL.ContainerModule((i,e,t)=>{i(lf.ExportSvgKeyListener).toSelf().inSingletonScope(),i(qy.TYPES.KeyListener).toService(lf.ExportSvgKeyListener),i(qy.TYPES.HiddenVNodePostprocessor).to(lf.ExportSvgPostprocessor).inSingletonScope(),(0,cL.configureCommand)({bind:i,isBound:t},lf.ExportSvgCommand),i(qy.TYPES.SvgExporter).to(aL.SvgExporter).inSingletonScope()});Dy.default=uL});var Ly=f(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});var dL=_(),lL=P(),fL=fl(),hL=new dL.ContainerModule(i=>{i(lL.TYPES.IVNodePostprocessor).to(fL.ElementFader).inSingletonScope()});Ny.default=hL});var Xw=f(Wi=>{"use strict";var $w=Wi&&Wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},pL=Wi&&Wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.PopupPositionUpdater=void 0;var Ww=_(),gL=P(),ff=class{decorate(e,t){return e}postUpdate(){let e=document.getElementById(this.options.popupDiv);if(e!==null&&typeof window<"u"){let t=e.getBoundingClientRect();window.innerHeight<t.height+t.top&&(e.style.top=window.pageYOffset+window.innerHeight-t.height-5+"px"),window.innerWidth<t.left+t.width&&(e.style.left=window.pageXOffset+window.innerWidth-t.width-5+"px"),t.left<0&&(e.style.left="0px"),t.top<0&&(e.style.top="0px")}}};$w([(0,Ww.inject)(gL.TYPES.ViewerOptions),pL("design:type",Object)],ff.prototype,"options",void 0);ff=$w([(0,Ww.injectable)()],ff);Wi.PopupPositionUpdater=ff});var Fy=f(By=>{"use strict";Object.defineProperty(By,"__esModule",{value:!0});var mL=_(),oc=P(),ft=$g(),yL=Xw(),Jw=yt(),sc=Us(),Zw=sf(),_L=hs(),vL=Za(),bL=new mL.ContainerModule((i,e,t)=>{i(oc.TYPES.PopupVNodePostprocessor).to(yL.PopupPositionUpdater).inSingletonScope(),i(ft.HoverMouseListener).toSelf().inSingletonScope(),i(oc.TYPES.MouseListener).toService(ft.HoverMouseListener),i(ft.PopupHoverMouseListener).toSelf().inSingletonScope(),i(oc.TYPES.PopupMouseListener).toService(ft.PopupHoverMouseListener),i(ft.HoverKeyListener).toSelf().inSingletonScope(),i(oc.TYPES.KeyListener).toService(ft.HoverKeyListener),i(oc.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),i(ft.ClosePopupActionHandler).toSelf().inSingletonScope();let n={bind:i,isBound:t};(0,Jw.configureCommand)(n,ft.HoverFeedbackCommand),(0,Jw.configureCommand)(n,ft.SetPopupModelCommand),(0,sc.configureActionHandler)(n,ft.SetPopupModelCommand.KIND,ft.ClosePopupActionHandler),(0,sc.configureActionHandler)(n,Zw.FitToScreenCommand.KIND,ft.ClosePopupActionHandler),(0,sc.configureActionHandler)(n,Zw.CenterCommand.KIND,ft.ClosePopupActionHandler),(0,sc.configureActionHandler)(n,_L.SetViewportCommand.KIND,ft.ClosePopupActionHandler),(0,sc.configureActionHandler)(n,vL.MoveCommand.KIND,ft.ClosePopupActionHandler)});By.default=bL});var Hy=f(Ky=>{"use strict";Object.defineProperty(Ky,"__esModule",{value:!0});var SL=_(),Vy=P(),ys=Za(),EL=yt(),wL=new SL.ContainerModule((i,e,t)=>{i(ys.MoveMouseListener).toSelf().inSingletonScope(),i(Vy.TYPES.MouseListener).toService(ys.MoveMouseListener),(0,EL.configureCommand)({bind:i,isBound:t},ys.MoveCommand),i(ys.LocationPostprocessor).toSelf().inSingletonScope(),i(Vy.TYPES.IVNodePostprocessor).toService(ys.LocationPostprocessor),i(Vy.TYPES.HiddenVNodePostprocessor).toService(ys.LocationPostprocessor)});Ky.default=wL});var Yy=f(zy=>{"use strict";Object.defineProperty(zy,"__esModule",{value:!0});var PL=_(),IL=P(),Qw=pm(),RL=new PL.ContainerModule(i=>{i(Qw.OpenMouseListener).toSelf().inSingletonScope(),i(IL.TYPES.MouseListener).toService(Qw.OpenMouseListener)});zy.default=RL});var Xy=f(Wy=>{"use strict";Object.defineProperty(Wy,"__esModule",{value:!0});var ML=_(),an=P(),eP=Dl(),tP=Oa(),Uy=zm(),ky=Tl(),TL=oi(),OL=pn(),Gy=xl(),$y=Dm(),AL=yt(),CL=new ML.ContainerModule((i,e,t)=>{i(OL.EdgeRouterRegistry).toSelf().inSingletonScope(),i(TL.AnchorComputerRegistry).toSelf().inSingletonScope(),i(eP.ManhattanEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService(eP.ManhattanEdgeRouter),i(an.TYPES.IAnchorComputer).to(Uy.ManhattanEllipticAnchor).inSingletonScope(),i(an.TYPES.IAnchorComputer).to(Uy.ManhattanRectangularAnchor).inSingletonScope(),i(an.TYPES.IAnchorComputer).to(Uy.ManhattanDiamondAnchor).inSingletonScope(),i(tP.PolylineEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService(tP.PolylineEdgeRouter),i(an.TYPES.IAnchorComputer).to(ky.EllipseAnchor),i(an.TYPES.IAnchorComputer).to(ky.RectangleAnchor),i(an.TYPES.IAnchorComputer).to(ky.DiamondAnchor),i(Gy.BezierEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService(Gy.BezierEdgeRouter),i(an.TYPES.IAnchorComputer).to($y.BezierEllipseAnchor),i(an.TYPES.IAnchorComputer).to($y.BezierRectangleAnchor),i(an.TYPES.IAnchorComputer).to($y.BezierDiamondAnchor),(0,AL.configureCommand)({bind:i,isBound:t},Gy.AddRemoveBezierSegmentCommand)});Wy.default=CL});var Qy=f(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var xL=_(),nP=P(),Vr=Wl(),Jy=yt(),qL=new xL.ContainerModule((i,e,t)=>{(0,Jy.configureCommand)({bind:i,isBound:t},Vr.SelectCommand),(0,Jy.configureCommand)({bind:i,isBound:t},Vr.SelectAllCommand),(0,Jy.configureCommand)({bind:i,isBound:t},Vr.GetSelectionCommand),i(Vr.SelectKeyboardListener).toSelf().inSingletonScope(),i(nP.TYPES.KeyListener).toService(Vr.SelectKeyboardListener),i(Vr.SelectMouseListener).toSelf().inSingletonScope(),i(nP.TYPES.MouseListener).toService(Vr.SelectMouseListener)});Zy.default=qL});var t_=f(e_=>{"use strict";Object.defineProperty(e_,"__esModule",{value:!0});var DL=_(),jL=P(),iP=ey(),NL=new DL.ContainerModule(i=>{i(iP.UndoRedoKeyListener).toSelf().inSingletonScope(),i(jL.TYPES.KeyListener).toService(iP.UndoRedoKeyListener)});e_.default=NL});var i_=f(n_=>{"use strict";Object.defineProperty(n_,"__esModule",{value:!0});var LL=_(),BL=yt(),FL=Ql(),VL=new LL.ContainerModule((i,e,t)=>{(0,BL.configureCommand)({bind:i,isBound:t},FL.UpdateModelCommand)});n_.default=VL});var s_=f(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});var KL=_(),r_=P(),hf=sf(),rP=hs(),oP=hy(),sP=nl(),pf=yt(),HL=new KL.ContainerModule((i,e,t)=>{(0,pf.configureCommand)({bind:i,isBound:t},hf.CenterCommand),(0,pf.configureCommand)({bind:i,isBound:t},hf.FitToScreenCommand),(0,pf.configureCommand)({bind:i,isBound:t},rP.SetViewportCommand),(0,pf.configureCommand)({bind:i,isBound:t},rP.GetViewportCommand),i(hf.CenterKeyboardListener).toSelf().inSingletonScope(),i(r_.TYPES.KeyListener).toService(hf.CenterKeyboardListener),i(oP.ScrollMouseListener).toSelf().inSingletonScope(),i(sP.ZoomMouseListener).toSelf().inSingletonScope(),i(r_.TYPES.MouseListener).toService(oP.ScrollMouseListener),i(r_.TYPES.MouseListener).toService(sP.ZoomMouseListener)});o_.default=HL});var c_=f(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});var zL=_(),YL=yt(),UL=py(),kL=new zL.ContainerModule((i,e,t)=>{(0,YL.configureCommand)({bind:i,isBound:t},UL.BringToFrontCommand)});a_.default=kL});var uP=f(le=>{"use strict";var Rt=le&&le.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_f=le&&le.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(le,"__esModule",{value:!0});le.SBezierControlHandleView=le.SBezierCreateHandleView=le.SCompartmentView=le.SLabelView=le.SRoutingHandleView=le.BezierCurveEdgeView=le.PolylineEdgeViewWithGapsOnIntersections=le.JumpingPolylineEdgeView=le.PolylineEdgeView=le.SGraphView=void 0;var Mt=_(),_s=ee(),aP=Pi(),uc=Be(),GL=ma(),ac=_l(),$L=Bo(),vf=_e(),Xi=pn(),cP=Um(),ge=Wt(),WL=Or(),gf=class{render(e,t){let n=this.edgeRouterRegistry.routeAllChildren(e),r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,ge.svg)("svg",{"class-sprotty-graph":!0},(0,ge.svg)("g",{transform:r},t.renderChildren(e,{edgeRouting:n})))}};Rt([(0,Mt.inject)(Xi.EdgeRouterRegistry),_f("design:type",Xi.EdgeRouterRegistry)],gf.prototype,"edgeRouterRegistry",void 0);gf=Rt([(0,Mt.injectable)()],gf);le.SGraphView=gf;var cc=class extends cP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,ge.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,ge.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o=t[0],s=`M ${o.x},${o.y}`;for(let a=1;a<t.length;a++){let c=t[a];s+=` L ${c.x},${c.y}`}return(0,ge.svg)("path",{d:s})}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,ge.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)(Xi.EdgeRouterRegistry),_f("design:type",Xi.EdgeRouterRegistry)],cc.prototype,"edgeRouterRegistry",void 0);cc=Rt([(0,Mt.injectable)()],cc);le.PolylineEdgeView=cc;var mf=class extends cc{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(e,t,n,r){let o="";for(let s=0;s<t.length;s++){let a=t[s];s===0&&(o=`M ${a.x},${a.y}`),(0,ac.isIntersectingRoutedPoint)(a)&&(o+=this.intersectionPath(e,t,a,r)),s!==0&&(o+=` L ${a.x},${a.y}`)}return(0,ge.svg)("path",{d:o})}intersectionPath(e,t,n,r){if(n.intersections.length<1)return"";let o=this.getLineSegment(e,n.intersections[0],r,t),s=this.getIntersectionsSortedBySegmentDirection(o,n),a="";for(let c of s){let u=this.getOtherLineSegment(e,c,r);if(u===void 0)continue;let d=this.getLineSegment(e,c,r,t),l=c.intersectionPoint;this.shouldDrawLineJumpOnIntersection(d,u)?a+=this.createJumpPath(l,d):this.shouldDrawLineGapOnIntersection(d,u)&&(a+=this.createGapPath(l,d))}return a}getIntersectionsSortedBySegmentDirection(e,t){switch(e.direction){case"north":case"north-east":return t.intersections.sort(ac.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return t.intersections.sort(ac.BY_X_THEN_Y);case"south-west":case"west":return t.intersections.sort(ac.BY_DESCENDING_X_THEN_Y);case"north-west":return t.intersections.sort(ac.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(e,t){return Math.abs(e.slopeOrMax)<Math.abs(t.slopeOrMax)}shouldDrawLineGapOnIntersection(e,t){return!this.shouldDrawLineJumpOnIntersection(e,t)}getLineSegment(e,t,n,r){let o=r||this.edgeRouterRegistry.route(e,n),s=t.routable1===e.id?t.segmentIndex1:t.segmentIndex2;return new WL.PointToPointLine(o[s],o[s+1])}getOtherLineSegment(e,t,n){let r=t.routable1===e.id?t.routable2:t.routable1,o=e.index.getById(r);if(o instanceof vf.SRoutableElement)return this.getLineSegment(o,t,n)}createJumpPath(e,t){let n=_s.Point.shiftTowards(e,t.p1,this.jumpOffsetBefore),r=_s.Point.shiftTowards(e,t.p2,this.jumpOffsetAfter),o=t.p1.x<t.p2.x?1:0;return` L ${n.x},${n.y} A 1,1 0,0 ${o} ${r.x},${r.y}`}createGapPath(e,t){let n,r;e.y<t.p1.y?(n=-this.skipOffsetBefore,r=this.jumpOffsetAfter+this.skipOffsetAfter):(n=this.jumpOffsetBefore+this.skipOffsetAfter,r=-this.skipOffsetBefore);let o=_s.Point.shiftTowards(e,t.p1,n),s=_s.Point.shiftTowards(e,t.p2,r);return` L ${o.x},${o.y} M ${s.x},${s.y}`}};mf=Rt([(0,Mt.injectable)()],mf);le.JumpingPolylineEdgeView=mf;var u_=class extends mf{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(e,t){return!1}shouldDrawLineGapOnIntersection(e,t){return Math.abs(e.slopeOrMax)>=Math.abs(t.slopeOrMax)}createGapPath(e,t){let n=_s.Point.shiftTowards(e,t.p1,this.skipOffsetBefore),r=_s.Point.shiftTowards(e,t.p2,this.skipOffsetAfter);return` L ${n.x},${n.y} M ${r.x},${r.y}`}};u_=Rt([(0,Mt.injectable)()],u_);le.PolylineEdgeViewWithGapsOnIntersections=u_;var yf=class extends cP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,ge.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,ge.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o="";if(t.length>=4){o+=this.buildMainSegment(t);let s=t.length-4;if(s>0&&s%3===0)for(let a=4;a<t.length;a+=3)o+=this.addSpline(t,a)}return(0,ge.svg)("path",{d:o})}buildMainSegment(e){let t=e[0],n=e[1],r=e[2],o=e[3];return`M${t.x},${t.y} C${n.x},${n.y} ${r.x},${r.y} ${o.x},${o.y}`}addSpline(e,t){let n=e[t+1],r=e[t+2];return` S${n.x},${n.y} ${r.x},${r.y}`}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,ge.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)(Xi.EdgeRouterRegistry),_f("design:type",Xi.EdgeRouterRegistry)],yf.prototype,"edgeRouterRegistry",void 0);yf=Rt([(0,Mt.injectable)()],yf);le.BezierCurveEdgeView=yf;var vs=class{constructor(){this.minimalPointDistance=10}render(e,t,n){if(n&&n.route&&e.parent instanceof vf.SRoutableElement){let r=this.edgeRouterRegistry.get(e.parent.routerKind),o=n.route===void 0?this.edgeRouterRegistry.route(e.parent,n):n.route,s=r.getHandlePosition(e.parent,o,e);if(s!==void 0){let a=(0,ge.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,uc.setAttr)(a,"data-kind",e.kind),a}}return(0,ge.svg)("g",null)}getRadius(){return 7}};Rt([(0,Mt.inject)(Xi.EdgeRouterRegistry),_f("design:type",Xi.EdgeRouterRegistry)],vs.prototype,"edgeRouterRegistry",void 0);vs=Rt([(0,Mt.injectable)()],vs);le.SRoutingHandleView=vs;var d_=class extends GL.ShapeView{render(e,t){if(!(0,$L.isEdgeLayoutable)(e)&&!this.isVisible(e,t))return;let n=(0,ge.svg)("text",{"class-sprotty-label":!0},e.text),r=(0,aP.getSubType)(e);return r&&(0,uc.setAttr)(n,"class",r),n}};d_=Rt([(0,Mt.injectable)()],d_);le.SLabelView=d_;var l_=class{render(e,t,n){let r=`translate(${e.bounds.x}, ${e.bounds.y})`,o=(0,ge.svg)("g",{transform:r,"class-sprotty-comp":"{true}"},t.renderChildren(e)),s=(0,aP.getSubType)(e);return s&&(0,uc.setAttr)(o,"class",s),o}};l_=Rt([(0,Mt.injectable)()],l_);le.SCompartmentView=l_;var f_=class extends vs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof vf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a="translate("+s.x+", "+s.y+")",c=-5.5,u=5.5,d=e.kind==="bezier-add"?"+":"-",l=(0,ge.svg)("g",{transform:a,"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,ge.svg)("circle",{r:this.getRadius()}),(0,ge.svg)("text",{x:c,y:u,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},d));return(0,uc.setAttr)(l,"data-kind",e.kind),l}}}return(0,ge.svg)("g",null)}};f_=Rt([(0,Mt.injectable)()],f_);le.SBezierCreateHandleView=f_;var h_=class extends vs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof vf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a;for(let u=0;u<r.length;u++){let d=r[u];if(d.kind===s.kind&&d.pointIndex===s.pointIndex){e.kind==="bezier-control-before"?a=r[u+1]:a=r[u-1];break}}let c;if(a){let u=`M ${s.x}, ${s.y} L ${a.x}, ${a.y}`;c=(0,ge.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,ge.svg)("path",{d:u,stroke:"grey","style-stroke-width":"2px"}),(0,ge.svg)("circle",{cx:s.x,cy:s.y,r:this.getRadius()}))}else c=(0,ge.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,uc.setAttr)(c,"data-kind",e.kind),c}}}return(0,ge.svg)("g",null)}};h_=Rt([(0,Mt.injectable)()],h_);le.SBezierControlHandleView=h_});var g_=f(p_=>{"use strict";Object.defineProperty(p_,"__esModule",{value:!0});var XL=_(),JL=yt(),bf=P(),ZL=ja(),QL=Yo(),eB=new XL.ContainerModule((i,e,t)=>{i(bf.TYPES.ModelSourceProvider).toProvider(n=>()=>new Promise(r=>{r(n.container.get(bf.TYPES.ModelSource))})),(0,JL.configureCommand)({bind:i,isBound:t},ZL.CommitModelCommand),i(bf.TYPES.IActionHandlerInitializer).toService(bf.TYPES.ModelSource),i(QL.ComputedBoundsApplicator).toSelf().inSingletonScope()});p_.default=eB});var dP=f(bs=>{"use strict";var Ce=bs&&bs.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bs,"__esModule",{value:!0});bs.loadDefaultModules=void 0;var tB=Ce(_p()),nB=Ce(g_()),iB=Ce(by()),rB=Ce(Ey()),oB=Ce(Iy()),sB=Ce(My()),aB=Ce(Oy()),cB=Ce(Ud()),m_=Lg(),uB=Ce(xy()),dB=Ce(jy()),lB=Ce(Ly()),fB=Ce(Fy()),hB=Ce(Hy()),pB=Ce(Yy()),gB=Ce(Xy()),mB=Ce(Qy()),yB=Ce(t_()),_B=Ce(i_()),vB=Ce(s_()),bB=Ce(c_());function SB(i,e){let t=[tB.default,nB.default,iB.default,rB.default,oB.default,sB.default,aB.default,m_.edgeEditModule,cB.default,uB.default,dB.default,lB.default,fB.default,m_.labelEditModule,m_.labelEditUiModule,hB.default,pB.default,gB.default,mB.default,yB.default,_B.default,vB.default,bB.default];if(e&&e.exclude)for(let n of e.exclude){let r=t.indexOf(n);r>=0&&t.splice(r,1)}i.load(...t)}bs.loadDefaultModules=SB});var lP=f(__=>{"use strict";Object.defineProperty(__,"__esModule",{value:!0});var Sf=po();function EB(i){let e={},t=(s,a)=>{if(a!=="style"&&a!=="class"){let c=MB(i[a]);s?s[a]=c:s={[a]:c}}return s},n=Object.keys(i).reduce(t,null);n&&(e.attrs=n);let r=wB(i);r&&(e.style=r);let o=PB(i);return o&&(e.class=o),e}function wB(i){let e=(t,n)=>{let r=n.split(":"),o=IB(r[0].trim());if(o){let s=r[1].replace("!important","").trim();t?t[o]=s:t={[o]:s}}return t};try{return i.style.split(";").reduce(e,null)}catch{return null}}function PB(i){let e=(t,n)=>(n=n.trim(),n&&(t?t[n]=!0:t={[n]:!0}),t);try{return i.class.split(" ").reduce(e,null)}catch{return null}}function IB(i){return i=i.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),`${i.charAt(0).toLowerCase()}${i.substring(1)}`}var RB=new RegExp("&[a-z0-9#]+;","gi"),Ss=null;function MB(i){return Ss||(Ss=document.createElement("div")),i.replace(RB,e=>Ss===null?"":(Ss.innerHTML=e,Ss.textContent===null?"":Ss.textContent))}function TB(i,e){let t=i,n=null,r=[],o=s=>{let a=s.firstChild;a!==null&&(n=s),t=a};for(e(t,n),o(t);;){for(;t;)r.push(t),e(t,n),o(t);let s=r.pop();if(t=s||null,!r.length)break;if(n=r[r.length-1],t){let a=t.nextSibling;a==null&&(n=r[r.length-1]),t=a}}}var dc=null,y_=new Map,Ef=!1;function OB(i,e){let t;switch(e!==null&&(t=y_.get(e)),i?.nodeType){case 1:{if(t===void 0)return;t.children=t.children?t.children:[];let n=t.children,r=i.attributes,o={};for(let a=0;a<r.length;a++){let c=r.item(a);c&&(o[c.name]=c.value)}let s=(0,Sf.h)(i.nodeName,EB(o));n.push(s),y_.set(i,s);break}case 3:{let n=i.textContent;if(n!==null&&t!==void 0){t.children=t.children?t.children:[];let r=t.children,o=r.length>0?r[r.length-1]:null;!Ef&&typeof o!="string"&&o!==null&&o.sel===void 0?o.text=o.text+n:r.push((0,Sf.vnode)(void 0,void 0,void 0,n,void 0)),Ef=!1}break}case 8:{Ef=!0;break}case 9:{dc=(0,Sf.vnode)(void 0,void 0,[],void 0,void 0),y_.set(i,dc);break}default:break}}function AB(i){let e=i?.children;return typeof e>"u"?null:e.length===1&&typeof e[0]!="string"?e[0]:null}function CB(i){var e,t;let n=new window.DOMParser;if(n===void 0||i===void 0||i==="")return null;let r=n.parseFromString(i,"application/xml");if(((e=r?.firstChild)===null||e===void 0?void 0:e.nodeName)==="parsererror"){let o=`${(t=r?.firstChild)===null||t===void 0?void 0:t.textContent}`;return(0,Sf.h)("parsererror",[o])}return Ef=!1,dc=null,TB(r,OB),dc===null?null:AB(dc)}__.default=CB});var M_=f(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.ForeignObjectElement=xe.ShapedPreRenderedElement=xe.PreRenderedElement=xe.HtmlRoot=xe.RectangularPort=xe.CircularPort=xe.DiamondNode=xe.RectangularNode=xe.CircularNode=void 0;var lc=ee(),fP=G(),v_=ue(),xB=qi(),qB=Et(),hc=Rr(),pc=oi(),b_=class extends hc.SNode{get anchorKind(){return pc.ELLIPTIC_ANCHOR_KIND}};xe.CircularNode=b_;var S_=class extends hc.SNode{get anchorKind(){return pc.RECTANGULAR_ANCHOR_KIND}};xe.RectangularNode=S_;var E_=class extends hc.SNode{get anchorKind(){return pc.DIAMOND_ANCHOR_KIND}};xe.DiamondNode=E_;var w_=class extends hc.SPort{get anchorKind(){return pc.ELLIPTIC_ANCHOR_KIND}};xe.CircularPort=w_;var P_=class extends hc.SPort{get anchorKind(){return pc.RECTANGULAR_ANCHOR_KIND}};xe.RectangularPort=P_;var I_=class extends fP.SModelRoot{constructor(){super(...arguments),this.classes=[]}};xe.HtmlRoot=I_;var wf=class extends fP.SChildElement{};xe.PreRenderedElement=wf;var fc=class extends wf{constructor(){super(...arguments),this.position=lc.Point.ORIGIN,this.size=lc.Dimension.EMPTY,this.selected=!1,this.alignment=lc.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}};xe.ShapedPreRenderedElement=fc;fc.DEFAULT_FEATURES=[xB.moveFeature,v_.boundsFeature,qB.selectFeature,v_.alignFeature];var R_=class extends fc{get bounds(){return lc.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,v_.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:lc.Bounds.EMPTY}};xe.ForeignObjectElement=R_});var yP=f(kn=>{"use strict";var pP=kn&&kn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},DB=kn&&kn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(kn,"__esModule",{value:!0});kn.ForeignObjectView=kn.PreRenderedView=void 0;var hP=Wt(),gP=_(),mP=DB(lP()),T_=Be(),jB=ma(),NB=M_(),O_=class extends jB.ShapeView{render(e,t){if(e instanceof NB.ShapedPreRenderedElement&&!this.isVisible(e,t))return;let n=(0,mP.default)(e.code);if(n!==null)return this.correctNamespace(n),n}correctNamespace(e){(e.sel==="svg"||e.sel==="g")&&(0,T_.setNamespace)(e,"http://www.w3.org/2000/svg")}};O_=pP([(0,gP.injectable)()],O_);kn.PreRenderedView=O_;var A_=class{render(e,t){let n=(0,mP.default)(e.code);if(n===null)return;let r=(0,hP.svg)("g",null,(0,hP.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.bounds.height,width:e.bounds.width,x:0,y:0},n),t.renderChildren(e));return(0,T_.setAttr)(r,"class",e.type),(0,T_.setNamespace)(n,e.namespace),r}};A_=pP([(0,gP.injectable)()],A_);kn.ForeignObjectView=A_});var _P=f(Es=>{"use strict";var LB=Es&&Es.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Es,"__esModule",{value:!0});Es.HtmlRootView=void 0;var BB=Wt(),FB=_(),VB=Be(),C_=class{render(e,t){let n=(0,BB.html)("div",null,t.renderChildren(e));for(let r of e.classes)(0,VB.setClass)(n,r,!0);return n}};C_=LB([(0,FB.injectable)()],C_);Es.HtmlRootView=C_});var D_=f((x_,q_)=>{(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof x_<"u"?e():(e(),i.FileSaver={})})(x_,function(){"use strict";function i(a,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function e(a,c,u){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){s(d.response,c,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(a){var c=new XMLHttpRequest;c.open("HEAD",a,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(a,c,u){var d=r.URL||r.webkitURL,l=document.createElement("a");c=c||a.name||"download",l.download=c,l.rel="noopener",typeof a=="string"?(l.href=a,l.origin===location.origin?n(l):t(l.href)?e(a,c,u):n(l,l.target="_blank")):(l.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(a,c,u){if(c=c||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,u),c);else if(t(a))e(a,c,u);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){n(d)})}}:function(a,c,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return e(a,c,u);var l=a.type==="application/octet-stream",S=/constructor/i.test(r.HTMLElement)||r.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||l&&S||o)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var C=v.result;C=R?C:C.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=C:location=C,d=null},v.readAsDataURL(a)}else{var m=r.URL||r.webkitURL,T=m.createObjectURL(a);d?d.location=T:location.href=T,d=null,setTimeout(function(){m.revokeObjectURL(T)},4e4)}});r.saveAs=s.saveAs=s,typeof q_<"u"&&(q_.exports=s)})});var F_=f(Tt=>{"use strict";var L_=Tt&&Tt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},EP=Tt&&Tt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.DiagramServer=Tt.DiagramServerProxy=Tt.ServerStatusAction=Tt.isActionMessage=void 0;var KB=D_(),B_=_(),HB=hr(),Ji=ie(),zB=Sn(),vP=Au(),YB=P(),j_=sd(),UB=Ar(),bP=Ql(),N_=Yo();function wP(i){return(0,zB.hasOwnProperty)(i,"action")}Tt.isActionMessage=wP;var Zi=class{constructor(){this.kind=Zi.KIND}};Tt.ServerStatusAction=Zi;Zi.KIND="serverStatus";var SP="__receivedFromServer",ws=class extends N_.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}initialize(e){super.initialize(e),e.register(Ji.ComputedBoundsAction.KIND,this),e.register(j_.RequestBoundsCommand.KIND,this),e.register(Ji.RequestPopupModelAction.KIND,this),e.register(Ji.CollapseExpandAction.KIND,this),e.register(Ji.CollapseExpandAllAction.KIND,this),e.register(HB.OpenAction.KIND,this),e.register(Zi.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(e){this.handleLocally(e)&&this.forwardToServer(e)}forwardToServer(e){let t={clientId:this.clientId,action:e};this.logger.log(this,"sending",t),this.sendMessage(t)}messageReceived(e){let t=typeof e=="string"?JSON.parse(e):e;wP(t)&&t.action?(!t.clientId||t.clientId===this.clientId)&&(t.action[SP]=!0,this.logger.log(this,"receiving",t),this.actionDispatcher.dispatch(t.action).then(()=>{this.storeNewModel(t.action)})):this.logger.error(this,"received data is not an action message",t)}handleLocally(e){switch(this.storeNewModel(e),e.kind){case Ji.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case Ji.RequestModelAction.KIND:return this.handleRequestModel(e);case j_.RequestBoundsCommand.KIND:return!1;case UB.ExportSvgAction.KIND:return this.handleExportSvgAction(e);case Zi.KIND:return this.handleServerStateAction(e)}return!e[SP]}storeNewModel(e){if(e.kind===vP.SetModelCommand.KIND||e.kind===bP.UpdateModelCommand.KIND||e.kind===j_.RequestBoundsCommand.KIND){let t=e.newRoot;t&&(this.currentRoot=t,(e.kind===vP.SetModelCommand.KIND||e.kind===bP.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=t.type))}}handleRequestModel(e){let t=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},e.options),n=Object.assign(Object.assign({},e),{options:t});return this.forwardToServer(n),!1}handleComputedBounds(e){if(this.viewerOptions.needsServerLayout)return!0;{let t=this.currentRoot;return this.computedBoundsApplicator.apply(t,e),t.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(Ji.UpdateModelAction.create(t)):this.actionDispatcher.dispatch(Ji.SetModelAction.create(t)),this.lastSubmittedModelType=t.type,!1}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});return(0,KB.saveAs)(t,"diagram.svg"),!1}handleServerStateAction(e){return!1}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}};L_([(0,B_.inject)(YB.TYPES.ILogger),EP("design:type",Object)],ws.prototype,"logger",void 0);L_([(0,B_.inject)(N_.ComputedBoundsApplicator),EP("design:type",N_.ComputedBoundsApplicator)],ws.prototype,"computedBoundsApplicator",void 0);ws=L_([(0,B_.injectable)()],ws);Tt.DiagramServerProxy=ws;Tt.DiagramServer=ws});var IP=f(Qi=>{"use strict";var gc=Qi&&Qi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Pf=Qi&&Qi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.LocalModelSource=void 0;var kB=D_(),Kr=_(),yn=ie(),PP=Pi(),K_=P(),GB=Mn(),$B=hs(),WB=Ar(),XB=Xl(),JB=Wl(),V_=Yo(),Hr=class extends V_.ModelSource{constructor(){super(...arguments),this.currentRoot=GB.EMPTY_ROOT}get model(){return this.currentRoot}set model(e){this.setModel(e)}initialize(e){super.initialize(e),e.register(yn.ComputedBoundsAction.KIND,this),e.register(yn.RequestPopupModelAction.KIND,this)}setModel(e){return this.currentRoot=e,this.submitModel(e,!1)}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}updateModel(e){return e===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=e,this.submitModel(e,!0))}async getSelection(){let e=await this.actionDispatcher.request(JB.GetSelectionAction.create()),t=[];return this.gatherSelectedElements(this.currentRoot,new Set(e.selectedElementsIDs),t),t}gatherSelectedElements(e,t,n){if(t.has(e.id)&&n.push(e),e.children)for(let r of e.children)this.gatherSelectedElements(r,t,n)}async getViewport(){let e=await this.actionDispatcher.request($B.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}async submitModel(e,t,n){if(this.viewerOptions.needsClientLayout){let r=await this.actionDispatcher.request(yn.RequestBoundsAction.create(e)),o=this.computedBoundsApplicator.apply(this.currentRoot,r);await this.doSubmitModel(e,!0,n,o)}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n,r){if(this.layoutEngine!==void 0)try{let s=this.layoutEngine.layout(e,r);s instanceof Promise?e=await s:s!==void 0&&(e=s)}catch(s){this.logger.error(this,s.toString(),s.stack)}let o=this.lastSubmittedModelType;if(this.lastSubmittedModelType=e.type,n&&n.kind===yn.RequestModelAction.KIND&&n.requestId){let s=n;await this.actionDispatcher.dispatch(yn.SetModelAction.create(e,s.requestId))}else if(t&&e.type===o){let s=Array.isArray(t)?t:e;await this.actionDispatcher.dispatch(yn.UpdateModelAction.create(s,{animate:!0,cause:n}))}else await this.actionDispatcher.dispatch(yn.SetModelAction.create(e))}applyMatches(e){let t=this.currentRoot;return(0,XB.applyMatches)(t,e),this.submitModel(t,e)}addElements(e){let t=[];for(let n of e){let r=n;r.element!==void 0&&r.parentId!==void 0?t.push({right:r.element,rightParentId:r.parentId}):r.id!==void 0&&t.push({right:r,rightParentId:this.currentRoot.id})}return this.applyMatches(t)}removeElements(e){let t=[],n=new PP.SModelIndex;n.add(this.currentRoot);for(let r of e){let o=r;if(o.elementId!==void 0&&o.parentId!==void 0){let s=n.getById(o.elementId);s!==void 0&&t.push({left:s,leftParentId:o.parentId})}else{let s=n.getById(o);s!==void 0&&t.push({left:s,leftParentId:this.currentRoot.id})}}return this.applyMatches(t)}handle(e){switch(e.kind){case yn.RequestModelAction.KIND:this.handleRequestModel(e);break;case yn.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,e);break;case yn.RequestPopupModelAction.KIND:this.handleRequestPopupModel(e);break;case WB.ExportSvgAction.KIND:this.handleExportSvgAction(e);break}}handleRequestModel(e){this.submitModel(this.currentRoot,!1,e)}handleRequestPopupModel(e){if(this.popupModelProvider!==void 0){let t=(0,PP.findElement)(this.currentRoot,e.elementId),n=this.popupModelProvider.getPopupModel(e,t);n!==void 0&&(n.canvasBounds=e.bounds,this.actionDispatcher.dispatch(yn.SetPopupModelAction.create(n,e.requestId)))}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});(0,kB.saveAs)(t,"diagram.svg")}};gc([(0,Kr.inject)(K_.TYPES.ILogger),Pf("design:type",Object)],Hr.prototype,"logger",void 0);gc([(0,Kr.inject)(V_.ComputedBoundsApplicator),Pf("design:type",V_.ComputedBoundsApplicator)],Hr.prototype,"computedBoundsApplicator",void 0);gc([(0,Kr.inject)(K_.TYPES.IPopupModelProvider),(0,Kr.optional)(),Pf("design:type",Object)],Hr.prototype,"popupModelProvider",void 0);gc([(0,Kr.inject)(K_.TYPES.IModelLayoutEngine),(0,Kr.optional)(),Pf("design:type",Object)],Hr.prototype,"layoutEngine",void 0);Hr=gc([(0,Kr.injectable)()],Hr);Qi.LocalModelSource=Hr});var OP=f(_n=>{"use strict";var H_=_n&&_n.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},RP=_n&&_n.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(_n,"__esModule",{value:!0});_n.ForwardingLogger=_n.LoggingAction=void 0;var z_=_(),er=Ju(),MP=P(),TP;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(TP=_n.LoggingAction||(_n.LoggingAction={}));var mc=class{error(e,t,...n){this.logLevel>=er.LogLevel.error&&this.forward(e,t,er.LogLevel.error,n)}warn(e,t,...n){this.logLevel>=er.LogLevel.warn&&this.forward(e,t,er.LogLevel.warn,n)}info(e,t,...n){this.logLevel>=er.LogLevel.info&&this.forward(e,t,er.LogLevel.info,n)}log(e,t,...n){if(this.logLevel>=er.LogLevel.log)try{let r=typeof e=="object"?e.constructor.name:String(e);console.log.apply(e,[r+": "+t,...n])}catch{}}forward(e,t,n,r){let o=new Date,s=TP.create({message:t,severity:er.LogLevel[n],time:o.toLocaleTimeString(),caller:typeof e=="object"?e.constructor.name:String(e),params:r.map(a=>JSON.stringify(a))});this.modelSourceProvider().then(a=>{try{a.handle(s)}catch(c){try{console.log.apply(e,[t,s,c])}catch{}}})}};H_([(0,z_.inject)(MP.TYPES.ModelSourceProvider),RP("design:type",Function)],mc.prototype,"modelSourceProvider",void 0);H_([(0,z_.inject)(MP.TYPES.LogLevel),RP("design:type",Number)],mc.prototype,"logLevel",void 0);mc=H_([(0,z_.injectable)()],mc);_n.ForwardingLogger=mc});var AP=f(tr=>{"use strict";var ZB=tr&&tr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(tr,"__esModule",{value:!0});tr.WebSocketDiagramServer=tr.WebSocketDiagramServerProxy=void 0;var QB=_(),eF=F_(),If=class extends eF.DiagramServerProxy{listen(e){e.addEventListener("message",t=>{this.messageReceived(t.data)}),e.addEventListener("error",t=>{this.logger.error(this,"error event received",t)}),this.webSocket=e}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(e){if(this.webSocket)this.webSocket.send(JSON.stringify(e));else throw new Error("WebSocket is not connected")}};If=ZB([(0,QB.injectable)()],If);tr.WebSocketDiagramServerProxy=If;tr.WebSocketDiagramServer=If});var CP=f(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.ColorMap=nr.toSVG=nr.rgb=void 0;function tF(i,e,t){return{red:i,green:e,blue:t}}nr.rgb=tF;function nF(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}nr.toSVG=nF;var Y_=class{constructor(e){this.stops=e}getColor(e){e=Math.max(0,Math.min(.99999999,e));let t=Math.floor(e*this.stops.length);return this.stops[t]}};nr.ColorMap=Y_});var qP=f(xP=>{"use strict";Object.defineProperty(xP,"__esModule",{value:!0})});var Rf=f(h=>{"use strict";var iF=h&&h.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),g=h&&h.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&iF(e,i,t)},we=h&&h.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(h,"__esModule",{value:!0});h.modelSourceModule=h.zorderModule=h.viewportModule=h.updateModule=h.undoRedoModule=h.selectModule=h.routingModule=h.openModule=h.moveModule=h.hoverModule=h.fadeModule=h.exportModule=h.expandModule=h.edgeLayoutModule=h.edgeIntersectionModule=h.decorationModule=h.contextMenuModule=h.commandPaletteModule=h.buttonModule=h.boundsModule=h.graphModule=h.defaultModule=void 0;g(bc(),h);g(pu(),h);g(Us(),h);g(lh(),h);g(Qr(),h);g(ur(),h);g(fh(),h);g(me(),h);g(yt(),h);g(Eb(),h);g(Eh(),h);g($s(),h);g(Au(),h);g(Fb(),h);g(Mn(),h);g(ze(),h);g(G(),h);g(Lh(),h);g(Cu(),h);g(Qs(),h);g(Lu(),h);g(un(),h);g(At(),h);g(ep(),h);g(go(),h);g(sp(),h);g(ap(),h);g(cp(),h);g(dp(),h);g(Be(),h);g(P(),h);var rF=we(_p());h.defaultModule=rF.default;g(sd(),h);g(wp(),h);g(ud(),h);g(ue(),h);g(Mp(),h);g(Tp(),h);g(Op(),h);g(ma(),h);g(_a(),h);g(vd(),h);g(bd(),h);g(Up(),h);g(nE(),h);g(Rd(),h);g(Jp(),h);g(Ud(),h);g(og(),h);g(Bo(),h);g(DE(),h);g(cg(),h);g(Lg(),h);g(No(),h);g(Jd(),h);g(Cg(),h);g(Fa(),h);g(Fo(),h);g(il(),h);g(Bg(),h);g(ol(),h);g(u0(),h);g(Hg(),h);g(Cd(),h);g(Ar(),h);g(fl(),h);g(qo(),h);g($g(),h);g(wr(),h);g(gl(),h);g(Qg(),h);g(em(),h);g(_l(),h);g(om(),h);g(qi(),h);g(Za(),h);g(q0(),h);g(Dp(),h);g(pm(),h);g(fm(),h);g(Rl(),h);g(K0(),h);g(oi(),h);g(Ma(),h);g(Dm(),h);g(xl(),h);g(zm(),h);g(Dl(),h);g(_e(),h);g(Tl(),h);g(Oa(),h);g(pn(),h);g(Um(),h);g(Et(),h);g(Wl(),h);g(ey(),h);g(Xl(),h);g(Ql(),h);g(sf(),h);g(qn(),h);g(hy(),h);g(Dd(),h);g(hs(),h);g(nl(),h);g(py(),h);var oF=we(jw());h.graphModule=oF.default;var sF=we(by());h.boundsModule=sF.default;var aF=we(Ey());h.buttonModule=aF.default;var cF=we(Iy());h.commandPaletteModule=cF.default;var uF=we(My());h.contextMenuModule=uF.default;var dF=we(Oy());h.decorationModule=dF.default;var lF=we(kw());h.edgeIntersectionModule=lF.default;var fF=we(Ud());h.edgeLayoutModule=fF.default;var hF=we(xy());h.expandModule=hF.default;var pF=we(jy());h.exportModule=pF.default;var gF=we(Ly());h.fadeModule=gF.default;var mF=we(Fy());h.hoverModule=mF.default;var yF=we(Hy());h.moveModule=yF.default;var _F=we(Yy());h.openModule=_F.default;var vF=we(Xy());h.routingModule=vF.default;var bF=we(Qy());h.selectModule=bF.default;var SF=we(t_());h.undoRedoModule=SF.default;var EF=we(i_());h.updateModule=EF.default;var wF=we(s_());h.viewportModule=wF.default;var PF=we(c_());h.zorderModule=PF.default;g(my(),h);g(Rr(),h);g(uP(),h);g(dP(),h);g(yP(),h);g(_P(),h);g(Wt(),h);g(M_(),h);g(yg(),h);g(ja(),h);g(F_(),h);g(IP(),h);g(OP(),h);g(Yo(),h);g(AP(),h);var IF=we(g_());h.modelSourceModule=IF.default;g(Tn(),h);g(Fp(),h);g(CP(),h);g(Or(),h);g(cr(),h);g(qP(),h);g(Ju(),h);g(Rn(),h)});var X_;(function(i){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return Of(Object.create(null))}:a?function(){return Of({__proto__:null})}:function(){return Of({})},has:c?function(p,y){return t.call(p,y)}:function(p,y){return y in p},get:c?function(p,y){return t.call(p,y)?p[y]:void 0}:function(p,y){return p[y]}},d=Object.getPrototypeOf(Function),l=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",S=!l&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:zP(),R=!l&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:YP(),v=!l&&typeof WeakMap=="function"?WeakMap:UP(),m=new v;function T(p,y,w,I){if(j(w)){if(!U_(p))throw new TypeError;if(!k_(y))throw new TypeError;return Ie(p,y)}else{if(!U_(p))throw new TypeError;if(!U(y))throw new TypeError;if(!U(I)&&!j(I)&&!ce(I))throw new TypeError;return ce(I)&&(I=void 0),w=ot(w),he(p,y,w,I)}}e("decorate",T);function C(p,y){function w(I,x){if(!U(I))throw new TypeError;if(!j(x)&&!BP(x))throw new TypeError;js(p,y,I,x)}return w}e("metadata",C);function K(p,y,w,I){if(!U(w))throw new TypeError;return j(I)||(I=ot(I)),js(p,y,w,I)}e("defineMetadata",K);function k(p,y,w){if(!U(y))throw new TypeError;return j(w)||(w=ot(w)),$e(p,y,w)}e("hasMetadata",k);function D(p,y,w){if(!U(y))throw new TypeError;return j(w)||(w=ot(w)),vn(p,y,w)}e("hasOwnMetadata",D);function F(p,y,w){if(!U(y))throw new TypeError;return j(w)||(w=ot(w)),li(p,y,w)}e("getMetadata",F);function H(p,y,w){if(!U(y))throw new TypeError;return j(w)||(w=ot(w)),Ds(p,y,w)}e("getOwnMetadata",H);function $(p,y){if(!U(p))throw new TypeError;return j(y)||(y=ot(y)),Ns(p,y)}e("getMetadataKeys",$);function z(p,y){if(!U(p))throw new TypeError;return j(y)||(y=ot(y)),yc(p,y)}e("getOwnMetadataKeys",z);function ae(p,y,w){if(!U(y))throw new TypeError;j(w)||(w=ot(w));var I=be(y,w,!1);if(j(I)||!I.delete(p))return!1;if(I.size>0)return!0;var x=m.get(y);return x.delete(w),x.size>0||m.delete(y),!0}e("deleteMetadata",ae);function Ie(p,y){for(var w=p.length-1;w>=0;--w){var I=p[w],x=I(y);if(!j(x)&&!ce(x)){if(!k_(x))throw new TypeError;y=x}}return y}function he(p,y,w,I){for(var x=p.length-1;x>=0;--x){var He=p[x],V=He(y,w,I);if(!j(V)&&!ce(V)){if(!U(V))throw new TypeError;I=V}}return I}function be(p,y,w){var I=m.get(p);if(j(I)){if(!w)return;I=new S,m.set(p,I)}var x=I.get(y);if(j(x)){if(!w)return;x=new S,I.set(y,x)}return x}function $e(p,y,w){var I=vn(p,y,w);if(I)return!0;var x=Tf(y);return ce(x)?!1:$e(p,x,w)}function vn(p,y,w){var I=be(y,w,!1);return j(I)?!1:cn(I.has(p))}function li(p,y,w){var I=vn(p,y,w);if(I)return Ds(p,y,w);var x=Tf(y);if(!ce(x))return li(p,x,w)}function Ds(p,y,w){var I=be(y,w,!1);if(!j(I))return I.get(p)}function js(p,y,w,I){var x=be(w,I,!0);x.set(p,y)}function Ns(p,y){var w=yc(p,y),I=Tf(p);if(I===null)return w;var x=Ns(I,y);if(x.length<=0)return w;if(w.length<=0)return x;for(var He=new R,V=[],Y=0,N=w;Y<N.length;Y++){var X=N[Y],J=He.has(X);J||(He.add(X),V.push(X))}for(var hi=0,$_=x;hi<$_.length;hi++){var X=$_[hi],J=He.has(X);J||(He.add(X),V.push(X))}return V}function yc(p,y){var w=[],I=be(p,y,!1);if(j(I))return w;for(var x=I.keys(),He=FP(x),V=0;;){var Y=KP(He);if(!Y)return w.length=V,w;var N=VP(Y);try{w[V]=N}catch(X){try{HP(He)}finally{throw X}}V++}}function L(p){if(p===null)return 1;switch(typeof p){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return p===null?1:6;default:return 6}}function j(p){return p===void 0}function ce(p){return p===null}function Ne(p){return typeof p=="symbol"}function U(p){return typeof p=="object"?p!==null:typeof p=="function"}function Ke(p,y){switch(L(p)){case 0:return p;case 1:return p;case 2:return p;case 3:return p;case 4:return p;case 5:return p}var w=y===3?"string":y===5?"number":"default",I=G_(p,r);if(I!==void 0){var x=I.call(p,w);if(U(x))throw new TypeError;return x}return fi(p,w==="default"?"number":w)}function fi(p,y){if(y==="string"){var w=p.toString;if(zr(w)){var I=w.call(p);if(!U(I))return I}var x=p.valueOf;if(zr(x)){var I=x.call(p);if(!U(I))return I}}else{var x=p.valueOf;if(zr(x)){var I=x.call(p);if(!U(I))return I}var He=p.toString;if(zr(He)){var I=He.call(p);if(!U(I))return I}}throw new TypeError}function cn(p){return!!p}function We(p){return""+p}function ot(p){var y=Ke(p,3);return Ne(y)?y:We(y)}function U_(p){return Array.isArray?Array.isArray(p):p instanceof Object?p instanceof Array:Object.prototype.toString.call(p)==="[object Array]"}function zr(p){return typeof p=="function"}function k_(p){return typeof p=="function"}function BP(p){switch(L(p)){case 3:return!0;case 4:return!0;default:return!1}}function G_(p,y){var w=p[y];if(w!=null){if(!zr(w))throw new TypeError;return w}}function FP(p){var y=G_(p,o);if(!zr(y))throw new TypeError;var w=y.call(p);if(!U(w))throw new TypeError;return w}function VP(p){return p.value}function KP(p){var y=p.next();return y.done?!1:y}function HP(p){var y=p.return;y&&y.call(p)}function Tf(p){var y=Object.getPrototypeOf(p);if(typeof p!="function"||p===d||y!==d)return y;var w=p.prototype,I=w&&Object.getPrototypeOf(w);if(I==null||I===Object.prototype)return y;var x=I.constructor;return typeof x!="function"||x===p?y:x}function zP(){var p={},y=[],w=function(){function V(Y,N,X){this._index=0,this._keys=Y,this._values=N,this._selector=X}return V.prototype["@@iterator"]=function(){return this},V.prototype[o]=function(){return this},V.prototype.next=function(){var Y=this._index;if(Y>=0&&Y<this._keys.length){var N=this._selector(this._keys[Y],this._values[Y]);return Y+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:N,done:!1}}return{value:void 0,done:!0}},V.prototype.throw=function(Y){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),Y},V.prototype.return=function(Y){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:Y,done:!0}},V}();return function(){function V(){this._keys=[],this._values=[],this._cacheKey=p,this._cacheIndex=-2}return Object.defineProperty(V.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),V.prototype.has=function(Y){return this._find(Y,!1)>=0},V.prototype.get=function(Y){var N=this._find(Y,!1);return N>=0?this._values[N]:void 0},V.prototype.set=function(Y,N){var X=this._find(Y,!0);return this._values[X]=N,this},V.prototype.delete=function(Y){var N=this._find(Y,!1);if(N>=0){for(var X=this._keys.length,J=N+1;J<X;J++)this._keys[J-1]=this._keys[J],this._values[J-1]=this._values[J];return this._keys.length--,this._values.length--,Y===this._cacheKey&&(this._cacheKey=p,this._cacheIndex=-2),!0}return!1},V.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=p,this._cacheIndex=-2},V.prototype.keys=function(){return new w(this._keys,this._values,I)},V.prototype.values=function(){return new w(this._keys,this._values,x)},V.prototype.entries=function(){return new w(this._keys,this._values,He)},V.prototype["@@iterator"]=function(){return this.entries()},V.prototype[o]=function(){return this.entries()},V.prototype._find=function(Y,N){return this._cacheKey!==Y&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Y)),this._cacheIndex<0&&N&&(this._cacheIndex=this._keys.length,this._keys.push(Y),this._values.push(void 0)),this._cacheIndex},V}();function I(V,Y){return V}function x(V,Y){return Y}function He(V,Y){return[V,Y]}}function YP(){return function(){function p(){this._map=new S}return Object.defineProperty(p.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),p.prototype.has=function(y){return this._map.has(y)},p.prototype.add=function(y){return this._map.set(y,y),this},p.prototype.delete=function(y){return this._map.delete(y)},p.prototype.clear=function(){this._map.clear()},p.prototype.keys=function(){return this._map.keys()},p.prototype.values=function(){return this._map.values()},p.prototype.entries=function(){return this._map.entries()},p.prototype["@@iterator"]=function(){return this.keys()},p.prototype[o]=function(){return this.keys()},p}()}function UP(){var p=16,y=u.create(),w=I();return function(){function N(){this._key=I()}return N.prototype.has=function(X){var J=x(X,!1);return J!==void 0?u.has(J,this._key):!1},N.prototype.get=function(X){var J=x(X,!1);return J!==void 0?u.get(J,this._key):void 0},N.prototype.set=function(X,J){var hi=x(X,!0);return hi[this._key]=J,this},N.prototype.delete=function(X){var J=x(X,!1);return J!==void 0?delete J[this._key]:!1},N.prototype.clear=function(){this._key=I()},N}();function I(){var N;do N="@@WeakMap@@"+Y();while(u.has(y,N));return y[N]=!0,N}function x(N,X){if(!t.call(N,w)){if(!X)return;Object.defineProperty(N,w,{value:u.create()})}return N[w]}function He(N,X){for(var J=0;J<X;++J)N[J]=Math.random()*255|0;return N}function V(N){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(N)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(N)):He(new Uint8Array(N),N):He(new Array(N),N)}function Y(){var N=V(p);N[6]=N[6]&79|64,N[8]=N[8]&191|128;for(var X="",J=0;J<p;++J){var hi=N[J];(J===4||J===6||J===8)&&(X+="-"),hi<16&&(X+="0"),X+=hi.toString(16).toLowerCase()}return X}}function Of(p){return p.__=void 0,delete p.__,p}})})(X_||(X_={}));var NP=Yr(Rf());var Mf=Yr(_()),A=Yr(Rf());var W=Yr(Wt()),Gn=Yr(_()),Ot=Yr(Rf());var Ps=class extends Ot.ShapeView{render(e,t,n){return(0,W.svg)("polygon",{points:"-6,-4 0,0 -6,4",style:{fill:"black"}})}};Ps=bn([(0,Gn.injectable)()],Ps);var Is=class extends Ot.RectangularNodeView{render(e,t,n){return(0,W.svg)("g",null,(0,W.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width-(e.arrow!==0?10:0),height:e.size.height}),(0,W.svg)("rect",{"class-input-back":!0,width:"10",height:e.size.height}),e.arrow!==0&&(0,W.svg)("polygon",{"class-input-arrow-full":e.arrow===1,"class-input-arrow-stroke":e.arrow===2,points:`${e.size.width-10},0 ${e.size.width},${e.size.height/2} ${e.size.width-10},${e.size.height}`}),(0,W.svg)("g",{transform:`translate(${e.size.width/2+(e.arrow!==0?0:5)},${e.size.height/2})`},t.renderChildren(e,n)),(0,W.svg)("text",{x:e.size.width/2,y:e.size.height+15,"class-sprotty-text":!0},e.text))}};Is=bn([(0,Gn.injectable)()],Is);var Rs=class extends Ot.RectangularNodeView{render(e,t,n){return(0,W.svg)("g",null,(0,W.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),(0,W.svg)("image",{href:`images/${e.image}`,width:e.size.width-10,height:e.size.height-10,x:"5",y:"5"}),(0,W.svg)("rect",{width:"10",height:e.size.height,x:"0",y:"0","class-input-back":!0}),(0,W.svg)("rect",{"class-component-marker":!0,width:"10",height:"10",x:e.size.width/2-5,y:"-5"}),(0,W.svg)("text",{x:e.size.width/2,y:e.size.height+20,"class-sprotty-text":!0},e.text))}};Rs=bn([(0,Gn.injectable)()],Rs);var Ms=class extends Ot.RectangularNodeView{render(e,t,n){return(0,W.svg)("g",null,(0,W.svg)("rect",{width:e.size.width,height:e.size.height,"class-sprotty-node":!0}),(0,W.svg)("rect",{x:"4",y:"4",width:e.size.width-8,height:e.size.height-8,"class-sprotty-node":!0}),(0,W.svg)("text",{x:e.size.width/2,y:"30","class-sprotty-text":!0},"EngSpdControl"))}};Ms=bn([(0,Gn.injectable)()],Ms);var Ts=class extends Ot.RectangularNodeView{render(e,t,n){return(0,W.svg)("g",null,(0,W.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width,height:e.size.height}),e.operand==="+"&&(0,W.svg)("text",{x:2,y:e.size.height+1,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="\xF7"&&(0,W.svg)("text",{x:3,y:e.size.height,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="-"&&(0,W.svg)("text",{x:5,y:30,w:!0,"class-operand-symbol":!0,style:{fontSize:"54"}},e.operand),e.operand==="x"&&(0,W.svg)("text",{x:4,y:e.size.height-5,w:!0,"class-operand-symbol":!0,style:{fontSize:"40"}},e.operand))}};Ts=bn([(0,Gn.injectable)()],Ts);var Os=class extends Ot.RectangularNodeView{render(e,t,n){return(0,W.svg)("g",null,(0,W.svg)("rect",{width:e.size.width,height:e.size.height,"class-sprotty-node":!0}),(0,W.svg)("image",{href:"images/Relais.png",x:"1",width:e.size.width-2,height:e.size.height-2}))}};Os=bn([(0,Gn.injectable)()],Os);var As=class extends Ot.PolylineEdgeView{renderAdditionals(e,t,n){let r=[];for(let o of t)if((0,Ot.isIntersectingRoutedPoint)(o)){for(let s of o.intersections)if(s.routable1.split("->")[0]===s.routable2.split("->")[0]){r.push((0,W.svg)("g",{transform:`translate(${s.intersectionPoint.x},${s.intersectionPoint.y})`},(0,W.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{fill:"black"}})));break}}return r}};As=bn([(0,Gn.injectable)()],As);var Cs=class extends Ot.ShapeView{render(e,t,n){let r=e.parent.size;return(0,W.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{stroke:"lightgrey",fill:"lightblue"}})}};Cs=bn([(0,Gn.injectable)()],Cs);var xs=class extends Ot.ShapeView{render(e,t,n){let r=e.parent.size;return(0,W.svg)("g",null,(0,W.svg)("polygon",{points:"-4,-4 4,-4 4,4",style:{stroke:"lightgrey",fill:"none"}}),(0,W.svg)("polygon",{points:"-4,-4 -4,4 4,4",style:{stroke:"lightgrey",fill:"orange"}}))}};xs=bn([(0,Gn.injectable)()],xs);var DP=i=>{let e=new Mf.ContainerModule((n,r,o,s)=>{n(A.TYPES.ModelSource).to(A.LocalModelSource).inSingletonScope(),s(A.TYPES.ILogger).to(A.ConsoleLogger).inSingletonScope(),s(A.TYPES.LogLevel).toConstantValue(A.LogLevel.log);let a={bind:n,unbind:r,isBound:o,rebind:s};(0,A.configureModelElement)(a,"graph",A.SGraph,A.SGraphView),(0,A.configureModelElement)(a,"node:input",A.RectangularNode,Is),(0,A.configureModelElement)(a,"node:component",A.RectangularNode,Rs),(0,A.configureModelElement)(a,"node:operand",A.RectangularNode,Ts),(0,A.configureModelElement)(a,"node:controller",A.RectangularNode,Ms),(0,A.configureModelElement)(a,"node:relais",A.RectangularNode,Os),(0,A.configureModelElement)(a,"edge:straight",A.SEdge,As),(0,A.configureModelElement)(a,"label:arrow",A.SLabel,Ps),(0,A.configureModelElement)(a,"label:text",A.SLabel,A.SLabelView),(0,A.configureModelElement)(a,"routing-point",A.SRoutingHandle,A.SRoutingHandleView),(0,A.configureModelElement)(a,"volatile-routing-point",A.SRoutingHandle,A.SRoutingHandleView),(0,A.configureModelElement)(a,"label:icon1",A.SChildElement,Cs),(0,A.configureModelElement)(a,"label:icon2",A.SChildElement,xs),(0,A.configureViewerOptions)(a,{needsClientLayout:!1,baseDiv:i})}),t=new Mf.Container;return(0,A.loadDefaultModules)(t),t.load(e),t.load(A.edgeIntersectionModule),t};var Kt={width:40,height:15},qs={width:30,height:30},L2={type:"edge:straight",routerKind:"manhattan",children:[ne()]},TF=0;function ne(){return{id:"arrow"+TF++,type:"label:arrow",text:"",edgePlacement:{position:1,side:"on",rotate:!0}}}var jP={type:"graph",id:"graph",children:[{id:"Epm_rpmEngSpd",type:"node:input",text:"Epm_rpmEngSpd",arrow:1,position:{x:40,y:150},size:Kt,children:[{id:"tEpm_rpmEngSpdIcon",type:"label:icon2"}]},{id:"Egc_facEgas",type:"node:input",text:"Egc_facEgas",arrow:1,position:{x:40,y:205},size:Kt,children:[{id:"Egc_fac_EgasIcon",type:"label:icon2"}]},{id:"Amf_facRelAir",type:"node:input",text:"Amf_facRelAir",arrow:1,position:{x:40,y:405},size:Kt,children:[{id:"Amf_facRelAirIcon",type:"label:icon2"}]},{id:"Ctc_atCool",type:"node:input",text:"Ctc_atCool",arrow:1,position:{x:40,y:495},size:Kt,children:[{id:"Ctc_atCoolIcon",type:"label:icon2"}]},{id:"Isc_fac_IdleSpdStab",type:"node:input",text:"Isc_fac_IdleSpdStab",arrow:1,position:{x:40,y:620},size:Kt,children:[{id:"Isc_fac_IdleSpdStabIcon",type:"label:icon2"}]},{id:"Tqs_facEgasFilt",type:"node:input",text:"Tqs_facEgasFilt",arrow:2,position:{x:530,y:195},size:Kt,children:[{id:"Tqs_facEgasFiltIcon",type:"label:icon2"}]},{id:"Tqs_tqMax",type:"node:input",text:"Tqs_tqMax",arrow:2,position:{x:530,y:295},size:Kt,children:[{id:"Tqs_tqMaxIcon",type:"label:icon2"}]},{id:"Tqs_tqDrag",type:"node:input",text:"Tqs_tqDrag",arrow:2,position:{x:530,y:395},size:Kt,children:[{id:"Tqs_tqDragIcon",type:"label:icon2"}]},{id:"Tqs_tqMin",type:"node:input",text:"Tqs_tqMin",arrow:1,position:{x:900,y:395},size:Kt,children:[{id:"Tqs_tqMinIcon",type:"label:icon2"}]},{id:"Tqs_flgTorqueRegOverride",type:"node:input",text:"Tqs_flgTorqueRegOverride",arrow:0,position:{x:950,y:20},size:Kt,children:[{id:"Tqs_flgTorqueRegOverrideIcon",type:"label:icon1"}]},{id:"Tqs_tqReqCalc",type:"node:input",text:"Tqs_tqReqCalc",arrow:2,position:{x:950,y:107.5},size:Kt,children:[{id:"Tqs_tqReqCalcIcon",type:"label:icon2"}]},{id:"Tqs_tqReqMan",type:"node:input",text:"Tqs_tqReqMan",arrow:0,position:{x:950,y:150},size:Kt,children:[{id:"Tqs_tqReqManIcon",type:"label:icon1"}]},{id:"Relais",type:"node:relais",position:{x:1150,y:107.5},size:{width:30,height:50}},{id:"Tqs_tqReq",type:"node:input",text:"Tqs_tqReq",arrow:1,position:{x:1250,y:125},size:Kt,children:[{id:"Tqs_tqReqIcon",type:"label:icon2"}]},{id:"AddOpDrag",type:"node:operand",operand:"+",position:{x:450,y:387.5},size:qs},{id:"MultOpDrag",type:"node:operand",operand:"x",position:{x:620,y:387.5},size:qs},{id:"SubOp",type:"node:operand",operand:"-",position:{x:670,y:287.5},size:qs},{id:"MultOpEgas",type:"node:operand",operand:"x",position:{x:720,y:187.5},size:qs},{id:"AddOpEgas",type:"node:operand",operand:"+",position:{x:800,y:187.5},size:qs},{id:"AddOpCalcReq",type:"node:operand",operand:"+",position:{x:850,y:100},size:qs},{id:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"node:component",text:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",image:"MAP_Icon.png",position:{x:300,y:170},size:{width:60,height:65}},{id:"Tqs_rpmEngSpd2tqMax_CUR",type:"node:component",text:"Tqs_rpmEngSpd2tqMax_CUR",image:"CUR_Icon.png",position:{x:300,y:270},size:{width:60,height:65}},{id:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"node:component",text:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",image:"MAP_Icon.png",position:{x:300,y:370},size:{width:60,height:65}},{id:"Tqs_atCool2tqDrag_CUR",type:"node:component",text:"Tqs_atCool2tqDrag_CUR",image:"CUR_Icon.png",position:{x:300,y:470},size:{width:60,height:65}},{id:"bigController",type:"node:controller",size:{width:180,height:120},position:{x:250,y:20}},{id:"Epm_rpmEngSpd->BigController",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"bigController",routerKind:"manhattan",routingPoints:[{x:165.01,y:157},{x:165,y:80}],children:[ne()]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",routerKind:"manhattan",routingPoints:[{x:165,y:157},{x:165,y:190}],children:[ne()]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpd2tqMax_CUR",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpd2tqMax_CUR",routerKind:"manhattan",routingPoints:[{x:164.5,y:157},{x:164.5,y:302.5}],children:[ne()]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",routerKind:"manhattan",routingPoints:[{x:165,y:157},{x:165,y:390}],children:[ne()]},{id:"Egc_facEgas->BigController",type:"edge:straight",sourceId:"Egc_facEgas",targetId:"bigController",routerKind:"manhattan",routingPoints:[{x:180,y:212.5},{x:180,y:95}],children:[ne()]},{id:"Egc_facEgas->Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"edge:straight",sourceId:"Egc_facEgas",targetId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",routerKind:"manhattan",routingPoints:[{x:200,y:212.5}],children:[ne()]},{id:"Amf_facRelAir->Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"edge:straight",sourceId:"Amf_facRelAir",targetId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",routerKind:"manhattan",routingPoints:[{x:290,y:412.5}],children:[ne()]},{id:"Ctc_atCool->Tqs_atCool2tqDrag_CUR",type:"edge:straight",sourceId:"Ctc_atCool",targetId:"Tqs_atCool2tqDrag_CUR",routerKind:"manhattan",children:[ne()]},{id:"Isc_fac_IdleSpdStab->MultOpDrag",type:"edge:straight",sourceId:"Isc_fac_IdleSpdStab",targetId:"MultOpDrag",routerKind:"manhattan",routingPoints:[{x:635,y:627.5}],children:[ne()]},{id:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP->AddOpDrag",type:"edge:straight",sourceId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",targetId:"AddOpDrag",routerKind:"manhattan",children:[ne()]},{id:"AddOpDrag->AddOpDrag",type:"edge:straight",sourceId:"AddOpDrag",targetId:"Tqs_tqDrag",routerKind:"manhattan",children:[ne()]},{id:"Tqs_tqDrag->MultOpDrag",type:"edge:straight",sourceId:"Tqs_tqDrag",targetId:"MultOpDrag",routerKind:"manhattan",children:[ne()]},{id:"Tqs_atCool2tqDrag_CUR->AddOpDrag",type:"edge:straight",sourceId:"Tqs_atCool2tqDrag_CUR",targetId:"AddOpDrag",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->Tqs_tqMin",type:"edge:straight",sourceId:"MultOpDrag",targetId:"Tqs_tqMin",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->SubOp",type:"edge:straight",sourceId:"MultOpDrag",targetId:"SubOp",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->AddOpEgas",type:"edge:straight",sourceId:"MultOpDrag",targetId:"AddOpEgas",routerKind:"manhattan",routingPoints:[{x:815,y:402.5}],children:[ne()]},{id:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP->Tqs_facEgasFilt",type:"edge:straight",sourceId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",targetId:"Tqs_facEgasFilt",routerKind:"manhattan",children:[ne()]},{id:"Tqs_facEgasFilt->MultOpEgas",type:"edge:straight",sourceId:"Tqs_facEgasFilt",targetId:"MultOpEgas",routerKind:"manhattan",children:[ne()]},{id:"Tqs_rpmEngSpd2tqMax_CUR->Tqs_tqMax",type:"edge:straight",sourceId:"Tqs_rpmEngSpd2tqMax_CUR",targetId:"Tqs_tqMax",routerKind:"manhattan",children:[ne()]},{id:"Tqs_tqMax->SubOp",type:"edge:straight",sourceId:"Tqs_tqMax",targetId:"SubOp",routerKind:"manhattan",children:[ne()]},{id:"SubOp->MultOpEgas",type:"edge:straight",sourceId:"SubOp",targetId:"MultOpEgas",routerKind:"manhattan",children:[ne()]},{id:"MultOpEgas->AddOpEgas",type:"edge:straight",sourceId:"MultOpEgas",targetId:"AddOpEgas",routerKind:"manhattan",children:[ne()]},{id:"AddOpEgas->AddOpCalcReq",type:"edge:straight",sourceId:"AddOpEgas",targetId:"AddOpCalcReq",routerKind:"manhattan",children:[ne()]},{id:"bigController->AddOpCalcReq",type:"edge:straight",sourceId:"bigController",targetId:"AddOpCalcReq",routerKind:"manhattan",children:[ne()]},{id:"AddOpCalcReq->Tqs_tqReqCalc",type:"edge:straight",sourceId:"AddOpCalcReq",targetId:"Tqs_tqReqCalc",routerKind:"manhattan",children:[ne()]},{id:"Tqs_flgTorqueRegOverride->Relais",type:"edge:straight",sourceId:"Tqs_flgTorqueRegOverride",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1165,y:27.5}],children:[ne()]},{id:"Tqs_tqReqCalc->Relais",type:"edge:straight",sourceId:"Tqs_tqReqCalc",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1110,y:120}],children:[ne()]},{id:"Tqs_tqReqMan->Relais",type:"edge:straight",sourceId:"Tqs_tqReqMan",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1110,y:150}],children:[ne()]},{id:"Relais->Tqs_tqReq",type:"edge:straight",sourceId:"Relais",targetId:"Tqs_tqReq",routerKind:"manhattan",children:[ne()]}]};function LP(){DP("sprotty-showcase").get(NP.TYPES.ModelSource).setModel(jP)}document.addEventListener("DOMContentLoaded",()=>LP());})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=bundle.js.map
