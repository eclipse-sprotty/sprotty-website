(()=>{var BP=Object.create;var wf=Object.defineProperty;var H_=Object.getOwnPropertyDescriptor;var FP=Object.getOwnPropertyNames;var VP=Object.getPrototypeOf,KP=Object.prototype.hasOwnProperty;var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var HP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of FP(e))!KP.call(i,r)&&r!==t&&wf(i,r,{get:()=>e[r],enumerable:!(n=H_(e,r))||n.enumerable});return i};var Vr=(i,e,t)=>(t=i!=null?BP(VP(i)):{},HP(e||!i||!i.__esModule?wf(t,"default",{value:i,enumerable:!0}):t,i));var Os=(i,e,t,n)=>{for(var r=n>1?void 0:n?H_(e,t):e,o=i.length-1,s;o>=0;o--)(s=i[o])&&(r=(n?s(e,t,r):s(r))||r);return n&&r&&wf(e,t,r),r};var _n=f(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.safeAssign=di.hasOwnProperty=di.isObject=void 0;function Y_(i){return typeof i=="object"&&i!==null}di.isObject=Y_;function zP(i,e,t){if(!Y_(i))return!1;if(Array.isArray(e))for(let n of e){if(!Object.prototype.hasOwnProperty.call(i,n)||typeof t=="string"&&typeof i[n]!==t)return!1;if(typeof t=="function"&&!t(i[n]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,e))return!1;if(typeof t=="string")return typeof i[e]===t;if(typeof t=="function")return t(i[e])}return!0}di.hasOwnProperty=zP;function YP(i,e){return Object.assign(i,e)}di.safeAssign=YP});var te=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ReconnectAction=E.ApplyLabelEditAction=E.DeleteElementAction=E.CreateElementAction=E.HoverFeedbackAction=E.MoveAction=E.RedoAction=E.UndoAction=E.BringToFrontAction=E.SetViewportAction=E.FitToScreenAction=E.CenterAction=E.LayoutAction=E.OpenAction=E.CollapseExpandAllAction=E.CollapseExpandAction=E.SelectAllAction=E.SelectAction=E.LoggingAction=E.ComputedBoundsAction=E.RequestBoundsAction=E.SetBoundsAction=E.SetPopupModelAction=E.RequestPopupModelAction=E.UpdateModelAction=E.SetModelAction=E.RequestModelAction=E.RejectAction=E.isResponseAction=E.generateRequestId=E.isRequestAction=E.isAction=E.isActionMessage=void 0;var lc=_n();function kP(i){return(0,lc.hasOwnProperty)(i,"action")}E.isActionMessage=kP;function UP(i){return(0,lc.hasOwnProperty)(i,"kind","string")}E.isAction=UP;function GP(i){return(0,lc.hasOwnProperty)(i,"requestId","string")}E.isRequestAction=GP;var WP=1;function fc(){return(WP++).toString()}E.generateRequestId=fc;function $P(i){return(0,lc.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}E.isResponseAction=$P;var XP;(function(i){i.KIND="rejectRequest";function e(t){return{kind:i.KIND,message:t.message,detail:t.detail,responseId:t.requestId}}i.create=e})(XP=E.RejectAction||(E.RejectAction={}));var JP;(function(i){i.KIND="requestModel";function e(t){return{kind:i.KIND,options:t,requestId:fc()}}i.create=e})(JP=E.RequestModelAction||(E.RequestModelAction={}));var ZP;(function(i){i.KIND="setModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(ZP=E.SetModelAction||(E.SetModelAction={}));var QP;(function(i){i.KIND="updateModel";function e(t,n={}){return Array.isArray(t)?{kind:i.KIND,matches:t,animate:n.animate,cause:n.cause}:{kind:i.KIND,newRoot:t,animate:n.animate,cause:n.cause}}i.create=e})(QP=E.UpdateModelAction||(E.UpdateModelAction={}));var eI;(function(i){i.KIND="requestPopupModel";function e(t){return{kind:i.KIND,elementId:t.elementId,bounds:t.bounds,requestId:fc()}}i.create=e})(eI=E.RequestPopupModelAction||(E.RequestPopupModelAction={}));var tI;(function(i){i.KIND="setPopupModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(tI=E.SetPopupModelAction||(E.SetPopupModelAction={}));var nI;(function(i){i.KIND="setBounds";function e(t){return{kind:i.KIND,bounds:t}}i.create=e})(nI=E.SetBoundsAction||(E.SetBoundsAction={}));var iI;(function(i){i.KIND="requestBounds";function e(t){return{kind:i.KIND,newRoot:t,requestId:fc()}}i.create=e})(iI=E.RequestBoundsAction||(E.RequestBoundsAction={}));var rI;(function(i){i.KIND="computedBounds";function e(t,n={}){var r;return{kind:i.KIND,bounds:t,revision:n.revision,alignments:n.alignments,responseId:(r=n.requestId)!==null&&r!==void 0?r:""}}i.create=e})(rI=E.ComputedBoundsAction||(E.ComputedBoundsAction={}));var oI;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(oI=E.LoggingAction||(E.LoggingAction={}));var sI;(function(i){i.KIND="elementSelected";function e(t){var n,r;return{kind:i.KIND,selectedElementsIDs:(n=t.selectedElementsIDs)!==null&&n!==void 0?n:[],deselectedElementsIDs:(r=t.deselectedElementsIDs)!==null&&r!==void 0?r:[]}}i.create=e})(sI=E.SelectAction||(E.SelectAction={}));var aI;(function(i){i.KIND="allSelected";function e(t={}){var n;return{kind:i.KIND,select:(n=t.select)!==null&&n!==void 0?n:!0}}i.create=e})(aI=E.SelectAllAction||(E.SelectAllAction={}));var cI;(function(i){i.KIND="collapseExpand";function e(t){var n,r;return{kind:i.KIND,expandIds:(n=t.expandIds)!==null&&n!==void 0?n:[],collapseIds:(r=t.collapseIds)!==null&&r!==void 0?r:[]}}i.create=e})(cI=E.CollapseExpandAction||(E.CollapseExpandAction={}));var uI;(function(i){i.KIND="collapseExpandAll";function e(t={}){var n;return{kind:i.KIND,expand:(n=t.expand)!==null&&n!==void 0?n:!0}}i.create=e})(uI=E.CollapseExpandAllAction||(E.CollapseExpandAllAction={}));var dI;(function(i){i.KIND="open";function e(t){return{kind:i.KIND,elementId:t}}i.create=e})(dI=E.OpenAction||(E.OpenAction={}));var lI;(function(i){i.KIND="layout";function e(t={}){return{kind:i.KIND,layoutType:t.layoutType,elementIds:t.elementIds}}i.create=e})(lI=E.LayoutAction||(E.LayoutAction={}));var fI;(function(i){i.KIND="center";function e(t,n={}){var r,o;return{kind:i.KIND,elementIds:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,retainZoom:(o=n.retainZoom)!==null&&o!==void 0?o:!1}}i.create=e})(fI=E.CenterAction||(E.CenterAction={}));var hI;(function(i){i.KIND="fit";function e(t,n={}){var r;return{kind:i.KIND,elementIds:t,padding:n.padding,maxZoom:n.maxZoom,animate:(r=n.animate)!==null&&r!==void 0?r:!0}}i.create=e})(hI=E.FitToScreenAction||(E.FitToScreenAction={}));var pI;(function(i){i.KIND="viewport";function e(t,n,r={}){var o;return{kind:i.KIND,elementId:t,newViewport:n,animate:(o=r.animate)!==null&&o!==void 0?o:!0}}i.create=e})(pI=E.SetViewportAction||(E.SetViewportAction={}));var gI;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(gI=E.BringToFrontAction||(E.BringToFrontAction={}));var mI;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(mI=E.UndoAction||(E.UndoAction={}));var yI;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(yI=E.RedoAction||(E.RedoAction={}));var _I;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(_I=E.MoveAction||(E.MoveAction={}));var vI;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(vI=E.HoverFeedbackAction||(E.HoverFeedbackAction={}));var bI;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(bI=E.CreateElementAction||(E.CreateElementAction={}));var SI;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(SI=E.DeleteElementAction||(E.DeleteElementAction={}));var EI;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(EI=E.ApplyLabelEditAction||(E.ApplyLabelEditAction={}));var wI;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(wI=E.ReconnectAction||(E.ReconnectAction={}))});var hc=f($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.isLabeledAction=$e.LabeledAction=$e.RejectAction=$e.isResponseAction=$e.generateRequestId=$e.isRequestAction=$e.isAction=void 0;var PI=te(),If=_n();function Rf(i){return(0,If.hasOwnProperty)(i,"kind","string")}$e.isAction=Rf;function II(i){return Rf(i)&&(0,If.hasOwnProperty)(i,"requestId","string")}$e.isRequestAction=II;$e.generateRequestId=PI.generateRequestId;function RI(i){return Rf(i)&&(0,If.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}$e.isResponseAction=RI;var Kr=class{constructor(e,t,n){this.message=e,this.responseId=t,this.detail=n,this.kind=Kr.KIND}};$e.RejectAction=Kr;Kr.KIND="rejectRequest";var Pf=class{constructor(e,t,n){this.label=e,this.actions=t,this.icon=n}};$e.LabeledAction=Pf;function MI(i){return i!==void 0&&i.label!==void 0&&i.actions!==void 0}$e.isLabeledAction=MI});var Ce=f(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0;J.NAMED_TAG="named";J.NAME_TAG="name";J.UNMANAGED_TAG="unmanaged";J.OPTIONAL_TAG="optional";J.INJECT_TAG="inject";J.MULTI_INJECT_TAG="multi_inject";J.TAGGED="inversify:tagged";J.TAGGED_PROP="inversify:tagged_props";J.PARAM_TYPES="inversify:paramtypes";J.DESIGN_PARAM_TYPES="design:paramtypes";J.POST_CONSTRUCT="post_construct";function OI(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=OI()});var vn=f(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.TargetTypeEnum=li.BindingTypeEnum=li.BindingScopeEnum=void 0;var TI={Request:"Request",Singleton:"Singleton",Transient:"Transient"};li.BindingScopeEnum=TI;var AI={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};li.BindingTypeEnum=AI;var CI={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};li.TargetTypeEnum=CI});var fi=f(pc=>{"use strict";Object.defineProperty(pc,"__esModule",{value:!0});pc.id=void 0;var xI=0;function DI(){return xI++}pc.id=DI});var U_=f(gc=>{"use strict";Object.defineProperty(gc,"__esModule",{value:!0});gc.Binding=void 0;var k_=vn(),qI=fi(),jI=function(){function i(e,t){this.id=qI.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=k_.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return i.prototype.clone=function(){var e=new i(this.serviceIdentifier,this.scope);return e.activated=e.scope===k_.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},i}();gc.Binding=jI});var ht=f(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.STACK_OVERFLOW=T.CIRCULAR_DEPENDENCY_IN_FACTORY=T.POST_CONSTRUCT_ERROR=T.MULTIPLE_POST_CONSTRUCT_METHODS=T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=T.ARGUMENTS_LENGTH_MISMATCH=T.INVALID_DECORATOR_OPERATION=T.INVALID_TO_SELF_VALUE=T.INVALID_FUNCTION_BINDING=T.INVALID_MIDDLEWARE_RETURN=T.NO_MORE_SNAPSHOTS_AVAILABLE=T.INVALID_BINDING_TYPE=T.NOT_IMPLEMENTED=T.CIRCULAR_DEPENDENCY=T.UNDEFINED_INJECT_ANNOTATION=T.MISSING_INJECT_ANNOTATION=T.MISSING_INJECTABLE_ANNOTATION=T.NOT_REGISTERED=T.CANNOT_UNBIND=T.AMBIGUOUS_MATCH=T.KEY_NOT_FOUND=T.NULL_ARGUMENT=T.DUPLICATED_METADATA=T.DUPLICATED_INJECTABLE_DECORATOR=void 0;T.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";T.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";T.NULL_ARGUMENT="NULL argument";T.KEY_NOT_FOUND="Key Not Found";T.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";T.CANNOT_UNBIND="Could not unbind serviceIdentifier:";T.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";T.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";T.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var NI=function(i){return"@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};T.UNDEFINED_INJECT_ANNOTATION=NI;T.CIRCULAR_DEPENDENCY="Circular dependency found:";T.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";T.INVALID_BINDING_TYPE="Invalid binding type:";T.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";T.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";T.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";T.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";T.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var LI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"The number of constructor arguments in the derived class "+(i[0]+" must be >= than the number of constructor arguments of its base class.")};T.ARGUMENTS_LENGTH_MISMATCH=LI;T.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";T.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";T.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";T.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";T.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var BI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"@postConstruct error in class "+i[0]+": "+i[1]};T.POST_CONSTRUCT_ERROR=BI;var FI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"It looks like there is a circular dependency "+("in one of the '"+i[0]+"' bindings. Please investigate bindings with")+("service identifier '"+i[1]+"'.")};T.CIRCULAR_DEPENDENCY_IN_FACTORY=FI;T.STACK_OVERFLOW="Maximum call stack size exceeded"});var Of=f(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});mc.MetadataReader=void 0;var Mf=Ce(),VI=function(){function i(){}return i.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(Mf.PARAM_TYPES,e),n=Reflect.getMetadata(Mf.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},i.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(Mf.TAGGED_PROP,e)||[];return t},i}();mc.MetadataReader=VI});var G_=f(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});yc.BindingCount=void 0;var KI={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};yc.BindingCount=KI});var Tf=f(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.isStackOverflowExeption=void 0;var HI=ht();function zI(i){return i instanceof RangeError||i.message===HI.STACK_OVERFLOW}_c.isStackOverflowExeption=zI});var Hr=f(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.circularDependencyToException=Vt.listMetadataForTarget=Vt.listRegisteredBindingsForServiceIdentifier=Vt.getServiceIdentifierAsString=Vt.getFunctionName=void 0;var YI=ht();function W_(i){if(typeof i=="function"){var e=i;return e.name}else{if(typeof i=="symbol")return i.toString();var e=i;return e}}Vt.getServiceIdentifierAsString=W_;function kI(i,e,t){var n="",r=t(i,e);return r.length!==0&&(n=`
Registered bindings:`,r.forEach(function(o){var s="Object";o.implementationType!==null&&(s=J_(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Vt.listRegisteredBindingsForServiceIdentifier=kI;function $_(i,e){return i.parentRequest===null?!1:i.parentRequest.serviceIdentifier===e?!0:$_(i.parentRequest,e)}function UI(i){function e(n,r){r===void 0&&(r=[]);var o=W_(n.serviceIdentifier);return r.push(o),n.parentRequest!==null?e(n.parentRequest,r):r}var t=e(i);return t.reverse().join(" --> ")}function X_(i){i.childRequests.forEach(function(e){if($_(e,e.serviceIdentifier)){var t=UI(e);throw new Error(YI.CIRCULAR_DEPENDENCY+" "+t)}else X_(e)})}Vt.circularDependencyToException=X_;function GI(i,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),r=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),r!==null&&r.forEach(function(o){t+=o.toString()+`
`})," "+i+`
 `+i+" - "+t}else return" "+i}Vt.listMetadataForTarget=GI;function J_(i){if(i.name)return i.name;var e=i.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Vt.getFunctionName=J_});var Z_=f(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});vc.Context=void 0;var WI=fi(),$I=function(){function i(e){this.id=WI.id(),this.container=e}return i.prototype.addPlan=function(e){this.plan=e},i.prototype.setCurrentRequest=function(e){this.currentRequest=e},i}();vc.Context=$I});var Kt=f(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.Metadata=void 0;var XI=Ce(),JI=function(){function i(e,t){this.key=e,this.value=t}return i.prototype.toString=function(){return this.key===XI.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},i}();bc.Metadata=JI});var Q_=f(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.Plan=void 0;var ZI=function(){function i(e,t){this.parentContext=e,this.rootRequest=t}return i}();Sc.Plan=ZI});var Yn=f(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.tagProperty=hi.tagParameter=hi.decorate=void 0;var ev=ht(),nv=Ce();function QI(i,e,t,n){var r=nv.TAGGED;iv(r,i,e,n,t)}hi.tagParameter=QI;function eR(i,e,t){var n=nv.TAGGED_PROP;iv(n,i.constructor,e,t)}hi.tagProperty=eR;function iv(i,e,t,n,r){var o={},s=typeof r=="number",a=r!==void 0&&s?r.toString():t;if(s&&t!==void 0)throw new Error(ev.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(i,e)&&(o=Reflect.getMetadata(i,e));var c=o[a];if(!Array.isArray(c))c=[];else for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===n.key)throw new Error(ev.DUPLICATED_METADATA+" "+l.key.toString())}c.push(n),o[a]=c,Reflect.defineMetadata(i,o,e)}function tv(i,e){Reflect.decorate(i,e)}function tR(i,e){return function(t,n){e(t,n,i)}}function nR(i,e,t){typeof t=="number"?tv([tR(t,i)],e):typeof t=="string"?Reflect.decorate([i],e,t):tv([i],e)}hi.decorate=nR});var Af=f(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.inject=zr.LazyServiceIdentifer=void 0;var iR=ht(),rR=Ce(),oR=Kt(),rv=Yn(),sR=function(){function i(e){this._cb=e}return i.prototype.unwrap=function(){return this._cb()},i}();zr.LazyServiceIdentifer=sR;function aR(i){return function(e,t,n){if(i===void 0)throw new Error(iR.UNDEFINED_INJECT_ANNOTATION(e.name));var r=new oR.Metadata(rR.INJECT_TAG,i);typeof n=="number"?rv.tagParameter(e,t,n,r):rv.tagProperty(e,t,r)}}zr.inject=aR});var ov=f(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.QueryableString=void 0;var cR=function(){function i(e){this.str=e}return i.prototype.startsWith=function(e){return this.str.indexOf(e)===0},i.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},i.prototype.contains=function(e){return this.str.indexOf(e)!==-1},i.prototype.equals=function(e){return this.str===e},i.prototype.value=function(){return this.str},i}();Ec.QueryableString=cR});var Cf=f(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.Target=void 0;var kn=Ce(),uR=fi(),sv=Kt(),dR=ov(),lR=function(){function i(e,t,n,r){this.id=uR.id(),this.type=e,this.serviceIdentifier=n,this.name=new dR.QueryableString(t||""),this.metadata=new Array;var o=null;typeof r=="string"?o=new sv.Metadata(kn.NAMED_TAG,r):r instanceof sv.Metadata&&(o=r),o!==null&&this.metadata.push(o)}return i.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var r=n[t];if(r.key===e)return!0}return!1},i.prototype.isArray=function(){return this.hasTag(kn.MULTI_INJECT_TAG)},i.prototype.matchesArray=function(e){return this.matchesTag(kn.MULTI_INJECT_TAG)(e)},i.prototype.isNamed=function(){return this.hasTag(kn.NAMED_TAG)},i.prototype.isTagged=function(){return this.metadata.some(function(e){return kn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},i.prototype.isOptional=function(){return this.matchesTag(kn.OPTIONAL_TAG)(!0)},i.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===kn.NAMED_TAG})[0]:null},i.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return kn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},i.prototype.matchesNamedTag=function(e){return this.matchesTag(kn.NAMED_TAG)(e)},i.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var s=o[r];if(s.key===e&&s.value===n)return!0}return!1}},i}();wc.Target=lR});var pv=f(bn=>{"use strict";var Pc=bn&&bn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(bn,"__esModule",{value:!0});bn.getFunctionName=bn.getBaseClassDependencyCount=bn.getDependencies=void 0;var fR=Af(),av=ht(),cv=vn(),Ts=Ce(),xf=Hr();Object.defineProperty(bn,"getFunctionName",{enumerable:!0,get:function(){return xf.getFunctionName}});var uv=Cf();function hR(i,e){var t=xf.getFunctionName(e),n=dv(i,t,e,!1);return n}bn.getDependencies=hR;function dv(i,e,t,n){var r=i.getConstructorMetadata(t),o=r.compilerGeneratedMetadata;if(o===void 0){var s=av.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=r.userGeneratedMetadata,c=Object.keys(a),u=t.length===0&&c.length>0,d=c.length>t.length,l=u||d?c.length:t.length,S=gR(n,e,o,a,l),R=lv(i,t),v=Pc(Pc([],S),R);return v}function pR(i,e,t,n,r){var o=r[i.toString()]||[],s=hv(o),a=s.unmanaged!==!0,c=n[i],u=s.inject||s.multiInject;if(c=u||c,c instanceof fR.LazyServiceIdentifer&&(c=c.unwrap()),a){var d=c===Object,l=c===Function,S=c===void 0,R=d||l||S;if(!e&&R){var v=av.MISSING_INJECT_ANNOTATION+" argument "+i+" in class "+t+".";throw new Error(v)}var m=new uv.Target(cv.TargetTypeEnum.ConstructorArgument,s.targetName,c);return m.metadata=o,m}return null}function gR(i,e,t,n,r){for(var o=[],s=0;s<r;s++){var a=s,c=pR(a,i,e,t,n);c!==null&&o.push(c)}return o}function lv(i,e){for(var t=i.getPropertiesMetadata(e),n=[],r=Object.keys(t),o=0,s=r;o<s.length;o++){var a=s[o],c=t[a],u=hv(t[a]),d=u.targetName||a,l=u.inject||u.multiInject,S=new uv.Target(cv.TargetTypeEnum.ClassProperty,d,l);S.metadata=c,n.push(S)}var R=Object.getPrototypeOf(e.prototype).constructor;if(R!==Object){var v=lv(i,R);n=Pc(Pc([],n),v)}return n}function fv(i,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=xf.getFunctionName(t),r=dv(i,n,t,!0),o=r.map(function(c){return c.metadata.filter(function(u){return u.key===Ts.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=r.length-s;return a>0?a:fv(i,t)}else return 0}bn.getBaseClassDependencyCount=fv;function hv(i){var e={};return i.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[Ts.INJECT_TAG],multiInject:e[Ts.MULTI_INJECT_TAG],targetName:e[Ts.NAME_TAG],unmanaged:e[Ts.UNMANAGED_TAG]}}});var gv=f(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.Request=void 0;var mR=fi(),yR=function(){function i(e,t,n,r,o){this.id=mR.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=n===null?new Map:null}return i.prototype.addChildRequest=function(e,t,n){var r=new i(e,this.parentContext,this,t,n);return this.childRequests.push(r),r},i}();Ic.Request=yR});var wv=f(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.getBindingDictionary=pi.createMockRequest=pi.plan=void 0;var Rc=G_(),qf=ht(),_v=vn(),mv=Ce(),_R=Tf(),Yr=Hr(),vv=Z_(),jf=Kt(),vR=Q_(),Df=pv(),Nf=gv(),bv=Cf();function Sv(i){return i._bindingDictionary}pi.getBindingDictionary=Sv;function bR(i,e,t,n,r,o){var s=i?mv.MULTI_INJECT_TAG:mv.INJECT_TAG,a=new jf.Metadata(s,t),c=new bv.Target(e,n,t,a);if(r!==void 0){var u=new jf.Metadata(r,o);c.metadata.push(u)}return c}function yv(i,e,t,n,r){var o=As(t.container,r.serviceIdentifier),s=[];return o.length===Rc.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(r.serviceIdentifier).toSelf(),o=As(t.container,r.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new Nf.Request(a.serviceIdentifier,t,n,a,r);return a.constraint(c)}),SR(r.serviceIdentifier,s,r,t.container),s}function SR(i,e,t,n){switch(e.length){case Rc.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var r=Yr.getServiceIdentifierAsString(i),o=qf.NOT_REGISTERED;throw o+=Yr.listMetadataForTarget(r,t),o+=Yr.listRegisteredBindingsForServiceIdentifier(n,r,As),new Error(o);case Rc.BindingCount.OnlyOneBindingAvailable:if(!t.isArray())return e;case Rc.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var r=Yr.getServiceIdentifierAsString(i),o=qf.AMBIGUOUS_MATCH+" "+r;throw o+=Yr.listRegisteredBindingsForServiceIdentifier(n,r,As),new Error(o)}}function Ev(i,e,t,n,r,o){var s,a;if(r===null){s=yv(i,e,n,null,o),a=new Nf.Request(t,n,null,s,o);var c=new vR.Plan(n,a);n.addPlan(c)}else s=yv(i,e,n,r,o),a=r.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(u){var d=null;if(o.isArray())d=a.addChildRequest(u.serviceIdentifier,u,o);else{if(u.cache)return;d=a}if(u.type===_v.BindingTypeEnum.Instance&&u.implementationType!==null){var l=Df.getDependencies(i,u.implementationType);if(!n.container.options.skipBaseClassChecks){var S=Df.getBaseClassDependencyCount(i,u.implementationType);if(l.length<S){var R=qf.ARGUMENTS_LENGTH_MISMATCH(Df.getFunctionName(u.implementationType));throw new Error(R)}}l.forEach(function(v){Ev(i,!1,v.serviceIdentifier,n,d,v)})}})}function As(i,e){var t=[],n=Sv(i);return n.hasKey(e)?t=n.get(e):i.parent!==null&&(t=As(i.parent,e)),t}function ER(i,e,t,n,r,o,s,a){a===void 0&&(a=!1);var c=new vv.Context(e),u=bR(t,n,r,"",o,s);try{return Ev(i,a,r,c,null,u),c}catch(d){throw _R.isStackOverflowExeption(d)&&c.plan&&Yr.circularDependencyToException(c.plan.rootRequest),d}}pi.plan=ER;function wR(i,e,t,n){var r=new bv.Target(_v.TargetTypeEnum.Variable,"",e,new jf.Metadata(t,n)),o=new vv.Context(i),s=new Nf.Request(e,o,null,[],r);return s}pi.createMockRequest=wR});var Rv=f(kr=>{"use strict";var PR=kr&&kr.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(kr,"__esModule",{value:!0});kr.resolveInstance=void 0;var IR=ht(),Iv=vn(),Pv=Ce();function RR(i,e,t){var n=e.filter(function(o){return o.target!==null&&o.target.type===Iv.TargetTypeEnum.ClassProperty}),r=n.map(t);return n.forEach(function(o,s){var a="";a=o.target.name.value();var c=r[s];i[a]=c}),i}function MR(i,e){return new(i.bind.apply(i,PR([void 0],e)))}function OR(i,e){if(Reflect.hasMetadata(Pv.POST_CONSTRUCT,i)){var t=Reflect.getMetadata(Pv.POST_CONSTRUCT,i);try{e[t.value]()}catch(n){throw new Error(IR.POST_CONSTRUCT_ERROR(i.name,n.message))}}}function TR(i,e,t){var n=null;if(e.length>0){var r=e.filter(function(s){return s.target!==null&&s.target.type===Iv.TargetTypeEnum.ConstructorArgument}),o=r.map(t);n=MR(i,o),n=RR(n,e,t)}else n=new i;return OR(i,n),n}kr.resolveInstance=TR});var Ov=f(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.resolve=void 0;var Mv=ht(),Un=vn(),AR=Tf(),CR=Hr(),xR=Rv(),Lf=function(i,e,t){try{return t()}catch(n){throw AR.isStackOverflowExeption(n)?new Error(Mv.CIRCULAR_DEPENDENCY_IN_FACTORY(i,e.toString())):n}},Bf=function(i){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,r=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(r&&o)return n.map(function(l){var S=Bf(i);return S(l)});var s=null;if(e.target.isOptional()&&t.length===0)return;var a=t[0],c=a.scope===Un.BindingScopeEnum.Singleton,u=a.scope===Un.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&i!==null&&i.has(a.id))return i.get(a.id);if(a.type===Un.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===Un.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===Un.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===Un.BindingTypeEnum.DynamicValue&&a.dynamicValue!==null)s=Lf("toDynamicValue",a.serviceIdentifier,function(){return a.dynamicValue(e.parentContext)});else if(a.type===Un.BindingTypeEnum.Factory&&a.factory!==null)s=Lf("toFactory",a.serviceIdentifier,function(){return a.factory(e.parentContext)});else if(a.type===Un.BindingTypeEnum.Provider&&a.provider!==null)s=Lf("toProvider",a.serviceIdentifier,function(){return a.provider(e.parentContext)});else if(a.type===Un.BindingTypeEnum.Instance&&a.implementationType!==null)s=xR.resolveInstance(a.implementationType,n,Bf(i));else{var d=CR.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(Mv.INVALID_BINDING_TYPE+" "+d)}return typeof a.onActivation=="function"&&(s=a.onActivation(e.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&i!==null&&!i.has(a.id)&&i.set(a.id,s),s}};function DR(i){var e=Bf(i.plan.rootRequest.requestScope);return e(i.plan.rootRequest)}Mc.resolve=DR});var Ff=f(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.typeConstraint=Sn.namedConstraint=Sn.taggedConstraint=Sn.traverseAncerstors=void 0;var qR=Ce(),jR=Kt(),Tv=function(i,e){var t=i.parentRequest;return t!==null?e(t)?!0:Tv(t,e):!1};Sn.traverseAncerstors=Tv;var Av=function(i){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(i)(e)};return t.metaData=new jR.Metadata(i,e),t}};Sn.taggedConstraint=Av;var NR=Av(qR.NAMED_TAG);Sn.namedConstraint=NR;var LR=function(i){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof i=="string"){var n=t.serviceIdentifier;return n===i}else{var r=e.bindings[0].implementationType;return i===r}return!1}};Sn.typeConstraint=LR});var Tc=f(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.BindingWhenSyntax=void 0;var st=Ac(),xe=Ff(),BR=function(){function i(e){this._binding=e}return i.prototype.when=function(e){return this._binding.constraint=e,new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetNamed=function(e){return this._binding.constraint=xe.namedConstraint(e),new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=xe.taggedConstraint(e)(t),new st.BindingOnSyntax(this._binding)},i.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return xe.typeConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return xe.namedConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return xe.taggedConstraint(e)(t)(n.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,xe.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,xe.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,xe.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,xe.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return xe.traverseAncerstors(n,xe.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!xe.traverseAncerstors(n,xe.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return xe.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!xe.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i}();Oc.BindingWhenSyntax=BR});var Ac=f(Cc=>{"use strict";Object.defineProperty(Cc,"__esModule",{value:!0});Cc.BindingOnSyntax=void 0;var FR=Tc(),VR=function(){function i(e){this._binding=e}return i.prototype.onActivation=function(e){return this._binding.onActivation=e,new FR.BindingWhenSyntax(this._binding)},i}();Cc.BindingOnSyntax=VR});var Vf=f(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.BindingWhenOnSyntax=void 0;var KR=Ac(),HR=Tc(),zR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new HR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new KR.BindingOnSyntax(this._binding)}return i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();xc.BindingWhenOnSyntax=zR});var Cv=f(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.BindingInSyntax=void 0;var Kf=vn(),Hf=Vf(),YR=function(){function i(e){this._binding=e}return i.prototype.inRequestScope=function(){return this._binding.scope=Kf.BindingScopeEnum.Request,new Hf.BindingWhenOnSyntax(this._binding)},i.prototype.inSingletonScope=function(){return this._binding.scope=Kf.BindingScopeEnum.Singleton,new Hf.BindingWhenOnSyntax(this._binding)},i.prototype.inTransientScope=function(){return this._binding.scope=Kf.BindingScopeEnum.Transient,new Hf.BindingWhenOnSyntax(this._binding)},i}();Dc.BindingInSyntax=YR});var xv=f(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});qc.BindingInWhenOnSyntax=void 0;var kR=Cv(),UR=Ac(),GR=Tc(),WR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new GR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new UR.BindingOnSyntax(this._binding),this._bindingInSyntax=new kR.BindingInSyntax(e)}return i.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},i.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},i.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();qc.BindingInWhenOnSyntax=WR});var jv=f(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.BindingToSyntax=void 0;var Dv=ht(),pt=vn(),qv=xv(),Cs=Vf(),$R=function(){function i(e){this._binding=e}return i.prototype.to=function(e){return this._binding.type=pt.BindingTypeEnum.Instance,this._binding.implementationType=e,new qv.BindingInWhenOnSyntax(this._binding)},i.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Dv.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},i.prototype.toConstantValue=function(e){return this._binding.type=pt.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pt.BindingScopeEnum.Singleton,new Cs.BindingWhenOnSyntax(this._binding)},i.prototype.toDynamicValue=function(e){return this._binding.type=pt.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new qv.BindingInWhenOnSyntax(this._binding)},i.prototype.toConstructor=function(e){return this._binding.type=pt.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Cs.BindingWhenOnSyntax(this._binding)},i.prototype.toFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Cs.BindingWhenOnSyntax(this._binding)},i.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Dv.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=pt.BindingTypeEnum.Function,this._binding.scope=pt.BindingScopeEnum.Singleton,t},i.prototype.toAutoFactory=function(e){return this._binding.type=pt.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=pt.BindingScopeEnum.Singleton,new Cs.BindingWhenOnSyntax(this._binding)},i.prototype.toProvider=function(e){return this._binding.type=pt.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=pt.BindingScopeEnum.Singleton,new Cs.BindingWhenOnSyntax(this._binding)},i.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},i}();jc.BindingToSyntax=$R});var Nv=f(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.ContainerSnapshot=void 0;var XR=function(){function i(){}return i.of=function(e,t){var n=new i;return n.bindings=e,n.middleware=t,n},i}();Nc.ContainerSnapshot=XR});var Lv=f(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.Lookup=void 0;var Qi=ht(),JR=function(){function i(){this._map=new Map}return i.prototype.getMap=function(){return this._map},i.prototype.add=function(e,t){if(e==null)throw new Error(Qi.NULL_ARGUMENT);if(t==null)throw new Error(Qi.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},i.prototype.get=function(e){if(e==null)throw new Error(Qi.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(Qi.KEY_NOT_FOUND)},i.prototype.remove=function(e){if(e==null)throw new Error(Qi.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(Qi.KEY_NOT_FOUND)},i.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var o=n.filter(function(s){return!e(s)});o.length>0?t._map.set(r,o):t._map.delete(r)})},i.prototype.hasKey=function(e){if(e==null)throw new Error(Qi.NULL_ARGUMENT);return this._map.has(e)},i.prototype.clone=function(){var e=new i;return this._map.forEach(function(t,n){t.forEach(function(r){return e.add(n,r.clone())})}),e},i.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},i}();Lc.Lookup=JR});var Fv=f(En=>{"use strict";var ZR=En&&En.__awaiter||function(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(l){s(l)}}function c(d){try{u(n.throw(d))}catch(l){s(l)}}function u(d){d.done?o(d.value):r(d.value).then(a,c)}u((n=n.apply(i,e||[])).next())})},QR=En&&En.__generator||function(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},eM=En&&En.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(En,"__esModule",{value:!0});En.Container=void 0;var tM=U_(),er=ht(),Gn=vn(),zf=Ce(),nM=Of(),Bc=wv(),iM=Ov(),rM=jv(),oM=fi(),sM=Hr(),aM=Nv(),Bv=Lv(),cM=function(){function i(e){this._appliedMiddleware=[];var t=e||{};if(typeof t!="object")throw new Error(""+er.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Gn.BindingScopeEnum.Transient;else if(t.defaultScope!==Gn.BindingScopeEnum.Singleton&&t.defaultScope!==Gn.BindingScopeEnum.Transient&&t.defaultScope!==Gn.BindingScopeEnum.Request)throw new Error(""+er.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+er.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+er.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=oM.id(),this._bindingDictionary=new Bv.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new nM.MetadataReader}return i.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i,s=eM([e,t],n).map(function(u){return Bc.getBindingDictionary(u)}),a=Bc.getBindingDictionary(o);function c(u,d){u.traverse(function(l,S){S.forEach(function(R){d.add(R.serviceIdentifier,R.clone())})})}return s.forEach(function(u){c(u,a)}),o},i.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var s=o[r],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},i.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ZR(this,void 0,void 0,function(){var n,r,o,s,a;return QR(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(o){return function(s){return s.moduleId===o}};t.forEach(function(o){var s=r(o.id);e._bindingDictionary.removeByCondition(s)})},i.prototype.bind=function(e){var t=this.options.defaultScope||Gn.BindingScopeEnum.Transient,n=new tM.Binding(e,t);return this._bindingDictionary.add(e,n),new rM.BindingToSyntax(n)},i.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},i.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(er.CANNOT_UNBIND+" "+sM.getServiceIdentifierAsString(e))}},i.prototype.unbindAll=function(){this._bindingDictionary=new Bv.Lookup},i.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},i.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,zf.NAMED_TAG,t)},i.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=Bc.createMockRequest(this,e,t,n);r=o.some(function(a){return a.constraint(s)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},i.prototype.snapshot=function(){this._snapshots.push(aM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},i.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(er.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},i.prototype.createChild=function(e){var t=new i(e||this.options);return t.parent=this,t},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(r,o){return o(r)},n)},i.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},i.prototype.get=function(e){return this._get(!1,!1,Gn.TargetTypeEnum.Variable,e)},i.prototype.getTagged=function(e,t,n){return this._get(!1,!1,Gn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getNamed=function(e,t){return this.getTagged(e,zf.NAMED_TAG,t)},i.prototype.getAll=function(e){return this._get(!0,!0,Gn.TargetTypeEnum.Variable,e)},i.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,Gn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,zf.NAMED_TAG,t)},i.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(e)},i.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(a,c){a._binding.moduleId=c},n=function(a){return function(c){var u=e.bind.bind(e),d=u(c);return t(d,a),d}},r=function(a){return function(c){var u=e.unbind.bind(e);u(c)}},o=function(a){return function(c){var u=e.isBound.bind(e);return u(c)}},s=function(a){return function(c){var u=e.rebind.bind(e),d=u(c);return t(d,a),d}};return function(a){return{bindFunction:n(a),isboundFunction:o(a),rebindFunction:s(a),unbindFunction:r(a)}}},i.prototype._get=function(e,t,n,r,o,s){var a=null,c={avoidConstraints:e,contextInterceptor:function(u){return u},isMultiInject:t,key:o,serviceIdentifier:r,targetType:n,value:s};if(this._middleware){if(a=this._middleware(c),a==null)throw new Error(er.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},i.prototype._planAndResolve=function(){var e=this;return function(t){var n=Bc.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var r=iM.resolve(n);return r}},i}();En.Container=cM});var Kv=f(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.AsyncContainerModule=Ur.ContainerModule=void 0;var Vv=fi(),uM=function(){function i(e){this.id=Vv.id(),this.registry=e}return i}();Ur.ContainerModule=uM;var dM=function(){function i(e){this.id=Vv.id(),this.registry=e}return i}();Ur.AsyncContainerModule=dM});var Hv=f(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.injectable=void 0;var lM=ht(),Yf=Ce();function fM(){return function(i){if(Reflect.hasOwnMetadata(Yf.PARAM_TYPES,i))throw new Error(lM.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(Yf.DESIGN_PARAM_TYPES,i)||[];return Reflect.defineMetadata(Yf.PARAM_TYPES,e,i),i}}Fc.injectable=fM});var Yv=f(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.tagged=void 0;var hM=Kt(),zv=Yn();function pM(i,e){return function(t,n,r){var o=new hM.Metadata(i,e);typeof r=="number"?zv.tagParameter(t,n,r,o):zv.tagProperty(t,n,o)}}Vc.tagged=pM});var Uv=f(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.named=void 0;var gM=Ce(),mM=Kt(),kv=Yn();function yM(i){return function(e,t,n){var r=new mM.Metadata(gM.NAMED_TAG,i);typeof n=="number"?kv.tagParameter(e,t,n,r):kv.tagProperty(e,t,r)}}Kc.named=yM});var Wv=f(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.optional=void 0;var _M=Ce(),vM=Kt(),Gv=Yn();function bM(){return function(i,e,t){var n=new vM.Metadata(_M.OPTIONAL_TAG,!0);typeof t=="number"?Gv.tagParameter(i,e,t,n):Gv.tagProperty(i,e,n)}}Hc.optional=bM});var $v=f(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.unmanaged=void 0;var SM=Ce(),EM=Kt(),wM=Yn();function PM(){return function(i,e,t){var n=new EM.Metadata(SM.UNMANAGED_TAG,!0);wM.tagParameter(i,e,t,n)}}zc.unmanaged=PM});var Jv=f(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.multiInject=void 0;var IM=Ce(),RM=Kt(),Xv=Yn();function MM(i){return function(e,t,n){var r=new RM.Metadata(IM.MULTI_INJECT_TAG,i);typeof n=="number"?Xv.tagParameter(e,t,n,r):Xv.tagProperty(e,t,r)}}Yc.multiInject=MM});var Zv=f(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.targetName=void 0;var OM=Ce(),TM=Kt(),AM=Yn();function CM(i){return function(e,t,n){var r=new TM.Metadata(OM.NAME_TAG,i);AM.tagParameter(e,t,n,r)}}kc.targetName=CM});var Qv=f(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.postConstruct=void 0;var xM=ht(),kf=Ce(),DM=Kt();function qM(){return function(i,e,t){var n=new DM.Metadata(kf.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(kf.POST_CONSTRUCT,i.constructor))throw new Error(xM.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(kf.POST_CONSTRUCT,n,i.constructor)}}Uc.postConstruct=qM});var eb=f(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.multiBindToService=void 0;var jM=function(i){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(r){return i.bind(r).toService(e)})}}};Gc.multiBindToService=jM});var _=f(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.multiBindToService=x.getServiceIdentifierAsString=x.typeConstraint=x.namedConstraint=x.taggedConstraint=x.traverseAncerstors=x.decorate=x.id=x.MetadataReader=x.postConstruct=x.targetName=x.multiInject=x.unmanaged=x.optional=x.LazyServiceIdentifer=x.inject=x.named=x.tagged=x.injectable=x.ContainerModule=x.AsyncContainerModule=x.TargetTypeEnum=x.BindingTypeEnum=x.BindingScopeEnum=x.Container=x.METADATA_KEY=void 0;var NM=Ce();x.METADATA_KEY=NM;var LM=Fv();Object.defineProperty(x,"Container",{enumerable:!0,get:function(){return LM.Container}});var Uf=vn();Object.defineProperty(x,"BindingScopeEnum",{enumerable:!0,get:function(){return Uf.BindingScopeEnum}});Object.defineProperty(x,"BindingTypeEnum",{enumerable:!0,get:function(){return Uf.BindingTypeEnum}});Object.defineProperty(x,"TargetTypeEnum",{enumerable:!0,get:function(){return Uf.TargetTypeEnum}});var tb=Kv();Object.defineProperty(x,"AsyncContainerModule",{enumerable:!0,get:function(){return tb.AsyncContainerModule}});Object.defineProperty(x,"ContainerModule",{enumerable:!0,get:function(){return tb.ContainerModule}});var BM=Hv();Object.defineProperty(x,"injectable",{enumerable:!0,get:function(){return BM.injectable}});var FM=Yv();Object.defineProperty(x,"tagged",{enumerable:!0,get:function(){return FM.tagged}});var VM=Uv();Object.defineProperty(x,"named",{enumerable:!0,get:function(){return VM.named}});var nb=Af();Object.defineProperty(x,"inject",{enumerable:!0,get:function(){return nb.inject}});Object.defineProperty(x,"LazyServiceIdentifer",{enumerable:!0,get:function(){return nb.LazyServiceIdentifer}});var KM=Wv();Object.defineProperty(x,"optional",{enumerable:!0,get:function(){return KM.optional}});var HM=$v();Object.defineProperty(x,"unmanaged",{enumerable:!0,get:function(){return HM.unmanaged}});var zM=Jv();Object.defineProperty(x,"multiInject",{enumerable:!0,get:function(){return zM.multiInject}});var YM=Zv();Object.defineProperty(x,"targetName",{enumerable:!0,get:function(){return YM.targetName}});var kM=Qv();Object.defineProperty(x,"postConstruct",{enumerable:!0,get:function(){return kM.postConstruct}});var UM=Of();Object.defineProperty(x,"MetadataReader",{enumerable:!0,get:function(){return UM.MetadataReader}});var GM=fi();Object.defineProperty(x,"id",{enumerable:!0,get:function(){return GM.id}});var WM=Yn();Object.defineProperty(x,"decorate",{enumerable:!0,get:function(){return WM.decorate}});var Wc=Ff();Object.defineProperty(x,"traverseAncerstors",{enumerable:!0,get:function(){return Wc.traverseAncerstors}});Object.defineProperty(x,"taggedConstraint",{enumerable:!0,get:function(){return Wc.taggedConstraint}});Object.defineProperty(x,"namedConstraint",{enumerable:!0,get:function(){return Wc.namedConstraint}});Object.defineProperty(x,"typeConstraint",{enumerable:!0,get:function(){return Wc.typeConstraint}});var $M=Hr();Object.defineProperty(x,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return $M.getServiceIdentifierAsString}});var XM=eb();Object.defineProperty(x,"multiBindToService",{enumerable:!0,get:function(){return XM.multiBindToService}})});var Xc=f($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.Deferred=void 0;var Gf=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};$c.Deferred=Gf});var P=f(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.TYPES=void 0;Jc.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandler:Symbol("IButtonHandler"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),IToolManager:Symbol("IToolManager"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}});var wn=f(Ht=>{"use strict";var Zc=Ht&&Ht.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.MultiInstanceRegistry=Ht.InstanceRegistry=Ht.FactoryRegistry=Ht.ProviderRegistry=void 0;var Qc=_(),Wf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?new n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};Wf=Zc([(0,Qc.injectable)()],Wf);Ht.ProviderRegistry=Wf;var $f=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};$f=Zc([(0,Qc.injectable)()],$f);Ht.FactoryRegistry=$f;var Xf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e){let t=this.elements.get(e);return t||this.missing(e)}missing(e){throw new Error("Unknown registry key: "+e)}};Xf=Zc([(0,Qc.injectable)()],Xf);Ht.InstanceRegistry=Xf;var Jf=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");let n=this.elements.get(e);n!==void 0?n.push(t):this.elements.set(e,[t])}deregisterAll(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}get(e){let t=this.elements.get(e);return t!==void 0?t:[]}};Jf=Zc([(0,Qc.injectable)()],Jf);Ht.MultiInstanceRegistry=Jf});var Q=f(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.almostEquals=de.toRadians=de.toDegrees=de.Bounds=de.isBounds=de.Dimension=de.centerOfLine=de.angleBetweenPoints=de.angleOfPoint=de.Point=void 0;var JM=_n(),ZM;(function(i){i.ORIGIN=Object.freeze({x:0,y:0});function e(l,S){return{x:l.x+S.x,y:l.y+S.y}}i.add=e;function t(l,S){return{x:l.x-S.x,y:l.y-S.y}}i.subtract=t;function n(l,S){return l.x===S.x&&l.y===S.y}i.equals=n;function r(l,S,R){let v=t(S,l),m=o(v),O={x:m.x*R,y:m.y*R};return e(l,O)}i.shiftTowards=r;function o(l){let S=s(l);return S===0||S===1?i.ORIGIN:{x:l.x/S,y:l.y/S}}i.normalize=o;function s(l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))}i.magnitude=s;function a(l,S,R){return{x:(1-R)*l.x+R*S.x,y:(1-R)*l.y+R*S.y}}i.linear=a;function c(l,S){let R=S.x-l.x,v=S.y-l.y;return Math.sqrt(R*R+v*v)}i.euclideanDistance=c;function u(l,S){return Math.abs(S.x-l.x)+Math.abs(S.y-l.y)}i.manhattanDistance=u;function d(l,S){return Math.max(Math.abs(S.x-l.x),Math.abs(S.y-l.y))}i.maxDistance=d})(ZM=de.Point||(de.Point={}));function QM(i){return Math.atan2(i.y,i.x)}de.angleOfPoint=QM;function eO(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}de.angleBetweenPoints=eO;function tO(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return ib.center(t)}de.centerOfLine=tO;var eu;(function(i){i.EMPTY=Object.freeze({width:-1,height:-1});function e(t){return t.width>=0&&t.height>=0}i.isValid=e})(eu=de.Dimension||(de.Dimension={}));function nO(i){return(0,JM.hasOwnProperty)(i,["x","y","width","height"])}de.isBounds=nO;var ib;(function(i){i.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function e(o,s){if(!eu.isValid(o))return eu.isValid(s)?s:i.EMPTY;if(!eu.isValid(s))return o;let a=Math.min(o.x,s.x),c=Math.min(o.y,s.y),u=Math.max(o.x+(o.width>=0?o.width:0),s.x+(s.width>=0?s.width:0)),d=Math.max(o.y+(o.height>=0?o.height:0),s.y+(s.height>=0?s.height:0));return{x:a,y:c,width:u-a,height:d-c}}i.combine=e;function t(o,s){return{x:o.x+s.x,y:o.y+s.y,width:o.width,height:o.height}}i.translate=t;function n(o){return{x:o.x+(o.width>=0?.5*o.width:0),y:o.y+(o.height>=0?.5*o.height:0)}}i.center=n;function r(o,s){return s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height}i.includes=r})(ib=de.Bounds||(de.Bounds={}));function iO(i){return i*180/Math.PI}de.toDegrees=iO;function rO(i){return i*Math.PI/180}de.toRadians=rO;function oO(i,e){return Math.abs(i-e)<.001}de.almostEquals=oO});var tr=f(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.mapIterable=at.filterIterable=at.DONE_RESULT=at.toArray=at.FluentIterableImpl=void 0;var xs=class{constructor(e,t){this.startFn=e,this.nextFn=t}[Symbol.iterator](){let e={state:this.startFn(),next:()=>this.nextFn(e.state),[Symbol.iterator]:()=>e};return e}filter(e){return rb(this,e)}map(e){return ob(this,e)}forEach(e){let t=this[Symbol.iterator](),n=0,r;do r=t.next(),r.value!==void 0&&e(r.value,n),n++;while(!r.done)}indexOf(e){let t=this[Symbol.iterator](),n=0,r;do{if(r=t.next(),r.value===e)return n;n++}while(!r.done);return-1}};at.FluentIterableImpl=xs;function sO(i){if(i.constructor===Array)return i;let e=[];return i.forEach(t=>e.push(t)),e}at.toArray=sO;at.DONE_RESULT=Object.freeze({done:!0,value:void 0});function rb(i,e){return new xs(()=>sb(i),t=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n})}at.filterIterable=rb;function ob(i,e){return new xs(()=>sb(i),t=>{let{done:n,value:r}=t.next();return n?at.DONE_RESULT:{done:!1,value:e(r)}})}at.mapIterable=ob;function sb(i){let e=i[Symbol.iterator];if(typeof e=="function")return e.call(i);let t=i.length;return typeof t=="number"&&t>=0?new Zf(i):{next:()=>at.DONE_RESULT}}var Zf=class{constructor(e){this.array=e,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:at.DONE_RESULT}[Symbol.iterator](){return this}}});var G=f(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.ModelIndexImpl=Xe.createRandomId=Xe.SModelRoot=Xe.SChildElement=Xe.SParentElement=Xe.isParent=Xe.SModelElement=void 0;var Qf=Q(),aO=tr(),tu=class{get root(){let e=this;for(;e;){if(e instanceof iu)return e;e instanceof nu?e=e.parent:e=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(e){return this.features!==void 0&&this.features.has(e)}};Xe.SModelElement=tu;function cO(i){let e=i.children;return e!==void 0&&e.constructor===Array}Xe.isParent=cO;var nr=class extends tu{constructor(){super(...arguments),this.children=[]}add(e,t){let n=this.children;if(t===void 0)n.push(e);else{if(t<0||t>this.children.length)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(t,0,e)}e.parent=this,this.index.add(e)}remove(e){let t=this.children,n=t.indexOf(e);if(n<0)throw new Error(`No such child ${e.id}`);t.splice(n,1),this.index.remove(e)}removeAll(e){let t=this.children;if(e!==void 0){for(let n=t.length-1;n>=0;n--)if(e(t[n])){let r=t.splice(n,1)[0];this.index.remove(r)}}else t.forEach(n=>{this.index.remove(n)}),t.splice(0,t.length)}move(e,t){let n=this.children,r=n.indexOf(e);if(r===-1)throw new Error(`No such child ${e.id}`);if(t<0||t>n.length-1)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(r,1),n.splice(t,0,e)}localToParent(e){return(0,Qf.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}parentToLocal(e){return(0,Qf.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}};Xe.SParentElement=nr;var nu=class extends nr{};Xe.SChildElement=nu;var iu=class extends nr{constructor(e=new ru){super(),this.canvasBounds=Qf.Bounds.EMPTY,Object.defineProperty(this,"index",{value:e,writable:!1})}};Xe.SModelRoot=iu;var ab="0123456789abcdefghijklmnopqrstuvwxyz";function cb(i=8){let e="";for(let t=0;t<i;t++)e+=ab.charAt(Math.floor(Math.random()*ab.length));return e}Xe.createRandomId=cb;var ru=class{constructor(){this.id2element=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else do e.id=cb();while(this.contains(e));if(this.id2element.set(e.id,e),e instanceof nr)for(let t of e.children)this.add(t)}remove(e){if(this.id2element.delete(e.id),e instanceof nr)for(let t of e.children)this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getAttachedElements(e){return[]}all(){return(0,aO.mapIterable)(this.id2element,([e,t])=>t)}};Xe.ModelIndexImpl=ru});var Pn=f(Je=>{"use strict";var eh=Je&&Je.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},db=Je&&Je.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ub=Je&&Je.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Je,"__esModule",{value:!0});Je.createFeatureSet=Je.EMPTY_ROOT=Je.SModelFactory=Je.SModelRegistry=void 0;var Ds=_(),lb=P(),uO=wn(),Gr=G(),ou=class extends uO.FactoryRegistry{constructor(e){super(),e.forEach(t=>{let n=this.getDefaultFeatures(t.constr);if(!n&&t.features&&t.features.enable&&(n=[]),n){let r=fb(n,t.features);this.register(t.type,()=>{let o=new t.constr;return o.features=r,o})}else this.register(t.type,()=>new t.constr)})}getDefaultFeatures(e){let t=e;do{let n=t.DEFAULT_FEATURES;if(n)return n;t=Object.getPrototypeOf(t)}while(t)}};ou=eh([(0,Ds.injectable)(),ub(0,(0,Ds.multiInject)(lb.TYPES.SModelElementRegistration)),ub(0,(0,Ds.optional)()),db("design:paramtypes",[Array])],ou);Je.SModelRegistry=ou;var su=class{createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Gr.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else n=new Gr.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Gr.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else t=new Gr.SModelRoot;return this.initializeRoot(t,e)}createSchema(e){let t={};for(let n in e)if(!this.isReserved(e,n)){let r=e[n];typeof r!="function"&&(t[n]=r)}return e instanceof Gr.SParentElement&&(t.children=e.children.map(n=>this.createSchema(n))),t}initializeElement(e,t){for(let n in t)if(!this.isReserved(e,n)){let r=t[n];typeof r!="function"&&(e[n]=r)}return e}isReserved(e,t){if(["children","parent","index"].indexOf(t)>=0)return!0;let n=e;do{let r=Object.getOwnPropertyDescriptor(n,t);if(r!==void 0)return r.get!==void 0;n=Object.getPrototypeOf(n)}while(n);return!1}initializeParent(e,t){return this.initializeElement(e,t),(0,Gr.isParent)(t)&&(e.children=t.children.map(n=>this.createElement(n,e))),e}initializeChild(e,t,n){return this.initializeParent(e,t),n!==void 0&&(e.parent=n),e}initializeRoot(e,t){return this.initializeParent(e,t),e.index.add(e),e}};eh([(0,Ds.inject)(lb.TYPES.SModelRegistry),db("design:type",ou)],su.prototype,"registry",void 0);su=eh([(0,Ds.injectable)()],su);Je.SModelFactory=su;Je.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function fb(i,e){let t=new Set(i);if(e&&e.enable)for(let n of e.enable)t.add(n);if(e&&e.disable)for(let n of e.disable)t.delete(n);return t}Je.createFeatureSet=fb});var $r=f(Wr=>{"use strict";var dO=Wr&&Wr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.AnimationFrameSyncer=void 0;var lO=_(),th=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(e){this.tasks.push(e),this.trigger()}onEndOfNextFrame(e){this.endTasks.push(e),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(e=>this.run(e)):setTimeout(e=>this.run(e)))}run(e){let t=this.tasks,n=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],t.forEach(r=>r.call(void 0,e)),n.forEach(r=>r.call(void 0,e))}};th=dO([(0,lO.injectable)()],th);Wr.AnimationFrameSyncer=th});var au=f(mi=>{"use strict";var Xr=mi&&mi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},qs=mi&&mi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(mi,"__esModule",{value:!0});mi.ActionDispatcher=void 0;var Jr=_(),ir=te(),fO=Xc(),js=P(),hO=Pn(),pO=$r(),gi=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(e=>{this.actionHandlerRegistry=e,this.handleAction(ir.SetModelAction.create(hO.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(e){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(e,this.blockUntil);if(this.diagramLocker.isAllowed(e))return this.handleAction(e)})}dispatchAll(e){return Promise.all(e.map(t=>this.dispatch(t)))}request(e){if(!e.requestId)return Promise.reject(new Error("Request without requestId"));let t=new fO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(()=>{}),t.promise}handleAction(e){if(e.kind===ir.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(e.kind===ir.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,ir.isResponseAction)(e)){let r=this.requests.get(e.responseId);if(r!==void 0){if(this.requests.delete(e.responseId),e.kind===ir.RejectAction.KIND){let o=e;r.reject(new Error(o.message)),this.logger.warn(this,`Request with id ${e.responseId} failed.`,o.message,o.detail)}else r.resolve(e);return Promise.resolve()}this.logger.log(this,"No matching request for response",e)}let t=this.actionHandlerRegistry.get(e.kind);if(t.length===0){this.logger.warn(this,"Missing handler for action",e);let r=new Error(`Missing handler for action '${e.kind}'`);if((0,ir.isRequestAction)(e)){let o=this.requests.get(e.requestId);o!==void 0&&(this.requests.delete(e.requestId),o.reject(r))}return Promise.reject(r)}this.logger.log(this,"Handle",e);let n=[];for(let r of t){let o=r.handle(e);(0,ir.isAction)(o)?n.push(this.dispatch(o)):o!==void 0&&(n.push(this.commandStack.execute(o)),this.blockUntil=o.blockUntil)}return Promise.all(n)}handleBlocked(e,t){if(t(e)){this.blockUntil=void 0;let n=this.handleAction(e),r=this.postponedActions;this.postponedActions=[];for(let o of r)this.dispatch(o.action).then(o.resolve,o.reject);return n}else return this.logger.log(this,"Action is postponed due to block condition",e),new Promise((n,r)=>{this.postponedActions.push({action:e,resolve:n,reject:r})})}};Xr([(0,Jr.inject)(js.TYPES.ActionHandlerRegistryProvider),qs("design:type",Function)],gi.prototype,"actionHandlerRegistryProvider",void 0);Xr([(0,Jr.inject)(js.TYPES.ICommandStack),qs("design:type",Object)],gi.prototype,"commandStack",void 0);Xr([(0,Jr.inject)(js.TYPES.ILogger),qs("design:type",Object)],gi.prototype,"logger",void 0);Xr([(0,Jr.inject)(js.TYPES.AnimationFrameSyncer),qs("design:type",pO.AnimationFrameSyncer)],gi.prototype,"syncer",void 0);Xr([(0,Jr.inject)(js.TYPES.IDiagramLocker),qs("design:type",Object)],gi.prototype,"diagramLocker",void 0);gi=Xr([(0,Jr.injectable)()],gi);mi.ActionDispatcher=gi});var rr=f(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.isInjectable=void 0;function gO(i){return Reflect.getMetadata("inversify:paramtypes",i)!==void 0}cu.isInjectable=gO});var Ls=f(gt=>{"use strict";var mO=gt&&gt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yO=gt&&gt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},uu=gt&&gt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(gt,"__esModule",{value:!0});gt.onAction=gt.configureActionHandler=gt.ActionHandlerRegistry=void 0;var Ns=_(),du=P(),_O=wn(),vO=rr(),nh=class extends _O.MultiInstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.actionKind,n.factory())),t.forEach(n=>this.initializeActionHandler(n))}initializeActionHandler(e){e.initialize(this)}};nh=mO([(0,Ns.injectable)(),uu(0,(0,Ns.multiInject)(du.TYPES.ActionHandlerRegistration)),uu(0,(0,Ns.optional)()),uu(1,(0,Ns.multiInject)(du.TYPES.IActionHandlerInitializer)),uu(1,(0,Ns.optional)()),yO("design:paramtypes",[Array,Array])],nh);gt.ActionHandlerRegistry=nh;function bO(i,e,t){if(typeof t=="function"){if(!(0,vO.isInjectable)(t))throw new Error(`Action handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(du.TYPES.ActionHandlerRegistration).toDynamicValue(n=>({actionKind:e,factory:()=>n.container.get(t)}))}gt.configureActionHandler=bO;function SO(i,e,t){i.bind(du.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:e,factory:()=>({handle:t})})}gt.onAction=SO});var rh=f(Zr=>{"use strict";var EO=Zr&&Zr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.DefaultDiagramLocker=void 0;var wO=_(),ih=class{isAllowed(e){return!0}};ih=EO([(0,wO.injectable)()],ih);Zr.DefaultDiagramLocker=ih});var oh=f(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.easeInOut=void 0;function PO(i){return i<.5?i*i*2:1-(1-i)*(1-i)*2}lu.easeInOut=PO});var or=f(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.CompoundAnimation=Qr.Animation=void 0;var hb=oh(),fu=class{constructor(e,t=hb.easeInOut){this.context=e,this.ease=t}start(){return new Promise((e,t)=>{let n,r=0,o=s=>{r++;let a;n===void 0?(n=s,a=0):a=s-n;let c=Math.min(1,a/this.context.duration),u=this.tween(this.ease(c),this.context);this.context.modelChanged.update(u),c===1?(this.context.logger.log(this,r*1e3/this.context.duration+" fps"),e(u)):this.context.syncer.onNextFrame(o)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(o);else{let s=this.tween(1,this.context);e(s)}})}};Qr.Animation=fu;var sh=class extends fu{constructor(e,t,n=[],r=hb.easeInOut){super(t,r),this.model=e,this.context=t,this.components=n,this.ease=r}include(e){return this.components.push(e),this}tween(e,t){for(let n of this.components)n.tween(e,t);return this.model}};Qr.CompoundAnimation=sh});var pe=f(Ze=>{"use strict";var eo=Ze&&Ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.ResetCommand=Ze.SystemCommand=Ze.PopupCommand=Ze.HiddenCommand=Ze.MergeableCommand=Ze.Command=void 0;var to=_(),yi=class{};yi=eo([(0,to.injectable)()],yi);Ze.Command=yi;var ah=class extends yi{merge(e,t){return!1}};ah=eo([(0,to.injectable)()],ah);Ze.MergeableCommand=ah;var ch=class extends yi{undo(e){return e.logger.error(this,"Cannot undo a hidden command"),e.root}redo(e){return e.logger.error(this,"Cannot redo a hidden command"),e.root}};ch=eo([(0,to.injectable)()],ch);Ze.HiddenCommand=ch;var uh=class extends yi{};uh=eo([(0,to.injectable)()],uh);Ze.PopupCommand=uh;var dh=class extends yi{};dh=eo([(0,to.injectable)()],dh);Ze.SystemCommand=dh;var lh=class extends yi{};lh=eo([(0,to.injectable)()],lh);Ze.ResetCommand=lh});var yt=f(mt=>{"use strict";var IO=mt&&mt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},RO=mt&&mt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},pb=mt&&mt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(mt,"__esModule",{value:!0});mt.configureCommand=mt.CommandActionHandlerInitializer=mt.CommandActionHandler=void 0;var hu=_(),MO=rr(),fh=P(),pu=class{constructor(e){this.commandRegistration=e}handle(e){return this.commandRegistration.factory(e)}};mt.CommandActionHandler=pu;var hh=class{constructor(e){this.registrations=e}initialize(e){this.registrations.forEach(t=>e.register(t.kind,new pu(t)))}};hh=IO([(0,hu.injectable)(),pb(0,(0,hu.multiInject)(fh.TYPES.CommandRegistration)),pb(0,(0,hu.optional)()),RO("design:paramtypes",[Array])],hh);mt.CommandActionHandlerInitializer=hh;function OO(i,e){if(!(0,MO.isInjectable)(e))throw new Error(`Commands should be @injectable: ${e.name}`);i.isBound(e)||i.bind(e).toSelf(),i.bind(fh.TYPES.CommandRegistration).toDynamicValue(t=>({kind:e.KIND,factory:n=>{let r=new hu.Container;return r.parent=t.container,r.bind(fh.TYPES.Action).toConstantValue(n),r.get(e)}}))}mt.configureCommand=OO});var gb=f(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.overrideCommandStackOptions=void 0;var TO=_n(),AO=P();function CO(i,e){let t=i.get(AO.TYPES.CommandStackOptions);return(0,TO.safeAssign)(t,e),t}gu.overrideCommandStackOptions=CO});var gh=f(vi=>{"use strict";var ar=vi&&vi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_i=vi&&vi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(vi,"__esModule",{value:!0});vi.CommandStack=void 0;var cr=_(),Bs=P(),ph=Pn(),xO=G(),DO=$r(),sr=pe(),Wn=class{constructor(){this.undoStack=[],this.redoStack=[],this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(ph.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(ph.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(ph.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(e=>e.main.model)}executeAll(e){return e.forEach(t=>{this.logger.log(this,"Executing",t),this.handleCommand(t,t.execute,this.mergeOrPush)}),this.thenUpdate()}execute(e){return this.logger.log(this,"Executing",e),this.handleCommand(e,e.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();let e=this.undoStack[this.undoStack.length-1];return e!==void 0&&!this.isBlockUndo(e)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();let e=this.redoStack.pop();return e!==void 0&&(this.logger.log(this,"Redoing",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(e,t,n){this.currentPromise=this.currentPromise.then(r=>new Promise(o=>{let s;e instanceof sr.HiddenCommand?s="hidden":e instanceof sr.PopupCommand?s="popup":s="main";let a=this.createContext(r.main.model),c;try{c=t.call(e,a)}catch(d){this.logger.error(this,"Failed to execute command:",d),c=r[s].model}let u=mb(r);c instanceof Promise?c.then(d=>{s==="main"&&n.call(this,e,a),u[s]={model:d,modelChanged:!0},o(u)}):c instanceof xO.SModelRoot?(s==="main"&&n.call(this,e,a),u[s]={model:c,modelChanged:!0},o(u)):(s==="main"&&n.call(this,e,a),u[s]={model:c.model,modelChanged:r[s].modelChanged||c.modelChanged,cause:c.cause},o(u))}))}pushToUndoStack(e){this.undoStack.push(e),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(e=>{let t=mb(e);return e.hidden.modelChanged&&(this.updateHidden(e.hidden.model,e.hidden.cause),t.hidden.modelChanged=!1,t.hidden.cause=void 0),e.main.modelChanged&&(this.update(e.main.model,e.main.cause),t.main.modelChanged=!1,t.main.cause=void 0),e.popup.modelChanged&&(this.updatePopup(e.popup.model,e.popup.cause),t.popup.modelChanged=!1,t.popup.cause=void 0),t}),this.currentModel}update(e,t){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(e,t)}updateHidden(e,t){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(e,t)}updatePopup(e,t){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(e,t)}mergeOrPush(e,t){if(this.isBlockUndo(e)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(e);return}if(this.isPushToOffStack(e)&&this.redoStack.length>0){if(this.offStack.length>0){let n=this.offStack[this.offStack.length-1];if(n instanceof sr.MergeableCommand&&n.merge(e,t))return}this.offStack.push(e);return}if(this.isPushToUndoStack(e)){if(this.offStack.forEach(n=>this.undoStack.push(n)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){let n=this.undoStack[this.undoStack.length-1];if(n instanceof sr.MergeableCommand&&n.merge(e,t))return}this.pushToUndoStack(e)}}undoOffStackSystemCommands(){let e=this.offStack.pop();for(;e!==void 0;)this.logger.log(this,"Undoing off-stack",e),this.handleCommand(e,e.undo,()=>{}),e=this.offStack.pop()}undoPreceedingSystemCommands(){let e=this.undoStack[this.undoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)}),e=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let e=this.redoStack[this.redoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.redoStack.pop(),this.logger.log(this,"Redoing ",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)}),e=this.redoStack[this.redoStack.length-1]}createContext(e){return{root:e,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(e){return e instanceof sr.SystemCommand}isPushToUndoStack(e){return!(e instanceof sr.HiddenCommand)}isBlockUndo(e){return e instanceof sr.ResetCommand}};ar([(0,cr.inject)(Bs.TYPES.IModelFactory),_i("design:type",Object)],Wn.prototype,"modelFactory",void 0);ar([(0,cr.inject)(Bs.TYPES.IViewerProvider),_i("design:type",Object)],Wn.prototype,"viewerProvider",void 0);ar([(0,cr.inject)(Bs.TYPES.ILogger),_i("design:type",Object)],Wn.prototype,"logger",void 0);ar([(0,cr.inject)(Bs.TYPES.AnimationFrameSyncer),_i("design:type",DO.AnimationFrameSyncer)],Wn.prototype,"syncer",void 0);ar([(0,cr.inject)(Bs.TYPES.CommandStackOptions),_i("design:type",Object)],Wn.prototype,"options",void 0);ar([(0,cr.postConstruct)(),_i("design:type",Function),_i("design:paramtypes",[]),_i("design:returntype",void 0)],Wn.prototype,"initialize",null);Wn=ar([(0,cr.injectable)()],Wn);vi.CommandStack=Wn;function mb(i){return{main:Object.assign({},i.main),hidden:Object.assign({},i.hidden),popup:Object.assign({},i.popup)}}});var yb=f(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.ServerActionHandlerRegistry=void 0;var mh=class{constructor(){this.handlers=new Map}getHandler(e){return this.handlers.get(e)}onAction(e,t){this.handlers.has(e)?this.handlers.get(e).push(t):this.handlers.set(e,[t])}removeActionHandler(e,t){let n=this.handlers.get(e);if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}};mu.ServerActionHandlerRegistry=mh});var bi=f(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.SModelIndex=_t.findElement=_t.getSubType=_t.getBasicType=_t.applyBounds=_t.cloneModel=void 0;function qO(i){return JSON.parse(JSON.stringify(i))}_t.cloneModel=qO;function jO(i,e){let t=new yu;t.add(i);for(let n of e.bounds){let r=t.getById(n.elementId);if(r){let o=r;n.newPosition&&(o.position={x:n.newPosition.x,y:n.newPosition.y}),n.newSize&&(o.size={width:n.newSize.width,height:n.newSize.height})}}if(e.alignments)for(let n of e.alignments){let r=t.getById(n.elementId);if(r){let o=r;o.alignment={x:n.newAlignment.x,y:n.newAlignment.y}}}}_t.applyBounds=jO;function NO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}_t.getBasicType=NO;function LO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}_t.getSubType=LO;function _b(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=_b(t,e);if(n!==void 0)return n}}_t.findElement=_b;var yu=class{constructor(){this.id2element=new Map,this.id2parent=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(e.id,e),Array.isArray(e.children))for(let t of e.children)this.add(t),this.id2parent.set(t.id,e)}remove(e){if(this.id2element.delete(e.id),Array.isArray(e.children))for(let t of e.children)this.id2parent.delete(t.id),this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getParent(e){return this.id2parent.get(e)}getRoot(e){let t=e;for(;t;){let n=this.id2parent.get(t.id);if(n===void 0)return t;t=n}throw new Error("Element has no root")}};_t.SModelIndex=yu});var vb=f(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.DiagramServer=void 0;var BO=yb(),vt=te(),FO=Xc(),yh=bi(),_h=class{constructor(e,t){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=e,this.diagramGenerator=t.DiagramGenerator,this.layoutEngine=t.ModelLayoutEngine,this.actionHandlerRegistry=t.ServerActionHandlerRegistry}onAction(e,t){this.actionHandlerRegistry||(this.actionHandlerRegistry=new BO.ServerActionHandlerRegistry),this.actionHandlerRegistry.onAction(e,t)}removeActionHandler(e,t){this.actionHandlerRegistry&&this.actionHandlerRegistry.removeActionHandler(e,t)}setModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!1)}updateModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(e){if((0,vt.isResponseAction)(e)){let t=e.responseId,n=this.requests.get(t);if(n){if(this.requests.delete(t),e.kind===vt.RejectAction.KIND){let r=e;n.reject(new Error(r.message)),console.warn(`Request with id ${e.responseId} failed: ${r.message}`,r.detail)}else n.resolve(e);return Promise.resolve()}console.info("No matching request for response:",e)}return this.handleAction(e)}request(e){e.requestId||(e.requestId="server_"+(0,vt.generateRequestId)());let t=new FO.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(n=>{this.requests.delete(e.requestId),t.reject(n)}),t.promise}rejectRemoteRequest(e,t){e&&(0,vt.isRequestAction)(e)&&this.dispatch({kind:vt.RejectAction.KIND,responseId:e.requestId,message:t.message,detail:t.stack})}handleAction(e){var t;let n=(t=this.actionHandlerRegistry)===null||t===void 0?void 0:t.getHandler(e.kind);if(n&&n.length===1)return n[0](e,this.state,this);if(n&&n.length>1)return Promise.all(n.map(r=>r(e,this.state,this)));switch(e.kind){case vt.RequestModelAction.KIND:return this.handleRequestModel(e);case vt.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case vt.LayoutAction.KIND:return this.handleLayout(e)}return console.warn(`Unhandled action from client: ${e.kind}`),Promise.resolve()}async handleRequestModel(e){var t;this.state.options=e.options;try{let n=await this.diagramGenerator.generate({options:(t=this.state.options)!==null&&t!==void 0?t:{},state:this.state});n.revision=++this.state.revision,this.state.currentRoot=n,await this.submitModel(this.state.currentRoot,!1,e)}catch(n){this.rejectRemoteRequest(e,n),console.error("Failed to generate diagram:",n)}}async submitModel(e,t,n){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:vt.RequestBoundsAction.KIND,newRoot:e});else{let r=vt.RequestBoundsAction.create(e),o=await this.request(r),s=this.state.currentRoot;o.revision===s.revision?((0,yh.applyBounds)(s,o),await this.doSubmitModel(s,t,n)):this.rejectRemoteRequest(n,new Error(`Model revision does not match: ${o.revision}`))}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n){if(e.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(e=await this.layoutEngine.layout(e));let r=e.type;if(n&&n.kind===vt.RequestModelAction.KIND){let o=n.requestId,s=vt.SetModelAction.create(e,o);await this.dispatch(s)}else t&&r===this.state.lastSubmittedModelType?await this.dispatch({kind:vt.UpdateModelAction.KIND,newRoot:e,cause:n}):await this.dispatch({kind:vt.SetModelAction.KIND,newRoot:e});this.state.lastSubmittedModelType=r}handleComputedBounds(e){return e.revision!==this.state.currentRoot.revision?Promise.reject():((0,yh.applyBounds)(this.state.currentRoot,e),Promise.resolve())}async handleLayout(e){if(this.layoutEngine){if(!this.needsServerLayout){let t=(0,yh.cloneModel)(this.state.currentRoot);t=await this.layoutEngine.layout(t),t.revision=++this.state.revision,this.state.currentRoot=t}await this.doSubmitModel(this.state.currentRoot,!0,e)}}};_u.DiagramServer=_h});var Sb=f(bb=>{"use strict";Object.defineProperty(bb,"__esModule",{value:!0})});var wb=f(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.isZoomable=no.isScrollable=void 0;var Eb=_n();function VO(i){return(0,Eb.hasOwnProperty)(i,"scroll")}no.isScrollable=VO;function KO(i){return(0,Eb.hasOwnProperty)(i,"zoom")}no.isZoomable=KO});var Ib=f(Pb=>{"use strict";Object.defineProperty(Pb,"__esModule",{value:!0})});var ur=f(ct=>{"use strict";var HO=ct&&ct.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),$n=ct&&ct.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&HO(e,i,t)};Object.defineProperty(ct,"__esModule",{value:!0});$n(te(),ct);$n(vb(),ct);$n(Sb(),ct);$n(wb(),ct);$n(Xc(),ct);$n(Q(),ct);$n(Ib(),ct);$n(bi(),ct);$n(_n(),ct)});var In=f(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.hitsMouseEvent=zt.getWindowScroll=zt.isCrossSite=zt.isMac=zt.isCtrlOrCmd=void 0;var zO=ur();function YO(i){return Rb()?i.metaKey:i.ctrlKey}zt.isCtrlOrCmd=YO;function Rb(){return window.navigator.userAgent.indexOf("Mac")!==-1}zt.isMac=Rb;function kO(i){if(i&&typeof window<"u"&&window.location){let e="";return window.location.protocol&&(e+=window.location.protocol+"//"),window.location.host&&(e+=window.location.host),e.length>0&&!i.startsWith(e)}return!1}zt.isCrossSite=kO;function UO(){return typeof window>"u"?zO.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}zt.getWindowScroll=UO;function GO(i,e){let t=i.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}zt.hitsMouseEvent=GO});var Vs=f(ut=>{"use strict";var vh=ut&&ut.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Mb=ut&&ut.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},WO=ut&&ut.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ut,"__esModule",{value:!0});ut.InitializeCanvasBoundsCommand=ut.InitializeCanvasBoundsAction=ut.CanvasBoundsInitializer=void 0;var vu=_(),Fs=Q(),Ob=P(),$O=G(),XO=pe(),JO=In(),bu=class{decorate(e,t){return t instanceof $O.SModelRoot&&!Fs.Dimension.isValid(t.canvasBounds)&&(this.rootAndVnode=[t,e]),e}postUpdate(){if(this.rootAndVnode!==void 0){let e=this.rootAndVnode[1].elm,t=this.rootAndVnode[0].canvasBounds;if(e!==void 0){let n=this.getBoundsInPage(e);(0,Fs.almostEquals)(n.x,t.x)&&(0,Fs.almostEquals)(n.y,t.y)&&(0,Fs.almostEquals)(n.width,t.width)&&(0,Fs.almostEquals)(n.height,t.width)||this.actionDispatcher.dispatch(bh.create(n))}this.rootAndVnode=void 0}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,JO.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};vh([(0,vu.inject)(Ob.TYPES.IActionDispatcher),Mb("design:type",Object)],bu.prototype,"actionDispatcher",void 0);bu=vh([(0,vu.injectable)()],bu);ut.CanvasBoundsInitializer=bu;var bh;(function(i){i.KIND="initializeCanvasBounds";function e(t){return{kind:i.KIND,newCanvasBounds:t}}i.create=e})(bh=ut.InitializeCanvasBoundsAction||(ut.InitializeCanvasBoundsAction={}));var Su=class extends XO.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newCanvasBounds=this.action.newCanvasBounds,e.root.canvasBounds=this.newCanvasBounds,e.root}undo(e){return e.root}redo(e){return e.root}};Su.KIND=bh.KIND;Su=vh([(0,vu.injectable)(),WO(0,(0,vu.inject)(Ob.TYPES.Action)),Mb("design:paramtypes",[Object])],Su);ut.InitializeCanvasBoundsCommand=Su});var wu=f(bt=>{"use strict";var ZO=bt&&bt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},QO=bt&&bt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},eT=bt&&bt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(bt,"__esModule",{value:!0});bt.SetModelCommand=bt.SetModelAction=bt.RequestModelAction=void 0;var Tb=_(),Ab=te(),tT=pe(),nT=P(),iT=Vs(),dr=class{constructor(e,t=""){this.options=e,this.requestId=t,this.kind=dr.KIND}static create(e){return new dr(e,(0,Ab.generateRequestId)())}};bt.RequestModelAction=dr;dr.KIND="requestModel";var io=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=io.KIND}};bt.SetModelAction=io;io.KIND="setModel";var Eu=class extends tT.ResetCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.modelFactory.createRoot(e.root),this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}get blockUntil(){return e=>e.kind===iT.InitializeCanvasBoundsCommand.KIND}};Eu.KIND=Ab.SetModelAction.KIND;Eu=ZO([(0,Tb.injectable)(),eT(0,(0,Tb.inject)(nT.TYPES.Action)),QO("design:paramtypes",[Object])],Eu);bt.SetModelCommand=Eu});var xb=f(Cb=>{"use strict";Object.defineProperty(Cb,"__esModule",{value:!0})});var Ke=f(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.transformToRootBounds=ve.containsSome=ve.translateBounds=ve.translatePoint=ve.findParentByFeature=ve.findParent=ve.findElement=ve.getSubType=ve.getBasicType=ve.registerModelElement=void 0;var rT=P(),Ks=G();function oT(i,e,t,n){i.bind(rT.TYPES.SModelElementRegistration).toConstantValue({type:e,constr:t,features:n})}ve.registerModelElement=oT;function sT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}ve.getBasicType=sT;function aT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}ve.getSubType=aT;function Db(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Db(t,e);if(n!==void 0)return n}}ve.findElement=Db;function cT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ks.SChildElement?t=t.parent:t=void 0}return t}ve.findParent=cT;function uT(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Ks.SChildElement?t=t.parent:t=void 0}return t}ve.findParentByFeature=uT;function Sh(i,e,t){if(e!==t){for(;e instanceof Ks.SChildElement;)if(i=e.localToParent(i),e=e.parent,e===t)return i;let n=[];for(;t instanceof Ks.SChildElement;)n.push(t),t=t.parent;if(e!==t)throw new Error("Incompatible source and target: "+e.id+", "+t.id);for(let r=n.length-1;r>=0;r--)i=n[r].parentToLocal(i)}return i}ve.translatePoint=Sh;function dT(i,e,t){let n=Sh(i,e,t),r=Sh({x:i.x+i.width,y:i.y+i.height},e,t);return{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y}}ve.translateBounds=dT;function lT(i,e){let t=r=>i.index.getById(r.id)!==void 0,n=r=>r.some(o=>t(o)||n(o.children));return n([e])}ve.containsSome=lT;function fT(i,e){for(;i instanceof Ks.SChildElement;)e=i.localToParent(e),i=i.parent;return e}ve.transformToRootBounds=fT});var Pu=f(Si=>{"use strict";Object.defineProperty(Si,"__esModule",{value:!0});Si.EnableDefaultToolsAction=Si.EnableToolsAction=void 0;var hT;(function(i){i.KIND="enable-tools";function e(t){return{kind:i.KIND,toolIds:t}}i.create=e})(hT=Si.EnableToolsAction||(Si.EnableToolsAction={}));var pT;(function(i){i.KIND="enable-default-tools";function e(){return{kind:i.KIND}}i.create=e})(pT=Si.EnableDefaultToolsAction||(Si.EnableDefaultToolsAction={}))});var Ne=f(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.getAttrs=je.on=je.mergeStyle=je.copyClassesFromElement=je.copyClassesFromVNode=je.setNamespace=je.setClass=je.setAttr=void 0;function gT(i,e,t){jb(i)[e]=t}je.setAttr=gT;function Eh(i,e,t){Nb(i)[e]=t}je.setClass=Eh;function qb(i,e){i.data===void 0&&(i.data={}),i.data.ns=e;let t=i.children;if(t!==void 0)for(let n=0;n<t.length;n++){let r=t[n];typeof r!="string"&&qb(r,e)}}je.setNamespace=qb;function mT(i,e){let t=Nb(i);Object.keys(t).forEach(n=>Eh(e,n,!0))}je.copyClassesFromVNode=mT;function yT(i,e){let t=i.classList;for(let n=0;n<t.length;n++){let r=t.item(n);r&&Eh(e,r,!0)}}je.copyClassesFromElement=yT;function _T(i,e){Hs(i).style=Object.assign(Object.assign({},Hs(i).style||{}),e)}je.mergeStyle=_T;function vT(i,e,t){let n=bT(i);if(n[e])throw new Error("EventListener for "+e+" already registered on VNode");n[e]=t}je.on=vT;function jb(i){let e=Hs(i);return e.attrs||(e.attrs={}),e.attrs}je.getAttrs=jb;function Hs(i){return i.data||(i.data={}),i.data}function Nb(i){let e=Hs(i);return e.class||(e.class={}),e.class}function bT(i){let e=Hs(i);return e.on||(e.on={}),e.on}});var an=f(Yt=>{"use strict";var Ih=Yt&&Yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Bb=Yt&&Yt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Lb=Yt&&Yt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.KeyListener=Yt.KeyTool=void 0;var zs=_(),Fb=P(),ST=G(),wh=Ne(),Iu=class{constructor(e=[]){this.keyListeners=e}register(e){this.keyListeners.push(e)}deregister(e){let t=this.keyListeners.indexOf(e);t>=0&&this.keyListeners.splice(t,1)}handleEvent(e,t,n){let r=this.keyListeners.map(o=>o[e].apply(o,[t,n])).reduce((o,s)=>o.concat(s));r.length>0&&(n.preventDefault(),this.actionDispatcher.dispatchAll(r))}keyDown(e,t){this.handleEvent("keyDown",e,t)}keyUp(e,t){this.handleEvent("keyUp",e,t)}focus(){}decorate(e,t){return t instanceof ST.SModelRoot&&((0,wh.on)(e,"focus",this.focus.bind(this,t)),(0,wh.on)(e,"keydown",this.keyDown.bind(this,t)),(0,wh.on)(e,"keyup",this.keyUp.bind(this,t))),e}postUpdate(){}};Ih([(0,zs.inject)(Fb.TYPES.IActionDispatcher),Bb("design:type",Object)],Iu.prototype,"actionDispatcher",void 0);Iu=Ih([(0,zs.injectable)(),Lb(0,(0,zs.multiInject)(Fb.TYPES.KeyListener)),Lb(0,(0,zs.optional)()),Bb("design:paramtypes",[Array])],Iu);Yt.KeyTool=Iu;var Ph=class{keyDown(e,t){return[]}keyUp(e,t){return[]}};Ph=Ih([(0,zs.injectable)()],Ph);Yt.KeyListener=Ph});var Rn=f(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.getActualCode=ro.matchesKeystroke=void 0;var ET=In();function wT(i,e,...t){if(Vb(i)!==e)return!1;if((0,ET.isMac)()){if(i.ctrlKey!==t.findIndex(n=>n==="ctrl")>=0||i.metaKey!==t.findIndex(n=>n==="meta"||n==="ctrlCmd")>=0)return!1}else if(i.ctrlKey!==t.findIndex(n=>n==="ctrl"||n==="ctrlCmd")>=0||i.metaKey!==t.findIndex(n=>n==="meta")>=0)return!1;return!(i.altKey!==t.findIndex(n=>n==="alt")>=0||i.shiftKey!==t.findIndex(n=>n==="shift")>=0)}ro.matchesKeystroke=wT;function Vb(i){if(i.keyCode){let e=Rh[i.keyCode];if(e!==void 0)return e}return i.code}ro.getActualCode=Vb;var Rh=new Array(256);(()=>{function i(e,t){Rh[t]===void 0&&(Rh[t]=e)}i("Pause",3),i("Backspace",8),i("Tab",9),i("Enter",13),i("ShiftLeft",16),i("ShiftRight",16),i("ControlLeft",17),i("ControlRight",17),i("AltLeft",18),i("AltRight",18),i("CapsLock",20),i("Escape",27),i("Space",32),i("PageUp",33),i("PageDown",34),i("End",35),i("Home",36),i("ArrowLeft",37),i("ArrowUp",38),i("ArrowRight",39),i("ArrowDown",40),i("Insert",45),i("Delete",46),i("Digit1",49),i("Digit2",50),i("Digit3",51),i("Digit4",52),i("Digit5",53),i("Digit6",54),i("Digit7",55),i("Digit8",56),i("Digit9",57),i("Digit0",48),i("KeyA",65),i("KeyB",66),i("KeyC",67),i("KeyD",68),i("KeyE",69),i("KeyF",70),i("KeyG",71),i("KeyH",72),i("KeyI",73),i("KeyJ",74),i("KeyK",75),i("KeyL",76),i("KeyM",77),i("KeyN",78),i("KeyO",79),i("KeyP",80),i("KeyQ",81),i("KeyR",82),i("KeyS",83),i("KeyT",84),i("KeyU",85),i("KeyV",86),i("KeyW",87),i("KeyX",88),i("KeyY",89),i("KeyZ",90),i("OSLeft",91),i("MetaLeft",91),i("OSRight",92),i("MetaRight",92),i("ContextMenu",93),i("Numpad0",96),i("Numpad1",97),i("Numpad2",98),i("Numpad3",99),i("Numpad4",100),i("Numpad5",101),i("Numpad6",102),i("Numpad7",103),i("Numpad8",104),i("Numpad9",105),i("NumpadMultiply",106),i("NumpadAdd",107),i("NumpadSeparator",108),i("NumpadSubtract",109),i("NumpadDecimal",110),i("NumpadDivide",111),i("F1",112),i("F2",113),i("F3",114),i("F4",115),i("F5",116),i("F6",117),i("F7",118),i("F8",119),i("F9",120),i("F10",121),i("F11",122),i("F12",123),i("F13",124),i("F14",125),i("F15",126),i("F16",127),i("F17",128),i("F18",129),i("F19",130),i("F20",131),i("F21",132),i("F22",133),i("F23",134),i("F24",135),i("NumLock",144),i("ScrollLock",145),i("Semicolon",186),i("Equal",187),i("Comma",188),i("Minus",189),i("Period",190),i("Slash",191),i("Backquote",192),i("IntlRo",193),i("BracketLeft",219),i("Backslash",220),i("BracketRight",221),i("Quote",222),i("IntlYen",255)})()});var Ah=f(kt=>{"use strict";var Mu=kt&&kt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},PT=kt&&kt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(kt,"__esModule",{value:!0});kt.DefaultToolsEnablingKeyListener=kt.ToolManagerActionHandler=kt.ToolManager=void 0;var Ou=_(),IT=P(),Mh=Pu(),RT=an(),MT=Rn(),Oh=class{constructor(){this.tools=[],this.defaultTools=[],this.actives=[]}get managedTools(){return this.defaultTools.concat(this.tools)}get activeTools(){return this.actives}disableActiveTools(){this.actives.forEach(e=>e.disable()),this.actives.splice(0,this.actives.length)}enableDefaultTools(){this.enable(this.defaultTools.map(e=>e.id))}enable(e){this.disableActiveTools(),e.map(n=>this.tool(n)).forEach(n=>{n!==void 0&&(n.enable(),this.actives.push(n))})}tool(e){return this.managedTools.find(t=>t.id===e)}registerDefaultTools(...e){for(let t of e)this.defaultTools.push(t)}registerTools(...e){for(let t of e)this.tools.push(t)}};Oh=Mu([(0,Ou.injectable)()],Oh);kt.ToolManager=Oh;var Ru=class{handle(e){switch(e.kind){case Mh.EnableDefaultToolsAction.KIND:this.toolManager.enableDefaultTools();break;case Mh.EnableToolsAction.KIND:this.toolManager.enable(e.toolIds);break}}};Mu([(0,Ou.inject)(IT.TYPES.IToolManager),PT("design:type",Object)],Ru.prototype,"toolManager",void 0);Ru=Mu([(0,Ou.injectable)()],Ru);kt.ToolManagerActionHandler=Ru;var Th=class extends RT.KeyListener{keyDown(e,t){return(0,MT.matchesKeystroke)(t,"Escape")?[Mh.EnableDefaultToolsAction.create()]:[]}};Th=Mu([(0,Ou.injectable)()],Th);kt.DefaultToolsEnablingKeyListener=Th});var ks=f(dt=>{"use strict";var xh=dt&&dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Dh=dt&&dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Ch=dt&&dt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(dt,"__esModule",{value:!0});dt.SetUIExtensionVisibilityCommand=dt.SetUIExtensionVisibilityAction=dt.UIExtensionRegistry=void 0;var oo=_(),OT=wn(),TT=pe(),qh=P(),Tu=class extends OT.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>this.register(t.id(),t))}};Tu=xh([(0,oo.injectable)(),Ch(0,(0,oo.multiInject)(qh.TYPES.IUIExtension)),Ch(0,(0,oo.optional)()),Dh("design:paramtypes",[Array])],Tu);dt.UIExtensionRegistry=Tu;var Kb;(function(i){i.KIND="setUIExtensionVisibility";function e(t){var n;return{kind:i.KIND,extensionId:t.extensionId,visible:t.visible,contextElementsId:(n=t.contextElementsId)!==null&&n!==void 0?n:[]}}i.create=e})(Kb=dt.SetUIExtensionVisibilityAction||(dt.SetUIExtensionVisibilityAction={}));var Ys=class extends TT.SystemCommand{constructor(e){super(),this.action=e}execute(e){let t=this.registry.get(this.action.extensionId);return t&&(this.action.visible?t.show(e.root,...this.action.contextElementsId):t.hide()),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};Ys.KIND=Kb.KIND;xh([(0,oo.inject)(qh.TYPES.UIExtensionRegistry),Dh("design:type",Tu)],Ys.prototype,"registry",void 0);Ys=xh([(0,oo.injectable)(),Ch(0,(0,oo.inject)(qh.TYPES.Action)),Dh("design:paramtypes",[Object])],Ys);dt.SetUIExtensionVisibilityCommand=Ys});var Au=f(Ei=>{"use strict";var jh=Ei&&Ei.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Hb=Ei&&Ei.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.AbstractUIExtension=void 0;var Nh=_(),zb=P(),Us=class{show(e,...t){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,e,...t),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){let e=this.activeElement;e&&e.focus()}initialize(){let e=document.getElementById(this.options.baseDiv);return e?(this.containerElement=this.getOrCreateContainer(e.id),this.initializeContents(this.containerElement),e&&e.insertBefore(this.containerElement,e.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(e){let t=document.getElementById(this.id());return t===null&&(t=document.createElement("div"),t.id=e+"_"+this.id(),t.classList.add(this.containerClass())),t}setContainerVisible(e){this.containerElement&&(e?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(e,t,...n){}};jh([(0,Nh.inject)(zb.TYPES.ViewerOptions),Hb("design:type",Object)],Us.prototype,"options",void 0);jh([(0,Nh.inject)(zb.TYPES.ILogger),Hb("design:type",Object)],Us.prototype,"logger",void 0);Us=jh([(0,Nh.injectable)()],Us);Ei.AbstractUIExtension=Us});var so=f(wi=>{"use strict";var Yb=wi&&wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},AT=wi&&wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(wi,"__esModule",{value:!0});wi.DOMHelper=void 0;var kb=_(),CT=P(),Cu=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(e){return this.getPrefix()+e.id}findSModelIdByDOMElement(e){return e.id.replace(this.getPrefix(),"")}};Yb([(0,kb.inject)(CT.TYPES.ViewerOptions),AT("design:type",Object)],Cu.prototype,"viewerOptions",void 0);Cu=Yb([(0,kb.injectable)()],Cu);wi.DOMHelper=Cu});var Tt=f(Qe=>{"use strict";var co=Qe&&Qe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},qu=Qe&&Qe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},xu=Qe&&Qe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.MousePositionTracker=Qe.MouseListener=Qe.PopupMouseTool=Qe.MouseTool=void 0;var Mn=_(),xT=te(),DT=G(),ju=P(),qT=so(),Ut=Ne(),ao=class{constructor(e=[]){this.mouseListeners=e}register(e){this.mouseListeners.push(e)}deregister(e){let t=this.mouseListeners.indexOf(e);t>=0&&this.mouseListeners.splice(t,1)}getTargetElement(e,t){let n=t.target,r=e.index;for(;n;){if(n.id){let o=r.getById(this.domHelper.findSModelIdByDOMElement(n));if(o!==void 0)return o}n=n.parentNode}}handleEvent(e,t,n){this.focusOnMouseEvent(e,t);let r=this.getTargetElement(t,n);if(!r)return;let o=this.mouseListeners.map(s=>s[e](r,n)).reduce((s,a)=>s.concat(a));if(o.length>0){n.preventDefault();for(let s of o)(0,xT.isAction)(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}focusOnMouseEvent(e,t){if(document&&e==="mouseDown"){let n=document.getElementById(this.domHelper.createUniqueDOMElementId(t));n!==null&&typeof n.focus=="function"&&n.focus()}}mouseOver(e,t){this.handleEvent("mouseOver",e,t)}mouseOut(e,t){this.handleEvent("mouseOut",e,t)}mouseEnter(e,t){this.handleEvent("mouseEnter",e,t)}mouseLeave(e,t){this.handleEvent("mouseLeave",e,t)}mouseDown(e,t){this.handleEvent("mouseDown",e,t)}mouseMove(e,t){this.handleEvent("mouseMove",e,t)}mouseUp(e,t){this.handleEvent("mouseUp",e,t)}wheel(e,t){this.handleEvent("wheel",e,t)}contextMenu(e,t){t.preventDefault(),this.handleEvent("contextMenu",e,t)}doubleClick(e,t){this.handleEvent("doubleClick",e,t)}decorate(e,t){return t instanceof DT.SModelRoot&&((0,Ut.on)(e,"mouseover",this.mouseOver.bind(this,t)),(0,Ut.on)(e,"mouseout",this.mouseOut.bind(this,t)),(0,Ut.on)(e,"mouseenter",this.mouseEnter.bind(this,t)),(0,Ut.on)(e,"mouseleave",this.mouseLeave.bind(this,t)),(0,Ut.on)(e,"mousedown",this.mouseDown.bind(this,t)),(0,Ut.on)(e,"mouseup",this.mouseUp.bind(this,t)),(0,Ut.on)(e,"mousemove",this.mouseMove.bind(this,t)),(0,Ut.on)(e,"wheel",this.wheel.bind(this,t)),(0,Ut.on)(e,"contextmenu",this.contextMenu.bind(this,t)),(0,Ut.on)(e,"dblclick",this.doubleClick.bind(this,t)),(0,Ut.on)(e,"dragover",n=>this.handleEvent("dragOver",t,n)),(0,Ut.on)(e,"drop",n=>this.handleEvent("drop",t,n))),e=this.mouseListeners.reduce((n,r)=>r.decorate(n,t),e),e}postUpdate(){}};co([(0,Mn.inject)(ju.TYPES.IActionDispatcher),qu("design:type",Object)],ao.prototype,"actionDispatcher",void 0);co([(0,Mn.inject)(ju.TYPES.DOMHelper),qu("design:type",qT.DOMHelper)],ao.prototype,"domHelper",void 0);ao=co([(0,Mn.injectable)(),xu(0,(0,Mn.multiInject)(ju.TYPES.MouseListener)),xu(0,(0,Mn.optional)()),qu("design:paramtypes",[Array])],ao);Qe.MouseTool=ao;var Lh=class extends ao{constructor(e=[]){super(e),this.mouseListeners=e}};Lh=co([(0,Mn.injectable)(),xu(0,(0,Mn.multiInject)(ju.TYPES.PopupMouseListener)),xu(0,(0,Mn.optional)()),qu("design:paramtypes",[Array])],Lh);Qe.PopupMouseTool=Lh;var Du=class{mouseOver(e,t){return[]}mouseOut(e,t){return[]}mouseEnter(e,t){return[]}mouseLeave(e,t){return[]}mouseDown(e,t){return[]}mouseMove(e,t){return[]}mouseUp(e,t){return[]}wheel(e,t){return[]}doubleClick(e,t){return[]}contextMenu(e,t){return[]}dragOver(e,t){return[]}drop(e,t){return[]}decorate(e,t){return e}};Du=co([(0,Mn.injectable)()],Du);Qe.MouseListener=Du;var Bh=class extends Du{mouseMove(e,t){return this.lastPosition=e.root.parentToLocal({x:t.offsetX,y:t.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};Bh=co([(0,Mn.injectable)()],Bh);Qe.MousePositionTracker=Bh});var uo=f(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});function jT(i,e){return document.createElement(i,e)}function NT(i,e,t){return document.createElementNS(i,e,t)}function LT(){return lr(document.createDocumentFragment())}function BT(i){return document.createTextNode(i)}function FT(i){return document.createComment(i)}function VT(i,e,t){if(Xn(i)){let n=i;for(;n&&Xn(n);)n=lr(n).parent;i=n??i}Xn(e)&&(e=lr(e,i)),t&&Xn(t)&&(t=lr(t).firstChildNode),i.insertBefore(e,t)}function KT(i,e){i.removeChild(e)}function HT(i,e){Xn(e)&&(e=lr(e,i)),i.appendChild(e)}function eS(i){if(Xn(i)){for(;i&&Xn(i);)i=lr(i).parent;return i??null}return i.parentNode}function zT(i){var e;if(Xn(i)){let t=lr(i),n=eS(t);if(n&&t.lastChildNode){let r=Array.from(n.childNodes),o=r.indexOf(t.lastChildNode);return(e=r[o+1])!==null&&e!==void 0?e:null}return null}return i.nextSibling}function YT(i){return i.tagName}function kT(i,e){i.textContent=e}function UT(i){return i.textContent}function GT(i){return i.nodeType===1}function WT(i){return i.nodeType===3}function $T(i){return i.nodeType===8}function Xn(i){return i.nodeType===11}function lr(i,e){var t,n,r;let o=i;return(t=o.parent)!==null&&t!==void 0||(o.parent=e??null),(n=o.firstChildNode)!==null&&n!==void 0||(o.firstChildNode=i.firstChild),(r=o.lastChildNode)!==null&&r!==void 0||(o.lastChildNode=i.lastChild),o}var Yh={createElement:jT,createElementNS:NT,createTextNode:BT,createDocumentFragment:LT,createComment:FT,insertBefore:VT,removeChild:KT,appendChild:HT,parentNode:eS,nextSibling:zT,tagName:YT,setTextContent:kT,getTextContent:UT,isElement:GT,isText:WT,isComment:$T,isDocumentFragment:Xn};function lt(i,e,t,n,r){let o=e===void 0?void 0:e.key;return{sel:i,data:e,children:t,text:n,elm:r,key:o}}var Ws=Array.isArray;function fr(i){return typeof i=="string"||typeof i=="number"||i instanceof String||i instanceof Number}function Fh(i){return i===void 0}function St(i){return i!==void 0}var Vh=lt("",{},[],void 0,void 0);function Gs(i,e){var t,n;let r=i.key===e.key,o=((t=i.data)===null||t===void 0?void 0:t.is)===((n=e.data)===null||n===void 0?void 0:n.is),s=i.sel===e.sel,a=!i.sel&&i.sel===e.sel?typeof i.text==typeof e.text:!0;return s&&r&&o&&a}function XT(){throw new Error("The document fragment is not supported on this platform.")}function JT(i,e){return i.isElement(e)}function ZT(i,e){return i.isDocumentFragment(e)}function QT(i,e,t){var n;let r={};for(let o=e;o<=t;++o){let s=(n=i[o])===null||n===void 0?void 0:n.key;s!==void 0&&(r[s]=o)}return r}var eA=["create","update","remove","destroy","pre","post"];function tA(i,e,t){let n={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:Yh;for(let v of eA)for(let m of i){let O=m[v];O!==void 0&&n[v].push(O)}function o(v){let m=v.id?"#"+v.id:"",O=v.getAttribute("class"),A=O?"."+O.split(" ").join("."):"";return lt(r.tagName(v).toLowerCase()+m+A,{},[],void 0,v)}function s(v){return lt(void 0,{},[],void 0,v)}function a(v,m){return function(){if(--m===0){let A=r.parentNode(v);r.removeChild(A,v)}}}function c(v,m){var O,A,K,U;let D,F=v.data;if(F!==void 0){let z=(O=F.hook)===null||O===void 0?void 0:O.init;St(z)&&(z(v),F=v.data)}let H=v.children,W=v.sel;if(W==="!")Fh(v.text)&&(v.text=""),v.elm=r.createComment(v.text);else if(W!==void 0){let z=W.indexOf("#"),oe=W.indexOf(".",z),we=z>0?z:W.length,le=oe>0?oe:W.length,_e=z!==-1||oe!==-1?W.slice(0,Math.min(we,le)):W,Ge=v.elm=St(F)&&St(D=F.ns)?r.createElementNS(D,_e,F):r.createElement(_e,F);for(we<le&&Ge.setAttribute("id",W.slice(we+1,le)),oe>0&&Ge.setAttribute("class",W.slice(le+1).replace(/\./g," ")),D=0;D<n.create.length;++D)n.create[D](Vh,v);if(Ws(H))for(D=0;D<H.length;++D){let ai=H[D];ai!=null&&r.appendChild(Ge,c(ai,m))}else fr(v.text)&&r.appendChild(Ge,r.createTextNode(v.text));let yn=v.data.hook;St(yn)&&((A=yn.create)===null||A===void 0||A.call(yn,Vh,v),yn.insert&&m.push(v))}else if(!((K=t?.experimental)===null||K===void 0)&&K.fragments&&v.children){for(v.elm=((U=r.createDocumentFragment)!==null&&U!==void 0?U:XT)(),D=0;D<n.create.length;++D)n.create[D](Vh,v);for(D=0;D<v.children.length;++D){let z=v.children[D];z!=null&&r.appendChild(v.elm,c(z,m))}}else v.elm=r.createTextNode(v.text);return v.elm}function u(v,m,O,A,K,U){for(;A<=K;++A){let D=O[A];D!=null&&r.insertBefore(v,c(D,U),m)}}function d(v){var m,O;let A=v.data;if(A!==void 0){(O=(m=A?.hook)===null||m===void 0?void 0:m.destroy)===null||O===void 0||O.call(m,v);for(let K=0;K<n.destroy.length;++K)n.destroy[K](v);if(v.children!==void 0)for(let K=0;K<v.children.length;++K){let U=v.children[K];U!=null&&typeof U!="string"&&d(U)}}}function l(v,m,O,A){for(var K,U;O<=A;++O){let D,F,H=m[O];if(H!=null)if(St(H.sel)){d(H),D=n.remove.length+1,F=a(H.elm,D);for(let z=0;z<n.remove.length;++z)n.remove[z](H,F);let W=(U=(K=H?.data)===null||K===void 0?void 0:K.hook)===null||U===void 0?void 0:U.remove;St(W)?W(H,F):F()}else H.children?(d(H),l(v,H.children,0,H.children.length-1)):r.removeChild(v,H.elm)}}function S(v,m,O,A){let K=0,U=0,D=m.length-1,F=m[0],H=m[D],W=O.length-1,z=O[0],oe=O[W],we,le,_e,Ge;for(;K<=D&&U<=W;)F==null?F=m[++K]:H==null?H=m[--D]:z==null?z=O[++U]:oe==null?oe=O[--W]:Gs(F,z)?(R(F,z,A),F=m[++K],z=O[++U]):Gs(H,oe)?(R(H,oe,A),H=m[--D],oe=O[--W]):Gs(F,oe)?(R(F,oe,A),r.insertBefore(v,F.elm,r.nextSibling(H.elm)),F=m[++K],oe=O[--W]):Gs(H,z)?(R(H,z,A),r.insertBefore(v,H.elm,F.elm),H=m[--D],z=O[++U]):(we===void 0&&(we=QT(m,K,D)),le=we[z.key],Fh(le)?r.insertBefore(v,c(z,A),F.elm):(_e=m[le],_e.sel!==z.sel?r.insertBefore(v,c(z,A),F.elm):(R(_e,z,A),m[le]=void 0,r.insertBefore(v,_e.elm,F.elm))),z=O[++U]);U<=W&&(Ge=O[W+1]==null?null:O[W+1].elm,u(v,Ge,O,U,W,A)),K<=D&&l(v,m,K,D)}function R(v,m,O){var A,K,U,D,F,H,W,z;let oe=(A=m.data)===null||A===void 0?void 0:A.hook;(K=oe?.prepatch)===null||K===void 0||K.call(oe,v,m);let we=m.elm=v.elm;if(v===m)return;if(m.data!==void 0||St(m.text)&&m.text!==v.text){(U=m.data)!==null&&U!==void 0||(m.data={}),(D=v.data)!==null&&D!==void 0||(v.data={});for(let Ge=0;Ge<n.update.length;++Ge)n.update[Ge](v,m);(W=(H=(F=m.data)===null||F===void 0?void 0:F.hook)===null||H===void 0?void 0:H.update)===null||W===void 0||W.call(H,v,m)}let le=v.children,_e=m.children;Fh(m.text)?St(le)&&St(_e)?le!==_e&&S(we,le,_e,O):St(_e)?(St(v.text)&&r.setTextContent(we,""),u(we,null,_e,0,_e.length-1,O)):St(le)?l(we,le,0,le.length-1):St(v.text)&&r.setTextContent(we,""):v.text!==m.text&&(St(le)&&l(we,le,0,le.length-1),r.setTextContent(we,m.text)),(z=oe?.postpatch)===null||z===void 0||z.call(oe,v,m)}return function(m,O){let A,K,U,D=[];for(A=0;A<n.pre.length;++A)n.pre[A]();for(JT(r,m)?m=o(m):ZT(r,m)&&(m=s(m)),Gs(m,O)?R(m,O,D):(K=m.elm,U=r.parentNode(K),c(O,D),U!==null&&(r.insertBefore(U,O.elm,r.nextSibling(K)),l(U,[m],0,0))),A=0;A<D.length;++A)D[A].data.hook.insert(D[A]);for(A=0;A<n.post.length;++A)n.post[A]();return O}}function Bu(i,e,t){if(i.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let n=0;n<e.length;++n){let r=e[n];if(typeof r=="string")continue;let o=r.data;o!==void 0&&Bu(o,r.children,r.sel)}}function Lu(i,e,t){let n={},r,o,s;if(t!==void 0?(e!==null&&(n=e),Ws(t)?r=t:fr(t)?o=t.toString():t&&t.sel&&(r=[t])):e!=null&&(Ws(e)?r=e:fr(e)?o=e.toString():e&&e.sel?r=[e]:n=e),r!==void 0)for(s=0;s<r.length;++s)fr(r[s])&&(r[s]=lt(void 0,void 0,void 0,r[s],void 0));return i[0]==="s"&&i[1]==="v"&&i[2]==="g"&&(i.length===3||i[3]==="."||i[3]==="#")&&Bu(n,r,i),lt(i,n,r,o,void 0)}function nA(i){let e,t;if(Ws(i)?e=i:fr(e)?t=i:e&&e.sel&&(e=[i]),e!==void 0)for(let n=0;n<e.length;++n)fr(e[n])&&(e[n]=lt(void 0,void 0,void 0,e[n],void 0));return lt(void 0,{},e,t,void 0)}function Nu(i,e){var t;let n=(t=e.data)===null||t===void 0?void 0:t.ns;i.data.fn=e.data.fn,i.data.args=e.data.args,e.data=i.data,e.children=i.children,e.text=i.text,e.elm=i.elm,n&&Bu(e.data,e.children,e.sel)}function iA(i){let e=i.data,t=e.fn(...e.args);Nu(t,i)}function rA(i,e){let t,n=i.data,r=e.data,o=n.args,s=r.args;if(n.fn!==r.fn||o.length!==s.length){Nu(r.fn(...s),e);return}for(t=0;t<s.length;++t)if(o[t]!==s[t]){Nu(r.fn(...s),e);return}Nu(i,e)}var oA=function(e,t,n,r){return r===void 0&&(r=n,n=t,t=void 0),Lu(e,{key:t,hook:{init:iA,prepatch:rA},fn:n,args:r})};function sA(i,e){let t=i.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,i.elm=i.data.attachData.real}function aA(i,e){e.elm=e.data.attachData.placeholder}function cA(i){i.elm!==void 0&&i.elm.parentNode.removeChild(i.elm),i.elm=i.data.attachData.real}function uA(i,e){let t=e.elm,n=e.data.attachData,r=document.createElement("span");e.elm=r,n.target.appendChild(t),n.real=t,n.placeholder=r}function dA(i,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});let t=e.data,n=e.data.hook;return t.attachData={target:i,placeholder:void 0,real:void 0},n.create=uA,n.prepatch=sA,n.postpatch=aA,n.destroy=cA,e}function tS(i,e){let t=e!==void 0?e:Yh,n;if(t.isElement(i)){let r=i.id?"#"+i.id:"",o=i.getAttribute("class"),s=o?"."+o.split(" ").join("."):"",a=t.tagName(i).toLowerCase()+r+s,c={},u={},d={},l=[],S,R,v,m=i.attributes,O=i.childNodes;for(R=0,v=m.length;R<v;R++)S=m[R].nodeName,S[0]==="d"&&S[1]==="a"&&S[2]==="t"&&S[3]==="a"&&S[4]==="-"?u[S.slice(5)]=m[R].nodeValue||"":S!=="id"&&S!=="class"&&(c[S]=m[R].nodeValue);for(R=0,v=O.length;R<v;R++)l.push(tS(O[R],e));return Object.keys(c).length>0&&(d.attrs=c),Object.keys(u).length>0&&(d.dataset=u),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&Bu(d,l,a),lt(a,d,l,void 0,i)}else return t.isText(i)?(n=t.getTextContent(i),lt(void 0,void 0,void 0,n,i)):t.isComment(i)?(n=t.getTextContent(i),lt("!",{},[],n,i)):lt("",{},[],void 0,i)}var lA="http://www.w3.org/1999/xlink",fA="http://www.w3.org/XML/1998/namespace",Ub=58,hA=120;function Gb(i,e){let t,n=e.elm,r=i.data.attrs,o=e.data.attrs;if(!(!r&&!o)&&r!==o){r=r||{},o=o||{};for(t in o){let s=o[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==hA?n.setAttribute(t,s):t.charCodeAt(3)===Ub?n.setAttributeNS(fA,t,s):t.charCodeAt(5)===Ub?n.setAttributeNS(lA,t,s):n.setAttribute(t,s))}for(t in r)t in o||n.removeAttribute(t)}}var pA={create:Gb,update:Gb};function Wb(i,e){let t,n,r=e.elm,o=i.data.class,s=e.data.class;if(!(!o&&!s)&&o!==s){o=o||{},s=s||{};for(n in o)o[n]&&!Object.prototype.hasOwnProperty.call(s,n)&&r.classList.remove(n);for(n in s)t=s[n],t!==o[n]&&r.classList[t?"add":"remove"](n)}}var gA={create:Wb,update:Wb},$b=/[A-Z]/g;function Xb(i,e){let t=e.elm,n=i.data.dataset,r=e.data.dataset,o;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(o in n)r[o]||(s?o in s&&delete s[o]:t.removeAttribute("data-"+o.replace($b,"-$&").toLowerCase()));for(o in r)n[o]!==r[o]&&(s?s[o]=r[o]:t.setAttribute("data-"+o.replace($b,"-$&").toLowerCase(),r[o]))}var mA={create:Xb,update:Xb};function nS(i,e,t){if(typeof i=="function")i.call(e,t,e);else if(typeof i=="object")for(let n=0;n<i.length;n++)nS(i[n],e,t)}function yA(i,e){let t=i.type,n=e.data.on;n&&n[t]&&nS(n[t],e,i)}function _A(){return function i(e){yA(e,i.vnode)}}function Kh(i,e){let t=i.data.on,n=i.listener,r=i.elm,o=e&&e.data.on,s=e&&e.elm,a;if(t!==o){if(t&&n)if(o)for(a in t)o[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(o){let c=e.listener=i.listener||_A();if(c.vnode=e,t)for(a in o)t[a]||s.addEventListener(a,c,!1);else for(a in o)s.addEventListener(a,c,!1)}}}var vA={create:Kh,update:Kh,destroy:Kh};function Jb(i,e){let t,n,r,o=e.elm,s=i.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||o[t]!==n)&&(o[t]=n)}}var bA={create:Jb,update:Jb},Zb=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,SA=function(i){Zb(function(){Zb(i)})},Hh=!1;function EA(i,e,t){SA(function(){i[e]=t})}function Qb(i,e){let t,n,r=e.elm,o=i.data.style,s=e.data.style;if(!o&&!s||o===s)return;o=o||{},s=s||{};let a="delayed"in o;for(n in o)s[n]||(n[0]==="-"&&n[1]==="-"?r.style.removeProperty(n):r.style[n]="");for(n in s)if(t=s[n],n==="delayed"&&s.delayed)for(let c in s.delayed)t=s.delayed[c],(!a||t!==o.delayed[c])&&EA(r.style,c,t);else n!=="remove"&&t!==o[n]&&(n[0]==="-"&&n[1]==="-"?r.style.setProperty(n,t):r.style[n]=t)}function wA(i){let e,t,n=i.elm,r=i.data.style;if(!(!r||!(e=r.destroy)))for(t in e)n.style[t]=e[t]}function PA(i,e){let t=i.data.style;if(!t||!t.remove){e();return}Hh||(i.elm.offsetLeft,Hh=!0);let n,r=i.elm,o=0,s=t.remove,a=0,c=[];for(n in s)c.push(n),r.style[n]=s[n];let d=getComputedStyle(r)["transition-property"].split(", ");for(;o<d.length;++o)c.indexOf(d[o])!==-1&&a++;r.addEventListener("transitionend",function(l){l.target===r&&--a,a===0&&e()})}function IA(){Hh=!1}var RA={pre:IA,create:Qb,update:Qb,destroy:wA,remove:PA};function MA(i,...e){let t=kh(e,[]);return t.length===1&&!t[0].sel&&t[0].text?lt(void 0,void 0,void 0,t[0].text,void 0):lt(void 0,i??{},t,void 0,void 0)}function kh(i,e){for(let t of i)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?kh(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(lt(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function zh(i,e,...t){let n=kh(t,[]);return typeof i=="function"?i(e,n):n.length===1&&!n[0].sel&&n[0].text?Lu(i,e,n[0].text):Lu(i,e,n)}(function(i){})(zh||(zh={}));Pe.Fragment=MA;Pe.array=Ws;Pe.attachTo=dA;Pe.attributesModule=pA;Pe.classModule=gA;Pe.datasetModule=mA;Pe.eventListenersModule=vA;Pe.fragment=nA;Pe.h=Lu;Pe.htmlDomApi=Yh;Pe.init=tA;Pe.jsx=zh;Pe.primitive=fr;Pe.propsModule=bA;Pe.styleModule=RA;Pe.thunk=oA;Pe.toVNode=tS;Pe.vnode=lt});var Gh=f(Pi=>{"use strict";var OA=Pi&&Pi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Pi,"__esModule",{value:!0});Pi.isThunk=Pi.ThunkView=void 0;var TA=uo(),AA=_(),Uh=class{render(e,t){return(0,TA.h)(this.selector(e),{key:e.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(e,t),args:this.watchedArgs(e),thunk:!0})}renderAndDecorate(e,t){let n=this.doRender(e,t);return t.decorate(n,e),n}copyToThunk(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}init(e){let t=e.data,n=t.fn.apply(void 0,t.args);this.copyToThunk(n,e)}prepatch(e,t){let n=e.data,r=t.data;this.equals(n.args,r.args)?this.copyToThunk(e,t):this.copyToThunk(r.fn.apply(void 0,r.args),t)}equals(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<t.length;++n)if(!this.equals(e[n],t[n]))return!1}else if(typeof e=="object"&&typeof t=="object"){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(n!=="parent"&&n!=="root"&&(!(n in t)||!this.equals(e[n],t[n])))return!1}else if(e!==t)return!1;return!0}};Uh=OA([(0,AA.injectable)()],Uh);Pi.ThunkView=Uh;function CA(i){return"thunk"in i}Pi.isThunk=CA});var Gt=f(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.JSX=Ii.svg=Ii.html=void 0;var xA=uo(),DA=["hook","on","style","class","props","attrs","dataset"],qA="http://www.w3.org/2000/svg";function jA(i,e,t){let n={};if(t&&(n.ns=t),i===null)return n;return DA.forEach(o=>{i[o]&&(n[o]=i[o])}),Object.keys(i).forEach(o=>{if(o==="key"||o==="classNames"||o==="selector")return;let s=o.indexOf("-");s>0?r(o.slice(0,s),o.slice(s+1),i[o]):n[o]||r(e,o,i[o])}),n;function r(o,s,a){let c=n[o]||(n[o]={});c[s]=a}}function Wh(i,e="props"){return(t,n,...r)=>(0,xA.jsx)(t,jA(n,e,i),r)}Ii.JSX=Wh;var NA=Wh();Ii.html=NA;var LA=Wh(qA,"attrs");Ii.svg=LA});var lo=f(Ie=>{"use strict";var Xh=Ie&&Ie.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},BA=Ie&&Ie.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},iS=Ie&&Ie.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.MissingView=Ie.EmptyView=Ie.configureView=Ie.configureModelElement=Ie.ViewRegistry=Ie.findArgValue=void 0;var rS=Gt(),$s=_(),oS=P(),FA=wn(),VA=rr(),KA=Pn(),HA=Ke(),zA=ur();function YA(i,e){for(;i!==void 0&&!(e in i)&&i.parentArgs;)i=i.parentArgs;return i?i[e]:void 0}Ie.findArgValue=YA;var $h=class extends FA.InstanceRegistry{constructor(e){super(),this.registerDefaults(),e.forEach(t=>this.register(t.type,t.factory()))}registerDefaults(){this.register(KA.EMPTY_ROOT.type,new Fu)}missing(e){return new Vu}};$h=Xh([(0,$s.injectable)(),iS(0,(0,$s.multiInject)(oS.TYPES.ViewRegistration)),iS(0,(0,$s.optional)()),BA("design:paramtypes",[Array])],$h);Ie.ViewRegistry=$h;function kA(i,e,t,n,r){(0,HA.registerModelElement)(i,e,t,r),sS(i,e,n)}Ie.configureModelElement=kA;function sS(i,e,t){if(typeof t=="function"){if(!(0,VA.isInjectable)(t))throw new Error(`Views should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(oS.TYPES.ViewRegistration).toDynamicValue(n=>({type:e,factory:()=>n.container.get(t)}))}Ie.configureView=sS;var Fu=class{render(e,t){return(0,rS.svg)("svg",{"class-sprotty-empty":!0})}};Fu=Xh([(0,$s.injectable)()],Fu);Ie.EmptyView=Fu;var Vu=class{render(e,t){let n=e.position||zA.Point.ORIGIN;return(0,rS.svg)("text",{"class-sprotty-missing":!0,x:n.x,y:n.y},"?",e.id,"?")}};Vu=Xh([(0,$s.injectable)()],Vu);Ie.MissingView=Vu});var Qh=f(Ri=>{"use strict";var Jh=Ri&&Ri.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},aS=Ri&&Ri.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.ViewerCache=void 0;var Zh=_(),cS=P(),UA=$r(),Xs=class{update(e,t){if(t!==void 0)this.delegate.update(e,t),this.cachedModel=void 0;else{let n=this.cachedModel===void 0;this.cachedModel=e,n&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};Jh([(0,Zh.inject)(cS.TYPES.IViewer),aS("design:type",Object)],Xs.prototype,"delegate",void 0);Jh([(0,Zh.inject)(cS.TYPES.AnimationFrameSyncer),aS("design:type",UA.AnimationFrameSyncer)],Xs.prototype,"syncer",void 0);Xs=Jh([(0,Zh.injectable)()],Xs);Ri.ViewerCache=Xs});var ep=f(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.overrideViewerOptions=Jn.configureViewerOptions=Jn.defaultViewerOptions=void 0;var GA=_n(),Ku=P(),WA=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300});Jn.defaultViewerOptions=WA;function $A(i,e){let t=Object.assign(Object.assign({},(0,Jn.defaultViewerOptions)()),e);i.isBound(Ku.TYPES.ViewerOptions)?i.rebind(Ku.TYPES.ViewerOptions).toConstantValue(t):i.bind(Ku.TYPES.ViewerOptions).toConstantValue(t)}Jn.configureViewerOptions=$A;function XA(i,e){let t=i.get(Ku.TYPES.ViewerOptions);return(0,GA.safeAssign)(t,e),t}Jn.overrideViewerOptions=XA});var tp=f(Le=>{"use strict";var cn=Le&&Le.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},un=Le&&Le.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Wt=Le&&Le.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Le,"__esModule",{value:!0});Le.PopupModelViewer=Le.HiddenModelViewer=Le.ModelViewer=Le.PatcherProvider=Le.ModelRenderer=void 0;var ge=_(),fo=uo(),Js=Gt(),JA=In(),ZA=Vs(),uS=Pn(),et=P(),QA=Gh(),At=Ne(),Zs=class{constructor(e,t,n,r={}){this.viewRegistry=e,this.targetKind=t,this.postprocessors=n,this.args=r}decorate(e,t){return(0,QA.isThunk)(e)?e:this.postprocessors.reduce((n,r)=>r.decorate(n,t),e)}renderElement(e){let n=this.viewRegistry.get(e.type).render(e,this,this.args);if(n)return this.decorate(n,e)}renderChildren(e,t){let n=t?new Zs(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map(r=>n.renderElement(r)).filter(r=>r!==void 0)}postUpdate(e){this.postprocessors.forEach(t=>t.postUpdate(e))}};Le.ModelRenderer=Zs;var ho=class{constructor(){this.patcher=(0,fo.init)(this.createModules())}createModules(){return[fo.propsModule,fo.attributesModule,fo.classModule,fo.styleModule,fo.eventListenersModule]}};ho=cn([(0,ge.injectable)(),un("design:paramtypes",[])],ho);Le.PatcherProvider=ho;var po=class{constructor(e,t,n){this.renderer=e("main",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering",e);let n=(0,Js.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(e));if(this.lastVDOM!==void 0){let r=this.hasFocus();(0,At.copyClassesFromVNode)(this.lastVDOM,n),this.lastVDOM=this.patcher.call(this,this.lastVDOM,n),this.restoreFocus(r)}else if(typeof document<"u"){let r=document.getElementById(this.options.baseDiv);r!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(n)}),(0,At.copyClassesFromElement)(r,n),(0,At.setClass)(n,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,r,n)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(t)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let e=this.lastVDOM.children[0];if(typeof e=="object"){let t=e.elm;return document.activeElement===t}}return!1}restoreFocus(e){if(e&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let t=this.lastVDOM.children[0];if(typeof t=="object"){let n=t.elm;n&&typeof n.focus=="function"&&n.focus()}}}onWindowResize(e){let t=document.getElementById(this.options.baseDiv);if(t!==null){let n=this.getBoundsInPage(t);this.actiondispatcher.dispatch(ZA.InitializeCanvasBoundsAction.create(n))}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,JA.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};cn([(0,ge.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],po.prototype,"options",void 0);cn([(0,ge.inject)(et.TYPES.ILogger),un("design:type",Object)],po.prototype,"logger",void 0);cn([(0,ge.inject)(et.TYPES.IActionDispatcher),un("design:type",Object)],po.prototype,"actiondispatcher",void 0);po=cn([(0,ge.injectable)(),Wt(0,(0,ge.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,ge.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,ge.multiInject)(et.TYPES.IVNodePostprocessor)),Wt(2,(0,ge.optional)()),un("design:paramtypes",[Function,ho,Array])],po);Le.ModelViewer=po;var Qs=class{constructor(e,t,n){this.hiddenRenderer=e("hidden",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering hidden");let n;if(e.type===uS.EMPTY_ROOT.type)n=(0,Js.html)("div",{id:this.options.hiddenDiv});else{let r=this.hiddenRenderer.renderElement(e);r&&(0,At.setAttr)(r,"opacity",0),n=(0,Js.html)("div",{id:this.options.hiddenDiv},r)}if(this.lastHiddenVDOM!==void 0)(0,At.copyClassesFromVNode)(this.lastHiddenVDOM,n),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,n);else{let r=document.getElementById(this.options.hiddenDiv);r===null?(r=document.createElement("div"),document.body.appendChild(r)):(0,At.copyClassesFromElement)(r,n),(0,At.setClass)(n,this.options.baseClass,!0),(0,At.setClass)(n,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,r,n)}this.hiddenRenderer.postUpdate(t)}};cn([(0,ge.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],Qs.prototype,"options",void 0);cn([(0,ge.inject)(et.TYPES.ILogger),un("design:type",Object)],Qs.prototype,"logger",void 0);Qs=cn([(0,ge.injectable)(),Wt(0,(0,ge.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,ge.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,ge.multiInject)(et.TYPES.HiddenVNodePostprocessor)),Wt(2,(0,ge.optional)()),un("design:paramtypes",[Function,ho,Array])],Qs);Le.HiddenModelViewer=Qs;var ea=class{constructor(e,t,n){this.modelRendererFactory=e,this.popupRenderer=this.modelRendererFactory("popup",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering popup",e);let n=e.type===uS.EMPTY_ROOT.type,r;if(n)r=(0,Js.html)("div",{id:this.options.popupDiv});else{let o=e.canvasBounds,s={top:o.y+"px",left:o.x+"px"};r=(0,Js.html)("div",{id:this.options.popupDiv,style:s},this.popupRenderer.renderElement(e))}if(this.lastPopupVDOM!==void 0)(0,At.copyClassesFromVNode)(this.lastPopupVDOM,r),(0,At.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,r);else if(typeof document<"u"){let o=document.getElementById(this.options.popupDiv);o===null?(o=document.createElement("div"),document.body.appendChild(o)):(0,At.copyClassesFromElement)(o,r),(0,At.setClass)(r,this.options.popupClass,!0),(0,At.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,o,r)}this.popupRenderer.postUpdate(t)}};cn([(0,ge.inject)(et.TYPES.ViewerOptions),un("design:type",Object)],ea.prototype,"options",void 0);cn([(0,ge.inject)(et.TYPES.ILogger),un("design:type",Object)],ea.prototype,"logger",void 0);ea=cn([(0,ge.injectable)(),Wt(0,(0,ge.inject)(et.TYPES.ModelRendererFactory)),Wt(1,(0,ge.inject)(et.TYPES.PatcherProvider)),Wt(2,(0,ge.multiInject)(et.TYPES.PopupVNodePostprocessor)),Wt(2,(0,ge.optional)()),un("design:paramtypes",[Function,ho,Array])],ea);Le.PopupModelViewer=ea});var ip=f(go=>{"use strict";var eC=go&&go.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(go,"__esModule",{value:!0});go.FocusFixPostprocessor=void 0;var tC=_(),nC=Ne(),np=class{decorate(e,t){return e.sel&&e.sel.startsWith("svg")&&(0,nC.setAttr)(e,"tabindex",0),e}postUpdate(){}};np=eC([(0,tC.injectable)()],np);go.FocusFixPostprocessor=np});var Yu=f(Ct=>{"use strict";var Hu=Ct&&Ct.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},dS=Ct&&Ct.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.ConsoleLogger=Ct.NullLogger=Ct.LogLevel=void 0;var zu=_(),lS=P(),hr;(function(i){i[i.none=0]="none",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i[i.log=4]="log"})(hr=Ct.LogLevel||(Ct.LogLevel={}));var rp=class{constructor(){this.logLevel=hr.none}error(e,t,...n){}warn(e,t,...n){}info(e,t,...n){}log(e,t,...n){}};rp=Hu([(0,zu.injectable)()],rp);Ct.NullLogger=rp;var ta=class{constructor(){this.logLevel=hr.log,this.viewOptions={baseDiv:""}}error(e,t,...n){if(this.logLevel>=hr.error)try{console.error.apply(e,this.consoleArguments(e,t,n))}catch{}}warn(e,t,...n){if(this.logLevel>=hr.warn)try{console.warn.apply(e,this.consoleArguments(e,t,n))}catch{}}info(e,t,...n){if(this.logLevel>=hr.info)try{console.info.apply(e,this.consoleArguments(e,t,n))}catch{}}log(e,t,...n){if(this.logLevel>=hr.log)try{console.log.apply(e,this.consoleArguments(e,t,n))}catch{}}consoleArguments(e,t,n){let r;return typeof e=="object"?r=e.constructor.name:r=e,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+r+": "+t,...n]}};Hu([(0,zu.inject)(lS.TYPES.LogLevel),dS("design:type",Number)],ta.prototype,"logLevel",void 0);Hu([(0,zu.inject)(lS.TYPES.ViewerOptions),dS("design:type",Object)],ta.prototype,"viewOptions",void 0);ta=Hu([(0,zu.injectable)()],ta);Ct.ConsoleLogger=ta});var pS=f(Mi=>{"use strict";var op=Mi&&Mi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},fS=Mi&&Mi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.IdPostprocessor=void 0;var sp=_(),hS=P(),iC=so(),rC=Ne(),na=class{decorate(e,t){let n=(0,rC.getAttrs)(e);return n.id!==void 0&&this.logger.warn(e,"Overriding id of vnode ("+n.id+"). Make sure not to set it manually in view."),n.id=this.domHelper.createUniqueDOMElementId(t),e.key||(e.key=t.id),e}postUpdate(){}};op([(0,sp.inject)(hS.TYPES.ILogger),fS("design:type",Object)],na.prototype,"logger",void 0);op([(0,sp.inject)(hS.TYPES.DOMHelper),fS("design:type",iC.DOMHelper)],na.prototype,"domHelper",void 0);na=op([(0,sp.injectable)()],na);Mi.IdPostprocessor=na});var mS=f(mo=>{"use strict";var oC=mo&&mo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(mo,"__esModule",{value:!0});mo.CssClassPostprocessor=void 0;var sC=bi(),gS=Ne(),aC=_(),ap=class{decorate(e,t){if(t.cssClasses)for(let r of t.cssClasses)(0,gS.setClass)(e,r,!0);let n=(0,sC.getSubType)(t);return n&&n!==t.type&&(0,gS.setClass)(e,n,!0),e}postUpdate(){}};ap=oC([(0,aC.injectable)()],ap);mo.CssClassPostprocessor=ap});var lp=f(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});var cC=_(),B=P(),cp=Vs(),yS=Yu(),uC=au(),ku=Ls(),dC=gh(),_S=Pn(),lC=$r(),Oi=tp(),fC=ep(),yo=Tt(),vS=an(),bS=ip(),hC=lo(),Uu=Qh(),pC=so(),Gu=pS(),Wu=yt(),up=mS(),_o=Ah(),SS=Pu(),gC=wu(),ES=ks(),mC=rh(),yC=new cC.ContainerModule((i,e,t)=>{i(B.TYPES.ILogger).to(yS.NullLogger).inSingletonScope(),i(B.TYPES.LogLevel).toConstantValue(yS.LogLevel.warn),i(B.TYPES.SModelRegistry).to(_S.SModelRegistry).inSingletonScope(),i(ku.ActionHandlerRegistry).toSelf().inSingletonScope(),i(B.TYPES.ActionHandlerRegistryProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(ku.ActionHandlerRegistry))})),i(B.TYPES.ViewRegistry).to(hC.ViewRegistry).inSingletonScope(),i(B.TYPES.IModelFactory).to(_S.SModelFactory).inSingletonScope(),i(B.TYPES.IActionDispatcher).to(uC.ActionDispatcher).inSingletonScope(),i(B.TYPES.IActionDispatcherProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.IActionDispatcher))})),i(B.TYPES.IDiagramLocker).to(mC.DefaultDiagramLocker).inSingletonScope(),i(B.TYPES.IActionHandlerInitializer).to(Wu.CommandActionHandlerInitializer),i(B.TYPES.ICommandStack).to(dC.CommandStack).inSingletonScope(),i(B.TYPES.ICommandStackProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.ICommandStack))})),i(B.TYPES.CommandStackOptions).toConstantValue({defaultDuration:250,undoHistoryLimit:50}),i(Oi.ModelViewer).toSelf().inSingletonScope(),i(Oi.HiddenModelViewer).toSelf().inSingletonScope(),i(Oi.PopupModelViewer).toSelf().inSingletonScope(),i(B.TYPES.ModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Oi.ModelViewer),o.bind(Uu.ViewerCache).toSelf(),o.get(Uu.ViewerCache)}).inSingletonScope(),i(B.TYPES.PopupModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(Oi.PopupModelViewer),o.bind(Uu.ViewerCache).toSelf(),o.get(Uu.ViewerCache)}).inSingletonScope(),i(B.TYPES.HiddenModelViewer).toService(Oi.HiddenModelViewer),i(B.TYPES.IViewerProvider).toDynamicValue(r=>({get modelViewer(){return r.container.get(B.TYPES.ModelViewer)},get hiddenModelViewer(){return r.container.get(B.TYPES.HiddenModelViewer)},get popupModelViewer(){return r.container.get(B.TYPES.PopupModelViewer)}})),i(B.TYPES.ViewerOptions).toConstantValue((0,fC.defaultViewerOptions)()),i(B.TYPES.PatcherProvider).to(Oi.PatcherProvider).inSingletonScope(),i(B.TYPES.DOMHelper).to(pC.DOMHelper).inSingletonScope(),i(B.TYPES.ModelRendererFactory).toFactory(r=>(o,s,a={})=>{let c=r.container.get(B.TYPES.ViewRegistry);return new Oi.ModelRenderer(c,o,s,a)}),i(Gu.IdPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(Gu.IdPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(Gu.IdPostprocessor),i(up.CssClassPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(up.CssClassPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(up.CssClassPostprocessor),i(yo.MouseTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(yo.MouseTool),i(vS.KeyTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(vS.KeyTool),i(bS.FocusFixPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(bS.FocusFixPostprocessor),i(B.TYPES.PopupVNodePostprocessor).toService(Gu.IdPostprocessor),i(yo.PopupMouseTool).toSelf().inSingletonScope(),i(B.TYPES.PopupVNodePostprocessor).toService(yo.PopupMouseTool),i(B.TYPES.AnimationFrameSyncer).to(lC.AnimationFrameSyncer).inSingletonScope();let n={bind:i,isBound:t};(0,Wu.configureCommand)(n,cp.InitializeCanvasBoundsCommand),i(cp.CanvasBoundsInitializer).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(cp.CanvasBoundsInitializer),(0,Wu.configureCommand)(n,gC.SetModelCommand),i(B.TYPES.IToolManager).to(_o.ToolManager).inSingletonScope(),i(_o.DefaultToolsEnablingKeyListener).toSelf().inSingletonScope(),i(B.TYPES.KeyListener).toService(_o.DefaultToolsEnablingKeyListener),i(_o.ToolManagerActionHandler).toSelf().inSingletonScope(),(0,ku.configureActionHandler)(n,SS.EnableDefaultToolsAction.KIND,_o.ToolManagerActionHandler),(0,ku.configureActionHandler)(n,SS.EnableToolsAction.KIND,_o.ToolManagerActionHandler),i(B.TYPES.UIExtensionRegistry).to(ES.UIExtensionRegistry).inSingletonScope(),(0,Wu.configureCommand)(n,ES.SetUIExtensionVisibilityCommand),i(yo.MousePositionTracker).toSelf().inSingletonScope(),i(B.TYPES.MouseListener).toService(yo.MousePositionTracker)});dp.default=yC});var ae=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.SShapeElement=Z.findChildrenAtPosition=Z.getAbsoluteClientBounds=Z.getAbsoluteBounds=Z.isAlignable=Z.isSizeable=Z.isLayoutableChild=Z.isLayoutContainer=Z.isBoundsAware=Z.alignFeature=Z.layoutableChildFeature=Z.layoutContainerFeature=Z.boundsFeature=void 0;var vo=Q(),$u=G(),_C=Ke(),vC=In();Z.boundsFeature=Symbol("boundsFeature");Z.layoutContainerFeature=Symbol("layoutContainerFeature");Z.layoutableChildFeature=Symbol("layoutableChildFeature");Z.alignFeature=Symbol("alignFeature");function bo(i){return"bounds"in i}Z.isBoundsAware=bo;function bC(i){return bo(i)&&i.hasFeature(Z.layoutContainerFeature)&&"layout"in i}Z.isLayoutContainer=bC;function SC(i){return bo(i)&&i.hasFeature(Z.layoutableChildFeature)}Z.isLayoutableChild=SC;function EC(i){return i.hasFeature(Z.boundsFeature)&&bo(i)}Z.isSizeable=EC;function wC(i){return i.hasFeature(Z.alignFeature)&&"alignment"in i}Z.isAlignable=wC;function PC(i){let e=(0,_C.findParentByFeature)(i,bo);if(e!==void 0){let t=e.bounds,n=e;for(;n instanceof $u.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}else if(i instanceof $u.SModelRoot){let t=i.canvasBounds;return{x:0,y:0,width:t.width,height:t.height}}else return vo.Bounds.EMPTY}Z.getAbsoluteBounds=PC;function IC(i,e,t){let n=0,r=0,o=0,s=0,a=e.createUniqueDOMElementId(i),c=document.getElementById(a);if(c){let d=c.getBoundingClientRect(),l=(0,vC.getWindowScroll)();n=d.left+l.x,r=d.top+l.y,o=d.width,s=d.height}let u=document.getElementById(t.baseDiv);if(u)for(;u.offsetParent instanceof HTMLElement&&(u=u.offsetParent);)n-=u.offsetLeft,r-=u.offsetTop;return{x:n,y:r,width:o,height:s}}Z.getAbsoluteClientBounds=IC;function RC(i,e){let t=[];return wS(i,e,t),t}Z.findChildrenAtPosition=RC;function wS(i,e,t){i.children.forEach(n=>{if(bo(n)&&vo.Bounds.includes(n.bounds,e)&&t.push(n),n instanceof $u.SParentElement){let r=n.parentToLocal(e);wS(n,r,t)}})}var fp=class extends $u.SChildElement{constructor(){super(...arguments),this.position=vo.Point.ORIGIN,this.size=vo.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:e.x+this.position.x,y:e.y+this.position.y,width:-1,height:-1};return(0,vo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}parentToLocal(e){let t={x:e.x-this.position.x,y:e.y-this.position.y,width:-1,height:-1};return(0,vo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}};Z.SShapeElement=fp});var Qu=f(ce=>{"use strict";var MC=ce&&ce.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),OC=ce&&ce.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),PS=ce&&ce.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},TC=ce&&ce.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&MC(e,i,t);return OC(e,i),e},IS=ce&&ce.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},RS=ce&&ce.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ce,"__esModule",{value:!0});ce.RequestBoundsCommand=ce.SetBoundsCommand=ce.LayoutAction=ce.ComputedBoundsAction=ce.RequestBoundsAction=ce.SetBoundsAction=void 0;var Xu=_(),AC=te(),MS=TC(te()),OS=pe(),TS=P(),CC=ae(),So=class{constructor(e){this.bounds=e,this.kind=So.KIND}};ce.SetBoundsAction=So;So.KIND="setBounds";var pr=class{constructor(e,t=""){this.newRoot=e,this.requestId=t,this.kind=pr.KIND}static create(e){return new pr(e,(0,AC.generateRequestId)())}};ce.RequestBoundsAction=pr;pr.KIND="requestBounds";var gr=class{constructor(e,t,n,r=""){this.bounds=e,this.revision=t,this.alignments=n,this.responseId=r,this.kind=gr.KIND}};ce.ComputedBoundsAction=gr;gr.KIND="computedBounds";var Eo=class{constructor(){this.kind=Eo.KIND}};ce.LayoutAction=Eo;Eo.KIND="layout";var Ju=class extends OS.SystemCommand{constructor(e){super(),this.action=e,this.bounds=[]}execute(e){return this.action.bounds.forEach(t=>{let n=e.root.index.getById(t.elementId);n&&(0,CC.isBoundsAware)(n)&&this.bounds.push({element:n,oldBounds:n.bounds,newPosition:t.newPosition,newSize:t.newSize})}),this.redo(e)}undo(e){return this.bounds.forEach(t=>t.element.bounds=t.oldBounds),e.root}redo(e){return this.bounds.forEach(t=>{t.newPosition?t.element.bounds=Object.assign(Object.assign({},t.newPosition),t.newSize):t.element.bounds=Object.assign({x:t.element.bounds.x,y:t.element.bounds.y},t.newSize)}),e.root}};Ju.KIND=MS.SetBoundsAction.KIND;Ju=PS([(0,Xu.injectable)(),RS(0,(0,Xu.inject)(TS.TYPES.Action)),IS("design:paramtypes",[Object])],Ju);ce.SetBoundsCommand=Ju;var Zu=class extends OS.HiddenCommand{constructor(e){super(),this.action=e}execute(e){return{model:e.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return e=>e.kind===gr.KIND}};Zu.KIND=MS.RequestBoundsAction.KIND;Zu=PS([(0,Xu.injectable)(),RS(0,(0,Xu.inject)(TS.TYPES.Action)),IS("design:paramtypes",[Object])],Zu);ce.RequestBoundsCommand=Zu});var nd=f(tt=>{"use strict";var oa=tt&&tt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},td=tt&&tt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},AS=tt&&tt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tt,"__esModule",{value:!0});tt.configureLayout=tt.StatefulLayouter=tt.Layouter=tt.LayoutRegistry=void 0;var mr=_(),xC=Q(),sa=P(),DC=wn(),CS=ae(),qC=rr(),ia=class extends DC.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>{this.hasKey(t.layoutKind)?this.logger.warn("Layout kind is already defined: ",t.layoutKind):this.register(t.layoutKind,t.factory())})}};oa([(0,mr.inject)(sa.TYPES.ILogger),td("design:type",Object)],ia.prototype,"logger",void 0);ia=oa([(0,mr.injectable)(),AS(0,(0,mr.multiInject)(sa.TYPES.LayoutRegistration)),AS(0,(0,mr.optional)()),td("design:paramtypes",[Array])],ia);tt.LayoutRegistry=ia;var ra=class{layout(e){new ed(e,this.layoutRegistry,this.logger).layout()}};oa([(0,mr.inject)(sa.TYPES.LayoutRegistry),td("design:type",ia)],ra.prototype,"layoutRegistry",void 0);oa([(0,mr.inject)(sa.TYPES.ILogger),td("design:type",Object)],ra.prototype,"logger",void 0);ra=oa([(0,mr.injectable)()],ra);tt.Layouter=ra;var ed=class{constructor(e,t,n){this.element2boundsData=e,this.layoutRegistry=t,this.log=n,this.toBeLayouted=[],e.forEach((r,o)=>{(0,CS.isLayoutContainer)(o)&&this.toBeLayouted.push(o)})}getBoundsData(e){let t=this.element2boundsData.get(e),n=e.bounds;return(0,CS.isLayoutContainer)(e)&&this.toBeLayouted.indexOf(e)>=0&&(n=this.doLayout(e)),t||(t={bounds:n,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(e,t)),t}layout(){for(;this.toBeLayouted.length>0;){let e=this.toBeLayouted[0];this.doLayout(e)}}doLayout(e){let t=this.toBeLayouted.indexOf(e);t>=0&&this.toBeLayouted.splice(t,1);let n=this.layoutRegistry.get(e.layout);n&&n.layout(e,this);let r=this.element2boundsData.get(e);return r!==void 0&&r.bounds!==void 0?r.bounds:(this.log.error(e,"Layout failed"),xC.Bounds.EMPTY)}};tt.StatefulLayouter=ed;function jC(i,e,t){if(typeof t=="function"){if(!(0,qC.isInjectable)(t))throw new Error(`Layouts be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(sa.TYPES.LayoutRegistration).toDynamicValue(n=>({layoutKind:e,factory:()=>n.container.get(t)}))}tt.configureLayout=jC});var mp=f(On=>{"use strict";var id=On&&On.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},pp=On&&On.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(On,"__esModule",{value:!0});On.HiddenBoundsUpdater=On.BoundsData=void 0;var rd=_(),xS=te(),yr=Q(),DS=G(),gp=P(),NC=nd(),aa=ae(),hp=class{};On.BoundsData=hp;var wo=class{constructor(){this.element2boundsData=new Map}decorate(e,t){return((0,aa.isSizeable)(t)||(0,aa.isLayoutContainer)(t))&&this.element2boundsData.set(t,{vnode:e,bounds:t.bounds,boundsChanged:!1,alignmentChanged:!1}),t instanceof DS.SModelRoot&&(this.root=t),e}postUpdate(e){if(e===void 0||e.kind!==xS.RequestBoundsAction.KIND)return;let t=e;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);let n=[],r=[];this.element2boundsData.forEach((s,a)=>{if(s.boundsChanged&&s.bounds!==void 0){let c={elementId:a.id,newSize:{width:s.bounds.width,height:s.bounds.height}};a instanceof DS.SChildElement&&(0,aa.isLayoutContainer)(a.parent)&&(c.newPosition={x:s.bounds.x,y:s.bounds.y}),n.push(c)}s.alignmentChanged&&s.alignment!==void 0&&r.push({elementId:a.id,newAlignment:s.alignment})});let o=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(xS.ComputedBoundsAction.create(n,{revision:o,alignments:r,requestId:t.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((e,t)=>{if(e.bounds&&(0,aa.isSizeable)(t)){let n=e.vnode;if(n&&n.elm){let r=this.getBounds(n.elm,t);(0,aa.isAlignable)(t)&&!((0,yr.almostEquals)(r.x,0)&&(0,yr.almostEquals)(r.y,0))&&(e.alignment={x:-r.x,y:-r.y},e.alignmentChanged=!0);let o={x:t.bounds.x,y:t.bounds.y,width:r.width,height:r.height};(0,yr.almostEquals)(o.x,t.bounds.x)&&(0,yr.almostEquals)(o.y,t.bounds.y)&&(0,yr.almostEquals)(o.width,t.bounds.width)&&(0,yr.almostEquals)(o.height,t.bounds.height)||(e.bounds=o,e.boundsChanged=!0)}}})}getBounds(e,t){if(typeof e.getBBox!="function")return this.logger.error(this,"Not an SVG element:",e),yr.Bounds.EMPTY;let n=e.getBBox();return{x:n.x,y:n.y,width:n.width,height:n.height}}};id([(0,rd.inject)(gp.TYPES.ILogger),pp("design:type",Object)],wo.prototype,"logger",void 0);id([(0,rd.inject)(gp.TYPES.IActionDispatcher),pp("design:type",Object)],wo.prototype,"actionDispatcher",void 0);id([(0,rd.inject)(gp.TYPES.Layouter),pp("design:type",NC.Layouter)],wo.prototype,"layouter",void 0);wo=id([(0,rd.injectable)()],wo);On.HiddenBoundsUpdater=wo});var od=f(Po=>{"use strict";var LC=Po&&Po.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Po,"__esModule",{value:!0});Po.AbstractLayout=void 0;var yp=Q(),qS=G(),_p=ae(),BC=_(),vp=class{layout(e,t){let n=t.getBoundsData(e),r=this.getLayoutOptions(e),o=this.getChildrenSize(e,r,t),s=r.paddingFactor*(r.resizeContainer?o.width:Math.max(0,this.getFixedContainerBounds(e,r,t).width)-r.paddingLeft-r.paddingRight),a=r.paddingFactor*(r.resizeContainer?o.height:Math.max(0,this.getFixedContainerBounds(e,r,t).height)-r.paddingTop-r.paddingBottom);if(s>0&&a>0){let c=this.layoutChildren(e,t,r,s,a);n.bounds=this.getFinalContainerBounds(e,c,r,s,a),n.boundsChanged=!0}}getFinalContainerBounds(e,t,n,r,o){return{x:e.bounds.x,y:e.bounds.y,width:Math.max(n.minWidth,r+n.paddingLeft+n.paddingRight),height:Math.max(n.minHeight,o+n.paddingTop+n.paddingBottom)}}getFixedContainerBounds(e,t,n){let r=e;for(;;){if((0,_p.isBoundsAware)(r)){let o=r.bounds;if((0,_p.isLayoutContainer)(r)&&t.resizeContainer&&n.log.error(r,"Resizable container found while detecting fixed bounds"),yp.Dimension.isValid(o))return o}if(r instanceof qS.SChildElement)r=r.parent;else return n.log.error(r,"Cannot detect fixed bounds"),yp.Bounds.EMPTY}}layoutChildren(e,t,n,r,o){let s={x:n.paddingLeft+.5*(r-r/n.paddingFactor),y:n.paddingTop+.5*(o-o/n.paddingFactor)};return e.children.forEach(a=>{if((0,_p.isLayoutableChild)(a)){let c=t.getBoundsData(a),u=c.bounds,d=this.getChildLayoutOptions(a,n);u!==void 0&&yp.Dimension.isValid(u)&&(s=this.layoutChild(a,c,u,d,n,s,r,o))}}),s}getDx(e,t,n){switch(e){case"left":return 0;case"center":return .5*(n-t.width);case"right":return n-t.width}}getDy(e,t,n){switch(e){case"top":return 0;case"center":return .5*(n-t.height);case"bottom":return n-t.height}}getChildLayoutOptions(e,t){let n=e.layoutOptions;return n===void 0?t:this.spread(t,n)}getLayoutOptions(e){let t=e,n=[];for(;t!==void 0;){let r=t.layoutOptions;if(r!==void 0&&n.push(r),t instanceof qS.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>this.spread(r,o),this.getDefaultLayoutOptions())}};vp=LC([(0,BC.injectable)()],vp);Po.AbstractLayout=vp});var bp=f(Io=>{"use strict";var FC=Io&&Io.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Io,"__esModule",{value:!0});Io.VBoxLayouter=void 0;var VC=_(),KC=Q(),HC=od(),zC=ae(),sd=class extends HC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=0,s=!0;return e.children.forEach(a=>{if((0,zC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&KC.Dimension.isValid(c)&&(o+=c.height,s?s=!1:o+=t.vGap,r=Math.max(r,c.width))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:s.y+e.bounds.y-n.y,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x,y:s.y+n.height+o.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};sd.KIND="vbox";sd=FC([(0,VC.injectable)()],sd);Io.VBoxLayouter=sd});var Sp=f(Ro=>{"use strict";var YC=Ro&&Ro.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ro,"__esModule",{value:!0});Ro.HBoxLayouter=void 0;var kC=_(),UC=Q(),GC=od(),WC=ae(),ad=class extends GC.AbstractLayout{getChildrenSize(e,t,n){let r=0,o=-1,s=!0;return e.children.forEach(a=>{if((0,WC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&UC.Dimension.isValid(c)&&(s?s=!1:r+=t.hGap,r+=c.width,o=Math.max(o,c.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDy(r.vAlign,n,c);return t.bounds={x:s.x+e.bounds.x-n.x,y:o.paddingTop+e.bounds.y-n.y+u,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x+n.width+o.hGap,y:s.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};ad.KIND="hbox";ad=YC([(0,kC.injectable)()],ad);Ro.HBoxLayouter=ad});var Ep=f(Mo=>{"use strict";var $C=Mo&&Mo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Mo,"__esModule",{value:!0});Mo.StackLayouter=void 0;var XC=_(),JC=Q(),ZC=od(),QC=ae(),cd=class extends ZC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=-1;return e.children.forEach(s=>{if((0,QC.isLayoutableChild)(s)){let a=n.getBoundsData(s).bounds;a!==void 0&&JC.Dimension.isValid(a)&&(r=Math.max(r,a.width),o=Math.max(o,a.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a),d=this.getDy(r.vAlign,n,c);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:o.paddingTop+e.bounds.y-n.y+d,width:n.width,height:n.height},t.boundsChanged=!0,s}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};cd.KIND="stack";cd=$C([(0,XC.injectable)()],cd);Mo.StackLayouter=cd});var ca=f(Oo=>{"use strict";var ex=Oo&&Oo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.ShapeView=void 0;var tx=_(),nx=Q(),ix=ae(),wp=class{isVisible(e,t){if(t.targetKind==="hidden"||!nx.Dimension.isValid(e.bounds))return!0;let n=(0,ix.getAbsoluteBounds)(e),r=e.root.canvasBounds;return n.x<=r.width&&n.x+n.width>=0&&n.y<=r.height&&n.y+n.height>=0}};wp=ex([(0,tx.injectable)()],wp);Oo.ShapeView=wp});var da=f($t=>{"use strict";var rx=$t&&$t.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ox=$t&&$t.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},ud=$t&&$t.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty($t,"__esModule",{value:!0});$t.configureButtonHandler=$t.ButtonHandlerRegistry=void 0;var ua=_(),sx=wn(),Pp=P(),ax=rr(),Ip=class extends sx.InstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.TYPE,n.factory())),t.forEach(n=>this.register(n.TYPE,new n))}};Ip=rx([(0,ua.injectable)(),ud(0,(0,ua.multiInject)(Pp.TYPES.IButtonHandlerRegistration)),ud(0,(0,ua.optional)()),ud(1,(0,ua.multiInject)(Pp.TYPES.IButtonHandler)),ud(1,(0,ua.optional)()),ox("design:paramtypes",[Array,Array])],Ip);$t.ButtonHandlerRegistry=Ip;function cx(i,e,t){if(typeof t=="function"){if(!(0,ax.isInjectable)(t))throw new Error(`Button handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(Pp.TYPES.IButtonHandlerRegistration).toDynamicValue(n=>({TYPE:e,factory:()=>n.container.get(t)}))}$t.configureButtonHandler=cx});var To=f(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.isFadeable=_r.fadeFeature=void 0;_r.fadeFeature=Symbol("fadeFeature");function ux(i){return i.hasFeature(_r.fadeFeature)&&i.opacity!==void 0}_r.isFadeable=ux});var fd=f(ld=>{"use strict";Object.defineProperty(ld,"__esModule",{value:!0});ld.SButton=void 0;var Rp=ae(),dx=To(),dd=class extends Rp.SShapeElement{constructor(){super(...arguments),this.enabled=!0}};ld.SButton=dd;dd.DEFAULT_FEATURES=[Rp.boundsFeature,Rp.layoutableChildFeature,dx.fadeFeature]});var Mp=f(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});Zn.name=Zn.isNameable=Zn.nameFeature=void 0;Zn.nameFeature=Symbol("nameableFeature");function jS(i){return i.hasFeature(Zn.nameFeature)}Zn.isNameable=jS;function lx(i){if(jS(i))return i.name}Zn.name=lx});var hd=f(Xt=>{"use strict";var BS=Xt&&Xt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},FS=Xt&&Xt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Tp=Xt&&Xt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.RevealNamedElementActionProvider=Xt.CommandPaletteActionProviderRegistry=void 0;var la=_(),Op=te(),NS=hc(),VS=P(),fx=tr(),LS=Mp(),Ap=class{constructor(e=[]){this.actionProviders=e}getActions(e,t,n,r){let o=this.actionProviders.map(s=>s.getActions(e,t,n,r));return Promise.all(o).then(s=>s.reduce((a,c)=>c!==void 0?a.concat(c):a))}};Ap=BS([(0,la.injectable)(),Tp(0,(0,la.multiInject)(VS.TYPES.ICommandPaletteActionProvider)),Tp(0,(0,la.optional)()),FS("design:paramtypes",[Array])],Ap);Xt.CommandPaletteActionProviderRegistry=Ap;var Cp=class{constructor(e){this.logger=e}getActions(e,t,n,r){return r!==void 0&&r%2===0?Promise.resolve(this.createSelectActions(e)):Promise.resolve([new NS.LabeledAction("Select all",[Op.SelectAllAction.create()])])}createSelectActions(e){return(0,fx.toArray)(e.index.all().filter(n=>(0,LS.isNameable)(n))).map(n=>new NS.LabeledAction(`Reveal ${(0,LS.name)(n)}`,[Op.SelectAction.create({selectedElementsIDs:[n.id]}),Op.CenterAction.create([n.id])],"eye"))}};Cp=BS([(0,la.injectable)(),Tp(0,(0,la.inject)(VS.TYPES.ILogger)),FS("design:paramtypes",[Object])],Cp);Xt.RevealNamedElementActionProvider=Cp});var xp=f(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.codiconCSSClasses=Jt.codiconCSSString=Jt.ANIMATION_SPIN=Jt.ACTION_ITEM=void 0;Jt.ACTION_ITEM="action-item";Jt.ANIMATION_SPIN="animation-spin";function hx(i,e=!1,t=!1,n=[]){return KS(i,e,t,n).join(" ")}Jt.codiconCSSString=hx;function KS(i,e=!1,t=!1,n=[]){let r=["codicon",`codicon-${i}`];return e&&r.push(Jt.ACTION_ITEM),t&&r.push(Jt.ANIMATION_SPIN),n.length>0&&r.push(...n),r}Jt.codiconCSSClasses=KS});var Et=f(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.isSelected=Qn.isSelectable=Qn.selectFeature=void 0;Qn.selectFeature=Symbol("selectFeature");function HS(i){return i.hasFeature(Qn.selectFeature)}Qn.isSelectable=HS;function px(i){return i!==void 0&&HS(i)&&i.selected}Qn.isSelected=px});var zS=f((Dp,qp)=>{(function(i,e){typeof Dp=="object"&&typeof qp<"u"?qp.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self,i.autocomplete=e())})(Dp,function(){"use strict";function i(e){var t=document,n=e.container||t.createElement("div");n.id=n.id||"autocomplete-"+O();var r=n.style,o=e.debounceWaitMs||0,s=e.preventSubmit||!1,a=e.disableAutoSelect||!1,c=[],u="",d=2,l=e.showOnFocus,S,R=0,v;if(e.minLength!==void 0&&(d=e.minLength),!e.input)throw new Error("input undefined");var m=e.input;n.className="autocomplete "+(e.className||""),n.setAttribute("role","listbox"),m.setAttribute("role","combobox"),m.setAttribute("aria-expanded","false"),m.setAttribute("aria-autocomplete","list"),m.setAttribute("aria-controls",n.id),m.setAttribute("aria-owns",n.id),m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-haspopup","listbox"),r.position="absolute";function O(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function A(){var N=n.parentNode;N&&N.removeChild(n)}function K(){v&&window.clearTimeout(v)}function U(){n.parentNode||t.body.appendChild(n)}function D(){return!!n.parentNode}function F(){R++,c=[],u="",S=void 0,m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-expanded","false"),A()}function H(){if(!D())return;m.setAttribute("aria-expanded","true"),r.height="auto",r.width=m.offsetWidth+"px";var N=0,q;function se(){var qe=t.documentElement,k=qe.clientTop||t.body.clientTop||0,Fe=qe.clientLeft||t.body.clientLeft||0,ci=window.pageYOffset||qe.scrollTop,sn=window.pageXOffset||qe.scrollLeft;q=m.getBoundingClientRect();var We=q.top+m.offsetHeight+ci-k,ot=q.left+sn-Fe;r.top=We+"px",r.left=ot+"px",N=window.innerHeight-(q.top+m.offsetHeight),N<0&&(N=0),r.top=We+"px",r.bottom="",r.left=ot+"px",r.maxHeight=N+"px"}se(),se(),e.customize&&q&&e.customize(m,q,n,N)}function W(){for(;n.firstChild;)n.removeChild(n.firstChild);m.setAttribute("aria-activedescendant","");var N=function(Fe,ci,sn){var We=t.createElement("div");return We.textContent=Fe.label||"",We};e.render&&(N=e.render);var q=function(Fe,ci){var sn=t.createElement("div");return sn.textContent=Fe,sn};e.renderGroup&&(q=e.renderGroup);var se=t.createDocumentFragment(),qe="#9?$";if(c.forEach(function(Fe,ci){if(Fe.group&&Fe.group!==qe){qe=Fe.group;var sn=q(Fe.group,u);sn&&(sn.className+=" group",se.appendChild(sn))}var We=N(Fe,u,ci);We&&(We.id=n.id+"_"+ci,We.setAttribute("role","option"),We.addEventListener("click",function(ot){e.onSelect(Fe,m),F(),ot.preventDefault(),ot.stopPropagation()}),Fe===S&&(We.className+=" selected",We.setAttribute("aria-selected","true"),m.setAttribute("aria-activedescendant",We.id)),se.appendChild(We))}),n.appendChild(se),c.length<1)if(e.emptyMsg){var k=t.createElement("div");k.id=n.id+"_"+O(),k.className="empty",k.textContent=e.emptyMsg,n.appendChild(k),m.setAttribute("aria-activedescendant",k.id)}else{F();return}U(),H(),_e()}function z(){D()&&W()}function oe(){z()}function we(N){N.target!==n?z():N.preventDefault()}function le(N){for(var q=N.which||N.keyCode||0,se=e.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9],qe=0,k=se;qe<k.length;qe++){var Fe=k[qe];if(q===Fe)return}q>=112&&q<=123&&!e.keysToIgnore||q===40&&D()||Rs(0)}function _e(){var N=n.getElementsByClassName("selected");if(N.length>0){var q=N[0],se=q.previousElementSibling;if(se&&se.className.indexOf("group")!==-1&&!se.previousElementSibling&&(q=se),q.offsetTop<n.scrollTop)n.scrollTop=q.offsetTop;else{var qe=q.offsetTop+q.offsetHeight,k=n.scrollTop+n.offsetHeight;qe>k&&(n.scrollTop+=qe-k)}}}function Ge(){if(c.length<1)S=void 0;else if(S===c[0])S=c[c.length-1];else for(var N=c.length-1;N>0;N--)if(S===c[N]||N===1){S=c[N-1];break}}function yn(){if(c.length<1&&(S=void 0),!S||S===c[c.length-1]){S=c[0];return}for(var N=0;N<c.length-1;N++)if(S===c[N]){S=c[N+1];break}}function ai(N){var q=N.which||N.keyCode||0;if(q===38||q===40||q===27){var se=D();if(q===27)F();else{if(!se||c.length<1)return;q===38?Ge():yn(),W()}N.preventDefault(),se&&N.stopPropagation();return}q===13&&(S&&(e.onSelect(S,m),F()),s&&N.preventDefault())}function Is(){l&&Rs(1)}function Rs(N){var q=++R,se=m.value,qe=m.selectionStart||0;se.length>=d||N===1?(K(),v=window.setTimeout(function(){e.fetch(se,function(k){R===q&&k&&(c=k,u=se,S=c.length<1||a?void 0:c[0],W())},N,qe)},N===0?o:0)):F()}function Ms(){setTimeout(function(){t.activeElement!==m&&F()},200)}n.addEventListener("mousedown",function(N){N.stopPropagation(),N.preventDefault()}),n.addEventListener("focus",function(){return m.focus()});function dc(){m.removeEventListener("focus",Is),m.removeEventListener("keydown",ai),m.removeEventListener("keyup",le),m.removeEventListener("blur",Ms),window.removeEventListener("resize",oe),t.removeEventListener("scroll",we,!0),m.removeAttribute("role"),m.removeAttribute("aria-expanded"),m.removeAttribute("aria-autocomplete"),m.removeAttribute("aria-controls"),m.removeAttribute("aria-activedescendant"),m.removeAttribute("aria-owns"),m.removeAttribute("aria-haspopup"),K(),F()}return m.addEventListener("keydown",ai),m.addEventListener("keyup",le),m.addEventListener("blur",Ms),m.addEventListener("focus",Is),window.addEventListener("resize",oe),t.addEventListener("scroll",we,!0),{destroy:dc}}return i})});var Bp=f(Zt=>{"use strict";var Ao=Zt&&Zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},fa=Zt&&Zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},gx=Zt&&Zt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},pd;Object.defineProperty(Zt,"__esModule",{value:!0});Zt.CommandPaletteKeyListener=Zt.CommandPalette=void 0;var Co=_(),mx=te(),yx=hc(),gd=P(),_x=Au(),YS=ks(),vx=so(),bx=an(),kS=xp(),jp=tr(),Lp=Rn(),US=ae(),WS=Et(),Sx=hd(),GS=Tt(),Ex=gx(zS()),xt=pd=class extends _x.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,kS.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return pd.ID}containerClass(){return"command-palette"}show(e,...t){super.show(e,...t),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,Ex.default)(this.autocompleteSettings(e)),this.inputElement.focus()}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",t=>this.hideIfEscapeEvent(t)),this.inputElement.addEventListener("keydown",t=>this.cylceIfInvokePaletteKey(t)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),e.appendChild(this.inputElement)}hideIfEscapeEvent(e){(0,Lp.matchesKeystroke)(e,"Escape")&&this.hide()}cylceIfInvokePaletteKey(e){pd.isInvokePaletteKey(e)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(e,t,...n){let r=this.xOffset,o=this.yOffset,s=(0,jp.toArray)(t.index.all().filter(a=>(0,WS.isSelectable)(a)&&a.selected));if(s.length===1){let a=(0,US.getAbsoluteClientBounds)(s[0],this.domHelper,this.viewerOptions);r+=a.x+a.width,o+=a.y}else{let a=(0,US.getAbsoluteClientBounds)(t,this.domHelper,this.viewerOptions);r+=a.x,o+=a.y}e.style.left=`${r}px`,e.style.top=`${o}px`,e.style.width=`${this.defaultWidth}px`}autocompleteSettings(e){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(t,n)=>this.updateAutoCompleteActions(n,t,e),onSelect:t=>this.onSelect(t),render:(t,n)=>this.renderLabeledActionSuggestion(t,n),customize:(t,n,r,o)=>{this.customizeSuggestionContainer(r,n,o)}}}onSelect(e){this.executeAction(e),this.hide()}updateAutoCompleteActions(e,t,n){this.onLoading(),this.contextActions?(e(this.filterActions(t,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(n,t,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(r=>{this.contextActions=r,e(this.filterActions(t,r)),this.onLoaded("success")}).catch(r=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",r),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(e){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(e,t){let n=document.createElement("div"),r=Px(t).split(" ").join("|"),o=new RegExp(r,"gi");return e.icon&&this.renderIcon(n,e.icon),t.length>0?n.innerHTML+=e.label.replace(o,s=>"<em>"+s+"</em>").replace(/ /g,"&nbsp;"):n.innerHTML+=e.label.replace(/ /g,"&nbsp;"),n}renderIcon(e,t){e.innerHTML+=`<span class="icon ${this.getCodicon(t)}"></span>`}getFontAwesomeIcon(e){return`fa fa-${e}`}getCodicon(e){return(0,kS.codiconCSSString)(e)}filterActions(e,t){return(0,jp.toArray)(t.filter(n=>{let r=n.label.toLowerCase();return e.split(" ").every(s=>r.indexOf(s.toLowerCase())!==-1)}))}customizeSuggestionContainer(e,t,n){this.containerElement&&this.containerElement.appendChild(e)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(e){this.actionDispatcherProvider().then(t=>t.dispatchAll(wx(e))).catch(t=>this.logger.error(this,"No action dispatcher available to execute command palette action",t))}};xt.ID="command-palette";xt.isInvokePaletteKey=i=>(0,Lp.matchesKeystroke)(i,"Space","ctrl");Ao([(0,Co.inject)(gd.TYPES.IActionDispatcherProvider),fa("design:type",Function)],xt.prototype,"actionDispatcherProvider",void 0);Ao([(0,Co.inject)(gd.TYPES.ICommandPaletteActionProviderRegistry),fa("design:type",Sx.CommandPaletteActionProviderRegistry)],xt.prototype,"actionProviderRegistry",void 0);Ao([(0,Co.inject)(gd.TYPES.ViewerOptions),fa("design:type",Object)],xt.prototype,"viewerOptions",void 0);Ao([(0,Co.inject)(gd.TYPES.DOMHelper),fa("design:type",vx.DOMHelper)],xt.prototype,"domHelper",void 0);Ao([(0,Co.inject)(GS.MousePositionTracker),fa("design:type",GS.MousePositionTracker)],xt.prototype,"mousePositionTracker",void 0);xt=pd=Ao([(0,Co.injectable)()],xt);Zt.CommandPalette=xt;function wx(i){return(0,yx.isLabeledAction)(i)?i.actions:(0,mx.isAction)(i)?[i]:[]}function Px(i){return i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var Np=class extends bx.KeyListener{keyDown(e,t){if((0,Lp.matchesKeystroke)(t,"Escape"))return[YS.SetUIExtensionVisibilityAction.create({extensionId:xt.ID,visible:!1,contextElementsId:[]})];if(xt.isInvokePaletteKey(t)){let n=(0,jp.toArray)(e.index.all().filter(r=>(0,WS.isSelectable)(r)&&r.selected).map(r=>r.id));return[YS.SetUIExtensionVisibilityAction.create({extensionId:xt.ID,visible:!0,contextElementsId:n})]}return[]}};Zt.CommandPaletteKeyListener=Np});var $S=f(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.toAnchor=void 0;function Ix(i){return i instanceof HTMLElement?{x:i.offsetLeft,y:i.offsetTop}:i}md.toAnchor=Ix});var xo=f(Re=>{"use strict";var Rx=Re&&Re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Mx=Re&&Re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Ox=Re&&Re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Re,"__esModule",{value:!0});Re.DeleteElementCommand=Re.ResolvedDelete=Re.DeleteElementAction=Re.isDeletable=Re.deletableFeature=void 0;var XS=_(),Tx=pe(),Ax=G(),Cx=P();Re.deletableFeature=Symbol("deletableFeature");function JS(i){return i instanceof Ax.SChildElement&&i.hasFeature(Re.deletableFeature)}Re.isDeletable=JS;var ZS;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(ZS=Re.DeleteElementAction||(Re.DeleteElementAction={}));var Fp=class{};Re.ResolvedDelete=Fp;var yd=class extends Tx.Command{constructor(e){super(),this.action=e,this.resolvedDeletes=[]}execute(e){let t=e.root.index;for(let n of this.action.elementIds){let r=t.getById(n);r&&JS(r)&&(this.resolvedDeletes.push({child:r,parent:r.parent}),r.parent.remove(r))}return e.root}undo(e){for(let t of this.resolvedDeletes)t.parent.add(t.child);return e.root}redo(e){for(let t of this.resolvedDeletes)t.parent.remove(t.child);return e.root}};yd.KIND=ZS.KIND;yd=Rx([(0,XS.injectable)(),Ox(0,(0,XS.inject)(Cx.TYPES.Action)),Mx("design:paramtypes",[Object])],yd);Re.DeleteElementCommand=yd});var vd=f(Qt=>{"use strict";var e0=Qt&&Qt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},xx=Qt&&Qt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},QS=Qt&&Qt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.DeleteContextMenuItemProvider=Qt.ContextMenuProviderRegistry=void 0;var _d=_(),Dx=P(),qx=xo(),jx=Et(),Nx=ur(),Vp=class{constructor(e=[]){this.menuProviders=e}getItems(e,t){let n=this.menuProviders.map(r=>r.getItems(e,t));return Promise.all(n).then(this.flattenAndRestructure)}flattenAndRestructure(e){let t=e.reduce((r,o)=>o!==void 0?r.concat(o):r,[]),n=t.filter(r=>r.parentId);for(let r of n)if(r.parentId){let o=r.parentId.split("."),s,a=t;for(let c of o)s=a.find(u=>c===u.id),s&&s.children&&(a=s.children);s&&(s.children?s.children.push(r):s.children=[r],t=t.filter(c=>c!==r))}return t}};Vp=e0([(0,_d.injectable)(),QS(0,(0,_d.multiInject)(Dx.TYPES.IContextMenuItemProvider)),QS(0,(0,_d.optional)()),xx("design:paramtypes",[Array])],Vp);Qt.ContextMenuProviderRegistry=Vp;var Kp=class{getItems(e,t){let n=Array.from(e.index.all().filter(jx.isSelected).filter(qx.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[Nx.DeleteElementAction.create(n.map(r=>r.id))],isEnabled:()=>n.length>0}])}};Kp=e0([(0,_d.injectable)()],Kp);Qt.DeleteContextMenuItemProvider=Kp});var Yp=f(Tn=>{"use strict";var n0=Tn&&Tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},i0=Tn&&Tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},t0=Tn&&Tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Tn,"__esModule",{value:!0});Tn.ContextMenuMouseListener=void 0;var Hp=_(),Lx=te(),Bx=vd(),Fx=Tt(),zp=P(),bd=Et(),Vx=Ke(),Sd=class extends Fx.MouseListener{constructor(e,t){super(),this.contextMenuService=e,this.menuProvider=t}contextMenu(e,t){return this.showContextMenu(e,t),[]}async showContextMenu(e,t){let n;try{n=await this.contextMenuService()}catch{return}let r={x:t.x,y:t.y},o=e.root,s=e.id,a=!1,c=(0,Vx.findParentByFeature)(e,bd.isSelectable);c&&(a=c.selected,c.selected=!0);let u=()=>{c&&(c.selected=a)};if((0,bd.isSelectable)(e))if((0,bd.isSelected)(e)){let d=await this.menuProvider.getItems(e.root,r);n.show(d,r,u)}else{let d={selectedElementsIDs:[s],deselectedElementsIDs:Array.from(o.index.all().filter(bd.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(Lx.SelectAction.create(d));let l=await this.menuProvider.getItems(o,r);n.show(l,r)}}};n0([(0,Hp.inject)(zp.TYPES.IActionDispatcher),i0("design:type",Object)],Sd.prototype,"actionDispatcher",void 0);Sd=n0([t0(0,(0,Hp.inject)(zp.TYPES.IContextMenuServiceProvider)),t0(1,(0,Hp.inject)(zp.TYPES.IContextMenuProviderRegistry)),i0("design:paramtypes",[Function,Bx.ContextMenuProviderRegistry])],Sd);Tn.ContextMenuMouseListener=Sd});var vr=f(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});en.hasPopupFeature=en.popupFeature=en.isHoverable=en.hoverFeedbackFeature=void 0;en.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function Kx(i){return i.hasFeature(en.hoverFeedbackFeature)}en.isHoverable=Kx;en.popupFeature=Symbol("popupFeature");function Hx(i){return i.hasFeature(en.popupFeature)}en.hasPopupFeature=Hx});var Ti=f(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.isMoveable=ei.isLocateable=ei.moveFeature=void 0;ei.moveFeature=Symbol("moveFeature");function r0(i){return i.position!==void 0}ei.isLocateable=r0;function zx(i){return i.hasFeature(ei.moveFeature)&&r0(i)}ei.isMoveable=zx});var me=f(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.edgeInProgressTargetHandleID=fe.edgeInProgressID=fe.SDanglingAnchor=fe.SRoutingHandle=fe.SConnectableElement=fe.getRouteBounds=fe.getAbsoluteRouteBounds=fe.isConnectable=fe.connectableFeature=fe.SRoutableElement=void 0;var o0=Q(),kp=G(),Yx=ae(),kx=xo(),Ux=Et(),Gx=vr(),Wx=Ti(),ha=class extends kp.SChildElement{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((e,t)=>o0.Bounds.combine(e,{x:t.x,y:t.y,width:0,height:0}),o0.Bounds.EMPTY)}};fe.SRoutableElement=ha;fe.connectableFeature=Symbol("connectableFeature");function $x(i){return i.hasFeature(fe.connectableFeature)&&i.canConnect}fe.isConnectable=$x;function Xx(i,e=i.routingPoints){let t=s0(e),n=i;for(;n instanceof kp.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}fe.getAbsoluteRouteBounds=Xx;function s0(i){let e={x:NaN,y:NaN,width:0,height:0};for(let t of i)isNaN(e.x)?(e.x=t.x,e.y=t.y):(t.x<e.x?(e.width+=e.x-t.x,e.x=t.x):t.x>e.x+e.width&&(e.width=t.x-e.x),t.y<e.y?(e.height+=e.y-t.y,e.y=t.y):t.y>e.y+e.height&&(e.height=t.y-e.y));return e}fe.getRouteBounds=s0;var Ed=class extends Yx.SShapeElement{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(t=>t instanceof ha).filter(t=>t.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(t=>t instanceof ha).filter(t=>t.sourceId===this.id)}canConnect(e,t){return!0}};fe.SConnectableElement=Ed;var Do=class extends kp.SChildElement{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(e){return Do.DEFAULT_FEATURES.indexOf(e)!==-1}};fe.SRoutingHandle=Do;Do.DEFAULT_FEATURES=[Ux.selectFeature,Wx.moveFeature,Gx.hoverFeedbackFeature];var wd=class extends Ed{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}};fe.SDanglingAnchor=wd;wd.DEFAULT_FEATURES=[kx.deletableFeature];fe.edgeInProgressID="edge-in-progress";fe.edgeInProgressTargetHandleID=fe.edgeInProgressID+"-target-anchor"});var qo=f(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.DEFAULT_EDGE_PLACEMENT=dn.EdgePlacement=dn.isEdgeLayoutable=dn.edgeLayoutFeature=void 0;var Jx=G(),Zx=ae(),Qx=me();dn.edgeLayoutFeature=Symbol("edgeLayout");function e1(i){return i instanceof Jx.SChildElement&&i.parent instanceof Qx.SRoutableElement&&t1(i)&&(0,Zx.isBoundsAware)(i)&&i.hasFeature(dn.edgeLayoutFeature)}dn.isEdgeLayoutable=e1;function t1(i){return"edgePlacement"in i}var Up=class extends Object{};dn.EdgePlacement=Up;dn.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}});var jo=f(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.isWithEditableLabel=He.withEditLabelFeature=He.isEditableLabel=He.editLabelFeature=He.canEditRouting=He.editFeature=void 0;var n1=me();He.editFeature=Symbol("editFeature");function i1(i){return i instanceof n1.SRoutableElement&&i.hasFeature(He.editFeature)}He.canEditRouting=i1;He.editLabelFeature=Symbol("editLabelFeature");function r1(i){return"text"in i&&i.hasFeature(He.editLabelFeature)}He.isEditableLabel=r1;He.withEditLabelFeature=Symbol("withEditLabelFeature");function o1(i){return"editableLabel"in i&&i.hasFeature(He.withEditLabelFeature)}He.isWithEditableLabel=o1});var An=f(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.isViewport=br.viewportFeature=void 0;var s1=G();br.viewportFeature=Symbol("viewportFeature");function a1(i){return i instanceof s1.SModelRoot&&i.hasFeature(br.viewportFeature)&&"zoom"in i&&"scroll"in i}br.isViewport=a1});var Pd=f(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.isExportable=Sr.exportFeature=void 0;Sr.exportFeature=Symbol("exportFeature");function c1(i){return i.hasFeature(Sr.exportFeature)}Sr.isExportable=c1});var Md=f(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.ViewportRootElement=void 0;var pa=Q(),u1=G(),d1=An(),l1=Pd(),Id=class extends u1.SModelRoot{constructor(e){super(e),this.scroll={x:0,y:0},this.zoom=1,this.position=pa.Point.ORIGIN,this.size=pa.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:(e.x-this.scroll.x)*this.zoom,y:(e.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,pa.isBounds)(e)&&(t.width=e.width*this.zoom,t.height=e.height*this.zoom),t}parentToLocal(e){let t={x:e.x/this.zoom+this.scroll.x,y:e.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,pa.isBounds)(e)&&pa.Dimension.isValid(e)&&(t.width=e.width/this.zoom,t.height=e.height/this.zoom),t}};Rd.ViewportRootElement=Id;Id.DEFAULT_FEATURES=[d1.viewportFeature,l1.exportFeature]});var Er=f(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.SGraphIndex=nt.SCompartment=nt.SLabel=nt.SEdge=nt.SPort=nt.SNode=nt.SGraph=void 0;var f1=Q(),h1=G(),ln=ae(),p1=qo(),a0=xo(),g1=jo(),ma=To(),Od=vr(),m1=Ti(),ya=me(),Wp=Et(),y1=Md(),_1=tr(),Gp=class extends y1.ViewportRootElement{constructor(e=new Ai){super(e)}};nt.SGraph=Gp;var Td=class extends ya.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(e,t){return this.children.find(n=>n instanceof ga)===void 0}get incomingEdges(){let e=this.index;return e instanceof Ai?e.getIncomingEdges(this):this.index.all().filter(n=>n instanceof Cn).filter(n=>n.targetId===this.id)}get outgoingEdges(){let e=this.index;return e instanceof Ai?e.getOutgoingEdges(this):this.index.all().filter(n=>n instanceof Cn).filter(n=>n.sourceId===this.id)}};nt.SNode=Td;Td.DEFAULT_FEATURES=[ya.connectableFeature,a0.deletableFeature,Wp.selectFeature,ln.boundsFeature,m1.moveFeature,ln.layoutContainerFeature,ma.fadeFeature,Od.hoverFeedbackFeature,Od.popupFeature];var ga=class extends ya.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){let e=this.index;return e instanceof Ai?e.getIncomingEdges(this):super.incomingEdges.filter(t=>t instanceof Cn)}get outgoingEdges(){let e=this.index;return e instanceof Ai?e.getOutgoingEdges(this):super.outgoingEdges.filter(t=>t instanceof Cn)}};nt.SPort=ga;ga.DEFAULT_FEATURES=[ya.connectableFeature,Wp.selectFeature,ln.boundsFeature,ma.fadeFeature,Od.hoverFeedbackFeature];var Cn=class extends ya.SRoutableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}};nt.SEdge=Cn;Cn.DEFAULT_FEATURES=[g1.editFeature,a0.deletableFeature,Wp.selectFeature,ma.fadeFeature,Od.hoverFeedbackFeature];var Ad=class extends ln.SShapeElement{constructor(){super(...arguments),this.selected=!1,this.alignment=f1.Point.ORIGIN,this.opacity=1}};nt.SLabel=Ad;Ad.DEFAULT_FEATURES=[ln.boundsFeature,ln.alignFeature,ln.layoutableChildFeature,p1.edgeLayoutFeature,ma.fadeFeature];var Cd=class extends ln.SShapeElement{constructor(){super(...arguments),this.opacity=1}};nt.SCompartment=Cd;Cd.DEFAULT_FEATURES=[ln.boundsFeature,ln.layoutContainerFeature,ln.layoutableChildFeature,ma.fadeFeature];var Ai=class extends h1.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(e){if(super.add(e),e instanceof Cn){if(e.sourceId){let t=this.outgoing.get(e.sourceId);t===void 0?this.outgoing.set(e.sourceId,[e]):t.push(e)}if(e.targetId){let t=this.incoming.get(e.targetId);t===void 0?this.incoming.set(e.targetId,[e]):t.push(e)}}}remove(e){if(super.remove(e),e instanceof Cn){let t=this.outgoing.get(e.sourceId);if(t!==void 0){let r=t.indexOf(e);r>=0&&(t.length===1?this.outgoing.delete(e.sourceId):t.splice(r,1))}let n=this.incoming.get(e.targetId);if(n!==void 0){let r=n.indexOf(e);r>=0&&(n.length===1?this.incoming.delete(e.targetId):n.splice(r,1))}}}getAttachedElements(e){return new _1.FluentIterableImpl(()=>({outgoing:this.outgoing.get(e.id),incoming:this.incoming.get(e.id),nextOutgoingIndex:0,nextIncomingIndex:0}),t=>{let n=t.nextOutgoingIndex;if(t.outgoing!==void 0&&n<t.outgoing.length)return t.nextOutgoingIndex=n+1,{done:!1,value:t.outgoing[n]};if(n=t.nextIncomingIndex,t.incoming!==void 0)for(;n<t.incoming.length;){let r=t.incoming[n];if(r.sourceId!==r.targetId)return t.nextIncomingIndex=n+1,{done:!1,value:r};n++}return{done:!0,value:void 0}})}getIncomingEdges(e){return this.incoming.get(e.id)||[]}getOutgoingEdges(e){return this.outgoing.get(e.id)||[]}};nt.SGraphIndex=Ai});var ti=f(ze=>{"use strict";var v1=ze&&ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},b1=ze&&ze.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},S1=ze&&ze.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ze,"__esModule",{value:!0});ze.AnchorComputerRegistry=ze.RECTANGULAR_ANCHOR_KIND=ze.ELLIPTIC_ANCHOR_KIND=ze.DIAMOND_ANCHOR_KIND=void 0;var c0=_(),E1=P(),w1=wn();ze.DIAMOND_ANCHOR_KIND="diamond";ze.ELLIPTIC_ANCHOR_KIND="elliptic";ze.RECTANGULAR_ANCHOR_KIND="rectangular";var $p=class extends w1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultAnchorKind(){return ze.RECTANGULAR_ANCHOR_KIND}get(e,t){return super.get(`${e}:${t||this.defaultAnchorKind}`)}};$p=v1([(0,c0.injectable)(),S1(0,(0,c0.multiInject)(E1.TYPES.IAnchorComputer)),b1("design:paramtypes",[Array])],$p);ze.AnchorComputerRegistry=$p});var va=f(Dt=>{"use strict";var l0=Dt&&Dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},P1=Dt&&Dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.AbstractEdgeRouter=Dt.DefaultAnchors=Dt.Side=void 0;var f0=_(),No=Q(),Xp=Ke(),wt=me(),u0=ti(),d0=me(),ee;(function(i){i[i.RIGHT=0]="RIGHT",i[i.LEFT=1]="LEFT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM"})(ee=Dt.Side||(Dt.Side={}));var _a=class{constructor(e,t,n){this.element=e,this.kind=n;let r=e.bounds;this.bounds=(0,Xp.translateBounds)(r,e.parent,t),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:n},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:n},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:n},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:n}}get(e){return this[ee[e].toLowerCase()]}getNearestSide(e){let t=No.Point.euclideanDistance(e,this.left),n=No.Point.euclideanDistance(e,this.right),r=No.Point.euclideanDistance(e,this.top),o=No.Point.euclideanDistance(e,this.bottom),s=ee.LEFT,a=t;return n<a&&(a=n,s=ee.RIGHT),r<a&&(a=r,s=ee.TOP),o<a&&(a=o,s=ee.BOTTOM),s}};Dt.DefaultAnchors=_a;var xd=class{pointAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o,lambda:s}=n;return No.Point.linear(r,o,s)}derivativeAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o}=n;return{x:o.x-r.x,y:o.y-r.y}}calculateSegment(e,t){if(t<0||t>1)return;let n=this.route(e);if(n.length<2)return;let r=[],o=0;for(let c=0;c<n.length-1;++c)r[c]=No.Point.euclideanDistance(n[c],n[c+1]),o+=r[c];let s=0,a=t*o;for(let c=0;c<n.length-1;++c){let u=s+r[c];if(r[c]>1e-8&&u>=a){let d=Math.max(0,a-s)/r[c];return{segmentStart:n[c],segmentEnd:n[c+1],lambda:d}}s=u}return{segmentEnd:n.pop(),segmentStart:n.pop(),lambda:1}}addHandle(e,t,n,r){let o=new wt.SRoutingHandle;return o.kind=t,o.pointIndex=r,o.type=n,t==="target"&&e.id===wt.edgeInProgressID&&(o.id=wt.edgeInProgressTargetHandleID),e.add(o),o}getHandlePosition(e,t,n){switch(n.kind){case"source":return e.source instanceof wt.SDanglingAnchor?e.source.position:t[0];case"target":return e.target instanceof wt.SDanglingAnchor?e.target.position:t[t.length-1];default:let r=this.getInnerHandlePosition(e,t,n);if(r!==void 0)return r;if(n.pointIndex>=0&&n.pointIndex<e.routingPoints.length)return e.routingPoints[n.pointIndex]}}findRouteSegment(e,t,n){let r=a=>a.pointIndex!==void 0?a.pointIndex:a.kind==="target"?e.routingPoints.length:-2,o,s;for(let a of t){let c=r(a);c<=n&&(o===void 0||c>r(o))&&(o=a),c>n&&(s===void 0||c<r(s))&&(s=a)}return{start:o,end:s}}getTranslatedAnchor(e,t,n,r,o=0){let s=(0,Xp.translatePoint)(t,n,e.parent),a=this.getAnchorComputer(e),c=.5*e.strokeWidth,u=a.getAnchor(e,s,o+c);return(0,Xp.translatePoint)(u,e.parent,r.parent)}getAnchorComputer(e){return this.anchorRegistry.get(this.kind,e.anchorKind)}applyHandleMoves(e,t){let n=t.slice();t.forEach(r=>{let o=r.handle;if(o.kind==="source"&&!(e.source instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-source",s.original=e.source,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.sourceId=s.id}else if(o.kind==="target"&&!(e.target instanceof wt.SDanglingAnchor)){let s=new wt.SDanglingAnchor;s.id=e.id+"_dangling-target",s.original=e.target,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.targetId=s.id}o.danglingAnchor&&(o.danglingAnchor.position=r.toPosition,n.splice(n.indexOf(r),1))}),n.length>0&&this.applyInnerHandleMoves(e,n),this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)}cleanupRoutingPoints(e,t,n,r){let o=new _a(e.source,e.parent,"source"),s=new _a(e.target,e.parent,"target");this.resetRoutingPointsOnReconnect(e,t,n,o,s)}resetRoutingPointsOnReconnect(e,t,n,r,o){if(t.length===0||e.source instanceof wt.SDanglingAnchor||e.target instanceof wt.SDanglingAnchor){let s=this.getOptions(e),a=this.calculateDefaultCorners(e,r,o,s);if(t.splice(0,t.length,...a),n){let c=-2;e.children.forEach(u=>{u instanceof wt.SRoutingHandle&&(u.kind==="target"?u.pointIndex=t.length:u.kind==="line"&&u.pointIndex>=t.length?e.remove(u):c=Math.max(u.pointIndex,c))});for(let u=c;u<t.length-1;++u)this.addHandle(e,"manhattan-50%","volatile-routing-point",u)}return!0}return!1}applyReconnect(e,t,n){let r=!1;if(t){let o=e.root.index.getById(t);o instanceof d0.SConnectableElement&&(e.sourceId=o.id,r=!0)}if(n){let o=e.root.index.getById(n);o instanceof d0.SConnectableElement&&(e.targetId=o.id,r=!0)}r&&(e.index.remove(e),e.index.add(e),this.getSelfEdgeIndex(e)>-1&&(e.routingPoints=[],this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)))}takeSnapshot(e){return{routingPoints:e.routingPoints.slice(),routingHandles:e.children.filter(t=>t instanceof wt.SRoutingHandle).map(t=>t),routedPoints:this.route(e),router:this,source:e.source,target:e.target}}applySnapshot(e,t){e.routingPoints=t.routingPoints,e.removeAll(n=>n instanceof wt.SRoutingHandle),e.routerKind=t.router.kind,t.routingHandles.forEach(n=>e.add(n)),t.source&&(e.sourceId=t.source.id),t.target&&(e.targetId=t.target.id),e.root.index.remove(e),e.root.index.add(e)}calculateDefaultCorners(e,t,n,r){let o=this.getSelfEdgeIndex(e);if(o>=0){let s=r.standardDistance,a=r.selfEdgeOffset*Math.min(t.bounds.width,t.bounds.height);switch(o%4){case 0:return[{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y+a},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.BOTTOM).x+a,y:t.get(ee.BOTTOM).y+s}];case 1:return[{x:t.get(ee.BOTTOM).x-a,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.BOTTOM).y+s},{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y+a}];case 2:return[{x:t.get(ee.LEFT).x-s,y:t.get(ee.LEFT).y-a},{x:t.get(ee.LEFT).x-s,y:t.get(ee.TOP).y-s},{x:t.get(ee.TOP).x-a,y:t.get(ee.TOP).y-s}];case 3:return[{x:t.get(ee.TOP).x+a,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.TOP).y-s},{x:t.get(ee.RIGHT).x+s,y:t.get(ee.RIGHT).y-a}]}}return[]}getSelfEdgeIndex(e){return!e.source||e.source!==e.target?-1:e.source.outgoingEdges.filter(t=>t.target===e.source).indexOf(e)}commitRoute(e,t){let n=[];for(let r=1;r<t.length-1;++r)n.push({x:t[r].x,y:t[r].y});e.routingPoints=n}};l0([(0,f0.inject)(u0.AnchorComputerRegistry),P1("design:type",u0.AnchorComputerRegistry)],xd.prototype,"anchorRegistry",void 0);xd=l0([(0,f0.injectable)()],xd);Dt.AbstractEdgeRouter=xd});var Sa=f(Ci=>{"use strict";var g0=Ci&&Ci.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},I1=Ci&&Ci.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Jp;Object.defineProperty(Ci,"__esModule",{value:!0});Ci.PolylineEdgeRouter=void 0;var m0=_(),Lo=Q(),h0=me(),p0=ti(),R1=va(),ba=Jp=class extends R1.AbstractEdgeRouter{get kind(){return Jp.KIND}getOptions(e){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(e){let t=e.source,n=e.target;if(t===void 0||n===void 0)return[];let r,o,s=this.getOptions(e),a=e.routingPoints.length>0?e.routingPoints:[];this.cleanupRoutingPoints(e,a,!1,!1);let c=a!==void 0?a.length:0;if(c===0){let d=Lo.Bounds.center(n.bounds);r=this.getTranslatedAnchor(t,d,n.parent,e,e.sourceAnchorCorrection);let l=Lo.Bounds.center(t.bounds);o=this.getTranslatedAnchor(n,l,t.parent,e,e.targetAnchorCorrection)}else{let d=a[0];r=this.getTranslatedAnchor(t,d,e.parent,e,e.sourceAnchorCorrection);let l=a[c-1];o=this.getTranslatedAnchor(n,l,e.parent,e,e.targetAnchorCorrection)}let u=[];u.push({kind:"source",x:r.x,y:r.y});for(let d=0;d<c;d++){let l=a[d];(d>0&&d<c-1||d===0&&Lo.Point.maxDistance(r,l)>=s.minimalPointDistance+(e.sourceAnchorCorrection||0)||d===c-1&&Lo.Point.maxDistance(l,o)>=s.minimalPointDistance+(e.targetAnchorCorrection||0))&&u.push({kind:"linear",x:l.x,y:l.y,pointIndex:d})}return u.push({kind:"target",x:o.x,y:o.y}),this.filterEditModeHandles(u,e,s)}filterEditModeHandles(e,t,n){if(t.children.length===0)return e;let r=0;for(;r<e.length;){let o=e[r];if(o.pointIndex!==void 0){let s=t.children.find(a=>a instanceof h0.SRoutingHandle&&a.kind==="junction"&&a.pointIndex===o.pointIndex);if(s!==void 0&&s.editMode&&r>0&&r<e.length-1){let a=e[r-1],c=e[r+1],u={x:a.x-o.x,y:a.y-o.y},d={x:c.x-o.x,y:c.y-o.y},l=(0,Lo.angleBetweenPoints)(u,d);if(Math.abs(Math.PI-l)<n.removeAngleThreshold){e.splice(r,1);continue}}}r++}return e}createRoutingHandles(e){let t=e.routingPoints.length;this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"line","volatile-routing-point",-1);for(let n=0;n<t;n++)this.addHandle(e,"junction","routing-point",n),this.addHandle(e,"line","volatile-routing-point",n);this.addHandle(e,"target","routing-point",t)}getInnerHandlePosition(e,t,n){if(n.kind==="line"){let{start:r,end:o}=this.findRouteSegment(e,t,n.pointIndex);if(r!==void 0&&o!==void 0)return(0,Lo.centerOfLine)(r,o)}}applyInnerHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o=e.routingPoints,s=r.pointIndex;r.kind==="line"&&(r.kind="junction",r.type="routing-point",o.splice(s+1,0,n.fromPosition||o[Math.max(s,0)]),e.children.forEach(a=>{a instanceof h0.SRoutingHandle&&(a===r||a.pointIndex>s)&&a.pointIndex++}),this.addHandle(e,"line","volatile-routing-point",s),s++,this.addHandle(e,"line","volatile-routing-point",s)),s>=0&&s<o.length&&(o[s]=n.toPosition)})}};ba.KIND="polyline";g0([(0,m0.inject)(p0.AnchorComputerRegistry),I1("design:type",p0.AnchorComputerRegistry)],ba.prototype,"anchorRegistry",void 0);ba=Jp=g0([(0,m0.injectable)()],ba);Ci.PolylineEdgeRouter=ba});var fn=f(tn=>{"use strict";var y0=tn&&tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_0=tn&&tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},M1=tn&&tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.EdgeRouting=tn.EdgeRouterRegistry=void 0;var Dd=_(),O1=G(),v0=P(),T1=lo(),A1=wn(),C1=me(),x1=Sa();function D1(i){return i.routeAll!==void 0}var qd=class extends A1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultKind(){return x1.PolylineEdgeRouter.KIND}get(e){return super.get(e||this.defaultKind)}routeAllChildren(e){let t=this.doRouteAllChildren(e);for(let n of this.postProcessors)n.apply(t);return t}doRouteAllChildren(e){let t=new jd,n=new Map,r=[e];for(;r.length>0;){let o=r.shift();for(let s of o.children){if(s instanceof C1.SRoutableElement){let a=s.routerKind||this.defaultKind;n.has(a)?n.get(a).push(s):n.set(a,[s])}s instanceof O1.SParentElement&&r.push(s)}}return n.forEach((o,s)=>{let a=this.get(s);if(D1(a))t.setAll(a.routeAll(o,e));else for(let c of o)t.set(c.id,this.route(c))}),t}route(e,t){let n=(0,T1.findArgValue)(t,"edgeRouting");if(n){let o=n.get(e.id);if(o)return o}return this.get(e.routerKind).route(e)}};y0([(0,Dd.multiInject)(v0.TYPES.IEdgeRoutePostprocessor),(0,Dd.optional)(),_0("design:type",Array)],qd.prototype,"postProcessors",void 0);qd=y0([(0,Dd.injectable)(),M1(0,(0,Dd.multiInject)(v0.TYPES.IEdgeRouter)),_0("design:paramtypes",[Array])],qd);tn.EdgeRouterRegistry=qd;var jd=class{constructor(){this.routesMap=new Map}set(e,t){this.routesMap.set(e,t)}setAll(e){e.routes.forEach((t,n)=>this.set(n,t))}get(e){return this.routesMap.get(e)}get routes(){return this.routesMap}};tn.EdgeRouting=jd});var Zp=f(xi=>{"use strict";var E0=xi&&xi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},q1=xi&&xi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xi,"__esModule",{value:!0});xi.EdgeLayoutPostprocessor=void 0;var w0=_(),it=Q(),j1=G(),N1=Ne(),L1=Er(),Nd=ae(),b0=qo(),S0=fn(),Ld=class{decorate(e,t){if((0,b0.isEdgeLayoutable)(t)&&t.parent instanceof L1.SEdge&&t.bounds!==it.Bounds.EMPTY){let n=this.getEdgePlacement(t),r=t.parent,o=Math.min(1,Math.max(0,n.position)),s=this.edgeRouterRegistry.get(r.routerKind),a=s.pointAt(r,o),c=s.derivativeAt(r,o),u="";if(a&&c){u+=`translate(${a.x}, ${a.y})`;let d=(0,it.toDegrees)(Math.atan2(c.y,c.x));if(n.rotate){let l=d;Math.abs(d)>90&&(d<0?l+=180:d>0&&(l-=180)),u+=` rotate(${l})`;let S=this.getRotatedAlignment(t,n,l!==d);u+=` translate(${S.x}, ${S.y})`}else{let l=this.getAlignment(t,n,d);u+=` translate(${l.x}, ${l.y})`}(0,N1.setAttr)(e,"transform",u)}}return e}getRotatedAlignment(e,t,n){let r=(0,Nd.isAlignable)(e)?e.alignment.x:0,o=(0,Nd.isAlignable)(e)?e.alignment.y:0,s=e.bounds;if(t.side==="on")return{x:r-.5*s.height,y:o-.5*s.height};if(n)switch(t.position<.3333333?r-=s.width+t.offset:t.position<.6666666?r-=.5*s.width:r+=t.offset,t.side){case"left":case"bottom":o-=t.offset+s.height;break;case"right":case"top":o+=t.offset}else switch(t.position<.3333333?r+=t.offset:t.position<.6666666?r-=.5*s.width:r-=s.width+t.offset,t.side){case"right":case"bottom":o+=-t.offset-s.height;break;case"left":case"top":o+=t.offset}return{x:r,y:o}}getEdgePlacement(e){let t=e,n=[];for(;t!==void 0;){let r=t.edgePlacement;if(r!==void 0&&n.push(r),t instanceof j1.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>Object.assign(Object.assign({},r),o),b0.DEFAULT_EDGE_PLACEMENT)}getAlignment(e,t,n){let r=e.bounds,o=(0,Nd.isAlignable)(e)?e.alignment.x-r.width:0,s=(0,Nd.isAlignable)(e)?e.alignment.y-r.height:0;if(t.side==="on")return{x:o+.5*r.height,y:s+.5*r.height};let a=this.getQuadrant(n),c={x:t.offset,y:s+.5*r.height},u={x:t.offset,y:s+r.height+t.offset},d={x:-r.width-t.offset,y:s+r.height+t.offset},l={x:-r.width-t.offset,y:s+.5*r.height},S={x:-r.width-t.offset,y:s-t.offset},R={x:t.offset,y:s-t.offset};switch(t.side){case"left":switch(a.orientation){case"west":return it.Point.linear(u,d,a.position);case"north":return it.Point.linear(d,S,a.position);case"east":return it.Point.linear(S,R,a.position);case"south":return it.Point.linear(R,u,a.position)}break;case"right":switch(a.orientation){case"west":return it.Point.linear(S,R,a.position);case"north":return it.Point.linear(R,u,a.position);case"east":return it.Point.linear(u,d,a.position);case"south":return it.Point.linear(d,S,a.position)}break;case"top":switch(a.orientation){case"west":return it.Point.linear(S,R,a.position);case"north":return this.linearFlip(R,c,l,S,a.position);case"east":return it.Point.linear(S,R,a.position);case"south":return this.linearFlip(R,c,l,S,a.position)}break;case"bottom":switch(a.orientation){case"west":return it.Point.linear(u,d,a.position);case"north":return this.linearFlip(d,l,c,u,a.position);case"east":return it.Point.linear(u,d,a.position);case"south":return this.linearFlip(d,l,c,u,a.position)}break}return{x:0,y:0}}getQuadrant(e){return Math.abs(e)>135?{orientation:"west",position:(e>0?e-135:e+225)/90}:e<-45?{orientation:"north",position:(e+135)/90}:e<45?{orientation:"east",position:(e+45)/90}:{orientation:"south",position:(e-45)/90}}linearFlip(e,t,n,r,o){return o<.5?it.Point.linear(e,t,2*o):it.Point.linear(n,r,2*o-1)}postUpdate(){}};E0([(0,w0.inject)(S0.EdgeRouterRegistry),q1("design:type",S0.EdgeRouterRegistry)],Ld.prototype,"edgeRouterRegistry",void 0);Ld=E0([(0,w0.injectable)()],Ld);xi.EdgeLayoutPostprocessor=Ld});var Bd=f(eg=>{"use strict";Object.defineProperty(eg,"__esModule",{value:!0});var B1=_(),P0=P(),Qp=Zp(),F1=new B1.ContainerModule(i=>{i(Qp.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),i(P0.TYPES.IVNodePostprocessor).toService(Qp.EdgeLayoutPostprocessor),i(P0.TYPES.HiddenVNodePostprocessor).toService(Qp.EdgeLayoutPostprocessor)});eg.default=F1});var M0=f(qt=>{"use strict";var V1=qt&&qt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},K1=qt&&qt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},H1=qt&&qt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(qt,"__esModule",{value:!0});qt.CreateElementCommand=qt.CreateElementAction=void 0;var I0=_(),z1=pe(),Y1=G(),k1=P(),R0;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(R0=qt.CreateElementAction||(qt.CreateElementAction={}));var Fd=class extends z1.Command{constructor(e){super(),this.action=e}execute(e){let t=e.root.index.getById(this.action.containerId);return t instanceof Y1.SParentElement&&(this.container=t,this.newElement=e.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),e.root}undo(e){return this.container.remove(this.newElement),e.root}redo(e){return this.container.add(this.newElement),e.root}};Fd.KIND=R0.KIND;Fd=V1([(0,I0.injectable)(),H1(0,(0,I0.inject)(k1.TYPES.Action)),K1("design:paramtypes",[Object])],Fd);qt.CreateElementCommand=Fd});var tg=f(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.isCreatingOnDrag=wr.creatingOnDragFeature=void 0;wr.creatingOnDragFeature=Symbol("creatingOnDragFeature");function U1(i){return i.hasFeature(wr.creatingOnDragFeature)&&i.createAction!==void 0}wr.isCreatingOnDrag=U1});var Ir=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.intersection=M.PointToPointLine=M.Diamond=M.linear=M.almostEquals=M.toRadians=M.toDegrees=M.magnitude=M.normalize=M.shiftTowards=M.angleBetweenPoints=M.angleOfPoint=M.maxDistance=M.manhattanDistance=M.euclideanDistance=M.Direction=M.includes=M.centerOfLine=M.center=M.translate=M.combine=M.isBounds=M.EMPTY_BOUNDS=M.isValidDimension=M.EMPTY_DIMENSION=M.pointEquals=M.subtract=M.add=M.ORIGIN_POINT=void 0;M.ORIGIN_POINT=Object.freeze({x:0,y:0});function O0(i,e){return{x:i.x+e.x,y:i.y+e.y}}M.add=O0;function T0(i,e){return{x:i.x-e.x,y:i.y-e.y}}M.subtract=T0;function Ea(i,e){return i.x===e.x&&i.y===e.y}M.pointEquals=Ea;M.EMPTY_DIMENSION=Object.freeze({width:-1,height:-1});function Vd(i){return i.width>=0&&i.height>=0}M.isValidDimension=Vd;M.EMPTY_BOUNDS=Object.freeze({x:0,y:0,width:-1,height:-1});function G1(i){return"x"in i&&"y"in i&&"width"in i&&"height"in i}M.isBounds=G1;function W1(i,e){if(!Vd(i))return Vd(e)?e:M.EMPTY_BOUNDS;if(!Vd(e))return i;let t=Math.min(i.x,e.x),n=Math.min(i.y,e.y),r=Math.max(i.x+(i.width>=0?i.width:0),e.x+(e.width>=0?e.width:0)),o=Math.max(i.y+(i.height>=0?i.height:0),e.y+(e.height>=0?e.height:0));return{x:t,y:n,width:r-t,height:o-n}}M.combine=W1;function $1(i,e){return{x:i.x+e.x,y:i.y+e.y,width:i.width,height:i.height}}M.translate=$1;function ig(i){return{x:i.x+(i.width>=0?.5*i.width:0),y:i.y+(i.height>=0?.5*i.height:0)}}M.center=ig;function X1(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return ig(t)}M.centerOfLine=X1;function J1(i,e){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}M.includes=J1;var Z1;(function(i){i[i.left=0]="left",i[i.right=1]="right",i[i.up=2]="up",i[i.down=3]="down"})(Z1=M.Direction||(M.Direction={}));function Q1(i,e){let t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}M.euclideanDistance=Q1;function eD(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}M.manhattanDistance=eD;function tD(i,e){return Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y))}M.maxDistance=tD;function nD(i){return Math.atan2(i.y,i.x)}M.angleOfPoint=nD;function iD(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}M.angleBetweenPoints=iD;function rD(i,e,t){let n=T0(e,i),r=A0(n),o={x:r.x*t,y:r.y*t};return O0(i,o)}M.shiftTowards=rD;function A0(i){let e=C0(i);return e===0||e===1?M.ORIGIN_POINT:{x:i.x/e,y:i.y/e}}M.normalize=A0;function C0(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}M.magnitude=C0;function x0(i){return i*180/Math.PI}M.toDegrees=x0;function oD(i){return i*Math.PI/180}M.toRadians=oD;function sD(i,e){return Math.abs(i-e)<.001}M.almostEquals=sD;function aD(i,e,t){return{x:(1-t)*i.x+t*e.x,y:(1-t)*i.y+t*e.y}}M.linear=aD;var ng=class{constructor(e){this.bounds=e}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new Pr(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new Pr(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new Pr(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new Pr(this.bottomPoint,this.leftPoint)}closestSideLine(e){let t=ig(this.bounds);return e.x>t.x?e.y>t.y?this.bottomRightSideLine:this.topRightSideLine:e.y>t.y?this.bottomLeftSideLine:this.topLeftSideLine}};M.Diamond=ng;var Pr=class{constructor(e,t){this.p1=e,this.p2=t}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){let e=x0(this.angle),t=e<0?360+e:e;if(t===90)return"south";if(t===0||t===360)return"east";if(t===270)return"north";if(t===180)return"west";if(t>0&&t<90)return"south-east";if(t>90&&t<180)return"south-west";if(t>180&&t<270)return"north-west";if(t>270&&t<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(e){if(this.hasIndistinctPoints(e))return;let t=this.p1.x,n=this.p1.y,r=this.p2.x,o=this.p2.y,s=e.p1.x,a=e.p1.y,c=e.p2.x,u=e.p2.y,d=(u-a)*(r-t)-(c-s)*(o-n);if(d===0)return;let l=(c-s)*(n-a)-(u-a)*(t-s),S=(r-t)*(n-a)-(o-n)*(t-s);if(l===0&&S===0)return;let R=l/d,v=S/d;if(R<0||R>1||v<0||v>1)return;let m=t+R*(r-t),O=n+R*(o-n);return{x:m,y:O}}hasIndistinctPoints(e){return Ea(this.p1,e.p1)||Ea(this.p1,e.p2)||Ea(this.p2,e.p1)||Ea(this.p2,e.p2)}};M.PointToPointLine=Pr;function cD(i,e){return{x:(i.c*e.b-e.c*i.b)/(i.a*e.b-e.a*i.b),y:(i.a*e.c-e.a*i.c)/(i.a*e.b-e.a*i.b)}}M.intersection=cD});var dg=f(Pt=>{"use strict";var wa=Pt&&Pt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.EmptyGroupView=Pt.DiamondNodeView=Pt.RectangularNodeView=Pt.CircularNodeView=Pt.SvgViewportView=void 0;var ni=Gt(),Bo=Er(),ug=ca(),uD=Ir(),Pa=_(),rg=class{render(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,ni.svg)("svg",null,(0,ni.svg)("g",{transform:r},t.renderChildren(e)))}};rg=wa([(0,Pa.injectable)()],rg);Pt.SvgViewportView=rg;var og=class extends ug.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=this.getRadius(e);return(0,ni.svg)("g",null,(0,ni.svg)("circle",{"class-sprotty-node":e instanceof Bo.SNode,"class-sprotty-port":e instanceof Bo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r,cx:r,cy:r}),t.renderChildren(e))}getRadius(e){let t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};og=wa([(0,Pa.injectable)()],og);Pt.CircularNodeView=og;var sg=class extends ug.ShapeView{render(e,t,n){if(this.isVisible(e,t))return(0,ni.svg)("g",null,(0,ni.svg)("rect",{"class-sprotty-node":e instanceof Bo.SNode,"class-sprotty-port":e instanceof Bo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};sg=wa([(0,Pa.injectable)()],sg);Pt.RectangularNodeView=sg;var ag=class extends ug.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=new uD.Diamond({height:Math.max(e.size.height,0),width:Math.max(e.size.width,0),x:0,y:0}),o=`${Kd(r.topPoint)} ${Kd(r.rightPoint)} ${Kd(r.bottomPoint)} ${Kd(r.leftPoint)}`;return(0,ni.svg)("g",null,(0,ni.svg)("polygon",{"class-sprotty-node":e instanceof Bo.SNode,"class-sprotty-port":e instanceof Bo.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,points:o}),t.renderChildren(e))}};ag=wa([(0,Pa.injectable)()],ag);Pt.DiamondNodeView=ag;function Kd(i){return`${i.x},${i.y}`}var cg=class{render(e,t){return(0,ni.svg)("g",null)}};cg=wa([(0,Pa.injectable)()],cg);Pt.EmptyGroupView=cg});var Yd=f(ie=>{"use strict";var dD=ie&&ie.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},lD=ie&&ie.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},fD=ie&&ie.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ie,"__esModule",{value:!0});ie.getEditableLabel=ie.EditLabelKeyListener=ie.EditLabelMouseListener=ie.ApplyLabelEditCommand=ie.ResolvedLabelEdit=ie.isApplyLabelEditAction=ie.ApplyLabelEditAction=ie.isEditLabelAction=ie.EditLabelAction=void 0;var hD=_(),D0=te(),pD=pe(),gD=P(),mD=Tt(),yD=an(),_D=Rn(),vD=Et(),bD=tr(),lg=jo(),zd;(function(i){i.KIND="EditLabel";function e(t){return{kind:i.KIND,labelId:t}}i.create=e})(zd=ie.EditLabelAction||(ie.EditLabelAction={}));function SD(i){return(0,D0.isAction)(i)&&i.kind===zd.KIND&&"labelId"in i}ie.isEditLabelAction=SD;var gg;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(gg=ie.ApplyLabelEditAction||(ie.ApplyLabelEditAction={}));function ED(i){return(0,D0.isAction)(i)&&i.kind===gg.KIND&&"labelId"in i&&"text"in i}ie.isApplyLabelEditAction=ED;var fg=class{};ie.ResolvedLabelEdit=fg;var Hd=class extends pD.Command{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.labelId);return n&&(0,lg.isEditableLabel)(n)&&(this.resolvedLabelEdit={label:n,oldLabel:n.text,newLabel:this.action.text},n.text=this.action.text),e.root}undo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),e.root}redo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),e.root}};Hd.KIND=gg.KIND;Hd=dD([fD(0,(0,hD.inject)(gD.TYPES.Action)),lD("design:paramtypes",[Object])],Hd);ie.ApplyLabelEditCommand=Hd;var hg=class extends mD.MouseListener{doubleClick(e,t){let n=mg(e);return n?[zd.create(n.id)]:[]}};ie.EditLabelMouseListener=hg;var pg=class extends yD.KeyListener{keyDown(e,t){if((0,_D.matchesKeystroke)(t,"F2")){let n=(0,bD.toArray)(e.index.all().filter(r=>(0,vD.isSelectable)(r)&&r.selected)).map(mg).filter(r=>r!==void 0);if(n.length===1)return[zd.create(n[0].id)]}return[]}};ie.EditLabelKeyListener=pg;function mg(i){if((0,lg.isEditableLabel)(i))return i;if((0,lg.isWithEditableLabel)(i)&&i.editableLabel)return i.editableLabel}ie.getEditableLabel=mg});var Rr=f(hn=>{"use strict";var kd=hn&&hn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yg=hn&&hn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(hn,"__esModule",{value:!0});hn.SvgExporter=hn.ExportSvgAction=void 0;var Ud=_(),q0=Q(),wD=ae(),PD=au(),_g=P(),j0;(function(i){i.KIND="exportSvg";function e(t,n){return{kind:i.KIND,svg:t,responseId:n}}i.create=e})(j0=hn.ExportSvgAction||(hn.ExportSvgAction={}));var Fo=class{export(e,t){if(typeof document<"u"){let n=document.getElementById(this.options.hiddenDiv);if(n!==null&&n.firstElementChild&&n.firstElementChild.tagName==="svg"){let r=n.firstElementChild,o=this.createSvg(r,e);this.actionDispatcher.dispatch(j0.create(o,t?t.requestId:""))}}}createSvg(e,t){let n=new XMLSerializer,r=n.serializeToString(e),o=document.createElement("iframe");if(document.body.appendChild(o),!o.contentWindow)throw new Error("IFrame has no contentWindow");let s=o.contentWindow.document;s.open(),s.write(r),s.close();let a=s.getElementById(e.id);a.removeAttribute("opacity"),this.copyStyles(e,a,["width","height","opacity"]),a.setAttribute("version","1.1");let c=this.getBounds(t);a.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`);let u=n.serializeToString(a);return document.body.removeChild(o),u}copyStyles(e,t,n){let r=getComputedStyle(e),o=getComputedStyle(t),s="";for(let a=0;a<r.length;a++){let c=r[a];if(n.indexOf(c)===-1){let u=r.getPropertyValue(c);o.getPropertyValue(c)!==u&&(s+=c+":"+u+";")}}s!==""&&t.setAttribute("style",s);for(let a=0;a<e.childNodes.length;++a){let c=e.childNodes[a],u=t.childNodes[a];c instanceof Element&&this.copyStyles(c,u,[])}}getBounds(e){let t=[q0.Bounds.EMPTY];return e.children.forEach(n=>{(0,wD.isBoundsAware)(n)&&t.push(n.bounds)}),t.reduce((n,r)=>q0.Bounds.combine(n,r))}};kd([(0,Ud.inject)(_g.TYPES.ViewerOptions),yg("design:type",Object)],Fo.prototype,"options",void 0);kd([(0,Ud.inject)(_g.TYPES.IActionDispatcher),yg("design:type",PD.ActionDispatcher)],Fo.prototype,"actionDispatcher",void 0);kd([(0,Ud.inject)(_g.TYPES.ILogger),yg("design:type",Object)],Fo.prototype,"log",void 0);Fo=kd([(0,Ud.injectable)()],Fo);hn.SvgExporter=Fo});var Vo=f(xn=>{"use strict";var Gd=xn&&xn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},N0=xn&&xn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xn,"__esModule",{value:!0});xn.ComputedBoundsApplicator=xn.ModelSource=void 0;var Wd=_(),ID=te(),RD=bi(),L0=P(),MD=Rr(),Ia=class{initialize(e){e.register(ID.RequestModelAction.KIND,this),e.register(MD.ExportSvgAction.KIND,this)}};Gd([(0,Wd.inject)(L0.TYPES.IActionDispatcher),N0("design:type",Object)],Ia.prototype,"actionDispatcher",void 0);Gd([(0,Wd.inject)(L0.TYPES.ViewerOptions),N0("design:type",Object)],Ia.prototype,"viewerOptions",void 0);Ia=Gd([(0,Wd.injectable)()],Ia);xn.ModelSource=Ia;var vg=class{apply(e,t){let n=new RD.SModelIndex;n.add(e);for(let r of t.bounds){let o=n.getById(r.elementId);o!==void 0&&this.applyBounds(o,r.newPosition,r.newSize)}if(t.alignments!==void 0)for(let r of t.alignments){let o=n.getById(r.elementId);o!==void 0&&this.applyAlignment(o,r.newAlignment)}return n}applyAlignment(e,t){let n=e;n.alignment={x:t.x,y:t.y}}applyBounds(e,t,n){let r=e;t&&(r.position=Object.assign({},t)),r.size=Object.assign({},n)}};vg=Gd([(0,Wd.injectable)()],vg);xn.ComputedBoundsApplicator=vg});var Ma=f(jt=>{"use strict";var B0=jt&&jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},F0=jt&&jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},OD=jt&&jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.CommitModelCommand=jt.CommitModelAction=void 0;var bg=_(),TD=pe(),V0=P(),AD=Vo(),K0;(function(i){i.KIND="commitModel";function e(){return{kind:i.KIND}}i.create=e})(K0=jt.CommitModelAction||(jt.CommitModelAction={}));var Ra=class extends TD.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newModel=e.modelFactory.createSchema(e.root),this.doCommit(this.newModel,e.root,!0)}doCommit(e,t,n){let r=this.modelSource.commitModel(e);return r instanceof Promise?r.then(o=>(n&&(this.originalModel=o),t)):(n&&(this.originalModel=r),t)}undo(e){return this.doCommit(this.originalModel,e.root,!1)}redo(e){return this.doCommit(this.newModel,e.root,!1)}};Ra.KIND=K0.KIND;B0([(0,bg.inject)(V0.TYPES.ModelSource),F0("design:type",AD.ModelSource)],Ra.prototype,"modelSource",void 0);Ra=B0([(0,bg.injectable)(),OD(0,(0,bg.inject)(V0.TYPES.Action)),F0("design:paramtypes",[Object])],Ra);jt.CommitModelCommand=Ra});var $d=f(Di=>{"use strict";Object.defineProperty(Di,"__esModule",{value:!0});Di.ZoomMouseListener=Di.getZoom=Di.isZoomable=void 0;var CD=te(),xD=In(),DD=Tt(),H0=Ke(),z0=An();function qD(i){return"zoom"in i}Di.isZoomable=qD;function jD(i){let e=1,t=(0,H0.findParentByFeature)(i,z0.isViewport);return t&&(e=t.zoom),e}Di.getZoom=jD;var Sg=class extends DD.MouseListener{wheel(e,t){let n=(0,H0.findParentByFeature)(e,z0.isViewport);if(n){let r=this.getZoomFactor(t),o=this.getViewportOffset(e.root,t),s=1/(r*n.zoom)-1/n.zoom,a={scroll:{x:n.scroll.x-s*o.x,y:n.scroll.y-s*o.y},zoom:n.zoom*r};return[CD.SetViewportAction.create(n.id,a,{animate:!1})]}return[]}getViewportOffset(e,t){let n=e.canvasBounds,r=(0,xD.getWindowScroll)();return{x:t.clientX+r.x-n.x,y:t.clientY+r.y-n.y}}getZoomFactor(e){return e.deltaMode===e.DOM_DELTA_PAGE?Math.exp(-e.deltaY*.5):e.deltaMode===e.DOM_DELTA_LINE?Math.exp(-e.deltaY*.05):Math.exp(-e.deltaY*.005)}};Di.ZoomMouseListener=Sg});var Pg=f(qn=>{"use strict";var Mr=qn&&qn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Oa=qn&&qn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Eg;Object.defineProperty(qn,"__esModule",{value:!0});qn.EditLabelUI=qn.EditLabelActionHandler=void 0;var ii=_(),ND=te(),Ta=P(),LD=Au(),BD=ks(),FD=so(),VD=Ma(),Y0=Rn(),KD=ae(),k0=$d(),HD=Yd(),zD=jo(),wg=class{handle(e){if((0,HD.isEditLabelAction)(e))return BD.SetUIExtensionVisibilityAction.create({extensionId:Dn.ID,visible:!0,contextElementsId:[e.labelId]})}};wg=Mr([(0,ii.injectable)()],wg);qn.EditLabelActionHandler=wg;var Dn=Eg=class extends LD.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return Eg.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(t=>{t.onkeydown=n=>this.applyLabelEditOnEvent(n,"Enter"),this.configureAndAdd(t,e)})}configureAndAdd(e,t){e.style.visibility="hidden",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.addEventListener("keydown",n=>this.hideIfEscapeEvent(n)),e.addEventListener("keyup",n=>this.validateLabelIfContentChange(n,e.value)),e.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),t.appendChild(e)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(e){(0,Y0.matchesKeystroke)(e,"Escape")&&this.hide()}applyLabelEditOnEvent(e,t,...n){(0,Y0.matchesKeystroke)(e,t||"Enter",...n)&&(e.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(e,t){(this.previousLabelContent===void 0||this.previousLabelContent!==t)&&(this.previousLabelContent=t,this.performLabelValidation(e,this.editControl.value))}async applyLabelEdit(){var e;if(this.isActive){if(((e=this.label)===null||e===void 0?void 0:e.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(t=>t.dispatchAll([ND.ApplyLabelEditAction.create(this.labelId,this.editControl.value),VD.CommitModelAction.create()])).catch(t=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",t)),this.hide()}}performLabelValidation(e,t){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(t),200)}async validateLabel(e){if(this.labelValidator&&this.label)try{let t=await this.labelValidator.validate(e,this.label);return this.isCurrentLabelValid=t.severity!=="error",this.showValidationResult(t),t}catch(t){this.logger.error(this,"Error validating edited label",t)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(e){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,e)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(e,...t){!YD(t,e)||this.isActive||(super.show(e,...t),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(e,t,...n){this.label=U0(n,t)[0],this.previousLabelContent=this.label.text,this.setPosition(e),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(e){let t=0,n=0,r=100,o=20;if(this.label){let s=(0,k0.getZoom)(this.label),a=(0,KD.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);t=a.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*s,n=a.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*s,o=(this.label.editControlDimension?this.label.editControlDimension.height:o)*s,r=(this.label.editControlDimension?this.label.editControlDimension.width:r)*s}e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=`${r}px`,this.editControl.style.width=`${r}px`,e.style.height=`${o}px`,this.editControl.style.height=`${o}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";let e=window.getComputedStyle(this.labelElement);this.editControl.style.font=e.font,this.editControl.style.fontStyle=e.fontStyle,this.editControl.style.fontFamily=e.fontFamily,this.editControl.style.fontSize=kD(e.fontSize,(0,k0.getZoom)(this.label)),this.editControl.style.fontWeight=e.fontWeight,this.editControl.style.lineHeight=e.lineHeight}}};Dn.ID="editLabelUi";Mr([(0,ii.inject)(Ta.TYPES.IActionDispatcherProvider),Oa("design:type",Function)],Dn.prototype,"actionDispatcherProvider",void 0);Mr([(0,ii.inject)(Ta.TYPES.ViewerOptions),Oa("design:type",Object)],Dn.prototype,"viewerOptions",void 0);Mr([(0,ii.inject)(Ta.TYPES.DOMHelper),Oa("design:type",FD.DOMHelper)],Dn.prototype,"domHelper",void 0);Mr([(0,ii.inject)(Ta.TYPES.IEditLabelValidator),(0,ii.optional)(),Oa("design:type",Object)],Dn.prototype,"labelValidator",void 0);Mr([(0,ii.inject)(Ta.TYPES.IEditLabelValidationDecorator),(0,ii.optional)(),Oa("design:type",Object)],Dn.prototype,"validationDecorator",void 0);Dn=Eg=Mr([(0,ii.injectable)()],Dn);qn.EditLabelUI=Dn;function YD(i,e){return U0(i,e).length===1}function U0(i,e){return i.map(t=>e.index.getById(t)).filter(zD.isEditableLabel)}function kD(i,e){return i.replace(/([0-9]+)/,t=>String(Number.parseInt(t,10)*e))}});var Ca=f(Nt=>{"use strict";var $0=Nt&&Nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},X0=Nt&&Nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},UD=Nt&&Nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.SwitchEditModeCommand=Nt.SwitchEditModeAction=void 0;var Ig=_(),GD=pe(),WD=G(),$D=P(),pn=me(),G0=fn(),W0=jo(),J0;(function(i){i.KIND="switchEditMode";function e(t){var n,r;return{kind:i.KIND,elementsToActivate:(n=t.elementsToActivate)!==null&&n!==void 0?n:[],elementsToDeactivate:(r=t.elementsToDeactivate)!==null&&r!==void 0?r:[]}}i.create=e})(J0=Nt.SwitchEditModeAction||(Nt.SwitchEditModeAction={}));var Aa=class extends GD.Command{constructor(e){super(),this.action=e,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(e){let t=e.root.index;return this.action.elementsToActivate.forEach(n=>{let r=t.getById(n);r!==void 0&&this.elementsToActivate.push(r)}),this.action.elementsToDeactivate.forEach(n=>{let r=t.getById(n);if(r!==void 0&&this.elementsToDeactivate.push(r),r instanceof pn.SRoutingHandle&&r.parent instanceof pn.SRoutableElement){let o=r.parent;this.shouldRemoveHandle(r,o)&&(this.handlesToRemove.push({handle:r,parent:o}),this.elementsToDeactivate.push(o),this.elementsToActivate.push(o))}}),this.doExecute(e)}doExecute(e){return this.handlesToRemove.forEach(t=>{t.point=t.parent.routingPoints.splice(t.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(t=>{t instanceof pn.SRoutableElement?t.removeAll(n=>n instanceof pn.SRoutingHandle):t instanceof pn.SRoutingHandle&&(t.editMode=!1,t.danglingAnchor&&t.parent instanceof pn.SRoutableElement&&t.danglingAnchor.original&&(t.parent.source===t.danglingAnchor?t.parent.sourceId=t.danglingAnchor.original.id:t.parent.target===t.danglingAnchor&&(t.parent.targetId=t.danglingAnchor.original.id),t.danglingAnchor.parent.remove(t.danglingAnchor),t.danglingAnchor=void 0))}),this.elementsToActivate.forEach(t=>{(0,W0.canEditRouting)(t)&&t instanceof WD.SParentElement?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof pn.SRoutingHandle&&(t.editMode=!0)}),e.root}shouldRemoveHandle(e,t){return e.kind==="junction"?this.edgeRouterRegistry.route(t).find(r=>r.pointIndex===e.pointIndex)===void 0:!1}undo(e){return this.handlesToRemove.forEach(t=>{t.point!==void 0&&t.parent.routingPoints.splice(t.handle.pointIndex,0,t.point)}),this.elementsToActivate.forEach(t=>{t instanceof pn.SRoutableElement?t.removeAll(n=>n instanceof pn.SRoutingHandle):t instanceof pn.SRoutingHandle&&(t.editMode=!1)}),this.elementsToDeactivate.forEach(t=>{(0,W0.canEditRouting)(t)?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof pn.SRoutingHandle&&(t.editMode=!0)}),e.root}redo(e){return this.doExecute(e)}};Aa.KIND=J0.KIND;$0([(0,Ig.inject)(G0.EdgeRouterRegistry),X0("design:type",G0.EdgeRouterRegistry)],Aa.prototype,"edgeRouterRegistry",void 0);Aa=$0([(0,Ig.injectable)(),UD(0,(0,Ig.inject)($D.TYPES.Action)),X0("design:paramtypes",[Object])],Aa);Nt.SwitchEditModeCommand=Aa});var Xd=f(Lt=>{"use strict";var Q0=Lt&&Lt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},eE=Lt&&Lt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},XD=Lt&&Lt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.ReconnectCommand=Lt.ReconnectAction=void 0;var Rg=_(),JD=pe(),ZD=P(),QD=me(),Z0=fn(),tE;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(tE=Lt.ReconnectAction||(Lt.ReconnectAction={}));var xa=class extends JD.Command{constructor(e){super(),this.action=e}execute(e){return this.doExecute(e),e.root}doExecute(e){let n=e.root.index.getById(this.action.routableId);if(n instanceof QD.SRoutableElement){let r=this.edgeRouterRegistry.get(n.routerKind),o=r.takeSnapshot(n);r.applyReconnect(n,this.action.newSourceId,this.action.newTargetId);let s=r.takeSnapshot(n);this.memento={edge:n,before:o,after:s}}}undo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),e.root}redo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),e.root}};xa.KIND=tE.KIND;Q0([(0,Rg.inject)(Z0.EdgeRouterRegistry),eE("design:type",Z0.EdgeRouterRegistry)],xa.prototype,"edgeRouterRegistry",void 0);xa=Q0([(0,Rg.injectable)(),XD(0,(0,Rg.inject)(ZD.TYPES.Action)),eE("design:paramtypes",[Object])],xa);Lt.ReconnectCommand=xa});var Ag=f(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.labelEditUiModule=qi.labelEditModule=qi.edgeEditModule=void 0;var Tg=_(),Og=P(),Jd=yt(),eq=Ls(),tq=lo(),nq=me(),iq=dg(),rq=xo(),Ko=Yd(),Mg=Pg(),oq=Ca(),sq=Xd();qi.edgeEditModule=new Tg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,Jd.configureCommand)(n,oq.SwitchEditModeCommand),(0,Jd.configureCommand)(n,sq.ReconnectCommand),(0,Jd.configureCommand)(n,rq.DeleteElementCommand),(0,tq.configureModelElement)(n,"dangling-anchor",nq.SDanglingAnchor,iq.EmptyGroupView)});qi.labelEditModule=new Tg.ContainerModule((i,e,t)=>{i(Ko.EditLabelMouseListener).toSelf().inSingletonScope(),i(Og.TYPES.MouseListener).toService(Ko.EditLabelMouseListener),i(Ko.EditLabelKeyListener).toSelf().inSingletonScope(),i(Og.TYPES.KeyListener).toService(Ko.EditLabelKeyListener),(0,Jd.configureCommand)({bind:i,isBound:t},Ko.ApplyLabelEditCommand)});qi.labelEditUiModule=new Tg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,eq.configureActionHandler)(n,Ko.EditLabelAction.KIND,Mg.EditLabelActionHandler),i(Mg.EditLabelUI).toSelf().inSingletonScope(),i(Og.TYPES.IUIExtension).toService(Mg.EditLabelUI)})});var Zd=f(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.isExpandable=Or.expandFeature=void 0;Or.expandFeature=Symbol("expandFeature");function aq(i){return i.hasFeature(Or.expandFeature)&&"expanded"in i}Or.isExpandable=aq});var Cg=f(jn=>{"use strict";var cq=jn&&jn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(jn,"__esModule",{value:!0});jn.ExpandButtonHandler=jn.CollapseExpandAllAction=jn.CollapseExpandAction=void 0;var uq=_(),dq=te(),lq=Ke(),fq=Zd(),Ho=class{constructor(e,t){this.expandIds=e,this.collapseIds=t,this.kind=Ho.KIND}};jn.CollapseExpandAction=Ho;Ho.KIND="collapseExpand";var zo=class{constructor(e=!0){this.expand=e,this.kind=zo.KIND}};jn.CollapseExpandAllAction=zo;zo.KIND="collapseExpandAll";var Qd=class{buttonPressed(e){let t=(0,lq.findParentByFeature)(e,fq.isExpandable);return t!==void 0?[dq.CollapseExpandAction.create({expandIds:t.expanded?[]:[t.id],collapseIds:t.expanded?[t.id]:[]})]:[]}};Qd.TYPE="button:expand";Qd=cq([(0,uq.injectable)()],Qd);jn.ExpandButtonHandler=Qd});var nE=f(Yo=>{"use strict";var hq=Yo&&Yo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Yo,"__esModule",{value:!0});Yo.ExpandButtonView=void 0;var xg=Gt(),pq=Zd(),gq=Ke(),mq=_(),Dg=class{render(e,t){let n=(0,gq.findParentByFeature)(e,pq.isExpandable),r=n!==void 0&&n.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,xg.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,xg.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,xg.svg)("path",{d:r}))}};Dg=hq([(0,mq.injectable)()],Dg);Yo.ExpandButtonView=Dg});var jg=f(Ye=>{"use strict";var nl=Ye&&Ye.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},rE=Ye&&Ye.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},yq=Ye&&Ye.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.ExportSvgPostprocessor=Ye.ExportSvgCommand=Ye.RequestExportSvgAction=Ye.ExportSvgKeyListener=void 0;var il=_(),_q=te(),vq=pe(),bq=Et(),Sq=G(),Eq=an(),wq=Rn(),iE=Pd(),Pq=Rr(),Iq=An(),Rq=vr(),oE=P(),qg=class extends Eq.KeyListener{keyDown(e,t){return(0,wq.matchesKeystroke)(t,"KeyE","ctrlCmd","shift")?[rl.create()]:[]}};qg=nl([(0,il.injectable)()],qg);Ye.ExportSvgKeyListener=qg;var rl;(function(i){i.KIND="requestExportSvg";function e(){return{kind:i.KIND,requestId:(0,_q.generateRequestId)()}}i.create=e})(rl=Ye.RequestExportSvgAction||(Ye.RequestExportSvgAction={}));var el=class extends vq.HiddenCommand{constructor(e){super(),this.action=e}execute(e){if((0,iE.isExportable)(e.root)){let t=e.modelFactory.createRoot(e.root);if((0,iE.isExportable)(t))return(0,Iq.isViewport)(t)&&(t.zoom=1,t.scroll={x:0,y:0}),t.index.all().forEach(n=>{(0,bq.isSelectable)(n)&&n.selected&&(n.selected=!1),(0,Rq.isHoverable)(n)&&n.hoverFeedback&&(n.hoverFeedback=!1)}),{model:t,modelChanged:!0,cause:this.action}}return{model:e.root,modelChanged:!1}}};el.KIND=rl.KIND;el=nl([yq(0,(0,il.inject)(oE.TYPES.Action)),rE("design:paramtypes",[Object])],el);Ye.ExportSvgCommand=el;var tl=class{decorate(e,t){return t instanceof Sq.SModelRoot&&(this.root=t),e}postUpdate(e){this.root&&e!==void 0&&e.kind===rl.KIND&&this.svgExporter.export(this.root,e)}};nl([(0,il.inject)(oE.TYPES.SvgExporter),rE("design:type",Pq.SvgExporter)],tl.prototype,"svgExporter",void 0);tl=nl([(0,il.injectable)()],tl);Ye.ExportSvgPostprocessor=tl});var ol=f(ji=>{"use strict";var Mq=ji&&ji.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ji,"__esModule",{value:!0});ji.ElementFader=ji.FadeAnimation=void 0;var Oq=_(),Tq=or(),Aq=G(),Cq=Ne(),xq=To(),Ng=class extends Tq.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementFades=t,this.removeAfterFadeOut=r}tween(e,t){for(let n of this.elementFades){let r=n.element;n.type==="in"?r.opacity=e:n.type==="out"&&(r.opacity=1-e,e===1&&this.removeAfterFadeOut&&r instanceof Aq.SChildElement&&r.parent.remove(r))}return this.model}};ji.FadeAnimation=Ng;var Lg=class{decorate(e,t){return(0,xq.isFadeable)(t)&&t.opacity!==1&&(0,Cq.setAttr)(e,"opacity",t.opacity),e}postUpdate(){}};Lg=Mq([(0,Oq.injectable)()],Lg);ji.ElementFader=Lg});var Kg=f(ne=>{"use strict";var Li=ne&&ne.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ja=ne&&ne.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},aE=ne&&ne.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ne,"__esModule",{value:!0});ne.ClosePopupActionHandler=ne.HoverKeyListener=ne.PopupHoverMouseListener=ne.HoverMouseListener=ne.AbstractHoverMouseListener=ne.SetPopupModelCommand=ne.SetPopupModelAction=ne.RequestPopupModelAction=ne.HoverFeedbackCommand=ne.HoverFeedbackAction=void 0;var Nn=_(),cE=te(),Dq=Q(),qq=Rn(),Na=P(),sE=G(),jq=Tt(),uE=pe(),Tr=Pn(),Nq=an(),Da=Ke(),Lq=ae(),ko=vr(),Uo;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(Uo=ne.HoverFeedbackAction||(ne.HoverFeedbackAction={}));var sl=class extends uE.SystemCommand{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.mouseoverElement);return n&&(0,ko.isHoverable)(n)&&(n.hoverFeedback=this.action.mouseIsOver),this.redo(e)}undo(e){return e.root}redo(e){return e.root}};sl.KIND=Uo.KIND;sl=Li([(0,Nn.injectable)(),aE(0,(0,Nn.inject)(Na.TYPES.Action)),ja("design:paramtypes",[Object])],sl);ne.HoverFeedbackCommand=sl;var Ni=class{constructor(e,t,n=""){this.elementId=e,this.bounds=t,this.requestId=n,this.kind=Ni.KIND}static create(e,t){return new Ni(e,t,(0,cE.generateRequestId)())}};ne.RequestPopupModelAction=Ni;Ni.KIND="requestPopupModel";var ri=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ri.KIND}};ne.SetPopupModelAction=ri;ri.KIND="setPopupModel";var qa=class extends uE.PopupCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.root,this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}};qa.KIND=cE.SetPopupModelAction.KIND;qa=Li([(0,Nn.injectable)(),aE(0,(0,Nn.inject)(Na.TYPES.Action)),ja("design:paramtypes",[Object])],qa);ne.SetPopupModelCommand=qa;var Ar=class extends jq.MouseListener{mouseDown(e,t){return this.mouseIsDown=!0,[]}mouseUp(e,t){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(e=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,e(new ri({type:Tr.EMPTY_ROOT.type,id:Tr.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}};Li([(0,Nn.inject)(Na.TYPES.ViewerOptions),ja("design:type",Object)],Ar.prototype,"options",void 0);Li([(0,Nn.inject)(Na.TYPES.HoverState),ja("design:type",Object)],Ar.prototype,"state",void 0);ne.AbstractHoverMouseListener=Ar;var al=class extends Ar{computePopupBounds(e,t){let n={x:-5,y:20},r=(0,Lq.getAbsoluteBounds)(e),o=e.root.canvasBounds,s=Dq.Bounds.translate(r,o),a=s.x+s.width-t.x,c=s.y+s.height-t.y;c<=a&&this.allowSidePosition(e,"below",c)?n={x:-5,y:Math.round(c+5)}:a<=c&&this.allowSidePosition(e,"right",a)&&(n={x:Math.round(a+5),y:-5});let u=t.x+n.x,d=o.x+o.width;u>d&&(u=d);let l=t.y+n.y,S=o.y+o.height;return l>S&&(l=S),{x:u,y:l,width:-1,height:-1}}allowSidePosition(e,t,n){return!(e instanceof sE.SModelRoot)&&n<=150}startMouseOverTimer(e,t){return this.stopMouseOverTimer(),new Promise(n=>{this.state.mouseOverTimer=window.setTimeout(()=>{let r=this.computePopupBounds(e,{x:t.pageX,y:t.pageY});n(new Ni(e.id,r)),this.state.popupOpen=!0,this.state.previousPopupElement=e},this.options.popupOpenDelay)})}mouseOver(e,t){let n=[];if(!this.mouseIsDown){let r=(0,Da.findParent)(e,ko.hasPopupFeature);this.state.popupOpen&&(r===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==r.id)?n.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t)),this.lastHoverFeedbackElementId&&(n.push(Uo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);let o=(0,Da.findParentByFeature)(e,ko.isHoverable);o!==void 0&&(n.push(Uo.create({mouseoverElement:o.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=o.id)}return n}mouseOut(e,t){let n=[];if(!this.mouseIsDown){let r=this.getElementFromEventPosition(t);if(!this.isSprottyPopup(r)){if(this.state.popupOpen){let s=(0,Da.findParent)(e,ko.hasPopupFeature);this.state.previousPopupElement!==void 0&&s!==void 0&&this.state.previousPopupElement.id===s.id&&n.push(this.startMouseOutTimer())}this.stopMouseOverTimer();let o=(0,Da.findParentByFeature)(e,ko.isHoverable);o!==void 0&&(n.push(Uo.create({mouseoverElement:o.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==o.id&&n.push(Uo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return n}getElementFromEventPosition(e){return document.elementFromPoint(e.x,e.y)}isSprottyPopup(e){return e?e.id===this.options.popupDiv||!!e.parentElement&&this.isSprottyPopup(e.parentElement):!1}mouseMove(e,t){let n=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,t)&&n.push(this.startMouseOutTimer());let r=(0,Da.findParent)(e,ko.hasPopupFeature);r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t))}return n}closeOnMouseMove(e,t){return e instanceof sE.SModelRoot}};Li([(0,Nn.inject)(Na.TYPES.ViewerOptions),ja("design:type",Object)],al.prototype,"options",void 0);al=Li([(0,Nn.injectable)()],al);ne.HoverMouseListener=al;var Bg=class extends Ar{mouseOut(e,t){return[this.startMouseOutTimer()]}mouseOver(e,t){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};Bg=Li([(0,Nn.injectable)()],Bg);ne.PopupHoverMouseListener=Bg;var Fg=class extends Nq.KeyListener{keyDown(e,t){return(0,qq.matchesKeystroke)(t,"Escape")?[new ri({type:Tr.EMPTY_ROOT.type,id:Tr.EMPTY_ROOT.id})]:[]}};ne.HoverKeyListener=Fg;var Vg=class{constructor(){this.popupOpen=!1}handle(e){if(e.kind===qa.KIND)this.popupOpen=e.newRoot.type!==Tr.EMPTY_ROOT.type;else if(this.popupOpen)return new ri({id:Tr.EMPTY_ROOT.id,type:Tr.EMPTY_ROOT.type})}};Vg=Li([(0,Nn.injectable)()],Vg);ne.ClosePopupActionHandler=Vg});var cl=f(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.SIssue=It.SIssueMarker=It.SDecoration=It.isDecoration=It.decorationFeature=void 0;var lE=ae(),dE=vr();It.decorationFeature=Symbol("decorationFeature");function Bq(i){return i.hasFeature(It.decorationFeature)}It.isDecoration=Bq;var La=class extends lE.SShapeElement{};It.SDecoration=La;La.DEFAULT_FEATURES=[It.decorationFeature,lE.boundsFeature,dE.hoverFeedbackFeature,dE.popupFeature];var Hg=class extends La{};It.SIssueMarker=Hg;var zg=class{};It.SIssue=zg});var Ug=f(Go=>{"use strict";var Fq=Go&&Go.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Go,"__esModule",{value:!0});Go.IssueMarkerView=void 0;var Yg=Gt(),Vq=Ne(),Kq=_(),kg=class{render(e,t){let n=.008928571428571428,r=`scale(${n}, ${n})`,o=this.getMaxSeverity(e),s=(0,Yg.svg)("g",{"class-sprotty-issue":!0},(0,Yg.svg)("g",{transform:r},(0,Yg.svg)("path",{d:this.getPath(o)})));return(0,Vq.setClass)(s,"sprotty-"+o,!0),s}getMaxSeverity(e){let t="info";for(let n of e.issues.map(r=>r.severity))(n==="error"||n==="warning"&&t==="info")&&(t=n);return t}getPath(e){switch(e){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};kg=Fq([(0,Kq.injectable)()],kg);Go.IssueMarkerView=kg});var Gg=f(Bi=>{"use strict";var gE=Bi&&Bi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Hq=Bi&&Bi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.DecorationPlacer=void 0;var mE=_(),zq=G(),Yq=cl(),kq=Ne(),fE=ae(),Uq=me(),hE=fn(),pE=ur(),ul=class{decorate(e,t){if((0,Yq.isDecoration)(t)){let n=this.getPosition(t),r="translate("+n.x+", "+n.y+")";(0,kq.setAttr)(e,"transform",r)}return e}getPosition(e){if(e instanceof zq.SChildElement&&e.parent instanceof Uq.SRoutableElement){let t=this.edgeRouterRegistry.route(e.parent);if(t.length>1){let n=Math.floor(.5*(t.length-1)),r=(0,fE.isSizeable)(e)?{x:-.5*e.bounds.width,y:-.5*e.bounds.width}:pE.Point.ORIGIN;return{x:.5*(t[n].x+t[n+1].x)+r.x,y:.5*(t[n].y+t[n+1].y)+r.y}}}return(0,fE.isSizeable)(e)?{x:-.666*e.bounds.width,y:-.666*e.bounds.height}:pE.Point.ORIGIN}postUpdate(){}};gE([(0,mE.inject)(hE.EdgeRouterRegistry),Hq("design:type",hE.EdgeRouterRegistry)],ul.prototype,"edgeRouterRegistry",void 0);ul=gE([(0,mE.injectable)()],ul);Bi.DecorationPlacer=ul});var Xg=f((Wg,$g)=>{(function(i,e){typeof Wg=="object"&&typeof $g<"u"?$g.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self,i.TinyQueue=e())})(Wg,function(){"use strict";var i=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var r=this,o=r.data,s=r.compare,a=o[n];n>0;){var c=n-1>>1,u=o[c];if(s(a,u)>=0)break;o[n]=u,n=c}o[n]=a},i.prototype._down=function(n){for(var r=this,o=r.data,s=r.compare,a=this.length>>1,c=o[n];n<a;){var u=(n<<1)+1,d=o[u],l=u+1;if(l<this.length&&s(o[l],d)<0&&(u=l,d=o[l]),s(d,c)>=0)break;o[n]=d,n=u}o[n]=c};function e(t,n){return t<n?-1:t>n?1:0}return i})});var Zg=f(Me=>{"use strict";var Gq=Me&&Me.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Me,"__esModule",{value:!0});Me.intersectionOfSegments=Me.getSegmentIndex=Me.checkWhichSegmentHasRightEndpointFirst=Me.runSweep=Me.Segment=Me.SweepEvent=Me.checkWhichEventIsLeft=Me.addRoute=void 0;var Wq=Gq(Xg()),yE=Ir();function $q(i,e,t){if(e.length<1)return;let n=e[0],r;for(let o=0;o<e.length-1;o++){r=e[o+1];let s=new Ba(i,n,o),a=new Ba(i,r,o+1);s.otherEvent=a,a.otherEvent=s,_E(s,a)>0?(a.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,a.isLeftEndpoint=!1),t.push(s),t.push(a),n=r}}Me.addRoute=$q;function _E(i,e){return i.point.x>e.point.x?1:i.point.x<e.point.x?-1:i.point.y!==e.point.y?i.point.y>e.point.y?1:-1:1}Me.checkWhichEventIsLeft=_E;var Ba=class{constructor(e,t,n){this.edgeId=e,this.point=t,this.segmentIndex=n}};Me.SweepEvent=Ba;var dl=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};Me.Segment=dl;function Xq(i){let e=[],t=new Wq.default([],vE);for(;i.length;){let n=i.pop();if(n?.isLeftEndpoint){let r=new dl(n);for(let o=0;o<t.data.length;o++){let s=t.data[o],a=bE(r,s);a&&e.push({routable1:n.edgeId,routable2:s.leftSweepEvent.edgeId,segmentIndex1:Jg(r),segmentIndex2:Jg(s),intersectionPoint:a})}t.push(r)}else n?.isLeftEndpoint===!1&&t.pop()}return e}Me.runSweep=Xq;function vE(i,e){return i.rightSweepEvent.point.x>e.rightSweepEvent.point.x?1:i.rightSweepEvent.point.x<e.rightSweepEvent.point.x?-1:i.rightSweepEvent.point.y!==e.rightSweepEvent.point.y?i.rightSweepEvent.point.y<e.rightSweepEvent.point.y?1:-1:1}Me.checkWhichSegmentHasRightEndpointFirst=vE;function Jg(i){return Math.min(i.leftSweepEvent.segmentIndex,i.rightSweepEvent.segmentIndex)}Me.getSegmentIndex=Jg;function bE(i,e){if(i.leftSweepEvent.edgeId===e.leftSweepEvent.edgeId)return;let t=new yE.PointToPointLine(i.leftSweepEvent.point,i.rightSweepEvent.point),n=new yE.PointToPointLine(e.leftSweepEvent.point,e.rightSweepEvent.point);return t.intersection(n)}Me.intersectionOfSegments=bE});var ll=f(Be=>{"use strict";var Jq=Be&&Be.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Zq=Be&&Be.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Be,"__esModule",{value:!0});Be.IntersectionFinder=Be.BY_DESCENDING_X_THEN_DESCENDING_Y=Be.BY_X_THEN_DESCENDING_Y=Be.BY_DESCENDING_X_THEN_Y=Be.BY_X_THEN_Y=Be.isIntersectingRoutedPoint=void 0;var Qq=_(),ej=Zq(Xg()),Qg=Zg();function SE(i){return i!==void 0&&"intersections"in i&&"kind"in i}Be.isIntersectingRoutedPoint=SE;var tj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Be.BY_X_THEN_Y=tj;var nj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Be.BY_DESCENDING_X_THEN_Y=nj;var ij=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Be.BY_X_THEN_DESCENDING_Y=ij;var rj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Be.BY_DESCENDING_X_THEN_DESCENDING_Y=rj;var em=class{apply(e){let t=this.find(e);this.addToRouting(t,e)}find(e){let t=new ej.default(void 0,Qg.checkWhichEventIsLeft);return e.routes.forEach((n,r)=>{this.isSupportedRoute(n)&&(0,Qg.addRoute)(r,n,t)}),(0,Qg.runSweep)(t)}isSupportedRoute(e){return e.find(t=>t.kind!=="source"&&t.kind!=="target"&&t.kind!=="linear")===void 0}addToRouting(e,t){for(let n of e){let r=t.get(n.routable1),o=t.get(n.routable2);this.addIntersectionToRoutedPoint(n,r,n.segmentIndex1),this.addIntersectionToRoutedPoint(n,o,n.segmentIndex2)}}addIntersectionToRoutedPoint(e,t,n){if(t&&t.length>n){let r=t[n+1];if(SE(r))r.intersections.push(e);else{let o=Object.assign(Object.assign({},r),{intersections:[e]});t[n+1]=o}}}};em=Jq([(0,Qq.injectable)()],em);Be.IntersectionFinder=em});var Ya=f(Ee=>{"use strict";var za=Ee&&Ee.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gl=Ee&&Ee.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},oj=Ee&&Ee.__param||function(i,e){return function(t,n){e(t,n,i)}},tm;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.LocationPostprocessor=Ee.MoveMouseListener=Ee.MorphEdgesAnimation=Ee.MoveAnimation=Ee.MoveCommand=Ee.MoveAction=void 0;var oi=_(),Fi=Q(),Wo=te(),Fa=or(),sj=pe(),hl=G(),Va=Ke(),wE=P(),aj=Tt(),cj=Ne(),uj=Er(),dj=Ma(),PE=ae(),EE=tg(),fl=Ca(),lj=Xd(),De=me(),pl=fn(),fj=qo(),IE=Et(),hj=An(),$o=Ti(),im;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(im=Ee.MoveAction||(Ee.MoveAction={}));var Ka=tm=class extends sj.MergeableCommand{constructor(e){super(),this.action=e,this.resolvedMoves=new Map,this.edgeMementi=[]}execute(e){let t=e.root.index,n=new Map,r=new Map;return this.action.moves.forEach(o=>{let s=t.getById(o.elementId);if(s instanceof De.SRoutingHandle&&this.edgeRouterRegistry){let a=s.parent;if(a instanceof De.SRoutableElement){let c=this.resolveHandleMove(s,a,o);if(c){let u=n.get(a);u||(u=[],n.set(a,u)),u.push(c)}}}else if(s&&(0,$o.isLocateable)(s)){let a=this.resolveElementMove(s,o);a&&(this.resolvedMoves.set(a.element.id,a),this.edgeRouterRegistry&&t.getAttachedElements(s).forEach(c=>{if(c instanceof De.SRoutableElement){let u=r.get(c),d=Fi.Point.subtract(a.toPosition,a.fromPosition),l=u?Fi.Point.linear(u,d,.5):d;r.set(c,l)}}))}}),this.doMove(n,r),this.action.animate?(this.undoMove(),new Fa.CompoundAnimation(e.root,e,[new Xo(e.root,this.resolvedMoves,e,!1),new Jo(e.root,this.edgeMementi,e,!1)]).start()):e.root}resolveHandleMove(e,t,n){let r=n.fromPosition;if(!r){let o=this.edgeRouterRegistry.get(t.routerKind);r=o.getHandlePosition(t,o.route(t),e)}if(r)return{handle:e,fromPosition:r,toPosition:n.toPosition}}resolveElementMove(e,t){let n=t.fromPosition||{x:e.position.x,y:e.position.y};return{element:e,fromPosition:n,toPosition:t.toPosition}}doMove(e,t){this.resolvedMoves.forEach(n=>{n.element.position=n.toPosition}),e.forEach((n,r)=>{let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);o.applyHandleMoves(r,n);let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}),t.forEach((n,r)=>{if(!e.get(r)){let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);if(r.source&&r.target&&this.resolvedMoves.get(r.source.id)&&this.resolvedMoves.get(r.target.id))r.routingPoints=r.routingPoints.map(c=>Fi.Point.add(c,n));else{let c=(0,IE.isSelectable)(r)&&r.selected;o.cleanupRoutingPoints(r,r.routingPoints,c,this.action.finished)}let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}})}undoMove(){this.resolvedMoves.forEach(e=>{e.element.position=e.fromPosition}),this.edgeMementi.forEach(e=>{this.edgeRouterRegistry.get(e.edge.routerKind).applySnapshot(e.edge,e.before)})}undo(e){return new Fa.CompoundAnimation(e.root,e,[new Xo(e.root,this.resolvedMoves,e,!0),new Jo(e.root,this.edgeMementi,e,!0)]).start()}redo(e){return new Fa.CompoundAnimation(e.root,e,[new Xo(e.root,this.resolvedMoves,e,!1),new Jo(e.root,this.edgeMementi,e,!1)]).start()}merge(e,t){if(!this.action.animate&&e instanceof tm)return e.resolvedMoves.forEach((n,r)=>{let o=this.resolvedMoves.get(r);o?o.toPosition=n.toPosition:this.resolvedMoves.set(r,n)}),e.edgeMementi.forEach(n=>{let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}),!0;if(e instanceof lj.ReconnectCommand){let n=e.memento;if(n){let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}return!0}return!1}};Ka.KIND=im.KIND;za([(0,oi.inject)(pl.EdgeRouterRegistry),(0,oi.optional)(),gl("design:type",pl.EdgeRouterRegistry)],Ka.prototype,"edgeRouterRegistry",void 0);Ka=tm=za([(0,oi.injectable)(),oj(0,(0,oi.inject)(wE.TYPES.Action)),gl("design:paramtypes",[Object])],Ka);Ee.MoveCommand=Ka;var Xo=class extends Fa.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementMoves=t,this.reverse=r}tween(e){return this.elementMoves.forEach(t=>{this.reverse?t.element.position={x:(1-e)*t.toPosition.x+e*t.fromPosition.x,y:(1-e)*t.toPosition.y+e*t.fromPosition.y}:t.element.position={x:(1-e)*t.fromPosition.x+e*t.toPosition.x,y:(1-e)*t.fromPosition.y+e*t.toPosition.y}}),this.model}};Ee.MoveAnimation=Xo;var Jo=class extends Fa.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.reverse=r,this.expanded=[],t.forEach(o=>{let s=this.reverse?o.after:o.before,a=this.reverse?o.before:o.after,c=s.routedPoints,u=a.routedPoints,d=Math.max(c.length,u.length);this.expanded.push({startExpandedRoute:this.growToSize(c,d),endExpandedRoute:this.growToSize(u,d),memento:o})})}midPoint(e){let t=e.edge,n=e.edge.source,r=e.edge.target;return Fi.Point.linear((0,Va.translatePoint)(Fi.Bounds.center(n.bounds),n.parent,t.parent),(0,Va.translatePoint)(Fi.Bounds.center(r.bounds),r.parent,t.parent),.5)}start(){return this.expanded.forEach(e=>{e.memento.edge.removeAll(t=>t instanceof De.SRoutingHandle)}),super.start()}tween(e){return e===1?this.expanded.forEach(t=>{let n=t.memento;this.reverse?n.before.router.applySnapshot(n.edge,n.before):n.after.router.applySnapshot(n.edge,n.after)}):this.expanded.forEach(t=>{let n=[];for(let s=1;s<t.startExpandedRoute.length-1;++s)n.push(Fi.Point.linear(t.startExpandedRoute[s],t.endExpandedRoute[s],e));let r=e<.5?t.memento.before:t.memento.after,o=Object.assign(Object.assign({},r),{routingPoints:n,routingHandles:[]});r.router.applySnapshot(t.memento.edge,o)}),this.model}growToSize(e,t){let n=t-e.length;if(n<=0)return e;let r=[];r.push(e[0]);let o=1/(n+1),s=1/(e.length-1),a=1;for(let c=1;c<e.length;++c){let u=s*c,d=0;for(;u>(a+d)*o;)++d;a+=d;for(let l=0;l<d;++l){let S=Fi.Point.linear(e[c-1],e[c],(l+1)/(d+1));r.push(S)}r.push(e[c])}return r}};Ee.MorphEdgesAnimation=Jo;var Ha=class extends aj.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(e,t){if(t.button===0){let n=(0,Va.findParentByFeature)(e,$o.isMoveable),r=e instanceof De.SRoutingHandle;n!==void 0||r||(0,EE.isCreatingOnDrag)(e)?this.startDragPosition={x:t.pageX,y:t.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,EE.isCreatingOnDrag)(e)?this.startCreatingOnDrag(e,t):r&&this.activateRoutingHandle(e,t)}return[]}startCreatingOnDrag(e,t){let n=[];return n.push(Wo.SelectAllAction.create({select:!1})),n.push(e.createAction(De.edgeInProgressID)),n.push(Wo.SelectAction.create({selectedElementsIDs:[De.edgeInProgressID]})),n.push(fl.SwitchEditModeAction.create({elementsToActivate:[De.edgeInProgressID]})),n.push(Wo.SelectAction.create({selectedElementsIDs:[De.edgeInProgressTargetHandleID]})),n.push(fl.SwitchEditModeAction.create({elementsToActivate:[De.edgeInProgressTargetHandleID]})),n}activateRoutingHandle(e,t){return[fl.SwitchEditModeAction.create({elementsToActivate:[e.id]})]}mouseMove(e,t){let n=[];if(t.buttons===0)this.mouseUp(e,t);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(e.root),this.hasDragged=!0;let r=this.getElementMoves(e,t,!1);r&&n.push(r)}return n}collectStartPositions(e){let t=new Set(e.index.all().filter(n=>(0,IE.isSelectable)(n)&&n.selected));t.forEach(n=>{if(!this.isChildOfSelected(t,n)){if((0,$o.isMoveable)(n))this.elementId2startPos.set(n.id,n.position);else if(n instanceof De.SRoutingHandle){let r=this.getHandlePosition(n);r&&this.elementId2startPos.set(n.id,r)}}})}isChildOfSelected(e,t){for(;t instanceof hl.SChildElement;)if(t=t.parent,(0,$o.isMoveable)(t)&&e.has(t))return!0;return!1}getElementMoves(e,t,n){if(!this.startDragPosition)return;let r=[],o=(0,Va.findParentByFeature)(e,hj.isViewport),s=o?o.zoom:1,a={x:(t.pageX-this.startDragPosition.x)/s,y:(t.pageY-this.startDragPosition.y)/s};if(this.elementId2startPos.forEach((c,u)=>{let d=e.root.index.getById(u);if(d){let l=this.createElementMove(d,c,a,t);l&&r.push(l)}}),r.length>0)return im.create(r,{animate:!1,finished:n})}createElementMove(e,t,n,r){let o=this.snap({x:t.x+n.x,y:t.y+n.y},e,!r.shiftKey);if((0,$o.isMoveable)(e))return{elementId:e.id,elementType:e.type,fromPosition:{x:e.position.x,y:e.position.y},toPosition:o};if(e instanceof De.SRoutingHandle){let s=this.getHandlePosition(e);if(s!==void 0)return{elementId:e.id,elementType:e.type,fromPosition:s,toPosition:o}}}snap(e,t,n){return n&&this.snapper?this.snapper.snap(e,t):e}getHandlePosition(e){if(this.edgeRouterRegistry){let t=e.parent;if(!(t instanceof De.SRoutableElement))return;let n=this.edgeRouterRegistry.get(t.routerKind),r=n.route(t);return n.getHandlePosition(t,r,e)}}mouseEnter(e,t){return e instanceof hl.SModelRoot&&t.buttons===0&&!this.startDragPosition&&this.mouseUp(e,t),[]}mouseUp(e,t){let n=[];if(this.startDragPosition){let r=this.getElementMoves(e,t,!0);r&&n.push(r),e.root.index.all().forEach(o=>{o instanceof De.SRoutingHandle&&n.push(...this.deactivateRoutingHandle(o,e,t))})}if(!n.some(r=>r.kind===Wo.ReconnectAction.KIND)){let r=e.root.index.getById(De.edgeInProgressID);r instanceof hl.SChildElement&&n.push(this.deleteEdgeInProgress(r))}return this.hasDragged&&n.push(dj.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),n}deactivateRoutingHandle(e,t,n){let r=[],o=e.parent;if(o instanceof De.SRoutableElement&&e.danglingAnchor){let s=this.getHandlePosition(e);if(s){let a=(0,Va.translatePoint)(s,e.parent,e.root),c=(0,PE.findChildrenAtPosition)(t.root,a).find(u=>(0,De.isConnectable)(u)&&u.canConnect(o,e.kind));c&&this.hasDragged&&r.push(Wo.ReconnectAction.create({routableId:e.parent.id,newSourceId:e.kind==="source"?c.id:o.sourceId,newTargetId:e.kind==="target"?c.id:o.targetId}))}}return e.editMode&&r.push(fl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),r}deleteEdgeInProgress(e){let t=[];return t.push(De.edgeInProgressID),e.children.forEach(n=>{n instanceof De.SRoutingHandle&&n.danglingAnchor&&t.push(n.danglingAnchor.id)}),Wo.DeleteElementAction.create(t)}decorate(e,t){return e}};za([(0,oi.inject)(pl.EdgeRouterRegistry),(0,oi.optional)(),gl("design:type",pl.EdgeRouterRegistry)],Ha.prototype,"edgeRouterRegistry",void 0);za([(0,oi.inject)(wE.TYPES.ISnapper),(0,oi.optional)(),gl("design:type",Object)],Ha.prototype,"snapper",void 0);Ee.MoveMouseListener=Ha;var nm=class{decorate(e,t){if((0,fj.isEdgeLayoutable)(t)&&t.parent instanceof uj.SEdge)return e;let n="";if((0,$o.isLocateable)(t)&&t instanceof hl.SChildElement&&t.parent!==void 0){let r=t.position;(r.x!==0||r.y!==0)&&(n="translate("+r.x+", "+r.y+")")}if((0,PE.isAlignable)(t)){let r=t.alignment;(r.x!==0||r.y!==0)&&(n.length>0&&(n+=" "),n+="translate("+r.x+", "+r.y+")")}return n.length>0&&(0,cj.setAttr)(e,"transform",n),e}postUpdate(){}};nm=za([(0,oi.injectable)()],nm);Ee.LocationPostprocessor=nm});var RE=f(Zo=>{"use strict";var pj=Zo&&Zo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Zo,"__esModule",{value:!0});Zo.CenterGridSnapper=void 0;var gj=_(),mj=ae(),rm=class{get gridX(){return 10}get gridY(){return 10}snap(e,t){return t&&(0,mj.isBoundsAware)(t)?{x:Math.round((e.x+.5*t.bounds.width)/this.gridX)*this.gridX-.5*t.bounds.width,y:Math.round((e.y+.5*t.bounds.height)/this.gridY)*this.gridY-.5*t.bounds.height}:{x:Math.round(e.x/this.gridX)*this.gridX,y:Math.round(e.y/this.gridY)*this.gridY}}};rm=pj([(0,gj.injectable)()],rm);Zo.CenterGridSnapper=rm});var om=f(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.isOpenable=Cr.openFeature=void 0;Cr.openFeature=Symbol("openFeature");function yj(i){return i.hasFeature(Cr.openFeature)}Cr.isOpenable=yj});var am=f(ml=>{"use strict";Object.defineProperty(ml,"__esModule",{value:!0});ml.OpenMouseListener=void 0;var _j=te(),vj=Tt(),bj=Ke(),Sj=om(),sm=class extends vj.MouseListener{doubleClick(e,t){let n=(0,bj.findParentByFeature)(e,Sj.isOpenable);return n!==void 0?[_j.OpenAction.create(n.id)]:[]}};ml.OpenMouseListener=sm});var vl=f(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.getModelBounds=Ln.getProjectedBounds=Ln.getProjections=Ln.isProjectable=void 0;var Ej=Q(),wj=_n(),ME=Ke(),_l=ae();function OE(i){return(0,wj.hasOwnProperty)(i,"projectionCssClasses")}Ln.isProjectable=OE;function TE(i){let e;for(let t of i.children){if(OE(t)&&t.projectionCssClasses.length>0){let n=AE(t);if(n){let r={elementId:t.id,projectedBounds:n,cssClasses:t.projectionCssClasses};e?e.push(r):e=[r]}}if(t.children.length>0){let n=TE(t);n&&(e?e.push(...n):e=n)}}return e}Ln.getProjections=TE;function AE(i){let e=i.parent;if(i.projectedBounds){let t=i.projectedBounds;return(0,_l.isBoundsAware)(e)&&(t=(0,ME.transformToRootBounds)(e,t)),t}else if((0,_l.isBoundsAware)(i)){let t=i.bounds;return t=(0,ME.transformToRootBounds)(e,t),t}}Ln.getProjectedBounds=AE;var yl=1e9;function Pj(i){let e=yl,t=yl,n=-yl,r=-yl,o=(0,_l.isBoundsAware)(i)?i.bounds:void 0;if(o&&Ej.Dimension.isValid(o))e=o.x,t=o.y,n=e+o.width,r=t+o.height;else for(let s of i.children)if((0,_l.isBoundsAware)(s)){let a=s.bounds;e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x+a.width),r=Math.max(r,a.y+a.height)}if(e=Math.min(e,i.scroll.x),t=Math.min(t,i.scroll.y),n=Math.max(n,i.scroll.x+i.canvasBounds.width/i.zoom),r=Math.max(r,i.scroll.y+i.canvasBounds.height/i.zoom),e<n&&t<r)return{x:e,y:t,width:n-e,height:r-t}}Ln.getModelBounds=Pj});var qE=f(Qo=>{"use strict";var Ij=Qo&&Qo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Qo,"__esModule",{value:!0});Qo.ProjectedViewportView=void 0;var bl=Gt(),Rj=_(),CE=uo(),xE=Ne(),DE=vl(),cm=class{render(e,t,n){let r=(0,bl.html)("div",{"class-sprotty-root":!0},this.renderSvg(e,t,n),this.renderProjections(e,t,n));return(0,xE.setAttr)(r,"tabindex",0),r}renderSvg(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`,o="http://www.w3.org/2000/svg";return(0,CE.h)("svg",{ns:o},(0,CE.h)("g",{ns:o,attrs:{transform:r}},t.renderChildren(e)))}renderProjections(e,t,n){var r;if(e.zoom<=0)return[];let o=(0,DE.getModelBounds)(e);if(!o)return[];let s=(r=(0,DE.getProjections)(e))!==null&&r!==void 0?r:[];return[this.renderProjectionBar(s,e,o,"vertical"),this.renderProjectionBar(s,e,o,"horizontal")]}renderProjectionBar(e,t,n,r){let o={modelBounds:n,orientation:r};return o.factor=r==="horizontal"?t.canvasBounds.width/n.width:t.canvasBounds.height/n.height,o.zoomedFactor=o.factor/t.zoom,(0,bl.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":r==="horizontal","class-vertical":r==="vertical"},this.renderViewport(t,o),e.map(s=>this.renderProjection(s,t,o)))}renderViewport(e,t){let n,r;t.orientation==="horizontal"?(n=e.canvasBounds.width,r=(e.scroll.x-t.modelBounds.x)*t.factor):(n=e.canvasBounds.height,r=(e.scroll.y-t.modelBounds.y)*t.factor);let o=n*t.zoomedFactor;r<0?(o+=r,r=0):r>n&&(r=n),o<0?o=0:r+o>n&&(o=n-r);let s=t.orientation==="horizontal"?{left:`${r}px`,width:`${o}px`}:{top:`${r}px`,height:`${o}px`};return(0,bl.html)("div",{"class-sprotty-viewport":!0,style:s})}renderProjection(e,t,n){let r,o,s;n.orientation==="horizontal"?(r=t.canvasBounds.width,o=(e.projectedBounds.x-n.modelBounds.x)*n.factor,s=e.projectedBounds.width*n.factor):(r=t.canvasBounds.height,o=(e.projectedBounds.y-n.modelBounds.y)*n.factor,s=e.projectedBounds.height*n.factor),o<0?(s+=o,o=0):o>r&&(o=r),s<0?s=0:o+s>r&&(s=r-o);let a=n.orientation==="horizontal"?{left:`${o}px`,width:`${s}px`}:{top:`${o}px`,height:`${s}px`},c=(0,bl.html)("div",{id:`${n.orientation}-projection:${e.elementId}`,"class-sprotty-projection":!0,style:a});return e.cssClasses.forEach(u=>(0,xE.setClass)(c,u,!0)),c}};cm=Ij([(0,Rj.injectable)()],cm);Qo.ProjectedViewportView=cm});var Sl=f(Bn=>{"use strict";var pm=Bn&&Bn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.DiamondAnchor=Bn.RectangleAnchor=Bn.EllipseAnchor=void 0;var gm=ti(),um=Ir(),mm=_(),ym=Sa(),es=Q(),dm=class{get kind(){return ym.PolylineEdgeRouter.KIND+":"+gm.ELLIPTIC_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=es.Bounds.center(r),s=o.x-t.x,a=o.y-t.y,c=Math.sqrt(s*s+a*a),u=s/c||0,d=a/c||0;return{x:o.x-u*(.5*r.width+n),y:o.y-d*(.5*r.height+n)}}};dm=pm([(0,mm.injectable)()],dm);Bn.EllipseAnchor=dm;var lm=class{get kind(){return ym.PolylineEdgeRouter.KIND+":"+gm.RECTANGULAR_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=es.Bounds.center(r),s=new fm(o,t);if(!(0,es.almostEquals)(o.y,t.y)){let a=this.getXIntersection(r.y,o,t);a>=r.x&&a<=r.x+r.width&&s.addCandidate(a,r.y-n);let c=this.getXIntersection(r.y+r.height,o,t);c>=r.x&&c<=r.x+r.width&&s.addCandidate(c,r.y+r.height+n)}if(!(0,es.almostEquals)(o.x,t.x)){let a=this.getYIntersection(r.x,o,t);a>=r.y&&a<=r.y+r.height&&s.addCandidate(r.x-n,a);let c=this.getYIntersection(r.x+r.width,o,t);c>=r.y&&c<=r.y+r.height&&s.addCandidate(r.x+r.width+n,c)}return s.best}getXIntersection(e,t,n){let r=(e-t.y)/(n.y-t.y);return(n.x-t.x)*r+t.x}getYIntersection(e,t,n){let r=(e-t.x)/(n.x-t.x);return(n.y-t.y)*r+t.y}};lm=pm([(0,mm.injectable)()],lm);Bn.RectangleAnchor=lm;var fm=class{constructor(e,t){this.centerPoint=e,this.refPoint=t,this.currentDist=-1}addCandidate(e,t){let n=this.refPoint.x-e,r=this.refPoint.y-t,o=n*n+r*r;(this.currentDist<0||o<this.currentDist)&&(this.currentBest={x:e,y:t},this.currentDist=o)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}},hm=class{get kind(){return ym.PolylineEdgeRouter.KIND+":"+gm.DIAMOND_ANCHOR_KIND}getAnchor(e,t,n){let r=e.bounds,o=new um.PointToPointLine(es.Bounds.center(r),t),s=new um.Diamond(r).closestSideLine(t),a=(0,um.intersection)(s,o);return es.Point.shiftTowards(a,t,n)}};hm=pm([(0,mm.injectable)()],hm);Bn.DiamondAnchor=hm});var Il=f(ke=>{"use strict";var BE=ke&&ke.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Mj=ke&&ke.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},jE=ke&&ke.__param||function(i,e){return function(t,n){e(t,n,i)}},ka;Object.defineProperty(ke,"__esModule",{value:!0});ke.AddRemoveBezierSegmentCommand=ke.AddRemoveBezierSegmentAction=ke.BezierMouseListener=ke.BezierEdgeRouter=void 0;var El=_(),NE=Q(),Vi=me(),LE=fn(),Oj=va(),Tj=Tt(),Aj=pe(),Cj=P(),ts=ka=class extends Oj.AbstractEdgeRouter{get kind(){return ka.KIND}route(e){if(!e.source||!e.target)return[];let t=e.routingPoints.length,n=e.source,r=e.target,o=[];if(o.push({kind:"source",x:0,y:0}),t===0){let[d,l]=this.createDefaultBezierHandles(n.position,r.position);o.push({kind:"bezier-control-after",x:d.x,y:d.y,pointIndex:0}),o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:1}),e.routingPoints.push(d),e.routingPoints.push(l)}else if(t>=2)for(let d=0;d<t;d++){let l=e.routingPoints[d];d%3===0&&o.push({kind:"bezier-control-after",x:l.x,y:l.y,pointIndex:d}),(d+1)%3===0?o.push({kind:"bezier-junction",x:l.x,y:l.y,pointIndex:d}):(d+2)%3===0&&o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:d})}o.push({kind:"target",x:0,y:0});let s=t>2?e.routingPoints[2]:r.position,a=t>2?e.routingPoints[e.routingPoints.length-3]:n.position,c=this.getTranslatedAnchor(n,s,r.parent,e,e.sourceAnchorCorrection),u=this.getTranslatedAnchor(r,a,n.parent,e,e.targetAnchorCorrection);return o[0]={kind:"source",x:c.x,y:c.y},o[o.length-1]={kind:"target",x:u.x,y:u.y},o}createDefaultBezierHandles(e,t){let n={x:e.x-ka.DEFAULT_BEZIER_HANDLE_OFFSET,y:e.y},r={x:t.x+ka.DEFAULT_BEZIER_HANDLE_OFFSET,y:t.y};return[n,r]}createRoutingHandles(e){this.route(e),this.rebuildHandles(e)}rebuildHandles(e){this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"bezier-control-after","bezier-routing-point",0),this.addHandle(e,"bezier-add","bezier-create-routing-point",0);let t=e.routingPoints.length;if(t>2)for(let n=1;n<t-1;n+=3)this.addHandle(e,"bezier-control-before","bezier-routing-point",n),this.addHandle(e,"bezier-add","bezier-create-routing-point",n+1),this.addHandle(e,"bezier-junction","routing-point",n+1),this.addHandle(e,"bezier-remove","bezier-remove-routing-point",n+1),this.addHandle(e,"bezier-control-after","bezier-routing-point",n+2),this.moveBezierControlPair(e.routingPoints[n],n,e);this.addHandle(e,"bezier-control-before","bezier-routing-point",t-1),this.addHandle(e,"target","routing-point",-1)}getInnerHandlePosition(e,t,n){if(n.kind==="bezier-control-before"||n.kind==="bezier-junction"||n.kind==="bezier-control-after")for(let r=0;r<t.length;r++){let o=t[r];if(o.pointIndex===n.pointIndex&&o.kind===n.kind)return o}else if(n.kind==="bezier-add"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y+12.5}}else if(n.kind==="bezier-remove"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y-12.5}}}findBezierControl(e,t,n){let r={x:t[0].x,y:t[0].y};if(n>0){for(let o of t)if(o.pointIndex!==void 0&&o.pointIndex===n&&o.kind==="bezier-junction"){r={x:o.x,y:o.y};break}}return r}applyHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o={x:0,y:0},s,a,c,u=n.toPosition;switch(r.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(u,n.handle.pointIndex,e);break;case"bezier-junction":let d=r.pointIndex;d>=0&&d<e.routingPoints.length&&(c=d-1,o=e.routingPoints[d],s=e.routingPoints[c],a=this.calcRelativeMove(o,u,s),e.routingPoints[d]=u,this.moveBezierControlPair(a,c,e));break;case"source":if(c=0,s=e.routingPoints[c],e.source instanceof Vi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Vi.SDanglingAnchor;l.id=e.id+"_dangling-source",l.original=e.source,l.position=n.toPosition,r.root.add(l),r.danglingAnchor=l,e.sourceId=l.id,e.source&&(o=e.source.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;case"target":if(c=e.routingPoints.length-1,s=e.routingPoints[c],e.target instanceof Vi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Vi.SDanglingAnchor;l.id=e.id+"_dangling-target",l.original=e.target,l.position=u,r.root.add(l),r.danglingAnchor=l,e.targetId=l.id,e.target&&(o=e.target.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;default:break}})}applyInnerHandleMoves(e,t){}getOptions(e){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(e,t,n){return{x:n.x-(e.x-t.x),y:n.y-(e.y-t.y)}}createNewBezierSegment(e,t){let n=t.routingPoints,r,o,s;n.length===2?(o=n[e<0?0:e],s=n[n.length-1],r=(0,NE.centerOfLine)(o,s)):(o=n[e],s=n[e+2],r=(0,NE.centerOfLine)(o,s));let[a,c]=this.createDefaultBezierHandles(r,r);n.splice(e+1,0,a),n.splice(e+2,0,r),n.splice(e+3,0,c),this.moveBezierControlPair(a,e+1,t),t.removeAll(u=>u instanceof Vi.SRoutingHandle),this.rebuildHandles(t)}removeBezierSegment(e,t){t.routingPoints.splice(e-1,3),t.removeAll(r=>r instanceof Vi.SRoutingHandle),this.rebuildHandles(t)}moveBezierControlPair(e,t,n){if(t>=0&&t<n.routingPoints.length){let r=t-1,o=t+1;r<0||o===n.routingPoints.length?n.routingPoints[t]=e:t%3===0?this.setBezierMirror(n,e,t,!1):(t+2)%3===0&&this.setBezierMirror(n,e,t,!0)}}setBezierMirror(e,t,n,r){e.routingPoints[n]=t;let o=e.routingPoints[r?n+1:n-1];e.routingPoints[r?n+2:n-2]={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)}}};ts.KIND="bezier";ts.DEFAULT_BEZIER_HANDLE_OFFSET=25;ts=ka=BE([(0,El.injectable)()],ts);ke.BezierEdgeRouter=ts;var _m=class extends Tj.MouseListener{mouseDown(e,t){let n=[];return e instanceof Vi.SRoutingHandle&&(e.kind==="bezier-add"||e.kind==="bezier-remove")&&(e.type==="bezier-create-routing-point"?n.push(wl.create("add",e.id)):e.type==="bezier-remove-routing-point"&&n.push(wl.create("remove",e.id))),n}};ke.BezierMouseListener=_m;var wl;(function(i){i.KIND="addRemoveBezierSegment";function e(t,n){return{kind:i.KIND,actionTask:t,targetId:n}}i.create=e})(wl=ke.AddRemoveBezierSegmentAction||(ke.AddRemoveBezierSegmentAction={}));var Pl=class extends Aj.Command{constructor(e,t){super(),this.action=e,this.edgeRouterRegistry=t}execute(e){let n=e.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&n instanceof Vi.SRoutingHandle){let r=this.edgeRouterRegistry.get(n.parent.routerKind);if(r instanceof ts){let o=r;for(let s of e.root.children)if(s.id===n.parent.id){this.action.actionTask==="add"?o.createNewBezierSegment(n.pointIndex,s):this.action.actionTask==="remove"&&o.removeBezierSegment(n.pointIndex,s);break}}}return e.root}undo(e){throw new Error("Method not implemented.")}redo(e){throw new Error("Method not implemented.")}};Pl.KIND=wl.KIND;Pl=BE([(0,El.injectable)(),jE(0,(0,El.inject)(Cj.TYPES.Action)),jE(1,(0,El.inject)(LE.EdgeRouterRegistry)),Mj("design:paramtypes",[Object,LE.EdgeRouterRegistry])],Pl);ke.AddRemoveBezierSegmentCommand=Pl});var Mm=f(Fn=>{"use strict";var Em=Fn&&Fn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.BezierDiamondAnchor=Fn.BezierRectangleAnchor=Fn.BezierEllipseAnchor=void 0;var wm=ti(),Pm=_(),Im=Sl(),Rm=Il(),vm=class extends Im.EllipseAnchor{get kind(){return Rm.BezierEdgeRouter.KIND+":"+wm.ELLIPTIC_ANCHOR_KIND}};vm=Em([(0,Pm.injectable)()],vm);Fn.BezierEllipseAnchor=vm;var bm=class extends Im.RectangleAnchor{get kind(){return Rm.BezierEdgeRouter.KIND+":"+wm.RECTANGULAR_ANCHOR_KIND}};bm=Em([(0,Pm.injectable)()],bm);Fn.BezierRectangleAnchor=bm;var Sm=class extends Im.DiamondAnchor{get kind(){return Rm.BezierEdgeRouter.KIND+":"+wm.DIAMOND_ANCHOR_KIND}};Sm=Em([(0,Pm.injectable)()],Sm);Fn.BezierDiamondAnchor=Sm});var Ml=f(Rl=>{"use strict";Object.defineProperty(Rl,"__esModule",{value:!0});Rl.ManhattanEdgeRouter=void 0;var ye=Q(),FE=Ke(),b=va(),Om=me(),ns=class extends b.AbstractEdgeRouter{get kind(){return ns.KIND}getOptions(e){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(e){if(!e.source||!e.target)return[];let t=this.createRoutedCorners(e),n=t[0]||(0,FE.translatePoint)(ye.Bounds.center(e.target.bounds),e.target.parent,e.parent),r=this.getTranslatedAnchor(e.source,n,e.parent,e,e.sourceAnchorCorrection),o=t[t.length-1]||(0,FE.translatePoint)(ye.Bounds.center(e.source.bounds),e.source.parent,e.parent),s=this.getTranslatedAnchor(e.target,o,e.parent,e,e.targetAnchorCorrection);if(!r||!s)return[];let a=[];return a.push(Object.assign({kind:"source"},r)),t.forEach(c=>a.push(c)),a.push(Object.assign({kind:"target"},s)),a}createRoutedCorners(e){let t=new b.DefaultAnchors(e.source,e.parent,"source"),n=new b.DefaultAnchors(e.target,e.parent,"target");if(e.routingPoints.length>0){let s=e.routingPoints.slice();if(this.cleanupRoutingPoints(e,s,!1,!0),s.length>0)return s.map((a,c)=>Object.assign({kind:"linear",pointIndex:c},a))}let r=this.getOptions(e);return this.calculateDefaultCorners(e,t,n,r).map(s=>Object.assign({kind:"linear"},s))}createRoutingHandles(e){let t=this.route(e);if(this.commitRoute(e,t),t.length>0){this.addHandle(e,"source","routing-point",-2);for(let n=0;n<t.length-1;++n)this.addHandle(e,"manhattan-50%","volatile-routing-point",n-1);this.addHandle(e,"target","routing-point",t.length-2)}}getInnerHandlePosition(e,t,n){let r=this.getFraction(n.kind);if(r!==void 0){let{start:o,end:s}=this.findRouteSegment(e,t,n.pointIndex);if(o!==void 0&&s!==void 0)return ye.Point.linear(o,s,r)}}getFraction(e){switch(e){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(e,t){let n=this.route(e),r=e.routingPoints,o=this.getOptions(e).minimalPointDistance;t.forEach(s=>{let a=s.handle,c=a.pointIndex,u=this.correctX(r,c,s.toPosition.x,o),d=this.correctY(r,c,s.toPosition.y,o);switch(a.kind){case"manhattan-50%":c<0?(0,ye.almostEquals)(n[0].x,n[1].x)?this.alignX(r,0,u):this.alignY(r,0,d):c<r.length-1?(0,ye.almostEquals)(r[c].x,r[c+1].x)?(this.alignX(r,c,u),this.alignX(r,c+1,u)):(this.alignY(r,c,d),this.alignY(r,c+1,d)):(0,ye.almostEquals)(n[n.length-2].x,n[n.length-1].x)?this.alignX(r,r.length-1,u):this.alignY(r,r.length-1,d);break}})}correctX(e,t,n,r){return t>0&&Math.abs(n-e[t-1].x)<r?e[t-1].x:t<e.length-2&&Math.abs(n-e[t+2].x)<r?e[t+2].x:n}alignX(e,t,n){t>=0&&t<e.length&&(e[t]={x:n,y:e[t].y})}correctY(e,t,n,r){return t>0&&Math.abs(n-e[t-1].y)<r?e[t-1].y:t<e.length-2&&Math.abs(n-e[t+2].y)<r?e[t+2].y:n}alignY(e,t,n){t>=0&&t<e.length&&(e[t]={x:e[t].x,y:n})}cleanupRoutingPoints(e,t,n,r){let o=new b.DefaultAnchors(e.source,e.parent,"source"),s=new b.DefaultAnchors(e.target,e.parent,"target");if(!this.resetRoutingPointsOnReconnect(e,t,n,o,s)){for(let a=0;a<t.length&&ye.Bounds.includes(o.bounds,t[a]);++a)t.splice(0,1),n&&this.removeHandle(e,-1);for(let a=t.length-1;a>=0&&ye.Bounds.includes(s.bounds,t[a]);--a)t.splice(a,1),n&&this.removeHandle(e,a);if(t.length>=2){let a=this.getOptions(e);for(let c=t.length-2;c>=0;--c)ye.Point.manhattanDistance(t[c],t[c+1])<a.minimalPointDistance&&(t.splice(c,2),--c,n&&(this.removeHandle(e,c-1),this.removeHandle(e,c)))}r&&(this.addAdditionalCorner(e,t,o,s,n),this.addAdditionalCorner(e,t,s,o,n),this.manhattanify(e,t))}}removeHandle(e,t){let n=[];e.children.forEach(r=>{r instanceof Om.SRoutingHandle&&(r.pointIndex>t?--r.pointIndex:r.pointIndex===t&&n.push(r))}),n.forEach(r=>e.remove(r))}addAdditionalCorner(e,t,n,r,o){if(t.length===0)return;let s=n.kind==="source"?t[0]:t[t.length-1],a=n.kind==="source"?0:t.length,c=a-(n.kind==="source"?1:0),u;if(t.length>1)u=a===0?(0,ye.almostEquals)(t[0].x,t[1].x):(0,ye.almostEquals)(t[t.length-1].x,t[t.length-2].x);else{let d=r.getNearestSide(s);u=d===b.Side.TOP||d===b.Side.BOTTOM}if(u){if(s.y<n.get(b.Side.TOP).y||s.y>n.get(b.Side.BOTTOM).y){let d={x:n.get(b.Side.TOP).x,y:s.y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Om.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}else if(s.x<n.get(b.Side.LEFT).x||s.x>n.get(b.Side.RIGHT).x){let d={x:s.x,y:n.get(b.Side.LEFT).y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Om.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}manhattanify(e,t){for(let n=1;n<t.length;++n){let r=Math.abs(t[n-1].x-t[n].x)<1,o=Math.abs(t[n-1].y-t[n].y)<1;!r&&!o&&(t.splice(n,0,{x:t[n-1].x,y:t[n].y}),++n)}}calculateDefaultCorners(e,t,n,r){let o=super.calculateDefaultCorners(e,t,n,r);if(o.length>0)return o;let s=this.getBestConnectionAnchors(e,t,n,r),a=s.source,c=s.target,u=[],d=t.get(a),l=n.get(c);switch(a){case b.Side.RIGHT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;case b.Side.RIGHT:u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:d.y}),u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:l.y});break;case b.Side.LEFT:l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.LEFT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;default:l=n.get(b.Side.RIGHT),l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.TOP:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.TOP:u.push({x:d.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance}),u.push({x:l.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance});break;case b.Side.BOTTOM:l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break;case b.Side.BOTTOM:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;default:l=n.get(b.Side.TOP),l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break}return u}getBestConnectionAnchors(e,t,n,r){let o=t.get(b.Side.RIGHT),s=n.get(b.Side.LEFT);if(s.x-o.x>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.LEFT};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.RIGHT),o.x-s.x>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.RIGHT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.BOTTOM),o.y-s.y>r.standardDistance)return{source:b.Side.TOP,target:b.Side.BOTTOM};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.TOP),s.y-o.y>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.TOP};if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.TOP),s.x-o.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.TOP};if(s=n.get(b.Side.BOTTOM),s.x-o.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.BOTTOM};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.BOTTOM),o.x-s.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.BOTTOM};if(s=n.get(b.Side.TOP),o.x-s.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.TOP};if(o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),o.y-s.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),o.y-s.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.LEFT};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),s.y-o.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),s.y-o.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.LEFT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.TOP),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)){if(o.y-s.y<0){if(Math.abs(o.x-s.x)>(t.bounds.width+r.standardDistance)/2)return{source:b.Side.TOP,target:b.Side.TOP}}else if(Math.abs(o.x-s.x)>n.bounds.width/2)return{source:b.Side.TOP,target:b.Side.TOP}}if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)){if(o.x-s.x>0){if(Math.abs(o.y-s.y)>(t.bounds.height+r.standardDistance)/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}else if(Math.abs(o.y-s.y)>n.bounds.height/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}return o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.LEFT}:(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ye.Bounds.includes(n.bounds,o)&&!ye.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.LEFT}:{source:b.Side.RIGHT,target:b.Side.BOTTOM})))}};Rl.ManhattanEdgeRouter=ns;ns.KIND="manhattan"});var Nm=f(Vn=>{"use strict";var xm=Vn&&Vn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Tm,Am,Cm;Object.defineProperty(Vn,"__esModule",{value:!0});Vn.ManhattanEllipticAnchor=Vn.ManhattanDiamondAnchor=Vn.ManhattanRectangularAnchor=void 0;var Ol=Q(),Bt=Ir(),Dm=ti(),qm=Ml(),jm=_(),Tl=Tm=class{get kind(){return Tm.KIND}getAnchor(e,t,n){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n};return t.x>=o.x&&o.x+o.width>=t.x?t.y<o.y+.5*o.height?{x:t.x,y:o.y}:{x:t.x,y:o.y+o.height}:t.y>=o.y&&o.y+o.height>=t.y?t.x<o.x+.5*o.width?{x:o.x,y:t.y}:{x:o.x+o.width,y:t.y}:Ol.Bounds.center(o)}};Tl.KIND=qm.ManhattanEdgeRouter.KIND+":"+Dm.RECTANGULAR_ANCHOR_KIND;Tl=Tm=xm([(0,jm.injectable)()],Tl);Vn.ManhattanRectangularAnchor=Tl;var Al=Am=class{get kind(){return Am.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Ol.Bounds.center(o),a,c;return t.x>=o.x&&t.x<=o.x+o.width?o.x+.5*o.width>=t.x?(c=new Bt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height})):(c=new Bt.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height})):t.y>=o.y&&t.y<=o.y+o.height&&(o.y+.5*o.height>=t.y?(c=new Bt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y})):(c=new Bt.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Bt.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height}):a=new Bt.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height}))),c&&a?(0,Bt.intersection)(a,c):s}};Al.KIND=qm.ManhattanEdgeRouter.KIND+":"+Dm.DIAMOND_ANCHOR_KIND;Al=Am=xm([(0,jm.injectable)()],Al);Vn.ManhattanDiamondAnchor=Al;var Cl=Cm=class{get kind(){return Cm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Ol.Bounds.center(o),a=Ol.Point.subtract(t,s),c=s.x,u=s.y;if(t.x>=o.x&&o.x+o.width>=t.x){c+=a.x;let d=.5*o.height*Math.sqrt(1-a.x*a.x/(.25*o.width*o.width));a.y<0?u-=d:u+=d}else if(t.y>=o.y&&o.y+o.height>=t.y){u+=a.y;let d=.5*o.width*Math.sqrt(1-a.y*a.y/(.25*o.height*o.height));a.x<0?c-=d:c+=d}return{x:c,y:u}}};Cl.KIND=qm.ManhattanEdgeRouter.KIND+":"+Dm.ELLIPTIC_ANCHOR_KIND;Cl=Cm=xm([(0,jm.injectable)()],Cl);Vn.ManhattanEllipticAnchor=Cl});var Bm=f(is=>{"use strict";var xj=is&&is.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(is,"__esModule",{value:!0});is.RoutableView=void 0;var Dj=_(),qj=me(),Lm=class{isVisible(e,t,n){if(n.targetKind==="hidden"||t.length===0)return!0;let r=(0,qj.getAbsoluteRouteBounds)(e,t),o=e.root.canvasBounds;return r.x<=o.width&&r.x+r.width>=0&&r.y<=o.height&&r.y+r.height>=0}};Lm=xj([(0,Dj.injectable)()],Lm);is.RoutableView=Lm});var Fm=f(Ki=>{"use strict";var VE=Ki&&Ki.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jj=Ki&&Ki.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.ModelRequestCommand=void 0;var KE=_(),Nj=P(),Lj=pe(),xl=class extends Lj.SystemCommand{execute(e){let t=this.retrieveResult(e);return this.actionDispatcher.dispatch(t),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};VE([(0,KE.inject)(Nj.TYPES.IActionDispatcher),jj("design:type",Object)],xl.prototype,"actionDispatcher",void 0);xl=VE([(0,KE.injectable)()],xl);Ki.ModelRequestCommand=xl});var Hl=f(re=>{"use strict";var Fl=re&&re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Vl=re&&re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},zm=re&&re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(re,"__esModule",{value:!0});re.SelectKeyboardListener=re.GetSelectionCommand=re.SelectMouseListener=re.SelectAllCommand=re.SelectCommand=re.SelectionResult=re.GetSelectionAction=re.SelectAllAction=re.SelectAction=void 0;var Hi=_(),Kl=te(),YE=pe(),Bj=Fm(),Km=G(),Vm=Ke(),Ym=P(),Fj=an(),Vj=Tt(),Kj=Ne(),HE=In(),kE=tr(),Hj=Rn(),zE=da(),zj=fd(),Dl=Ca(),Yj=me(),ql=me(),si=Et(),Kn=class{constructor(e=[],t=[]){this.selectedElementsIDs=e,this.deselectedElementsIDs=t,this.kind=Kn.KIND}};re.SelectAction=Kn;Kn.KIND="elementSelected";var xr=class{constructor(e=!0){this.select=e,this.kind=xr.KIND}};re.SelectAllAction=xr;xr.KIND="allSelected";var UE;(function(i){i.KIND="getSelection";function e(){return{kind:i.KIND,requestId:(0,Kl.generateRequestId)()}}i.create=e})(UE=re.GetSelectionAction||(re.GetSelectionAction={}));var GE;(function(i){i.KIND="selectionResult";function e(t,n){return{kind:i.KIND,selectedElementsIDs:t,responseId:n}}i.create=e})(GE=re.SelectionResult||(re.SelectionResult={}));var jl=class extends YE.Command{constructor(e){super(),this.action=e,this.selected=[],this.deselected=[]}execute(e){let t=e.root;return this.action.selectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Km.SChildElement&&(0,si.isSelectable)(r)&&this.selected.push(r)}),this.action.deselectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Km.SChildElement&&(0,si.isSelectable)(r)&&this.deselected.push(r)}),this.redo(e)}undo(e){for(let t of this.selected)t.selected=!1;for(let t of this.deselected)t.selected=!0;return e.root}redo(e){for(let t of this.deselected)t.selected=!1;for(let t of this.selected)t.selected=!0;return e.root}};jl.KIND=Kl.SelectAction.KIND;jl=Fl([(0,Hi.injectable)(),zm(0,(0,Hi.inject)(Ym.TYPES.Action)),Vl("design:paramtypes",[Object])],jl);re.SelectCommand=jl;var Nl=class extends YE.Command{constructor(e){super(),this.action=e,this.previousSelection={}}execute(e){return this.selectAll(e.root,this.action.select),e.root}selectAll(e,t){(0,si.isSelectable)(e)&&(this.previousSelection[e.id]=e.selected,e.selected=t);for(let n of e.children)this.selectAll(n,t)}undo(e){let t=e.root.index;return Object.keys(this.previousSelection).forEach(n=>{let r=t.getById(n);r!==void 0&&(0,si.isSelectable)(r)&&(r.selected=this.previousSelection[n])}),e.root}redo(e){return this.selectAll(e.root,this.action.select),e.root}};Nl.KIND=Kl.SelectAllAction.KIND;Nl=Fl([(0,Hi.injectable)(),zm(0,(0,Hi.inject)(Ym.TYPES.Action)),Vl("design:paramtypes",[Object])],Nl);re.SelectAllCommand=Nl;var Ll=class extends Vj.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1}mouseDown(e,t){if(t.button!==0)return[];let n=this.handleButton(e,t);if(n)return n;let r=(0,Vm.findParentByFeature)(e,si.isSelectable);if(r!==void 0||e instanceof Km.SModelRoot){this.hasDragged=!1;let o=[];if((0,HE.isCtrlOrCmd)(t)||(o=(0,kE.toArray)(e.root.index.all().filter(s=>(0,si.isSelectable)(s)&&s.selected&&!(r instanceof Yj.SRoutingHandle&&s===r.parent)))),r!==void 0)if(r.selected){if((0,HE.isCtrlOrCmd)(t))return this.wasSelected=!1,this.handleDeselectTarget(r,t);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(r,o,t);else return this.handleDeselectAll(o,t)}return[]}handleButton(e,t){if(this.buttonHandlerRegistry!==void 0&&e instanceof zj.SButton&&e.enabled){let n=this.buttonHandlerRegistry.get(e.type);if(n!==void 0)return n.buttonPressed(e)}}handleSelectTarget(e,t,n){let r=[];r.push(new Kn([e.id],t.map(s=>s.id))),r.push(Kl.BringToFrontAction.create([e.id]));let o=t.filter(s=>s instanceof ql.SRoutableElement).map(s=>s.id);return e instanceof ql.SRoutableElement?r.push(Dl.SwitchEditModeAction.create({elementsToActivate:[e.id],elementsToDeactivate:o})):o.length>0&&r.push(Dl.SwitchEditModeAction.create({elementsToDeactivate:o})),r}handleDeselectTarget(e,t){let n=[];return n.push(new Kn([],[e.id])),e instanceof ql.SRoutableElement&&n.push(Dl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),n}handleDeselectAll(e,t){let n=[];n.push(new Kn([],e.map(o=>o.id)));let r=e.filter(o=>o instanceof ql.SRoutableElement).map(o=>o.id);return r.length>0&&n.push(Dl.SwitchEditModeAction.create({elementsToDeactivate:r})),n}mouseMove(e,t){return this.hasDragged=!0,[]}mouseUp(e,t){if(t.button===0&&!this.hasDragged){let n=(0,Vm.findParentByFeature)(e,si.isSelectable);if(n!==void 0&&this.wasSelected)return[new Kn([n.id],[])]}return this.hasDragged=!1,[]}decorate(e,t){let n=(0,Vm.findParentByFeature)(t,si.isSelectable);return n!==void 0&&(0,Kj.setClass)(e,"selected",n.selected),e}};Fl([(0,Hi.inject)(zE.ButtonHandlerRegistry),(0,Hi.optional)(),Vl("design:type",zE.ButtonHandlerRegistry)],Ll.prototype,"buttonHandlerRegistry",void 0);re.SelectMouseListener=Ll;var Bl=class extends Bj.ModelRequestCommand{constructor(e){super(),this.action=e,this.previousSelection={}}retrieveResult(e){let t=e.root.index.all().filter(n=>(0,si.isSelectable)(n)&&n.selected).map(n=>n.id);return GE.create((0,kE.toArray)(t),this.action.requestId)}};Bl.KIND=UE.KIND;Bl=Fl([(0,Hi.injectable)(),zm(0,(0,Hi.inject)(Ym.TYPES.Action)),Vl("design:paramtypes",[Object])],Bl);re.GetSelectionCommand=Bl;var Hm=class extends Fj.KeyListener{keyDown(e,t){return(0,Hj.matchesKeystroke)(t,"KeyA","ctrlCmd")?[new xr]:[]}};re.SelectKeyboardListener=Hm});var Gm=f(Hn=>{"use strict";Object.defineProperty(Hn,"__esModule",{value:!0});Hn.UndoRedoKeyListener=Hn.RedoAction=Hn.UndoAction=void 0;var km=Rn(),kj=an(),Uj=In(),WE;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(WE=Hn.UndoAction||(Hn.UndoAction={}));var $E;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})($E=Hn.RedoAction||(Hn.RedoAction={}));var Um=class extends kj.KeyListener{keyDown(e,t){return(0,km.matchesKeystroke)(t,"KeyZ","ctrlCmd")?[WE.create()]:(0,km.matchesKeystroke)(t,"KeyZ","ctrlCmd","shift")||!(0,Uj.isMac)()&&(0,km.matchesKeystroke)(t,"KeyY","ctrlCmd")?[$E.create()]:[]}};Hn.UndoRedoKeyListener=Um});var zl=f(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.applyMatches=zi.ModelMatcher=zi.forEachMatch=void 0;var Wm=G(),Gj=ur();function Wj(i,e){Object.keys(i).forEach(t=>e(t,i[t]))}zi.forEachMatch=Wj;var $m=class{match(e,t){let n={};return this.matchLeft(e,n),this.matchRight(t,n),n}matchLeft(e,t,n){let r=t[e.id];if(r!==void 0?(r.left=e,r.leftParentId=n):(r={left:e,leftParentId:n},t[e.id]=r),(0,Wm.isParent)(e))for(let o of e.children)this.matchLeft(o,t,e.id)}matchRight(e,t,n){let r=t[e.id];if(r!==void 0?(r.right=e,r.rightParentId=n):(r={right:e,rightParentId:n},t[e.id]=r),(0,Wm.isParent)(e))for(let o of e.children)this.matchRight(o,t,e.id)}};zi.ModelMatcher=$m;function $j(i,e,t){i instanceof Wm.SModelRoot?t=i.index:t===void 0&&(t=new Gj.SModelIndex,t.add(i));for(let n of e){let r=!1;if(n.left!==void 0&&n.leftParentId!==void 0){let o=t.getById(n.leftParentId);if(o!==void 0&&o.children!==void 0){let s=o.children.indexOf(n.left);s>=0&&(n.right!==void 0&&n.leftParentId===n.rightParentId?(o.children.splice(s,1,n.right),r=!0):o.children.splice(s,1)),t.remove(n.left)}}if(!r&&n.right!==void 0&&n.rightParentId!==void 0){let o=t.getById(n.rightParentId);o!==void 0&&(o.children===void 0&&(o.children=[]),o.children.push(n.right))}}}zi.applyMatches=$j});var XE=f(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.ResizeAnimation=void 0;var Xj=or(),Xm=class extends Xj.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementResizes=t,this.reverse=r}tween(e){return this.elementResizes.forEach(t=>{let n=t.element,r=this.reverse?{width:(1-e)*t.toDimension.width+e*t.fromDimension.width,height:(1-e)*t.toDimension.height+e*t.fromDimension.height}:{width:(1-e)*t.fromDimension.width+e*t.toDimension.width,height:(1-e)*t.fromDimension.height+e*t.toDimension.height};n.bounds={x:n.bounds.x,y:n.bounds.y,width:r.width,height:r.height}}),this.model}};Yl.ResizeAnimation=Xm});var Ul=f(nn=>{"use strict";var cw=nn&&nn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},uw=nn&&nn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Jj=nn&&nn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(nn,"__esModule",{value:!0});nn.UpdateModelCommand=nn.UpdateModelAction=void 0;var kl=_(),Zj=te(),rs=Q(),JE=or(),Qj=pe(),eN=ol(),os=G(),ZE=Ya(),QE=To(),ew=Ti(),tw=ae(),nw=Md(),iw=Et(),rw=zl(),tN=XE(),nN=P(),ow=An(),sw=fn(),aw=me(),iN=Ke(),ss=class{constructor(e,t=!0,n){this.animate=t,this.cause=n,this.kind=ss.KIND,e.id!==void 0?this.newRoot=e:this.matches=e}};nn.UpdateModelAction=ss;ss.KIND="updateModel";var Ua=class extends Qj.Command{constructor(e){super(),this.action=e}execute(e){let t;return this.action.newRoot!==void 0?t=e.modelFactory.createRoot(this.action.newRoot):(t=e.modelFactory.createRoot(e.root),this.action.matches!==void 0&&this.applyMatches(t,this.action.matches,e)),this.oldRoot=e.root,this.newRoot=t,this.performUpdate(this.oldRoot,this.newRoot,e)}performUpdate(e,t,n){if((this.action.animate===void 0||this.action.animate)&&e.id===t.id){let r;this.action.matches===void 0?r=new rw.ModelMatcher().match(e,t):r=this.convertToMatchResult(this.action.matches,e,t);let o=this.computeAnimation(t,r,n);return o instanceof JE.Animation?o.start():o}else return e.type===t.type&&rs.Dimension.isValid(e.canvasBounds)&&(t.canvasBounds=e.canvasBounds),(0,ow.isViewport)(e)&&(0,ow.isViewport)(t)&&(t.zoom=e.zoom,t.scroll=e.scroll),t}applyMatches(e,t,n){let r=e.index;for(let o of t)if(o.left!==void 0){let s=r.getById(o.left.id);s instanceof os.SChildElement&&s.parent.remove(s)}for(let o of t)if(o.right!==void 0){let s=n.modelFactory.createElement(o.right),a;o.rightParentId!==void 0&&(a=r.getById(o.rightParentId)),a instanceof os.SParentElement?a.add(s):e.add(s)}}convertToMatchResult(e,t,n){let r={};for(let o of e){let s={},a;o.left!==void 0&&(a=o.left.id,s.left=t.index.getById(a),s.leftParentId=o.leftParentId),o.right!==void 0&&(a=o.right.id,s.right=n.index.getById(a),s.rightParentId=o.rightParentId),a!==void 0&&(r[a]=s)}return r}computeAnimation(e,t,n){let r={fades:[]};(0,rw.forEachMatch)(t,(s,a)=>{if(a.left!==void 0&&a.right!==void 0)this.updateElement(a.left,a.right,r);else if(a.right!==void 0){let c=a.right;(0,QE.isFadeable)(c)&&(c.opacity=0,r.fades.push({element:c,type:"in"}))}else if(a.left instanceof os.SChildElement){let c=a.left;if((0,QE.isFadeable)(c)&&a.leftParentId!==void 0&&!(0,iN.containsSome)(e,c)){let u=e.index.getById(a.leftParentId);if(u instanceof os.SParentElement){let d=n.modelFactory.createElement(c);u.add(d),r.fades.push({element:d,type:"out"})}}}});let o=this.createAnimations(r,e,n);return o.length>=2?new JE.CompoundAnimation(e,n,o):o.length===1?o[0]:e}updateElement(e,t,n){if((0,ew.isLocateable)(e)&&(0,ew.isLocateable)(t)){let r=e.position,o=t.position;(!(0,rs.almostEquals)(r.x,o.x)||!(0,rs.almostEquals)(r.y,o.y))&&(n.moves===void 0&&(n.moves=[]),n.moves.push({element:t,fromPosition:r,toPosition:o}),t.position=r)}(0,tw.isSizeable)(e)&&(0,tw.isSizeable)(t)&&(rs.Dimension.isValid(t.bounds)?(!(0,rs.almostEquals)(e.bounds.width,t.bounds.width)||!(0,rs.almostEquals)(e.bounds.height,t.bounds.height))&&(n.resizes===void 0&&(n.resizes=[]),n.resizes.push({element:t,fromDimension:{width:e.bounds.width,height:e.bounds.height},toDimension:{width:t.bounds.width,height:t.bounds.height}})):t.bounds={x:t.bounds.x,y:t.bounds.y,width:e.bounds.width,height:e.bounds.height}),e instanceof aw.SRoutableElement&&t instanceof aw.SRoutableElement&&this.edgeRouterRegistry&&(n.edgeMementi===void 0&&(n.edgeMementi=[]),n.edgeMementi.push({edge:t,before:this.takeSnapshot(e),after:this.takeSnapshot(t)})),(0,iw.isSelectable)(e)&&(0,iw.isSelectable)(t)&&(t.selected=e.selected),e instanceof os.SModelRoot&&t instanceof os.SModelRoot&&(t.canvasBounds=e.canvasBounds),e instanceof nw.ViewportRootElement&&t instanceof nw.ViewportRootElement&&(t.scroll=e.scroll,t.zoom=e.zoom)}takeSnapshot(e){return this.edgeRouterRegistry.get(e.routerKind).takeSnapshot(e)}createAnimations(e,t,n){let r=[];if(e.fades.length>0&&r.push(new eN.FadeAnimation(t,e.fades,n,!0)),e.moves!==void 0&&e.moves.length>0){let o=new Map;for(let s of e.moves)o.set(s.element.id,s);r.push(new ZE.MoveAnimation(t,o,n,!1))}if(e.resizes!==void 0&&e.resizes.length>0){let o=new Map;for(let s of e.resizes)o.set(s.element.id,s);r.push(new tN.ResizeAnimation(t,o,n,!1))}return e.edgeMementi!==void 0&&e.edgeMementi.length>0&&r.push(new ZE.MorphEdgesAnimation(t,e.edgeMementi,n,!1)),r}undo(e){return this.performUpdate(this.newRoot,this.oldRoot,e)}redo(e){return this.performUpdate(this.oldRoot,this.newRoot,e)}};Ua.KIND=Zj.UpdateModelAction.KIND;cw([(0,kl.inject)(sw.EdgeRouterRegistry),(0,kl.optional)(),uw("design:type",sw.EdgeRouterRegistry)],Ua.prototype,"edgeRouterRegistry",void 0);Ua=cw([(0,kl.injectable)(),Jj(0,(0,kl.inject)(nN.TYPES.Action)),uw("design:paramtypes",[Object])],Ua);nn.UpdateModelCommand=Ua});var us=f(be=>{"use strict";var dw=be&&be.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},lw=be&&be.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},fw=be&&be.__param||function(i,e){return function(t,n){e(t,n,i)}},Jm;Object.defineProperty(be,"__esModule",{value:!0});be.ViewportAnimation=be.GetViewportCommand=be.SetViewportCommand=be.ViewportResult=be.GetViewportAction=be.SetViewportAction=void 0;var Zm=_(),hw=te(),rN=Q(),oN=pe(),sN=or(),pw=An(),gw=P(),aN=Fm(),cs=class{constructor(e,t,n){this.elementId=e,this.newViewport=t,this.animate=n,this.kind=cs.KIND}};be.SetViewportAction=cs;cs.KIND="viewport";var mw;(function(i){i.KIND="getViewport";function e(){return{kind:i.KIND,requestId:(0,hw.generateRequestId)()}}i.create=e})(mw=be.GetViewportAction||(be.GetViewportAction={}));var yw;(function(i){i.KIND="viewportResult";function e(t,n,r){return{kind:i.KIND,viewport:t,canvasBounds:n,responseId:r}}i.create=e})(yw=be.ViewportResult||(be.ViewportResult={}));var Gl=Jm=class extends oN.MergeableCommand{constructor(e){super(),this.action=e,this.newViewport=e.newViewport}execute(e){let t=e.root,n=t.index.getById(this.action.elementId);if(n&&(0,pw.isViewport)(n)){if(this.element=n,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom},this.action.animate)return new as(this.element,this.oldViewport,this.newViewport,e).start();this.element.scroll=this.newViewport.scroll,this.element.zoom=this.newViewport.zoom}return t}undo(e){return new as(this.element,this.newViewport,this.oldViewport,e).start()}redo(e){return new as(this.element,this.oldViewport,this.newViewport,e).start()}merge(e,t){return!this.action.animate&&e instanceof Jm&&this.element===e.element?(this.newViewport=e.newViewport,!0):!1}};Gl.KIND=hw.SetViewportAction.KIND;Gl=Jm=dw([(0,Zm.injectable)(),fw(0,(0,Zm.inject)(gw.TYPES.Action)),lw("design:paramtypes",[Object])],Gl);be.SetViewportCommand=Gl;var Wl=class extends aN.ModelRequestCommand{constructor(e){super(),this.action=e}retrieveResult(e){let t=e.root,n;return(0,pw.isViewport)(t)?n={scroll:t.scroll,zoom:t.zoom}:n={scroll:rN.Point.ORIGIN,zoom:1},yw.create(n,t.canvasBounds,this.action.requestId)}};Wl.KIND=mw.KIND;Wl=dw([fw(0,(0,Zm.inject)(gw.TYPES.Action)),lw("design:paramtypes",[Object])],Wl);be.GetViewportCommand=Wl;var as=class extends sN.Animation{constructor(e,t,n,r){super(r),this.element=e,this.oldViewport=t,this.newViewport=n,this.context=r,this.zoomFactor=Math.log(n.zoom/t.zoom)}tween(e,t){return this.element.scroll={x:(1-e)*this.oldViewport.scroll.x+e*this.newViewport.scroll.x,y:(1-e)*this.oldViewport.scroll.y+e*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(e*this.zoomFactor),t.root}};be.ViewportAnimation=as});var Zl=f(Oe=>{"use strict";var ty=Oe&&Oe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ny=Oe&&Oe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},bw=Oe&&Oe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.CenterKeyboardListener=Oe.FitToScreenCommand=Oe.CenterCommand=Oe.BoundsAwareViewportCommand=Oe.FitToScreenAction=Oe.CenterAction=void 0;var Sw=te(),ds=Q(),_w=Rn(),cN=G(),uN=pe(),dN=an(),Qm=ae(),lN=Et(),vw=us(),$l=An(),iy=_(),Ew=P(),Dr=class{constructor(e,t=!0,n=!1){this.elementIds=e,this.animate=t,this.retainZoom=n,this.kind=Dr.KIND}};Oe.CenterAction=Dr;Dr.KIND="center";var qr=class{constructor(e,t,n,r=!0){this.elementIds=e,this.padding=t,this.maxZoom=n,this.animate=r,this.kind=qr.KIND}};Oe.FitToScreenAction=qr;qr.KIND="fit";var Ga=class extends uN.Command{constructor(e){super(),this.animate=e}initialize(e){if((0,$l.isViewport)(e)){this.oldViewport={scroll:e.scroll,zoom:e.zoom};let t=[];if(this.getElementIds().forEach(n=>{let r=e.index.getById(n);r&&(0,Qm.isBoundsAware)(r)&&t.push(this.boundsInViewport(r,r.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,lN.isSelectable)(n)&&n.selected&&(0,Qm.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,Qm.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length!==0){let n=t.reduce((r,o)=>ds.Bounds.combine(r,o));ds.Dimension.isValid(n)&&(this.newViewport=this.getNewViewport(n,e))}}}boundsInViewport(e,t,n){return e instanceof cN.SChildElement&&e.parent!==n?this.boundsInViewport(e.parent,e.parent.localToParent(t),n):t}execute(e){return this.initialize(e.root),this.redo(e)}undo(e){let t=e.root;if((0,$l.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new vw.ViewportAnimation(t,this.newViewport,this.oldViewport,e).start();t.scroll=this.oldViewport.scroll,t.zoom=this.oldViewport.zoom}return t}redo(e){let t=e.root;if((0,$l.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new vw.ViewportAnimation(t,this.oldViewport,this.newViewport,e).start();t.scroll=this.newViewport.scroll,t.zoom=this.newViewport.zoom}return t}equal(e,t){return e.zoom===t.zoom&&e.scroll.x===t.scroll.x&&e.scroll.y===t.scroll.y}};Ga=ty([(0,iy.injectable)(),ny("design:paramtypes",[Boolean])],Ga);Oe.BoundsAwareViewportCommand=Ga;var Xl=class extends Ga{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ds.Dimension.isValid(t.canvasBounds))return;let n=this.action.retainZoom&&(0,$l.isViewport)(t)?t.zoom:1,r=ds.Bounds.center(e);return{scroll:{x:r.x-.5*t.canvasBounds.width/n,y:r.y-.5*t.canvasBounds.height/n},zoom:n}}};Xl.KIND=Sw.CenterAction.KIND;Xl=ty([bw(0,(0,iy.inject)(Ew.TYPES.Action)),ny("design:paramtypes",[Object])],Xl);Oe.CenterCommand=Xl;var Jl=class extends Ga{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ds.Dimension.isValid(t.canvasBounds))return;let n=ds.Bounds.center(e),r=this.action.padding===void 0?0:2*this.action.padding,o=Math.min(t.canvasBounds.width/(e.width+r),t.canvasBounds.height/(e.height+r));return this.action.maxZoom!==void 0&&(o=Math.min(o,this.action.maxZoom)),o===1/0&&(o=1),{scroll:{x:n.x-.5*t.canvasBounds.width/o,y:n.y-.5*t.canvasBounds.height/o},zoom:o}}};Jl.KIND=Sw.FitToScreenAction.KIND;Jl=ty([bw(0,(0,iy.inject)(Ew.TYPES.Action)),ny("design:paramtypes",[Object])],Jl);Oe.FitToScreenCommand=Jl;var ey=class extends dN.KeyListener{keyDown(e,t){return(0,_w.matchesKeystroke)(t,"KeyC","ctrlCmd","shift")?[new Dr([])]:(0,_w.matchesKeystroke)(t,"KeyF","ctrlCmd","shift")?[new qr([])]:[]}};Oe.CenterKeyboardListener=ey});var sy=f(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.ScrollMouseListener=ls.isScrollable=void 0;var ry=te(),fN=G(),hN=Tt(),Wa=Ke(),Ql=An(),pN=Ti(),gN=me(),mN=vl(),yN=In();function _N(i){return"scroll"in i}ls.isScrollable=_N;var oy=class extends hN.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(e,t){if((0,Wa.findParentByFeature)(e,pN.isMoveable)===void 0&&!(e instanceof gN.SRoutingHandle)){let r=(0,Wa.findParentByFeature)(e,Ql.isViewport);if(r){if(this.lastScrollPosition={x:t.pageX,y:t.pageY},this.scrollbar=this.getScrollbar(t),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(r,t,this.scrollbar,!0).map(o=>new Promise(s=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>s(o),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(e,t){if(t.buttons===0)return this.mouseUp(e,t);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);let n=(0,Wa.findParentByFeature)(e,Ql.isViewport);if(n)return this.moveScrollBar(n,t,this.scrollbar)}if(this.lastScrollPosition){let n=(0,Wa.findParentByFeature)(e,Ql.isViewport);if(n)return this.dragCanvas(n,t,this.lastScrollPosition)}return[]}mouseEnter(e,t){return e instanceof fN.SModelRoot&&t.buttons===0&&this.mouseUp(e,t),[]}mouseUp(e,t){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(e,t){if((0,Wa.findParentByFeature)(e,Ql.isViewport)){let r=this.getScrollbar(t);if(r){window.clearTimeout(this.scrollbarMouseDownTimeout);let o=this.findClickTarget(r,t),s;if(o&&o.id.startsWith("horizontal-projection:")?s=o.id.substring(22):o&&o.id.startsWith("vertical-projection:")&&(s=o.id.substring(20)),s)return[ry.CenterAction.create([s],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(e,t,n){let r=(t.pageX-n.x)/e.zoom,o=(t.pageY-n.y)/e.zoom,s={scroll:{x:e.scroll.x-r,y:e.scroll.y-o},zoom:e.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[ry.SetViewportAction.create(e.id,s,{animate:!1})]}moveScrollBar(e,t,n,r=!1){let o=(0,mN.getModelBounds)(e);if(!o||e.zoom<=0)return[];let s=n.getBoundingClientRect(),a;if(this.getScrollbarOrientation(n)==="horizontal"){if(s.width<=0)return[];let c=e.canvasBounds.width/(e.zoom*o.width)*s.width,u=t.clientX-s.x-c/2;u<0?u=0:u>s.width-c&&(u=s.width-c),a={x:o.x+u/s.width*o.width,y:e.scroll.y}}else{if(s.height<=0)return[];let c=e.canvasBounds.height/(e.zoom*o.height)*s.height,u=t.clientY-s.y-c/2;u<0?u=0:u>s.height-c&&(u=s.height-c),a={x:e.scroll.x,y:o.y+u/s.height*o.height}}return[ry.SetViewportAction.create(e.id,{scroll:a,zoom:e.zoom},{animate:r})]}getScrollbar(e){let t=e.target;for(;t;){if(t.classList&&t.classList.contains("sprotty-projection-bar"))return t;t=t.parentElement}}getScrollbarOrientation(e){return e.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(e,t){let n=Array.from(e.children).filter(r=>r.id&&r.classList.contains("sprotty-projection")&&(0,yN.hitsMouseEvent)(r,t));if(n.length>0)return n[n.length-1]}};ls.ScrollMouseListener=oy});var ay=f(Ft=>{"use strict";var vN=Ft&&Ft.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},bN=Ft&&Ft.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},SN=Ft&&Ft.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.BringToFrontCommand=Ft.BringToFrontAction=void 0;var ww=_(),EN=P(),Pw=G(),wN=pe(),Iw=me(),Rw;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(Rw=Ft.BringToFrontAction||(Ft.BringToFrontAction={}));var ef=class extends wN.Command{constructor(e){super(),this.action=e,this.selected=[]}execute(e){let t=e.root;return this.action.elementIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Iw.SRoutableElement&&(r.source&&this.addToSelection(r.source),r.target&&this.addToSelection(r.target)),r instanceof Pw.SChildElement&&this.addToSelection(r),this.includeConnectedEdges(r)}),this.redo(e)}includeConnectedEdges(e){if(e instanceof Iw.SConnectableElement&&(e.incomingEdges.forEach(t=>this.addToSelection(t)),e.outgoingEdges.forEach(t=>this.addToSelection(t))),e instanceof Pw.SParentElement)for(let t of e.children)this.includeConnectedEdges(t)}addToSelection(e){this.selected.push({element:e,index:e.parent.children.indexOf(e)})}undo(e){for(let t=this.selected.length-1;t>=0;t--){let n=this.selected[t],r=n.element;r.parent.move(r,n.index)}return e.root}redo(e){for(let t=0;t<this.selected.length;t++)this.bringToFront(this.selected[t]);return e.root}bringToFront(e){let t=e.element,n=t.parent.children.length;t.parent.move(t,n-1)}};ef.KIND=Rw.KIND;ef=vN([(0,ww.injectable)(),SN(0,(0,ww.inject)(EN.TYPES.Action)),bN("design:paramtypes",[Object])],ef);Ft.BringToFrontCommand=ef});var uy=f(fs=>{"use strict";var PN=fs&&fs.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(fs,"__esModule",{value:!0});fs.SGraphFactory=void 0;var IN=_(),jr=bi(),Yi=Pn(),tf=G(),rn=Er(),Mw=fd(),cy=class extends Yi.SModelFactory{constructor(){super(...arguments),this.defaultGraphFeatures=(0,Yi.createFeatureSet)(rn.SGraph.DEFAULT_FEATURES),this.defaultNodeFeatures=(0,Yi.createFeatureSet)(rn.SNode.DEFAULT_FEATURES),this.defaultPortFeatures=(0,Yi.createFeatureSet)(rn.SPort.DEFAULT_FEATURES),this.defaultEdgeFeatures=(0,Yi.createFeatureSet)(rn.SEdge.DEFAULT_FEATURES),this.defaultLabelFeatures=(0,Yi.createFeatureSet)(rn.SLabel.DEFAULT_FEATURES),this.defaultCompartmentFeatures=(0,Yi.createFeatureSet)(rn.SCompartment.DEFAULT_FEATURES),this.defaultButtonFeatures=(0,Yi.createFeatureSet)(Mw.SButton.DEFAULT_FEATURES)}createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof tf.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else this.isNodeSchema(e)?(n=new rn.SNode,n.features=this.defaultNodeFeatures):this.isPortSchema(e)?(n=new rn.SPort,n.features=this.defaultPortFeatures):this.isEdgeSchema(e)?(n=new rn.SEdge,n.features=this.defaultEdgeFeatures):this.isLabelSchema(e)?(n=new rn.SLabel,n.features=this.defaultLabelFeatures):this.isCompartmentSchema(e)?(n=new rn.SCompartment,n.features=this.defaultCompartmentFeatures):this.isButtonSchema(e)?(n=new Mw.SButton,n.features=this.defaultButtonFeatures):n=new tf.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof tf.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else this.isGraphSchema(e)?(t=new rn.SGraph,t.features=this.defaultGraphFeatures):t=new tf.SModelRoot;return this.initializeRoot(t,e)}isGraphSchema(e){return(0,jr.getBasicType)(e)==="graph"}isNodeSchema(e){return(0,jr.getBasicType)(e)==="node"}isPortSchema(e){return(0,jr.getBasicType)(e)==="port"}isEdgeSchema(e){return(0,jr.getBasicType)(e)==="edge"}isLabelSchema(e){return(0,jr.getBasicType)(e)==="label"}isCompartmentSchema(e){return(0,jr.getBasicType)(e)==="comp"}isButtonSchema(e){return(0,jr.getBasicType)(e)==="button"}};cy=PN([(0,IN.injectable)()],cy);fs.SGraphFactory=cy});var Ow=f(dy=>{"use strict";Object.defineProperty(dy,"__esModule",{value:!0});var RN=_(),MN=P(),ON=uy(),TN=new RN.ContainerModule((i,e,t,n)=>{n(MN.TYPES.IModelFactory).to(ON.SGraphFactory).inSingletonScope()});dy.default=TN});var hy=f(fy=>{"use strict";Object.defineProperty(fy,"__esModule",{value:!0});var AN=_(),ly=P(),Tw=Qu(),Aw=mp(),$a=nd(),Cw=yt(),xw=Sp(),Dw=bp(),qw=Ep(),CN=new AN.ContainerModule((i,e,t)=>{(0,Cw.configureCommand)({bind:i,isBound:t},Tw.SetBoundsCommand),(0,Cw.configureCommand)({bind:i,isBound:t},Tw.RequestBoundsCommand),i(Aw.HiddenBoundsUpdater).toSelf().inSingletonScope(),i(ly.TYPES.HiddenVNodePostprocessor).toService(Aw.HiddenBoundsUpdater),i(ly.TYPES.Layouter).to($a.Layouter).inSingletonScope(),i(ly.TYPES.LayoutRegistry).to($a.LayoutRegistry).inSingletonScope(),(0,$a.configureLayout)({bind:i,isBound:t},Dw.VBoxLayouter.KIND,Dw.VBoxLayouter),(0,$a.configureLayout)({bind:i,isBound:t},xw.HBoxLayouter.KIND,xw.HBoxLayouter),(0,$a.configureLayout)({bind:i,isBound:t},qw.StackLayouter.KIND,qw.StackLayouter)});fy.default=CN});var gy=f(py=>{"use strict";Object.defineProperty(py,"__esModule",{value:!0});var xN=_(),DN=da(),qN=new xN.ContainerModule(i=>{i(DN.ButtonHandlerRegistry).toSelf().inSingletonScope()});py.default=qN});var _y=f(yy=>{"use strict";Object.defineProperty(yy,"__esModule",{value:!0});var jN=_(),my=P(),jw=hd(),nf=Bp(),NN=new jN.ContainerModule(i=>{i(nf.CommandPalette).toSelf().inSingletonScope(),i(my.TYPES.IUIExtension).toService(nf.CommandPalette),i(nf.CommandPaletteKeyListener).toSelf().inSingletonScope(),i(my.TYPES.KeyListener).toService(nf.CommandPaletteKeyListener),i(jw.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),i(my.TYPES.ICommandPaletteActionProviderRegistry).toService(jw.CommandPaletteActionProviderRegistry)});yy.default=NN});var by=f(vy=>{"use strict";Object.defineProperty(vy,"__esModule",{value:!0});var LN=_(),BN=vd(),Nw=Yp(),Xa=P(),FN=new LN.ContainerModule(i=>{i(Xa.TYPES.IContextMenuServiceProvider).toProvider(e=>()=>new Promise((t,n)=>{e.container.isBound(Xa.TYPES.IContextMenuService)?t(e.container.get(Xa.TYPES.IContextMenuService)):n()})),i(Nw.ContextMenuMouseListener).toSelf().inSingletonScope(),i(Xa.TYPES.MouseListener).toService(Nw.ContextMenuMouseListener),i(Xa.TYPES.IContextMenuProviderRegistry).to(BN.ContextMenuProviderRegistry)});vy.default=FN});var Ey=f(Sy=>{"use strict";Object.defineProperty(Sy,"__esModule",{value:!0});var VN=lo(),KN=_(),HN=cl(),zN=Ug(),YN=P(),Lw=Gg(),kN=new KN.ContainerModule((i,e,t)=>{(0,VN.configureModelElement)({bind:i,isBound:t},"marker",HN.SIssueMarker,zN.IssueMarkerView),i(Lw.DecorationPlacer).toSelf().inSingletonScope(),i(YN.TYPES.IVNodePostprocessor).toService(Lw.DecorationPlacer)});Sy.default=kN});var Fw=f(wy=>{"use strict";Object.defineProperty(wy,"__esModule",{value:!0});var UN=_(),GN=P(),Bw=ll(),WN=new UN.ContainerModule(i=>{i(Bw.IntersectionFinder).toSelf().inSingletonScope(),i(GN.TYPES.IEdgeRoutePostprocessor).toService(Bw.IntersectionFinder)});wy.default=WN});var Iy=f(Py=>{"use strict";Object.defineProperty(Py,"__esModule",{value:!0});var $N=_(),XN=da(),Vw=Cg(),JN=new $N.ContainerModule((i,e,t)=>{(0,XN.configureButtonHandler)({bind:i,isBound:t},Vw.ExpandButtonHandler.TYPE,Vw.ExpandButtonHandler)});Py.default=JN});var Oy=f(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});var ZN=_(),Ry=P(),rf=jg(),QN=Rr(),eL=yt(),tL=new ZN.ContainerModule((i,e,t)=>{i(rf.ExportSvgKeyListener).toSelf().inSingletonScope(),i(Ry.TYPES.KeyListener).toService(rf.ExportSvgKeyListener),i(Ry.TYPES.HiddenVNodePostprocessor).to(rf.ExportSvgPostprocessor).inSingletonScope(),(0,eL.configureCommand)({bind:i,isBound:t},rf.ExportSvgCommand),i(Ry.TYPES.SvgExporter).to(QN.SvgExporter).inSingletonScope()});My.default=tL});var Ay=f(Ty=>{"use strict";Object.defineProperty(Ty,"__esModule",{value:!0});var nL=_(),iL=P(),rL=ol(),oL=new nL.ContainerModule(i=>{i(iL.TYPES.IVNodePostprocessor).to(rL.ElementFader).inSingletonScope()});Ty.default=oL});var zw=f(ki=>{"use strict";var Kw=ki&&ki.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},sL=ki&&ki.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(ki,"__esModule",{value:!0});ki.PopupPositionUpdater=void 0;var Hw=_(),aL=P(),of=class{decorate(e,t){return e}postUpdate(){let e=document.getElementById(this.options.popupDiv);if(e!==null&&typeof window<"u"){let t=e.getBoundingClientRect();window.innerHeight<t.height+t.top&&(e.style.top=window.pageYOffset+window.innerHeight-t.height-5+"px"),window.innerWidth<t.left+t.width&&(e.style.left=window.pageXOffset+window.innerWidth-t.width-5+"px"),t.left<0&&(e.style.left="0px"),t.top<0&&(e.style.top="0px")}}};Kw([(0,Hw.inject)(aL.TYPES.ViewerOptions),sL("design:type",Object)],of.prototype,"options",void 0);of=Kw([(0,Hw.injectable)()],of);ki.PopupPositionUpdater=of});var xy=f(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var cL=_(),Ja=P(),ft=Kg(),uL=zw(),Yw=yt(),Za=Ls(),kw=Zl(),dL=us(),lL=Ya(),fL=new cL.ContainerModule((i,e,t)=>{i(Ja.TYPES.PopupVNodePostprocessor).to(uL.PopupPositionUpdater).inSingletonScope(),i(ft.HoverMouseListener).toSelf().inSingletonScope(),i(Ja.TYPES.MouseListener).toService(ft.HoverMouseListener),i(ft.PopupHoverMouseListener).toSelf().inSingletonScope(),i(Ja.TYPES.PopupMouseListener).toService(ft.PopupHoverMouseListener),i(ft.HoverKeyListener).toSelf().inSingletonScope(),i(Ja.TYPES.KeyListener).toService(ft.HoverKeyListener),i(Ja.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),i(ft.ClosePopupActionHandler).toSelf().inSingletonScope();let n={bind:i,isBound:t};(0,Yw.configureCommand)(n,ft.HoverFeedbackCommand),(0,Yw.configureCommand)(n,ft.SetPopupModelCommand),(0,Za.configureActionHandler)(n,ft.SetPopupModelCommand.KIND,ft.ClosePopupActionHandler),(0,Za.configureActionHandler)(n,kw.FitToScreenCommand.KIND,ft.ClosePopupActionHandler),(0,Za.configureActionHandler)(n,kw.CenterCommand.KIND,ft.ClosePopupActionHandler),(0,Za.configureActionHandler)(n,dL.SetViewportCommand.KIND,ft.ClosePopupActionHandler),(0,Za.configureActionHandler)(n,lL.MoveCommand.KIND,ft.ClosePopupActionHandler)});Cy.default=fL});var jy=f(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});var hL=_(),Dy=P(),hs=Ya(),pL=yt(),gL=new hL.ContainerModule((i,e,t)=>{i(hs.MoveMouseListener).toSelf().inSingletonScope(),i(Dy.TYPES.MouseListener).toService(hs.MoveMouseListener),(0,pL.configureCommand)({bind:i,isBound:t},hs.MoveCommand),i(hs.LocationPostprocessor).toSelf().inSingletonScope(),i(Dy.TYPES.IVNodePostprocessor).toService(hs.LocationPostprocessor),i(Dy.TYPES.HiddenVNodePostprocessor).toService(hs.LocationPostprocessor)});qy.default=gL});var Ly=f(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});var mL=_(),yL=P(),Uw=am(),_L=new mL.ContainerModule(i=>{i(Uw.OpenMouseListener).toSelf().inSingletonScope(),i(yL.TYPES.MouseListener).toService(Uw.OpenMouseListener)});Ny.default=_L});var zy=f(Hy=>{"use strict";Object.defineProperty(Hy,"__esModule",{value:!0});var vL=_(),on=P(),Gw=Ml(),Ww=Sa(),By=Nm(),Fy=Sl(),bL=ti(),SL=fn(),Vy=Il(),Ky=Mm(),EL=yt(),wL=new vL.ContainerModule((i,e,t)=>{i(SL.EdgeRouterRegistry).toSelf().inSingletonScope(),i(bL.AnchorComputerRegistry).toSelf().inSingletonScope(),i(Gw.ManhattanEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Gw.ManhattanEdgeRouter),i(on.TYPES.IAnchorComputer).to(By.ManhattanEllipticAnchor).inSingletonScope(),i(on.TYPES.IAnchorComputer).to(By.ManhattanRectangularAnchor).inSingletonScope(),i(on.TYPES.IAnchorComputer).to(By.ManhattanDiamondAnchor).inSingletonScope(),i(Ww.PolylineEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Ww.PolylineEdgeRouter),i(on.TYPES.IAnchorComputer).to(Fy.EllipseAnchor),i(on.TYPES.IAnchorComputer).to(Fy.RectangleAnchor),i(on.TYPES.IAnchorComputer).to(Fy.DiamondAnchor),i(Vy.BezierEdgeRouter).toSelf().inSingletonScope(),i(on.TYPES.IEdgeRouter).toService(Vy.BezierEdgeRouter),i(on.TYPES.IAnchorComputer).to(Ky.BezierEllipseAnchor),i(on.TYPES.IAnchorComputer).to(Ky.BezierRectangleAnchor),i(on.TYPES.IAnchorComputer).to(Ky.BezierDiamondAnchor),(0,EL.configureCommand)({bind:i,isBound:t},Vy.AddRemoveBezierSegmentCommand)});Hy.default=wL});var Uy=f(ky=>{"use strict";Object.defineProperty(ky,"__esModule",{value:!0});var PL=_(),$w=P(),Nr=Hl(),Yy=yt(),IL=new PL.ContainerModule((i,e,t)=>{(0,Yy.configureCommand)({bind:i,isBound:t},Nr.SelectCommand),(0,Yy.configureCommand)({bind:i,isBound:t},Nr.SelectAllCommand),(0,Yy.configureCommand)({bind:i,isBound:t},Nr.GetSelectionCommand),i(Nr.SelectKeyboardListener).toSelf().inSingletonScope(),i($w.TYPES.KeyListener).toService(Nr.SelectKeyboardListener),i(Nr.SelectMouseListener).toSelf().inSingletonScope(),i($w.TYPES.MouseListener).toService(Nr.SelectMouseListener)});ky.default=IL});var Wy=f(Gy=>{"use strict";Object.defineProperty(Gy,"__esModule",{value:!0});var RL=_(),ML=P(),Xw=Gm(),OL=new RL.ContainerModule(i=>{i(Xw.UndoRedoKeyListener).toSelf().inSingletonScope(),i(ML.TYPES.KeyListener).toService(Xw.UndoRedoKeyListener)});Gy.default=OL});var Xy=f($y=>{"use strict";Object.defineProperty($y,"__esModule",{value:!0});var TL=_(),AL=yt(),CL=Ul(),xL=new TL.ContainerModule((i,e,t)=>{(0,AL.configureCommand)({bind:i,isBound:t},CL.UpdateModelCommand)});$y.default=xL});var Qy=f(Zy=>{"use strict";Object.defineProperty(Zy,"__esModule",{value:!0});var DL=_(),Jy=P(),sf=Zl(),Jw=us(),Zw=sy(),Qw=$d(),af=yt(),qL=new DL.ContainerModule((i,e,t)=>{(0,af.configureCommand)({bind:i,isBound:t},sf.CenterCommand),(0,af.configureCommand)({bind:i,isBound:t},sf.FitToScreenCommand),(0,af.configureCommand)({bind:i,isBound:t},Jw.SetViewportCommand),(0,af.configureCommand)({bind:i,isBound:t},Jw.GetViewportCommand),i(sf.CenterKeyboardListener).toSelf().inSingletonScope(),i(Jy.TYPES.KeyListener).toService(sf.CenterKeyboardListener),i(Zw.ScrollMouseListener).toSelf().inSingletonScope(),i(Qw.ZoomMouseListener).toSelf().inSingletonScope(),i(Jy.TYPES.MouseListener).toService(Zw.ScrollMouseListener),i(Jy.TYPES.MouseListener).toService(Qw.ZoomMouseListener)});Zy.default=qL});var t_=f(e_=>{"use strict";Object.defineProperty(e_,"__esModule",{value:!0});var jL=_(),NL=yt(),LL=ay(),BL=new jL.ContainerModule((i,e,t)=>{(0,NL.configureCommand)({bind:i,isBound:t},LL.BringToFrontCommand)});e_.default=BL});var nP=f(ue=>{"use strict";var Rt=ue&&ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},lf=ue&&ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(ue,"__esModule",{value:!0});ue.SBezierControlHandleView=ue.SBezierCreateHandleView=ue.SCompartmentView=ue.SLabelView=ue.SRoutingHandleView=ue.BezierCurveEdgeView=ue.PolylineEdgeViewWithGapsOnIntersections=ue.JumpingPolylineEdgeView=ue.PolylineEdgeView=ue.SGraphView=void 0;var Mt=_(),ps=Q(),eP=bi(),tc=Ne(),FL=ca(),Qa=ll(),VL=qo(),ff=me(),Ui=fn(),tP=Bm(),he=Gt(),KL=Ir(),cf=class{render(e,t){let n=this.edgeRouterRegistry.routeAllChildren(e),r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,he.svg)("svg",{"class-sprotty-graph":!0},(0,he.svg)("g",{transform:r},t.renderChildren(e,{edgeRouting:n})))}};Rt([(0,Mt.inject)(Ui.EdgeRouterRegistry),lf("design:type",Ui.EdgeRouterRegistry)],cf.prototype,"edgeRouterRegistry",void 0);cf=Rt([(0,Mt.injectable)()],cf);ue.SGraphView=cf;var ec=class extends tP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,he.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,he.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o=t[0],s=`M ${o.x},${o.y}`;for(let a=1;a<t.length;a++){let c=t[a];s+=` L ${c.x},${c.y}`}return(0,he.svg)("path",{d:s})}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,he.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)(Ui.EdgeRouterRegistry),lf("design:type",Ui.EdgeRouterRegistry)],ec.prototype,"edgeRouterRegistry",void 0);ec=Rt([(0,Mt.injectable)()],ec);ue.PolylineEdgeView=ec;var uf=class extends ec{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(e,t,n,r){let o="";for(let s=0;s<t.length;s++){let a=t[s];s===0&&(o=`M ${a.x},${a.y}`),(0,Qa.isIntersectingRoutedPoint)(a)&&(o+=this.intersectionPath(e,t,a,r)),s!==0&&(o+=` L ${a.x},${a.y}`)}return(0,he.svg)("path",{d:o})}intersectionPath(e,t,n,r){if(n.intersections.length<1)return"";let o=this.getLineSegment(e,n.intersections[0],r,t),s=this.getIntersectionsSortedBySegmentDirection(o,n),a="";for(let c of s){let u=this.getOtherLineSegment(e,c,r);if(u===void 0)continue;let d=this.getLineSegment(e,c,r,t),l=c.intersectionPoint;this.shouldDrawLineJumpOnIntersection(d,u)?a+=this.createJumpPath(l,d):this.shouldDrawLineGapOnIntersection(d,u)&&(a+=this.createGapPath(l,d))}return a}getIntersectionsSortedBySegmentDirection(e,t){switch(e.direction){case"north":case"north-east":return t.intersections.sort(Qa.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return t.intersections.sort(Qa.BY_X_THEN_Y);case"south-west":case"west":return t.intersections.sort(Qa.BY_DESCENDING_X_THEN_Y);case"north-west":return t.intersections.sort(Qa.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(e,t){return Math.abs(e.slopeOrMax)<Math.abs(t.slopeOrMax)}shouldDrawLineGapOnIntersection(e,t){return!this.shouldDrawLineJumpOnIntersection(e,t)}getLineSegment(e,t,n,r){let o=r||this.edgeRouterRegistry.route(e,n),s=t.routable1===e.id?t.segmentIndex1:t.segmentIndex2;return new KL.PointToPointLine(o[s],o[s+1])}getOtherLineSegment(e,t,n){let r=t.routable1===e.id?t.routable2:t.routable1,o=e.index.getById(r);if(o instanceof ff.SRoutableElement)return this.getLineSegment(o,t,n)}createJumpPath(e,t){let n=ps.Point.shiftTowards(e,t.p1,this.jumpOffsetBefore),r=ps.Point.shiftTowards(e,t.p2,this.jumpOffsetAfter),o=t.p1.x<t.p2.x?1:0;return` L ${n.x},${n.y} A 1,1 0,0 ${o} ${r.x},${r.y}`}createGapPath(e,t){let n,r;e.y<t.p1.y?(n=-this.skipOffsetBefore,r=this.jumpOffsetAfter+this.skipOffsetAfter):(n=this.jumpOffsetBefore+this.skipOffsetAfter,r=-this.skipOffsetBefore);let o=ps.Point.shiftTowards(e,t.p1,n),s=ps.Point.shiftTowards(e,t.p2,r);return` L ${o.x},${o.y} M ${s.x},${s.y}`}};uf=Rt([(0,Mt.injectable)()],uf);ue.JumpingPolylineEdgeView=uf;var n_=class extends uf{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(e,t){return!1}shouldDrawLineGapOnIntersection(e,t){return Math.abs(e.slopeOrMax)>=Math.abs(t.slopeOrMax)}createGapPath(e,t){let n=ps.Point.shiftTowards(e,t.p1,this.skipOffsetBefore),r=ps.Point.shiftTowards(e,t.p2,this.skipOffsetAfter);return` L ${n.x},${n.y} M ${r.x},${r.y}`}};n_=Rt([(0,Mt.injectable)()],n_);ue.PolylineEdgeViewWithGapsOnIntersections=n_;var df=class extends tP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,he.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,he.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o="";if(t.length>=4){o+=this.buildMainSegment(t);let s=t.length-4;if(s>0&&s%3===0)for(let a=4;a<t.length;a+=3)o+=this.addSpline(t,a)}return(0,he.svg)("path",{d:o})}buildMainSegment(e){let t=e[0],n=e[1],r=e[2],o=e[3];return`M${t.x},${t.y} C${n.x},${n.y} ${r.x},${r.y} ${o.x},${o.y}`}addSpline(e,t){let n=e[t+1],r=e[t+2];return` S${n.x},${n.y} ${r.x},${r.y}`}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,he.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Rt([(0,Mt.inject)(Ui.EdgeRouterRegistry),lf("design:type",Ui.EdgeRouterRegistry)],df.prototype,"edgeRouterRegistry",void 0);df=Rt([(0,Mt.injectable)()],df);ue.BezierCurveEdgeView=df;var gs=class{constructor(){this.minimalPointDistance=10}render(e,t,n){if(n&&n.route&&e.parent instanceof ff.SRoutableElement){let r=this.edgeRouterRegistry.get(e.parent.routerKind),o=n.route===void 0?this.edgeRouterRegistry.route(e.parent,n):n.route,s=r.getHandlePosition(e.parent,o,e);if(s!==void 0){let a=(0,he.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,tc.setAttr)(a,"data-kind",e.kind),a}}return(0,he.svg)("g",null)}getRadius(){return 7}};Rt([(0,Mt.inject)(Ui.EdgeRouterRegistry),lf("design:type",Ui.EdgeRouterRegistry)],gs.prototype,"edgeRouterRegistry",void 0);gs=Rt([(0,Mt.injectable)()],gs);ue.SRoutingHandleView=gs;var i_=class extends FL.ShapeView{render(e,t){if(!(0,VL.isEdgeLayoutable)(e)&&!this.isVisible(e,t))return;let n=(0,he.svg)("text",{"class-sprotty-label":!0},e.text),r=(0,eP.getSubType)(e);return r&&(0,tc.setAttr)(n,"class",r),n}};i_=Rt([(0,Mt.injectable)()],i_);ue.SLabelView=i_;var r_=class{render(e,t,n){let r=`translate(${e.bounds.x}, ${e.bounds.y})`,o=(0,he.svg)("g",{transform:r,"class-sprotty-comp":"{true}"},t.renderChildren(e)),s=(0,eP.getSubType)(e);return s&&(0,tc.setAttr)(o,"class",s),o}};r_=Rt([(0,Mt.injectable)()],r_);ue.SCompartmentView=r_;var o_=class extends gs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof ff.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a="translate("+s.x+", "+s.y+")",c=-5.5,u=5.5,d=e.kind==="bezier-add"?"+":"-",l=(0,he.svg)("g",{transform:a,"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,he.svg)("circle",{r:this.getRadius()}),(0,he.svg)("text",{x:c,y:u,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},d));return(0,tc.setAttr)(l,"data-kind",e.kind),l}}}return(0,he.svg)("g",null)}};o_=Rt([(0,Mt.injectable)()],o_);ue.SBezierCreateHandleView=o_;var s_=class extends gs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof ff.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a;for(let u=0;u<r.length;u++){let d=r[u];if(d.kind===s.kind&&d.pointIndex===s.pointIndex){e.kind==="bezier-control-before"?a=r[u+1]:a=r[u-1];break}}let c;if(a){let u=`M ${s.x}, ${s.y} L ${a.x}, ${a.y}`;c=(0,he.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,he.svg)("path",{d:u,stroke:"grey","style-stroke-width":"2px"}),(0,he.svg)("circle",{cx:s.x,cy:s.y,r:this.getRadius()}))}else c=(0,he.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,tc.setAttr)(c,"data-kind",e.kind),c}}}return(0,he.svg)("g",null)}};s_=Rt([(0,Mt.injectable)()],s_);ue.SBezierControlHandleView=s_});var c_=f(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});var HL=_(),zL=yt(),hf=P(),YL=Ma(),kL=Vo(),UL=new HL.ContainerModule((i,e,t)=>{i(hf.TYPES.ModelSourceProvider).toProvider(n=>()=>new Promise(r=>{r(n.container.get(hf.TYPES.ModelSource))})),(0,zL.configureCommand)({bind:i,isBound:t},YL.CommitModelCommand),i(hf.TYPES.IActionHandlerInitializer).toService(hf.TYPES.ModelSource),i(kL.ComputedBoundsApplicator).toSelf().inSingletonScope()});a_.default=UL});var iP=f(ms=>{"use strict";var Te=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ms,"__esModule",{value:!0});ms.loadDefaultModules=void 0;var GL=Te(lp()),WL=Te(c_()),$L=Te(hy()),XL=Te(gy()),JL=Te(_y()),ZL=Te(by()),QL=Te(Ey()),eB=Te(Bd()),u_=Ag(),tB=Te(Iy()),nB=Te(Oy()),iB=Te(Ay()),rB=Te(xy()),oB=Te(jy()),sB=Te(Ly()),aB=Te(zy()),cB=Te(Uy()),uB=Te(Wy()),dB=Te(Xy()),lB=Te(Qy()),fB=Te(t_());function hB(i,e){let t=[GL.default,WL.default,$L.default,XL.default,JL.default,ZL.default,QL.default,u_.edgeEditModule,eB.default,tB.default,nB.default,iB.default,rB.default,u_.labelEditModule,u_.labelEditUiModule,oB.default,sB.default,aB.default,cB.default,uB.default,dB.default,lB.default,fB.default];if(e&&e.exclude)for(let n of e.exclude){let r=t.indexOf(n);r>=0&&t.splice(r,1)}i.load(...t)}ms.loadDefaultModules=hB});var rP=f(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});var pf=uo();function pB(i){let e={},t=(s,a)=>{if(a!=="style"&&a!=="class"){let c=vB(i[a]);s?s[a]=c:s={[a]:c}}return s},n=Object.keys(i).reduce(t,null);n&&(e.attrs=n);let r=gB(i);r&&(e.style=r);let o=mB(i);return o&&(e.class=o),e}function gB(i){let e=(t,n)=>{let r=n.split(":"),o=yB(r[0].trim());if(o){let s=r[1].replace("!important","").trim();t?t[o]=s:t={[o]:s}}return t};try{return i.style.split(";").reduce(e,null)}catch{return null}}function mB(i){let e=(t,n)=>(n=n.trim(),n&&(t?t[n]=!0:t={[n]:!0}),t);try{return i.class.split(" ").reduce(e,null)}catch{return null}}function yB(i){return i=i.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),`${i.charAt(0).toLowerCase()}${i.substring(1)}`}var _B=new RegExp("&[a-z0-9#]+;","gi"),ys=null;function vB(i){return ys||(ys=document.createElement("div")),i.replace(_B,e=>ys===null?"":(ys.innerHTML=e,ys.textContent===null?"":ys.textContent))}function bB(i,e){let t=i,n=null,r=[],o=s=>{let a=s.firstChild;a!==null&&(n=s),t=a};for(e(t,n),o(t);;){for(;t;)r.push(t),e(t,n),o(t);let s=r.pop();if(t=s||null,!r.length)break;if(n=r[r.length-1],t){let a=t.nextSibling;a==null&&(n=r[r.length-1]),t=a}}}var nc=null,d_=new Map,gf=!1;function SB(i,e){let t;switch(e!==null&&(t=d_.get(e)),i?.nodeType){case 1:{if(t===void 0)return;t.children=t.children?t.children:[];let n=t.children,r=i.attributes,o={};for(let a=0;a<r.length;a++){let c=r.item(a);c&&(o[c.name]=c.value)}let s=(0,pf.h)(i.nodeName,pB(o));n.push(s),d_.set(i,s);break}case 3:{let n=i.textContent;if(n!==null&&t!==void 0){t.children=t.children?t.children:[];let r=t.children,o=r.length>0?r[r.length-1]:null;!gf&&typeof o!="string"&&o!==null&&o.sel===void 0?o.text=o.text+n:r.push((0,pf.vnode)(void 0,void 0,void 0,n,void 0)),gf=!1}break}case 8:{gf=!0;break}case 9:{nc=(0,pf.vnode)(void 0,void 0,[],void 0,void 0),d_.set(i,nc);break}default:break}}function EB(i){let e=i?.children;return typeof e>"u"?null:e.length===1&&typeof e[0]!="string"?e[0]:null}function wB(i){var e,t;let n=new window.DOMParser;if(n===void 0||i===void 0||i==="")return null;let r=n.parseFromString(i,"application/xml");if(((e=r?.firstChild)===null||e===void 0?void 0:e.nodeName)==="parsererror"){let o=`${(t=r?.firstChild)===null||t===void 0?void 0:t.textContent}`;return(0,pf.h)("parsererror",[o])}return gf=!1,nc=null,bB(r,SB),nc===null?null:EB(nc)}l_.default=wB});var b_=f(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.ForeignObjectElement=Ae.ShapedPreRenderedElement=Ae.PreRenderedElement=Ae.HtmlRoot=Ae.RectangularPort=Ae.CircularPort=Ae.DiamondNode=Ae.RectangularNode=Ae.CircularNode=void 0;var ic=Q(),oP=G(),f_=ae(),PB=Ti(),IB=Et(),oc=Er(),sc=ti(),h_=class extends oc.SNode{get anchorKind(){return sc.ELLIPTIC_ANCHOR_KIND}};Ae.CircularNode=h_;var p_=class extends oc.SNode{get anchorKind(){return sc.RECTANGULAR_ANCHOR_KIND}};Ae.RectangularNode=p_;var g_=class extends oc.SNode{get anchorKind(){return sc.DIAMOND_ANCHOR_KIND}};Ae.DiamondNode=g_;var m_=class extends oc.SPort{get anchorKind(){return sc.ELLIPTIC_ANCHOR_KIND}};Ae.CircularPort=m_;var y_=class extends oc.SPort{get anchorKind(){return sc.RECTANGULAR_ANCHOR_KIND}};Ae.RectangularPort=y_;var __=class extends oP.SModelRoot{constructor(){super(...arguments),this.classes=[]}};Ae.HtmlRoot=__;var mf=class extends oP.SChildElement{};Ae.PreRenderedElement=mf;var rc=class extends mf{constructor(){super(...arguments),this.position=ic.Point.ORIGIN,this.size=ic.Dimension.EMPTY,this.selected=!1,this.alignment=ic.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}};Ae.ShapedPreRenderedElement=rc;rc.DEFAULT_FEATURES=[PB.moveFeature,f_.boundsFeature,IB.selectFeature,f_.alignFeature];var v_=class extends rc{get bounds(){return ic.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,f_.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:ic.Bounds.EMPTY}};Ae.ForeignObjectElement=v_});var dP=f(zn=>{"use strict";var aP=zn&&zn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},RB=zn&&zn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zn,"__esModule",{value:!0});zn.ForeignObjectView=zn.PreRenderedView=void 0;var sP=Gt(),cP=_(),uP=RB(rP()),S_=Ne(),MB=ca(),OB=b_(),E_=class extends MB.ShapeView{render(e,t){if(e instanceof OB.ShapedPreRenderedElement&&!this.isVisible(e,t))return;let n=(0,uP.default)(e.code);if(n!==null)return this.correctNamespace(n),n}correctNamespace(e){(e.sel==="svg"||e.sel==="g")&&(0,S_.setNamespace)(e,"http://www.w3.org/2000/svg")}};E_=aP([(0,cP.injectable)()],E_);zn.PreRenderedView=E_;var w_=class{render(e,t){let n=(0,uP.default)(e.code);if(n===null)return;let r=(0,sP.svg)("g",null,(0,sP.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.bounds.height,width:e.bounds.width,x:0,y:0},n),t.renderChildren(e));return(0,S_.setAttr)(r,"class",e.type),(0,S_.setNamespace)(n,e.namespace),r}};w_=aP([(0,cP.injectable)()],w_);zn.ForeignObjectView=w_});var lP=f(_s=>{"use strict";var TB=_s&&_s.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(_s,"__esModule",{value:!0});_s.HtmlRootView=void 0;var AB=Gt(),CB=_(),xB=Ne(),P_=class{render(e,t){let n=(0,AB.html)("div",null,t.renderChildren(e));for(let r of e.classes)(0,xB.setClass)(n,r,!0);return n}};P_=TB([(0,CB.injectable)()],P_);_s.HtmlRootView=P_});var M_=f((I_,R_)=>{(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof I_<"u"?e():(e(),i.FileSaver={})})(I_,function(){"use strict";function i(a,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function e(a,c,u){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){s(d.response,c,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(a){var c=new XMLHttpRequest;c.open("HEAD",a,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(a,c,u){var d=r.URL||r.webkitURL,l=document.createElement("a");c=c||a.name||"download",l.download=c,l.rel="noopener",typeof a=="string"?(l.href=a,l.origin===location.origin?n(l):t(l.href)?e(a,c,u):n(l,l.target="_blank")):(l.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(a,c,u){if(c=c||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,u),c);else if(t(a))e(a,c,u);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){n(d)})}}:function(a,c,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return e(a,c,u);var l=a.type==="application/octet-stream",S=/constructor/i.test(r.HTMLElement)||r.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||l&&S||o)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var A=v.result;A=R?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=A:location=A,d=null},v.readAsDataURL(a)}else{var m=r.URL||r.webkitURL,O=m.createObjectURL(a);d?d.location=O:location.href=O,d=null,setTimeout(function(){m.revokeObjectURL(O)},4e4)}});r.saveAs=s.saveAs=s,typeof R_<"u"&&(R_.exports=s)})});var x_=f(Ot=>{"use strict";var A_=Ot&&Ot.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gP=Ot&&Ot.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.DiagramServer=Ot.DiagramServerProxy=Ot.ServerStatusAction=Ot.isActionMessage=void 0;var DB=M_(),C_=_(),qB=ur(),Gi=te(),jB=_n(),fP=wu(),NB=P(),O_=Qu(),LB=Rr(),hP=Ul(),T_=Vo();function mP(i){return(0,jB.hasOwnProperty)(i,"action")}Ot.isActionMessage=mP;var Wi=class{constructor(){this.kind=Wi.KIND}};Ot.ServerStatusAction=Wi;Wi.KIND="serverStatus";var pP="__receivedFromServer",vs=class extends T_.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}initialize(e){super.initialize(e),e.register(Gi.ComputedBoundsAction.KIND,this),e.register(O_.RequestBoundsCommand.KIND,this),e.register(Gi.RequestPopupModelAction.KIND,this),e.register(Gi.CollapseExpandAction.KIND,this),e.register(Gi.CollapseExpandAllAction.KIND,this),e.register(qB.OpenAction.KIND,this),e.register(Wi.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(e){this.handleLocally(e)&&this.forwardToServer(e)}forwardToServer(e){let t={clientId:this.clientId,action:e};this.logger.log(this,"sending",t),this.sendMessage(t)}messageReceived(e){let t=typeof e=="string"?JSON.parse(e):e;mP(t)&&t.action?(!t.clientId||t.clientId===this.clientId)&&(t.action[pP]=!0,this.logger.log(this,"receiving",t),this.actionDispatcher.dispatch(t.action).then(()=>{this.storeNewModel(t.action)})):this.logger.error(this,"received data is not an action message",t)}handleLocally(e){switch(this.storeNewModel(e),e.kind){case Gi.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case Gi.RequestModelAction.KIND:return this.handleRequestModel(e);case O_.RequestBoundsCommand.KIND:return!1;case LB.ExportSvgAction.KIND:return this.handleExportSvgAction(e);case Wi.KIND:return this.handleServerStateAction(e)}return!e[pP]}storeNewModel(e){if(e.kind===fP.SetModelCommand.KIND||e.kind===hP.UpdateModelCommand.KIND||e.kind===O_.RequestBoundsCommand.KIND){let t=e.newRoot;t&&(this.currentRoot=t,(e.kind===fP.SetModelCommand.KIND||e.kind===hP.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=t.type))}}handleRequestModel(e){let t=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},e.options),n=Object.assign(Object.assign({},e),{options:t});return this.forwardToServer(n),!1}handleComputedBounds(e){if(this.viewerOptions.needsServerLayout)return!0;{let t=this.currentRoot;return this.computedBoundsApplicator.apply(t,e),t.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(Gi.UpdateModelAction.create(t)):this.actionDispatcher.dispatch(Gi.SetModelAction.create(t)),this.lastSubmittedModelType=t.type,!1}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});return(0,DB.saveAs)(t,"diagram.svg"),!1}handleServerStateAction(e){return!1}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}};A_([(0,C_.inject)(NB.TYPES.ILogger),gP("design:type",Object)],vs.prototype,"logger",void 0);A_([(0,C_.inject)(T_.ComputedBoundsApplicator),gP("design:type",T_.ComputedBoundsApplicator)],vs.prototype,"computedBoundsApplicator",void 0);vs=A_([(0,C_.injectable)()],vs);Ot.DiagramServerProxy=vs;Ot.DiagramServer=vs});var _P=f($i=>{"use strict";var ac=$i&&$i.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yf=$i&&$i.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty($i,"__esModule",{value:!0});$i.LocalModelSource=void 0;var BB=M_(),Lr=_(),gn=te(),yP=bi(),q_=P(),FB=Pn(),VB=us(),KB=Rr(),HB=zl(),zB=Hl(),D_=Vo(),Br=class extends D_.ModelSource{constructor(){super(...arguments),this.currentRoot=FB.EMPTY_ROOT}get model(){return this.currentRoot}set model(e){this.setModel(e)}initialize(e){super.initialize(e),e.register(gn.ComputedBoundsAction.KIND,this),e.register(gn.RequestPopupModelAction.KIND,this)}setModel(e){return this.currentRoot=e,this.submitModel(e,!1)}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}updateModel(e){return e===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=e,this.submitModel(e,!0))}async getSelection(){let e=await this.actionDispatcher.request(zB.GetSelectionAction.create()),t=[];return this.gatherSelectedElements(this.currentRoot,new Set(e.selectedElementsIDs),t),t}gatherSelectedElements(e,t,n){if(t.has(e.id)&&n.push(e),e.children)for(let r of e.children)this.gatherSelectedElements(r,t,n)}async getViewport(){let e=await this.actionDispatcher.request(VB.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}async submitModel(e,t,n){if(this.viewerOptions.needsClientLayout){let r=await this.actionDispatcher.request(gn.RequestBoundsAction.create(e)),o=this.computedBoundsApplicator.apply(this.currentRoot,r);await this.doSubmitModel(e,!0,n,o)}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n,r){if(this.layoutEngine!==void 0)try{let s=this.layoutEngine.layout(e,r);s instanceof Promise?e=await s:s!==void 0&&(e=s)}catch(s){this.logger.error(this,s.toString(),s.stack)}let o=this.lastSubmittedModelType;if(this.lastSubmittedModelType=e.type,n&&n.kind===gn.RequestModelAction.KIND&&n.requestId){let s=n;await this.actionDispatcher.dispatch(gn.SetModelAction.create(e,s.requestId))}else if(t&&e.type===o){let s=Array.isArray(t)?t:e;await this.actionDispatcher.dispatch(gn.UpdateModelAction.create(s,{animate:!0,cause:n}))}else await this.actionDispatcher.dispatch(gn.SetModelAction.create(e))}applyMatches(e){let t=this.currentRoot;return(0,HB.applyMatches)(t,e),this.submitModel(t,e)}addElements(e){let t=[];for(let n of e){let r=n;r.element!==void 0&&r.parentId!==void 0?t.push({right:r.element,rightParentId:r.parentId}):r.id!==void 0&&t.push({right:r,rightParentId:this.currentRoot.id})}return this.applyMatches(t)}removeElements(e){let t=[],n=new yP.SModelIndex;n.add(this.currentRoot);for(let r of e){let o=r;if(o.elementId!==void 0&&o.parentId!==void 0){let s=n.getById(o.elementId);s!==void 0&&t.push({left:s,leftParentId:o.parentId})}else{let s=n.getById(o);s!==void 0&&t.push({left:s,leftParentId:this.currentRoot.id})}}return this.applyMatches(t)}handle(e){switch(e.kind){case gn.RequestModelAction.KIND:this.handleRequestModel(e);break;case gn.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,e);break;case gn.RequestPopupModelAction.KIND:this.handleRequestPopupModel(e);break;case KB.ExportSvgAction.KIND:this.handleExportSvgAction(e);break}}handleRequestModel(e){this.submitModel(this.currentRoot,!1,e)}handleRequestPopupModel(e){if(this.popupModelProvider!==void 0){let t=(0,yP.findElement)(this.currentRoot,e.elementId),n=this.popupModelProvider.getPopupModel(e,t);n!==void 0&&(n.canvasBounds=e.bounds,this.actionDispatcher.dispatch(gn.SetPopupModelAction.create(n,e.requestId)))}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});(0,BB.saveAs)(t,"diagram.svg")}};ac([(0,Lr.inject)(q_.TYPES.ILogger),yf("design:type",Object)],Br.prototype,"logger",void 0);ac([(0,Lr.inject)(D_.ComputedBoundsApplicator),yf("design:type",D_.ComputedBoundsApplicator)],Br.prototype,"computedBoundsApplicator",void 0);ac([(0,Lr.inject)(q_.TYPES.IPopupModelProvider),(0,Lr.optional)(),yf("design:type",Object)],Br.prototype,"popupModelProvider",void 0);ac([(0,Lr.inject)(q_.TYPES.IModelLayoutEngine),(0,Lr.optional)(),yf("design:type",Object)],Br.prototype,"layoutEngine",void 0);Br=ac([(0,Lr.injectable)()],Br);$i.LocalModelSource=Br});var EP=f(mn=>{"use strict";var j_=mn&&mn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vP=mn&&mn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(mn,"__esModule",{value:!0});mn.ForwardingLogger=mn.LoggingAction=void 0;var N_=_(),Xi=Yu(),bP=P(),SP;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(SP=mn.LoggingAction||(mn.LoggingAction={}));var cc=class{error(e,t,...n){this.logLevel>=Xi.LogLevel.error&&this.forward(e,t,Xi.LogLevel.error,n)}warn(e,t,...n){this.logLevel>=Xi.LogLevel.warn&&this.forward(e,t,Xi.LogLevel.warn,n)}info(e,t,...n){this.logLevel>=Xi.LogLevel.info&&this.forward(e,t,Xi.LogLevel.info,n)}log(e,t,...n){if(this.logLevel>=Xi.LogLevel.log)try{let r=typeof e=="object"?e.constructor.name:String(e);console.log.apply(e,[r+": "+t,...n])}catch{}}forward(e,t,n,r){let o=new Date,s=SP.create({message:t,severity:Xi.LogLevel[n],time:o.toLocaleTimeString(),caller:typeof e=="object"?e.constructor.name:String(e),params:r.map(a=>JSON.stringify(a))});this.modelSourceProvider().then(a=>{try{a.handle(s)}catch(c){try{console.log.apply(e,[t,s,c])}catch{}}})}};j_([(0,N_.inject)(bP.TYPES.ModelSourceProvider),vP("design:type",Function)],cc.prototype,"modelSourceProvider",void 0);j_([(0,N_.inject)(bP.TYPES.LogLevel),vP("design:type",Number)],cc.prototype,"logLevel",void 0);cc=j_([(0,N_.injectable)()],cc);mn.ForwardingLogger=cc});var wP=f(Ji=>{"use strict";var YB=Ji&&Ji.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ji,"__esModule",{value:!0});Ji.WebSocketDiagramServer=Ji.WebSocketDiagramServerProxy=void 0;var kB=_(),UB=x_(),_f=class extends UB.DiagramServerProxy{listen(e){e.addEventListener("message",t=>{this.messageReceived(t.data)}),e.addEventListener("error",t=>{this.logger.error(this,"error event received",t)}),this.webSocket=e}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(e){if(this.webSocket)this.webSocket.send(JSON.stringify(e));else throw new Error("WebSocket is not connected")}};_f=YB([(0,kB.injectable)()],_f);Ji.WebSocketDiagramServerProxy=_f;Ji.WebSocketDiagramServer=_f});var PP=f(Zi=>{"use strict";Object.defineProperty(Zi,"__esModule",{value:!0});Zi.ColorMap=Zi.toSVG=Zi.rgb=void 0;function GB(i,e,t){return{red:i,green:e,blue:t}}Zi.rgb=GB;function WB(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}Zi.toSVG=WB;var L_=class{constructor(e){this.stops=e}getColor(e){e=Math.max(0,Math.min(.99999999,e));let t=Math.floor(e*this.stops.length);return this.stops[t]}};Zi.ColorMap=L_});var RP=f(IP=>{"use strict";Object.defineProperty(IP,"__esModule",{value:!0})});var vf=f(h=>{"use strict";var $B=h&&h.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),g=h&&h.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&$B(e,i,t)},Se=h&&h.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(h,"__esModule",{value:!0});h.modelSourceModule=h.zorderModule=h.viewportModule=h.updateModule=h.undoRedoModule=h.selectModule=h.routingModule=h.openModule=h.moveModule=h.hoverModule=h.fadeModule=h.exportModule=h.expandModule=h.edgeLayoutModule=h.edgeIntersectionModule=h.decorationModule=h.contextMenuModule=h.commandPaletteModule=h.buttonModule=h.boundsModule=h.graphModule=h.defaultModule=void 0;g(hc(),h);g(au(),h);g(Ls(),h);g(rh(),h);g($r(),h);g(or(),h);g(oh(),h);g(pe(),h);g(yt(),h);g(gb(),h);g(gh(),h);g(Vs(),h);g(wu(),h);g(xb(),h);g(Pn(),h);g(Ke(),h);g(G(),h);g(Ah(),h);g(Pu(),h);g(ks(),h);g(Au(),h);g(an(),h);g(Tt(),h);g(Gh(),h);g(lo(),h);g(Qh(),h);g(ep(),h);g(tp(),h);g(ip(),h);g(Ne(),h);g(P(),h);var XB=Se(lp());h.defaultModule=XB.default;g(Qu(),h);g(mp(),h);g(nd(),h);g(ae(),h);g(bp(),h);g(Sp(),h);g(Ep(),h);g(ca(),h);g(da(),h);g(fd(),h);g(hd(),h);g(Bp(),h);g($S(),h);g(vd(),h);g(Yp(),h);g(Bd(),h);g(Zp(),h);g(qo(),h);g(M0(),h);g(tg(),h);g(Ag(),h);g(xo(),h);g(Yd(),h);g(Pg(),h);g(Ca(),h);g(jo(),h);g(Xd(),h);g(Cg(),h);g(Zd(),h);g(nE(),h);g(jg(),h);g(Pd(),h);g(Rr(),h);g(ol(),h);g(To(),h);g(Kg(),h);g(vr(),h);g(cl(),h);g(Ug(),h);g(Gg(),h);g(ll(),h);g(Zg(),h);g(Ti(),h);g(Ya(),h);g(RE(),h);g(Mp(),h);g(am(),h);g(om(),h);g(vl(),h);g(qE(),h);g(ti(),h);g(va(),h);g(Mm(),h);g(Il(),h);g(Nm(),h);g(Ml(),h);g(me(),h);g(Sl(),h);g(Sa(),h);g(fn(),h);g(Bm(),h);g(Et(),h);g(Hl(),h);g(Gm(),h);g(zl(),h);g(Ul(),h);g(Zl(),h);g(An(),h);g(sy(),h);g(Md(),h);g(us(),h);g($d(),h);g(ay(),h);var JB=Se(Ow());h.graphModule=JB.default;var ZB=Se(hy());h.boundsModule=ZB.default;var QB=Se(gy());h.buttonModule=QB.default;var eF=Se(_y());h.commandPaletteModule=eF.default;var tF=Se(by());h.contextMenuModule=tF.default;var nF=Se(Ey());h.decorationModule=nF.default;var iF=Se(Fw());h.edgeIntersectionModule=iF.default;var rF=Se(Bd());h.edgeLayoutModule=rF.default;var oF=Se(Iy());h.expandModule=oF.default;var sF=Se(Oy());h.exportModule=sF.default;var aF=Se(Ay());h.fadeModule=aF.default;var cF=Se(xy());h.hoverModule=cF.default;var uF=Se(jy());h.moveModule=uF.default;var dF=Se(Ly());h.openModule=dF.default;var lF=Se(zy());h.routingModule=lF.default;var fF=Se(Uy());h.selectModule=fF.default;var hF=Se(Wy());h.undoRedoModule=hF.default;var pF=Se(Xy());h.updateModule=pF.default;var gF=Se(Qy());h.viewportModule=gF.default;var mF=Se(t_());h.zorderModule=mF.default;g(uy(),h);g(Er(),h);g(nP(),h);g(iP(),h);g(dP(),h);g(lP(),h);g(Gt(),h);g(b_(),h);g(dg(),h);g(Ma(),h);g(x_(),h);g(_P(),h);g(EP(),h);g(Vo(),h);g(wP(),h);var yF=Se(c_());h.modelSourceModule=yF.default;g(In(),h);g(xp(),h);g(PP(),h);g(Ir(),h);g(rr(),h);g(RP(),h);g(Yu(),h);g(wn(),h)});var z_;(function(i){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return Ef(Object.create(null))}:a?function(){return Ef({__proto__:null})}:function(){return Ef({})},has:c?function(p,y){return t.call(p,y)}:function(p,y){return y in p},get:c?function(p,y){return t.call(p,y)?p[y]:void 0}:function(p,y){return p[y]}},d=Object.getPrototypeOf(Function),l=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",S=!l&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:jP(),R=!l&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:NP(),v=!l&&typeof WeakMap=="function"?WeakMap:LP(),m=new v;function O(p,y,w,I){if(q(w)){if(!B_(p))throw new TypeError;if(!F_(y))throw new TypeError;return we(p,y)}else{if(!B_(p))throw new TypeError;if(!k(y))throw new TypeError;if(!k(I)&&!q(I)&&!se(I))throw new TypeError;return se(I)&&(I=void 0),w=ot(w),le(p,y,w,I)}}e("decorate",O);function A(p,y){function w(I,C){if(!k(I))throw new TypeError;if(!q(C)&&!AP(C))throw new TypeError;Rs(p,y,I,C)}return w}e("metadata",A);function K(p,y,w,I){if(!k(w))throw new TypeError;return q(I)||(I=ot(I)),Rs(p,y,w,I)}e("defineMetadata",K);function U(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=ot(w)),Ge(p,y,w)}e("hasMetadata",U);function D(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=ot(w)),yn(p,y,w)}e("hasOwnMetadata",D);function F(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=ot(w)),ai(p,y,w)}e("getMetadata",F);function H(p,y,w){if(!k(y))throw new TypeError;return q(w)||(w=ot(w)),Is(p,y,w)}e("getOwnMetadata",H);function W(p,y){if(!k(p))throw new TypeError;return q(y)||(y=ot(y)),Ms(p,y)}e("getMetadataKeys",W);function z(p,y){if(!k(p))throw new TypeError;return q(y)||(y=ot(y)),dc(p,y)}e("getOwnMetadataKeys",z);function oe(p,y,w){if(!k(y))throw new TypeError;q(w)||(w=ot(w));var I=_e(y,w,!1);if(q(I)||!I.delete(p))return!1;if(I.size>0)return!0;var C=m.get(y);return C.delete(w),C.size>0||m.delete(y),!0}e("deleteMetadata",oe);function we(p,y){for(var w=p.length-1;w>=0;--w){var I=p[w],C=I(y);if(!q(C)&&!se(C)){if(!F_(C))throw new TypeError;y=C}}return y}function le(p,y,w,I){for(var C=p.length-1;C>=0;--C){var Ve=p[C],V=Ve(y,w,I);if(!q(V)&&!se(V)){if(!k(V))throw new TypeError;I=V}}return I}function _e(p,y,w){var I=m.get(p);if(q(I)){if(!w)return;I=new S,m.set(p,I)}var C=I.get(y);if(q(C)){if(!w)return;C=new S,I.set(y,C)}return C}function Ge(p,y,w){var I=yn(p,y,w);if(I)return!0;var C=Sf(y);return se(C)?!1:Ge(p,C,w)}function yn(p,y,w){var I=_e(y,w,!1);return q(I)?!1:sn(I.has(p))}function ai(p,y,w){var I=yn(p,y,w);if(I)return Is(p,y,w);var C=Sf(y);if(!se(C))return ai(p,C,w)}function Is(p,y,w){var I=_e(y,w,!1);if(!q(I))return I.get(p)}function Rs(p,y,w,I){var C=_e(w,I,!0);C.set(p,y)}function Ms(p,y){var w=dc(p,y),I=Sf(p);if(I===null)return w;var C=Ms(I,y);if(C.length<=0)return w;if(w.length<=0)return C;for(var Ve=new R,V=[],Y=0,j=w;Y<j.length;Y++){var $=j[Y],X=Ve.has($);X||(Ve.add($),V.push($))}for(var ui=0,K_=C;ui<K_.length;ui++){var $=K_[ui],X=Ve.has($);X||(Ve.add($),V.push($))}return V}function dc(p,y){var w=[],I=_e(p,y,!1);if(q(I))return w;for(var C=I.keys(),Ve=CP(C),V=0;;){var Y=DP(Ve);if(!Y)return w.length=V,w;var j=xP(Y);try{w[V]=j}catch($){try{qP(Ve)}finally{throw $}}V++}}function N(p){if(p===null)return 1;switch(typeof p){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return p===null?1:6;default:return 6}}function q(p){return p===void 0}function se(p){return p===null}function qe(p){return typeof p=="symbol"}function k(p){return typeof p=="object"?p!==null:typeof p=="function"}function Fe(p,y){switch(N(p)){case 0:return p;case 1:return p;case 2:return p;case 3:return p;case 4:return p;case 5:return p}var w=y===3?"string":y===5?"number":"default",I=V_(p,r);if(I!==void 0){var C=I.call(p,w);if(k(C))throw new TypeError;return C}return ci(p,w==="default"?"number":w)}function ci(p,y){if(y==="string"){var w=p.toString;if(Fr(w)){var I=w.call(p);if(!k(I))return I}var C=p.valueOf;if(Fr(C)){var I=C.call(p);if(!k(I))return I}}else{var C=p.valueOf;if(Fr(C)){var I=C.call(p);if(!k(I))return I}var Ve=p.toString;if(Fr(Ve)){var I=Ve.call(p);if(!k(I))return I}}throw new TypeError}function sn(p){return!!p}function We(p){return""+p}function ot(p){var y=Fe(p,3);return qe(y)?y:We(y)}function B_(p){return Array.isArray?Array.isArray(p):p instanceof Object?p instanceof Array:Object.prototype.toString.call(p)==="[object Array]"}function Fr(p){return typeof p=="function"}function F_(p){return typeof p=="function"}function AP(p){switch(N(p)){case 3:return!0;case 4:return!0;default:return!1}}function V_(p,y){var w=p[y];if(w!=null){if(!Fr(w))throw new TypeError;return w}}function CP(p){var y=V_(p,o);if(!Fr(y))throw new TypeError;var w=y.call(p);if(!k(w))throw new TypeError;return w}function xP(p){return p.value}function DP(p){var y=p.next();return y.done?!1:y}function qP(p){var y=p.return;y&&y.call(p)}function Sf(p){var y=Object.getPrototypeOf(p);if(typeof p!="function"||p===d||y!==d)return y;var w=p.prototype,I=w&&Object.getPrototypeOf(w);if(I==null||I===Object.prototype)return y;var C=I.constructor;return typeof C!="function"||C===p?y:C}function jP(){var p={},y=[],w=function(){function V(Y,j,$){this._index=0,this._keys=Y,this._values=j,this._selector=$}return V.prototype["@@iterator"]=function(){return this},V.prototype[o]=function(){return this},V.prototype.next=function(){var Y=this._index;if(Y>=0&&Y<this._keys.length){var j=this._selector(this._keys[Y],this._values[Y]);return Y+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:j,done:!1}}return{value:void 0,done:!0}},V.prototype.throw=function(Y){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),Y},V.prototype.return=function(Y){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:Y,done:!0}},V}();return function(){function V(){this._keys=[],this._values=[],this._cacheKey=p,this._cacheIndex=-2}return Object.defineProperty(V.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),V.prototype.has=function(Y){return this._find(Y,!1)>=0},V.prototype.get=function(Y){var j=this._find(Y,!1);return j>=0?this._values[j]:void 0},V.prototype.set=function(Y,j){var $=this._find(Y,!0);return this._values[$]=j,this},V.prototype.delete=function(Y){var j=this._find(Y,!1);if(j>=0){for(var $=this._keys.length,X=j+1;X<$;X++)this._keys[X-1]=this._keys[X],this._values[X-1]=this._values[X];return this._keys.length--,this._values.length--,Y===this._cacheKey&&(this._cacheKey=p,this._cacheIndex=-2),!0}return!1},V.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=p,this._cacheIndex=-2},V.prototype.keys=function(){return new w(this._keys,this._values,I)},V.prototype.values=function(){return new w(this._keys,this._values,C)},V.prototype.entries=function(){return new w(this._keys,this._values,Ve)},V.prototype["@@iterator"]=function(){return this.entries()},V.prototype[o]=function(){return this.entries()},V.prototype._find=function(Y,j){return this._cacheKey!==Y&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Y)),this._cacheIndex<0&&j&&(this._cacheIndex=this._keys.length,this._keys.push(Y),this._values.push(void 0)),this._cacheIndex},V}();function I(V,Y){return V}function C(V,Y){return Y}function Ve(V,Y){return[V,Y]}}function NP(){return function(){function p(){this._map=new S}return Object.defineProperty(p.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),p.prototype.has=function(y){return this._map.has(y)},p.prototype.add=function(y){return this._map.set(y,y),this},p.prototype.delete=function(y){return this._map.delete(y)},p.prototype.clear=function(){this._map.clear()},p.prototype.keys=function(){return this._map.keys()},p.prototype.values=function(){return this._map.values()},p.prototype.entries=function(){return this._map.entries()},p.prototype["@@iterator"]=function(){return this.keys()},p.prototype[o]=function(){return this.keys()},p}()}function LP(){var p=16,y=u.create(),w=I();return function(){function j(){this._key=I()}return j.prototype.has=function($){var X=C($,!1);return X!==void 0?u.has(X,this._key):!1},j.prototype.get=function($){var X=C($,!1);return X!==void 0?u.get(X,this._key):void 0},j.prototype.set=function($,X){var ui=C($,!0);return ui[this._key]=X,this},j.prototype.delete=function($){var X=C($,!1);return X!==void 0?delete X[this._key]:!1},j.prototype.clear=function(){this._key=I()},j}();function I(){var j;do j="@@WeakMap@@"+Y();while(u.has(y,j));return y[j]=!0,j}function C(j,$){if(!t.call(j,w)){if(!$)return;Object.defineProperty(j,w,{value:u.create()})}return j[w]}function Ve(j,$){for(var X=0;X<$;++X)j[X]=Math.random()*255|0;return j}function V(j){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(j)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(j)):Ve(new Uint8Array(j),j):Ve(new Array(j),j)}function Y(){var j=V(p);j[6]=j[6]&79|64,j[8]=j[8]&191|128;for(var $="",X=0;X<p;++X){var ui=j[X];(X===4||X===6||X===8)&&($+="-"),ui<16&&($+="0"),$+=ui.toString(16).toLowerCase()}return $}}function Ef(p){return p.__=void 0,delete p.__,p}})})(z_||(z_={}));var OP=Vr(vf());var bf=Vr(_()),L=Vr(vf());var Ue=Vr(Gt()),uc=Vr(_()),Ps=Vr(vf());var bs=class extends Ps.ShapeView{render(e,t,n){return(0,Ue.svg)("polygon",{points:"-6,-4 0,0 -6,4",style:{fill:"black"}})}};bs=Os([(0,uc.injectable)()],bs);var Ss=class extends Ps.RectangularNodeView{render(e,t,n){return(0,Ue.svg)("g",null,(0,Ue.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width-(e.arrow!==0?10:0),height:e.size.height}),(0,Ue.svg)("rect",{"class-input-back":!0,width:"10",height:e.size.height}),e.arrow!==0&&(0,Ue.svg)("polygon",{"class-input-arrow-full":e.arrow===1,"class-input-arrow-stroke":e.arrow===2,points:`${e.size.width-10},0 ${e.size.width},${e.size.height/2} ${e.size.width-10},${e.size.height}`}),(0,Ue.svg)("text",{x:"0",y:e.size.height+15,"class-sprotty-text":!0},e.text))}};Ss=Os([(0,uc.injectable)()],Ss);var Es=class extends Ps.RectangularNodeView{render(e,t,n){return(0,Ue.svg)("g",null,(0,Ue.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),(0,Ue.svg)("rect",{"class-controller-marker":!0,width:"10",height:"10",x:e.size.width/2-5,y:"-5"}),(0,Ue.svg)("text",{x:"0",y:e.size.height+20,"class-sprotty-text":!0},e.text))}};Es=Os([(0,uc.injectable)()],Es);var ws=class extends Ps.RectangularNodeView{render(e,t,n){return(0,Ue.svg)("g",null,(0,Ue.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width,height:e.size.height}),e.operand==="+"&&(0,Ue.svg)("text",{x:2,y:e.size.height+1,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="\xF7"&&(0,Ue.svg)("text",{x:3,y:e.size.height,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="-"&&(0,Ue.svg)("text",{x:5,y:30,w:!0,"class-operand-symbol":!0,style:{fontSize:"54"}},e.operand),e.operand==="MN"&&(0,Ue.svg)("text",{x:2,y:35,w:!0,"class-operand-symbol":!0,style:{fontSize:"30",transform:"scaleX(0.8)"}},e.operand))}};ws=Os([(0,uc.injectable)()],ws);var MP=i=>{let e=new bf.ContainerModule((n,r,o,s)=>{n(L.TYPES.ModelSource).to(L.LocalModelSource).inSingletonScope(),s(L.TYPES.ILogger).to(L.ConsoleLogger).inSingletonScope(),s(L.TYPES.LogLevel).toConstantValue(L.LogLevel.log);let a={bind:n,unbind:r,isBound:o,rebind:s};(0,L.configureModelElement)(a,"graph",L.SGraph,L.SGraphView),(0,L.configureModelElement)(a,"node:input",L.RectangularNode,Ss),(0,L.configureModelElement)(a,"node:controller",L.RectangularNode,Es),(0,L.configureModelElement)(a,"node:operand",L.RectangularNode,ws),(0,L.configureModelElement)(a,"edge:straight",L.SEdge,L.PolylineEdgeView),(0,L.configureModelElement)(a,"label:arrow",L.SLabel,bs),(0,L.configureModelElement)(a,"label:text",L.SLabel,L.SLabelView),(0,L.configureModelElement)(a,"routing-point",L.SRoutingHandle,L.SRoutingHandleView),(0,L.configureModelElement)(a,"volatile-routing-point",L.SRoutingHandle,L.SRoutingHandleView),(0,L.configureViewerOptions)(a,{needsClientLayout:!1,baseDiv:i})}),t=new bf.Container;return(0,L.loadDefaultModules)(t),t.load(e),t};function TP(){MP("sprotty-showcase").get(OP.TYPES.ModelSource).setModel({type:"graph",id:"graph",children:[{id:"targetPosEdge",type:"edge:straight",sourceId:"target_pos",targetId:"AddOperand",routerKind:"manhattan",children:rt()},{id:"MaxPosEdge",type:"edge:straight",sourceId:"MaxPosition",targetId:"limiter",routerKind:"manhattan",routingPoints:[{x:260,y:207}],children:rt()},{id:"AddLimiterEdge",type:"edge:straight",sourceId:"AddOperand",targetId:"limiter",routerKind:"manhattan",children:rt()},{id:"OffsetPosEdge",type:"edge:straight",sourceId:"offset_pos",targetId:"AddOperand",routerKind:"manhattan",routingPoints:[{x:145,y:367}],children:rt()},{id:"limiterEdge",type:"edge:straight",sourceId:"limiter",targetId:"SubOperand",routerKind:"manhattan",children:rt()},{id:"actualPosEdge",type:"edge:straight",sourceId:"actual_pos",targetId:"SubOperand",routerKind:"manhattan",routingPoints:[{x:335,y:407}],children:rt()},{id:"SubToDivEdge",type:"edge:straight",sourceId:"SubOperand",targetId:"DivOperand",routerKind:"manhattan",children:rt()},{id:"DivToPIDTEdge",type:"edge:straight",sourceId:"DivOperand",targetId:"pidt",routerKind:"manhattan",children:rt()},{id:"outputEdge",type:"edge:straight",sourceId:"pidt",targetId:"new_pos",routerKind:"manhattan",children:rt()},{id:"T_lEdge",type:"edge:straight",sourceId:"T_l",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:660,y:37}],children:rt()},{id:"T_dEdge",type:"edge:straight",sourceId:"T_d",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:630,y:77}],children:rt()},{id:"T_iEdge",type:"edge:straight",sourceId:"T_i",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:590,y:117}],children:rt()},{id:"P_GainEdge",type:"edge:straight",sourceId:"P_Gain",targetId:"MNOperand",routerKind:"manhattan",children:rt()},{id:"P_MaxEdge",type:"edge:straight",sourceId:"P_max",targetId:"MNOperand",routerKind:"manhattan",children:rt()},{id:"MNOperandEdge",type:"edge:straight",sourceId:"MNOperand",targetId:"pidt",routerKind:"manhattan",routingPoints:[{x:560,y:190}],children:rt()},{id:"cf_Degree2RadEdge",type:"edge:straight",sourceId:"cf_Degree2Rad",targetId:"DivOperand",routerKind:"manhattan",routingPoints:[{x:475,y:357}],children:rt()},{id:"limiter",text:"limiter",type:"node:controller",position:{x:200,y:285},size:{width:80,height:60}},{id:"pidt",text:"pidt1",type:"node:controller",position:{x:550,y:275},size:{width:120,height:80}},{id:"MaxPosition",type:"node:input",text:"MaxPosition",arrow:2,position:{x:100,y:200},size:{width:40,height:15}},{id:"target_pos",type:"node:input",text:"target_pos",arrow:1,position:{x:0,y:307.5},size:{width:40,height:15}},{id:"offset_pos",type:"node:input",text:"offset_pos",arrow:0,position:{x:50,y:360},size:{width:40,height:15}},{id:"actual_pos",type:"node:input",text:"actual_position",arrow:1,position:{x:0,y:400},size:{width:40,height:15}},{id:"new_pos",type:"node:input",text:"new_position",arrow:1,position:{x:700,y:307.5},size:{width:40,height:15}},{id:"T_l",type:"node:input",text:"T_l",arrow:0,position:{x:350,y:30},size:{width:40,height:15}},{id:"T_d",type:"node:input",text:"T_d",arrow:0,position:{x:350,y:70},size:{width:40,height:15}},{id:"T_i",type:"node:input",text:"T_i",arrow:0,position:{x:350,y:110},size:{width:40,height:15}},{id:"P_Gain",type:"node:input",text:"P_Gain",arrow:0,position:{x:350,y:150},size:{width:40,height:15}},{id:"P_max",type:"node:input",text:"P_max",arrow:2,position:{x:350,y:190},size:{width:40,height:15}},{id:"cf_Degree2Rad",type:"node:input",text:"cf_Degree2Rad",arrow:2,position:{x:380,y:350},size:{width:40,height:15}},{id:"AddOperand",type:"node:operand",operand:"+",position:{x:130,y:300},size:{width:30,height:30}},{id:"SubOperand",type:"node:operand",operand:"-",position:{x:320,y:300},size:{width:30,height:30}},{id:"DivOperand",type:"node:operand",operand:"\xF7",position:{x:460,y:300},size:{width:30,height:30}},{id:"MNOperand",type:"node:operand",operand:"MN",position:{x:440,y:160},size:{width:40,height:50}}]})}var bF=0;function rt(){return[{id:"arrow"+bF++,type:"label:arrow",text:"",edgePlacement:{position:1,side:"on",rotate:!0}}]}document.addEventListener("DOMContentLoaded",()=>TP());})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=bundle.js.map
