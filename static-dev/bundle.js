(()=>{var GP=Object.create;var Cf=Object.defineProperty;var X_=Object.getOwnPropertyDescriptor;var $P=Object.getOwnPropertyNames;var WP=Object.getPrototypeOf,XP=Object.prototype.hasOwnProperty;var f=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var JP=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of $P(e))!XP.call(i,r)&&r!==t&&Cf(i,r,{get:()=>e[r],enumerable:!(n=X_(e,r))||n.enumerable});return i};var Yr=(i,e,t)=>(t=i!=null?GP(WP(i)):{},JP(e||!i||!i.__esModule?Cf(t,"default",{value:i,enumerable:!0}):t,i));var un=(i,e,t,n)=>{for(var r=n>1?void 0:n?X_(e,t):e,o=i.length-1,s;o>=0;o--)(s=i[o])&&(r=(n?s(e,t,r):s(r))||r);return n&&r&&Cf(e,t,r),r};var En=f(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.safeAssign=pi.hasOwnProperty=pi.isObject=void 0;function Z_(i){return typeof i=="object"&&i!==null}pi.isObject=Z_;function ZP(i,e,t){if(!Z_(i))return!1;if(Array.isArray(e))for(let n of e){if(!Object.prototype.hasOwnProperty.call(i,n)||typeof t=="string"&&typeof i[n]!==t)return!1;if(typeof t=="function"&&!t(i[n]))return!1}else{if(!Object.prototype.hasOwnProperty.call(i,e))return!1;if(typeof t=="string")return typeof i[e]===t;if(typeof t=="function")return t(i[e])}return!0}pi.hasOwnProperty=ZP;function QP(i,e){return Object.assign(i,e)}pi.safeAssign=QP});var ie=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.ReconnectAction=E.ApplyLabelEditAction=E.DeleteElementAction=E.CreateElementAction=E.HoverFeedbackAction=E.MoveAction=E.RedoAction=E.UndoAction=E.BringToFrontAction=E.SetViewportAction=E.FitToScreenAction=E.CenterAction=E.LayoutAction=E.OpenAction=E.CollapseExpandAllAction=E.CollapseExpandAction=E.SelectAllAction=E.SelectAction=E.LoggingAction=E.ComputedBoundsAction=E.RequestBoundsAction=E.SetBoundsAction=E.SetPopupModelAction=E.RequestPopupModelAction=E.UpdateModelAction=E.SetModelAction=E.RequestModelAction=E.RejectAction=E.isResponseAction=E.generateRequestId=E.isRequestAction=E.isAction=E.isActionMessage=void 0;var vc=En();function eI(i){return(0,vc.hasOwnProperty)(i,"action")}E.isActionMessage=eI;function tI(i){return(0,vc.hasOwnProperty)(i,"kind","string")}E.isAction=tI;function nI(i){return(0,vc.hasOwnProperty)(i,"requestId","string")}E.isRequestAction=nI;var iI=1;function bc(){return(iI++).toString()}E.generateRequestId=bc;function rI(i){return(0,vc.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}E.isResponseAction=rI;var oI;(function(i){i.KIND="rejectRequest";function e(t){return{kind:i.KIND,message:t.message,detail:t.detail,responseId:t.requestId}}i.create=e})(oI=E.RejectAction||(E.RejectAction={}));var sI;(function(i){i.KIND="requestModel";function e(t){return{kind:i.KIND,options:t,requestId:bc()}}i.create=e})(sI=E.RequestModelAction||(E.RequestModelAction={}));var aI;(function(i){i.KIND="setModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(aI=E.SetModelAction||(E.SetModelAction={}));var cI;(function(i){i.KIND="updateModel";function e(t,n={}){return Array.isArray(t)?{kind:i.KIND,matches:t,animate:n.animate,cause:n.cause}:{kind:i.KIND,newRoot:t,animate:n.animate,cause:n.cause}}i.create=e})(cI=E.UpdateModelAction||(E.UpdateModelAction={}));var uI;(function(i){i.KIND="requestPopupModel";function e(t){return{kind:i.KIND,elementId:t.elementId,bounds:t.bounds,requestId:bc()}}i.create=e})(uI=E.RequestPopupModelAction||(E.RequestPopupModelAction={}));var dI;(function(i){i.KIND="setPopupModel";function e(t,n=""){return{kind:i.KIND,newRoot:t,responseId:n}}i.create=e})(dI=E.SetPopupModelAction||(E.SetPopupModelAction={}));var lI;(function(i){i.KIND="setBounds";function e(t){return{kind:i.KIND,bounds:t}}i.create=e})(lI=E.SetBoundsAction||(E.SetBoundsAction={}));var fI;(function(i){i.KIND="requestBounds";function e(t){return{kind:i.KIND,newRoot:t,requestId:bc()}}i.create=e})(fI=E.RequestBoundsAction||(E.RequestBoundsAction={}));var hI;(function(i){i.KIND="computedBounds";function e(t,n={}){var r;return{kind:i.KIND,bounds:t,revision:n.revision,alignments:n.alignments,responseId:(r=n.requestId)!==null&&r!==void 0?r:""}}i.create=e})(hI=E.ComputedBoundsAction||(E.ComputedBoundsAction={}));var pI;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(pI=E.LoggingAction||(E.LoggingAction={}));var gI;(function(i){i.KIND="elementSelected";function e(t){var n,r;return{kind:i.KIND,selectedElementsIDs:(n=t.selectedElementsIDs)!==null&&n!==void 0?n:[],deselectedElementsIDs:(r=t.deselectedElementsIDs)!==null&&r!==void 0?r:[]}}i.create=e})(gI=E.SelectAction||(E.SelectAction={}));var mI;(function(i){i.KIND="allSelected";function e(t={}){var n;return{kind:i.KIND,select:(n=t.select)!==null&&n!==void 0?n:!0}}i.create=e})(mI=E.SelectAllAction||(E.SelectAllAction={}));var yI;(function(i){i.KIND="collapseExpand";function e(t){var n,r;return{kind:i.KIND,expandIds:(n=t.expandIds)!==null&&n!==void 0?n:[],collapseIds:(r=t.collapseIds)!==null&&r!==void 0?r:[]}}i.create=e})(yI=E.CollapseExpandAction||(E.CollapseExpandAction={}));var _I;(function(i){i.KIND="collapseExpandAll";function e(t={}){var n;return{kind:i.KIND,expand:(n=t.expand)!==null&&n!==void 0?n:!0}}i.create=e})(_I=E.CollapseExpandAllAction||(E.CollapseExpandAllAction={}));var vI;(function(i){i.KIND="open";function e(t){return{kind:i.KIND,elementId:t}}i.create=e})(vI=E.OpenAction||(E.OpenAction={}));var bI;(function(i){i.KIND="layout";function e(t={}){return{kind:i.KIND,layoutType:t.layoutType,elementIds:t.elementIds}}i.create=e})(bI=E.LayoutAction||(E.LayoutAction={}));var SI;(function(i){i.KIND="center";function e(t,n={}){var r,o;return{kind:i.KIND,elementIds:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,retainZoom:(o=n.retainZoom)!==null&&o!==void 0?o:!1}}i.create=e})(SI=E.CenterAction||(E.CenterAction={}));var EI;(function(i){i.KIND="fit";function e(t,n={}){var r;return{kind:i.KIND,elementIds:t,padding:n.padding,maxZoom:n.maxZoom,animate:(r=n.animate)!==null&&r!==void 0?r:!0}}i.create=e})(EI=E.FitToScreenAction||(E.FitToScreenAction={}));var wI;(function(i){i.KIND="viewport";function e(t,n,r={}){var o;return{kind:i.KIND,elementId:t,newViewport:n,animate:(o=r.animate)!==null&&o!==void 0?o:!0}}i.create=e})(wI=E.SetViewportAction||(E.SetViewportAction={}));var PI;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(PI=E.BringToFrontAction||(E.BringToFrontAction={}));var II;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(II=E.UndoAction||(E.UndoAction={}));var RI;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(RI=E.RedoAction||(E.RedoAction={}));var MI;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(MI=E.MoveAction||(E.MoveAction={}));var TI;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(TI=E.HoverFeedbackAction||(E.HoverFeedbackAction={}));var OI;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(OI=E.CreateElementAction||(E.CreateElementAction={}));var AI;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(AI=E.DeleteElementAction||(E.DeleteElementAction={}));var CI;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(CI=E.ApplyLabelEditAction||(E.ApplyLabelEditAction={}));var xI;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(xI=E.ReconnectAction||(E.ReconnectAction={}))});var Sc=f(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.isLabeledAction=Xe.LabeledAction=Xe.RejectAction=Xe.isResponseAction=Xe.generateRequestId=Xe.isRequestAction=Xe.isAction=void 0;var qI=ie(),qf=En();function Df(i){return(0,qf.hasOwnProperty)(i,"kind","string")}Xe.isAction=Df;function DI(i){return Df(i)&&(0,qf.hasOwnProperty)(i,"requestId","string")}Xe.isRequestAction=DI;Xe.generateRequestId=qI.generateRequestId;function jI(i){return Df(i)&&(0,qf.hasOwnProperty)(i,"responseId","string")&&i.responseId!==""}Xe.isResponseAction=jI;var Ur=class{constructor(e,t,n){this.message=e,this.responseId=t,this.detail=n,this.kind=Ur.KIND}};Xe.RejectAction=Ur;Ur.KIND="rejectRequest";var xf=class{constructor(e,t,n){this.label=e,this.actions=t,this.icon=n}};Xe.LabeledAction=xf;function NI(i){return i!==void 0&&i.label!==void 0&&i.actions!==void 0}Xe.isLabeledAction=NI});var qe=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.NON_CUSTOM_TAG_KEYS=Z.POST_CONSTRUCT=Z.DESIGN_PARAM_TYPES=Z.PARAM_TYPES=Z.TAGGED_PROP=Z.TAGGED=Z.MULTI_INJECT_TAG=Z.INJECT_TAG=Z.OPTIONAL_TAG=Z.UNMANAGED_TAG=Z.NAME_TAG=Z.NAMED_TAG=void 0;Z.NAMED_TAG="named";Z.NAME_TAG="name";Z.UNMANAGED_TAG="unmanaged";Z.OPTIONAL_TAG="optional";Z.INJECT_TAG="inject";Z.MULTI_INJECT_TAG="multi_inject";Z.TAGGED="inversify:tagged";Z.TAGGED_PROP="inversify:tagged_props";Z.PARAM_TYPES="inversify:paramtypes";Z.DESIGN_PARAM_TYPES="design:paramtypes";Z.POST_CONSTRUCT="post_construct";function LI(){return[Z.INJECT_TAG,Z.MULTI_INJECT_TAG,Z.NAME_TAG,Z.UNMANAGED_TAG,Z.NAMED_TAG,Z.OPTIONAL_TAG]}Z.NON_CUSTOM_TAG_KEYS=LI()});var wn=f(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.TargetTypeEnum=gi.BindingTypeEnum=gi.BindingScopeEnum=void 0;var BI={Request:"Request",Singleton:"Singleton",Transient:"Transient"};gi.BindingScopeEnum=BI;var FI={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};gi.BindingTypeEnum=FI;var VI={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};gi.TargetTypeEnum=VI});var mi=f(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.id=void 0;var KI=0;function HI(){return KI++}Ec.id=HI});var ev=f(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.Binding=void 0;var Q_=wn(),zI=mi(),YI=function(){function i(e,t){this.id=zI.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Q_.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return i.prototype.clone=function(){var e=new i(this.serviceIdentifier,this.scope);return e.activated=e.scope===Q_.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},i}();wc.Binding=YI});var pt=f(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.STACK_OVERFLOW=A.CIRCULAR_DEPENDENCY_IN_FACTORY=A.POST_CONSTRUCT_ERROR=A.MULTIPLE_POST_CONSTRUCT_METHODS=A.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=A.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=A.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=A.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=A.ARGUMENTS_LENGTH_MISMATCH=A.INVALID_DECORATOR_OPERATION=A.INVALID_TO_SELF_VALUE=A.INVALID_FUNCTION_BINDING=A.INVALID_MIDDLEWARE_RETURN=A.NO_MORE_SNAPSHOTS_AVAILABLE=A.INVALID_BINDING_TYPE=A.NOT_IMPLEMENTED=A.CIRCULAR_DEPENDENCY=A.UNDEFINED_INJECT_ANNOTATION=A.MISSING_INJECT_ANNOTATION=A.MISSING_INJECTABLE_ANNOTATION=A.NOT_REGISTERED=A.CANNOT_UNBIND=A.AMBIGUOUS_MATCH=A.KEY_NOT_FOUND=A.NULL_ARGUMENT=A.DUPLICATED_METADATA=A.DUPLICATED_INJECTABLE_DECORATOR=void 0;A.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";A.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";A.NULL_ARGUMENT="NULL argument";A.KEY_NOT_FOUND="Key Not Found";A.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";A.CANNOT_UNBIND="Could not unbind serviceIdentifier:";A.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";A.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";A.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var UI=function(i){return"@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};A.UNDEFINED_INJECT_ANNOTATION=UI;A.CIRCULAR_DEPENDENCY="Circular dependency found:";A.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";A.INVALID_BINDING_TYPE="Invalid binding type:";A.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";A.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";A.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";A.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";A.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var kI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"The number of constructor arguments in the derived class "+(i[0]+" must be >= than the number of constructor arguments of its base class.")};A.ARGUMENTS_LENGTH_MISMATCH=kI;A.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";A.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";A.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";A.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";A.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var GI=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"@postConstruct error in class "+i[0]+": "+i[1]};A.POST_CONSTRUCT_ERROR=GI;var $I=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return"It looks like there is a circular dependency "+("in one of the '"+i[0]+"' bindings. Please investigate bindings with")+("service identifier '"+i[1]+"'.")};A.CIRCULAR_DEPENDENCY_IN_FACTORY=$I;A.STACK_OVERFLOW="Maximum call stack size exceeded"});var Nf=f(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.MetadataReader=void 0;var jf=qe(),WI=function(){function i(){}return i.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(jf.PARAM_TYPES,e),n=Reflect.getMetadata(jf.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},i.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(jf.TAGGED_PROP,e)||[];return t},i}();Pc.MetadataReader=WI});var tv=f(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.BindingCount=void 0;var XI={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Ic.BindingCount=XI});var Lf=f(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.isStackOverflowExeption=void 0;var JI=pt();function ZI(i){return i instanceof RangeError||i.message===JI.STACK_OVERFLOW}Rc.isStackOverflowExeption=ZI});var kr=f(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.circularDependencyToException=Ht.listMetadataForTarget=Ht.listRegisteredBindingsForServiceIdentifier=Ht.getServiceIdentifierAsString=Ht.getFunctionName=void 0;var QI=pt();function nv(i){if(typeof i=="function"){var e=i;return e.name}else{if(typeof i=="symbol")return i.toString();var e=i;return e}}Ht.getServiceIdentifierAsString=nv;function eR(i,e,t){var n="",r=t(i,e);return r.length!==0&&(n=`
Registered bindings:`,r.forEach(function(o){var s="Object";o.implementationType!==null&&(s=ov(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Ht.listRegisteredBindingsForServiceIdentifier=eR;function iv(i,e){return i.parentRequest===null?!1:i.parentRequest.serviceIdentifier===e?!0:iv(i.parentRequest,e)}function tR(i){function e(n,r){r===void 0&&(r=[]);var o=nv(n.serviceIdentifier);return r.push(o),n.parentRequest!==null?e(n.parentRequest,r):r}var t=e(i);return t.reverse().join(" --> ")}function rv(i){i.childRequests.forEach(function(e){if(iv(e,e.serviceIdentifier)){var t=tR(e);throw new Error(QI.CIRCULAR_DEPENDENCY+" "+t)}else rv(e)})}Ht.circularDependencyToException=rv;function nR(i,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),r=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),r!==null&&r.forEach(function(o){t+=o.toString()+`
`})," "+i+`
 `+i+" - "+t}else return" "+i}Ht.listMetadataForTarget=nR;function ov(i){if(i.name)return i.name;var e=i.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Ht.getFunctionName=ov});var sv=f(Mc=>{"use strict";Object.defineProperty(Mc,"__esModule",{value:!0});Mc.Context=void 0;var iR=mi(),rR=function(){function i(e){this.id=iR.id(),this.container=e}return i.prototype.addPlan=function(e){this.plan=e},i.prototype.setCurrentRequest=function(e){this.currentRequest=e},i}();Mc.Context=rR});var zt=f(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.Metadata=void 0;var oR=qe(),sR=function(){function i(e,t){this.key=e,this.value=t}return i.prototype.toString=function(){return this.key===oR.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},i}();Tc.Metadata=sR});var av=f(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.Plan=void 0;var aR=function(){function i(e,t){this.parentContext=e,this.rootRequest=t}return i}();Oc.Plan=aR});var $n=f(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.tagProperty=yi.tagParameter=yi.decorate=void 0;var cv=pt(),dv=qe();function cR(i,e,t,n){var r=dv.TAGGED;lv(r,i,e,n,t)}yi.tagParameter=cR;function uR(i,e,t){var n=dv.TAGGED_PROP;lv(n,i.constructor,e,t)}yi.tagProperty=uR;function lv(i,e,t,n,r){var o={},s=typeof r=="number",a=r!==void 0&&s?r.toString():t;if(s&&t!==void 0)throw new Error(cv.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(i,e)&&(o=Reflect.getMetadata(i,e));var c=o[a];if(!Array.isArray(c))c=[];else for(var u=0,d=c;u<d.length;u++){var l=d[u];if(l.key===n.key)throw new Error(cv.DUPLICATED_METADATA+" "+l.key.toString())}c.push(n),o[a]=c,Reflect.defineMetadata(i,o,e)}function uv(i,e){Reflect.decorate(i,e)}function dR(i,e){return function(t,n){e(t,n,i)}}function lR(i,e,t){typeof t=="number"?uv([dR(t,i)],e):typeof t=="string"?Reflect.decorate([i],e,t):uv([i],e)}yi.decorate=lR});var Bf=f(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.inject=Gr.LazyServiceIdentifer=void 0;var fR=pt(),hR=qe(),pR=zt(),fv=$n(),gR=function(){function i(e){this._cb=e}return i.prototype.unwrap=function(){return this._cb()},i}();Gr.LazyServiceIdentifer=gR;function mR(i){return function(e,t,n){if(i===void 0)throw new Error(fR.UNDEFINED_INJECT_ANNOTATION(e.name));var r=new pR.Metadata(hR.INJECT_TAG,i);typeof n=="number"?fv.tagParameter(e,t,n,r):fv.tagProperty(e,t,r)}}Gr.inject=mR});var hv=f(Ac=>{"use strict";Object.defineProperty(Ac,"__esModule",{value:!0});Ac.QueryableString=void 0;var yR=function(){function i(e){this.str=e}return i.prototype.startsWith=function(e){return this.str.indexOf(e)===0},i.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},i.prototype.contains=function(e){return this.str.indexOf(e)!==-1},i.prototype.equals=function(e){return this.str===e},i.prototype.value=function(){return this.str},i}();Ac.QueryableString=yR});var Ff=f(Cc=>{"use strict";Object.defineProperty(Cc,"__esModule",{value:!0});Cc.Target=void 0;var Wn=qe(),_R=mi(),pv=zt(),vR=hv(),bR=function(){function i(e,t,n,r){this.id=_R.id(),this.type=e,this.serviceIdentifier=n,this.name=new vR.QueryableString(t||""),this.metadata=new Array;var o=null;typeof r=="string"?o=new pv.Metadata(Wn.NAMED_TAG,r):r instanceof pv.Metadata&&(o=r),o!==null&&this.metadata.push(o)}return i.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var r=n[t];if(r.key===e)return!0}return!1},i.prototype.isArray=function(){return this.hasTag(Wn.MULTI_INJECT_TAG)},i.prototype.matchesArray=function(e){return this.matchesTag(Wn.MULTI_INJECT_TAG)(e)},i.prototype.isNamed=function(){return this.hasTag(Wn.NAMED_TAG)},i.prototype.isTagged=function(){return this.metadata.some(function(e){return Wn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},i.prototype.isOptional=function(){return this.matchesTag(Wn.OPTIONAL_TAG)(!0)},i.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Wn.NAMED_TAG})[0]:null},i.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Wn.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},i.prototype.matchesNamedTag=function(e){return this.matchesTag(Wn.NAMED_TAG)(e)},i.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,o=t.metadata;r<o.length;r++){var s=o[r];if(s.key===e&&s.value===n)return!0}return!1}},i}();Cc.Target=bR});var Ev=f(Pn=>{"use strict";var xc=Pn&&Pn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Pn,"__esModule",{value:!0});Pn.getFunctionName=Pn.getBaseClassDependencyCount=Pn.getDependencies=void 0;var SR=Bf(),gv=pt(),mv=wn(),Bs=qe(),Vf=kr();Object.defineProperty(Pn,"getFunctionName",{enumerable:!0,get:function(){return Vf.getFunctionName}});var yv=Ff();function ER(i,e){var t=Vf.getFunctionName(e),n=_v(i,t,e,!1);return n}Pn.getDependencies=ER;function _v(i,e,t,n){var r=i.getConstructorMetadata(t),o=r.compilerGeneratedMetadata;if(o===void 0){var s=gv.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=r.userGeneratedMetadata,c=Object.keys(a),u=t.length===0&&c.length>0,d=c.length>t.length,l=u||d?c.length:t.length,S=PR(n,e,o,a,l),R=vv(i,t),v=xc(xc([],S),R);return v}function wR(i,e,t,n,r){var o=r[i.toString()]||[],s=Sv(o),a=s.unmanaged!==!0,c=n[i],u=s.inject||s.multiInject;if(c=u||c,c instanceof SR.LazyServiceIdentifer&&(c=c.unwrap()),a){var d=c===Object,l=c===Function,S=c===void 0,R=d||l||S;if(!e&&R){var v=gv.MISSING_INJECT_ANNOTATION+" argument "+i+" in class "+t+".";throw new Error(v)}var m=new yv.Target(mv.TargetTypeEnum.ConstructorArgument,s.targetName,c);return m.metadata=o,m}return null}function PR(i,e,t,n,r){for(var o=[],s=0;s<r;s++){var a=s,c=wR(a,i,e,t,n);c!==null&&o.push(c)}return o}function vv(i,e){for(var t=i.getPropertiesMetadata(e),n=[],r=Object.keys(t),o=0,s=r;o<s.length;o++){var a=s[o],c=t[a],u=Sv(t[a]),d=u.targetName||a,l=u.inject||u.multiInject,S=new yv.Target(mv.TargetTypeEnum.ClassProperty,d,l);S.metadata=c,n.push(S)}var R=Object.getPrototypeOf(e.prototype).constructor;if(R!==Object){var v=vv(i,R);n=xc(xc([],n),v)}return n}function bv(i,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=Vf.getFunctionName(t),r=_v(i,n,t,!0),o=r.map(function(c){return c.metadata.filter(function(u){return u.key===Bs.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=r.length-s;return a>0?a:bv(i,t)}else return 0}Pn.getBaseClassDependencyCount=bv;function Sv(i){var e={};return i.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[Bs.INJECT_TAG],multiInject:e[Bs.MULTI_INJECT_TAG],targetName:e[Bs.NAME_TAG],unmanaged:e[Bs.UNMANAGED_TAG]}}});var wv=f(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});qc.Request=void 0;var IR=mi(),RR=function(){function i(e,t,n,r,o){this.id=IR.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=n===null?new Map:null}return i.prototype.addChildRequest=function(e,t,n){var r=new i(e,this.parentContext,this,t,n);return this.childRequests.push(r),r},i}();qc.Request=RR});var Cv=f(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.getBindingDictionary=_i.createMockRequest=_i.plan=void 0;var Dc=tv(),Hf=pt(),Rv=wn(),Pv=qe(),MR=Lf(),$r=kr(),Mv=sv(),zf=zt(),TR=av(),Kf=Ev(),Yf=wv(),Tv=Ff();function Ov(i){return i._bindingDictionary}_i.getBindingDictionary=Ov;function OR(i,e,t,n,r,o){var s=i?Pv.MULTI_INJECT_TAG:Pv.INJECT_TAG,a=new zf.Metadata(s,t),c=new Tv.Target(e,n,t,a);if(r!==void 0){var u=new zf.Metadata(r,o);c.metadata.push(u)}return c}function Iv(i,e,t,n,r){var o=Fs(t.container,r.serviceIdentifier),s=[];return o.length===Dc.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof r.serviceIdentifier=="function"&&i.getConstructorMetadata(r.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(r.serviceIdentifier).toSelf(),o=Fs(t.container,r.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new Yf.Request(a.serviceIdentifier,t,n,a,r);return a.constraint(c)}),AR(r.serviceIdentifier,s,r,t.container),s}function AR(i,e,t,n){switch(e.length){case Dc.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var r=$r.getServiceIdentifierAsString(i),o=Hf.NOT_REGISTERED;throw o+=$r.listMetadataForTarget(r,t),o+=$r.listRegisteredBindingsForServiceIdentifier(n,r,Fs),new Error(o);case Dc.BindingCount.OnlyOneBindingAvailable:if(!t.isArray())return e;case Dc.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var r=$r.getServiceIdentifierAsString(i),o=Hf.AMBIGUOUS_MATCH+" "+r;throw o+=$r.listRegisteredBindingsForServiceIdentifier(n,r,Fs),new Error(o)}}function Av(i,e,t,n,r,o){var s,a;if(r===null){s=Iv(i,e,n,null,o),a=new Yf.Request(t,n,null,s,o);var c=new TR.Plan(n,a);n.addPlan(c)}else s=Iv(i,e,n,r,o),a=r.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(u){var d=null;if(o.isArray())d=a.addChildRequest(u.serviceIdentifier,u,o);else{if(u.cache)return;d=a}if(u.type===Rv.BindingTypeEnum.Instance&&u.implementationType!==null){var l=Kf.getDependencies(i,u.implementationType);if(!n.container.options.skipBaseClassChecks){var S=Kf.getBaseClassDependencyCount(i,u.implementationType);if(l.length<S){var R=Hf.ARGUMENTS_LENGTH_MISMATCH(Kf.getFunctionName(u.implementationType));throw new Error(R)}}l.forEach(function(v){Av(i,!1,v.serviceIdentifier,n,d,v)})}})}function Fs(i,e){var t=[],n=Ov(i);return n.hasKey(e)?t=n.get(e):i.parent!==null&&(t=Fs(i.parent,e)),t}function CR(i,e,t,n,r,o,s,a){a===void 0&&(a=!1);var c=new Mv.Context(e),u=OR(t,n,r,"",o,s);try{return Av(i,a,r,c,null,u),c}catch(d){throw MR.isStackOverflowExeption(d)&&c.plan&&$r.circularDependencyToException(c.plan.rootRequest),d}}_i.plan=CR;function xR(i,e,t,n){var r=new Tv.Target(Rv.TargetTypeEnum.Variable,"",e,new zf.Metadata(t,n)),o=new Mv.Context(i),s=new Yf.Request(e,o,null,[],r);return s}_i.createMockRequest=xR});var Dv=f(Wr=>{"use strict";var qR=Wr&&Wr.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.resolveInstance=void 0;var DR=pt(),qv=wn(),xv=qe();function jR(i,e,t){var n=e.filter(function(o){return o.target!==null&&o.target.type===qv.TargetTypeEnum.ClassProperty}),r=n.map(t);return n.forEach(function(o,s){var a="";a=o.target.name.value();var c=r[s];i[a]=c}),i}function NR(i,e){return new(i.bind.apply(i,qR([void 0],e)))}function LR(i,e){if(Reflect.hasMetadata(xv.POST_CONSTRUCT,i)){var t=Reflect.getMetadata(xv.POST_CONSTRUCT,i);try{e[t.value]()}catch(n){throw new Error(DR.POST_CONSTRUCT_ERROR(i.name,n.message))}}}function BR(i,e,t){var n=null;if(e.length>0){var r=e.filter(function(s){return s.target!==null&&s.target.type===qv.TargetTypeEnum.ConstructorArgument}),o=r.map(t);n=NR(i,o),n=jR(n,e,t)}else n=new i;return LR(i,n),n}Wr.resolveInstance=BR});var Nv=f(jc=>{"use strict";Object.defineProperty(jc,"__esModule",{value:!0});jc.resolve=void 0;var jv=pt(),Xn=wn(),FR=Lf(),VR=kr(),KR=Dv(),Uf=function(i,e,t){try{return t()}catch(n){throw FR.isStackOverflowExeption(n)?new Error(jv.CIRCULAR_DEPENDENCY_IN_FACTORY(i,e.toString())):n}},kf=function(i){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,r=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(r&&o)return n.map(function(l){var S=kf(i);return S(l)});var s=null;if(e.target.isOptional()&&t.length===0)return;var a=t[0],c=a.scope===Xn.BindingScopeEnum.Singleton,u=a.scope===Xn.BindingScopeEnum.Request;if(c&&a.activated)return a.cache;if(u&&i!==null&&i.has(a.id))return i.get(a.id);if(a.type===Xn.BindingTypeEnum.ConstantValue)s=a.cache,a.activated=!0;else if(a.type===Xn.BindingTypeEnum.Function)s=a.cache,a.activated=!0;else if(a.type===Xn.BindingTypeEnum.Constructor)s=a.implementationType;else if(a.type===Xn.BindingTypeEnum.DynamicValue&&a.dynamicValue!==null)s=Uf("toDynamicValue",a.serviceIdentifier,function(){return a.dynamicValue(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Factory&&a.factory!==null)s=Uf("toFactory",a.serviceIdentifier,function(){return a.factory(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Provider&&a.provider!==null)s=Uf("toProvider",a.serviceIdentifier,function(){return a.provider(e.parentContext)});else if(a.type===Xn.BindingTypeEnum.Instance&&a.implementationType!==null)s=KR.resolveInstance(a.implementationType,n,kf(i));else{var d=VR.getServiceIdentifierAsString(e.serviceIdentifier);throw new Error(jv.INVALID_BINDING_TYPE+" "+d)}return typeof a.onActivation=="function"&&(s=a.onActivation(e.parentContext,s)),c&&(a.cache=s,a.activated=!0),u&&i!==null&&!i.has(a.id)&&i.set(a.id,s),s}};function HR(i){var e=kf(i.plan.rootRequest.requestScope);return e(i.plan.rootRequest)}jc.resolve=HR});var Gf=f(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.typeConstraint=In.namedConstraint=In.taggedConstraint=In.traverseAncerstors=void 0;var zR=qe(),YR=zt(),Lv=function(i,e){var t=i.parentRequest;return t!==null?e(t)?!0:Lv(t,e):!1};In.traverseAncerstors=Lv;var Bv=function(i){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(i)(e)};return t.metaData=new YR.Metadata(i,e),t}};In.taggedConstraint=Bv;var UR=Bv(zR.NAMED_TAG);In.namedConstraint=UR;var kR=function(i){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof i=="string"){var n=t.serviceIdentifier;return n===i}else{var r=e.bindings[0].implementationType;return i===r}return!1}};In.typeConstraint=kR});var Lc=f(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.BindingWhenSyntax=void 0;var st=Bc(),De=Gf(),GR=function(){function i(e){this._binding=e}return i.prototype.when=function(e){return this._binding.constraint=e,new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetNamed=function(e){return this._binding.constraint=De.namedConstraint(e),new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new st.BindingOnSyntax(this._binding)},i.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=De.taggedConstraint(e)(t),new st.BindingOnSyntax(this._binding)},i.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return De.typeConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return De.namedConstraint(e)(t.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return De.taggedConstraint(e)(t)(n.parentRequest)},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.typeConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,De.namedConstraint(e))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!De.traverseAncerstors(n,De.taggedConstraint(e)(t))},new st.BindingOnSyntax(this._binding)},i.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!De.traverseAncerstors(t,e)},new st.BindingOnSyntax(this._binding)},i}();Nc.BindingWhenSyntax=GR});var Bc=f(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.BindingOnSyntax=void 0;var $R=Lc(),WR=function(){function i(e){this._binding=e}return i.prototype.onActivation=function(e){return this._binding.onActivation=e,new $R.BindingWhenSyntax(this._binding)},i}();Fc.BindingOnSyntax=WR});var $f=f(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.BindingWhenOnSyntax=void 0;var XR=Bc(),JR=Lc(),ZR=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new JR.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new XR.BindingOnSyntax(this._binding)}return i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Vc.BindingWhenOnSyntax=ZR});var Fv=f(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.BindingInSyntax=void 0;var Wf=wn(),Xf=$f(),QR=function(){function i(e){this._binding=e}return i.prototype.inRequestScope=function(){return this._binding.scope=Wf.BindingScopeEnum.Request,new Xf.BindingWhenOnSyntax(this._binding)},i.prototype.inSingletonScope=function(){return this._binding.scope=Wf.BindingScopeEnum.Singleton,new Xf.BindingWhenOnSyntax(this._binding)},i.prototype.inTransientScope=function(){return this._binding.scope=Wf.BindingScopeEnum.Transient,new Xf.BindingWhenOnSyntax(this._binding)},i}();Kc.BindingInSyntax=QR});var Vv=f(Hc=>{"use strict";Object.defineProperty(Hc,"__esModule",{value:!0});Hc.BindingInWhenOnSyntax=void 0;var eM=Fv(),tM=Bc(),nM=Lc(),iM=function(){function i(e){this._binding=e,this._bindingWhenSyntax=new nM.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new tM.BindingOnSyntax(this._binding),this._bindingInSyntax=new eM.BindingInSyntax(e)}return i.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},i.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},i.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},i.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},i.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},i.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},i.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},i.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},i.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},i.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},i.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},i.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},i.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},i.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},i.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},i.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},i.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},i.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},i.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},i}();Hc.BindingInWhenOnSyntax=iM});var zv=f(zc=>{"use strict";Object.defineProperty(zc,"__esModule",{value:!0});zc.BindingToSyntax=void 0;var Kv=pt(),gt=wn(),Hv=Vv(),Vs=$f(),rM=function(){function i(e){this._binding=e}return i.prototype.to=function(e){return this._binding.type=gt.BindingTypeEnum.Instance,this._binding.implementationType=e,new Hv.BindingInWhenOnSyntax(this._binding)},i.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Kv.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},i.prototype.toConstantValue=function(e){return this._binding.type=gt.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=gt.BindingScopeEnum.Singleton,new Vs.BindingWhenOnSyntax(this._binding)},i.prototype.toDynamicValue=function(e){return this._binding.type=gt.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Hv.BindingInWhenOnSyntax(this._binding)},i.prototype.toConstructor=function(e){return this._binding.type=gt.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=gt.BindingScopeEnum.Singleton,new Vs.BindingWhenOnSyntax(this._binding)},i.prototype.toFactory=function(e){return this._binding.type=gt.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=gt.BindingScopeEnum.Singleton,new Vs.BindingWhenOnSyntax(this._binding)},i.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(Kv.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=gt.BindingTypeEnum.Function,this._binding.scope=gt.BindingScopeEnum.Singleton,t},i.prototype.toAutoFactory=function(e){return this._binding.type=gt.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=gt.BindingScopeEnum.Singleton,new Vs.BindingWhenOnSyntax(this._binding)},i.prototype.toProvider=function(e){return this._binding.type=gt.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=gt.BindingScopeEnum.Singleton,new Vs.BindingWhenOnSyntax(this._binding)},i.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},i}();zc.BindingToSyntax=rM});var Yv=f(Yc=>{"use strict";Object.defineProperty(Yc,"__esModule",{value:!0});Yc.ContainerSnapshot=void 0;var oM=function(){function i(){}return i.of=function(e,t){var n=new i;return n.bindings=e,n.middleware=t,n},i}();Yc.ContainerSnapshot=oM});var Uv=f(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.Lookup=void 0;var ir=pt(),sM=function(){function i(){this._map=new Map}return i.prototype.getMap=function(){return this._map},i.prototype.add=function(e,t){if(e==null)throw new Error(ir.NULL_ARGUMENT);if(t==null)throw new Error(ir.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},i.prototype.get=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(ir.KEY_NOT_FOUND)},i.prototype.remove=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(ir.KEY_NOT_FOUND)},i.prototype.removeByCondition=function(e){var t=this;this._map.forEach(function(n,r){var o=n.filter(function(s){return!e(s)});o.length>0?t._map.set(r,o):t._map.delete(r)})},i.prototype.hasKey=function(e){if(e==null)throw new Error(ir.NULL_ARGUMENT);return this._map.has(e)},i.prototype.clone=function(){var e=new i;return this._map.forEach(function(t,n){t.forEach(function(r){return e.add(n,r.clone())})}),e},i.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},i}();Uc.Lookup=sM});var Gv=f(Rn=>{"use strict";var aM=Rn&&Rn.__awaiter||function(i,e,t,n){function r(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(d){try{u(n.next(d))}catch(l){s(l)}}function c(d){try{u(n.throw(d))}catch(l){s(l)}}function u(d){d.done?o(d.value):r(d.value).then(a,c)}u((n=n.apply(i,e||[])).next())})},cM=Rn&&Rn.__generator||function(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(u){return function(d){return c([u,d])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=u[0]&2?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,r=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(i,t)}catch(d){u=[6,d],r=0}finally{n=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},uM=Rn&&Rn.__spreadArray||function(i,e){for(var t=0,n=e.length,r=i.length;t<n;t++,r++)i[r]=e[t];return i};Object.defineProperty(Rn,"__esModule",{value:!0});Rn.Container=void 0;var dM=ev(),rr=pt(),Jn=wn(),Jf=qe(),lM=Nf(),kc=Cv(),fM=Nv(),hM=zv(),pM=mi(),gM=kr(),mM=Yv(),kv=Uv(),yM=function(){function i(e){this._appliedMiddleware=[];var t=e||{};if(typeof t!="object")throw new Error(""+rr.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Jn.BindingScopeEnum.Transient;else if(t.defaultScope!==Jn.BindingScopeEnum.Singleton&&t.defaultScope!==Jn.BindingScopeEnum.Transient&&t.defaultScope!==Jn.BindingScopeEnum.Request)throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+rr.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=pM.id(),this._bindingDictionary=new kv.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new lM.MetadataReader}return i.merge=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i,s=uM([e,t],n).map(function(u){return kc.getBindingDictionary(u)}),a=kc.getBindingDictionary(o);function c(u,d){u.traverse(function(l,S){S.forEach(function(R){d.add(R.serviceIdentifier,R.clone())})})}return s.forEach(function(u){c(u,a)}),o},i.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,o=e;r<o.length;r++){var s=o[r],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},i.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return aM(this,void 0,void 0,function(){var n,r,o,s,a;return cM(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),r=0,o=e,c.label=1;case 1:return r<o.length?(s=o[r],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(o){return function(s){return s.moduleId===o}};t.forEach(function(o){var s=r(o.id);e._bindingDictionary.removeByCondition(s)})},i.prototype.bind=function(e){var t=this.options.defaultScope||Jn.BindingScopeEnum.Transient,n=new dM.Binding(e,t);return this._bindingDictionary.add(e,n),new hM.BindingToSyntax(n)},i.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},i.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(rr.CANNOT_UNBIND+" "+gM.getServiceIdentifierAsString(e))}},i.prototype.unbindAll=function(){this._bindingDictionary=new kv.Lookup},i.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},i.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Jf.NAMED_TAG,t)},i.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=kc.createMockRequest(this,e,t,n);r=o.some(function(a){return a.constraint(s)})}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},i.prototype.snapshot=function(){this._snapshots.push(mM.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},i.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(rr.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},i.prototype.createChild=function(e){var t=new i(e||this.options);return t.parent=this,t},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(r,o){return o(r)},n)},i.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},i.prototype.get=function(e){return this._get(!1,!1,Jn.TargetTypeEnum.Variable,e)},i.prototype.getTagged=function(e,t,n){return this._get(!1,!1,Jn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getNamed=function(e,t){return this.getTagged(e,Jf.NAMED_TAG,t)},i.prototype.getAll=function(e){return this._get(!0,!0,Jn.TargetTypeEnum.Variable,e)},i.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,Jn.TargetTypeEnum.Variable,e,t,n)},i.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Jf.NAMED_TAG,t)},i.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(e)},i.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(a,c){a._binding.moduleId=c},n=function(a){return function(c){var u=e.bind.bind(e),d=u(c);return t(d,a),d}},r=function(a){return function(c){var u=e.unbind.bind(e);u(c)}},o=function(a){return function(c){var u=e.isBound.bind(e);return u(c)}},s=function(a){return function(c){var u=e.rebind.bind(e),d=u(c);return t(d,a),d}};return function(a){return{bindFunction:n(a),isboundFunction:o(a),rebindFunction:s(a),unbindFunction:r(a)}}},i.prototype._get=function(e,t,n,r,o,s){var a=null,c={avoidConstraints:e,contextInterceptor:function(u){return u},isMultiInject:t,key:o,serviceIdentifier:r,targetType:n,value:s};if(this._middleware){if(a=this._middleware(c),a==null)throw new Error(rr.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(c);return a},i.prototype._planAndResolve=function(){var e=this;return function(t){var n=kc.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var r=fM.resolve(n);return r}},i}();Rn.Container=yM});var Wv=f(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.AsyncContainerModule=Xr.ContainerModule=void 0;var $v=mi(),_M=function(){function i(e){this.id=$v.id(),this.registry=e}return i}();Xr.ContainerModule=_M;var vM=function(){function i(e){this.id=$v.id(),this.registry=e}return i}();Xr.AsyncContainerModule=vM});var Xv=f(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.injectable=void 0;var bM=pt(),Zf=qe();function SM(){return function(i){if(Reflect.hasOwnMetadata(Zf.PARAM_TYPES,i))throw new Error(bM.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(Zf.DESIGN_PARAM_TYPES,i)||[];return Reflect.defineMetadata(Zf.PARAM_TYPES,e,i),i}}Gc.injectable=SM});var Zv=f($c=>{"use strict";Object.defineProperty($c,"__esModule",{value:!0});$c.tagged=void 0;var EM=zt(),Jv=$n();function wM(i,e){return function(t,n,r){var o=new EM.Metadata(i,e);typeof r=="number"?Jv.tagParameter(t,n,r,o):Jv.tagProperty(t,n,o)}}$c.tagged=wM});var eb=f(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});Wc.named=void 0;var PM=qe(),IM=zt(),Qv=$n();function RM(i){return function(e,t,n){var r=new IM.Metadata(PM.NAMED_TAG,i);typeof n=="number"?Qv.tagParameter(e,t,n,r):Qv.tagProperty(e,t,r)}}Wc.named=RM});var nb=f(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.optional=void 0;var MM=qe(),TM=zt(),tb=$n();function OM(){return function(i,e,t){var n=new TM.Metadata(MM.OPTIONAL_TAG,!0);typeof t=="number"?tb.tagParameter(i,e,t,n):tb.tagProperty(i,e,n)}}Xc.optional=OM});var ib=f(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.unmanaged=void 0;var AM=qe(),CM=zt(),xM=$n();function qM(){return function(i,e,t){var n=new CM.Metadata(AM.UNMANAGED_TAG,!0);xM.tagParameter(i,e,t,n)}}Jc.unmanaged=qM});var ob=f(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.multiInject=void 0;var DM=qe(),jM=zt(),rb=$n();function NM(i){return function(e,t,n){var r=new jM.Metadata(DM.MULTI_INJECT_TAG,i);typeof n=="number"?rb.tagParameter(e,t,n,r):rb.tagProperty(e,t,r)}}Zc.multiInject=NM});var sb=f(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.targetName=void 0;var LM=qe(),BM=zt(),FM=$n();function VM(i){return function(e,t,n){var r=new BM.Metadata(LM.NAME_TAG,i);FM.tagParameter(e,t,n,r)}}Qc.targetName=VM});var ab=f(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.postConstruct=void 0;var KM=pt(),Qf=qe(),HM=zt();function zM(){return function(i,e,t){var n=new HM.Metadata(Qf.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(Qf.POST_CONSTRUCT,i.constructor))throw new Error(KM.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Qf.POST_CONSTRUCT,n,i.constructor)}}eu.postConstruct=zM});var cb=f(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.multiBindToService=void 0;var YM=function(i){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(r){return i.bind(r).toService(e)})}}};tu.multiBindToService=YM});var _=f(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.multiBindToService=q.getServiceIdentifierAsString=q.typeConstraint=q.namedConstraint=q.taggedConstraint=q.traverseAncerstors=q.decorate=q.id=q.MetadataReader=q.postConstruct=q.targetName=q.multiInject=q.unmanaged=q.optional=q.LazyServiceIdentifer=q.inject=q.named=q.tagged=q.injectable=q.ContainerModule=q.AsyncContainerModule=q.TargetTypeEnum=q.BindingTypeEnum=q.BindingScopeEnum=q.Container=q.METADATA_KEY=void 0;var UM=qe();q.METADATA_KEY=UM;var kM=Gv();Object.defineProperty(q,"Container",{enumerable:!0,get:function(){return kM.Container}});var eh=wn();Object.defineProperty(q,"BindingScopeEnum",{enumerable:!0,get:function(){return eh.BindingScopeEnum}});Object.defineProperty(q,"BindingTypeEnum",{enumerable:!0,get:function(){return eh.BindingTypeEnum}});Object.defineProperty(q,"TargetTypeEnum",{enumerable:!0,get:function(){return eh.TargetTypeEnum}});var ub=Wv();Object.defineProperty(q,"AsyncContainerModule",{enumerable:!0,get:function(){return ub.AsyncContainerModule}});Object.defineProperty(q,"ContainerModule",{enumerable:!0,get:function(){return ub.ContainerModule}});var GM=Xv();Object.defineProperty(q,"injectable",{enumerable:!0,get:function(){return GM.injectable}});var $M=Zv();Object.defineProperty(q,"tagged",{enumerable:!0,get:function(){return $M.tagged}});var WM=eb();Object.defineProperty(q,"named",{enumerable:!0,get:function(){return WM.named}});var db=Bf();Object.defineProperty(q,"inject",{enumerable:!0,get:function(){return db.inject}});Object.defineProperty(q,"LazyServiceIdentifer",{enumerable:!0,get:function(){return db.LazyServiceIdentifer}});var XM=nb();Object.defineProperty(q,"optional",{enumerable:!0,get:function(){return XM.optional}});var JM=ib();Object.defineProperty(q,"unmanaged",{enumerable:!0,get:function(){return JM.unmanaged}});var ZM=ob();Object.defineProperty(q,"multiInject",{enumerable:!0,get:function(){return ZM.multiInject}});var QM=sb();Object.defineProperty(q,"targetName",{enumerable:!0,get:function(){return QM.targetName}});var eT=ab();Object.defineProperty(q,"postConstruct",{enumerable:!0,get:function(){return eT.postConstruct}});var tT=Nf();Object.defineProperty(q,"MetadataReader",{enumerable:!0,get:function(){return tT.MetadataReader}});var nT=mi();Object.defineProperty(q,"id",{enumerable:!0,get:function(){return nT.id}});var iT=$n();Object.defineProperty(q,"decorate",{enumerable:!0,get:function(){return iT.decorate}});var nu=Gf();Object.defineProperty(q,"traverseAncerstors",{enumerable:!0,get:function(){return nu.traverseAncerstors}});Object.defineProperty(q,"taggedConstraint",{enumerable:!0,get:function(){return nu.taggedConstraint}});Object.defineProperty(q,"namedConstraint",{enumerable:!0,get:function(){return nu.namedConstraint}});Object.defineProperty(q,"typeConstraint",{enumerable:!0,get:function(){return nu.typeConstraint}});var rT=kr();Object.defineProperty(q,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return rT.getServiceIdentifierAsString}});var oT=cb();Object.defineProperty(q,"multiBindToService",{enumerable:!0,get:function(){return oT.multiBindToService}})});var ru=f(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.Deferred=void 0;var th=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};iu.Deferred=th});var P=f(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.TYPES=void 0;ou.TYPES={Action:Symbol("Action"),IActionDispatcher:Symbol("IActionDispatcher"),IActionDispatcherProvider:Symbol("IActionDispatcherProvider"),IActionHandlerInitializer:Symbol("IActionHandlerInitializer"),ActionHandlerRegistration:Symbol("ActionHandlerRegistration"),ActionHandlerRegistryProvider:Symbol("ActionHandlerRegistryProvider"),IAnchorComputer:Symbol("IAnchor"),AnimationFrameSyncer:Symbol("AnimationFrameSyncer"),IButtonHandler:Symbol("IButtonHandler"),IButtonHandlerRegistration:Symbol("IButtonHandlerRegistration"),ICommandPaletteActionProvider:Symbol("ICommandPaletteActionProvider"),ICommandPaletteActionProviderRegistry:Symbol("ICommandPaletteActionProviderRegistry"),CommandRegistration:Symbol("CommandRegistration"),ICommandStack:Symbol("ICommandStack"),CommandStackOptions:Symbol("CommandStackOptions"),ICommandStackProvider:Symbol("ICommandStackProvider"),IContextMenuItemProvider:Symbol.for("IContextMenuProvider"),IContextMenuProviderRegistry:Symbol.for("IContextMenuProviderRegistry"),IContextMenuService:Symbol.for("IContextMenuService"),IContextMenuServiceProvider:Symbol.for("IContextMenuServiceProvider"),DOMHelper:Symbol("DOMHelper"),IDiagramLocker:Symbol("IDiagramLocker"),IEdgeRouter:Symbol("IEdgeRouter"),IEdgeRoutePostprocessor:Symbol("IEdgeRoutePostprocessor"),IEditLabelValidationDecorator:Symbol("IEditLabelValidationDecorator"),IEditLabelValidator:Symbol("IEditLabelValidator"),HiddenModelViewer:Symbol("HiddenModelViewer"),HiddenVNodePostprocessor:Symbol("HiddenVNodeDecorator"),HoverState:Symbol("HoverState"),KeyListener:Symbol("KeyListener"),LayoutRegistration:Symbol("LayoutRegistration"),LayoutRegistry:Symbol("LayoutRegistry"),Layouter:Symbol("Layouter"),LogLevel:Symbol("LogLevel"),ILogger:Symbol("ILogger"),IModelFactory:Symbol("IModelFactory"),IModelLayoutEngine:Symbol("IModelLayoutEngine"),ModelRendererFactory:Symbol("ModelRendererFactory"),ModelSource:Symbol("ModelSource"),ModelSourceProvider:Symbol("ModelSourceProvider"),ModelViewer:Symbol("ModelViewer"),MouseListener:Symbol("MouseListener"),PatcherProvider:Symbol("PatcherProvider"),IPopupModelProvider:Symbol("IPopupModelProvider"),PopupModelViewer:Symbol("PopupModelViewer"),PopupMouseListener:Symbol("PopupMouseListener"),PopupVNodePostprocessor:Symbol("PopupVNodeDecorator"),SModelElementRegistration:Symbol("SModelElementRegistration"),SModelRegistry:Symbol("SModelRegistry"),ISnapper:Symbol("ISnapper"),SvgExporter:Symbol("SvgExporter"),IToolManager:Symbol("IToolManager"),IUIExtension:Symbol("IUIExtension"),UIExtensionRegistry:Symbol("UIExtensionRegistry"),IVNodePostprocessor:Symbol("IVNodePostprocessor"),ViewRegistration:Symbol("ViewRegistration"),ViewRegistry:Symbol("ViewRegistry"),IViewer:Symbol("IViewer"),ViewerOptions:Symbol("ViewerOptions"),IViewerProvider:Symbol("IViewerProvider")}});var Mn=f(Yt=>{"use strict";var su=Yt&&Yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.MultiInstanceRegistry=Yt.InstanceRegistry=Yt.FactoryRegistry=Yt.ProviderRegistry=void 0;var au=_(),nh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?new n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};nh=su([(0,au.injectable)()],nh);Yt.ProviderRegistry=nh;var ih=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e,t){let n=this.elements.get(e);return n?n(t):this.missing(e,t)}missing(e,t){throw new Error("Unknown registry key: "+e)}};ih=su([(0,au.injectable)()],ih);Yt.FactoryRegistry=ih;var rh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");if(this.hasKey(e))throw new Error("Key is already registered: "+e);this.elements.set(e,t)}deregister(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}hasKey(e){return this.elements.has(e)}get(e){let t=this.elements.get(e);return t||this.missing(e)}missing(e){throw new Error("Unknown registry key: "+e)}};rh=su([(0,au.injectable)()],rh);Yt.InstanceRegistry=rh;var oh=class{constructor(){this.elements=new Map}register(e,t){if(e===void 0)throw new Error("Key is undefined");let n=this.elements.get(e);n!==void 0?n.push(t):this.elements.set(e,[t])}deregisterAll(e){if(e===void 0)throw new Error("Key is undefined");this.elements.delete(e)}get(e){let t=this.elements.get(e);return t!==void 0?t:[]}};oh=su([(0,au.injectable)()],oh);Yt.MultiInstanceRegistry=oh});var ee=f(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.almostEquals=fe.toRadians=fe.toDegrees=fe.Bounds=fe.isBounds=fe.Dimension=fe.centerOfLine=fe.angleBetweenPoints=fe.angleOfPoint=fe.Point=void 0;var sT=En(),aT;(function(i){i.ORIGIN=Object.freeze({x:0,y:0});function e(l,S){return{x:l.x+S.x,y:l.y+S.y}}i.add=e;function t(l,S){return{x:l.x-S.x,y:l.y-S.y}}i.subtract=t;function n(l,S){return l.x===S.x&&l.y===S.y}i.equals=n;function r(l,S,R){let v=t(S,l),m=o(v),T={x:m.x*R,y:m.y*R};return e(l,T)}i.shiftTowards=r;function o(l){let S=s(l);return S===0||S===1?i.ORIGIN:{x:l.x/S,y:l.y/S}}i.normalize=o;function s(l){return Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2))}i.magnitude=s;function a(l,S,R){return{x:(1-R)*l.x+R*S.x,y:(1-R)*l.y+R*S.y}}i.linear=a;function c(l,S){let R=S.x-l.x,v=S.y-l.y;return Math.sqrt(R*R+v*v)}i.euclideanDistance=c;function u(l,S){return Math.abs(S.x-l.x)+Math.abs(S.y-l.y)}i.manhattanDistance=u;function d(l,S){return Math.max(Math.abs(S.x-l.x),Math.abs(S.y-l.y))}i.maxDistance=d})(aT=fe.Point||(fe.Point={}));function cT(i){return Math.atan2(i.y,i.x)}fe.angleOfPoint=cT;function uT(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}fe.angleBetweenPoints=uT;function dT(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return lb.center(t)}fe.centerOfLine=dT;var cu;(function(i){i.EMPTY=Object.freeze({width:-1,height:-1});function e(t){return t.width>=0&&t.height>=0}i.isValid=e})(cu=fe.Dimension||(fe.Dimension={}));function lT(i){return(0,sT.hasOwnProperty)(i,["x","y","width","height"])}fe.isBounds=lT;var lb;(function(i){i.EMPTY=Object.freeze({x:0,y:0,width:-1,height:-1});function e(o,s){if(!cu.isValid(o))return cu.isValid(s)?s:i.EMPTY;if(!cu.isValid(s))return o;let a=Math.min(o.x,s.x),c=Math.min(o.y,s.y),u=Math.max(o.x+(o.width>=0?o.width:0),s.x+(s.width>=0?s.width:0)),d=Math.max(o.y+(o.height>=0?o.height:0),s.y+(s.height>=0?s.height:0));return{x:a,y:c,width:u-a,height:d-c}}i.combine=e;function t(o,s){return{x:o.x+s.x,y:o.y+s.y,width:o.width,height:o.height}}i.translate=t;function n(o){return{x:o.x+(o.width>=0?.5*o.width:0),y:o.y+(o.height>=0?.5*o.height:0)}}i.center=n;function r(o,s){return s.x>=o.x&&s.x<=o.x+o.width&&s.y>=o.y&&s.y<=o.y+o.height}i.includes=r})(lb=fe.Bounds||(fe.Bounds={}));function fT(i){return i*180/Math.PI}fe.toDegrees=fT;function hT(i){return i*Math.PI/180}fe.toRadians=hT;function pT(i,e){return Math.abs(i-e)<.001}fe.almostEquals=pT});var or=f(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.mapIterable=at.filterIterable=at.DONE_RESULT=at.toArray=at.FluentIterableImpl=void 0;var Ks=class{constructor(e,t){this.startFn=e,this.nextFn=t}[Symbol.iterator](){let e={state:this.startFn(),next:()=>this.nextFn(e.state),[Symbol.iterator]:()=>e};return e}filter(e){return fb(this,e)}map(e){return hb(this,e)}forEach(e){let t=this[Symbol.iterator](),n=0,r;do r=t.next(),r.value!==void 0&&e(r.value,n),n++;while(!r.done)}indexOf(e){let t=this[Symbol.iterator](),n=0,r;do{if(r=t.next(),r.value===e)return n;n++}while(!r.done);return-1}};at.FluentIterableImpl=Ks;function gT(i){if(i.constructor===Array)return i;let e=[];return i.forEach(t=>e.push(t)),e}at.toArray=gT;at.DONE_RESULT=Object.freeze({done:!0,value:void 0});function fb(i,e){return new Ks(()=>pb(i),t=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n})}at.filterIterable=fb;function hb(i,e){return new Ks(()=>pb(i),t=>{let{done:n,value:r}=t.next();return n?at.DONE_RESULT:{done:!1,value:e(r)}})}at.mapIterable=hb;function pb(i){let e=i[Symbol.iterator];if(typeof e=="function")return e.call(i);let t=i.length;return typeof t=="number"&&t>=0?new sh(i):{next:()=>at.DONE_RESULT}}var sh=class{constructor(e){this.array=e,this.index=0}next(){return this.index<this.array.length?{done:!1,value:this.array[this.index++]}:at.DONE_RESULT}[Symbol.iterator](){return this}}});var $=f(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.ModelIndexImpl=Je.createRandomId=Je.SModelRoot=Je.SChildElement=Je.SParentElement=Je.isParent=Je.SModelElement=void 0;var ah=ee(),mT=or(),uu=class{get root(){let e=this;for(;e;){if(e instanceof lu)return e;e instanceof du?e=e.parent:e=void 0}throw new Error("Element has no root")}get index(){return this.root.index}hasFeature(e){return this.features!==void 0&&this.features.has(e)}};Je.SModelElement=uu;function yT(i){let e=i.children;return e!==void 0&&e.constructor===Array}Je.isParent=yT;var sr=class extends uu{constructor(){super(...arguments),this.children=[]}add(e,t){let n=this.children;if(t===void 0)n.push(e);else{if(t<0||t>this.children.length)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(t,0,e)}e.parent=this,this.index.add(e)}remove(e){let t=this.children,n=t.indexOf(e);if(n<0)throw new Error(`No such child ${e.id}`);t.splice(n,1),this.index.remove(e)}removeAll(e){let t=this.children;if(e!==void 0){for(let n=t.length-1;n>=0;n--)if(e(t[n])){let r=t.splice(n,1)[0];this.index.remove(r)}}else t.forEach(n=>{this.index.remove(n)}),t.splice(0,t.length)}move(e,t){let n=this.children,r=n.indexOf(e);if(r===-1)throw new Error(`No such child ${e.id}`);if(t<0||t>n.length-1)throw new Error(`Child index ${t} out of bounds (0..${n.length})`);n.splice(r,1),n.splice(t,0,e)}localToParent(e){return(0,ah.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}parentToLocal(e){return(0,ah.isBounds)(e)?e:{x:e.x,y:e.y,width:-1,height:-1}}};Je.SParentElement=sr;var du=class extends sr{};Je.SChildElement=du;var lu=class extends sr{constructor(e=new fu){super(),this.canvasBounds=ah.Bounds.EMPTY,Object.defineProperty(this,"index",{value:e,writable:!1})}};Je.SModelRoot=lu;var gb="0123456789abcdefghijklmnopqrstuvwxyz";function mb(i=8){let e="";for(let t=0;t<i;t++)e+=gb.charAt(Math.floor(Math.random()*gb.length));return e}Je.createRandomId=mb;var fu=class{constructor(){this.id2element=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else do e.id=mb();while(this.contains(e));if(this.id2element.set(e.id,e),e instanceof sr)for(let t of e.children)this.add(t)}remove(e){if(this.id2element.delete(e.id),e instanceof sr)for(let t of e.children)this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getAttachedElements(e){return[]}all(){return(0,mT.mapIterable)(this.id2element,([e,t])=>t)}};Je.ModelIndexImpl=fu});var Tn=f(Ze=>{"use strict";var ch=Ze&&Ze.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_b=Ze&&Ze.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},yb=Ze&&Ze.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.createFeatureSet=Ze.EMPTY_ROOT=Ze.SModelFactory=Ze.SModelRegistry=void 0;var Hs=_(),vb=P(),_T=Mn(),Jr=$(),hu=class extends _T.FactoryRegistry{constructor(e){super(),e.forEach(t=>{let n=this.getDefaultFeatures(t.constr);if(!n&&t.features&&t.features.enable&&(n=[]),n){let r=bb(n,t.features);this.register(t.type,()=>{let o=new t.constr;return o.features=r,o})}else this.register(t.type,()=>new t.constr)})}getDefaultFeatures(e){let t=e;do{let n=t.DEFAULT_FEATURES;if(n)return n;t=Object.getPrototypeOf(t)}while(t)}};hu=ch([(0,Hs.injectable)(),yb(0,(0,Hs.multiInject)(vb.TYPES.SModelElementRegistration)),yb(0,(0,Hs.optional)()),_b("design:paramtypes",[Array])],hu);Ze.SModelRegistry=hu;var pu=class{createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof Jr.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else n=new Jr.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof Jr.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else t=new Jr.SModelRoot;return this.initializeRoot(t,e)}createSchema(e){let t={};for(let n in e)if(!this.isReserved(e,n)){let r=e[n];typeof r!="function"&&(t[n]=r)}return e instanceof Jr.SParentElement&&(t.children=e.children.map(n=>this.createSchema(n))),t}initializeElement(e,t){for(let n in t)if(!this.isReserved(e,n)){let r=t[n];typeof r!="function"&&(e[n]=r)}return e}isReserved(e,t){if(["children","parent","index"].indexOf(t)>=0)return!0;let n=e;do{let r=Object.getOwnPropertyDescriptor(n,t);if(r!==void 0)return r.get!==void 0;n=Object.getPrototypeOf(n)}while(n);return!1}initializeParent(e,t){return this.initializeElement(e,t),(0,Jr.isParent)(t)&&(e.children=t.children.map(n=>this.createElement(n,e))),e}initializeChild(e,t,n){return this.initializeParent(e,t),n!==void 0&&(e.parent=n),e}initializeRoot(e,t){return this.initializeParent(e,t),e.index.add(e),e}};ch([(0,Hs.inject)(vb.TYPES.SModelRegistry),_b("design:type",hu)],pu.prototype,"registry",void 0);pu=ch([(0,Hs.injectable)()],pu);Ze.SModelFactory=pu;Ze.EMPTY_ROOT=Object.freeze({type:"NONE",id:"EMPTY"});function bb(i,e){let t=new Set(i);if(e&&e.enable)for(let n of e.enable)t.add(n);if(e&&e.disable)for(let n of e.disable)t.delete(n);return t}Ze.createFeatureSet=bb});var Qr=f(Zr=>{"use strict";var vT=Zr&&Zr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.AnimationFrameSyncer=void 0;var bT=_(),uh=class{constructor(){this.tasks=[],this.endTasks=[],this.triggered=!1}isAvailable(){return typeof requestAnimationFrame=="function"}onNextFrame(e){this.tasks.push(e),this.trigger()}onEndOfNextFrame(e){this.endTasks.push(e),this.trigger()}trigger(){this.triggered||(this.triggered=!0,this.isAvailable()?requestAnimationFrame(e=>this.run(e)):setTimeout(e=>this.run(e)))}run(e){let t=this.tasks,n=this.endTasks;this.triggered=!1,this.tasks=[],this.endTasks=[],t.forEach(r=>r.call(void 0,e)),n.forEach(r=>r.call(void 0,e))}};uh=vT([(0,bT.injectable)()],uh);Zr.AnimationFrameSyncer=uh});var gu=f(bi=>{"use strict";var eo=bi&&bi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},zs=bi&&bi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(bi,"__esModule",{value:!0});bi.ActionDispatcher=void 0;var to=_(),ar=ie(),ST=ru(),Ys=P(),ET=Tn(),wT=Qr(),vi=class{constructor(){this.postponedActions=[],this.requests=new Map}initialize(){return this.initialized||(this.initialized=this.actionHandlerRegistryProvider().then(e=>{this.actionHandlerRegistry=e,this.handleAction(ar.SetModelAction.create(ET.EMPTY_ROOT)).catch(()=>{})})),this.initialized}dispatch(e){return this.initialize().then(()=>{if(this.blockUntil!==void 0)return this.handleBlocked(e,this.blockUntil);if(this.diagramLocker.isAllowed(e))return this.handleAction(e)})}dispatchAll(e){return Promise.all(e.map(t=>this.dispatch(t)))}request(e){if(!e.requestId)return Promise.reject(new Error("Request without requestId"));let t=new ST.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(()=>{}),t.promise}handleAction(e){if(e.kind===ar.UndoAction.KIND)return this.commandStack.undo().then(()=>{});if(e.kind===ar.RedoAction.KIND)return this.commandStack.redo().then(()=>{});if((0,ar.isResponseAction)(e)){let r=this.requests.get(e.responseId);if(r!==void 0){if(this.requests.delete(e.responseId),e.kind===ar.RejectAction.KIND){let o=e;r.reject(new Error(o.message)),this.logger.warn(this,`Request with id ${e.responseId} failed.`,o.message,o.detail)}else r.resolve(e);return Promise.resolve()}this.logger.log(this,"No matching request for response",e)}let t=this.actionHandlerRegistry.get(e.kind);if(t.length===0){this.logger.warn(this,"Missing handler for action",e);let r=new Error(`Missing handler for action '${e.kind}'`);if((0,ar.isRequestAction)(e)){let o=this.requests.get(e.requestId);o!==void 0&&(this.requests.delete(e.requestId),o.reject(r))}return Promise.reject(r)}this.logger.log(this,"Handle",e);let n=[];for(let r of t){let o=r.handle(e);(0,ar.isAction)(o)?n.push(this.dispatch(o)):o!==void 0&&(n.push(this.commandStack.execute(o)),this.blockUntil=o.blockUntil)}return Promise.all(n)}handleBlocked(e,t){if(t(e)){this.blockUntil=void 0;let n=this.handleAction(e),r=this.postponedActions;this.postponedActions=[];for(let o of r)this.dispatch(o.action).then(o.resolve,o.reject);return n}else return this.logger.log(this,"Action is postponed due to block condition",e),new Promise((n,r)=>{this.postponedActions.push({action:e,resolve:n,reject:r})})}};eo([(0,to.inject)(Ys.TYPES.ActionHandlerRegistryProvider),zs("design:type",Function)],vi.prototype,"actionHandlerRegistryProvider",void 0);eo([(0,to.inject)(Ys.TYPES.ICommandStack),zs("design:type",Object)],vi.prototype,"commandStack",void 0);eo([(0,to.inject)(Ys.TYPES.ILogger),zs("design:type",Object)],vi.prototype,"logger",void 0);eo([(0,to.inject)(Ys.TYPES.AnimationFrameSyncer),zs("design:type",wT.AnimationFrameSyncer)],vi.prototype,"syncer",void 0);eo([(0,to.inject)(Ys.TYPES.IDiagramLocker),zs("design:type",Object)],vi.prototype,"diagramLocker",void 0);vi=eo([(0,to.injectable)()],vi);bi.ActionDispatcher=vi});var cr=f(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.isInjectable=void 0;function PT(i){return Reflect.getMetadata("inversify:paramtypes",i)!==void 0}mu.isInjectable=PT});var ks=f(mt=>{"use strict";var IT=mt&&mt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},RT=mt&&mt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},yu=mt&&mt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(mt,"__esModule",{value:!0});mt.onAction=mt.configureActionHandler=mt.ActionHandlerRegistry=void 0;var Us=_(),_u=P(),MT=Mn(),TT=cr(),dh=class extends MT.MultiInstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.actionKind,n.factory())),t.forEach(n=>this.initializeActionHandler(n))}initializeActionHandler(e){e.initialize(this)}};dh=IT([(0,Us.injectable)(),yu(0,(0,Us.multiInject)(_u.TYPES.ActionHandlerRegistration)),yu(0,(0,Us.optional)()),yu(1,(0,Us.multiInject)(_u.TYPES.IActionHandlerInitializer)),yu(1,(0,Us.optional)()),RT("design:paramtypes",[Array,Array])],dh);mt.ActionHandlerRegistry=dh;function OT(i,e,t){if(typeof t=="function"){if(!(0,TT.isInjectable)(t))throw new Error(`Action handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(_u.TYPES.ActionHandlerRegistration).toDynamicValue(n=>({actionKind:e,factory:()=>n.container.get(t)}))}mt.configureActionHandler=OT;function AT(i,e,t){i.bind(_u.TYPES.ActionHandlerRegistration).toConstantValue({actionKind:e,factory:()=>({handle:t})})}mt.onAction=AT});var fh=f(no=>{"use strict";var CT=no&&no.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(no,"__esModule",{value:!0});no.DefaultDiagramLocker=void 0;var xT=_(),lh=class{isAllowed(e){return!0}};lh=CT([(0,xT.injectable)()],lh);no.DefaultDiagramLocker=lh});var hh=f(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.easeInOut=void 0;function qT(i){return i<.5?i*i*2:1-(1-i)*(1-i)*2}vu.easeInOut=qT});var ur=f(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.CompoundAnimation=io.Animation=void 0;var Sb=hh(),bu=class{constructor(e,t=Sb.easeInOut){this.context=e,this.ease=t}start(){return new Promise((e,t)=>{let n,r=0,o=s=>{r++;let a;n===void 0?(n=s,a=0):a=s-n;let c=Math.min(1,a/this.context.duration),u=this.tween(this.ease(c),this.context);this.context.modelChanged.update(u),c===1?(this.context.logger.log(this,r*1e3/this.context.duration+" fps"),e(u)):this.context.syncer.onNextFrame(o)};if(this.context.syncer.isAvailable())this.context.syncer.onNextFrame(o);else{let s=this.tween(1,this.context);e(s)}})}};io.Animation=bu;var ph=class extends bu{constructor(e,t,n=[],r=Sb.easeInOut){super(t,r),this.model=e,this.context=t,this.components=n,this.ease=r}include(e){return this.components.push(e),this}tween(e,t){for(let n of this.components)n.tween(e,t);return this.model}};io.CompoundAnimation=ph});var me=f(Qe=>{"use strict";var ro=Qe&&Qe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.ResetCommand=Qe.SystemCommand=Qe.PopupCommand=Qe.HiddenCommand=Qe.MergeableCommand=Qe.Command=void 0;var oo=_(),Si=class{};Si=ro([(0,oo.injectable)()],Si);Qe.Command=Si;var gh=class extends Si{merge(e,t){return!1}};gh=ro([(0,oo.injectable)()],gh);Qe.MergeableCommand=gh;var mh=class extends Si{undo(e){return e.logger.error(this,"Cannot undo a hidden command"),e.root}redo(e){return e.logger.error(this,"Cannot redo a hidden command"),e.root}};mh=ro([(0,oo.injectable)()],mh);Qe.HiddenCommand=mh;var yh=class extends Si{};yh=ro([(0,oo.injectable)()],yh);Qe.PopupCommand=yh;var _h=class extends Si{};_h=ro([(0,oo.injectable)()],_h);Qe.SystemCommand=_h;var vh=class extends Si{};vh=ro([(0,oo.injectable)()],vh);Qe.ResetCommand=vh});var _t=f(yt=>{"use strict";var DT=yt&&yt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jT=yt&&yt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Eb=yt&&yt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(yt,"__esModule",{value:!0});yt.configureCommand=yt.CommandActionHandlerInitializer=yt.CommandActionHandler=void 0;var Su=_(),NT=cr(),bh=P(),Eu=class{constructor(e){this.commandRegistration=e}handle(e){return this.commandRegistration.factory(e)}};yt.CommandActionHandler=Eu;var Sh=class{constructor(e){this.registrations=e}initialize(e){this.registrations.forEach(t=>e.register(t.kind,new Eu(t)))}};Sh=DT([(0,Su.injectable)(),Eb(0,(0,Su.multiInject)(bh.TYPES.CommandRegistration)),Eb(0,(0,Su.optional)()),jT("design:paramtypes",[Array])],Sh);yt.CommandActionHandlerInitializer=Sh;function LT(i,e){if(!(0,NT.isInjectable)(e))throw new Error(`Commands should be @injectable: ${e.name}`);i.isBound(e)||i.bind(e).toSelf(),i.bind(bh.TYPES.CommandRegistration).toDynamicValue(t=>({kind:e.KIND,factory:n=>{let r=new Su.Container;return r.parent=t.container,r.bind(bh.TYPES.Action).toConstantValue(n),r.get(e)}}))}yt.configureCommand=LT});var wb=f(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.overrideCommandStackOptions=void 0;var BT=En(),FT=P();function VT(i,e){let t=i.get(FT.TYPES.CommandStackOptions);return(0,BT.safeAssign)(t,e),t}wu.overrideCommandStackOptions=VT});var wh=f(wi=>{"use strict";var lr=wi&&wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ei=wi&&wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(wi,"__esModule",{value:!0});wi.CommandStack=void 0;var fr=_(),Gs=P(),Eh=Tn(),KT=$(),HT=Qr(),dr=me(),Zn=class{constructor(){this.undoStack=[],this.redoStack=[],this.offStack=[]}initialize(){this.currentPromise=Promise.resolve({main:{model:this.modelFactory.createRoot(Eh.EMPTY_ROOT),modelChanged:!1},hidden:{model:this.modelFactory.createRoot(Eh.EMPTY_ROOT),modelChanged:!1},popup:{model:this.modelFactory.createRoot(Eh.EMPTY_ROOT),modelChanged:!1}})}get currentModel(){return this.currentPromise.then(e=>e.main.model)}executeAll(e){return e.forEach(t=>{this.logger.log(this,"Executing",t),this.handleCommand(t,t.execute,this.mergeOrPush)}),this.thenUpdate()}execute(e){return this.logger.log(this,"Executing",e),this.handleCommand(e,e.execute,this.mergeOrPush),this.thenUpdate()}undo(){this.undoOffStackSystemCommands(),this.undoPreceedingSystemCommands();let e=this.undoStack[this.undoStack.length-1];return e!==void 0&&!this.isBlockUndo(e)&&(this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)})),this.thenUpdate()}redo(){this.undoOffStackSystemCommands();let e=this.redoStack.pop();return e!==void 0&&(this.logger.log(this,"Redoing",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)})),this.redoFollowingSystemCommands(),this.thenUpdate()}handleCommand(e,t,n){this.currentPromise=this.currentPromise.then(r=>new Promise(o=>{let s;e instanceof dr.HiddenCommand?s="hidden":e instanceof dr.PopupCommand?s="popup":s="main";let a=this.createContext(r.main.model),c;try{c=t.call(e,a)}catch(d){this.logger.error(this,"Failed to execute command:",d),c=r[s].model}let u=Pb(r);c instanceof Promise?c.then(d=>{s==="main"&&n.call(this,e,a),u[s]={model:d,modelChanged:!0},o(u)}):c instanceof KT.SModelRoot?(s==="main"&&n.call(this,e,a),u[s]={model:c,modelChanged:!0},o(u)):(s==="main"&&n.call(this,e,a),u[s]={model:c.model,modelChanged:r[s].modelChanged||c.modelChanged,cause:c.cause},o(u))}))}pushToUndoStack(e){this.undoStack.push(e),this.options.undoHistoryLimit>=0&&this.undoStack.length>this.options.undoHistoryLimit&&this.undoStack.splice(0,this.undoStack.length-this.options.undoHistoryLimit)}thenUpdate(){return this.currentPromise=this.currentPromise.then(e=>{let t=Pb(e);return e.hidden.modelChanged&&(this.updateHidden(e.hidden.model,e.hidden.cause),t.hidden.modelChanged=!1,t.hidden.cause=void 0),e.main.modelChanged&&(this.update(e.main.model,e.main.cause),t.main.modelChanged=!1,t.main.cause=void 0),e.popup.modelChanged&&(this.updatePopup(e.popup.model,e.popup.cause),t.popup.modelChanged=!1,t.popup.cause=void 0),t}),this.currentModel}update(e,t){this.modelViewer===void 0&&(this.modelViewer=this.viewerProvider.modelViewer),this.modelViewer.update(e,t)}updateHidden(e,t){this.hiddenModelViewer===void 0&&(this.hiddenModelViewer=this.viewerProvider.hiddenModelViewer),this.hiddenModelViewer.update(e,t)}updatePopup(e,t){this.popupModelViewer===void 0&&(this.popupModelViewer=this.viewerProvider.popupModelViewer),this.popupModelViewer.update(e,t)}mergeOrPush(e,t){if(this.isBlockUndo(e)){this.undoStack=[],this.redoStack=[],this.offStack=[],this.pushToUndoStack(e);return}if(this.isPushToOffStack(e)&&this.redoStack.length>0){if(this.offStack.length>0){let n=this.offStack[this.offStack.length-1];if(n instanceof dr.MergeableCommand&&n.merge(e,t))return}this.offStack.push(e);return}if(this.isPushToUndoStack(e)){if(this.offStack.forEach(n=>this.undoStack.push(n)),this.offStack=[],this.redoStack=[],this.undoStack.length>0){let n=this.undoStack[this.undoStack.length-1];if(n instanceof dr.MergeableCommand&&n.merge(e,t))return}this.pushToUndoStack(e)}}undoOffStackSystemCommands(){let e=this.offStack.pop();for(;e!==void 0;)this.logger.log(this,"Undoing off-stack",e),this.handleCommand(e,e.undo,()=>{}),e=this.offStack.pop()}undoPreceedingSystemCommands(){let e=this.undoStack[this.undoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.undoStack.pop(),this.logger.log(this,"Undoing",e),this.handleCommand(e,e.undo,(t,n)=>{this.redoStack.push(t)}),e=this.undoStack[this.undoStack.length-1]}redoFollowingSystemCommands(){let e=this.redoStack[this.redoStack.length-1];for(;e!==void 0&&this.isPushToOffStack(e);)this.redoStack.pop(),this.logger.log(this,"Redoing ",e),this.handleCommand(e,e.redo,(t,n)=>{this.pushToUndoStack(t)}),e=this.redoStack[this.redoStack.length-1]}createContext(e){return{root:e,modelChanged:this,modelFactory:this.modelFactory,duration:this.options.defaultDuration,logger:this.logger,syncer:this.syncer}}isPushToOffStack(e){return e instanceof dr.SystemCommand}isPushToUndoStack(e){return!(e instanceof dr.HiddenCommand)}isBlockUndo(e){return e instanceof dr.ResetCommand}};lr([(0,fr.inject)(Gs.TYPES.IModelFactory),Ei("design:type",Object)],Zn.prototype,"modelFactory",void 0);lr([(0,fr.inject)(Gs.TYPES.IViewerProvider),Ei("design:type",Object)],Zn.prototype,"viewerProvider",void 0);lr([(0,fr.inject)(Gs.TYPES.ILogger),Ei("design:type",Object)],Zn.prototype,"logger",void 0);lr([(0,fr.inject)(Gs.TYPES.AnimationFrameSyncer),Ei("design:type",HT.AnimationFrameSyncer)],Zn.prototype,"syncer",void 0);lr([(0,fr.inject)(Gs.TYPES.CommandStackOptions),Ei("design:type",Object)],Zn.prototype,"options",void 0);lr([(0,fr.postConstruct)(),Ei("design:type",Function),Ei("design:paramtypes",[]),Ei("design:returntype",void 0)],Zn.prototype,"initialize",null);Zn=lr([(0,fr.injectable)()],Zn);wi.CommandStack=Zn;function Pb(i){return{main:Object.assign({},i.main),hidden:Object.assign({},i.hidden),popup:Object.assign({},i.popup)}}});var Ib=f(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});Pu.ServerActionHandlerRegistry=void 0;var Ph=class{constructor(){this.handlers=new Map}getHandler(e){return this.handlers.get(e)}onAction(e,t){this.handlers.has(e)?this.handlers.get(e).push(t):this.handlers.set(e,[t])}removeActionHandler(e,t){let n=this.handlers.get(e);if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}};Pu.ServerActionHandlerRegistry=Ph});var Pi=f(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.SModelIndex=vt.findElement=vt.getSubType=vt.getBasicType=vt.applyBounds=vt.cloneModel=void 0;function zT(i){return JSON.parse(JSON.stringify(i))}vt.cloneModel=zT;function YT(i,e){let t=new Iu;t.add(i);for(let n of e.bounds){let r=t.getById(n.elementId);if(r){let o=r;n.newPosition&&(o.position={x:n.newPosition.x,y:n.newPosition.y}),n.newSize&&(o.size={width:n.newSize.width,height:n.newSize.height})}}if(e.alignments)for(let n of e.alignments){let r=t.getById(n.elementId);if(r){let o=r;o.alignment={x:n.newAlignment.x,y:n.newAlignment.y}}}}vt.applyBounds=YT;function UT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}vt.getBasicType=UT;function kT(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}vt.getSubType=kT;function Rb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Rb(t,e);if(n!==void 0)return n}}vt.findElement=Rb;var Iu=class{constructor(){this.id2element=new Map,this.id2parent=new Map}add(e){if(e.id){if(this.contains(e))throw new Error("Duplicate ID in model: "+e.id)}else throw new Error("Model element has no ID.");if(this.id2element.set(e.id,e),Array.isArray(e.children))for(let t of e.children)this.add(t),this.id2parent.set(t.id,e)}remove(e){if(this.id2element.delete(e.id),Array.isArray(e.children))for(let t of e.children)this.id2parent.delete(t.id),this.remove(t)}contains(e){return this.id2element.has(e.id)}getById(e){return this.id2element.get(e)}getParent(e){return this.id2parent.get(e)}getRoot(e){let t=e;for(;t;){let n=this.id2parent.get(t.id);if(n===void 0)return t;t=n}throw new Error("Element has no root")}};vt.SModelIndex=Iu});var Mb=f(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});Ru.DiagramServer=void 0;var GT=Ib(),bt=ie(),$T=ru(),Ih=Pi(),Rh=class{constructor(e,t){this.state={currentRoot:{type:"NONE",id:"ROOT"},revision:0},this.requests=new Map,this.dispatch=e,this.diagramGenerator=t.DiagramGenerator,this.layoutEngine=t.ModelLayoutEngine,this.actionHandlerRegistry=t.ServerActionHandlerRegistry}onAction(e,t){this.actionHandlerRegistry||(this.actionHandlerRegistry=new GT.ServerActionHandlerRegistry),this.actionHandlerRegistry.onAction(e,t)}removeActionHandler(e,t){this.actionHandlerRegistry&&this.actionHandlerRegistry.removeActionHandler(e,t)}setModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!1)}updateModel(e){return e.revision=++this.state.revision,this.state.currentRoot=e,this.submitModel(e,!0)}get needsClientLayout(){return this.state.options&&this.state.options.needsClientLayout!==void 0?!!this.state.options.needsClientLayout:!0}get needsServerLayout(){return this.state.options&&this.state.options.needsServerLayout!==void 0?!!this.state.options.needsServerLayout:!1}accept(e){if((0,bt.isResponseAction)(e)){let t=e.responseId,n=this.requests.get(t);if(n){if(this.requests.delete(t),e.kind===bt.RejectAction.KIND){let r=e;n.reject(new Error(r.message)),console.warn(`Request with id ${e.responseId} failed: ${r.message}`,r.detail)}else n.resolve(e);return Promise.resolve()}console.info("No matching request for response:",e)}return this.handleAction(e)}request(e){e.requestId||(e.requestId="server_"+(0,bt.generateRequestId)());let t=new $T.Deferred;return this.requests.set(e.requestId,t),this.dispatch(e).catch(n=>{this.requests.delete(e.requestId),t.reject(n)}),t.promise}rejectRemoteRequest(e,t){e&&(0,bt.isRequestAction)(e)&&this.dispatch({kind:bt.RejectAction.KIND,responseId:e.requestId,message:t.message,detail:t.stack})}handleAction(e){var t;let n=(t=this.actionHandlerRegistry)===null||t===void 0?void 0:t.getHandler(e.kind);if(n&&n.length===1)return n[0](e,this.state,this);if(n&&n.length>1)return Promise.all(n.map(r=>r(e,this.state,this)));switch(e.kind){case bt.RequestModelAction.KIND:return this.handleRequestModel(e);case bt.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case bt.LayoutAction.KIND:return this.handleLayout(e)}return console.warn(`Unhandled action from client: ${e.kind}`),Promise.resolve()}async handleRequestModel(e){var t;this.state.options=e.options;try{let n=await this.diagramGenerator.generate({options:(t=this.state.options)!==null&&t!==void 0?t:{},state:this.state});n.revision=++this.state.revision,this.state.currentRoot=n,await this.submitModel(this.state.currentRoot,!1,e)}catch(n){this.rejectRemoteRequest(e,n),console.error("Failed to generate diagram:",n)}}async submitModel(e,t,n){if(this.needsClientLayout)if(!this.needsServerLayout)this.dispatch({kind:bt.RequestBoundsAction.KIND,newRoot:e});else{let r=bt.RequestBoundsAction.create(e),o=await this.request(r),s=this.state.currentRoot;o.revision===s.revision?((0,Ih.applyBounds)(s,o),await this.doSubmitModel(s,t,n)):this.rejectRemoteRequest(n,new Error(`Model revision does not match: ${o.revision}`))}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n){if(e.revision!==this.state.revision)return;this.needsServerLayout&&this.layoutEngine&&(e=await this.layoutEngine.layout(e));let r=e.type;if(n&&n.kind===bt.RequestModelAction.KIND){let o=n.requestId,s=bt.SetModelAction.create(e,o);await this.dispatch(s)}else t&&r===this.state.lastSubmittedModelType?await this.dispatch({kind:bt.UpdateModelAction.KIND,newRoot:e,cause:n}):await this.dispatch({kind:bt.SetModelAction.KIND,newRoot:e});this.state.lastSubmittedModelType=r}handleComputedBounds(e){return e.revision!==this.state.currentRoot.revision?Promise.reject():((0,Ih.applyBounds)(this.state.currentRoot,e),Promise.resolve())}async handleLayout(e){if(this.layoutEngine){if(!this.needsServerLayout){let t=(0,Ih.cloneModel)(this.state.currentRoot);t=await this.layoutEngine.layout(t),t.revision=++this.state.revision,this.state.currentRoot=t}await this.doSubmitModel(this.state.currentRoot,!0,e)}}};Ru.DiagramServer=Rh});var Ob=f(Tb=>{"use strict";Object.defineProperty(Tb,"__esModule",{value:!0})});var Cb=f(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.isZoomable=so.isScrollable=void 0;var Ab=En();function WT(i){return(0,Ab.hasOwnProperty)(i,"scroll")}so.isScrollable=WT;function XT(i){return(0,Ab.hasOwnProperty)(i,"zoom")}so.isZoomable=XT});var qb=f(xb=>{"use strict";Object.defineProperty(xb,"__esModule",{value:!0})});var hr=f(ct=>{"use strict";var JT=ct&&ct.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),Qn=ct&&ct.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&JT(e,i,t)};Object.defineProperty(ct,"__esModule",{value:!0});Qn(ie(),ct);Qn(Mb(),ct);Qn(Ob(),ct);Qn(Cb(),ct);Qn(ru(),ct);Qn(ee(),ct);Qn(qb(),ct);Qn(Pi(),ct);Qn(En(),ct)});var On=f(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.hitsMouseEvent=Ut.getWindowScroll=Ut.isCrossSite=Ut.isMac=Ut.isCtrlOrCmd=void 0;var ZT=hr();function QT(i){return Db()?i.metaKey:i.ctrlKey}Ut.isCtrlOrCmd=QT;function Db(){return window.navigator.userAgent.indexOf("Mac")!==-1}Ut.isMac=Db;function eO(i){if(i&&typeof window<"u"&&window.location){let e="";return window.location.protocol&&(e+=window.location.protocol+"//"),window.location.host&&(e+=window.location.host),e.length>0&&!i.startsWith(e)}return!1}Ut.isCrossSite=eO;function tO(){return typeof window>"u"?ZT.Point.ORIGIN:{x:window.pageXOffset,y:window.pageYOffset}}Ut.getWindowScroll=tO;function nO(i,e){let t=i.getBoundingClientRect();return e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom}Ut.hitsMouseEvent=nO});var Ws=f(ut=>{"use strict";var Mh=ut&&ut.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jb=ut&&ut.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},iO=ut&&ut.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ut,"__esModule",{value:!0});ut.InitializeCanvasBoundsCommand=ut.InitializeCanvasBoundsAction=ut.CanvasBoundsInitializer=void 0;var Mu=_(),$s=ee(),Nb=P(),rO=$(),oO=me(),sO=On(),Tu=class{decorate(e,t){return t instanceof rO.SModelRoot&&!$s.Dimension.isValid(t.canvasBounds)&&(this.rootAndVnode=[t,e]),e}postUpdate(){if(this.rootAndVnode!==void 0){let e=this.rootAndVnode[1].elm,t=this.rootAndVnode[0].canvasBounds;if(e!==void 0){let n=this.getBoundsInPage(e);(0,$s.almostEquals)(n.x,t.x)&&(0,$s.almostEquals)(n.y,t.y)&&(0,$s.almostEquals)(n.width,t.width)&&(0,$s.almostEquals)(n.height,t.width)||this.actionDispatcher.dispatch(Th.create(n))}this.rootAndVnode=void 0}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,sO.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};Mh([(0,Mu.inject)(Nb.TYPES.IActionDispatcher),jb("design:type",Object)],Tu.prototype,"actionDispatcher",void 0);Tu=Mh([(0,Mu.injectable)()],Tu);ut.CanvasBoundsInitializer=Tu;var Th;(function(i){i.KIND="initializeCanvasBounds";function e(t){return{kind:i.KIND,newCanvasBounds:t}}i.create=e})(Th=ut.InitializeCanvasBoundsAction||(ut.InitializeCanvasBoundsAction={}));var Ou=class extends oO.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newCanvasBounds=this.action.newCanvasBounds,e.root.canvasBounds=this.newCanvasBounds,e.root}undo(e){return e.root}redo(e){return e.root}};Ou.KIND=Th.KIND;Ou=Mh([(0,Mu.injectable)(),iO(0,(0,Mu.inject)(Nb.TYPES.Action)),jb("design:paramtypes",[Object])],Ou);ut.InitializeCanvasBoundsCommand=Ou});var Cu=f(St=>{"use strict";var aO=St&&St.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},cO=St&&St.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},uO=St&&St.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(St,"__esModule",{value:!0});St.SetModelCommand=St.SetModelAction=St.RequestModelAction=void 0;var Lb=_(),Bb=ie(),dO=me(),lO=P(),fO=Ws(),pr=class{constructor(e,t=""){this.options=e,this.requestId=t,this.kind=pr.KIND}static create(e){return new pr(e,(0,Bb.generateRequestId)())}};St.RequestModelAction=pr;pr.KIND="requestModel";var ao=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ao.KIND}};St.SetModelAction=ao;ao.KIND="setModel";var Au=class extends dO.ResetCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.modelFactory.createRoot(e.root),this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}get blockUntil(){return e=>e.kind===fO.InitializeCanvasBoundsCommand.KIND}};Au.KIND=Bb.SetModelAction.KIND;Au=aO([(0,Lb.injectable)(),uO(0,(0,Lb.inject)(lO.TYPES.Action)),cO("design:paramtypes",[Object])],Au);St.SetModelCommand=Au});var Vb=f(Fb=>{"use strict";Object.defineProperty(Fb,"__esModule",{value:!0})});var ze=f(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.transformToRootBounds=Se.containsSome=Se.translateBounds=Se.translatePoint=Se.findParentByFeature=Se.findParent=Se.findElement=Se.getSubType=Se.getBasicType=Se.registerModelElement=void 0;var hO=P(),Xs=$();function pO(i,e,t,n){i.bind(hO.TYPES.SModelElementRegistration).toConstantValue({type:e,constr:t,features:n})}Se.registerModelElement=pO;function gO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(0,e):i.type}Se.getBasicType=gO;function mO(i){if(!i.type)return"";let e=i.type.indexOf(":");return e>=0?i.type.substring(e+1):i.type}Se.getSubType=mO;function Kb(i,e){if(i.id===e)return i;if(i.children!==void 0)for(let t of i.children){let n=Kb(t,e);if(n!==void 0)return n}}Se.findElement=Kb;function yO(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Xs.SChildElement?t=t.parent:t=void 0}return t}Se.findParent=yO;function _O(i,e){let t=i;for(;t!==void 0;){if(e(t))return t;t instanceof Xs.SChildElement?t=t.parent:t=void 0}return t}Se.findParentByFeature=_O;function Oh(i,e,t){if(e!==t){for(;e instanceof Xs.SChildElement;)if(i=e.localToParent(i),e=e.parent,e===t)return i;let n=[];for(;t instanceof Xs.SChildElement;)n.push(t),t=t.parent;if(e!==t)throw new Error("Incompatible source and target: "+e.id+", "+t.id);for(let r=n.length-1;r>=0;r--)i=n[r].parentToLocal(i)}return i}Se.translatePoint=Oh;function vO(i,e,t){let n=Oh(i,e,t),r=Oh({x:i.x+i.width,y:i.y+i.height},e,t);return{x:n.x,y:n.y,width:r.x-n.x,height:r.y-n.y}}Se.translateBounds=vO;function bO(i,e){let t=r=>i.index.getById(r.id)!==void 0,n=r=>r.some(o=>t(o)||n(o.children));return n([e])}Se.containsSome=bO;function SO(i,e){for(;i instanceof Xs.SChildElement;)e=i.localToParent(e),i=i.parent;return e}Se.transformToRootBounds=SO});var xu=f(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.EnableDefaultToolsAction=Ii.EnableToolsAction=void 0;var EO;(function(i){i.KIND="enable-tools";function e(t){return{kind:i.KIND,toolIds:t}}i.create=e})(EO=Ii.EnableToolsAction||(Ii.EnableToolsAction={}));var wO;(function(i){i.KIND="enable-default-tools";function e(){return{kind:i.KIND}}i.create=e})(wO=Ii.EnableDefaultToolsAction||(Ii.EnableDefaultToolsAction={}))});var Be=f(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.getAttrs=Le.on=Le.mergeStyle=Le.copyClassesFromElement=Le.copyClassesFromVNode=Le.setNamespace=Le.setClass=Le.setAttr=void 0;function PO(i,e,t){zb(i)[e]=t}Le.setAttr=PO;function Ah(i,e,t){Yb(i)[e]=t}Le.setClass=Ah;function Hb(i,e){i.data===void 0&&(i.data={}),i.data.ns=e;let t=i.children;if(t!==void 0)for(let n=0;n<t.length;n++){let r=t[n];typeof r!="string"&&Hb(r,e)}}Le.setNamespace=Hb;function IO(i,e){let t=Yb(i);Object.keys(t).forEach(n=>Ah(e,n,!0))}Le.copyClassesFromVNode=IO;function RO(i,e){let t=i.classList;for(let n=0;n<t.length;n++){let r=t.item(n);r&&Ah(e,r,!0)}}Le.copyClassesFromElement=RO;function MO(i,e){Js(i).style=Object.assign(Object.assign({},Js(i).style||{}),e)}Le.mergeStyle=MO;function TO(i,e,t){let n=OO(i);if(n[e])throw new Error("EventListener for "+e+" already registered on VNode");n[e]=t}Le.on=TO;function zb(i){let e=Js(i);return e.attrs||(e.attrs={}),e.attrs}Le.getAttrs=zb;function Js(i){return i.data||(i.data={}),i.data}function Yb(i){let e=Js(i);return e.class||(e.class={}),e.class}function OO(i){let e=Js(i);return e.on||(e.on={}),e.on}});var dn=f(kt=>{"use strict";var qh=kt&&kt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},kb=kt&&kt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Ub=kt&&kt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(kt,"__esModule",{value:!0});kt.KeyListener=kt.KeyTool=void 0;var Zs=_(),Gb=P(),AO=$(),Ch=Be(),qu=class{constructor(e=[]){this.keyListeners=e}register(e){this.keyListeners.push(e)}deregister(e){let t=this.keyListeners.indexOf(e);t>=0&&this.keyListeners.splice(t,1)}handleEvent(e,t,n){let r=this.keyListeners.map(o=>o[e].apply(o,[t,n])).reduce((o,s)=>o.concat(s));r.length>0&&(n.preventDefault(),this.actionDispatcher.dispatchAll(r))}keyDown(e,t){this.handleEvent("keyDown",e,t)}keyUp(e,t){this.handleEvent("keyUp",e,t)}focus(){}decorate(e,t){return t instanceof AO.SModelRoot&&((0,Ch.on)(e,"focus",this.focus.bind(this,t)),(0,Ch.on)(e,"keydown",this.keyDown.bind(this,t)),(0,Ch.on)(e,"keyup",this.keyUp.bind(this,t))),e}postUpdate(){}};qh([(0,Zs.inject)(Gb.TYPES.IActionDispatcher),kb("design:type",Object)],qu.prototype,"actionDispatcher",void 0);qu=qh([(0,Zs.injectable)(),Ub(0,(0,Zs.multiInject)(Gb.TYPES.KeyListener)),Ub(0,(0,Zs.optional)()),kb("design:paramtypes",[Array])],qu);kt.KeyTool=qu;var xh=class{keyDown(e,t){return[]}keyUp(e,t){return[]}};xh=qh([(0,Zs.injectable)()],xh);kt.KeyListener=xh});var An=f(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.getActualCode=co.matchesKeystroke=void 0;var CO=On();function xO(i,e,...t){if($b(i)!==e)return!1;if((0,CO.isMac)()){if(i.ctrlKey!==t.findIndex(n=>n==="ctrl")>=0||i.metaKey!==t.findIndex(n=>n==="meta"||n==="ctrlCmd")>=0)return!1}else if(i.ctrlKey!==t.findIndex(n=>n==="ctrl"||n==="ctrlCmd")>=0||i.metaKey!==t.findIndex(n=>n==="meta")>=0)return!1;return!(i.altKey!==t.findIndex(n=>n==="alt")>=0||i.shiftKey!==t.findIndex(n=>n==="shift")>=0)}co.matchesKeystroke=xO;function $b(i){if(i.keyCode){let e=Dh[i.keyCode];if(e!==void 0)return e}return i.code}co.getActualCode=$b;var Dh=new Array(256);(()=>{function i(e,t){Dh[t]===void 0&&(Dh[t]=e)}i("Pause",3),i("Backspace",8),i("Tab",9),i("Enter",13),i("ShiftLeft",16),i("ShiftRight",16),i("ControlLeft",17),i("ControlRight",17),i("AltLeft",18),i("AltRight",18),i("CapsLock",20),i("Escape",27),i("Space",32),i("PageUp",33),i("PageDown",34),i("End",35),i("Home",36),i("ArrowLeft",37),i("ArrowUp",38),i("ArrowRight",39),i("ArrowDown",40),i("Insert",45),i("Delete",46),i("Digit1",49),i("Digit2",50),i("Digit3",51),i("Digit4",52),i("Digit5",53),i("Digit6",54),i("Digit7",55),i("Digit8",56),i("Digit9",57),i("Digit0",48),i("KeyA",65),i("KeyB",66),i("KeyC",67),i("KeyD",68),i("KeyE",69),i("KeyF",70),i("KeyG",71),i("KeyH",72),i("KeyI",73),i("KeyJ",74),i("KeyK",75),i("KeyL",76),i("KeyM",77),i("KeyN",78),i("KeyO",79),i("KeyP",80),i("KeyQ",81),i("KeyR",82),i("KeyS",83),i("KeyT",84),i("KeyU",85),i("KeyV",86),i("KeyW",87),i("KeyX",88),i("KeyY",89),i("KeyZ",90),i("OSLeft",91),i("MetaLeft",91),i("OSRight",92),i("MetaRight",92),i("ContextMenu",93),i("Numpad0",96),i("Numpad1",97),i("Numpad2",98),i("Numpad3",99),i("Numpad4",100),i("Numpad5",101),i("Numpad6",102),i("Numpad7",103),i("Numpad8",104),i("Numpad9",105),i("NumpadMultiply",106),i("NumpadAdd",107),i("NumpadSeparator",108),i("NumpadSubtract",109),i("NumpadDecimal",110),i("NumpadDivide",111),i("F1",112),i("F2",113),i("F3",114),i("F4",115),i("F5",116),i("F6",117),i("F7",118),i("F8",119),i("F9",120),i("F10",121),i("F11",122),i("F12",123),i("F13",124),i("F14",125),i("F15",126),i("F16",127),i("F17",128),i("F18",129),i("F19",130),i("F20",131),i("F21",132),i("F22",133),i("F23",134),i("F24",135),i("NumLock",144),i("ScrollLock",145),i("Semicolon",186),i("Equal",187),i("Comma",188),i("Minus",189),i("Period",190),i("Slash",191),i("Backquote",192),i("IntlRo",193),i("BracketLeft",219),i("Backslash",220),i("BracketRight",221),i("Quote",222),i("IntlYen",255)})()});var Bh=f(Gt=>{"use strict";var ju=Gt&&Gt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},qO=Gt&&Gt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.DefaultToolsEnablingKeyListener=Gt.ToolManagerActionHandler=Gt.ToolManager=void 0;var Nu=_(),DO=P(),jh=xu(),jO=dn(),NO=An(),Nh=class{constructor(){this.tools=[],this.defaultTools=[],this.actives=[]}get managedTools(){return this.defaultTools.concat(this.tools)}get activeTools(){return this.actives}disableActiveTools(){this.actives.forEach(e=>e.disable()),this.actives.splice(0,this.actives.length)}enableDefaultTools(){this.enable(this.defaultTools.map(e=>e.id))}enable(e){this.disableActiveTools(),e.map(n=>this.tool(n)).forEach(n=>{n!==void 0&&(n.enable(),this.actives.push(n))})}tool(e){return this.managedTools.find(t=>t.id===e)}registerDefaultTools(...e){for(let t of e)this.defaultTools.push(t)}registerTools(...e){for(let t of e)this.tools.push(t)}};Nh=ju([(0,Nu.injectable)()],Nh);Gt.ToolManager=Nh;var Du=class{handle(e){switch(e.kind){case jh.EnableDefaultToolsAction.KIND:this.toolManager.enableDefaultTools();break;case jh.EnableToolsAction.KIND:this.toolManager.enable(e.toolIds);break}}};ju([(0,Nu.inject)(DO.TYPES.IToolManager),qO("design:type",Object)],Du.prototype,"toolManager",void 0);Du=ju([(0,Nu.injectable)()],Du);Gt.ToolManagerActionHandler=Du;var Lh=class extends jO.KeyListener{keyDown(e,t){return(0,NO.matchesKeystroke)(t,"Escape")?[jh.EnableDefaultToolsAction.create()]:[]}};Lh=ju([(0,Nu.injectable)()],Lh);Gt.DefaultToolsEnablingKeyListener=Lh});var ea=f(dt=>{"use strict";var Vh=dt&&dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Kh=dt&&dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Fh=dt&&dt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(dt,"__esModule",{value:!0});dt.SetUIExtensionVisibilityCommand=dt.SetUIExtensionVisibilityAction=dt.UIExtensionRegistry=void 0;var uo=_(),LO=Mn(),BO=me(),Hh=P(),Lu=class extends LO.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>this.register(t.id(),t))}};Lu=Vh([(0,uo.injectable)(),Fh(0,(0,uo.multiInject)(Hh.TYPES.IUIExtension)),Fh(0,(0,uo.optional)()),Kh("design:paramtypes",[Array])],Lu);dt.UIExtensionRegistry=Lu;var Wb;(function(i){i.KIND="setUIExtensionVisibility";function e(t){var n;return{kind:i.KIND,extensionId:t.extensionId,visible:t.visible,contextElementsId:(n=t.contextElementsId)!==null&&n!==void 0?n:[]}}i.create=e})(Wb=dt.SetUIExtensionVisibilityAction||(dt.SetUIExtensionVisibilityAction={}));var Qs=class extends BO.SystemCommand{constructor(e){super(),this.action=e}execute(e){let t=this.registry.get(this.action.extensionId);return t&&(this.action.visible?t.show(e.root,...this.action.contextElementsId):t.hide()),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};Qs.KIND=Wb.KIND;Vh([(0,uo.inject)(Hh.TYPES.UIExtensionRegistry),Kh("design:type",Lu)],Qs.prototype,"registry",void 0);Qs=Vh([(0,uo.injectable)(),Fh(0,(0,uo.inject)(Hh.TYPES.Action)),Kh("design:paramtypes",[Object])],Qs);dt.SetUIExtensionVisibilityCommand=Qs});var Bu=f(Ri=>{"use strict";var zh=Ri&&Ri.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Xb=Ri&&Ri.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ri,"__esModule",{value:!0});Ri.AbstractUIExtension=void 0;var Yh=_(),Jb=P(),ta=class{show(e,...t){this.activeElement=document.activeElement,!(!this.containerElement&&!this.initialize())&&(this.onBeforeShow(this.containerElement,e,...t),this.setContainerVisible(!0))}hide(){this.setContainerVisible(!1),this.restoreFocus(),this.activeElement=null}restoreFocus(){let e=this.activeElement;e&&e.focus()}initialize(){let e=document.getElementById(this.options.baseDiv);return e?(this.containerElement=this.getOrCreateContainer(e.id),this.initializeContents(this.containerElement),e&&e.insertBefore(this.containerElement,e.firstChild),!0):(this.logger.warn(this,`Could not obtain sprotty base container for initializing UI extension ${this.id}`,this),!1)}getOrCreateContainer(e){let t=document.getElementById(this.id());return t===null&&(t=document.createElement("div"),t.id=e+"_"+this.id(),t.classList.add(this.containerClass())),t}setContainerVisible(e){this.containerElement&&(e?(this.containerElement.style.visibility="visible",this.containerElement.style.opacity="1"):(this.containerElement.style.visibility="hidden",this.containerElement.style.opacity="0"))}onBeforeShow(e,t,...n){}};zh([(0,Yh.inject)(Jb.TYPES.ViewerOptions),Xb("design:type",Object)],ta.prototype,"options",void 0);zh([(0,Yh.inject)(Jb.TYPES.ILogger),Xb("design:type",Object)],ta.prototype,"logger",void 0);ta=zh([(0,Yh.injectable)()],ta);Ri.AbstractUIExtension=ta});var lo=f(Mi=>{"use strict";var Zb=Mi&&Mi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},FO=Mi&&Mi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.DOMHelper=void 0;var Qb=_(),VO=P(),Fu=class{getPrefix(){return this.viewerOptions!==void 0&&this.viewerOptions.baseDiv!==void 0?this.viewerOptions.baseDiv+"_":""}createUniqueDOMElementId(e){return this.getPrefix()+e.id}findSModelIdByDOMElement(e){return e.id.replace(this.getPrefix(),"")}};Zb([(0,Qb.inject)(VO.TYPES.ViewerOptions),FO("design:type",Object)],Fu.prototype,"viewerOptions",void 0);Fu=Zb([(0,Qb.injectable)()],Fu);Mi.DOMHelper=Fu});var At=f(et=>{"use strict";var ho=et&&et.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Hu=et&&et.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Vu=et&&et.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(et,"__esModule",{value:!0});et.MousePositionTracker=et.MouseListener=et.PopupMouseTool=et.MouseTool=void 0;var Cn=_(),KO=ie(),HO=$(),zu=P(),zO=lo(),$t=Be(),fo=class{constructor(e=[]){this.mouseListeners=e}register(e){this.mouseListeners.push(e)}deregister(e){let t=this.mouseListeners.indexOf(e);t>=0&&this.mouseListeners.splice(t,1)}getTargetElement(e,t){let n=t.target,r=e.index;for(;n;){if(n.id){let o=r.getById(this.domHelper.findSModelIdByDOMElement(n));if(o!==void 0)return o}n=n.parentNode}}handleEvent(e,t,n){this.focusOnMouseEvent(e,t);let r=this.getTargetElement(t,n);if(!r)return;let o=this.mouseListeners.map(s=>s[e](r,n)).reduce((s,a)=>s.concat(a));if(o.length>0){n.preventDefault();for(let s of o)(0,KO.isAction)(s)?this.actionDispatcher.dispatch(s):s.then(a=>{this.actionDispatcher.dispatch(a)})}}focusOnMouseEvent(e,t){if(document&&e==="mouseDown"){let n=document.getElementById(this.domHelper.createUniqueDOMElementId(t));n!==null&&typeof n.focus=="function"&&n.focus()}}mouseOver(e,t){this.handleEvent("mouseOver",e,t)}mouseOut(e,t){this.handleEvent("mouseOut",e,t)}mouseEnter(e,t){this.handleEvent("mouseEnter",e,t)}mouseLeave(e,t){this.handleEvent("mouseLeave",e,t)}mouseDown(e,t){this.handleEvent("mouseDown",e,t)}mouseMove(e,t){this.handleEvent("mouseMove",e,t)}mouseUp(e,t){this.handleEvent("mouseUp",e,t)}wheel(e,t){this.handleEvent("wheel",e,t)}contextMenu(e,t){t.preventDefault(),this.handleEvent("contextMenu",e,t)}doubleClick(e,t){this.handleEvent("doubleClick",e,t)}decorate(e,t){return t instanceof HO.SModelRoot&&((0,$t.on)(e,"mouseover",this.mouseOver.bind(this,t)),(0,$t.on)(e,"mouseout",this.mouseOut.bind(this,t)),(0,$t.on)(e,"mouseenter",this.mouseEnter.bind(this,t)),(0,$t.on)(e,"mouseleave",this.mouseLeave.bind(this,t)),(0,$t.on)(e,"mousedown",this.mouseDown.bind(this,t)),(0,$t.on)(e,"mouseup",this.mouseUp.bind(this,t)),(0,$t.on)(e,"mousemove",this.mouseMove.bind(this,t)),(0,$t.on)(e,"wheel",this.wheel.bind(this,t)),(0,$t.on)(e,"contextmenu",this.contextMenu.bind(this,t)),(0,$t.on)(e,"dblclick",this.doubleClick.bind(this,t)),(0,$t.on)(e,"dragover",n=>this.handleEvent("dragOver",t,n)),(0,$t.on)(e,"drop",n=>this.handleEvent("drop",t,n))),e=this.mouseListeners.reduce((n,r)=>r.decorate(n,t),e),e}postUpdate(){}};ho([(0,Cn.inject)(zu.TYPES.IActionDispatcher),Hu("design:type",Object)],fo.prototype,"actionDispatcher",void 0);ho([(0,Cn.inject)(zu.TYPES.DOMHelper),Hu("design:type",zO.DOMHelper)],fo.prototype,"domHelper",void 0);fo=ho([(0,Cn.injectable)(),Vu(0,(0,Cn.multiInject)(zu.TYPES.MouseListener)),Vu(0,(0,Cn.optional)()),Hu("design:paramtypes",[Array])],fo);et.MouseTool=fo;var Uh=class extends fo{constructor(e=[]){super(e),this.mouseListeners=e}};Uh=ho([(0,Cn.injectable)(),Vu(0,(0,Cn.multiInject)(zu.TYPES.PopupMouseListener)),Vu(0,(0,Cn.optional)()),Hu("design:paramtypes",[Array])],Uh);et.PopupMouseTool=Uh;var Ku=class{mouseOver(e,t){return[]}mouseOut(e,t){return[]}mouseEnter(e,t){return[]}mouseLeave(e,t){return[]}mouseDown(e,t){return[]}mouseMove(e,t){return[]}mouseUp(e,t){return[]}wheel(e,t){return[]}doubleClick(e,t){return[]}contextMenu(e,t){return[]}dragOver(e,t){return[]}drop(e,t){return[]}decorate(e,t){return e}};Ku=ho([(0,Cn.injectable)()],Ku);et.MouseListener=Ku;var kh=class extends Ku{mouseMove(e,t){return this.lastPosition=e.root.parentToLocal({x:t.offsetX,y:t.offsetY}),[]}get lastPositionOnDiagram(){return this.lastPosition}};kh=ho([(0,Cn.injectable)()],kh);et.MousePositionTracker=kh});var po=f(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});function YO(i,e){return document.createElement(i,e)}function UO(i,e,t){return document.createElementNS(i,e,t)}function kO(){return gr(document.createDocumentFragment())}function GO(i){return document.createTextNode(i)}function $O(i){return document.createComment(i)}function WO(i,e,t){if(ei(i)){let n=i;for(;n&&ei(n);)n=gr(n).parent;i=n??i}ei(e)&&(e=gr(e,i)),t&&ei(t)&&(t=gr(t).firstChildNode),i.insertBefore(e,t)}function XO(i,e){i.removeChild(e)}function JO(i,e){ei(e)&&(e=gr(e,i)),i.appendChild(e)}function cS(i){if(ei(i)){for(;i&&ei(i);)i=gr(i).parent;return i??null}return i.parentNode}function ZO(i){var e;if(ei(i)){let t=gr(i),n=cS(t);if(n&&t.lastChildNode){let r=Array.from(n.childNodes),o=r.indexOf(t.lastChildNode);return(e=r[o+1])!==null&&e!==void 0?e:null}return null}return i.nextSibling}function QO(i){return i.tagName}function eA(i,e){i.textContent=e}function tA(i){return i.textContent}function nA(i){return i.nodeType===1}function iA(i){return i.nodeType===3}function rA(i){return i.nodeType===8}function ei(i){return i.nodeType===11}function gr(i,e){var t,n,r;let o=i;return(t=o.parent)!==null&&t!==void 0||(o.parent=e??null),(n=o.firstChildNode)!==null&&n!==void 0||(o.firstChildNode=i.firstChild),(r=o.lastChildNode)!==null&&r!==void 0||(o.lastChildNode=i.lastChild),o}var Zh={createElement:YO,createElementNS:UO,createTextNode:GO,createDocumentFragment:kO,createComment:$O,insertBefore:WO,removeChild:XO,appendChild:JO,parentNode:cS,nextSibling:ZO,tagName:QO,setTextContent:eA,getTextContent:tA,isElement:nA,isText:iA,isComment:rA,isDocumentFragment:ei};function lt(i,e,t,n,r){let o=e===void 0?void 0:e.key;return{sel:i,data:e,children:t,text:n,elm:r,key:o}}var ia=Array.isArray;function mr(i){return typeof i=="string"||typeof i=="number"||i instanceof String||i instanceof Number}function Gh(i){return i===void 0}function Et(i){return i!==void 0}var $h=lt("",{},[],void 0,void 0);function na(i,e){var t,n;let r=i.key===e.key,o=((t=i.data)===null||t===void 0?void 0:t.is)===((n=e.data)===null||n===void 0?void 0:n.is),s=i.sel===e.sel,a=!i.sel&&i.sel===e.sel?typeof i.text==typeof e.text:!0;return s&&r&&o&&a}function oA(){throw new Error("The document fragment is not supported on this platform.")}function sA(i,e){return i.isElement(e)}function aA(i,e){return i.isDocumentFragment(e)}function cA(i,e,t){var n;let r={};for(let o=e;o<=t;++o){let s=(n=i[o])===null||n===void 0?void 0:n.key;s!==void 0&&(r[s]=o)}return r}var uA=["create","update","remove","destroy","pre","post"];function dA(i,e,t){let n={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},r=e!==void 0?e:Zh;for(let v of uA)for(let m of i){let T=m[v];T!==void 0&&n[v].push(T)}function o(v){let m=v.id?"#"+v.id:"",T=v.getAttribute("class"),C=T?"."+T.split(" ").join("."):"";return lt(r.tagName(v).toLowerCase()+m+C,{},[],void 0,v)}function s(v){return lt(void 0,{},[],void 0,v)}function a(v,m){return function(){if(--m===0){let C=r.parentNode(v);r.removeChild(C,v)}}}function c(v,m){var T,C,H,G;let D,F=v.data;if(F!==void 0){let Y=(T=F.hook)===null||T===void 0?void 0:T.init;Et(Y)&&(Y(v),F=v.data)}let z=v.children,W=v.sel;if(W==="!")Gh(v.text)&&(v.text=""),v.elm=r.createComment(v.text);else if(W!==void 0){let Y=W.indexOf("#"),ae=W.indexOf(".",Y),Ie=Y>0?Y:W.length,he=ae>0?ae:W.length,be=Y!==-1||ae!==-1?W.slice(0,Math.min(Ie,he)):W,$e=v.elm=Et(F)&&Et(D=F.ns)?r.createElementNS(D,be,F):r.createElement(be,F);for(Ie<he&&$e.setAttribute("id",W.slice(Ie+1,he)),ae>0&&$e.setAttribute("class",W.slice(he+1).replace(/\./g," ")),D=0;D<n.create.length;++D)n.create[D]($h,v);if(ia(z))for(D=0;D<z.length;++D){let li=z[D];li!=null&&r.appendChild($e,c(li,m))}else mr(v.text)&&r.appendChild($e,r.createTextNode(v.text));let Sn=v.data.hook;Et(Sn)&&((C=Sn.create)===null||C===void 0||C.call(Sn,$h,v),Sn.insert&&m.push(v))}else if(!((H=t?.experimental)===null||H===void 0)&&H.fragments&&v.children){for(v.elm=((G=r.createDocumentFragment)!==null&&G!==void 0?G:oA)(),D=0;D<n.create.length;++D)n.create[D]($h,v);for(D=0;D<v.children.length;++D){let Y=v.children[D];Y!=null&&r.appendChild(v.elm,c(Y,m))}}else v.elm=r.createTextNode(v.text);return v.elm}function u(v,m,T,C,H,G){for(;C<=H;++C){let D=T[C];D!=null&&r.insertBefore(v,c(D,G),m)}}function d(v){var m,T;let C=v.data;if(C!==void 0){(T=(m=C?.hook)===null||m===void 0?void 0:m.destroy)===null||T===void 0||T.call(m,v);for(let H=0;H<n.destroy.length;++H)n.destroy[H](v);if(v.children!==void 0)for(let H=0;H<v.children.length;++H){let G=v.children[H];G!=null&&typeof G!="string"&&d(G)}}}function l(v,m,T,C){for(var H,G;T<=C;++T){let D,F,z=m[T];if(z!=null)if(Et(z.sel)){d(z),D=n.remove.length+1,F=a(z.elm,D);for(let Y=0;Y<n.remove.length;++Y)n.remove[Y](z,F);let W=(G=(H=z?.data)===null||H===void 0?void 0:H.hook)===null||G===void 0?void 0:G.remove;Et(W)?W(z,F):F()}else z.children?(d(z),l(v,z.children,0,z.children.length-1)):r.removeChild(v,z.elm)}}function S(v,m,T,C){let H=0,G=0,D=m.length-1,F=m[0],z=m[D],W=T.length-1,Y=T[0],ae=T[W],Ie,he,be,$e;for(;H<=D&&G<=W;)F==null?F=m[++H]:z==null?z=m[--D]:Y==null?Y=T[++G]:ae==null?ae=T[--W]:na(F,Y)?(R(F,Y,C),F=m[++H],Y=T[++G]):na(z,ae)?(R(z,ae,C),z=m[--D],ae=T[--W]):na(F,ae)?(R(F,ae,C),r.insertBefore(v,F.elm,r.nextSibling(z.elm)),F=m[++H],ae=T[--W]):na(z,Y)?(R(z,Y,C),r.insertBefore(v,z.elm,F.elm),z=m[--D],Y=T[++G]):(Ie===void 0&&(Ie=cA(m,H,D)),he=Ie[Y.key],Gh(he)?r.insertBefore(v,c(Y,C),F.elm):(be=m[he],be.sel!==Y.sel?r.insertBefore(v,c(Y,C),F.elm):(R(be,Y,C),m[he]=void 0,r.insertBefore(v,be.elm,F.elm))),Y=T[++G]);G<=W&&($e=T[W+1]==null?null:T[W+1].elm,u(v,$e,T,G,W,C)),H<=D&&l(v,m,H,D)}function R(v,m,T){var C,H,G,D,F,z,W,Y;let ae=(C=m.data)===null||C===void 0?void 0:C.hook;(H=ae?.prepatch)===null||H===void 0||H.call(ae,v,m);let Ie=m.elm=v.elm;if(v===m)return;if(m.data!==void 0||Et(m.text)&&m.text!==v.text){(G=m.data)!==null&&G!==void 0||(m.data={}),(D=v.data)!==null&&D!==void 0||(v.data={});for(let $e=0;$e<n.update.length;++$e)n.update[$e](v,m);(W=(z=(F=m.data)===null||F===void 0?void 0:F.hook)===null||z===void 0?void 0:z.update)===null||W===void 0||W.call(z,v,m)}let he=v.children,be=m.children;Gh(m.text)?Et(he)&&Et(be)?he!==be&&S(Ie,he,be,T):Et(be)?(Et(v.text)&&r.setTextContent(Ie,""),u(Ie,null,be,0,be.length-1,T)):Et(he)?l(Ie,he,0,he.length-1):Et(v.text)&&r.setTextContent(Ie,""):v.text!==m.text&&(Et(he)&&l(Ie,he,0,he.length-1),r.setTextContent(Ie,m.text)),(Y=ae?.postpatch)===null||Y===void 0||Y.call(ae,v,m)}return function(m,T){let C,H,G,D=[];for(C=0;C<n.pre.length;++C)n.pre[C]();for(sA(r,m)?m=o(m):aA(r,m)&&(m=s(m)),na(m,T)?R(m,T,D):(H=m.elm,G=r.parentNode(H),c(T,D),G!==null&&(r.insertBefore(G,T.elm,r.nextSibling(H)),l(G,[m],0,0))),C=0;C<D.length;++C)D[C].data.hook.insert(D[C]);for(C=0;C<n.post.length;++C)n.post[C]();return T}}function ku(i,e,t){if(i.ns="http://www.w3.org/2000/svg",t!=="foreignObject"&&e!==void 0)for(let n=0;n<e.length;++n){let r=e[n];if(typeof r=="string")continue;let o=r.data;o!==void 0&&ku(o,r.children,r.sel)}}function Uu(i,e,t){let n={},r,o,s;if(t!==void 0?(e!==null&&(n=e),ia(t)?r=t:mr(t)?o=t.toString():t&&t.sel&&(r=[t])):e!=null&&(ia(e)?r=e:mr(e)?o=e.toString():e&&e.sel?r=[e]:n=e),r!==void 0)for(s=0;s<r.length;++s)mr(r[s])&&(r[s]=lt(void 0,void 0,void 0,r[s],void 0));return i[0]==="s"&&i[1]==="v"&&i[2]==="g"&&(i.length===3||i[3]==="."||i[3]==="#")&&ku(n,r,i),lt(i,n,r,o,void 0)}function lA(i){let e,t;if(ia(i)?e=i:mr(e)?t=i:e&&e.sel&&(e=[i]),e!==void 0)for(let n=0;n<e.length;++n)mr(e[n])&&(e[n]=lt(void 0,void 0,void 0,e[n],void 0));return lt(void 0,{},e,t,void 0)}function Yu(i,e){var t;let n=(t=e.data)===null||t===void 0?void 0:t.ns;i.data.fn=e.data.fn,i.data.args=e.data.args,e.data=i.data,e.children=i.children,e.text=i.text,e.elm=i.elm,n&&ku(e.data,e.children,e.sel)}function fA(i){let e=i.data,t=e.fn(...e.args);Yu(t,i)}function hA(i,e){let t,n=i.data,r=e.data,o=n.args,s=r.args;if(n.fn!==r.fn||o.length!==s.length){Yu(r.fn(...s),e);return}for(t=0;t<s.length;++t)if(o[t]!==s[t]){Yu(r.fn(...s),e);return}Yu(i,e)}var pA=function(e,t,n,r){return r===void 0&&(r=n,n=t,t=void 0),Uu(e,{key:t,hook:{init:fA,prepatch:hA},fn:n,args:r})};function gA(i,e){let t=i.data.attachData;e.data.attachData.placeholder=t.placeholder,e.data.attachData.real=t.real,i.elm=i.data.attachData.real}function mA(i,e){e.elm=e.data.attachData.placeholder}function yA(i){i.elm!==void 0&&i.elm.parentNode.removeChild(i.elm),i.elm=i.data.attachData.real}function _A(i,e){let t=e.elm,n=e.data.attachData,r=document.createElement("span");e.elm=r,n.target.appendChild(t),n.real=t,n.placeholder=r}function vA(i,e){e.data===void 0&&(e.data={}),e.data.hook===void 0&&(e.data.hook={});let t=e.data,n=e.data.hook;return t.attachData={target:i,placeholder:void 0,real:void 0},n.create=_A,n.prepatch=gA,n.postpatch=mA,n.destroy=yA,e}function uS(i,e){let t=e!==void 0?e:Zh,n;if(t.isElement(i)){let r=i.id?"#"+i.id:"",o=i.getAttribute("class"),s=o?"."+o.split(" ").join("."):"",a=t.tagName(i).toLowerCase()+r+s,c={},u={},d={},l=[],S,R,v,m=i.attributes,T=i.childNodes;for(R=0,v=m.length;R<v;R++)S=m[R].nodeName,S[0]==="d"&&S[1]==="a"&&S[2]==="t"&&S[3]==="a"&&S[4]==="-"?u[S.slice(5)]=m[R].nodeValue||"":S!=="id"&&S!=="class"&&(c[S]=m[R].nodeValue);for(R=0,v=T.length;R<v;R++)l.push(uS(T[R],e));return Object.keys(c).length>0&&(d.attrs=c),Object.keys(u).length>0&&(d.dataset=u),a[0]==="s"&&a[1]==="v"&&a[2]==="g"&&(a.length===3||a[3]==="."||a[3]==="#")&&ku(d,l,a),lt(a,d,l,void 0,i)}else return t.isText(i)?(n=t.getTextContent(i),lt(void 0,void 0,void 0,n,i)):t.isComment(i)?(n=t.getTextContent(i),lt("!",{},[],n,i)):lt("",{},[],void 0,i)}var bA="http://www.w3.org/1999/xlink",SA="http://www.w3.org/XML/1998/namespace",eS=58,EA=120;function tS(i,e){let t,n=e.elm,r=i.data.attrs,o=e.data.attrs;if(!(!r&&!o)&&r!==o){r=r||{},o=o||{};for(t in o){let s=o[t];r[t]!==s&&(s===!0?n.setAttribute(t,""):s===!1?n.removeAttribute(t):t.charCodeAt(0)!==EA?n.setAttribute(t,s):t.charCodeAt(3)===eS?n.setAttributeNS(SA,t,s):t.charCodeAt(5)===eS?n.setAttributeNS(bA,t,s):n.setAttribute(t,s))}for(t in r)t in o||n.removeAttribute(t)}}var wA={create:tS,update:tS};function nS(i,e){let t,n,r=e.elm,o=i.data.class,s=e.data.class;if(!(!o&&!s)&&o!==s){o=o||{},s=s||{};for(n in o)o[n]&&!Object.prototype.hasOwnProperty.call(s,n)&&r.classList.remove(n);for(n in s)t=s[n],t!==o[n]&&r.classList[t?"add":"remove"](n)}}var PA={create:nS,update:nS},iS=/[A-Z]/g;function rS(i,e){let t=e.elm,n=i.data.dataset,r=e.data.dataset,o;if(!n&&!r||n===r)return;n=n||{},r=r||{};let s=t.dataset;for(o in n)r[o]||(s?o in s&&delete s[o]:t.removeAttribute("data-"+o.replace(iS,"-$&").toLowerCase()));for(o in r)n[o]!==r[o]&&(s?s[o]=r[o]:t.setAttribute("data-"+o.replace(iS,"-$&").toLowerCase(),r[o]))}var IA={create:rS,update:rS};function dS(i,e,t){if(typeof i=="function")i.call(e,t,e);else if(typeof i=="object")for(let n=0;n<i.length;n++)dS(i[n],e,t)}function RA(i,e){let t=i.type,n=e.data.on;n&&n[t]&&dS(n[t],e,i)}function MA(){return function i(e){RA(e,i.vnode)}}function Wh(i,e){let t=i.data.on,n=i.listener,r=i.elm,o=e&&e.data.on,s=e&&e.elm,a;if(t!==o){if(t&&n)if(o)for(a in t)o[a]||r.removeEventListener(a,n,!1);else for(a in t)r.removeEventListener(a,n,!1);if(o){let c=e.listener=i.listener||MA();if(c.vnode=e,t)for(a in o)t[a]||s.addEventListener(a,c,!1);else for(a in o)s.addEventListener(a,c,!1)}}}var TA={create:Wh,update:Wh,destroy:Wh};function oS(i,e){let t,n,r,o=e.elm,s=i.data.props,a=e.data.props;if(!(!s&&!a)&&s!==a){s=s||{},a=a||{};for(t in a)n=a[t],r=s[t],r!==n&&(t!=="value"||o[t]!==n)&&(o[t]=n)}}var OA={create:oS,update:oS},sS=typeof window<"u"&&window.requestAnimationFrame.bind(window)||setTimeout,AA=function(i){sS(function(){sS(i)})},Xh=!1;function CA(i,e,t){AA(function(){i[e]=t})}function aS(i,e){let t,n,r=e.elm,o=i.data.style,s=e.data.style;if(!o&&!s||o===s)return;o=o||{},s=s||{};let a="delayed"in o;for(n in o)s[n]||(n[0]==="-"&&n[1]==="-"?r.style.removeProperty(n):r.style[n]="");for(n in s)if(t=s[n],n==="delayed"&&s.delayed)for(let c in s.delayed)t=s.delayed[c],(!a||t!==o.delayed[c])&&CA(r.style,c,t);else n!=="remove"&&t!==o[n]&&(n[0]==="-"&&n[1]==="-"?r.style.setProperty(n,t):r.style[n]=t)}function xA(i){let e,t,n=i.elm,r=i.data.style;if(!(!r||!(e=r.destroy)))for(t in e)n.style[t]=e[t]}function qA(i,e){let t=i.data.style;if(!t||!t.remove){e();return}Xh||(i.elm.offsetLeft,Xh=!0);let n,r=i.elm,o=0,s=t.remove,a=0,c=[];for(n in s)c.push(n),r.style[n]=s[n];let d=getComputedStyle(r)["transition-property"].split(", ");for(;o<d.length;++o)c.indexOf(d[o])!==-1&&a++;r.addEventListener("transitionend",function(l){l.target===r&&--a,a===0&&e()})}function DA(){Xh=!1}var jA={pre:DA,create:aS,update:aS,destroy:xA,remove:qA};function NA(i,...e){let t=Qh(e,[]);return t.length===1&&!t[0].sel&&t[0].text?lt(void 0,void 0,void 0,t[0].text,void 0):lt(void 0,i??{},t,void 0,void 0)}function Qh(i,e){for(let t of i)t!=null&&t!==!1&&t!==""&&(Array.isArray(t)?Qh(t,e):typeof t=="string"||typeof t=="number"||typeof t=="boolean"?e.push(lt(void 0,void 0,void 0,String(t),void 0)):e.push(t));return e}function Jh(i,e,...t){let n=Qh(t,[]);return typeof i=="function"?i(e,n):n.length===1&&!n[0].sel&&n[0].text?Uu(i,e,n[0].text):Uu(i,e,n)}(function(i){})(Jh||(Jh={}));Re.Fragment=NA;Re.array=ia;Re.attachTo=vA;Re.attributesModule=wA;Re.classModule=PA;Re.datasetModule=IA;Re.eventListenersModule=TA;Re.fragment=lA;Re.h=Uu;Re.htmlDomApi=Zh;Re.init=dA;Re.jsx=Jh;Re.primitive=mr;Re.propsModule=OA;Re.styleModule=jA;Re.thunk=pA;Re.toVNode=uS;Re.vnode=lt});var tp=f(Ti=>{"use strict";var LA=Ti&&Ti.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ti,"__esModule",{value:!0});Ti.isThunk=Ti.ThunkView=void 0;var BA=po(),FA=_(),ep=class{render(e,t){return(0,BA.h)(this.selector(e),{key:e.id,hook:{init:this.init.bind(this),prepatch:this.prepatch.bind(this)},fn:()=>this.renderAndDecorate(e,t),args:this.watchedArgs(e),thunk:!0})}renderAndDecorate(e,t){let n=this.doRender(e,t);return t.decorate(n,e),n}copyToThunk(e,t){t.elm=e.elm,e.data.fn=t.data.fn,e.data.args=t.data.args,t.data=e.data,t.children=e.children,t.text=e.text,t.elm=e.elm}init(e){let t=e.data,n=t.fn.apply(void 0,t.args);this.copyToThunk(n,e)}prepatch(e,t){let n=e.data,r=t.data;this.equals(n.args,r.args)?this.copyToThunk(e,t):this.copyToThunk(r.fn.apply(void 0,r.args),t)}equals(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<t.length;++n)if(!this.equals(e[n],t[n]))return!1}else if(typeof e=="object"&&typeof t=="object"){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(n!=="parent"&&n!=="root"&&(!(n in t)||!this.equals(e[n],t[n])))return!1}else if(e!==t)return!1;return!0}};ep=LA([(0,FA.injectable)()],ep);Ti.ThunkView=ep;function VA(i){return"thunk"in i}Ti.isThunk=VA});var Wt=f(Oi=>{"use strict";Object.defineProperty(Oi,"__esModule",{value:!0});Oi.JSX=Oi.svg=Oi.html=void 0;var KA=po(),HA=["hook","on","style","class","props","attrs","dataset"],zA="http://www.w3.org/2000/svg";function YA(i,e,t){let n={};if(t&&(n.ns=t),i===null)return n;return HA.forEach(o=>{i[o]&&(n[o]=i[o])}),Object.keys(i).forEach(o=>{if(o==="key"||o==="classNames"||o==="selector")return;let s=o.indexOf("-");s>0?r(o.slice(0,s),o.slice(s+1),i[o]):n[o]||r(e,o,i[o])}),n;function r(o,s,a){let c=n[o]||(n[o]={});c[s]=a}}function np(i,e="props"){return(t,n,...r)=>(0,KA.jsx)(t,YA(n,e,i),r)}Oi.JSX=np;var UA=np();Oi.html=UA;var kA=np(zA,"attrs");Oi.svg=kA});var go=f(Me=>{"use strict";var rp=Me&&Me.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},GA=Me&&Me.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},lS=Me&&Me.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Me,"__esModule",{value:!0});Me.MissingView=Me.EmptyView=Me.configureView=Me.configureModelElement=Me.ViewRegistry=Me.findArgValue=void 0;var fS=Wt(),ra=_(),hS=P(),$A=Mn(),WA=cr(),XA=Tn(),JA=ze(),ZA=hr();function QA(i,e){for(;i!==void 0&&!(e in i)&&i.parentArgs;)i=i.parentArgs;return i?i[e]:void 0}Me.findArgValue=QA;var ip=class extends $A.InstanceRegistry{constructor(e){super(),this.registerDefaults(),e.forEach(t=>this.register(t.type,t.factory()))}registerDefaults(){this.register(XA.EMPTY_ROOT.type,new Gu)}missing(e){return new $u}};ip=rp([(0,ra.injectable)(),lS(0,(0,ra.multiInject)(hS.TYPES.ViewRegistration)),lS(0,(0,ra.optional)()),GA("design:paramtypes",[Array])],ip);Me.ViewRegistry=ip;function eC(i,e,t,n,r){(0,JA.registerModelElement)(i,e,t,r),pS(i,e,n)}Me.configureModelElement=eC;function pS(i,e,t){if(typeof t=="function"){if(!(0,WA.isInjectable)(t))throw new Error(`Views should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(hS.TYPES.ViewRegistration).toDynamicValue(n=>({type:e,factory:()=>n.container.get(t)}))}Me.configureView=pS;var Gu=class{render(e,t){return(0,fS.svg)("svg",{"class-sprotty-empty":!0})}};Gu=rp([(0,ra.injectable)()],Gu);Me.EmptyView=Gu;var $u=class{render(e,t){let n=e.position||ZA.Point.ORIGIN;return(0,fS.svg)("text",{"class-sprotty-missing":!0,x:n.x,y:n.y},"?",e.id,"?")}};$u=rp([(0,ra.injectable)()],$u);Me.MissingView=$u});var ap=f(Ai=>{"use strict";var op=Ai&&Ai.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gS=Ai&&Ai.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ai,"__esModule",{value:!0});Ai.ViewerCache=void 0;var sp=_(),mS=P(),tC=Qr(),oa=class{update(e,t){if(t!==void 0)this.delegate.update(e,t),this.cachedModel=void 0;else{let n=this.cachedModel===void 0;this.cachedModel=e,n&&this.scheduleUpdate()}}scheduleUpdate(){this.syncer.onEndOfNextFrame(()=>{this.cachedModel&&(this.delegate.update(this.cachedModel),this.cachedModel=void 0)})}};op([(0,sp.inject)(mS.TYPES.IViewer),gS("design:type",Object)],oa.prototype,"delegate",void 0);op([(0,sp.inject)(mS.TYPES.AnimationFrameSyncer),gS("design:type",tC.AnimationFrameSyncer)],oa.prototype,"syncer",void 0);oa=op([(0,sp.injectable)()],oa);Ai.ViewerCache=oa});var cp=f(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.overrideViewerOptions=ti.configureViewerOptions=ti.defaultViewerOptions=void 0;var nC=En(),Wu=P(),iC=()=>({baseDiv:"sprotty",baseClass:"sprotty",hiddenDiv:"sprotty-hidden",hiddenClass:"sprotty-hidden",popupDiv:"sprotty-popup",popupClass:"sprotty-popup",popupClosedClass:"sprotty-popup-closed",needsClientLayout:!0,needsServerLayout:!1,popupOpenDelay:1e3,popupCloseDelay:300});ti.defaultViewerOptions=iC;function rC(i,e){let t=Object.assign(Object.assign({},(0,ti.defaultViewerOptions)()),e);i.isBound(Wu.TYPES.ViewerOptions)?i.rebind(Wu.TYPES.ViewerOptions).toConstantValue(t):i.bind(Wu.TYPES.ViewerOptions).toConstantValue(t)}ti.configureViewerOptions=rC;function oC(i,e){let t=i.get(Wu.TYPES.ViewerOptions);return(0,nC.safeAssign)(t,e),t}ti.overrideViewerOptions=oC});var up=f(Fe=>{"use strict";var ln=Fe&&Fe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},fn=Fe&&Fe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Xt=Fe&&Fe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.PopupModelViewer=Fe.HiddenModelViewer=Fe.ModelViewer=Fe.PatcherProvider=Fe.ModelRenderer=void 0;var ye=_(),mo=po(),sa=Wt(),sC=On(),aC=Ws(),yS=Tn(),tt=P(),cC=tp(),Ct=Be(),aa=class{constructor(e,t,n,r={}){this.viewRegistry=e,this.targetKind=t,this.postprocessors=n,this.args=r}decorate(e,t){return(0,cC.isThunk)(e)?e:this.postprocessors.reduce((n,r)=>r.decorate(n,t),e)}renderElement(e){let n=this.viewRegistry.get(e.type).render(e,this,this.args);if(n)return this.decorate(n,e)}renderChildren(e,t){let n=t?new aa(this.viewRegistry,this.targetKind,this.postprocessors,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map(r=>n.renderElement(r)).filter(r=>r!==void 0)}postUpdate(e){this.postprocessors.forEach(t=>t.postUpdate(e))}};Fe.ModelRenderer=aa;var yo=class{constructor(){this.patcher=(0,mo.init)(this.createModules())}createModules(){return[mo.propsModule,mo.attributesModule,mo.classModule,mo.styleModule,mo.eventListenersModule]}};yo=ln([(0,ye.injectable)(),fn("design:paramtypes",[])],yo);Fe.PatcherProvider=yo;var _o=class{constructor(e,t,n){this.renderer=e("main",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering",e);let n=(0,sa.html)("div",{id:this.options.baseDiv},this.renderer.renderElement(e));if(this.lastVDOM!==void 0){let r=this.hasFocus();(0,Ct.copyClassesFromVNode)(this.lastVDOM,n),this.lastVDOM=this.patcher.call(this,this.lastVDOM,n),this.restoreFocus(r)}else if(typeof document<"u"){let r=document.getElementById(this.options.baseDiv);r!==null?(typeof window<"u"&&window.addEventListener("resize",()=>{this.onWindowResize(n)}),(0,Ct.copyClassesFromElement)(r,n),(0,Ct.setClass)(n,this.options.baseClass,!0),this.lastVDOM=this.patcher.call(this,r,n)):this.logger.error(this,"element not in DOM:",this.options.baseDiv)}this.renderer.postUpdate(t)}hasFocus(){if(typeof document<"u"&&document.activeElement&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let e=this.lastVDOM.children[0];if(typeof e=="object"){let t=e.elm;return document.activeElement===t}}return!1}restoreFocus(e){if(e&&this.lastVDOM.children&&this.lastVDOM.children.length>0){let t=this.lastVDOM.children[0];if(typeof t=="object"){let n=t.elm;n&&typeof n.focus=="function"&&n.focus()}}}onWindowResize(e){let t=document.getElementById(this.options.baseDiv);if(t!==null){let n=this.getBoundsInPage(t);this.actiondispatcher.dispatch(aC.InitializeCanvasBoundsAction.create(n))}}getBoundsInPage(e){let t=e.getBoundingClientRect(),n=(0,sC.getWindowScroll)();return{x:t.left+n.x,y:t.top+n.y,width:t.width,height:t.height}}};ln([(0,ye.inject)(tt.TYPES.ViewerOptions),fn("design:type",Object)],_o.prototype,"options",void 0);ln([(0,ye.inject)(tt.TYPES.ILogger),fn("design:type",Object)],_o.prototype,"logger",void 0);ln([(0,ye.inject)(tt.TYPES.IActionDispatcher),fn("design:type",Object)],_o.prototype,"actiondispatcher",void 0);_o=ln([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.IVNodePostprocessor)),Xt(2,(0,ye.optional)()),fn("design:paramtypes",[Function,yo,Array])],_o);Fe.ModelViewer=_o;var ca=class{constructor(e,t,n){this.hiddenRenderer=e("hidden",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering hidden");let n;if(e.type===yS.EMPTY_ROOT.type)n=(0,sa.html)("div",{id:this.options.hiddenDiv});else{let r=this.hiddenRenderer.renderElement(e);r&&(0,Ct.setAttr)(r,"opacity",0),n=(0,sa.html)("div",{id:this.options.hiddenDiv},r)}if(this.lastHiddenVDOM!==void 0)(0,Ct.copyClassesFromVNode)(this.lastHiddenVDOM,n),this.lastHiddenVDOM=this.patcher.call(this,this.lastHiddenVDOM,n);else{let r=document.getElementById(this.options.hiddenDiv);r===null?(r=document.createElement("div"),document.body.appendChild(r)):(0,Ct.copyClassesFromElement)(r,n),(0,Ct.setClass)(n,this.options.baseClass,!0),(0,Ct.setClass)(n,this.options.hiddenClass,!0),this.lastHiddenVDOM=this.patcher.call(this,r,n)}this.hiddenRenderer.postUpdate(t)}};ln([(0,ye.inject)(tt.TYPES.ViewerOptions),fn("design:type",Object)],ca.prototype,"options",void 0);ln([(0,ye.inject)(tt.TYPES.ILogger),fn("design:type",Object)],ca.prototype,"logger",void 0);ca=ln([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.HiddenVNodePostprocessor)),Xt(2,(0,ye.optional)()),fn("design:paramtypes",[Function,yo,Array])],ca);Fe.HiddenModelViewer=ca;var ua=class{constructor(e,t,n){this.modelRendererFactory=e,this.popupRenderer=this.modelRendererFactory("popup",n),this.patcher=t.patcher}update(e,t){this.logger.log(this,"rendering popup",e);let n=e.type===yS.EMPTY_ROOT.type,r;if(n)r=(0,sa.html)("div",{id:this.options.popupDiv});else{let o=e.canvasBounds,s={top:o.y+"px",left:o.x+"px"};r=(0,sa.html)("div",{id:this.options.popupDiv,style:s},this.popupRenderer.renderElement(e))}if(this.lastPopupVDOM!==void 0)(0,Ct.copyClassesFromVNode)(this.lastPopupVDOM,r),(0,Ct.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,this.lastPopupVDOM,r);else if(typeof document<"u"){let o=document.getElementById(this.options.popupDiv);o===null?(o=document.createElement("div"),document.body.appendChild(o)):(0,Ct.copyClassesFromElement)(o,r),(0,Ct.setClass)(r,this.options.popupClass,!0),(0,Ct.setClass)(r,this.options.popupClosedClass,n),this.lastPopupVDOM=this.patcher.call(this,o,r)}this.popupRenderer.postUpdate(t)}};ln([(0,ye.inject)(tt.TYPES.ViewerOptions),fn("design:type",Object)],ua.prototype,"options",void 0);ln([(0,ye.inject)(tt.TYPES.ILogger),fn("design:type",Object)],ua.prototype,"logger",void 0);ua=ln([(0,ye.injectable)(),Xt(0,(0,ye.inject)(tt.TYPES.ModelRendererFactory)),Xt(1,(0,ye.inject)(tt.TYPES.PatcherProvider)),Xt(2,(0,ye.multiInject)(tt.TYPES.PopupVNodePostprocessor)),Xt(2,(0,ye.optional)()),fn("design:paramtypes",[Function,yo,Array])],ua);Fe.PopupModelViewer=ua});var lp=f(vo=>{"use strict";var uC=vo&&vo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(vo,"__esModule",{value:!0});vo.FocusFixPostprocessor=void 0;var dC=_(),lC=Be(),dp=class{decorate(e,t){return e.sel&&e.sel.startsWith("svg")&&(0,lC.setAttr)(e,"tabindex",0),e}postUpdate(){}};dp=uC([(0,dC.injectable)()],dp);vo.FocusFixPostprocessor=dp});var Zu=f(xt=>{"use strict";var Xu=xt&&xt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},_S=xt&&xt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xt,"__esModule",{value:!0});xt.ConsoleLogger=xt.NullLogger=xt.LogLevel=void 0;var Ju=_(),vS=P(),yr;(function(i){i[i.none=0]="none",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i[i.log=4]="log"})(yr=xt.LogLevel||(xt.LogLevel={}));var fp=class{constructor(){this.logLevel=yr.none}error(e,t,...n){}warn(e,t,...n){}info(e,t,...n){}log(e,t,...n){}};fp=Xu([(0,Ju.injectable)()],fp);xt.NullLogger=fp;var da=class{constructor(){this.logLevel=yr.log,this.viewOptions={baseDiv:""}}error(e,t,...n){if(this.logLevel>=yr.error)try{console.error.apply(e,this.consoleArguments(e,t,n))}catch{}}warn(e,t,...n){if(this.logLevel>=yr.warn)try{console.warn.apply(e,this.consoleArguments(e,t,n))}catch{}}info(e,t,...n){if(this.logLevel>=yr.info)try{console.info.apply(e,this.consoleArguments(e,t,n))}catch{}}log(e,t,...n){if(this.logLevel>=yr.log)try{console.log.apply(e,this.consoleArguments(e,t,n))}catch{}}consoleArguments(e,t,n){let r;return typeof e=="object"?r=e.constructor.name:r=e,[new Date().toLocaleTimeString()+" "+this.viewOptions.baseDiv+" "+r+": "+t,...n]}};Xu([(0,Ju.inject)(vS.TYPES.LogLevel),_S("design:type",Number)],da.prototype,"logLevel",void 0);Xu([(0,Ju.inject)(vS.TYPES.ViewerOptions),_S("design:type",Object)],da.prototype,"viewOptions",void 0);da=Xu([(0,Ju.injectable)()],da);xt.ConsoleLogger=da});var ES=f(Ci=>{"use strict";var hp=Ci&&Ci.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},bS=Ci&&Ci.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.IdPostprocessor=void 0;var pp=_(),SS=P(),fC=lo(),hC=Be(),la=class{decorate(e,t){let n=(0,hC.getAttrs)(e);return n.id!==void 0&&this.logger.warn(e,"Overriding id of vnode ("+n.id+"). Make sure not to set it manually in view."),n.id=this.domHelper.createUniqueDOMElementId(t),e.key||(e.key=t.id),e}postUpdate(){}};hp([(0,pp.inject)(SS.TYPES.ILogger),bS("design:type",Object)],la.prototype,"logger",void 0);hp([(0,pp.inject)(SS.TYPES.DOMHelper),bS("design:type",fC.DOMHelper)],la.prototype,"domHelper",void 0);la=hp([(0,pp.injectable)()],la);Ci.IdPostprocessor=la});var PS=f(bo=>{"use strict";var pC=bo&&bo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(bo,"__esModule",{value:!0});bo.CssClassPostprocessor=void 0;var gC=Pi(),wS=Be(),mC=_(),gp=class{decorate(e,t){if(t.cssClasses)for(let r of t.cssClasses)(0,wS.setClass)(e,r,!0);let n=(0,gC.getSubType)(t);return n&&n!==t.type&&(0,wS.setClass)(e,n,!0),e}postUpdate(){}};gp=pC([(0,mC.injectable)()],gp);bo.CssClassPostprocessor=gp});var vp=f(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});var yC=_(),B=P(),mp=Ws(),IS=Zu(),_C=gu(),Qu=ks(),vC=wh(),RS=Tn(),bC=Qr(),xi=up(),SC=cp(),So=At(),MS=dn(),TS=lp(),EC=go(),ed=ap(),wC=lo(),td=ES(),nd=_t(),yp=PS(),Eo=Bh(),OS=xu(),PC=Cu(),AS=ea(),IC=fh(),RC=new yC.ContainerModule((i,e,t)=>{i(B.TYPES.ILogger).to(IS.NullLogger).inSingletonScope(),i(B.TYPES.LogLevel).toConstantValue(IS.LogLevel.warn),i(B.TYPES.SModelRegistry).to(RS.SModelRegistry).inSingletonScope(),i(Qu.ActionHandlerRegistry).toSelf().inSingletonScope(),i(B.TYPES.ActionHandlerRegistryProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(Qu.ActionHandlerRegistry))})),i(B.TYPES.ViewRegistry).to(EC.ViewRegistry).inSingletonScope(),i(B.TYPES.IModelFactory).to(RS.SModelFactory).inSingletonScope(),i(B.TYPES.IActionDispatcher).to(_C.ActionDispatcher).inSingletonScope(),i(B.TYPES.IActionDispatcherProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.IActionDispatcher))})),i(B.TYPES.IDiagramLocker).to(IC.DefaultDiagramLocker).inSingletonScope(),i(B.TYPES.IActionHandlerInitializer).to(nd.CommandActionHandlerInitializer),i(B.TYPES.ICommandStack).to(vC.CommandStack).inSingletonScope(),i(B.TYPES.ICommandStackProvider).toProvider(r=>()=>new Promise(o=>{o(r.container.get(B.TYPES.ICommandStack))})),i(B.TYPES.CommandStackOptions).toConstantValue({defaultDuration:250,undoHistoryLimit:50}),i(xi.ModelViewer).toSelf().inSingletonScope(),i(xi.HiddenModelViewer).toSelf().inSingletonScope(),i(xi.PopupModelViewer).toSelf().inSingletonScope(),i(B.TYPES.ModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(xi.ModelViewer),o.bind(ed.ViewerCache).toSelf(),o.get(ed.ViewerCache)}).inSingletonScope(),i(B.TYPES.PopupModelViewer).toDynamicValue(r=>{let o=r.container.createChild();return o.bind(B.TYPES.IViewer).toService(xi.PopupModelViewer),o.bind(ed.ViewerCache).toSelf(),o.get(ed.ViewerCache)}).inSingletonScope(),i(B.TYPES.HiddenModelViewer).toService(xi.HiddenModelViewer),i(B.TYPES.IViewerProvider).toDynamicValue(r=>({get modelViewer(){return r.container.get(B.TYPES.ModelViewer)},get hiddenModelViewer(){return r.container.get(B.TYPES.HiddenModelViewer)},get popupModelViewer(){return r.container.get(B.TYPES.PopupModelViewer)}})),i(B.TYPES.ViewerOptions).toConstantValue((0,SC.defaultViewerOptions)()),i(B.TYPES.PatcherProvider).to(xi.PatcherProvider).inSingletonScope(),i(B.TYPES.DOMHelper).to(wC.DOMHelper).inSingletonScope(),i(B.TYPES.ModelRendererFactory).toFactory(r=>(o,s,a={})=>{let c=r.container.get(B.TYPES.ViewRegistry);return new xi.ModelRenderer(c,o,s,a)}),i(td.IdPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(td.IdPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(td.IdPostprocessor),i(yp.CssClassPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(yp.CssClassPostprocessor),i(B.TYPES.HiddenVNodePostprocessor).toService(yp.CssClassPostprocessor),i(So.MouseTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(So.MouseTool),i(MS.KeyTool).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(MS.KeyTool),i(TS.FocusFixPostprocessor).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(TS.FocusFixPostprocessor),i(B.TYPES.PopupVNodePostprocessor).toService(td.IdPostprocessor),i(So.PopupMouseTool).toSelf().inSingletonScope(),i(B.TYPES.PopupVNodePostprocessor).toService(So.PopupMouseTool),i(B.TYPES.AnimationFrameSyncer).to(bC.AnimationFrameSyncer).inSingletonScope();let n={bind:i,isBound:t};(0,nd.configureCommand)(n,mp.InitializeCanvasBoundsCommand),i(mp.CanvasBoundsInitializer).toSelf().inSingletonScope(),i(B.TYPES.IVNodePostprocessor).toService(mp.CanvasBoundsInitializer),(0,nd.configureCommand)(n,PC.SetModelCommand),i(B.TYPES.IToolManager).to(Eo.ToolManager).inSingletonScope(),i(Eo.DefaultToolsEnablingKeyListener).toSelf().inSingletonScope(),i(B.TYPES.KeyListener).toService(Eo.DefaultToolsEnablingKeyListener),i(Eo.ToolManagerActionHandler).toSelf().inSingletonScope(),(0,Qu.configureActionHandler)(n,OS.EnableDefaultToolsAction.KIND,Eo.ToolManagerActionHandler),(0,Qu.configureActionHandler)(n,OS.EnableToolsAction.KIND,Eo.ToolManagerActionHandler),i(B.TYPES.UIExtensionRegistry).to(AS.UIExtensionRegistry).inSingletonScope(),(0,nd.configureCommand)(n,AS.SetUIExtensionVisibilityCommand),i(So.MousePositionTracker).toSelf().inSingletonScope(),i(B.TYPES.MouseListener).toService(So.MousePositionTracker)});_p.default=RC});var ue=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.SShapeElement=Q.findChildrenAtPosition=Q.getAbsoluteClientBounds=Q.getAbsoluteBounds=Q.isAlignable=Q.isSizeable=Q.isLayoutableChild=Q.isLayoutContainer=Q.isBoundsAware=Q.alignFeature=Q.layoutableChildFeature=Q.layoutContainerFeature=Q.boundsFeature=void 0;var wo=ee(),id=$(),MC=ze(),TC=On();Q.boundsFeature=Symbol("boundsFeature");Q.layoutContainerFeature=Symbol("layoutContainerFeature");Q.layoutableChildFeature=Symbol("layoutableChildFeature");Q.alignFeature=Symbol("alignFeature");function Po(i){return"bounds"in i}Q.isBoundsAware=Po;function OC(i){return Po(i)&&i.hasFeature(Q.layoutContainerFeature)&&"layout"in i}Q.isLayoutContainer=OC;function AC(i){return Po(i)&&i.hasFeature(Q.layoutableChildFeature)}Q.isLayoutableChild=AC;function CC(i){return i.hasFeature(Q.boundsFeature)&&Po(i)}Q.isSizeable=CC;function xC(i){return i.hasFeature(Q.alignFeature)&&"alignment"in i}Q.isAlignable=xC;function qC(i){let e=(0,MC.findParentByFeature)(i,Po);if(e!==void 0){let t=e.bounds,n=e;for(;n instanceof id.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}else if(i instanceof id.SModelRoot){let t=i.canvasBounds;return{x:0,y:0,width:t.width,height:t.height}}else return wo.Bounds.EMPTY}Q.getAbsoluteBounds=qC;function DC(i,e,t){let n=0,r=0,o=0,s=0,a=e.createUniqueDOMElementId(i),c=document.getElementById(a);if(c){let d=c.getBoundingClientRect(),l=(0,TC.getWindowScroll)();n=d.left+l.x,r=d.top+l.y,o=d.width,s=d.height}let u=document.getElementById(t.baseDiv);if(u)for(;u.offsetParent instanceof HTMLElement&&(u=u.offsetParent);)n-=u.offsetLeft,r-=u.offsetTop;return{x:n,y:r,width:o,height:s}}Q.getAbsoluteClientBounds=DC;function jC(i,e){let t=[];return CS(i,e,t),t}Q.findChildrenAtPosition=jC;function CS(i,e,t){i.children.forEach(n=>{if(Po(n)&&wo.Bounds.includes(n.bounds,e)&&t.push(n),n instanceof id.SParentElement){let r=n.parentToLocal(e);CS(n,r,t)}})}var bp=class extends id.SChildElement{constructor(){super(...arguments),this.position=wo.Point.ORIGIN,this.size=wo.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:e.x+this.position.x,y:e.y+this.position.y,width:-1,height:-1};return(0,wo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}parentToLocal(e){let t={x:e.x-this.position.x,y:e.y-this.position.y,width:-1,height:-1};return(0,wo.isBounds)(e)&&(t.width=e.width,t.height=e.height),t}};Q.SShapeElement=bp});var ad=f(de=>{"use strict";var NC=de&&de.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),LC=de&&de.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),xS=de&&de.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},BC=de&&de.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&NC(e,i,t);return LC(e,i),e},qS=de&&de.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},DS=de&&de.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(de,"__esModule",{value:!0});de.RequestBoundsCommand=de.SetBoundsCommand=de.LayoutAction=de.ComputedBoundsAction=de.RequestBoundsAction=de.SetBoundsAction=void 0;var rd=_(),FC=ie(),jS=BC(ie()),NS=me(),LS=P(),VC=ue(),Io=class{constructor(e){this.bounds=e,this.kind=Io.KIND}};de.SetBoundsAction=Io;Io.KIND="setBounds";var _r=class{constructor(e,t=""){this.newRoot=e,this.requestId=t,this.kind=_r.KIND}static create(e){return new _r(e,(0,FC.generateRequestId)())}};de.RequestBoundsAction=_r;_r.KIND="requestBounds";var vr=class{constructor(e,t,n,r=""){this.bounds=e,this.revision=t,this.alignments=n,this.responseId=r,this.kind=vr.KIND}};de.ComputedBoundsAction=vr;vr.KIND="computedBounds";var Ro=class{constructor(){this.kind=Ro.KIND}};de.LayoutAction=Ro;Ro.KIND="layout";var od=class extends NS.SystemCommand{constructor(e){super(),this.action=e,this.bounds=[]}execute(e){return this.action.bounds.forEach(t=>{let n=e.root.index.getById(t.elementId);n&&(0,VC.isBoundsAware)(n)&&this.bounds.push({element:n,oldBounds:n.bounds,newPosition:t.newPosition,newSize:t.newSize})}),this.redo(e)}undo(e){return this.bounds.forEach(t=>t.element.bounds=t.oldBounds),e.root}redo(e){return this.bounds.forEach(t=>{t.newPosition?t.element.bounds=Object.assign(Object.assign({},t.newPosition),t.newSize):t.element.bounds=Object.assign({x:t.element.bounds.x,y:t.element.bounds.y},t.newSize)}),e.root}};od.KIND=jS.SetBoundsAction.KIND;od=xS([(0,rd.injectable)(),DS(0,(0,rd.inject)(LS.TYPES.Action)),qS("design:paramtypes",[Object])],od);de.SetBoundsCommand=od;var sd=class extends NS.HiddenCommand{constructor(e){super(),this.action=e}execute(e){return{model:e.modelFactory.createRoot(this.action.newRoot),modelChanged:!0,cause:this.action}}get blockUntil(){return e=>e.kind===vr.KIND}};sd.KIND=jS.RequestBoundsAction.KIND;sd=xS([(0,rd.injectable)(),DS(0,(0,rd.inject)(LS.TYPES.Action)),qS("design:paramtypes",[Object])],sd);de.RequestBoundsCommand=sd});var dd=f(nt=>{"use strict";var pa=nt&&nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ud=nt&&nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},BS=nt&&nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(nt,"__esModule",{value:!0});nt.configureLayout=nt.StatefulLayouter=nt.Layouter=nt.LayoutRegistry=void 0;var br=_(),KC=ee(),ga=P(),HC=Mn(),FS=ue(),zC=cr(),fa=class extends HC.InstanceRegistry{constructor(e=[]){super(),e.forEach(t=>{this.hasKey(t.layoutKind)?this.logger.warn("Layout kind is already defined: ",t.layoutKind):this.register(t.layoutKind,t.factory())})}};pa([(0,br.inject)(ga.TYPES.ILogger),ud("design:type",Object)],fa.prototype,"logger",void 0);fa=pa([(0,br.injectable)(),BS(0,(0,br.multiInject)(ga.TYPES.LayoutRegistration)),BS(0,(0,br.optional)()),ud("design:paramtypes",[Array])],fa);nt.LayoutRegistry=fa;var ha=class{layout(e){new cd(e,this.layoutRegistry,this.logger).layout()}};pa([(0,br.inject)(ga.TYPES.LayoutRegistry),ud("design:type",fa)],ha.prototype,"layoutRegistry",void 0);pa([(0,br.inject)(ga.TYPES.ILogger),ud("design:type",Object)],ha.prototype,"logger",void 0);ha=pa([(0,br.injectable)()],ha);nt.Layouter=ha;var cd=class{constructor(e,t,n){this.element2boundsData=e,this.layoutRegistry=t,this.log=n,this.toBeLayouted=[],e.forEach((r,o)=>{(0,FS.isLayoutContainer)(o)&&this.toBeLayouted.push(o)})}getBoundsData(e){let t=this.element2boundsData.get(e),n=e.bounds;return(0,FS.isLayoutContainer)(e)&&this.toBeLayouted.indexOf(e)>=0&&(n=this.doLayout(e)),t||(t={bounds:n,boundsChanged:!1,alignmentChanged:!1},this.element2boundsData.set(e,t)),t}layout(){for(;this.toBeLayouted.length>0;){let e=this.toBeLayouted[0];this.doLayout(e)}}doLayout(e){let t=this.toBeLayouted.indexOf(e);t>=0&&this.toBeLayouted.splice(t,1);let n=this.layoutRegistry.get(e.layout);n&&n.layout(e,this);let r=this.element2boundsData.get(e);return r!==void 0&&r.bounds!==void 0?r.bounds:(this.log.error(e,"Layout failed"),KC.Bounds.EMPTY)}};nt.StatefulLayouter=cd;function YC(i,e,t){if(typeof t=="function"){if(!(0,zC.isInjectable)(t))throw new Error(`Layouts be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(ga.TYPES.LayoutRegistration).toDynamicValue(n=>({layoutKind:e,factory:()=>n.container.get(t)}))}nt.configureLayout=YC});var Pp=f(xn=>{"use strict";var ld=xn&&xn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ep=xn&&xn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(xn,"__esModule",{value:!0});xn.HiddenBoundsUpdater=xn.BoundsData=void 0;var fd=_(),VS=ie(),Sr=ee(),KS=$(),wp=P(),UC=dd(),ma=ue(),Sp=class{};xn.BoundsData=Sp;var Mo=class{constructor(){this.element2boundsData=new Map}decorate(e,t){return((0,ma.isSizeable)(t)||(0,ma.isLayoutContainer)(t))&&this.element2boundsData.set(t,{vnode:e,bounds:t.bounds,boundsChanged:!1,alignmentChanged:!1}),t instanceof KS.SModelRoot&&(this.root=t),e}postUpdate(e){if(e===void 0||e.kind!==VS.RequestBoundsAction.KIND)return;let t=e;this.getBoundsFromDOM(),this.layouter.layout(this.element2boundsData);let n=[],r=[];this.element2boundsData.forEach((s,a)=>{if(s.boundsChanged&&s.bounds!==void 0){let c={elementId:a.id,newSize:{width:s.bounds.width,height:s.bounds.height}};a instanceof KS.SChildElement&&(0,ma.isLayoutContainer)(a.parent)&&(c.newPosition={x:s.bounds.x,y:s.bounds.y}),n.push(c)}s.alignmentChanged&&s.alignment!==void 0&&r.push({elementId:a.id,newAlignment:s.alignment})});let o=this.root!==void 0?this.root.revision:void 0;this.actionDispatcher.dispatch(VS.ComputedBoundsAction.create(n,{revision:o,alignments:r,requestId:t.requestId})),this.element2boundsData.clear()}getBoundsFromDOM(){this.element2boundsData.forEach((e,t)=>{if(e.bounds&&(0,ma.isSizeable)(t)){let n=e.vnode;if(n&&n.elm){let r=this.getBounds(n.elm,t);(0,ma.isAlignable)(t)&&!((0,Sr.almostEquals)(r.x,0)&&(0,Sr.almostEquals)(r.y,0))&&(e.alignment={x:-r.x,y:-r.y},e.alignmentChanged=!0);let o={x:t.bounds.x,y:t.bounds.y,width:r.width,height:r.height};(0,Sr.almostEquals)(o.x,t.bounds.x)&&(0,Sr.almostEquals)(o.y,t.bounds.y)&&(0,Sr.almostEquals)(o.width,t.bounds.width)&&(0,Sr.almostEquals)(o.height,t.bounds.height)||(e.bounds=o,e.boundsChanged=!0)}}})}getBounds(e,t){if(typeof e.getBBox!="function")return this.logger.error(this,"Not an SVG element:",e),Sr.Bounds.EMPTY;let n=e.getBBox();return{x:n.x,y:n.y,width:n.width,height:n.height}}};ld([(0,fd.inject)(wp.TYPES.ILogger),Ep("design:type",Object)],Mo.prototype,"logger",void 0);ld([(0,fd.inject)(wp.TYPES.IActionDispatcher),Ep("design:type",Object)],Mo.prototype,"actionDispatcher",void 0);ld([(0,fd.inject)(wp.TYPES.Layouter),Ep("design:type",UC.Layouter)],Mo.prototype,"layouter",void 0);Mo=ld([(0,fd.injectable)()],Mo);xn.HiddenBoundsUpdater=Mo});var hd=f(To=>{"use strict";var kC=To&&To.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(To,"__esModule",{value:!0});To.AbstractLayout=void 0;var Ip=ee(),HS=$(),Rp=ue(),GC=_(),Mp=class{layout(e,t){let n=t.getBoundsData(e),r=this.getLayoutOptions(e),o=this.getChildrenSize(e,r,t),s=r.paddingFactor*(r.resizeContainer?o.width:Math.max(0,this.getFixedContainerBounds(e,r,t).width)-r.paddingLeft-r.paddingRight),a=r.paddingFactor*(r.resizeContainer?o.height:Math.max(0,this.getFixedContainerBounds(e,r,t).height)-r.paddingTop-r.paddingBottom);if(s>0&&a>0){let c=this.layoutChildren(e,t,r,s,a);n.bounds=this.getFinalContainerBounds(e,c,r,s,a),n.boundsChanged=!0}}getFinalContainerBounds(e,t,n,r,o){return{x:e.bounds.x,y:e.bounds.y,width:Math.max(n.minWidth,r+n.paddingLeft+n.paddingRight),height:Math.max(n.minHeight,o+n.paddingTop+n.paddingBottom)}}getFixedContainerBounds(e,t,n){let r=e;for(;;){if((0,Rp.isBoundsAware)(r)){let o=r.bounds;if((0,Rp.isLayoutContainer)(r)&&t.resizeContainer&&n.log.error(r,"Resizable container found while detecting fixed bounds"),Ip.Dimension.isValid(o))return o}if(r instanceof HS.SChildElement)r=r.parent;else return n.log.error(r,"Cannot detect fixed bounds"),Ip.Bounds.EMPTY}}layoutChildren(e,t,n,r,o){let s={x:n.paddingLeft+.5*(r-r/n.paddingFactor),y:n.paddingTop+.5*(o-o/n.paddingFactor)};return e.children.forEach(a=>{if((0,Rp.isLayoutableChild)(a)){let c=t.getBoundsData(a),u=c.bounds,d=this.getChildLayoutOptions(a,n);u!==void 0&&Ip.Dimension.isValid(u)&&(s=this.layoutChild(a,c,u,d,n,s,r,o))}}),s}getDx(e,t,n){switch(e){case"left":return 0;case"center":return .5*(n-t.width);case"right":return n-t.width}}getDy(e,t,n){switch(e){case"top":return 0;case"center":return .5*(n-t.height);case"bottom":return n-t.height}}getChildLayoutOptions(e,t){let n=e.layoutOptions;return n===void 0?t:this.spread(t,n)}getLayoutOptions(e){let t=e,n=[];for(;t!==void 0;){let r=t.layoutOptions;if(r!==void 0&&n.push(r),t instanceof HS.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>this.spread(r,o),this.getDefaultLayoutOptions())}};Mp=kC([(0,GC.injectable)()],Mp);To.AbstractLayout=Mp});var Tp=f(Oo=>{"use strict";var $C=Oo&&Oo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Oo,"__esModule",{value:!0});Oo.VBoxLayouter=void 0;var WC=_(),XC=ee(),JC=hd(),ZC=ue(),pd=class extends JC.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=0,s=!0;return e.children.forEach(a=>{if((0,ZC.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&XC.Dimension.isValid(c)&&(o+=c.height,s?s=!1:o+=t.vGap,r=Math.max(r,c.width))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:s.y+e.bounds.y-n.y,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x,y:s.y+n.height+o.vGap}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,vGap:1,hAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};pd.KIND="vbox";pd=$C([(0,WC.injectable)()],pd);Oo.VBoxLayouter=pd});var Op=f(Ao=>{"use strict";var QC=Ao&&Ao.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Ao,"__esModule",{value:!0});Ao.HBoxLayouter=void 0;var ex=_(),tx=ee(),nx=hd(),ix=ue(),gd=class extends nx.AbstractLayout{getChildrenSize(e,t,n){let r=0,o=-1,s=!0;return e.children.forEach(a=>{if((0,ix.isLayoutableChild)(a)){let c=n.getBoundsData(a).bounds;c!==void 0&&tx.Dimension.isValid(c)&&(s?s=!1:r+=t.hGap,r+=c.width,o=Math.max(o,c.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDy(r.vAlign,n,c);return t.bounds={x:s.x+e.bounds.x-n.x,y:o.paddingTop+e.bounds.y-n.y+u,width:n.width,height:n.height},t.boundsChanged=!0,{x:s.x+n.width+o.hGap,y:s.y}}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hGap:1,vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};gd.KIND="hbox";gd=QC([(0,ex.injectable)()],gd);Ao.HBoxLayouter=gd});var Ap=f(Co=>{"use strict";var rx=Co&&Co.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Co,"__esModule",{value:!0});Co.StackLayouter=void 0;var ox=_(),sx=ee(),ax=hd(),cx=ue(),md=class extends ax.AbstractLayout{getChildrenSize(e,t,n){let r=-1,o=-1;return e.children.forEach(s=>{if((0,cx.isLayoutableChild)(s)){let a=n.getBoundsData(s).bounds;a!==void 0&&sx.Dimension.isValid(a)&&(r=Math.max(r,a.width),o=Math.max(o,a.height))}}),{width:r,height:o}}layoutChild(e,t,n,r,o,s,a,c){let u=this.getDx(r.hAlign,n,a),d=this.getDy(r.vAlign,n,c);return t.bounds={x:o.paddingLeft+e.bounds.x-n.x+u,y:o.paddingTop+e.bounds.y-n.y+d,width:n.width,height:n.height},t.boundsChanged=!0,s}getDefaultLayoutOptions(){return{resizeContainer:!0,paddingTop:5,paddingBottom:5,paddingLeft:5,paddingRight:5,paddingFactor:1,hAlign:"center",vAlign:"center",minWidth:0,minHeight:0}}spread(e,t){return Object.assign(Object.assign({},e),t)}};md.KIND="stack";md=rx([(0,ox.injectable)()],md);Co.StackLayouter=md});var ya=f(xo=>{"use strict";var ux=xo&&xo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(xo,"__esModule",{value:!0});xo.ShapeView=void 0;var dx=_(),lx=ee(),fx=ue(),Cp=class{isVisible(e,t){if(t.targetKind==="hidden"||!lx.Dimension.isValid(e.bounds))return!0;let n=(0,fx.getAbsoluteBounds)(e),r=e.root.canvasBounds;return n.x<=r.width&&n.x+n.width>=0&&n.y<=r.height&&n.y+n.height>=0}};Cp=ux([(0,dx.injectable)()],Cp);xo.ShapeView=Cp});var va=f(Jt=>{"use strict";var hx=Jt&&Jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},px=Jt&&Jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},yd=Jt&&Jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.configureButtonHandler=Jt.ButtonHandlerRegistry=void 0;var _a=_(),gx=Mn(),xp=P(),mx=cr(),qp=class extends gx.InstanceRegistry{constructor(e,t){super(),e.forEach(n=>this.register(n.TYPE,n.factory())),t.forEach(n=>this.register(n.TYPE,new n))}};qp=hx([(0,_a.injectable)(),yd(0,(0,_a.multiInject)(xp.TYPES.IButtonHandlerRegistration)),yd(0,(0,_a.optional)()),yd(1,(0,_a.multiInject)(xp.TYPES.IButtonHandler)),yd(1,(0,_a.optional)()),px("design:paramtypes",[Array,Array])],qp);Jt.ButtonHandlerRegistry=qp;function yx(i,e,t){if(typeof t=="function"){if(!(0,mx.isInjectable)(t))throw new Error(`Button handlers should be @injectable: ${t.name}`);i.isBound(t)||i.bind(t).toSelf()}i.bind(xp.TYPES.IButtonHandlerRegistration).toDynamicValue(n=>({TYPE:e,factory:()=>n.container.get(t)}))}Jt.configureButtonHandler=yx});var qo=f(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.isFadeable=Er.fadeFeature=void 0;Er.fadeFeature=Symbol("fadeFeature");function _x(i){return i.hasFeature(Er.fadeFeature)&&i.opacity!==void 0}Er.isFadeable=_x});var bd=f(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.SButton=void 0;var Dp=ue(),vx=qo(),_d=class extends Dp.SShapeElement{constructor(){super(...arguments),this.enabled=!0}};vd.SButton=_d;_d.DEFAULT_FEATURES=[Dp.boundsFeature,Dp.layoutableChildFeature,vx.fadeFeature]});var jp=f(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.name=ni.isNameable=ni.nameFeature=void 0;ni.nameFeature=Symbol("nameableFeature");function zS(i){return i.hasFeature(ni.nameFeature)}ni.isNameable=zS;function bx(i){if(zS(i))return i.name}ni.name=bx});var Sd=f(Zt=>{"use strict";var kS=Zt&&Zt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},GS=Zt&&Zt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Lp=Zt&&Zt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.RevealNamedElementActionProvider=Zt.CommandPaletteActionProviderRegistry=void 0;var ba=_(),Np=ie(),YS=Sc(),$S=P(),Sx=or(),US=jp(),Bp=class{constructor(e=[]){this.actionProviders=e}getActions(e,t,n,r){let o=this.actionProviders.map(s=>s.getActions(e,t,n,r));return Promise.all(o).then(s=>s.reduce((a,c)=>c!==void 0?a.concat(c):a))}};Bp=kS([(0,ba.injectable)(),Lp(0,(0,ba.multiInject)($S.TYPES.ICommandPaletteActionProvider)),Lp(0,(0,ba.optional)()),GS("design:paramtypes",[Array])],Bp);Zt.CommandPaletteActionProviderRegistry=Bp;var Fp=class{constructor(e){this.logger=e}getActions(e,t,n,r){return r!==void 0&&r%2===0?Promise.resolve(this.createSelectActions(e)):Promise.resolve([new YS.LabeledAction("Select all",[Np.SelectAllAction.create()])])}createSelectActions(e){return(0,Sx.toArray)(e.index.all().filter(n=>(0,US.isNameable)(n))).map(n=>new YS.LabeledAction(`Reveal ${(0,US.name)(n)}`,[Np.SelectAction.create({selectedElementsIDs:[n.id]}),Np.CenterAction.create([n.id])],"eye"))}};Fp=kS([(0,ba.injectable)(),Lp(0,(0,ba.inject)($S.TYPES.ILogger)),GS("design:paramtypes",[Object])],Fp);Zt.RevealNamedElementActionProvider=Fp});var Vp=f(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.codiconCSSClasses=Qt.codiconCSSString=Qt.ANIMATION_SPIN=Qt.ACTION_ITEM=void 0;Qt.ACTION_ITEM="action-item";Qt.ANIMATION_SPIN="animation-spin";function Ex(i,e=!1,t=!1,n=[]){return WS(i,e,t,n).join(" ")}Qt.codiconCSSString=Ex;function WS(i,e=!1,t=!1,n=[]){let r=["codicon",`codicon-${i}`];return e&&r.push(Qt.ACTION_ITEM),t&&r.push(Qt.ANIMATION_SPIN),n.length>0&&r.push(...n),r}Qt.codiconCSSClasses=WS});var wt=f(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.isSelected=ii.isSelectable=ii.selectFeature=void 0;ii.selectFeature=Symbol("selectFeature");function XS(i){return i.hasFeature(ii.selectFeature)}ii.isSelectable=XS;function wx(i){return i!==void 0&&XS(i)&&i.selected}ii.isSelected=wx});var JS=f((Kp,Hp)=>{(function(i,e){typeof Kp=="object"&&typeof Hp<"u"?Hp.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self,i.autocomplete=e())})(Kp,function(){"use strict";function i(e){var t=document,n=e.container||t.createElement("div");n.id=n.id||"autocomplete-"+T();var r=n.style,o=e.debounceWaitMs||0,s=e.preventSubmit||!1,a=e.disableAutoSelect||!1,c=[],u="",d=2,l=e.showOnFocus,S,R=0,v;if(e.minLength!==void 0&&(d=e.minLength),!e.input)throw new Error("input undefined");var m=e.input;n.className="autocomplete "+(e.className||""),n.setAttribute("role","listbox"),m.setAttribute("role","combobox"),m.setAttribute("aria-expanded","false"),m.setAttribute("aria-autocomplete","list"),m.setAttribute("aria-controls",n.id),m.setAttribute("aria-owns",n.id),m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-haspopup","listbox"),r.position="absolute";function T(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function C(){var L=n.parentNode;L&&L.removeChild(n)}function H(){v&&window.clearTimeout(v)}function G(){n.parentNode||t.body.appendChild(n)}function D(){return!!n.parentNode}function F(){R++,c=[],u="",S=void 0,m.setAttribute("aria-activedescendant",""),m.setAttribute("aria-expanded","false"),C()}function z(){if(!D())return;m.setAttribute("aria-expanded","true"),r.height="auto",r.width=m.offsetWidth+"px";var L=0,j;function ce(){var Ne=t.documentElement,k=Ne.clientTop||t.body.clientTop||0,Ke=Ne.clientLeft||t.body.clientLeft||0,fi=window.pageYOffset||Ne.scrollTop,cn=window.pageXOffset||Ne.scrollLeft;j=m.getBoundingClientRect();var We=j.top+m.offsetHeight+fi-k,ot=j.left+cn-Ke;r.top=We+"px",r.left=ot+"px",L=window.innerHeight-(j.top+m.offsetHeight),L<0&&(L=0),r.top=We+"px",r.bottom="",r.left=ot+"px",r.maxHeight=L+"px"}ce(),ce(),e.customize&&j&&e.customize(m,j,n,L)}function W(){for(;n.firstChild;)n.removeChild(n.firstChild);m.setAttribute("aria-activedescendant","");var L=function(Ke,fi,cn){var We=t.createElement("div");return We.textContent=Ke.label||"",We};e.render&&(L=e.render);var j=function(Ke,fi){var cn=t.createElement("div");return cn.textContent=Ke,cn};e.renderGroup&&(j=e.renderGroup);var ce=t.createDocumentFragment(),Ne="#9?$";if(c.forEach(function(Ke,fi){if(Ke.group&&Ke.group!==Ne){Ne=Ke.group;var cn=j(Ke.group,u);cn&&(cn.className+=" group",ce.appendChild(cn))}var We=L(Ke,u,fi);We&&(We.id=n.id+"_"+fi,We.setAttribute("role","option"),We.addEventListener("click",function(ot){e.onSelect(Ke,m),F(),ot.preventDefault(),ot.stopPropagation()}),Ke===S&&(We.className+=" selected",We.setAttribute("aria-selected","true"),m.setAttribute("aria-activedescendant",We.id)),ce.appendChild(We))}),n.appendChild(ce),c.length<1)if(e.emptyMsg){var k=t.createElement("div");k.id=n.id+"_"+T(),k.className="empty",k.textContent=e.emptyMsg,n.appendChild(k),m.setAttribute("aria-activedescendant",k.id)}else{F();return}G(),z(),be()}function Y(){D()&&W()}function ae(){Y()}function Ie(L){L.target!==n?Y():L.preventDefault()}function he(L){for(var j=L.which||L.keyCode||0,ce=e.keysToIgnore||[38,13,27,39,37,16,17,18,20,91,9],Ne=0,k=ce;Ne<k.length;Ne++){var Ke=k[Ne];if(j===Ke)return}j>=112&&j<=123&&!e.keysToIgnore||j===40&&D()||Ns(0)}function be(){var L=n.getElementsByClassName("selected");if(L.length>0){var j=L[0],ce=j.previousElementSibling;if(ce&&ce.className.indexOf("group")!==-1&&!ce.previousElementSibling&&(j=ce),j.offsetTop<n.scrollTop)n.scrollTop=j.offsetTop;else{var Ne=j.offsetTop+j.offsetHeight,k=n.scrollTop+n.offsetHeight;Ne>k&&(n.scrollTop+=Ne-k)}}}function $e(){if(c.length<1)S=void 0;else if(S===c[0])S=c[c.length-1];else for(var L=c.length-1;L>0;L--)if(S===c[L]||L===1){S=c[L-1];break}}function Sn(){if(c.length<1&&(S=void 0),!S||S===c[c.length-1]){S=c[0];return}for(var L=0;L<c.length-1;L++)if(S===c[L]){S=c[L+1];break}}function li(L){var j=L.which||L.keyCode||0;if(j===38||j===40||j===27){var ce=D();if(j===27)F();else{if(!ce||c.length<1)return;j===38?$e():Sn(),W()}L.preventDefault(),ce&&L.stopPropagation();return}j===13&&(S&&(e.onSelect(S,m),F()),s&&L.preventDefault())}function js(){l&&Ns(1)}function Ns(L){var j=++R,ce=m.value,Ne=m.selectionStart||0;ce.length>=d||L===1?(H(),v=window.setTimeout(function(){e.fetch(ce,function(k){R===j&&k&&(c=k,u=ce,S=c.length<1||a?void 0:c[0],W())},L,Ne)},L===0?o:0)):F()}function Ls(){setTimeout(function(){t.activeElement!==m&&F()},200)}n.addEventListener("mousedown",function(L){L.stopPropagation(),L.preventDefault()}),n.addEventListener("focus",function(){return m.focus()});function _c(){m.removeEventListener("focus",js),m.removeEventListener("keydown",li),m.removeEventListener("keyup",he),m.removeEventListener("blur",Ls),window.removeEventListener("resize",ae),t.removeEventListener("scroll",Ie,!0),m.removeAttribute("role"),m.removeAttribute("aria-expanded"),m.removeAttribute("aria-autocomplete"),m.removeAttribute("aria-controls"),m.removeAttribute("aria-activedescendant"),m.removeAttribute("aria-owns"),m.removeAttribute("aria-haspopup"),H(),F()}return m.addEventListener("keydown",li),m.addEventListener("keyup",he),m.addEventListener("blur",Ls),m.addEventListener("focus",js),window.addEventListener("resize",ae),t.addEventListener("scroll",Ie,!0),{destroy:_c}}return i})});var kp=f(en=>{"use strict";var Do=en&&en.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Sa=en&&en.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Px=en&&en.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},Ed;Object.defineProperty(en,"__esModule",{value:!0});en.CommandPaletteKeyListener=en.CommandPalette=void 0;var jo=_(),Ix=ie(),Rx=Sc(),wd=P(),Mx=Bu(),ZS=ea(),Tx=lo(),Ox=dn(),QS=Vp(),zp=or(),Up=An(),eE=ue(),nE=wt(),Ax=Sd(),tE=At(),Cx=Px(JS()),qt=Ed=class extends Mx.AbstractUIExtension{constructor(){super(...arguments),this.loadingIndicatorClasses=(0,QS.codiconCSSClasses)("loading",!1,!0,["loading"]),this.xOffset=20,this.yOffset=20,this.defaultWidth=400,this.debounceWaitMs=100,this.noCommandsMsg="No commands available",this.paletteIndex=0}id(){return Ed.ID}containerClass(){return"command-palette"}show(e,...t){super.show(e,...t),this.paletteIndex=0,this.contextActions=void 0,this.inputElement.value="",this.autoCompleteResult=(0,Cx.default)(this.autocompleteSettings(e)),this.inputElement.focus()}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.inputElement.style.width="100%",this.inputElement.addEventListener("keydown",t=>this.hideIfEscapeEvent(t)),this.inputElement.addEventListener("keydown",t=>this.cylceIfInvokePaletteKey(t)),this.inputElement.onblur=()=>window.setTimeout(()=>this.hide(),200),e.appendChild(this.inputElement)}hideIfEscapeEvent(e){(0,Up.matchesKeystroke)(e,"Escape")&&this.hide()}cylceIfInvokePaletteKey(e){Ed.isInvokePaletteKey(e)&&this.cycle()}cycle(){this.contextActions=void 0,this.paletteIndex++}onBeforeShow(e,t,...n){let r=this.xOffset,o=this.yOffset,s=(0,zp.toArray)(t.index.all().filter(a=>(0,nE.isSelectable)(a)&&a.selected));if(s.length===1){let a=(0,eE.getAbsoluteClientBounds)(s[0],this.domHelper,this.viewerOptions);r+=a.x+a.width,o+=a.y}else{let a=(0,eE.getAbsoluteClientBounds)(t,this.domHelper,this.viewerOptions);r+=a.x,o+=a.y}e.style.left=`${r}px`,e.style.top=`${o}px`,e.style.width=`${this.defaultWidth}px`}autocompleteSettings(e){return{input:this.inputElement,emptyMsg:this.noCommandsMsg,className:"command-palette-suggestions",debounceWaitMs:this.debounceWaitMs,showOnFocus:!0,minLength:-1,fetch:(t,n)=>this.updateAutoCompleteActions(n,t,e),onSelect:t=>this.onSelect(t),render:(t,n)=>this.renderLabeledActionSuggestion(t,n),customize:(t,n,r,o)=>{this.customizeSuggestionContainer(r,n,o)}}}onSelect(e){this.executeAction(e),this.hide()}updateAutoCompleteActions(e,t,n){this.onLoading(),this.contextActions?(e(this.filterActions(t,this.contextActions)),this.onLoaded("success")):this.actionProviderRegistry.getActions(n,t,this.mousePositionTracker.lastPositionOnDiagram,this.paletteIndex).then(r=>{this.contextActions=r,e(this.filterActions(t,r)),this.onLoaded("success")}).catch(r=>{this.logger.error(this,"Failed to obtain actions from command palette action providers",r),this.onLoaded("error")})}onLoading(){this.loadingIndicator&&this.containerElement.contains(this.loadingIndicator)||(this.loadingIndicator=document.createElement("span"),this.loadingIndicator.classList.add(...this.loadingIndicatorClasses),this.containerElement.appendChild(this.loadingIndicator))}onLoaded(e){this.containerElement.contains(this.loadingIndicator)&&this.containerElement.removeChild(this.loadingIndicator)}renderLabeledActionSuggestion(e,t){let n=document.createElement("div"),r=qx(t).split(" ").join("|"),o=new RegExp(r,"gi");return e.icon&&this.renderIcon(n,e.icon),t.length>0?n.innerHTML+=e.label.replace(o,s=>"<em>"+s+"</em>").replace(/ /g,"&nbsp;"):n.innerHTML+=e.label.replace(/ /g,"&nbsp;"),n}renderIcon(e,t){e.innerHTML+=`<span class="icon ${this.getCodicon(t)}"></span>`}getFontAwesomeIcon(e){return`fa fa-${e}`}getCodicon(e){return(0,QS.codiconCSSString)(e)}filterActions(e,t){return(0,zp.toArray)(t.filter(n=>{let r=n.label.toLowerCase();return e.split(" ").every(s=>r.indexOf(s.toLowerCase())!==-1)}))}customizeSuggestionContainer(e,t,n){this.containerElement&&this.containerElement.appendChild(e)}hide(){super.hide(),this.autoCompleteResult&&this.autoCompleteResult.destroy()}executeAction(e){this.actionDispatcherProvider().then(t=>t.dispatchAll(xx(e))).catch(t=>this.logger.error(this,"No action dispatcher available to execute command palette action",t))}};qt.ID="command-palette";qt.isInvokePaletteKey=i=>(0,Up.matchesKeystroke)(i,"Space","ctrl");Do([(0,jo.inject)(wd.TYPES.IActionDispatcherProvider),Sa("design:type",Function)],qt.prototype,"actionDispatcherProvider",void 0);Do([(0,jo.inject)(wd.TYPES.ICommandPaletteActionProviderRegistry),Sa("design:type",Ax.CommandPaletteActionProviderRegistry)],qt.prototype,"actionProviderRegistry",void 0);Do([(0,jo.inject)(wd.TYPES.ViewerOptions),Sa("design:type",Object)],qt.prototype,"viewerOptions",void 0);Do([(0,jo.inject)(wd.TYPES.DOMHelper),Sa("design:type",Tx.DOMHelper)],qt.prototype,"domHelper",void 0);Do([(0,jo.inject)(tE.MousePositionTracker),Sa("design:type",tE.MousePositionTracker)],qt.prototype,"mousePositionTracker",void 0);qt=Ed=Do([(0,jo.injectable)()],qt);en.CommandPalette=qt;function xx(i){return(0,Rx.isLabeledAction)(i)?i.actions:(0,Ix.isAction)(i)?[i]:[]}function qx(i){return i.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var Yp=class extends Ox.KeyListener{keyDown(e,t){if((0,Up.matchesKeystroke)(t,"Escape"))return[ZS.SetUIExtensionVisibilityAction.create({extensionId:qt.ID,visible:!1,contextElementsId:[]})];if(qt.isInvokePaletteKey(t)){let n=(0,zp.toArray)(e.index.all().filter(r=>(0,nE.isSelectable)(r)&&r.selected).map(r=>r.id));return[ZS.SetUIExtensionVisibilityAction.create({extensionId:qt.ID,visible:!0,contextElementsId:n})]}return[]}};en.CommandPaletteKeyListener=Yp});var iE=f(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.toAnchor=void 0;function Dx(i){return i instanceof HTMLElement?{x:i.offsetLeft,y:i.offsetTop}:i}Pd.toAnchor=Dx});var No=f(Te=>{"use strict";var jx=Te&&Te.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nx=Te&&Te.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Lx=Te&&Te.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Te,"__esModule",{value:!0});Te.DeleteElementCommand=Te.ResolvedDelete=Te.DeleteElementAction=Te.isDeletable=Te.deletableFeature=void 0;var rE=_(),Bx=me(),Fx=$(),Vx=P();Te.deletableFeature=Symbol("deletableFeature");function oE(i){return i instanceof Fx.SChildElement&&i.hasFeature(Te.deletableFeature)}Te.isDeletable=oE;var sE;(function(i){i.KIND="delete";function e(t){return{kind:i.KIND,elementIds:t}}i.create=e})(sE=Te.DeleteElementAction||(Te.DeleteElementAction={}));var Gp=class{};Te.ResolvedDelete=Gp;var Id=class extends Bx.Command{constructor(e){super(),this.action=e,this.resolvedDeletes=[]}execute(e){let t=e.root.index;for(let n of this.action.elementIds){let r=t.getById(n);r&&oE(r)&&(this.resolvedDeletes.push({child:r,parent:r.parent}),r.parent.remove(r))}return e.root}undo(e){for(let t of this.resolvedDeletes)t.parent.add(t.child);return e.root}redo(e){for(let t of this.resolvedDeletes)t.parent.remove(t.child);return e.root}};Id.KIND=sE.KIND;Id=jx([(0,rE.injectable)(),Lx(0,(0,rE.inject)(Vx.TYPES.Action)),Nx("design:paramtypes",[Object])],Id);Te.DeleteElementCommand=Id});var Md=f(tn=>{"use strict";var cE=tn&&tn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Kx=tn&&tn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},aE=tn&&tn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.DeleteContextMenuItemProvider=tn.ContextMenuProviderRegistry=void 0;var Rd=_(),Hx=P(),zx=No(),Yx=wt(),Ux=hr(),$p=class{constructor(e=[]){this.menuProviders=e}getItems(e,t){let n=this.menuProviders.map(r=>r.getItems(e,t));return Promise.all(n).then(this.flattenAndRestructure)}flattenAndRestructure(e){let t=e.reduce((r,o)=>o!==void 0?r.concat(o):r,[]),n=t.filter(r=>r.parentId);for(let r of n)if(r.parentId){let o=r.parentId.split("."),s,a=t;for(let c of o)s=a.find(u=>c===u.id),s&&s.children&&(a=s.children);s&&(s.children?s.children.push(r):s.children=[r],t=t.filter(c=>c!==r))}return t}};$p=cE([(0,Rd.injectable)(),aE(0,(0,Rd.multiInject)(Hx.TYPES.IContextMenuItemProvider)),aE(0,(0,Rd.optional)()),Kx("design:paramtypes",[Array])],$p);tn.ContextMenuProviderRegistry=$p;var Wp=class{getItems(e,t){let n=Array.from(e.index.all().filter(Yx.isSelected).filter(zx.isDeletable));return Promise.resolve([{id:"delete",label:"Delete",sortString:"d",group:"edit",actions:[Ux.DeleteElementAction.create(n.map(r=>r.id))],isEnabled:()=>n.length>0}])}};Wp=cE([(0,Rd.injectable)()],Wp);tn.DeleteContextMenuItemProvider=Wp});var Zp=f(qn=>{"use strict";var dE=qn&&qn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},lE=qn&&qn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},uE=qn&&qn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(qn,"__esModule",{value:!0});qn.ContextMenuMouseListener=void 0;var Xp=_(),kx=ie(),Gx=Md(),$x=At(),Jp=P(),Td=wt(),Wx=ze(),Od=class extends $x.MouseListener{constructor(e,t){super(),this.contextMenuService=e,this.menuProvider=t}contextMenu(e,t){return this.showContextMenu(e,t),[]}async showContextMenu(e,t){let n;try{n=await this.contextMenuService()}catch{return}let r={x:t.x,y:t.y},o=e.root,s=e.id,a=!1,c=(0,Wx.findParentByFeature)(e,Td.isSelectable);c&&(a=c.selected,c.selected=!0);let u=()=>{c&&(c.selected=a)};if((0,Td.isSelectable)(e))if((0,Td.isSelected)(e)){let d=await this.menuProvider.getItems(e.root,r);n.show(d,r,u)}else{let d={selectedElementsIDs:[s],deselectedElementsIDs:Array.from(o.index.all().filter(Td.isSelected),S=>S.id)};await this.actionDispatcher.dispatch(kx.SelectAction.create(d));let l=await this.menuProvider.getItems(o,r);n.show(l,r)}}};dE([(0,Xp.inject)(Jp.TYPES.IActionDispatcher),lE("design:type",Object)],Od.prototype,"actionDispatcher",void 0);Od=dE([uE(0,(0,Xp.inject)(Jp.TYPES.IContextMenuServiceProvider)),uE(1,(0,Xp.inject)(Jp.TYPES.IContextMenuProviderRegistry)),lE("design:paramtypes",[Function,Gx.ContextMenuProviderRegistry])],Od);qn.ContextMenuMouseListener=Od});var wr=f(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.hasPopupFeature=nn.popupFeature=nn.isHoverable=nn.hoverFeedbackFeature=void 0;nn.hoverFeedbackFeature=Symbol("hoverFeedbackFeature");function Xx(i){return i.hasFeature(nn.hoverFeedbackFeature)}nn.isHoverable=Xx;nn.popupFeature=Symbol("popupFeature");function Jx(i){return i.hasFeature(nn.popupFeature)}nn.hasPopupFeature=Jx});var qi=f(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.isMoveable=ri.isLocateable=ri.moveFeature=void 0;ri.moveFeature=Symbol("moveFeature");function fE(i){return i.position!==void 0}ri.isLocateable=fE;function Zx(i){return i.hasFeature(ri.moveFeature)&&fE(i)}ri.isMoveable=Zx});var _e=f(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.edgeInProgressTargetHandleID=pe.edgeInProgressID=pe.SDanglingAnchor=pe.SRoutingHandle=pe.SConnectableElement=pe.getRouteBounds=pe.getAbsoluteRouteBounds=pe.isConnectable=pe.connectableFeature=pe.SRoutableElement=void 0;var hE=ee(),Qp=$(),Qx=ue(),e1=No(),t1=wt(),n1=wr(),i1=qi(),Ea=class extends Qp.SChildElement{constructor(){super(...arguments),this.routingPoints=[]}get source(){return this.index.getById(this.sourceId)}get target(){return this.index.getById(this.targetId)}get bounds(){return this.routingPoints.reduce((e,t)=>hE.Bounds.combine(e,{x:t.x,y:t.y,width:0,height:0}),hE.Bounds.EMPTY)}};pe.SRoutableElement=Ea;pe.connectableFeature=Symbol("connectableFeature");function r1(i){return i.hasFeature(pe.connectableFeature)&&i.canConnect}pe.isConnectable=r1;function o1(i,e=i.routingPoints){let t=pE(e),n=i;for(;n instanceof Qp.SChildElement;){let r=n.parent;t=r.localToParent(t),n=r}return t}pe.getAbsoluteRouteBounds=o1;function pE(i){let e={x:NaN,y:NaN,width:0,height:0};for(let t of i)isNaN(e.x)?(e.x=t.x,e.y=t.y):(t.x<e.x?(e.width+=e.x-t.x,e.x=t.x):t.x>e.x+e.width&&(e.width=t.x-e.x),t.y<e.y?(e.height+=e.y-t.y,e.y=t.y):t.y>e.y+e.height&&(e.height=t.y-e.y));return e}pe.getRouteBounds=pE;var Ad=class extends Qx.SShapeElement{constructor(){super(...arguments),this.strokeWidth=0}get anchorKind(){}get incomingEdges(){return this.index.all().filter(t=>t instanceof Ea).filter(t=>t.targetId===this.id)}get outgoingEdges(){return this.index.all().filter(t=>t instanceof Ea).filter(t=>t.sourceId===this.id)}canConnect(e,t){return!0}};pe.SConnectableElement=Ad;var Lo=class extends Qp.SChildElement{constructor(){super(...arguments),this.editMode=!1,this.hoverFeedback=!1,this.selected=!1}hasFeature(e){return Lo.DEFAULT_FEATURES.indexOf(e)!==-1}};pe.SRoutingHandle=Lo;Lo.DEFAULT_FEATURES=[t1.selectFeature,i1.moveFeature,n1.hoverFeedbackFeature];var Cd=class extends Ad{constructor(){super(),this.type="dangling-anchor",this.size={width:0,height:0}}};pe.SDanglingAnchor=Cd;Cd.DEFAULT_FEATURES=[e1.deletableFeature];pe.edgeInProgressID="edge-in-progress";pe.edgeInProgressTargetHandleID=pe.edgeInProgressID+"-target-anchor"});var Bo=f(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.DEFAULT_EDGE_PLACEMENT=hn.EdgePlacement=hn.isEdgeLayoutable=hn.edgeLayoutFeature=void 0;var s1=$(),a1=ue(),c1=_e();hn.edgeLayoutFeature=Symbol("edgeLayout");function u1(i){return i instanceof s1.SChildElement&&i.parent instanceof c1.SRoutableElement&&d1(i)&&(0,a1.isBoundsAware)(i)&&i.hasFeature(hn.edgeLayoutFeature)}hn.isEdgeLayoutable=u1;function d1(i){return"edgePlacement"in i}var eg=class extends Object{};hn.EdgePlacement=eg;hn.DEFAULT_EDGE_PLACEMENT={rotate:!0,side:"top",position:.5,offset:7}});var Fo=f(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.isWithEditableLabel=Ye.withEditLabelFeature=Ye.isEditableLabel=Ye.editLabelFeature=Ye.canEditRouting=Ye.editFeature=void 0;var l1=_e();Ye.editFeature=Symbol("editFeature");function f1(i){return i instanceof l1.SRoutableElement&&i.hasFeature(Ye.editFeature)}Ye.canEditRouting=f1;Ye.editLabelFeature=Symbol("editLabelFeature");function h1(i){return"text"in i&&i.hasFeature(Ye.editLabelFeature)}Ye.isEditableLabel=h1;Ye.withEditLabelFeature=Symbol("withEditLabelFeature");function p1(i){return"editableLabel"in i&&i.hasFeature(Ye.withEditLabelFeature)}Ye.isWithEditableLabel=p1});var Dn=f(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Pr.isViewport=Pr.viewportFeature=void 0;var g1=$();Pr.viewportFeature=Symbol("viewportFeature");function m1(i){return i instanceof g1.SModelRoot&&i.hasFeature(Pr.viewportFeature)&&"zoom"in i&&"scroll"in i}Pr.isViewport=m1});var xd=f(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.isExportable=Ir.exportFeature=void 0;Ir.exportFeature=Symbol("exportFeature");function y1(i){return i.hasFeature(Ir.exportFeature)}Ir.isExportable=y1});var jd=f(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.ViewportRootElement=void 0;var wa=ee(),_1=$(),v1=Dn(),b1=xd(),qd=class extends _1.SModelRoot{constructor(e){super(e),this.scroll={x:0,y:0},this.zoom=1,this.position=wa.Point.ORIGIN,this.size=wa.Dimension.EMPTY}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}localToParent(e){let t={x:(e.x-this.scroll.x)*this.zoom,y:(e.y-this.scroll.y)*this.zoom,width:-1,height:-1};return(0,wa.isBounds)(e)&&(t.width=e.width*this.zoom,t.height=e.height*this.zoom),t}parentToLocal(e){let t={x:e.x/this.zoom+this.scroll.x,y:e.y/this.zoom+this.scroll.y,width:-1,height:-1};return(0,wa.isBounds)(e)&&wa.Dimension.isValid(e)&&(t.width=e.width/this.zoom,t.height=e.height/this.zoom),t}};Dd.ViewportRootElement=qd;qd.DEFAULT_FEATURES=[v1.viewportFeature,b1.exportFeature]});var Rr=f(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.SGraphIndex=it.SCompartment=it.SLabel=it.SEdge=it.SPort=it.SNode=it.SGraph=void 0;var S1=ee(),E1=$(),pn=ue(),w1=Bo(),gE=No(),P1=Fo(),Ia=qo(),Nd=wr(),I1=qi(),Ra=_e(),ng=wt(),R1=jd(),M1=or(),tg=class extends R1.ViewportRootElement{constructor(e=new Di){super(e)}};it.SGraph=tg;var Ld=class extends Ra.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}canConnect(e,t){return this.children.find(n=>n instanceof Pa)===void 0}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):this.index.all().filter(n=>n instanceof jn).filter(n=>n.targetId===this.id)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):this.index.all().filter(n=>n instanceof jn).filter(n=>n.sourceId===this.id)}};it.SNode=Ld;Ld.DEFAULT_FEATURES=[Ra.connectableFeature,gE.deletableFeature,ng.selectFeature,pn.boundsFeature,I1.moveFeature,pn.layoutContainerFeature,Ia.fadeFeature,Nd.hoverFeedbackFeature,Nd.popupFeature];var Pa=class extends Ra.SConnectableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}get incomingEdges(){let e=this.index;return e instanceof Di?e.getIncomingEdges(this):super.incomingEdges.filter(t=>t instanceof jn)}get outgoingEdges(){let e=this.index;return e instanceof Di?e.getOutgoingEdges(this):super.outgoingEdges.filter(t=>t instanceof jn)}};it.SPort=Pa;Pa.DEFAULT_FEATURES=[Ra.connectableFeature,ng.selectFeature,pn.boundsFeature,Ia.fadeFeature,Nd.hoverFeedbackFeature];var jn=class extends Ra.SRoutableElement{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1,this.opacity=1}};it.SEdge=jn;jn.DEFAULT_FEATURES=[P1.editFeature,gE.deletableFeature,ng.selectFeature,Ia.fadeFeature,Nd.hoverFeedbackFeature];var Bd=class extends pn.SShapeElement{constructor(){super(...arguments),this.selected=!1,this.alignment=S1.Point.ORIGIN,this.opacity=1}};it.SLabel=Bd;Bd.DEFAULT_FEATURES=[pn.boundsFeature,pn.alignFeature,pn.layoutableChildFeature,w1.edgeLayoutFeature,Ia.fadeFeature];var Fd=class extends pn.SShapeElement{constructor(){super(...arguments),this.opacity=1}};it.SCompartment=Fd;Fd.DEFAULT_FEATURES=[pn.boundsFeature,pn.layoutContainerFeature,pn.layoutableChildFeature,Ia.fadeFeature];var Di=class extends E1.ModelIndexImpl{constructor(){super(...arguments),this.outgoing=new Map,this.incoming=new Map}add(e){if(super.add(e),e instanceof jn){if(e.sourceId){let t=this.outgoing.get(e.sourceId);t===void 0?this.outgoing.set(e.sourceId,[e]):t.push(e)}if(e.targetId){let t=this.incoming.get(e.targetId);t===void 0?this.incoming.set(e.targetId,[e]):t.push(e)}}}remove(e){if(super.remove(e),e instanceof jn){let t=this.outgoing.get(e.sourceId);if(t!==void 0){let r=t.indexOf(e);r>=0&&(t.length===1?this.outgoing.delete(e.sourceId):t.splice(r,1))}let n=this.incoming.get(e.targetId);if(n!==void 0){let r=n.indexOf(e);r>=0&&(n.length===1?this.incoming.delete(e.targetId):n.splice(r,1))}}}getAttachedElements(e){return new M1.FluentIterableImpl(()=>({outgoing:this.outgoing.get(e.id),incoming:this.incoming.get(e.id),nextOutgoingIndex:0,nextIncomingIndex:0}),t=>{let n=t.nextOutgoingIndex;if(t.outgoing!==void 0&&n<t.outgoing.length)return t.nextOutgoingIndex=n+1,{done:!1,value:t.outgoing[n]};if(n=t.nextIncomingIndex,t.incoming!==void 0)for(;n<t.incoming.length;){let r=t.incoming[n];if(r.sourceId!==r.targetId)return t.nextIncomingIndex=n+1,{done:!1,value:r};n++}return{done:!0,value:void 0}})}getIncomingEdges(e){return this.incoming.get(e.id)||[]}getOutgoingEdges(e){return this.outgoing.get(e.id)||[]}};it.SGraphIndex=Di});var oi=f(Ue=>{"use strict";var T1=Ue&&Ue.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},O1=Ue&&Ue.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},A1=Ue&&Ue.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.AnchorComputerRegistry=Ue.RECTANGULAR_ANCHOR_KIND=Ue.ELLIPTIC_ANCHOR_KIND=Ue.DIAMOND_ANCHOR_KIND=void 0;var mE=_(),C1=P(),x1=Mn();Ue.DIAMOND_ANCHOR_KIND="diamond";Ue.ELLIPTIC_ANCHOR_KIND="elliptic";Ue.RECTANGULAR_ANCHOR_KIND="rectangular";var ig=class extends x1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultAnchorKind(){return Ue.RECTANGULAR_ANCHOR_KIND}get(e,t){return super.get(`${e}:${t||this.defaultAnchorKind}`)}};ig=T1([(0,mE.injectable)(),A1(0,(0,mE.multiInject)(C1.TYPES.IAnchorComputer)),O1("design:paramtypes",[Array])],ig);Ue.AnchorComputerRegistry=ig});var Ta=f(Dt=>{"use strict";var vE=Dt&&Dt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},q1=Dt&&Dt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.AbstractEdgeRouter=Dt.DefaultAnchors=Dt.Side=void 0;var bE=_(),Vo=ee(),rg=ze(),Pt=_e(),yE=oi(),_E=_e(),te;(function(i){i[i.RIGHT=0]="RIGHT",i[i.LEFT=1]="LEFT",i[i.TOP=2]="TOP",i[i.BOTTOM=3]="BOTTOM"})(te=Dt.Side||(Dt.Side={}));var Ma=class{constructor(e,t,n){this.element=e,this.kind=n;let r=e.bounds;this.bounds=(0,rg.translateBounds)(r,e.parent,t),this.left={x:this.bounds.x,y:this.bounds.y+.5*this.bounds.height,kind:n},this.right={x:this.bounds.x+this.bounds.width,y:this.bounds.y+.5*this.bounds.height,kind:n},this.top={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y,kind:n},this.bottom={x:this.bounds.x+.5*this.bounds.width,y:this.bounds.y+this.bounds.height,kind:n}}get(e){return this[te[e].toLowerCase()]}getNearestSide(e){let t=Vo.Point.euclideanDistance(e,this.left),n=Vo.Point.euclideanDistance(e,this.right),r=Vo.Point.euclideanDistance(e,this.top),o=Vo.Point.euclideanDistance(e,this.bottom),s=te.LEFT,a=t;return n<a&&(a=n,s=te.RIGHT),r<a&&(a=r,s=te.TOP),o<a&&(a=o,s=te.BOTTOM),s}};Dt.DefaultAnchors=Ma;var Vd=class{pointAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o,lambda:s}=n;return Vo.Point.linear(r,o,s)}derivativeAt(e,t){let n=this.calculateSegment(e,t);if(!n)return;let{segmentStart:r,segmentEnd:o}=n;return{x:o.x-r.x,y:o.y-r.y}}calculateSegment(e,t){if(t<0||t>1)return;let n=this.route(e);if(n.length<2)return;let r=[],o=0;for(let c=0;c<n.length-1;++c)r[c]=Vo.Point.euclideanDistance(n[c],n[c+1]),o+=r[c];let s=0,a=t*o;for(let c=0;c<n.length-1;++c){let u=s+r[c];if(r[c]>1e-8&&u>=a){let d=Math.max(0,a-s)/r[c];return{segmentStart:n[c],segmentEnd:n[c+1],lambda:d}}s=u}return{segmentEnd:n.pop(),segmentStart:n.pop(),lambda:1}}addHandle(e,t,n,r){let o=new Pt.SRoutingHandle;return o.kind=t,o.pointIndex=r,o.type=n,t==="target"&&e.id===Pt.edgeInProgressID&&(o.id=Pt.edgeInProgressTargetHandleID),e.add(o),o}getHandlePosition(e,t,n){switch(n.kind){case"source":return e.source instanceof Pt.SDanglingAnchor?e.source.position:t[0];case"target":return e.target instanceof Pt.SDanglingAnchor?e.target.position:t[t.length-1];default:let r=this.getInnerHandlePosition(e,t,n);if(r!==void 0)return r;if(n.pointIndex>=0&&n.pointIndex<e.routingPoints.length)return e.routingPoints[n.pointIndex]}}findRouteSegment(e,t,n){let r=a=>a.pointIndex!==void 0?a.pointIndex:a.kind==="target"?e.routingPoints.length:-2,o,s;for(let a of t){let c=r(a);c<=n&&(o===void 0||c>r(o))&&(o=a),c>n&&(s===void 0||c<r(s))&&(s=a)}return{start:o,end:s}}getTranslatedAnchor(e,t,n,r,o=0){let s=(0,rg.translatePoint)(t,n,e.parent),a=this.getAnchorComputer(e),c=.5*e.strokeWidth,u=a.getAnchor(e,s,o+c);return(0,rg.translatePoint)(u,e.parent,r.parent)}getAnchorComputer(e){return this.anchorRegistry.get(this.kind,e.anchorKind)}applyHandleMoves(e,t){let n=t.slice();t.forEach(r=>{let o=r.handle;if(o.kind==="source"&&!(e.source instanceof Pt.SDanglingAnchor)){let s=new Pt.SDanglingAnchor;s.id=e.id+"_dangling-source",s.original=e.source,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.sourceId=s.id}else if(o.kind==="target"&&!(e.target instanceof Pt.SDanglingAnchor)){let s=new Pt.SDanglingAnchor;s.id=e.id+"_dangling-target",s.original=e.target,s.position=r.toPosition,o.root.add(s),o.danglingAnchor=s,e.targetId=s.id}o.danglingAnchor&&(o.danglingAnchor.position=r.toPosition,n.splice(n.indexOf(r),1))}),n.length>0&&this.applyInnerHandleMoves(e,n),this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)}cleanupRoutingPoints(e,t,n,r){let o=new Ma(e.source,e.parent,"source"),s=new Ma(e.target,e.parent,"target");this.resetRoutingPointsOnReconnect(e,t,n,o,s)}resetRoutingPointsOnReconnect(e,t,n,r,o){if(t.length===0||e.source instanceof Pt.SDanglingAnchor||e.target instanceof Pt.SDanglingAnchor){let s=this.getOptions(e),a=this.calculateDefaultCorners(e,r,o,s);if(t.splice(0,t.length,...a),n){let c=-2;e.children.forEach(u=>{u instanceof Pt.SRoutingHandle&&(u.kind==="target"?u.pointIndex=t.length:u.kind==="line"&&u.pointIndex>=t.length?e.remove(u):c=Math.max(u.pointIndex,c))});for(let u=c;u<t.length-1;++u)this.addHandle(e,"manhattan-50%","volatile-routing-point",u)}return!0}return!1}applyReconnect(e,t,n){let r=!1;if(t){let o=e.root.index.getById(t);o instanceof _E.SConnectableElement&&(e.sourceId=o.id,r=!0)}if(n){let o=e.root.index.getById(n);o instanceof _E.SConnectableElement&&(e.targetId=o.id,r=!0)}r&&(e.index.remove(e),e.index.add(e),this.getSelfEdgeIndex(e)>-1&&(e.routingPoints=[],this.cleanupRoutingPoints(e,e.routingPoints,!0,!0)))}takeSnapshot(e){return{routingPoints:e.routingPoints.slice(),routingHandles:e.children.filter(t=>t instanceof Pt.SRoutingHandle).map(t=>t),routedPoints:this.route(e),router:this,source:e.source,target:e.target}}applySnapshot(e,t){e.routingPoints=t.routingPoints,e.removeAll(n=>n instanceof Pt.SRoutingHandle),e.routerKind=t.router.kind,t.routingHandles.forEach(n=>e.add(n)),t.source&&(e.sourceId=t.source.id),t.target&&(e.targetId=t.target.id),e.root.index.remove(e),e.root.index.add(e)}calculateDefaultCorners(e,t,n,r){let o=this.getSelfEdgeIndex(e);if(o>=0){let s=r.standardDistance,a=r.selfEdgeOffset*Math.min(t.bounds.width,t.bounds.height);switch(o%4){case 0:return[{x:t.get(te.RIGHT).x+s,y:t.get(te.RIGHT).y+a},{x:t.get(te.RIGHT).x+s,y:t.get(te.BOTTOM).y+s},{x:t.get(te.BOTTOM).x+a,y:t.get(te.BOTTOM).y+s}];case 1:return[{x:t.get(te.BOTTOM).x-a,y:t.get(te.BOTTOM).y+s},{x:t.get(te.LEFT).x-s,y:t.get(te.BOTTOM).y+s},{x:t.get(te.LEFT).x-s,y:t.get(te.LEFT).y+a}];case 2:return[{x:t.get(te.LEFT).x-s,y:t.get(te.LEFT).y-a},{x:t.get(te.LEFT).x-s,y:t.get(te.TOP).y-s},{x:t.get(te.TOP).x-a,y:t.get(te.TOP).y-s}];case 3:return[{x:t.get(te.TOP).x+a,y:t.get(te.TOP).y-s},{x:t.get(te.RIGHT).x+s,y:t.get(te.TOP).y-s},{x:t.get(te.RIGHT).x+s,y:t.get(te.RIGHT).y-a}]}}return[]}getSelfEdgeIndex(e){return!e.source||e.source!==e.target?-1:e.source.outgoingEdges.filter(t=>t.target===e.source).indexOf(e)}commitRoute(e,t){let n=[];for(let r=1;r<t.length-1;++r)n.push({x:t[r].x,y:t[r].y});e.routingPoints=n}};vE([(0,bE.inject)(yE.AnchorComputerRegistry),q1("design:type",yE.AnchorComputerRegistry)],Vd.prototype,"anchorRegistry",void 0);Vd=vE([(0,bE.injectable)()],Vd);Dt.AbstractEdgeRouter=Vd});var Aa=f(ji=>{"use strict";var wE=ji&&ji.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},D1=ji&&ji.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},og;Object.defineProperty(ji,"__esModule",{value:!0});ji.PolylineEdgeRouter=void 0;var PE=_(),Ko=ee(),SE=_e(),EE=oi(),j1=Ta(),Oa=og=class extends j1.AbstractEdgeRouter{get kind(){return og.KIND}getOptions(e){return{minimalPointDistance:2,removeAngleThreshold:.1,standardDistance:20,selfEdgeOffset:.25}}route(e){let t=e.source,n=e.target;if(t===void 0||n===void 0)return[];let r,o,s=this.getOptions(e),a=e.routingPoints.length>0?e.routingPoints:[];this.cleanupRoutingPoints(e,a,!1,!1);let c=a!==void 0?a.length:0;if(c===0){let d=Ko.Bounds.center(n.bounds);r=this.getTranslatedAnchor(t,d,n.parent,e,e.sourceAnchorCorrection);let l=Ko.Bounds.center(t.bounds);o=this.getTranslatedAnchor(n,l,t.parent,e,e.targetAnchorCorrection)}else{let d=a[0];r=this.getTranslatedAnchor(t,d,e.parent,e,e.sourceAnchorCorrection);let l=a[c-1];o=this.getTranslatedAnchor(n,l,e.parent,e,e.targetAnchorCorrection)}let u=[];u.push({kind:"source",x:r.x,y:r.y});for(let d=0;d<c;d++){let l=a[d];(d>0&&d<c-1||d===0&&Ko.Point.maxDistance(r,l)>=s.minimalPointDistance+(e.sourceAnchorCorrection||0)||d===c-1&&Ko.Point.maxDistance(l,o)>=s.minimalPointDistance+(e.targetAnchorCorrection||0))&&u.push({kind:"linear",x:l.x,y:l.y,pointIndex:d})}return u.push({kind:"target",x:o.x,y:o.y}),this.filterEditModeHandles(u,e,s)}filterEditModeHandles(e,t,n){if(t.children.length===0)return e;let r=0;for(;r<e.length;){let o=e[r];if(o.pointIndex!==void 0){let s=t.children.find(a=>a instanceof SE.SRoutingHandle&&a.kind==="junction"&&a.pointIndex===o.pointIndex);if(s!==void 0&&s.editMode&&r>0&&r<e.length-1){let a=e[r-1],c=e[r+1],u={x:a.x-o.x,y:a.y-o.y},d={x:c.x-o.x,y:c.y-o.y},l=(0,Ko.angleBetweenPoints)(u,d);if(Math.abs(Math.PI-l)<n.removeAngleThreshold){e.splice(r,1);continue}}}r++}return e}createRoutingHandles(e){let t=e.routingPoints.length;this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"line","volatile-routing-point",-1);for(let n=0;n<t;n++)this.addHandle(e,"junction","routing-point",n),this.addHandle(e,"line","volatile-routing-point",n);this.addHandle(e,"target","routing-point",t)}getInnerHandlePosition(e,t,n){if(n.kind==="line"){let{start:r,end:o}=this.findRouteSegment(e,t,n.pointIndex);if(r!==void 0&&o!==void 0)return(0,Ko.centerOfLine)(r,o)}}applyInnerHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o=e.routingPoints,s=r.pointIndex;r.kind==="line"&&(r.kind="junction",r.type="routing-point",o.splice(s+1,0,n.fromPosition||o[Math.max(s,0)]),e.children.forEach(a=>{a instanceof SE.SRoutingHandle&&(a===r||a.pointIndex>s)&&a.pointIndex++}),this.addHandle(e,"line","volatile-routing-point",s),s++,this.addHandle(e,"line","volatile-routing-point",s)),s>=0&&s<o.length&&(o[s]=n.toPosition)})}};Oa.KIND="polyline";wE([(0,PE.inject)(EE.AnchorComputerRegistry),D1("design:type",EE.AnchorComputerRegistry)],Oa.prototype,"anchorRegistry",void 0);Oa=og=wE([(0,PE.injectable)()],Oa);ji.PolylineEdgeRouter=Oa});var gn=f(rn=>{"use strict";var IE=rn&&rn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},RE=rn&&rn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},N1=rn&&rn.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(rn,"__esModule",{value:!0});rn.EdgeRouting=rn.EdgeRouterRegistry=void 0;var Kd=_(),L1=$(),ME=P(),B1=go(),F1=Mn(),V1=_e(),K1=Aa();function H1(i){return i.routeAll!==void 0}var Hd=class extends F1.InstanceRegistry{constructor(e){super(),e.forEach(t=>this.register(t.kind,t))}get defaultKind(){return K1.PolylineEdgeRouter.KIND}get(e){return super.get(e||this.defaultKind)}routeAllChildren(e){let t=this.doRouteAllChildren(e);for(let n of this.postProcessors)n.apply(t);return t}doRouteAllChildren(e){let t=new zd,n=new Map,r=[e];for(;r.length>0;){let o=r.shift();for(let s of o.children){if(s instanceof V1.SRoutableElement){let a=s.routerKind||this.defaultKind;n.has(a)?n.get(a).push(s):n.set(a,[s])}s instanceof L1.SParentElement&&r.push(s)}}return n.forEach((o,s)=>{let a=this.get(s);if(H1(a))t.setAll(a.routeAll(o,e));else for(let c of o)t.set(c.id,this.route(c))}),t}route(e,t){let n=(0,B1.findArgValue)(t,"edgeRouting");if(n){let o=n.get(e.id);if(o)return o}return this.get(e.routerKind).route(e)}};IE([(0,Kd.multiInject)(ME.TYPES.IEdgeRoutePostprocessor),(0,Kd.optional)(),RE("design:type",Array)],Hd.prototype,"postProcessors",void 0);Hd=IE([(0,Kd.injectable)(),N1(0,(0,Kd.multiInject)(ME.TYPES.IEdgeRouter)),RE("design:paramtypes",[Array])],Hd);rn.EdgeRouterRegistry=Hd;var zd=class{constructor(){this.routesMap=new Map}set(e,t){this.routesMap.set(e,t)}setAll(e){e.routes.forEach((t,n)=>this.set(n,t))}get(e){return this.routesMap.get(e)}get routes(){return this.routesMap}};rn.EdgeRouting=zd});var sg=f(Ni=>{"use strict";var AE=Ni&&Ni.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},z1=Ni&&Ni.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.EdgeLayoutPostprocessor=void 0;var CE=_(),rt=ee(),Y1=$(),U1=Be(),k1=Rr(),Yd=ue(),TE=Bo(),OE=gn(),Ud=class{decorate(e,t){if((0,TE.isEdgeLayoutable)(t)&&t.parent instanceof k1.SEdge&&t.bounds!==rt.Bounds.EMPTY){let n=this.getEdgePlacement(t),r=t.parent,o=Math.min(1,Math.max(0,n.position)),s=this.edgeRouterRegistry.get(r.routerKind),a=s.pointAt(r,o),c=s.derivativeAt(r,o),u="";if(a&&c){u+=`translate(${a.x}, ${a.y})`;let d=(0,rt.toDegrees)(Math.atan2(c.y,c.x));if(n.rotate){let l=d;Math.abs(d)>90&&(d<0?l+=180:d>0&&(l-=180)),u+=` rotate(${l})`;let S=this.getRotatedAlignment(t,n,l!==d);u+=` translate(${S.x}, ${S.y})`}else{let l=this.getAlignment(t,n,d);u+=` translate(${l.x}, ${l.y})`}(0,U1.setAttr)(e,"transform",u)}}return e}getRotatedAlignment(e,t,n){let r=(0,Yd.isAlignable)(e)?e.alignment.x:0,o=(0,Yd.isAlignable)(e)?e.alignment.y:0,s=e.bounds;if(t.side==="on")return{x:r-.5*s.height,y:o-.5*s.height};if(n)switch(t.position<.3333333?r-=s.width+t.offset:t.position<.6666666?r-=.5*s.width:r+=t.offset,t.side){case"left":case"bottom":o-=t.offset+s.height;break;case"right":case"top":o+=t.offset}else switch(t.position<.3333333?r+=t.offset:t.position<.6666666?r-=.5*s.width:r-=s.width+t.offset,t.side){case"right":case"bottom":o+=-t.offset-s.height;break;case"left":case"top":o+=t.offset}return{x:r,y:o}}getEdgePlacement(e){let t=e,n=[];for(;t!==void 0;){let r=t.edgePlacement;if(r!==void 0&&n.push(r),t instanceof Y1.SChildElement)t=t.parent;else break}return n.reverse().reduce((r,o)=>Object.assign(Object.assign({},r),o),TE.DEFAULT_EDGE_PLACEMENT)}getAlignment(e,t,n){let r=e.bounds,o=(0,Yd.isAlignable)(e)?e.alignment.x-r.width:0,s=(0,Yd.isAlignable)(e)?e.alignment.y-r.height:0;if(t.side==="on")return{x:o+.5*r.height,y:s+.5*r.height};let a=this.getQuadrant(n),c={x:t.offset,y:s+.5*r.height},u={x:t.offset,y:s+r.height+t.offset},d={x:-r.width-t.offset,y:s+r.height+t.offset},l={x:-r.width-t.offset,y:s+.5*r.height},S={x:-r.width-t.offset,y:s-t.offset},R={x:t.offset,y:s-t.offset};switch(t.side){case"left":switch(a.orientation){case"west":return rt.Point.linear(u,d,a.position);case"north":return rt.Point.linear(d,S,a.position);case"east":return rt.Point.linear(S,R,a.position);case"south":return rt.Point.linear(R,u,a.position)}break;case"right":switch(a.orientation){case"west":return rt.Point.linear(S,R,a.position);case"north":return rt.Point.linear(R,u,a.position);case"east":return rt.Point.linear(u,d,a.position);case"south":return rt.Point.linear(d,S,a.position)}break;case"top":switch(a.orientation){case"west":return rt.Point.linear(S,R,a.position);case"north":return this.linearFlip(R,c,l,S,a.position);case"east":return rt.Point.linear(S,R,a.position);case"south":return this.linearFlip(R,c,l,S,a.position)}break;case"bottom":switch(a.orientation){case"west":return rt.Point.linear(u,d,a.position);case"north":return this.linearFlip(d,l,c,u,a.position);case"east":return rt.Point.linear(u,d,a.position);case"south":return this.linearFlip(d,l,c,u,a.position)}break}return{x:0,y:0}}getQuadrant(e){return Math.abs(e)>135?{orientation:"west",position:(e>0?e-135:e+225)/90}:e<-45?{orientation:"north",position:(e+135)/90}:e<45?{orientation:"east",position:(e+45)/90}:{orientation:"south",position:(e-45)/90}}linearFlip(e,t,n,r,o){return o<.5?rt.Point.linear(e,t,2*o):rt.Point.linear(n,r,2*o-1)}postUpdate(){}};AE([(0,CE.inject)(OE.EdgeRouterRegistry),z1("design:type",OE.EdgeRouterRegistry)],Ud.prototype,"edgeRouterRegistry",void 0);Ud=AE([(0,CE.injectable)()],Ud);Ni.EdgeLayoutPostprocessor=Ud});var kd=f(cg=>{"use strict";Object.defineProperty(cg,"__esModule",{value:!0});var G1=_(),xE=P(),ag=sg(),$1=new G1.ContainerModule(i=>{i(ag.EdgeLayoutPostprocessor).toSelf().inSingletonScope(),i(xE.TYPES.IVNodePostprocessor).toService(ag.EdgeLayoutPostprocessor),i(xE.TYPES.HiddenVNodePostprocessor).toService(ag.EdgeLayoutPostprocessor)});cg.default=$1});var jE=f(jt=>{"use strict";var W1=jt&&jt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},X1=jt&&jt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},J1=jt&&jt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.CreateElementCommand=jt.CreateElementAction=void 0;var qE=_(),Z1=me(),Q1=$(),eq=P(),DE;(function(i){i.KIND="createElement";function e(t,n){return{kind:i.KIND,elementSchema:t,containerId:n.containerId}}i.create=e})(DE=jt.CreateElementAction||(jt.CreateElementAction={}));var Gd=class extends Z1.Command{constructor(e){super(),this.action=e}execute(e){let t=e.root.index.getById(this.action.containerId);return t instanceof Q1.SParentElement&&(this.container=t,this.newElement=e.modelFactory.createElement(this.action.elementSchema),this.container.add(this.newElement)),e.root}undo(e){return this.container.remove(this.newElement),e.root}redo(e){return this.container.add(this.newElement),e.root}};Gd.KIND=DE.KIND;Gd=W1([(0,qE.injectable)(),J1(0,(0,qE.inject)(eq.TYPES.Action)),X1("design:paramtypes",[Object])],Gd);jt.CreateElementCommand=Gd});var ug=f(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.isCreatingOnDrag=Mr.creatingOnDragFeature=void 0;Mr.creatingOnDragFeature=Symbol("creatingOnDragFeature");function tq(i){return i.hasFeature(Mr.creatingOnDragFeature)&&i.createAction!==void 0}Mr.isCreatingOnDrag=tq});var Or=f(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.intersection=M.PointToPointLine=M.Diamond=M.linear=M.almostEquals=M.toRadians=M.toDegrees=M.magnitude=M.normalize=M.shiftTowards=M.angleBetweenPoints=M.angleOfPoint=M.maxDistance=M.manhattanDistance=M.euclideanDistance=M.Direction=M.includes=M.centerOfLine=M.center=M.translate=M.combine=M.isBounds=M.EMPTY_BOUNDS=M.isValidDimension=M.EMPTY_DIMENSION=M.pointEquals=M.subtract=M.add=M.ORIGIN_POINT=void 0;M.ORIGIN_POINT=Object.freeze({x:0,y:0});function NE(i,e){return{x:i.x+e.x,y:i.y+e.y}}M.add=NE;function LE(i,e){return{x:i.x-e.x,y:i.y-e.y}}M.subtract=LE;function Ca(i,e){return i.x===e.x&&i.y===e.y}M.pointEquals=Ca;M.EMPTY_DIMENSION=Object.freeze({width:-1,height:-1});function $d(i){return i.width>=0&&i.height>=0}M.isValidDimension=$d;M.EMPTY_BOUNDS=Object.freeze({x:0,y:0,width:-1,height:-1});function nq(i){return"x"in i&&"y"in i&&"width"in i&&"height"in i}M.isBounds=nq;function iq(i,e){if(!$d(i))return $d(e)?e:M.EMPTY_BOUNDS;if(!$d(e))return i;let t=Math.min(i.x,e.x),n=Math.min(i.y,e.y),r=Math.max(i.x+(i.width>=0?i.width:0),e.x+(e.width>=0?e.width:0)),o=Math.max(i.y+(i.height>=0?i.height:0),e.y+(e.height>=0?e.height:0));return{x:t,y:n,width:r-t,height:o-n}}M.combine=iq;function rq(i,e){return{x:i.x+e.x,y:i.y+e.y,width:i.width,height:i.height}}M.translate=rq;function lg(i){return{x:i.x+(i.width>=0?.5*i.width:0),y:i.y+(i.height>=0?.5*i.height:0)}}M.center=lg;function oq(i,e){let t={x:i.x>e.x?e.x:i.x,y:i.y>e.y?e.y:i.y,width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)};return lg(t)}M.centerOfLine=oq;function sq(i,e){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}M.includes=sq;var aq;(function(i){i[i.left=0]="left",i[i.right=1]="right",i[i.up=2]="up",i[i.down=3]="down"})(aq=M.Direction||(M.Direction={}));function cq(i,e){let t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}M.euclideanDistance=cq;function uq(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}M.manhattanDistance=uq;function dq(i,e){return Math.max(Math.abs(e.x-i.x),Math.abs(e.y-i.y))}M.maxDistance=dq;function lq(i){return Math.atan2(i.y,i.x)}M.angleOfPoint=lq;function fq(i,e){let t=Math.sqrt((i.x*i.x+i.y*i.y)*(e.x*e.x+e.y*e.y));if(isNaN(t)||t===0)return NaN;let n=i.x*e.x+i.y*e.y;return Math.acos(n/t)}M.angleBetweenPoints=fq;function hq(i,e,t){let n=LE(e,i),r=BE(n),o={x:r.x*t,y:r.y*t};return NE(i,o)}M.shiftTowards=hq;function BE(i){let e=FE(i);return e===0||e===1?M.ORIGIN_POINT:{x:i.x/e,y:i.y/e}}M.normalize=BE;function FE(i){return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}M.magnitude=FE;function VE(i){return i*180/Math.PI}M.toDegrees=VE;function pq(i){return i*Math.PI/180}M.toRadians=pq;function gq(i,e){return Math.abs(i-e)<.001}M.almostEquals=gq;function mq(i,e,t){return{x:(1-t)*i.x+t*e.x,y:(1-t)*i.y+t*e.y}}M.linear=mq;var dg=class{constructor(e){this.bounds=e}get topPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y}}get rightPoint(){return{x:this.bounds.x+this.bounds.width,y:this.bounds.y+this.bounds.height/2}}get bottomPoint(){return{x:this.bounds.x+this.bounds.width/2,y:this.bounds.y+this.bounds.height}}get leftPoint(){return{x:this.bounds.x,y:this.bounds.y+this.bounds.height/2}}get topRightSideLine(){return new Tr(this.topPoint,this.rightPoint)}get topLeftSideLine(){return new Tr(this.topPoint,this.leftPoint)}get bottomRightSideLine(){return new Tr(this.bottomPoint,this.rightPoint)}get bottomLeftSideLine(){return new Tr(this.bottomPoint,this.leftPoint)}closestSideLine(e){let t=lg(this.bounds);return e.x>t.x?e.y>t.y?this.bottomRightSideLine:this.topRightSideLine:e.y>t.y?this.bottomLeftSideLine:this.topLeftSideLine}};M.Diamond=dg;var Tr=class{constructor(e,t){this.p1=e,this.p2=t}get a(){return this.p1.y-this.p2.y}get b(){return this.p2.x-this.p1.x}get c(){return this.p2.x*this.p1.y-this.p1.x*this.p2.y}get angle(){return Math.atan2(-this.a,this.b)}get slope(){if(this.b!==0)return this.a/this.b}get slopeOrMax(){return this.slope===void 0?Number.MAX_SAFE_INTEGER:this.slope}get direction(){let e=VE(this.angle),t=e<0?360+e:e;if(t===90)return"south";if(t===0||t===360)return"east";if(t===270)return"north";if(t===180)return"west";if(t>0&&t<90)return"south-east";if(t>90&&t<180)return"south-west";if(t>180&&t<270)return"north-west";if(t>270&&t<360)return"north-east";throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`)}intersection(e){if(this.hasIndistinctPoints(e))return;let t=this.p1.x,n=this.p1.y,r=this.p2.x,o=this.p2.y,s=e.p1.x,a=e.p1.y,c=e.p2.x,u=e.p2.y,d=(u-a)*(r-t)-(c-s)*(o-n);if(d===0)return;let l=(c-s)*(n-a)-(u-a)*(t-s),S=(r-t)*(n-a)-(o-n)*(t-s);if(l===0&&S===0)return;let R=l/d,v=S/d;if(R<0||R>1||v<0||v>1)return;let m=t+R*(r-t),T=n+R*(o-n);return{x:m,y:T}}hasIndistinctPoints(e){return Ca(this.p1,e.p1)||Ca(this.p1,e.p2)||Ca(this.p2,e.p1)||Ca(this.p2,e.p2)}};M.PointToPointLine=Tr;function yq(i,e){return{x:(i.c*e.b-e.c*i.b)/(i.a*e.b-e.a*i.b),y:(i.a*e.c-e.a*i.c)/(i.a*e.b-e.a*i.b)}}M.intersection=yq});var _g=f(It=>{"use strict";var xa=It&&It.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(It,"__esModule",{value:!0});It.EmptyGroupView=It.DiamondNodeView=It.RectangularNodeView=It.CircularNodeView=It.SvgViewportView=void 0;var si=Wt(),Ho=Rr(),yg=ya(),_q=Or(),qa=_(),fg=class{render(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,si.svg)("svg",null,(0,si.svg)("g",{transform:r},t.renderChildren(e)))}};fg=xa([(0,qa.injectable)()],fg);It.SvgViewportView=fg;var hg=class extends yg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=this.getRadius(e);return(0,si.svg)("g",null,(0,si.svg)("circle",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r,cx:r,cy:r}),t.renderChildren(e))}getRadius(e){let t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};hg=xa([(0,qa.injectable)()],hg);It.CircularNodeView=hg;var pg=class extends yg.ShapeView{render(e,t,n){if(this.isVisible(e,t))return(0,si.svg)("g",null,(0,si.svg)("rect",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};pg=xa([(0,qa.injectable)()],pg);It.RectangularNodeView=pg;var gg=class extends yg.ShapeView{render(e,t,n){if(!this.isVisible(e,t))return;let r=new _q.Diamond({height:Math.max(e.size.height,0),width:Math.max(e.size.width,0),x:0,y:0}),o=`${Wd(r.topPoint)} ${Wd(r.rightPoint)} ${Wd(r.bottomPoint)} ${Wd(r.leftPoint)}`;return(0,si.svg)("g",null,(0,si.svg)("polygon",{"class-sprotty-node":e instanceof Ho.SNode,"class-sprotty-port":e instanceof Ho.SPort,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,points:o}),t.renderChildren(e))}};gg=xa([(0,qa.injectable)()],gg);It.DiamondNodeView=gg;function Wd(i){return`${i.x},${i.y}`}var mg=class{render(e,t){return(0,si.svg)("g",null)}};mg=xa([(0,qa.injectable)()],mg);It.EmptyGroupView=mg});var Zd=f(oe=>{"use strict";var vq=oe&&oe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},bq=oe&&oe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Sq=oe&&oe.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(oe,"__esModule",{value:!0});oe.getEditableLabel=oe.EditLabelKeyListener=oe.EditLabelMouseListener=oe.ApplyLabelEditCommand=oe.ResolvedLabelEdit=oe.isApplyLabelEditAction=oe.ApplyLabelEditAction=oe.isEditLabelAction=oe.EditLabelAction=void 0;var Eq=_(),KE=ie(),wq=me(),Pq=P(),Iq=At(),Rq=dn(),Mq=An(),Tq=wt(),Oq=or(),vg=Fo(),Jd;(function(i){i.KIND="EditLabel";function e(t){return{kind:i.KIND,labelId:t}}i.create=e})(Jd=oe.EditLabelAction||(oe.EditLabelAction={}));function Aq(i){return(0,KE.isAction)(i)&&i.kind===Jd.KIND&&"labelId"in i}oe.isEditLabelAction=Aq;var wg;(function(i){i.KIND="applyLabelEdit";function e(t,n){return{kind:i.KIND,labelId:t,text:n}}i.create=e})(wg=oe.ApplyLabelEditAction||(oe.ApplyLabelEditAction={}));function Cq(i){return(0,KE.isAction)(i)&&i.kind===wg.KIND&&"labelId"in i&&"text"in i}oe.isApplyLabelEditAction=Cq;var bg=class{};oe.ResolvedLabelEdit=bg;var Xd=class extends wq.Command{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.labelId);return n&&(0,vg.isEditableLabel)(n)&&(this.resolvedLabelEdit={label:n,oldLabel:n.text,newLabel:this.action.text},n.text=this.action.text),e.root}undo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.oldLabel),e.root}redo(e){return this.resolvedLabelEdit&&(this.resolvedLabelEdit.label.text=this.resolvedLabelEdit.newLabel),e.root}};Xd.KIND=wg.KIND;Xd=vq([Sq(0,(0,Eq.inject)(Pq.TYPES.Action)),bq("design:paramtypes",[Object])],Xd);oe.ApplyLabelEditCommand=Xd;var Sg=class extends Iq.MouseListener{doubleClick(e,t){let n=Pg(e);return n?[Jd.create(n.id)]:[]}};oe.EditLabelMouseListener=Sg;var Eg=class extends Rq.KeyListener{keyDown(e,t){if((0,Mq.matchesKeystroke)(t,"F2")){let n=(0,Oq.toArray)(e.index.all().filter(r=>(0,Tq.isSelectable)(r)&&r.selected)).map(Pg).filter(r=>r!==void 0);if(n.length===1)return[Jd.create(n[0].id)]}return[]}};oe.EditLabelKeyListener=Eg;function Pg(i){if((0,vg.isEditableLabel)(i))return i;if((0,vg.isWithEditableLabel)(i)&&i.editableLabel)return i.editableLabel}oe.getEditableLabel=Pg});var Ar=f(mn=>{"use strict";var Qd=mn&&mn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ig=mn&&mn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(mn,"__esModule",{value:!0});mn.SvgExporter=mn.ExportSvgAction=void 0;var el=_(),HE=ee(),xq=ue(),qq=gu(),Rg=P(),zE;(function(i){i.KIND="exportSvg";function e(t,n){return{kind:i.KIND,svg:t,responseId:n}}i.create=e})(zE=mn.ExportSvgAction||(mn.ExportSvgAction={}));var zo=class{export(e,t){if(typeof document<"u"){let n=document.getElementById(this.options.hiddenDiv);if(n!==null&&n.firstElementChild&&n.firstElementChild.tagName==="svg"){let r=n.firstElementChild,o=this.createSvg(r,e);this.actionDispatcher.dispatch(zE.create(o,t?t.requestId:""))}}}createSvg(e,t){let n=new XMLSerializer,r=n.serializeToString(e),o=document.createElement("iframe");if(document.body.appendChild(o),!o.contentWindow)throw new Error("IFrame has no contentWindow");let s=o.contentWindow.document;s.open(),s.write(r),s.close();let a=s.getElementById(e.id);a.removeAttribute("opacity"),this.copyStyles(e,a,["width","height","opacity"]),a.setAttribute("version","1.1");let c=this.getBounds(t);a.setAttribute("viewBox",`${c.x} ${c.y} ${c.width} ${c.height}`);let u=n.serializeToString(a);return document.body.removeChild(o),u}copyStyles(e,t,n){let r=getComputedStyle(e),o=getComputedStyle(t),s="";for(let a=0;a<r.length;a++){let c=r[a];if(n.indexOf(c)===-1){let u=r.getPropertyValue(c);o.getPropertyValue(c)!==u&&(s+=c+":"+u+";")}}s!==""&&t.setAttribute("style",s);for(let a=0;a<e.childNodes.length;++a){let c=e.childNodes[a],u=t.childNodes[a];c instanceof Element&&this.copyStyles(c,u,[])}}getBounds(e){let t=[HE.Bounds.EMPTY];return e.children.forEach(n=>{(0,xq.isBoundsAware)(n)&&t.push(n.bounds)}),t.reduce((n,r)=>HE.Bounds.combine(n,r))}};Qd([(0,el.inject)(Rg.TYPES.ViewerOptions),Ig("design:type",Object)],zo.prototype,"options",void 0);Qd([(0,el.inject)(Rg.TYPES.IActionDispatcher),Ig("design:type",qq.ActionDispatcher)],zo.prototype,"actionDispatcher",void 0);Qd([(0,el.inject)(Rg.TYPES.ILogger),Ig("design:type",Object)],zo.prototype,"log",void 0);zo=Qd([(0,el.injectable)()],zo);mn.SvgExporter=zo});var Yo=f(Nn=>{"use strict";var tl=Nn&&Nn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},YE=Nn&&Nn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.ComputedBoundsApplicator=Nn.ModelSource=void 0;var nl=_(),Dq=ie(),jq=Pi(),UE=P(),Nq=Ar(),Da=class{initialize(e){e.register(Dq.RequestModelAction.KIND,this),e.register(Nq.ExportSvgAction.KIND,this)}};tl([(0,nl.inject)(UE.TYPES.IActionDispatcher),YE("design:type",Object)],Da.prototype,"actionDispatcher",void 0);tl([(0,nl.inject)(UE.TYPES.ViewerOptions),YE("design:type",Object)],Da.prototype,"viewerOptions",void 0);Da=tl([(0,nl.injectable)()],Da);Nn.ModelSource=Da;var Mg=class{apply(e,t){let n=new jq.SModelIndex;n.add(e);for(let r of t.bounds){let o=n.getById(r.elementId);o!==void 0&&this.applyBounds(o,r.newPosition,r.newSize)}if(t.alignments!==void 0)for(let r of t.alignments){let o=n.getById(r.elementId);o!==void 0&&this.applyAlignment(o,r.newAlignment)}return n}applyAlignment(e,t){let n=e;n.alignment={x:t.x,y:t.y}}applyBounds(e,t,n){let r=e;t&&(r.position=Object.assign({},t)),r.size=Object.assign({},n)}};Mg=tl([(0,nl.injectable)()],Mg);Nn.ComputedBoundsApplicator=Mg});var Na=f(Nt=>{"use strict";var kE=Nt&&Nt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},GE=Nt&&Nt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Lq=Nt&&Nt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.CommitModelCommand=Nt.CommitModelAction=void 0;var Tg=_(),Bq=me(),$E=P(),Fq=Yo(),WE;(function(i){i.KIND="commitModel";function e(){return{kind:i.KIND}}i.create=e})(WE=Nt.CommitModelAction||(Nt.CommitModelAction={}));var ja=class extends Bq.SystemCommand{constructor(e){super(),this.action=e}execute(e){return this.newModel=e.modelFactory.createSchema(e.root),this.doCommit(this.newModel,e.root,!0)}doCommit(e,t,n){let r=this.modelSource.commitModel(e);return r instanceof Promise?r.then(o=>(n&&(this.originalModel=o),t)):(n&&(this.originalModel=r),t)}undo(e){return this.doCommit(this.originalModel,e.root,!1)}redo(e){return this.doCommit(this.newModel,e.root,!1)}};ja.KIND=WE.KIND;kE([(0,Tg.inject)($E.TYPES.ModelSource),GE("design:type",Fq.ModelSource)],ja.prototype,"modelSource",void 0);ja=kE([(0,Tg.injectable)(),Lq(0,(0,Tg.inject)($E.TYPES.Action)),GE("design:paramtypes",[Object])],ja);Nt.CommitModelCommand=ja});var il=f(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.ZoomMouseListener=Li.getZoom=Li.isZoomable=void 0;var Vq=ie(),Kq=On(),Hq=At(),XE=ze(),JE=Dn();function zq(i){return"zoom"in i}Li.isZoomable=zq;function Yq(i){let e=1,t=(0,XE.findParentByFeature)(i,JE.isViewport);return t&&(e=t.zoom),e}Li.getZoom=Yq;var Og=class extends Hq.MouseListener{wheel(e,t){let n=(0,XE.findParentByFeature)(e,JE.isViewport);if(n){let r=this.getZoomFactor(t),o=this.getViewportOffset(e.root,t),s=1/(r*n.zoom)-1/n.zoom,a={scroll:{x:n.scroll.x-s*o.x,y:n.scroll.y-s*o.y},zoom:n.zoom*r};return[Vq.SetViewportAction.create(n.id,a,{animate:!1})]}return[]}getViewportOffset(e,t){let n=e.canvasBounds,r=(0,Kq.getWindowScroll)();return{x:t.clientX+r.x-n.x,y:t.clientY+r.y-n.y}}getZoomFactor(e){return e.deltaMode===e.DOM_DELTA_PAGE?Math.exp(-e.deltaY*.5):e.deltaMode===e.DOM_DELTA_LINE?Math.exp(-e.deltaY*.05):Math.exp(-e.deltaY*.005)}};Li.ZoomMouseListener=Og});var xg=f(Bn=>{"use strict";var Cr=Bn&&Bn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},La=Bn&&Bn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Ag;Object.defineProperty(Bn,"__esModule",{value:!0});Bn.EditLabelUI=Bn.EditLabelActionHandler=void 0;var ai=_(),Uq=ie(),Ba=P(),kq=Bu(),Gq=ea(),$q=lo(),Wq=Na(),ZE=An(),Xq=ue(),QE=il(),Jq=Zd(),Zq=Fo(),Cg=class{handle(e){if((0,Jq.isEditLabelAction)(e))return Gq.SetUIExtensionVisibilityAction.create({extensionId:Ln.ID,visible:!0,contextElementsId:[e.labelId]})}};Cg=Cr([(0,ai.injectable)()],Cg);Bn.EditLabelActionHandler=Cg;var Ln=Ag=class extends kq.AbstractUIExtension{constructor(){super(...arguments),this.validationTimeout=void 0,this.isActive=!1,this.blockApplyEditOnInvalidInput=!0,this.isCurrentLabelValid=!0}id(){return Ag.ID}containerClass(){return"label-edit"}get labelId(){return this.label?this.label.id:"unknown"}initializeContents(e){e.style.position="absolute",this.inputElement=document.createElement("input"),this.textAreaElement=document.createElement("textarea"),[this.inputElement,this.textAreaElement].forEach(t=>{t.onkeydown=n=>this.applyLabelEditOnEvent(n,"Enter"),this.configureAndAdd(t,e)})}configureAndAdd(e,t){e.style.visibility="hidden",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.addEventListener("keydown",n=>this.hideIfEscapeEvent(n)),e.addEventListener("keyup",n=>this.validateLabelIfContentChange(n,e.value)),e.addEventListener("blur",()=>window.setTimeout(()=>this.applyLabelEdit(),200)),t.appendChild(e)}get editControl(){return this.label&&this.label.isMultiLine?this.textAreaElement:this.inputElement}hideIfEscapeEvent(e){(0,ZE.matchesKeystroke)(e,"Escape")&&this.hide()}applyLabelEditOnEvent(e,t,...n){(0,ZE.matchesKeystroke)(e,t||"Enter",...n)&&(e.preventDefault(),this.applyLabelEdit())}validateLabelIfContentChange(e,t){(this.previousLabelContent===void 0||this.previousLabelContent!==t)&&(this.previousLabelContent=t,this.performLabelValidation(e,this.editControl.value))}async applyLabelEdit(){var e;if(this.isActive){if(((e=this.label)===null||e===void 0?void 0:e.text)===this.editControl.value){this.hide();return}if(this.blockApplyEditOnInvalidInput&&(await this.validateLabel(this.editControl.value)).severity==="error"){this.editControl.focus();return}this.actionDispatcherProvider().then(t=>t.dispatchAll([Uq.ApplyLabelEditAction.create(this.labelId,this.editControl.value),Wq.CommitModelAction.create()])).catch(t=>this.logger.error(this,"No action dispatcher available to execute apply label edit action",t)),this.hide()}}performLabelValidation(e,t){this.validationTimeout&&window.clearTimeout(this.validationTimeout),this.validationTimeout=window.setTimeout(()=>this.validateLabel(t),200)}async validateLabel(e){if(this.labelValidator&&this.label)try{let t=await this.labelValidator.validate(e,this.label);return this.isCurrentLabelValid=t.severity!=="error",this.showValidationResult(t),t}catch(t){this.logger.error(this,"Error validating edited label",t)}return this.isCurrentLabelValid=!0,{severity:"ok",message:void 0}}showValidationResult(e){this.clearValidationResult(),this.validationDecorator&&this.validationDecorator.decorate(this.editControl,e)}clearValidationResult(){this.validationDecorator&&this.validationDecorator.dispose(this.editControl)}show(e,...t){!Qq(t,e)||this.isActive||(super.show(e,...t),this.isActive=!0)}hide(){this.editControl.style.visibility="hidden",super.hide(),this.clearValidationResult(),this.isActive=!1,this.isCurrentLabelValid=!0,this.previousLabelContent=void 0,this.labelElement&&(this.labelElement.style.visibility="visible")}onBeforeShow(e,t,...n){this.label=e0(n,t)[0],this.previousLabelContent=this.label.text,this.setPosition(e),this.applyTextContents(),this.applyFontStyling(),this.editControl.style.visibility="visible",this.editControl.focus()}setPosition(e){let t=0,n=0,r=100,o=20;if(this.label){let s=(0,QE.getZoom)(this.label),a=(0,Xq.getAbsoluteClientBounds)(this.label,this.domHelper,this.viewerOptions);t=a.x+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.x:0)*s,n=a.y+(this.label.editControlPositionCorrection?this.label.editControlPositionCorrection.y:0)*s,o=(this.label.editControlDimension?this.label.editControlDimension.height:o)*s,r=(this.label.editControlDimension?this.label.editControlDimension.width:r)*s}e.style.left=`${t}px`,e.style.top=`${n}px`,e.style.width=`${r}px`,this.editControl.style.width=`${r}px`,e.style.height=`${o}px`,this.editControl.style.height=`${o}px`}applyTextContents(){this.label&&(this.editControl.value=this.label.text,this.editControl instanceof HTMLTextAreaElement?(this.editControl.selectionStart=0,this.editControl.selectionEnd=0,this.editControl.scrollTop=0,this.editControl.scrollLeft=0):this.editControl.setSelectionRange(0,this.editControl.value.length))}applyFontStyling(){if(this.label&&(this.labelElement=document.getElementById(this.domHelper.createUniqueDOMElementId(this.label)),this.labelElement)){this.labelElement.style.visibility="hidden";let e=window.getComputedStyle(this.labelElement);this.editControl.style.font=e.font,this.editControl.style.fontStyle=e.fontStyle,this.editControl.style.fontFamily=e.fontFamily,this.editControl.style.fontSize=eD(e.fontSize,(0,QE.getZoom)(this.label)),this.editControl.style.fontWeight=e.fontWeight,this.editControl.style.lineHeight=e.lineHeight}}};Ln.ID="editLabelUi";Cr([(0,ai.inject)(Ba.TYPES.IActionDispatcherProvider),La("design:type",Function)],Ln.prototype,"actionDispatcherProvider",void 0);Cr([(0,ai.inject)(Ba.TYPES.ViewerOptions),La("design:type",Object)],Ln.prototype,"viewerOptions",void 0);Cr([(0,ai.inject)(Ba.TYPES.DOMHelper),La("design:type",$q.DOMHelper)],Ln.prototype,"domHelper",void 0);Cr([(0,ai.inject)(Ba.TYPES.IEditLabelValidator),(0,ai.optional)(),La("design:type",Object)],Ln.prototype,"labelValidator",void 0);Cr([(0,ai.inject)(Ba.TYPES.IEditLabelValidationDecorator),(0,ai.optional)(),La("design:type",Object)],Ln.prototype,"validationDecorator",void 0);Ln=Ag=Cr([(0,ai.injectable)()],Ln);Bn.EditLabelUI=Ln;function Qq(i,e){return e0(i,e).length===1}function e0(i,e){return i.map(t=>e.index.getById(t)).filter(Zq.isEditableLabel)}function eD(i,e){return i.replace(/([0-9]+)/,t=>String(Number.parseInt(t,10)*e))}});var Va=f(Lt=>{"use strict";var i0=Lt&&Lt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},r0=Lt&&Lt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},tD=Lt&&Lt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.SwitchEditModeCommand=Lt.SwitchEditModeAction=void 0;var qg=_(),nD=me(),iD=$(),rD=P(),yn=_e(),t0=gn(),n0=Fo(),o0;(function(i){i.KIND="switchEditMode";function e(t){var n,r;return{kind:i.KIND,elementsToActivate:(n=t.elementsToActivate)!==null&&n!==void 0?n:[],elementsToDeactivate:(r=t.elementsToDeactivate)!==null&&r!==void 0?r:[]}}i.create=e})(o0=Lt.SwitchEditModeAction||(Lt.SwitchEditModeAction={}));var Fa=class extends nD.Command{constructor(e){super(),this.action=e,this.elementsToActivate=[],this.elementsToDeactivate=[],this.handlesToRemove=[]}execute(e){let t=e.root.index;return this.action.elementsToActivate.forEach(n=>{let r=t.getById(n);r!==void 0&&this.elementsToActivate.push(r)}),this.action.elementsToDeactivate.forEach(n=>{let r=t.getById(n);if(r!==void 0&&this.elementsToDeactivate.push(r),r instanceof yn.SRoutingHandle&&r.parent instanceof yn.SRoutableElement){let o=r.parent;this.shouldRemoveHandle(r,o)&&(this.handlesToRemove.push({handle:r,parent:o}),this.elementsToDeactivate.push(o),this.elementsToActivate.push(o))}}),this.doExecute(e)}doExecute(e){return this.handlesToRemove.forEach(t=>{t.point=t.parent.routingPoints.splice(t.handle.pointIndex,1)[0]}),this.elementsToDeactivate.forEach(t=>{t instanceof yn.SRoutableElement?t.removeAll(n=>n instanceof yn.SRoutingHandle):t instanceof yn.SRoutingHandle&&(t.editMode=!1,t.danglingAnchor&&t.parent instanceof yn.SRoutableElement&&t.danglingAnchor.original&&(t.parent.source===t.danglingAnchor?t.parent.sourceId=t.danglingAnchor.original.id:t.parent.target===t.danglingAnchor&&(t.parent.targetId=t.danglingAnchor.original.id),t.danglingAnchor.parent.remove(t.danglingAnchor),t.danglingAnchor=void 0))}),this.elementsToActivate.forEach(t=>{(0,n0.canEditRouting)(t)&&t instanceof iD.SParentElement?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof yn.SRoutingHandle&&(t.editMode=!0)}),e.root}shouldRemoveHandle(e,t){return e.kind==="junction"?this.edgeRouterRegistry.route(t).find(r=>r.pointIndex===e.pointIndex)===void 0:!1}undo(e){return this.handlesToRemove.forEach(t=>{t.point!==void 0&&t.parent.routingPoints.splice(t.handle.pointIndex,0,t.point)}),this.elementsToActivate.forEach(t=>{t instanceof yn.SRoutableElement?t.removeAll(n=>n instanceof yn.SRoutingHandle):t instanceof yn.SRoutingHandle&&(t.editMode=!1)}),this.elementsToDeactivate.forEach(t=>{(0,n0.canEditRouting)(t)?this.edgeRouterRegistry.get(t.routerKind).createRoutingHandles(t):t instanceof yn.SRoutingHandle&&(t.editMode=!0)}),e.root}redo(e){return this.doExecute(e)}};Fa.KIND=o0.KIND;i0([(0,qg.inject)(t0.EdgeRouterRegistry),r0("design:type",t0.EdgeRouterRegistry)],Fa.prototype,"edgeRouterRegistry",void 0);Fa=i0([(0,qg.injectable)(),tD(0,(0,qg.inject)(rD.TYPES.Action)),r0("design:paramtypes",[Object])],Fa);Lt.SwitchEditModeCommand=Fa});var rl=f(Bt=>{"use strict";var a0=Bt&&Bt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},c0=Bt&&Bt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},oD=Bt&&Bt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.ReconnectCommand=Bt.ReconnectAction=void 0;var Dg=_(),sD=me(),aD=P(),cD=_e(),s0=gn(),u0;(function(i){i.KIND="reconnect";function e(t){return{kind:i.KIND,routableId:t.routableId,newSourceId:t.newSourceId,newTargetId:t.newTargetId}}i.create=e})(u0=Bt.ReconnectAction||(Bt.ReconnectAction={}));var Ka=class extends sD.Command{constructor(e){super(),this.action=e}execute(e){return this.doExecute(e),e.root}doExecute(e){let n=e.root.index.getById(this.action.routableId);if(n instanceof cD.SRoutableElement){let r=this.edgeRouterRegistry.get(n.routerKind),o=r.takeSnapshot(n);r.applyReconnect(n,this.action.newSourceId,this.action.newTargetId);let s=r.takeSnapshot(n);this.memento={edge:n,before:o,after:s}}}undo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.before),e.root}redo(e){return this.memento&&this.edgeRouterRegistry.get(this.memento.edge.routerKind).applySnapshot(this.memento.edge,this.memento.after),e.root}};Ka.KIND=u0.KIND;a0([(0,Dg.inject)(s0.EdgeRouterRegistry),c0("design:type",s0.EdgeRouterRegistry)],Ka.prototype,"edgeRouterRegistry",void 0);Ka=a0([(0,Dg.injectable)(),oD(0,(0,Dg.inject)(aD.TYPES.Action)),c0("design:paramtypes",[Object])],Ka);Bt.ReconnectCommand=Ka});var Bg=f(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.labelEditUiModule=Bi.labelEditModule=Bi.edgeEditModule=void 0;var Lg=_(),Ng=P(),ol=_t(),uD=ks(),dD=go(),lD=_e(),fD=_g(),hD=No(),Uo=Zd(),jg=xg(),pD=Va(),gD=rl();Bi.edgeEditModule=new Lg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,ol.configureCommand)(n,pD.SwitchEditModeCommand),(0,ol.configureCommand)(n,gD.ReconnectCommand),(0,ol.configureCommand)(n,hD.DeleteElementCommand),(0,dD.configureModelElement)(n,"dangling-anchor",lD.SDanglingAnchor,fD.EmptyGroupView)});Bi.labelEditModule=new Lg.ContainerModule((i,e,t)=>{i(Uo.EditLabelMouseListener).toSelf().inSingletonScope(),i(Ng.TYPES.MouseListener).toService(Uo.EditLabelMouseListener),i(Uo.EditLabelKeyListener).toSelf().inSingletonScope(),i(Ng.TYPES.KeyListener).toService(Uo.EditLabelKeyListener),(0,ol.configureCommand)({bind:i,isBound:t},Uo.ApplyLabelEditCommand)});Bi.labelEditUiModule=new Lg.ContainerModule((i,e,t)=>{let n={bind:i,isBound:t};(0,uD.configureActionHandler)(n,Uo.EditLabelAction.KIND,jg.EditLabelActionHandler),i(jg.EditLabelUI).toSelf().inSingletonScope(),i(Ng.TYPES.IUIExtension).toService(jg.EditLabelUI)})});var sl=f(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.isExpandable=xr.expandFeature=void 0;xr.expandFeature=Symbol("expandFeature");function mD(i){return i.hasFeature(xr.expandFeature)&&"expanded"in i}xr.isExpandable=mD});var Fg=f(Fn=>{"use strict";var yD=Fn&&Fn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.ExpandButtonHandler=Fn.CollapseExpandAllAction=Fn.CollapseExpandAction=void 0;var _D=_(),vD=ie(),bD=ze(),SD=sl(),ko=class{constructor(e,t){this.expandIds=e,this.collapseIds=t,this.kind=ko.KIND}};Fn.CollapseExpandAction=ko;ko.KIND="collapseExpand";var Go=class{constructor(e=!0){this.expand=e,this.kind=Go.KIND}};Fn.CollapseExpandAllAction=Go;Go.KIND="collapseExpandAll";var al=class{buttonPressed(e){let t=(0,bD.findParentByFeature)(e,SD.isExpandable);return t!==void 0?[vD.CollapseExpandAction.create({expandIds:t.expanded?[]:[t.id],collapseIds:t.expanded?[t.id]:[]})]:[]}};al.TYPE="button:expand";al=yD([(0,_D.injectable)()],al);Fn.ExpandButtonHandler=al});var d0=f($o=>{"use strict";var ED=$o&&$o.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty($o,"__esModule",{value:!0});$o.ExpandButtonView=void 0;var Vg=Wt(),wD=sl(),PD=ze(),ID=_(),Kg=class{render(e,t){let n=(0,PD.findParentByFeature)(e,wD.isExpandable),r=n!==void 0&&n.expanded?"M 1,5 L 8,12 L 15,5 Z":"M 1,8 L 8,15 L 8,1 Z";return(0,Vg.svg)("g",{"class-sprotty-button":"{true}","class-enabled":"{button.enabled}"},(0,Vg.svg)("rect",{x:0,y:0,width:16,height:16,opacity:0}),(0,Vg.svg)("path",{d:r}))}};Kg=ED([(0,ID.injectable)()],Kg);$o.ExpandButtonView=Kg});var zg=f(ke=>{"use strict";var dl=ke&&ke.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},f0=ke&&ke.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},RD=ke&&ke.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(ke,"__esModule",{value:!0});ke.ExportSvgPostprocessor=ke.ExportSvgCommand=ke.RequestExportSvgAction=ke.ExportSvgKeyListener=void 0;var ll=_(),MD=ie(),TD=me(),OD=wt(),AD=$(),CD=dn(),xD=An(),l0=xd(),qD=Ar(),DD=Dn(),jD=wr(),h0=P(),Hg=class extends CD.KeyListener{keyDown(e,t){return(0,xD.matchesKeystroke)(t,"KeyE","ctrlCmd","shift")?[fl.create()]:[]}};Hg=dl([(0,ll.injectable)()],Hg);ke.ExportSvgKeyListener=Hg;var fl;(function(i){i.KIND="requestExportSvg";function e(){return{kind:i.KIND,requestId:(0,MD.generateRequestId)()}}i.create=e})(fl=ke.RequestExportSvgAction||(ke.RequestExportSvgAction={}));var cl=class extends TD.HiddenCommand{constructor(e){super(),this.action=e}execute(e){if((0,l0.isExportable)(e.root)){let t=e.modelFactory.createRoot(e.root);if((0,l0.isExportable)(t))return(0,DD.isViewport)(t)&&(t.zoom=1,t.scroll={x:0,y:0}),t.index.all().forEach(n=>{(0,OD.isSelectable)(n)&&n.selected&&(n.selected=!1),(0,jD.isHoverable)(n)&&n.hoverFeedback&&(n.hoverFeedback=!1)}),{model:t,modelChanged:!0,cause:this.action}}return{model:e.root,modelChanged:!1}}};cl.KIND=fl.KIND;cl=dl([RD(0,(0,ll.inject)(h0.TYPES.Action)),f0("design:paramtypes",[Object])],cl);ke.ExportSvgCommand=cl;var ul=class{decorate(e,t){return t instanceof AD.SModelRoot&&(this.root=t),e}postUpdate(e){this.root&&e!==void 0&&e.kind===fl.KIND&&this.svgExporter.export(this.root,e)}};dl([(0,ll.inject)(h0.TYPES.SvgExporter),f0("design:type",qD.SvgExporter)],ul.prototype,"svgExporter",void 0);ul=dl([(0,ll.injectable)()],ul);ke.ExportSvgPostprocessor=ul});var hl=f(Fi=>{"use strict";var ND=Fi&&Fi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.ElementFader=Fi.FadeAnimation=void 0;var LD=_(),BD=ur(),FD=$(),VD=Be(),KD=qo(),Yg=class extends BD.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementFades=t,this.removeAfterFadeOut=r}tween(e,t){for(let n of this.elementFades){let r=n.element;n.type==="in"?r.opacity=e:n.type==="out"&&(r.opacity=1-e,e===1&&this.removeAfterFadeOut&&r instanceof FD.SChildElement&&r.parent.remove(r))}return this.model}};Fi.FadeAnimation=Yg;var Ug=class{decorate(e,t){return(0,KD.isFadeable)(t)&&t.opacity!==1&&(0,VD.setAttr)(e,"opacity",t.opacity),e}postUpdate(){}};Ug=ND([(0,LD.injectable)()],Ug);Fi.ElementFader=Ug});var Wg=f(re=>{"use strict";var Ki=re&&re.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Ya=re&&re.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},g0=re&&re.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(re,"__esModule",{value:!0});re.ClosePopupActionHandler=re.HoverKeyListener=re.PopupHoverMouseListener=re.HoverMouseListener=re.AbstractHoverMouseListener=re.SetPopupModelCommand=re.SetPopupModelAction=re.RequestPopupModelAction=re.HoverFeedbackCommand=re.HoverFeedbackAction=void 0;var Vn=_(),m0=ie(),HD=ee(),zD=An(),Ua=P(),p0=$(),YD=At(),y0=me(),qr=Tn(),UD=dn(),Ha=ze(),kD=ue(),Wo=wr(),Xo;(function(i){i.KIND="hoverFeedback";function e(t){return{kind:i.KIND,mouseoverElement:t.mouseoverElement,mouseIsOver:t.mouseIsOver}}i.create=e})(Xo=re.HoverFeedbackAction||(re.HoverFeedbackAction={}));var pl=class extends y0.SystemCommand{constructor(e){super(),this.action=e}execute(e){let n=e.root.index.getById(this.action.mouseoverElement);return n&&(0,Wo.isHoverable)(n)&&(n.hoverFeedback=this.action.mouseIsOver),this.redo(e)}undo(e){return e.root}redo(e){return e.root}};pl.KIND=Xo.KIND;pl=Ki([(0,Vn.injectable)(),g0(0,(0,Vn.inject)(Ua.TYPES.Action)),Ya("design:paramtypes",[Object])],pl);re.HoverFeedbackCommand=pl;var Vi=class{constructor(e,t,n=""){this.elementId=e,this.bounds=t,this.requestId=n,this.kind=Vi.KIND}static create(e,t){return new Vi(e,t,(0,m0.generateRequestId)())}};re.RequestPopupModelAction=Vi;Vi.KIND="requestPopupModel";var ci=class{constructor(e,t=""){this.newRoot=e,this.responseId=t,this.kind=ci.KIND}};re.SetPopupModelAction=ci;ci.KIND="setPopupModel";var za=class extends y0.PopupCommand{constructor(e){super(),this.action=e}execute(e){return this.oldRoot=e.root,this.newRoot=e.modelFactory.createRoot(this.action.newRoot),this.newRoot}undo(e){return this.oldRoot}redo(e){return this.newRoot}};za.KIND=m0.SetPopupModelAction.KIND;za=Ki([(0,Vn.injectable)(),g0(0,(0,Vn.inject)(Ua.TYPES.Action)),Ya("design:paramtypes",[Object])],za);re.SetPopupModelCommand=za;var Dr=class extends YD.MouseListener{mouseDown(e,t){return this.mouseIsDown=!0,[]}mouseUp(e,t){return this.mouseIsDown=!1,[]}stopMouseOutTimer(){this.state.mouseOutTimer!==void 0&&(window.clearTimeout(this.state.mouseOutTimer),this.state.mouseOutTimer=void 0)}startMouseOutTimer(){return this.stopMouseOutTimer(),new Promise(e=>{this.state.mouseOutTimer=window.setTimeout(()=>{this.state.popupOpen=!1,this.state.previousPopupElement=void 0,e(new ci({type:qr.EMPTY_ROOT.type,id:qr.EMPTY_ROOT.id}))},this.options.popupCloseDelay)})}stopMouseOverTimer(){this.state.mouseOverTimer!==void 0&&(window.clearTimeout(this.state.mouseOverTimer),this.state.mouseOverTimer=void 0)}};Ki([(0,Vn.inject)(Ua.TYPES.ViewerOptions),Ya("design:type",Object)],Dr.prototype,"options",void 0);Ki([(0,Vn.inject)(Ua.TYPES.HoverState),Ya("design:type",Object)],Dr.prototype,"state",void 0);re.AbstractHoverMouseListener=Dr;var gl=class extends Dr{computePopupBounds(e,t){let n={x:-5,y:20},r=(0,kD.getAbsoluteBounds)(e),o=e.root.canvasBounds,s=HD.Bounds.translate(r,o),a=s.x+s.width-t.x,c=s.y+s.height-t.y;c<=a&&this.allowSidePosition(e,"below",c)?n={x:-5,y:Math.round(c+5)}:a<=c&&this.allowSidePosition(e,"right",a)&&(n={x:Math.round(a+5),y:-5});let u=t.x+n.x,d=o.x+o.width;u>d&&(u=d);let l=t.y+n.y,S=o.y+o.height;return l>S&&(l=S),{x:u,y:l,width:-1,height:-1}}allowSidePosition(e,t,n){return!(e instanceof p0.SModelRoot)&&n<=150}startMouseOverTimer(e,t){return this.stopMouseOverTimer(),new Promise(n=>{this.state.mouseOverTimer=window.setTimeout(()=>{let r=this.computePopupBounds(e,{x:t.pageX,y:t.pageY});n(new Vi(e.id,r)),this.state.popupOpen=!0,this.state.previousPopupElement=e},this.options.popupOpenDelay)})}mouseOver(e,t){let n=[];if(!this.mouseIsDown){let r=(0,Ha.findParent)(e,Wo.hasPopupFeature);this.state.popupOpen&&(r===void 0||this.state.previousPopupElement!==void 0&&this.state.previousPopupElement.id!==r.id)?n.push(this.startMouseOutTimer()):(this.stopMouseOverTimer(),this.stopMouseOutTimer()),r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t)),this.lastHoverFeedbackElementId&&(n.push(Xo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0);let o=(0,Ha.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push(Xo.create({mouseoverElement:o.id,mouseIsOver:!0})),this.lastHoverFeedbackElementId=o.id)}return n}mouseOut(e,t){let n=[];if(!this.mouseIsDown){let r=this.getElementFromEventPosition(t);if(!this.isSprottyPopup(r)){if(this.state.popupOpen){let s=(0,Ha.findParent)(e,Wo.hasPopupFeature);this.state.previousPopupElement!==void 0&&s!==void 0&&this.state.previousPopupElement.id===s.id&&n.push(this.startMouseOutTimer())}this.stopMouseOverTimer();let o=(0,Ha.findParentByFeature)(e,Wo.isHoverable);o!==void 0&&(n.push(Xo.create({mouseoverElement:o.id,mouseIsOver:!1})),this.lastHoverFeedbackElementId&&this.lastHoverFeedbackElementId!==o.id&&n.push(Xo.create({mouseoverElement:this.lastHoverFeedbackElementId,mouseIsOver:!1})),this.lastHoverFeedbackElementId=void 0)}}return n}getElementFromEventPosition(e){return document.elementFromPoint(e.x,e.y)}isSprottyPopup(e){return e?e.id===this.options.popupDiv||!!e.parentElement&&this.isSprottyPopup(e.parentElement):!1}mouseMove(e,t){let n=[];if(!this.mouseIsDown){this.state.previousPopupElement!==void 0&&this.closeOnMouseMove(this.state.previousPopupElement,t)&&n.push(this.startMouseOutTimer());let r=(0,Ha.findParent)(e,Wo.hasPopupFeature);r!==void 0&&(this.state.previousPopupElement===void 0||this.state.previousPopupElement.id!==r.id)&&n.push(this.startMouseOverTimer(r,t))}return n}closeOnMouseMove(e,t){return e instanceof p0.SModelRoot}};Ki([(0,Vn.inject)(Ua.TYPES.ViewerOptions),Ya("design:type",Object)],gl.prototype,"options",void 0);gl=Ki([(0,Vn.injectable)()],gl);re.HoverMouseListener=gl;var kg=class extends Dr{mouseOut(e,t){return[this.startMouseOutTimer()]}mouseOver(e,t){return this.stopMouseOutTimer(),this.stopMouseOverTimer(),[]}};kg=Ki([(0,Vn.injectable)()],kg);re.PopupHoverMouseListener=kg;var Gg=class extends UD.KeyListener{keyDown(e,t){return(0,zD.matchesKeystroke)(t,"Escape")?[new ci({type:qr.EMPTY_ROOT.type,id:qr.EMPTY_ROOT.id})]:[]}};re.HoverKeyListener=Gg;var $g=class{constructor(){this.popupOpen=!1}handle(e){if(e.kind===za.KIND)this.popupOpen=e.newRoot.type!==qr.EMPTY_ROOT.type;else if(this.popupOpen)return new ci({id:qr.EMPTY_ROOT.id,type:qr.EMPTY_ROOT.type})}};$g=Ki([(0,Vn.injectable)()],$g);re.ClosePopupActionHandler=$g});var ml=f(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.SIssue=Rt.SIssueMarker=Rt.SDecoration=Rt.isDecoration=Rt.decorationFeature=void 0;var v0=ue(),_0=wr();Rt.decorationFeature=Symbol("decorationFeature");function GD(i){return i.hasFeature(Rt.decorationFeature)}Rt.isDecoration=GD;var ka=class extends v0.SShapeElement{};Rt.SDecoration=ka;ka.DEFAULT_FEATURES=[Rt.decorationFeature,v0.boundsFeature,_0.hoverFeedbackFeature,_0.popupFeature];var Xg=class extends ka{};Rt.SIssueMarker=Xg;var Jg=class{};Rt.SIssue=Jg});var em=f(Jo=>{"use strict";var $D=Jo&&Jo.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Jo,"__esModule",{value:!0});Jo.IssueMarkerView=void 0;var Zg=Wt(),WD=Be(),XD=_(),Qg=class{render(e,t){let n=.008928571428571428,r=`scale(${n}, ${n})`,o=this.getMaxSeverity(e),s=(0,Zg.svg)("g",{"class-sprotty-issue":!0},(0,Zg.svg)("g",{transform:r},(0,Zg.svg)("path",{d:this.getPath(o)})));return(0,WD.setClass)(s,"sprotty-"+o,!0),s}getMaxSeverity(e){let t="info";for(let n of e.issues.map(r=>r.severity))(n==="error"||n==="warning"&&t==="info")&&(t=n);return t}getPath(e){switch(e){case"error":case"warning":return"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z";case"info":return"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"}}};Qg=$D([(0,XD.injectable)()],Qg);Jo.IssueMarkerView=Qg});var tm=f(Hi=>{"use strict";var w0=Hi&&Hi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},JD=Hi&&Hi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Hi,"__esModule",{value:!0});Hi.DecorationPlacer=void 0;var P0=_(),ZD=$(),QD=ml(),ej=Be(),b0=ue(),tj=_e(),S0=gn(),E0=hr(),yl=class{decorate(e,t){if((0,QD.isDecoration)(t)){let n=this.getPosition(t),r="translate("+n.x+", "+n.y+")";(0,ej.setAttr)(e,"transform",r)}return e}getPosition(e){if(e instanceof ZD.SChildElement&&e.parent instanceof tj.SRoutableElement){let t=this.edgeRouterRegistry.route(e.parent);if(t.length>1){let n=Math.floor(.5*(t.length-1)),r=(0,b0.isSizeable)(e)?{x:-.5*e.bounds.width,y:-.5*e.bounds.width}:E0.Point.ORIGIN;return{x:.5*(t[n].x+t[n+1].x)+r.x,y:.5*(t[n].y+t[n+1].y)+r.y}}}return(0,b0.isSizeable)(e)?{x:-.666*e.bounds.width,y:-.666*e.bounds.height}:E0.Point.ORIGIN}postUpdate(){}};w0([(0,P0.inject)(S0.EdgeRouterRegistry),JD("design:type",S0.EdgeRouterRegistry)],yl.prototype,"edgeRouterRegistry",void 0);yl=w0([(0,P0.injectable)()],yl);Hi.DecorationPlacer=yl});var rm=f((nm,im)=>{(function(i,e){typeof nm=="object"&&typeof im<"u"?im.exports=e():typeof define=="function"&&define.amd?define(e):(i=i||self,i.TinyQueue=e())})(nm,function(){"use strict";var i=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=e),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};i.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(n){for(var r=this,o=r.data,s=r.compare,a=o[n];n>0;){var c=n-1>>1,u=o[c];if(s(a,u)>=0)break;o[n]=u,n=c}o[n]=a},i.prototype._down=function(n){for(var r=this,o=r.data,s=r.compare,a=this.length>>1,c=o[n];n<a;){var u=(n<<1)+1,d=o[u],l=u+1;if(l<this.length&&s(o[l],d)<0&&(u=l,d=o[l]),s(d,c)>=0)break;o[n]=d,n=u}o[n]=c};function e(t,n){return t<n?-1:t>n?1:0}return i})});var sm=f(Oe=>{"use strict";var nj=Oe&&Oe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.intersectionOfSegments=Oe.getSegmentIndex=Oe.checkWhichSegmentHasRightEndpointFirst=Oe.runSweep=Oe.Segment=Oe.SweepEvent=Oe.checkWhichEventIsLeft=Oe.addRoute=void 0;var ij=nj(rm()),I0=Or();function rj(i,e,t){if(e.length<1)return;let n=e[0],r;for(let o=0;o<e.length-1;o++){r=e[o+1];let s=new Ga(i,n,o),a=new Ga(i,r,o+1);s.otherEvent=a,a.otherEvent=s,R0(s,a)>0?(a.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,a.isLeftEndpoint=!1),t.push(s),t.push(a),n=r}}Oe.addRoute=rj;function R0(i,e){return i.point.x>e.point.x?1:i.point.x<e.point.x?-1:i.point.y!==e.point.y?i.point.y>e.point.y?1:-1:1}Oe.checkWhichEventIsLeft=R0;var Ga=class{constructor(e,t,n){this.edgeId=e,this.point=t,this.segmentIndex=n}};Oe.SweepEvent=Ga;var _l=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};Oe.Segment=_l;function oj(i){let e=[],t=new ij.default([],M0);for(;i.length;){let n=i.pop();if(n?.isLeftEndpoint){let r=new _l(n);for(let o=0;o<t.data.length;o++){let s=t.data[o],a=T0(r,s);a&&e.push({routable1:n.edgeId,routable2:s.leftSweepEvent.edgeId,segmentIndex1:om(r),segmentIndex2:om(s),intersectionPoint:a})}t.push(r)}else n?.isLeftEndpoint===!1&&t.pop()}return e}Oe.runSweep=oj;function M0(i,e){return i.rightSweepEvent.point.x>e.rightSweepEvent.point.x?1:i.rightSweepEvent.point.x<e.rightSweepEvent.point.x?-1:i.rightSweepEvent.point.y!==e.rightSweepEvent.point.y?i.rightSweepEvent.point.y<e.rightSweepEvent.point.y?1:-1:1}Oe.checkWhichSegmentHasRightEndpointFirst=M0;function om(i){return Math.min(i.leftSweepEvent.segmentIndex,i.rightSweepEvent.segmentIndex)}Oe.getSegmentIndex=om;function T0(i,e){if(i.leftSweepEvent.edgeId===e.leftSweepEvent.edgeId)return;let t=new I0.PointToPointLine(i.leftSweepEvent.point,i.rightSweepEvent.point),n=new I0.PointToPointLine(e.leftSweepEvent.point,e.rightSweepEvent.point);return t.intersection(n)}Oe.intersectionOfSegments=T0});var vl=f(Ve=>{"use strict";var sj=Ve&&Ve.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},aj=Ve&&Ve.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.IntersectionFinder=Ve.BY_DESCENDING_X_THEN_DESCENDING_Y=Ve.BY_X_THEN_DESCENDING_Y=Ve.BY_DESCENDING_X_THEN_Y=Ve.BY_X_THEN_Y=Ve.isIntersectingRoutedPoint=void 0;var cj=_(),uj=aj(rm()),am=sm();function O0(i){return i!==void 0&&"intersections"in i&&"kind"in i}Ve.isIntersectingRoutedPoint=O0;var dj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Ve.BY_X_THEN_Y=dj;var lj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?i.intersectionPoint.y-e.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Ve.BY_DESCENDING_X_THEN_Y=lj;var fj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:i.intersectionPoint.x-e.intersectionPoint.x;Ve.BY_X_THEN_DESCENDING_Y=fj;var hj=(i,e)=>i.intersectionPoint.x===e.intersectionPoint.x?e.intersectionPoint.y-i.intersectionPoint.y:e.intersectionPoint.x-i.intersectionPoint.x;Ve.BY_DESCENDING_X_THEN_DESCENDING_Y=hj;var cm=class{apply(e){let t=this.find(e);this.addToRouting(t,e)}find(e){let t=new uj.default(void 0,am.checkWhichEventIsLeft);return e.routes.forEach((n,r)=>{this.isSupportedRoute(n)&&(0,am.addRoute)(r,n,t)}),(0,am.runSweep)(t)}isSupportedRoute(e){return e.find(t=>t.kind!=="source"&&t.kind!=="target"&&t.kind!=="linear")===void 0}addToRouting(e,t){for(let n of e){let r=t.get(n.routable1),o=t.get(n.routable2);this.addIntersectionToRoutedPoint(n,r,n.segmentIndex1),this.addIntersectionToRoutedPoint(n,o,n.segmentIndex2)}}addIntersectionToRoutedPoint(e,t,n){if(t&&t.length>n){let r=t[n+1];if(O0(r))r.intersections.push(e);else{let o=Object.assign(Object.assign({},r),{intersections:[e]});t[n+1]=o}}}};cm=sj([(0,cj.injectable)()],cm);Ve.IntersectionFinder=cm});var Qa=f(Pe=>{"use strict";var Za=Pe&&Pe.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},wl=Pe&&Pe.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},pj=Pe&&Pe.__param||function(i,e){return function(t,n){e(t,n,i)}},um;Object.defineProperty(Pe,"__esModule",{value:!0});Pe.LocationPostprocessor=Pe.MoveMouseListener=Pe.MorphEdgesAnimation=Pe.MoveAnimation=Pe.MoveCommand=Pe.MoveAction=void 0;var ui=_(),zi=ee(),Zo=ie(),$a=ur(),gj=me(),Sl=$(),Wa=ze(),C0=P(),mj=At(),yj=Be(),_j=Rr(),vj=Na(),x0=ue(),A0=ug(),bl=Va(),bj=rl(),je=_e(),El=gn(),Sj=Bo(),q0=wt(),Ej=Dn(),Qo=qi(),lm;(function(i){i.KIND="move";function e(t,n={}){var r,o;return{kind:i.KIND,moves:t,animate:(r=n.animate)!==null&&r!==void 0?r:!0,finished:(o=n.finished)!==null&&o!==void 0?o:!1}}i.create=e})(lm=Pe.MoveAction||(Pe.MoveAction={}));var Xa=um=class extends gj.MergeableCommand{constructor(e){super(),this.action=e,this.resolvedMoves=new Map,this.edgeMementi=[]}execute(e){let t=e.root.index,n=new Map,r=new Map;return this.action.moves.forEach(o=>{let s=t.getById(o.elementId);if(s instanceof je.SRoutingHandle&&this.edgeRouterRegistry){let a=s.parent;if(a instanceof je.SRoutableElement){let c=this.resolveHandleMove(s,a,o);if(c){let u=n.get(a);u||(u=[],n.set(a,u)),u.push(c)}}}else if(s&&(0,Qo.isLocateable)(s)){let a=this.resolveElementMove(s,o);a&&(this.resolvedMoves.set(a.element.id,a),this.edgeRouterRegistry&&t.getAttachedElements(s).forEach(c=>{if(c instanceof je.SRoutableElement){let u=r.get(c),d=zi.Point.subtract(a.toPosition,a.fromPosition),l=u?zi.Point.linear(u,d,.5):d;r.set(c,l)}}))}}),this.doMove(n,r),this.action.animate?(this.undoMove(),new $a.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!1),new ts(e.root,this.edgeMementi,e,!1)]).start()):e.root}resolveHandleMove(e,t,n){let r=n.fromPosition;if(!r){let o=this.edgeRouterRegistry.get(t.routerKind);r=o.getHandlePosition(t,o.route(t),e)}if(r)return{handle:e,fromPosition:r,toPosition:n.toPosition}}resolveElementMove(e,t){let n=t.fromPosition||{x:e.position.x,y:e.position.y};return{element:e,fromPosition:n,toPosition:t.toPosition}}doMove(e,t){this.resolvedMoves.forEach(n=>{n.element.position=n.toPosition}),e.forEach((n,r)=>{let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);o.applyHandleMoves(r,n);let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}),t.forEach((n,r)=>{if(!e.get(r)){let o=this.edgeRouterRegistry.get(r.routerKind),s=o.takeSnapshot(r);if(r.source&&r.target&&this.resolvedMoves.get(r.source.id)&&this.resolvedMoves.get(r.target.id))r.routingPoints=r.routingPoints.map(c=>zi.Point.add(c,n));else{let c=(0,q0.isSelectable)(r)&&r.selected;o.cleanupRoutingPoints(r,r.routingPoints,c,this.action.finished)}let a=o.takeSnapshot(r);this.edgeMementi.push({edge:r,before:s,after:a})}})}undoMove(){this.resolvedMoves.forEach(e=>{e.element.position=e.fromPosition}),this.edgeMementi.forEach(e=>{this.edgeRouterRegistry.get(e.edge.routerKind).applySnapshot(e.edge,e.before)})}undo(e){return new $a.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!0),new ts(e.root,this.edgeMementi,e,!0)]).start()}redo(e){return new $a.CompoundAnimation(e.root,e,[new es(e.root,this.resolvedMoves,e,!1),new ts(e.root,this.edgeMementi,e,!1)]).start()}merge(e,t){if(!this.action.animate&&e instanceof um)return e.resolvedMoves.forEach((n,r)=>{let o=this.resolvedMoves.get(r);o?o.toPosition=n.toPosition:this.resolvedMoves.set(r,n)}),e.edgeMementi.forEach(n=>{let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}),!0;if(e instanceof bj.ReconnectCommand){let n=e.memento;if(n){let r=this.edgeMementi.find(o=>o.edge.id===n.edge.id);r?r.after=n.after:this.edgeMementi.push(n)}return!0}return!1}};Xa.KIND=lm.KIND;Za([(0,ui.inject)(El.EdgeRouterRegistry),(0,ui.optional)(),wl("design:type",El.EdgeRouterRegistry)],Xa.prototype,"edgeRouterRegistry",void 0);Xa=um=Za([(0,ui.injectable)(),pj(0,(0,ui.inject)(C0.TYPES.Action)),wl("design:paramtypes",[Object])],Xa);Pe.MoveCommand=Xa;var es=class extends $a.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementMoves=t,this.reverse=r}tween(e){return this.elementMoves.forEach(t=>{this.reverse?t.element.position={x:(1-e)*t.toPosition.x+e*t.fromPosition.x,y:(1-e)*t.toPosition.y+e*t.fromPosition.y}:t.element.position={x:(1-e)*t.fromPosition.x+e*t.toPosition.x,y:(1-e)*t.fromPosition.y+e*t.toPosition.y}}),this.model}};Pe.MoveAnimation=es;var ts=class extends $a.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.reverse=r,this.expanded=[],t.forEach(o=>{let s=this.reverse?o.after:o.before,a=this.reverse?o.before:o.after,c=s.routedPoints,u=a.routedPoints,d=Math.max(c.length,u.length);this.expanded.push({startExpandedRoute:this.growToSize(c,d),endExpandedRoute:this.growToSize(u,d),memento:o})})}midPoint(e){let t=e.edge,n=e.edge.source,r=e.edge.target;return zi.Point.linear((0,Wa.translatePoint)(zi.Bounds.center(n.bounds),n.parent,t.parent),(0,Wa.translatePoint)(zi.Bounds.center(r.bounds),r.parent,t.parent),.5)}start(){return this.expanded.forEach(e=>{e.memento.edge.removeAll(t=>t instanceof je.SRoutingHandle)}),super.start()}tween(e){return e===1?this.expanded.forEach(t=>{let n=t.memento;this.reverse?n.before.router.applySnapshot(n.edge,n.before):n.after.router.applySnapshot(n.edge,n.after)}):this.expanded.forEach(t=>{let n=[];for(let s=1;s<t.startExpandedRoute.length-1;++s)n.push(zi.Point.linear(t.startExpandedRoute[s],t.endExpandedRoute[s],e));let r=e<.5?t.memento.before:t.memento.after,o=Object.assign(Object.assign({},r),{routingPoints:n,routingHandles:[]});r.router.applySnapshot(t.memento.edge,o)}),this.model}growToSize(e,t){let n=t-e.length;if(n<=0)return e;let r=[];r.push(e[0]);let o=1/(n+1),s=1/(e.length-1),a=1;for(let c=1;c<e.length;++c){let u=s*c,d=0;for(;u>(a+d)*o;)++d;a+=d;for(let l=0;l<d;++l){let S=zi.Point.linear(e[c-1],e[c],(l+1)/(d+1));r.push(S)}r.push(e[c])}return r}};Pe.MorphEdgesAnimation=ts;var Ja=class extends mj.MouseListener{constructor(){super(...arguments),this.hasDragged=!1,this.elementId2startPos=new Map}mouseDown(e,t){if(t.button===0){let n=(0,Wa.findParentByFeature)(e,Qo.isMoveable),r=e instanceof je.SRoutingHandle;n!==void 0||r||(0,A0.isCreatingOnDrag)(e)?this.startDragPosition={x:t.pageX,y:t.pageY}:this.startDragPosition=void 0,this.hasDragged=!1,(0,A0.isCreatingOnDrag)(e)?this.startCreatingOnDrag(e,t):r&&this.activateRoutingHandle(e,t)}return[]}startCreatingOnDrag(e,t){let n=[];return n.push(Zo.SelectAllAction.create({select:!1})),n.push(e.createAction(je.edgeInProgressID)),n.push(Zo.SelectAction.create({selectedElementsIDs:[je.edgeInProgressID]})),n.push(bl.SwitchEditModeAction.create({elementsToActivate:[je.edgeInProgressID]})),n.push(Zo.SelectAction.create({selectedElementsIDs:[je.edgeInProgressTargetHandleID]})),n.push(bl.SwitchEditModeAction.create({elementsToActivate:[je.edgeInProgressTargetHandleID]})),n}activateRoutingHandle(e,t){return[bl.SwitchEditModeAction.create({elementsToActivate:[e.id]})]}mouseMove(e,t){let n=[];if(t.buttons===0)this.mouseUp(e,t);else if(this.startDragPosition){this.elementId2startPos.size===0&&this.collectStartPositions(e.root),this.hasDragged=!0;let r=this.getElementMoves(e,t,!1);r&&n.push(r)}return n}collectStartPositions(e){let t=new Set(e.index.all().filter(n=>(0,q0.isSelectable)(n)&&n.selected));t.forEach(n=>{if(!this.isChildOfSelected(t,n)){if((0,Qo.isMoveable)(n))this.elementId2startPos.set(n.id,n.position);else if(n instanceof je.SRoutingHandle){let r=this.getHandlePosition(n);r&&this.elementId2startPos.set(n.id,r)}}})}isChildOfSelected(e,t){for(;t instanceof Sl.SChildElement;)if(t=t.parent,(0,Qo.isMoveable)(t)&&e.has(t))return!0;return!1}getElementMoves(e,t,n){if(!this.startDragPosition)return;let r=[],o=(0,Wa.findParentByFeature)(e,Ej.isViewport),s=o?o.zoom:1,a={x:(t.pageX-this.startDragPosition.x)/s,y:(t.pageY-this.startDragPosition.y)/s};if(this.elementId2startPos.forEach((c,u)=>{let d=e.root.index.getById(u);if(d){let l=this.createElementMove(d,c,a,t);l&&r.push(l)}}),r.length>0)return lm.create(r,{animate:!1,finished:n})}createElementMove(e,t,n,r){let o=this.snap({x:t.x+n.x,y:t.y+n.y},e,!r.shiftKey);if((0,Qo.isMoveable)(e))return{elementId:e.id,elementType:e.type,fromPosition:{x:e.position.x,y:e.position.y},toPosition:o};if(e instanceof je.SRoutingHandle){let s=this.getHandlePosition(e);if(s!==void 0)return{elementId:e.id,elementType:e.type,fromPosition:s,toPosition:o}}}snap(e,t,n){return n&&this.snapper?this.snapper.snap(e,t):e}getHandlePosition(e){if(this.edgeRouterRegistry){let t=e.parent;if(!(t instanceof je.SRoutableElement))return;let n=this.edgeRouterRegistry.get(t.routerKind),r=n.route(t);return n.getHandlePosition(t,r,e)}}mouseEnter(e,t){return e instanceof Sl.SModelRoot&&t.buttons===0&&!this.startDragPosition&&this.mouseUp(e,t),[]}mouseUp(e,t){let n=[];if(this.startDragPosition){let r=this.getElementMoves(e,t,!0);r&&n.push(r),e.root.index.all().forEach(o=>{o instanceof je.SRoutingHandle&&n.push(...this.deactivateRoutingHandle(o,e,t))})}if(!n.some(r=>r.kind===Zo.ReconnectAction.KIND)){let r=e.root.index.getById(je.edgeInProgressID);r instanceof Sl.SChildElement&&n.push(this.deleteEdgeInProgress(r))}return this.hasDragged&&n.push(vj.CommitModelAction.create()),this.hasDragged=!1,this.startDragPosition=void 0,this.elementId2startPos.clear(),n}deactivateRoutingHandle(e,t,n){let r=[],o=e.parent;if(o instanceof je.SRoutableElement&&e.danglingAnchor){let s=this.getHandlePosition(e);if(s){let a=(0,Wa.translatePoint)(s,e.parent,e.root),c=(0,x0.findChildrenAtPosition)(t.root,a).find(u=>(0,je.isConnectable)(u)&&u.canConnect(o,e.kind));c&&this.hasDragged&&r.push(Zo.ReconnectAction.create({routableId:e.parent.id,newSourceId:e.kind==="source"?c.id:o.sourceId,newTargetId:e.kind==="target"?c.id:o.targetId}))}}return e.editMode&&r.push(bl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),r}deleteEdgeInProgress(e){let t=[];return t.push(je.edgeInProgressID),e.children.forEach(n=>{n instanceof je.SRoutingHandle&&n.danglingAnchor&&t.push(n.danglingAnchor.id)}),Zo.DeleteElementAction.create(t)}decorate(e,t){return e}};Za([(0,ui.inject)(El.EdgeRouterRegistry),(0,ui.optional)(),wl("design:type",El.EdgeRouterRegistry)],Ja.prototype,"edgeRouterRegistry",void 0);Za([(0,ui.inject)(C0.TYPES.ISnapper),(0,ui.optional)(),wl("design:type",Object)],Ja.prototype,"snapper",void 0);Pe.MoveMouseListener=Ja;var dm=class{decorate(e,t){if((0,Sj.isEdgeLayoutable)(t)&&t.parent instanceof _j.SEdge)return e;let n="";if((0,Qo.isLocateable)(t)&&t instanceof Sl.SChildElement&&t.parent!==void 0){let r=t.position;(r.x!==0||r.y!==0)&&(n="translate("+r.x+", "+r.y+")")}if((0,x0.isAlignable)(t)){let r=t.alignment;(r.x!==0||r.y!==0)&&(n.length>0&&(n+=" "),n+="translate("+r.x+", "+r.y+")")}return n.length>0&&(0,yj.setAttr)(e,"transform",n),e}postUpdate(){}};dm=Za([(0,ui.injectable)()],dm);Pe.LocationPostprocessor=dm});var D0=f(ns=>{"use strict";var wj=ns&&ns.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ns,"__esModule",{value:!0});ns.CenterGridSnapper=void 0;var Pj=_(),Ij=ue(),fm=class{get gridX(){return 10}get gridY(){return 10}snap(e,t){return t&&(0,Ij.isBoundsAware)(t)?{x:Math.round((e.x+.5*t.bounds.width)/this.gridX)*this.gridX-.5*t.bounds.width,y:Math.round((e.y+.5*t.bounds.height)/this.gridY)*this.gridY-.5*t.bounds.height}:{x:Math.round(e.x/this.gridX)*this.gridX,y:Math.round(e.y/this.gridY)*this.gridY}}};fm=wj([(0,Pj.injectable)()],fm);ns.CenterGridSnapper=fm});var hm=f(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.isOpenable=jr.openFeature=void 0;jr.openFeature=Symbol("openFeature");function Rj(i){return i.hasFeature(jr.openFeature)}jr.isOpenable=Rj});var gm=f(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.OpenMouseListener=void 0;var Mj=ie(),Tj=At(),Oj=ze(),Aj=hm(),pm=class extends Tj.MouseListener{doubleClick(e,t){let n=(0,Oj.findParentByFeature)(e,Aj.isOpenable);return n!==void 0?[Mj.OpenAction.create(n.id)]:[]}};Pl.OpenMouseListener=pm});var Ml=f(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.getModelBounds=Kn.getProjectedBounds=Kn.getProjections=Kn.isProjectable=void 0;var Cj=ee(),xj=En(),j0=ze(),Rl=ue();function N0(i){return(0,xj.hasOwnProperty)(i,"projectionCssClasses")}Kn.isProjectable=N0;function L0(i){let e;for(let t of i.children){if(N0(t)&&t.projectionCssClasses.length>0){let n=B0(t);if(n){let r={elementId:t.id,projectedBounds:n,cssClasses:t.projectionCssClasses};e?e.push(r):e=[r]}}if(t.children.length>0){let n=L0(t);n&&(e?e.push(...n):e=n)}}return e}Kn.getProjections=L0;function B0(i){let e=i.parent;if(i.projectedBounds){let t=i.projectedBounds;return(0,Rl.isBoundsAware)(e)&&(t=(0,j0.transformToRootBounds)(e,t)),t}else if((0,Rl.isBoundsAware)(i)){let t=i.bounds;return t=(0,j0.transformToRootBounds)(e,t),t}}Kn.getProjectedBounds=B0;var Il=1e9;function qj(i){let e=Il,t=Il,n=-Il,r=-Il,o=(0,Rl.isBoundsAware)(i)?i.bounds:void 0;if(o&&Cj.Dimension.isValid(o))e=o.x,t=o.y,n=e+o.width,r=t+o.height;else for(let s of i.children)if((0,Rl.isBoundsAware)(s)){let a=s.bounds;e=Math.min(e,a.x),t=Math.min(t,a.y),n=Math.max(n,a.x+a.width),r=Math.max(r,a.y+a.height)}if(e=Math.min(e,i.scroll.x),t=Math.min(t,i.scroll.y),n=Math.max(n,i.scroll.x+i.canvasBounds.width/i.zoom),r=Math.max(r,i.scroll.y+i.canvasBounds.height/i.zoom),e<n&&t<r)return{x:e,y:t,width:n-e,height:r-t}}Kn.getModelBounds=qj});var H0=f(is=>{"use strict";var Dj=is&&is.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(is,"__esModule",{value:!0});is.ProjectedViewportView=void 0;var Tl=Wt(),jj=_(),F0=po(),V0=Be(),K0=Ml(),mm=class{render(e,t,n){let r=(0,Tl.html)("div",{"class-sprotty-root":!0},this.renderSvg(e,t,n),this.renderProjections(e,t,n));return(0,V0.setAttr)(r,"tabindex",0),r}renderSvg(e,t,n){let r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`,o="http://www.w3.org/2000/svg";return(0,F0.h)("svg",{ns:o},(0,F0.h)("g",{ns:o,attrs:{transform:r}},t.renderChildren(e)))}renderProjections(e,t,n){var r;if(e.zoom<=0)return[];let o=(0,K0.getModelBounds)(e);if(!o)return[];let s=(r=(0,K0.getProjections)(e))!==null&&r!==void 0?r:[];return[this.renderProjectionBar(s,e,o,"vertical"),this.renderProjectionBar(s,e,o,"horizontal")]}renderProjectionBar(e,t,n,r){let o={modelBounds:n,orientation:r};return o.factor=r==="horizontal"?t.canvasBounds.width/n.width:t.canvasBounds.height/n.height,o.zoomedFactor=o.factor/t.zoom,(0,Tl.html)("div",{"class-sprotty-projection-bar":!0,"class-horizontal":r==="horizontal","class-vertical":r==="vertical"},this.renderViewport(t,o),e.map(s=>this.renderProjection(s,t,o)))}renderViewport(e,t){let n,r;t.orientation==="horizontal"?(n=e.canvasBounds.width,r=(e.scroll.x-t.modelBounds.x)*t.factor):(n=e.canvasBounds.height,r=(e.scroll.y-t.modelBounds.y)*t.factor);let o=n*t.zoomedFactor;r<0?(o+=r,r=0):r>n&&(r=n),o<0?o=0:r+o>n&&(o=n-r);let s=t.orientation==="horizontal"?{left:`${r}px`,width:`${o}px`}:{top:`${r}px`,height:`${o}px`};return(0,Tl.html)("div",{"class-sprotty-viewport":!0,style:s})}renderProjection(e,t,n){let r,o,s;n.orientation==="horizontal"?(r=t.canvasBounds.width,o=(e.projectedBounds.x-n.modelBounds.x)*n.factor,s=e.projectedBounds.width*n.factor):(r=t.canvasBounds.height,o=(e.projectedBounds.y-n.modelBounds.y)*n.factor,s=e.projectedBounds.height*n.factor),o<0?(s+=o,o=0):o>r&&(o=r),s<0?s=0:o+s>r&&(s=r-o);let a=n.orientation==="horizontal"?{left:`${o}px`,width:`${s}px`}:{top:`${o}px`,height:`${s}px`},c=(0,Tl.html)("div",{id:`${n.orientation}-projection:${e.elementId}`,"class-sprotty-projection":!0,style:a});return e.cssClasses.forEach(u=>(0,V0.setClass)(c,u,!0)),c}};mm=Dj([(0,jj.injectable)()],mm);is.ProjectedViewportView=mm});var Ol=f(Hn=>{"use strict";var Em=Hn&&Hn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.DiamondAnchor=Hn.RectangleAnchor=Hn.EllipseAnchor=void 0;var wm=oi(),ym=Or(),Pm=_(),Im=Aa(),rs=ee(),_m=class{get kind(){return Im.PolylineEdgeRouter.KIND+":"+wm.ELLIPTIC_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=rs.Bounds.center(r),s=o.x-t.x,a=o.y-t.y,c=Math.sqrt(s*s+a*a),u=s/c||0,d=a/c||0;return{x:o.x-u*(.5*r.width+n),y:o.y-d*(.5*r.height+n)}}};_m=Em([(0,Pm.injectable)()],_m);Hn.EllipseAnchor=_m;var vm=class{get kind(){return Im.PolylineEdgeRouter.KIND+":"+wm.RECTANGULAR_ANCHOR_KIND}getAnchor(e,t,n=0){let r=e.bounds,o=rs.Bounds.center(r),s=new bm(o,t);if(!(0,rs.almostEquals)(o.y,t.y)){let a=this.getXIntersection(r.y,o,t);a>=r.x&&a<=r.x+r.width&&s.addCandidate(a,r.y-n);let c=this.getXIntersection(r.y+r.height,o,t);c>=r.x&&c<=r.x+r.width&&s.addCandidate(c,r.y+r.height+n)}if(!(0,rs.almostEquals)(o.x,t.x)){let a=this.getYIntersection(r.x,o,t);a>=r.y&&a<=r.y+r.height&&s.addCandidate(r.x-n,a);let c=this.getYIntersection(r.x+r.width,o,t);c>=r.y&&c<=r.y+r.height&&s.addCandidate(r.x+r.width+n,c)}return s.best}getXIntersection(e,t,n){let r=(e-t.y)/(n.y-t.y);return(n.x-t.x)*r+t.x}getYIntersection(e,t,n){let r=(e-t.x)/(n.x-t.x);return(n.y-t.y)*r+t.y}};vm=Em([(0,Pm.injectable)()],vm);Hn.RectangleAnchor=vm;var bm=class{constructor(e,t){this.centerPoint=e,this.refPoint=t,this.currentDist=-1}addCandidate(e,t){let n=this.refPoint.x-e,r=this.refPoint.y-t,o=n*n+r*r;(this.currentDist<0||o<this.currentDist)&&(this.currentBest={x:e,y:t},this.currentDist=o)}get best(){return this.currentBest===void 0?this.centerPoint:this.currentBest}},Sm=class{get kind(){return Im.PolylineEdgeRouter.KIND+":"+wm.DIAMOND_ANCHOR_KIND}getAnchor(e,t,n){let r=e.bounds,o=new ym.PointToPointLine(rs.Bounds.center(r),t),s=new ym.Diamond(r).closestSideLine(t),a=(0,ym.intersection)(s,o);return rs.Point.shiftTowards(a,t,n)}};Sm=Em([(0,Pm.injectable)()],Sm);Hn.DiamondAnchor=Sm});var ql=f(Ge=>{"use strict";var k0=Ge&&Ge.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Nj=Ge&&Ge.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},z0=Ge&&Ge.__param||function(i,e){return function(t,n){e(t,n,i)}},ec;Object.defineProperty(Ge,"__esModule",{value:!0});Ge.AddRemoveBezierSegmentCommand=Ge.AddRemoveBezierSegmentAction=Ge.BezierMouseListener=Ge.BezierEdgeRouter=void 0;var Al=_(),Y0=ee(),Yi=_e(),U0=gn(),Lj=Ta(),Bj=At(),Fj=me(),Vj=P(),os=ec=class extends Lj.AbstractEdgeRouter{get kind(){return ec.KIND}route(e){if(!e.source||!e.target)return[];let t=e.routingPoints.length,n=e.source,r=e.target,o=[];if(o.push({kind:"source",x:0,y:0}),t===0){let[d,l]=this.createDefaultBezierHandles(n.position,r.position);o.push({kind:"bezier-control-after",x:d.x,y:d.y,pointIndex:0}),o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:1}),e.routingPoints.push(d),e.routingPoints.push(l)}else if(t>=2)for(let d=0;d<t;d++){let l=e.routingPoints[d];d%3===0&&o.push({kind:"bezier-control-after",x:l.x,y:l.y,pointIndex:d}),(d+1)%3===0?o.push({kind:"bezier-junction",x:l.x,y:l.y,pointIndex:d}):(d+2)%3===0&&o.push({kind:"bezier-control-before",x:l.x,y:l.y,pointIndex:d})}o.push({kind:"target",x:0,y:0});let s=t>2?e.routingPoints[2]:r.position,a=t>2?e.routingPoints[e.routingPoints.length-3]:n.position,c=this.getTranslatedAnchor(n,s,r.parent,e,e.sourceAnchorCorrection),u=this.getTranslatedAnchor(r,a,n.parent,e,e.targetAnchorCorrection);return o[0]={kind:"source",x:c.x,y:c.y},o[o.length-1]={kind:"target",x:u.x,y:u.y},o}createDefaultBezierHandles(e,t){let n={x:e.x-ec.DEFAULT_BEZIER_HANDLE_OFFSET,y:e.y},r={x:t.x+ec.DEFAULT_BEZIER_HANDLE_OFFSET,y:t.y};return[n,r]}createRoutingHandles(e){this.route(e),this.rebuildHandles(e)}rebuildHandles(e){this.addHandle(e,"source","routing-point",-2),this.addHandle(e,"bezier-control-after","bezier-routing-point",0),this.addHandle(e,"bezier-add","bezier-create-routing-point",0);let t=e.routingPoints.length;if(t>2)for(let n=1;n<t-1;n+=3)this.addHandle(e,"bezier-control-before","bezier-routing-point",n),this.addHandle(e,"bezier-add","bezier-create-routing-point",n+1),this.addHandle(e,"bezier-junction","routing-point",n+1),this.addHandle(e,"bezier-remove","bezier-remove-routing-point",n+1),this.addHandle(e,"bezier-control-after","bezier-routing-point",n+2),this.moveBezierControlPair(e.routingPoints[n],n,e);this.addHandle(e,"bezier-control-before","bezier-routing-point",t-1),this.addHandle(e,"target","routing-point",-1)}getInnerHandlePosition(e,t,n){if(n.kind==="bezier-control-before"||n.kind==="bezier-junction"||n.kind==="bezier-control-after")for(let r=0;r<t.length;r++){let o=t[r];if(o.pointIndex===n.pointIndex&&o.kind===n.kind)return o}else if(n.kind==="bezier-add"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y+12.5}}else if(n.kind==="bezier-remove"){let r=this.findBezierControl(e,t,n.pointIndex);return{x:r.x,y:r.y-12.5}}}findBezierControl(e,t,n){let r={x:t[0].x,y:t[0].y};if(n>0){for(let o of t)if(o.pointIndex!==void 0&&o.pointIndex===n&&o.kind==="bezier-junction"){r={x:o.x,y:o.y};break}}return r}applyHandleMoves(e,t){t.forEach(n=>{let r=n.handle,o={x:0,y:0},s,a,c,u=n.toPosition;switch(r.kind){case"bezier-control-before":case"bezier-control-after":this.moveBezierControlPair(u,n.handle.pointIndex,e);break;case"bezier-junction":let d=r.pointIndex;d>=0&&d<e.routingPoints.length&&(c=d-1,o=e.routingPoints[d],s=e.routingPoints[c],a=this.calcRelativeMove(o,u,s),e.routingPoints[d]=u,this.moveBezierControlPair(a,c,e));break;case"source":if(c=0,s=e.routingPoints[c],e.source instanceof Yi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Yi.SDanglingAnchor;l.id=e.id+"_dangling-source",l.original=e.source,l.position=n.toPosition,r.root.add(l),r.danglingAnchor=l,e.sourceId=l.id,e.source&&(o=e.source.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;case"target":if(c=e.routingPoints.length-1,s=e.routingPoints[c],e.target instanceof Yi.SDanglingAnchor)r.danglingAnchor&&(o=r.danglingAnchor.position,r.danglingAnchor.position=u);else{let l=new Yi.SDanglingAnchor;l.id=e.id+"_dangling-target",l.original=e.target,l.position=u,r.root.add(l),r.danglingAnchor=l,e.targetId=l.id,e.target&&(o=e.target.position)}a=this.calcRelativeMove(o,u,s),this.moveBezierControlPair(a,c,e);break;default:break}})}applyInnerHandleMoves(e,t){}getOptions(e){return{minimalPointDistance:2,standardDistance:.1,selfEdgeOffset:20}}calcRelativeMove(e,t,n){return{x:n.x-(e.x-t.x),y:n.y-(e.y-t.y)}}createNewBezierSegment(e,t){let n=t.routingPoints,r,o,s;n.length===2?(o=n[e<0?0:e],s=n[n.length-1],r=(0,Y0.centerOfLine)(o,s)):(o=n[e],s=n[e+2],r=(0,Y0.centerOfLine)(o,s));let[a,c]=this.createDefaultBezierHandles(r,r);n.splice(e+1,0,a),n.splice(e+2,0,r),n.splice(e+3,0,c),this.moveBezierControlPair(a,e+1,t),t.removeAll(u=>u instanceof Yi.SRoutingHandle),this.rebuildHandles(t)}removeBezierSegment(e,t){t.routingPoints.splice(e-1,3),t.removeAll(r=>r instanceof Yi.SRoutingHandle),this.rebuildHandles(t)}moveBezierControlPair(e,t,n){if(t>=0&&t<n.routingPoints.length){let r=t-1,o=t+1;r<0||o===n.routingPoints.length?n.routingPoints[t]=e:t%3===0?this.setBezierMirror(n,e,t,!1):(t+2)%3===0&&this.setBezierMirror(n,e,t,!0)}}setBezierMirror(e,t,n,r){e.routingPoints[n]=t;let o=e.routingPoints[r?n+1:n-1];e.routingPoints[r?n+2:n-2]={x:o.x-(t.x-o.x),y:o.y-(t.y-o.y)}}};os.KIND="bezier";os.DEFAULT_BEZIER_HANDLE_OFFSET=25;os=ec=k0([(0,Al.injectable)()],os);Ge.BezierEdgeRouter=os;var Rm=class extends Bj.MouseListener{mouseDown(e,t){let n=[];return e instanceof Yi.SRoutingHandle&&(e.kind==="bezier-add"||e.kind==="bezier-remove")&&(e.type==="bezier-create-routing-point"?n.push(Cl.create("add",e.id)):e.type==="bezier-remove-routing-point"&&n.push(Cl.create("remove",e.id))),n}};Ge.BezierMouseListener=Rm;var Cl;(function(i){i.KIND="addRemoveBezierSegment";function e(t,n){return{kind:i.KIND,actionTask:t,targetId:n}}i.create=e})(Cl=Ge.AddRemoveBezierSegmentAction||(Ge.AddRemoveBezierSegmentAction={}));var xl=class extends Fj.Command{constructor(e,t){super(),this.action=e,this.edgeRouterRegistry=t}execute(e){let n=e.root.index.getById(this.action.targetId);if(this.edgeRouterRegistry&&n instanceof Yi.SRoutingHandle){let r=this.edgeRouterRegistry.get(n.parent.routerKind);if(r instanceof os){let o=r;for(let s of e.root.children)if(s.id===n.parent.id){this.action.actionTask==="add"?o.createNewBezierSegment(n.pointIndex,s):this.action.actionTask==="remove"&&o.removeBezierSegment(n.pointIndex,s);break}}}return e.root}undo(e){throw new Error("Method not implemented.")}redo(e){throw new Error("Method not implemented.")}};xl.KIND=Cl.KIND;xl=k0([(0,Al.injectable)(),z0(0,(0,Al.inject)(Vj.TYPES.Action)),z0(1,(0,Al.inject)(U0.EdgeRouterRegistry)),Nj("design:paramtypes",[Object,U0.EdgeRouterRegistry])],xl);Ge.AddRemoveBezierSegmentCommand=xl});var jm=f(zn=>{"use strict";var Am=zn&&zn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(zn,"__esModule",{value:!0});zn.BezierDiamondAnchor=zn.BezierRectangleAnchor=zn.BezierEllipseAnchor=void 0;var Cm=oi(),xm=_(),qm=Ol(),Dm=ql(),Mm=class extends qm.EllipseAnchor{get kind(){return Dm.BezierEdgeRouter.KIND+":"+Cm.ELLIPTIC_ANCHOR_KIND}};Mm=Am([(0,xm.injectable)()],Mm);zn.BezierEllipseAnchor=Mm;var Tm=class extends qm.RectangleAnchor{get kind(){return Dm.BezierEdgeRouter.KIND+":"+Cm.RECTANGULAR_ANCHOR_KIND}};Tm=Am([(0,xm.injectable)()],Tm);zn.BezierRectangleAnchor=Tm;var Om=class extends qm.DiamondAnchor{get kind(){return Dm.BezierEdgeRouter.KIND+":"+Cm.DIAMOND_ANCHOR_KIND}};Om=Am([(0,xm.injectable)()],Om);zn.BezierDiamondAnchor=Om});var jl=f(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.ManhattanEdgeRouter=void 0;var ve=ee(),G0=ze(),b=Ta(),Nm=_e(),ss=class extends b.AbstractEdgeRouter{get kind(){return ss.KIND}getOptions(e){return{standardDistance:20,minimalPointDistance:3,selfEdgeOffset:.25}}route(e){if(!e.source||!e.target)return[];let t=this.createRoutedCorners(e),n=t[0]||(0,G0.translatePoint)(ve.Bounds.center(e.target.bounds),e.target.parent,e.parent),r=this.getTranslatedAnchor(e.source,n,e.parent,e,e.sourceAnchorCorrection),o=t[t.length-1]||(0,G0.translatePoint)(ve.Bounds.center(e.source.bounds),e.source.parent,e.parent),s=this.getTranslatedAnchor(e.target,o,e.parent,e,e.targetAnchorCorrection);if(!r||!s)return[];let a=[];return a.push(Object.assign({kind:"source"},r)),t.forEach(c=>a.push(c)),a.push(Object.assign({kind:"target"},s)),a}createRoutedCorners(e){let t=new b.DefaultAnchors(e.source,e.parent,"source"),n=new b.DefaultAnchors(e.target,e.parent,"target");if(e.routingPoints.length>0){let s=e.routingPoints.slice();if(this.cleanupRoutingPoints(e,s,!1,!0),s.length>0)return s.map((a,c)=>Object.assign({kind:"linear",pointIndex:c},a))}let r=this.getOptions(e);return this.calculateDefaultCorners(e,t,n,r).map(s=>Object.assign({kind:"linear"},s))}createRoutingHandles(e){let t=this.route(e);if(this.commitRoute(e,t),t.length>0){this.addHandle(e,"source","routing-point",-2);for(let n=0;n<t.length-1;++n)this.addHandle(e,"manhattan-50%","volatile-routing-point",n-1);this.addHandle(e,"target","routing-point",t.length-2)}}getInnerHandlePosition(e,t,n){let r=this.getFraction(n.kind);if(r!==void 0){let{start:o,end:s}=this.findRouteSegment(e,t,n.pointIndex);if(o!==void 0&&s!==void 0)return ve.Point.linear(o,s,r)}}getFraction(e){switch(e){case"manhattan-50%":return .5;default:return}}applyInnerHandleMoves(e,t){let n=this.route(e),r=e.routingPoints,o=this.getOptions(e).minimalPointDistance;t.forEach(s=>{let a=s.handle,c=a.pointIndex,u=this.correctX(r,c,s.toPosition.x,o),d=this.correctY(r,c,s.toPosition.y,o);switch(a.kind){case"manhattan-50%":c<0?(0,ve.almostEquals)(n[0].x,n[1].x)?this.alignX(r,0,u):this.alignY(r,0,d):c<r.length-1?(0,ve.almostEquals)(r[c].x,r[c+1].x)?(this.alignX(r,c,u),this.alignX(r,c+1,u)):(this.alignY(r,c,d),this.alignY(r,c+1,d)):(0,ve.almostEquals)(n[n.length-2].x,n[n.length-1].x)?this.alignX(r,r.length-1,u):this.alignY(r,r.length-1,d);break}})}correctX(e,t,n,r){return t>0&&Math.abs(n-e[t-1].x)<r?e[t-1].x:t<e.length-2&&Math.abs(n-e[t+2].x)<r?e[t+2].x:n}alignX(e,t,n){t>=0&&t<e.length&&(e[t]={x:n,y:e[t].y})}correctY(e,t,n,r){return t>0&&Math.abs(n-e[t-1].y)<r?e[t-1].y:t<e.length-2&&Math.abs(n-e[t+2].y)<r?e[t+2].y:n}alignY(e,t,n){t>=0&&t<e.length&&(e[t]={x:e[t].x,y:n})}cleanupRoutingPoints(e,t,n,r){let o=new b.DefaultAnchors(e.source,e.parent,"source"),s=new b.DefaultAnchors(e.target,e.parent,"target");if(!this.resetRoutingPointsOnReconnect(e,t,n,o,s)){for(let a=0;a<t.length&&ve.Bounds.includes(o.bounds,t[a]);++a)t.splice(0,1),n&&this.removeHandle(e,-1);for(let a=t.length-1;a>=0&&ve.Bounds.includes(s.bounds,t[a]);--a)t.splice(a,1),n&&this.removeHandle(e,a);if(t.length>=2){let a=this.getOptions(e);for(let c=t.length-2;c>=0;--c)ve.Point.manhattanDistance(t[c],t[c+1])<a.minimalPointDistance&&(t.splice(c,2),--c,n&&(this.removeHandle(e,c-1),this.removeHandle(e,c)))}r&&(this.addAdditionalCorner(e,t,o,s,n),this.addAdditionalCorner(e,t,s,o,n),this.manhattanify(e,t))}}removeHandle(e,t){let n=[];e.children.forEach(r=>{r instanceof Nm.SRoutingHandle&&(r.pointIndex>t?--r.pointIndex:r.pointIndex===t&&n.push(r))}),n.forEach(r=>e.remove(r))}addAdditionalCorner(e,t,n,r,o){if(t.length===0)return;let s=n.kind==="source"?t[0]:t[t.length-1],a=n.kind==="source"?0:t.length,c=a-(n.kind==="source"?1:0),u;if(t.length>1)u=a===0?(0,ve.almostEquals)(t[0].x,t[1].x):(0,ve.almostEquals)(t[t.length-1].x,t[t.length-2].x);else{let d=r.getNearestSide(s);u=d===b.Side.TOP||d===b.Side.BOTTOM}if(u){if(s.y<n.get(b.Side.TOP).y||s.y>n.get(b.Side.BOTTOM).y){let d={x:n.get(b.Side.TOP).x,y:s.y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Nm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}else if(s.x<n.get(b.Side.LEFT).x||s.x>n.get(b.Side.RIGHT).x){let d={x:s.x,y:n.get(b.Side.LEFT).y};t.splice(a,0,d),o&&(e.children.forEach(l=>{l instanceof Nm.SRoutingHandle&&l.pointIndex>=c&&++l.pointIndex}),this.addHandle(e,"manhattan-50%","volatile-routing-point",c))}}manhattanify(e,t){for(let n=1;n<t.length;++n){let r=Math.abs(t[n-1].x-t[n].x)<1,o=Math.abs(t[n-1].y-t[n].y)<1;!r&&!o&&(t.splice(n,0,{x:t[n-1].x,y:t[n].y}),++n)}}calculateDefaultCorners(e,t,n,r){let o=super.calculateDefaultCorners(e,t,n,r);if(o.length>0)return o;let s=this.getBestConnectionAnchors(e,t,n,r),a=s.source,c=s.target,u=[],d=t.get(a),l=n.get(c);switch(a){case b.Side.RIGHT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;case b.Side.RIGHT:u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:d.y}),u.push({x:Math.max(d.x,l.x)+1.5*r.standardDistance,y:l.y});break;case b.Side.LEFT:l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.LEFT:switch(c){case b.Side.BOTTOM:u.push({x:l.x,y:d.y});break;case b.Side.TOP:u.push({x:l.x,y:d.y});break;default:l=n.get(b.Side.RIGHT),l.y!==d.y&&(u.push({x:(d.x+l.x)/2,y:d.y}),u.push({x:(d.x+l.x)/2,y:l.y}));break}break;case b.Side.TOP:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y-r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.TOP:u.push({x:d.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance}),u.push({x:l.x,y:Math.min(d.y,l.y)-1.5*r.standardDistance});break;case b.Side.BOTTOM:l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break;case b.Side.BOTTOM:switch(c){case b.Side.RIGHT:l.x-d.x>0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x+1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;case b.Side.LEFT:l.x-d.x<0?(u.push({x:d.x,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:d.y+r.standardDistance}),u.push({x:l.x-1.5*r.standardDistance,y:l.y})):u.push({x:d.x,y:l.y});break;default:l=n.get(b.Side.TOP),l.x!==d.x&&(u.push({x:d.x,y:(d.y+l.y)/2}),u.push({x:l.x,y:(d.y+l.y)/2}));break}break}return u}getBestConnectionAnchors(e,t,n,r){let o=t.get(b.Side.RIGHT),s=n.get(b.Side.LEFT);if(s.x-o.x>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.LEFT};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.RIGHT),o.x-s.x>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.RIGHT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.BOTTOM),o.y-s.y>r.standardDistance)return{source:b.Side.TOP,target:b.Side.BOTTOM};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.TOP),s.y-o.y>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.TOP};if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.TOP),s.x-o.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.TOP};if(s=n.get(b.Side.BOTTOM),s.x-o.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.RIGHT,target:b.Side.BOTTOM};if(o=t.get(b.Side.LEFT),s=n.get(b.Side.BOTTOM),o.x-s.x>.5*r.standardDistance&&o.y-s.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.BOTTOM};if(s=n.get(b.Side.TOP),o.x-s.x>.5*r.standardDistance&&s.y-o.y>r.standardDistance)return{source:b.Side.LEFT,target:b.Side.TOP};if(o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),o.y-s.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),o.y-s.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.TOP,target:b.Side.LEFT};if(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),s.y-o.y>.5*r.standardDistance&&o.x-s.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.RIGHT};if(s=n.get(b.Side.LEFT),s.y-o.y>.5*r.standardDistance&&s.x-o.x>r.standardDistance)return{source:b.Side.BOTTOM,target:b.Side.LEFT};if(o=t.get(b.Side.TOP),s=n.get(b.Side.TOP),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)){if(o.y-s.y<0){if(Math.abs(o.x-s.x)>(t.bounds.width+r.standardDistance)/2)return{source:b.Side.TOP,target:b.Side.TOP}}else if(Math.abs(o.x-s.x)>n.bounds.width/2)return{source:b.Side.TOP,target:b.Side.TOP}}if(o=t.get(b.Side.RIGHT),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)){if(o.x-s.x>0){if(Math.abs(o.y-s.y)>(t.bounds.height+r.standardDistance)/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}else if(Math.abs(o.y-s.y)>n.bounds.height/2)return{source:b.Side.RIGHT,target:b.Side.RIGHT}}return o=t.get(b.Side.TOP),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.TOP,target:b.Side.LEFT}:(o=t.get(b.Side.BOTTOM),s=n.get(b.Side.RIGHT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.RIGHT}:(s=n.get(b.Side.LEFT),!ve.Bounds.includes(n.bounds,o)&&!ve.Bounds.includes(t.bounds,s)?{source:b.Side.BOTTOM,target:b.Side.LEFT}:{source:b.Side.RIGHT,target:b.Side.BOTTOM})))}};Dl.ManhattanEdgeRouter=ss;ss.KIND="manhattan"});var Ym=f(Yn=>{"use strict";var Vm=Yn&&Yn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Lm,Bm,Fm;Object.defineProperty(Yn,"__esModule",{value:!0});Yn.ManhattanEllipticAnchor=Yn.ManhattanDiamondAnchor=Yn.ManhattanRectangularAnchor=void 0;var Nl=ee(),Ft=Or(),Km=oi(),Hm=jl(),zm=_(),Ll=Lm=class{get kind(){return Lm.KIND}getAnchor(e,t,n){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n};return t.x>=o.x&&o.x+o.width>=t.x?t.y<o.y+.5*o.height?{x:t.x,y:o.y}:{x:t.x,y:o.y+o.height}:t.y>=o.y&&o.y+o.height>=t.y?t.x<o.x+.5*o.width?{x:o.x,y:t.y}:{x:o.x+o.width,y:t.y}:Nl.Bounds.center(o)}};Ll.KIND=Hm.ManhattanEdgeRouter.KIND+":"+Km.RECTANGULAR_ANCHOR_KIND;Ll=Lm=Vm([(0,zm.injectable)()],Ll);Yn.ManhattanRectangularAnchor=Ll;var Bl=Bm=class{get kind(){return Bm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Nl.Bounds.center(o),a,c;return t.x>=o.x&&t.x<=o.x+o.width?o.x+.5*o.width>=t.x?(c=new Ft.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height})):(c=new Ft.PointToPointLine(t,{x:t.x,y:s.y}),t.y<s.y?a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height})):t.y>=o.y&&t.y<=o.y+o.height&&(o.y+.5*o.height>=t.y?(c=new Ft.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y})):(c=new Ft.PointToPointLine(t,{x:s.x,y:t.y}),t.x<s.x?a=new Ft.PointToPointLine({x:o.x,y:s.y},{x:s.x,y:o.y+o.height}):a=new Ft.PointToPointLine({x:o.x+o.width,y:s.y},{x:s.x,y:o.y+o.height}))),c&&a?(0,Ft.intersection)(a,c):s}};Bl.KIND=Hm.ManhattanEdgeRouter.KIND+":"+Km.DIAMOND_ANCHOR_KIND;Bl=Bm=Vm([(0,zm.injectable)()],Bl);Yn.ManhattanDiamondAnchor=Bl;var Fl=Fm=class{get kind(){return Fm.KIND}getAnchor(e,t,n=0){let r=e.bounds;if(r.width<=0||r.height<=0)return r;let o={x:r.x-n,y:r.y-n,width:r.width+2*n,height:r.height+2*n},s=Nl.Bounds.center(o),a=Nl.Point.subtract(t,s),c=s.x,u=s.y;if(t.x>=o.x&&o.x+o.width>=t.x){c+=a.x;let d=.5*o.height*Math.sqrt(1-a.x*a.x/(.25*o.width*o.width));a.y<0?u-=d:u+=d}else if(t.y>=o.y&&o.y+o.height>=t.y){u+=a.y;let d=.5*o.width*Math.sqrt(1-a.y*a.y/(.25*o.height*o.height));a.x<0?c-=d:c+=d}return{x:c,y:u}}};Fl.KIND=Hm.ManhattanEdgeRouter.KIND+":"+Km.ELLIPTIC_ANCHOR_KIND;Fl=Fm=Vm([(0,zm.injectable)()],Fl);Yn.ManhattanEllipticAnchor=Fl});var km=f(as=>{"use strict";var Kj=as&&as.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(as,"__esModule",{value:!0});as.RoutableView=void 0;var Hj=_(),zj=_e(),Um=class{isVisible(e,t,n){if(n.targetKind==="hidden"||t.length===0)return!0;let r=(0,zj.getAbsoluteRouteBounds)(e,t),o=e.root.canvasBounds;return r.x<=o.width&&r.x+r.width>=0&&r.y<=o.height&&r.y+r.height>=0}};Um=Kj([(0,Hj.injectable)()],Um);as.RoutableView=Um});var Gm=f(Ui=>{"use strict";var $0=Ui&&Ui.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},Yj=Ui&&Ui.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ui,"__esModule",{value:!0});Ui.ModelRequestCommand=void 0;var W0=_(),Uj=P(),kj=me(),Vl=class extends kj.SystemCommand{execute(e){let t=this.retrieveResult(e);return this.actionDispatcher.dispatch(t),{model:e.root,modelChanged:!1}}undo(e){return{model:e.root,modelChanged:!1}}redo(e){return{model:e.root,modelChanged:!1}}};$0([(0,W0.inject)(Uj.TYPES.IActionDispatcher),Yj("design:type",Object)],Vl.prototype,"actionDispatcher",void 0);Vl=$0([(0,W0.injectable)()],Vl);Ui.ModelRequestCommand=Vl});var Xl=f(se=>{"use strict";var Gl=se&&se.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},$l=se&&se.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Jm=se&&se.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(se,"__esModule",{value:!0});se.SelectKeyboardListener=se.GetSelectionCommand=se.SelectMouseListener=se.SelectAllCommand=se.SelectCommand=se.SelectionResult=se.GetSelectionAction=se.SelectAllAction=se.SelectAction=void 0;var ki=_(),Wl=ie(),Z0=me(),Gj=Gm(),Wm=$(),$m=ze(),Zm=P(),$j=dn(),Wj=At(),Xj=Be(),X0=On(),Q0=or(),Jj=An(),J0=va(),Zj=bd(),Kl=Va(),Qj=_e(),Hl=_e(),di=wt(),Un=class{constructor(e=[],t=[]){this.selectedElementsIDs=e,this.deselectedElementsIDs=t,this.kind=Un.KIND}};se.SelectAction=Un;Un.KIND="elementSelected";var Nr=class{constructor(e=!0){this.select=e,this.kind=Nr.KIND}};se.SelectAllAction=Nr;Nr.KIND="allSelected";var ew;(function(i){i.KIND="getSelection";function e(){return{kind:i.KIND,requestId:(0,Wl.generateRequestId)()}}i.create=e})(ew=se.GetSelectionAction||(se.GetSelectionAction={}));var tw;(function(i){i.KIND="selectionResult";function e(t,n){return{kind:i.KIND,selectedElementsIDs:t,responseId:n}}i.create=e})(tw=se.SelectionResult||(se.SelectionResult={}));var zl=class extends Z0.Command{constructor(e){super(),this.action=e,this.selected=[],this.deselected=[]}execute(e){let t=e.root;return this.action.selectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Wm.SChildElement&&(0,di.isSelectable)(r)&&this.selected.push(r)}),this.action.deselectedElementsIDs.forEach(n=>{let r=t.index.getById(n);r instanceof Wm.SChildElement&&(0,di.isSelectable)(r)&&this.deselected.push(r)}),this.redo(e)}undo(e){for(let t of this.selected)t.selected=!1;for(let t of this.deselected)t.selected=!0;return e.root}redo(e){for(let t of this.deselected)t.selected=!1;for(let t of this.selected)t.selected=!0;return e.root}};zl.KIND=Wl.SelectAction.KIND;zl=Gl([(0,ki.injectable)(),Jm(0,(0,ki.inject)(Zm.TYPES.Action)),$l("design:paramtypes",[Object])],zl);se.SelectCommand=zl;var Yl=class extends Z0.Command{constructor(e){super(),this.action=e,this.previousSelection={}}execute(e){return this.selectAll(e.root,this.action.select),e.root}selectAll(e,t){(0,di.isSelectable)(e)&&(this.previousSelection[e.id]=e.selected,e.selected=t);for(let n of e.children)this.selectAll(n,t)}undo(e){let t=e.root.index;return Object.keys(this.previousSelection).forEach(n=>{let r=t.getById(n);r!==void 0&&(0,di.isSelectable)(r)&&(r.selected=this.previousSelection[n])}),e.root}redo(e){return this.selectAll(e.root,this.action.select),e.root}};Yl.KIND=Wl.SelectAllAction.KIND;Yl=Gl([(0,ki.injectable)(),Jm(0,(0,ki.inject)(Zm.TYPES.Action)),$l("design:paramtypes",[Object])],Yl);se.SelectAllCommand=Yl;var Ul=class extends Wj.MouseListener{constructor(){super(...arguments),this.wasSelected=!1,this.hasDragged=!1}mouseDown(e,t){if(t.button!==0)return[];let n=this.handleButton(e,t);if(n)return n;let r=(0,$m.findParentByFeature)(e,di.isSelectable);if(r!==void 0||e instanceof Wm.SModelRoot){this.hasDragged=!1;let o=[];if((0,X0.isCtrlOrCmd)(t)||(o=(0,Q0.toArray)(e.root.index.all().filter(s=>(0,di.isSelectable)(s)&&s.selected&&!(r instanceof Qj.SRoutingHandle&&s===r.parent)))),r!==void 0)if(r.selected){if((0,X0.isCtrlOrCmd)(t))return this.wasSelected=!1,this.handleDeselectTarget(r,t);this.wasSelected=!0}else return this.wasSelected=!1,this.handleSelectTarget(r,o,t);else return this.handleDeselectAll(o,t)}return[]}handleButton(e,t){if(this.buttonHandlerRegistry!==void 0&&e instanceof Zj.SButton&&e.enabled){let n=this.buttonHandlerRegistry.get(e.type);if(n!==void 0)return n.buttonPressed(e)}}handleSelectTarget(e,t,n){let r=[];r.push(new Un([e.id],t.map(s=>s.id))),r.push(Wl.BringToFrontAction.create([e.id]));let o=t.filter(s=>s instanceof Hl.SRoutableElement).map(s=>s.id);return e instanceof Hl.SRoutableElement?r.push(Kl.SwitchEditModeAction.create({elementsToActivate:[e.id],elementsToDeactivate:o})):o.length>0&&r.push(Kl.SwitchEditModeAction.create({elementsToDeactivate:o})),r}handleDeselectTarget(e,t){let n=[];return n.push(new Un([],[e.id])),e instanceof Hl.SRoutableElement&&n.push(Kl.SwitchEditModeAction.create({elementsToDeactivate:[e.id]})),n}handleDeselectAll(e,t){let n=[];n.push(new Un([],e.map(o=>o.id)));let r=e.filter(o=>o instanceof Hl.SRoutableElement).map(o=>o.id);return r.length>0&&n.push(Kl.SwitchEditModeAction.create({elementsToDeactivate:r})),n}mouseMove(e,t){return this.hasDragged=!0,[]}mouseUp(e,t){if(t.button===0&&!this.hasDragged){let n=(0,$m.findParentByFeature)(e,di.isSelectable);if(n!==void 0&&this.wasSelected)return[new Un([n.id],[])]}return this.hasDragged=!1,[]}decorate(e,t){let n=(0,$m.findParentByFeature)(t,di.isSelectable);return n!==void 0&&(0,Xj.setClass)(e,"selected",n.selected),e}};Gl([(0,ki.inject)(J0.ButtonHandlerRegistry),(0,ki.optional)(),$l("design:type",J0.ButtonHandlerRegistry)],Ul.prototype,"buttonHandlerRegistry",void 0);se.SelectMouseListener=Ul;var kl=class extends Gj.ModelRequestCommand{constructor(e){super(),this.action=e,this.previousSelection={}}retrieveResult(e){let t=e.root.index.all().filter(n=>(0,di.isSelectable)(n)&&n.selected).map(n=>n.id);return tw.create((0,Q0.toArray)(t),this.action.requestId)}};kl.KIND=ew.KIND;kl=Gl([(0,ki.injectable)(),Jm(0,(0,ki.inject)(Zm.TYPES.Action)),$l("design:paramtypes",[Object])],kl);se.GetSelectionCommand=kl;var Xm=class extends $j.KeyListener{keyDown(e,t){return(0,Jj.matchesKeystroke)(t,"KeyA","ctrlCmd")?[new Nr]:[]}};se.SelectKeyboardListener=Xm});var ty=f(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.UndoRedoKeyListener=kn.RedoAction=kn.UndoAction=void 0;var Qm=An(),eN=dn(),tN=On(),nw;(function(i){i.KIND="undo";function e(){return{kind:i.KIND}}i.create=e})(nw=kn.UndoAction||(kn.UndoAction={}));var iw;(function(i){i.KIND="redo";function e(){return{kind:i.KIND}}i.create=e})(iw=kn.RedoAction||(kn.RedoAction={}));var ey=class extends eN.KeyListener{keyDown(e,t){return(0,Qm.matchesKeystroke)(t,"KeyZ","ctrlCmd")?[nw.create()]:(0,Qm.matchesKeystroke)(t,"KeyZ","ctrlCmd","shift")||!(0,tN.isMac)()&&(0,Qm.matchesKeystroke)(t,"KeyY","ctrlCmd")?[iw.create()]:[]}};kn.UndoRedoKeyListener=ey});var Jl=f(Gi=>{"use strict";Object.defineProperty(Gi,"__esModule",{value:!0});Gi.applyMatches=Gi.ModelMatcher=Gi.forEachMatch=void 0;var ny=$(),nN=hr();function iN(i,e){Object.keys(i).forEach(t=>e(t,i[t]))}Gi.forEachMatch=iN;var iy=class{match(e,t){let n={};return this.matchLeft(e,n),this.matchRight(t,n),n}matchLeft(e,t,n){let r=t[e.id];if(r!==void 0?(r.left=e,r.leftParentId=n):(r={left:e,leftParentId:n},t[e.id]=r),(0,ny.isParent)(e))for(let o of e.children)this.matchLeft(o,t,e.id)}matchRight(e,t,n){let r=t[e.id];if(r!==void 0?(r.right=e,r.rightParentId=n):(r={right:e,rightParentId:n},t[e.id]=r),(0,ny.isParent)(e))for(let o of e.children)this.matchRight(o,t,e.id)}};Gi.ModelMatcher=iy;function rN(i,e,t){i instanceof ny.SModelRoot?t=i.index:t===void 0&&(t=new nN.SModelIndex,t.add(i));for(let n of e){let r=!1;if(n.left!==void 0&&n.leftParentId!==void 0){let o=t.getById(n.leftParentId);if(o!==void 0&&o.children!==void 0){let s=o.children.indexOf(n.left);s>=0&&(n.right!==void 0&&n.leftParentId===n.rightParentId?(o.children.splice(s,1,n.right),r=!0):o.children.splice(s,1)),t.remove(n.left)}}if(!r&&n.right!==void 0&&n.rightParentId!==void 0){let o=t.getById(n.rightParentId);o!==void 0&&(o.children===void 0&&(o.children=[]),o.children.push(n.right))}}}Gi.applyMatches=rN});var rw=f(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.ResizeAnimation=void 0;var oN=ur(),ry=class extends oN.Animation{constructor(e,t,n,r=!1){super(n),this.model=e,this.elementResizes=t,this.reverse=r}tween(e){return this.elementResizes.forEach(t=>{let n=t.element,r=this.reverse?{width:(1-e)*t.toDimension.width+e*t.fromDimension.width,height:(1-e)*t.toDimension.height+e*t.fromDimension.height}:{width:(1-e)*t.fromDimension.width+e*t.toDimension.width,height:(1-e)*t.fromDimension.height+e*t.toDimension.height};n.bounds={x:n.bounds.x,y:n.bounds.y,width:r.width,height:r.height}}),this.model}};Zl.ResizeAnimation=ry});var ef=f(on=>{"use strict";var mw=on&&on.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},yw=on&&on.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},sN=on&&on.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(on,"__esModule",{value:!0});on.UpdateModelCommand=on.UpdateModelAction=void 0;var Ql=_(),aN=ie(),cs=ee(),ow=ur(),cN=me(),uN=hl(),us=$(),sw=Qa(),aw=qo(),cw=qi(),uw=ue(),dw=jd(),lw=wt(),fw=Jl(),dN=rw(),lN=P(),hw=Dn(),pw=gn(),gw=_e(),fN=ze(),ds=class{constructor(e,t=!0,n){this.animate=t,this.cause=n,this.kind=ds.KIND,e.id!==void 0?this.newRoot=e:this.matches=e}};on.UpdateModelAction=ds;ds.KIND="updateModel";var tc=class extends cN.Command{constructor(e){super(),this.action=e}execute(e){let t;return this.action.newRoot!==void 0?t=e.modelFactory.createRoot(this.action.newRoot):(t=e.modelFactory.createRoot(e.root),this.action.matches!==void 0&&this.applyMatches(t,this.action.matches,e)),this.oldRoot=e.root,this.newRoot=t,this.performUpdate(this.oldRoot,this.newRoot,e)}performUpdate(e,t,n){if((this.action.animate===void 0||this.action.animate)&&e.id===t.id){let r;this.action.matches===void 0?r=new fw.ModelMatcher().match(e,t):r=this.convertToMatchResult(this.action.matches,e,t);let o=this.computeAnimation(t,r,n);return o instanceof ow.Animation?o.start():o}else return e.type===t.type&&cs.Dimension.isValid(e.canvasBounds)&&(t.canvasBounds=e.canvasBounds),(0,hw.isViewport)(e)&&(0,hw.isViewport)(t)&&(t.zoom=e.zoom,t.scroll=e.scroll),t}applyMatches(e,t,n){let r=e.index;for(let o of t)if(o.left!==void 0){let s=r.getById(o.left.id);s instanceof us.SChildElement&&s.parent.remove(s)}for(let o of t)if(o.right!==void 0){let s=n.modelFactory.createElement(o.right),a;o.rightParentId!==void 0&&(a=r.getById(o.rightParentId)),a instanceof us.SParentElement?a.add(s):e.add(s)}}convertToMatchResult(e,t,n){let r={};for(let o of e){let s={},a;o.left!==void 0&&(a=o.left.id,s.left=t.index.getById(a),s.leftParentId=o.leftParentId),o.right!==void 0&&(a=o.right.id,s.right=n.index.getById(a),s.rightParentId=o.rightParentId),a!==void 0&&(r[a]=s)}return r}computeAnimation(e,t,n){let r={fades:[]};(0,fw.forEachMatch)(t,(s,a)=>{if(a.left!==void 0&&a.right!==void 0)this.updateElement(a.left,a.right,r);else if(a.right!==void 0){let c=a.right;(0,aw.isFadeable)(c)&&(c.opacity=0,r.fades.push({element:c,type:"in"}))}else if(a.left instanceof us.SChildElement){let c=a.left;if((0,aw.isFadeable)(c)&&a.leftParentId!==void 0&&!(0,fN.containsSome)(e,c)){let u=e.index.getById(a.leftParentId);if(u instanceof us.SParentElement){let d=n.modelFactory.createElement(c);u.add(d),r.fades.push({element:d,type:"out"})}}}});let o=this.createAnimations(r,e,n);return o.length>=2?new ow.CompoundAnimation(e,n,o):o.length===1?o[0]:e}updateElement(e,t,n){if((0,cw.isLocateable)(e)&&(0,cw.isLocateable)(t)){let r=e.position,o=t.position;(!(0,cs.almostEquals)(r.x,o.x)||!(0,cs.almostEquals)(r.y,o.y))&&(n.moves===void 0&&(n.moves=[]),n.moves.push({element:t,fromPosition:r,toPosition:o}),t.position=r)}(0,uw.isSizeable)(e)&&(0,uw.isSizeable)(t)&&(cs.Dimension.isValid(t.bounds)?(!(0,cs.almostEquals)(e.bounds.width,t.bounds.width)||!(0,cs.almostEquals)(e.bounds.height,t.bounds.height))&&(n.resizes===void 0&&(n.resizes=[]),n.resizes.push({element:t,fromDimension:{width:e.bounds.width,height:e.bounds.height},toDimension:{width:t.bounds.width,height:t.bounds.height}})):t.bounds={x:t.bounds.x,y:t.bounds.y,width:e.bounds.width,height:e.bounds.height}),e instanceof gw.SRoutableElement&&t instanceof gw.SRoutableElement&&this.edgeRouterRegistry&&(n.edgeMementi===void 0&&(n.edgeMementi=[]),n.edgeMementi.push({edge:t,before:this.takeSnapshot(e),after:this.takeSnapshot(t)})),(0,lw.isSelectable)(e)&&(0,lw.isSelectable)(t)&&(t.selected=e.selected),e instanceof us.SModelRoot&&t instanceof us.SModelRoot&&(t.canvasBounds=e.canvasBounds),e instanceof dw.ViewportRootElement&&t instanceof dw.ViewportRootElement&&(t.scroll=e.scroll,t.zoom=e.zoom)}takeSnapshot(e){return this.edgeRouterRegistry.get(e.routerKind).takeSnapshot(e)}createAnimations(e,t,n){let r=[];if(e.fades.length>0&&r.push(new uN.FadeAnimation(t,e.fades,n,!0)),e.moves!==void 0&&e.moves.length>0){let o=new Map;for(let s of e.moves)o.set(s.element.id,s);r.push(new sw.MoveAnimation(t,o,n,!1))}if(e.resizes!==void 0&&e.resizes.length>0){let o=new Map;for(let s of e.resizes)o.set(s.element.id,s);r.push(new dN.ResizeAnimation(t,o,n,!1))}return e.edgeMementi!==void 0&&e.edgeMementi.length>0&&r.push(new sw.MorphEdgesAnimation(t,e.edgeMementi,n,!1)),r}undo(e){return this.performUpdate(this.newRoot,this.oldRoot,e)}redo(e){return this.performUpdate(this.oldRoot,this.newRoot,e)}};tc.KIND=aN.UpdateModelAction.KIND;mw([(0,Ql.inject)(pw.EdgeRouterRegistry),(0,Ql.optional)(),yw("design:type",pw.EdgeRouterRegistry)],tc.prototype,"edgeRouterRegistry",void 0);tc=mw([(0,Ql.injectable)(),sN(0,(0,Ql.inject)(lN.TYPES.Action)),yw("design:paramtypes",[Object])],tc);on.UpdateModelCommand=tc});var hs=f(Ee=>{"use strict";var _w=Ee&&Ee.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vw=Ee&&Ee.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},bw=Ee&&Ee.__param||function(i,e){return function(t,n){e(t,n,i)}},oy;Object.defineProperty(Ee,"__esModule",{value:!0});Ee.ViewportAnimation=Ee.GetViewportCommand=Ee.SetViewportCommand=Ee.ViewportResult=Ee.GetViewportAction=Ee.SetViewportAction=void 0;var sy=_(),Sw=ie(),hN=ee(),pN=me(),gN=ur(),Ew=Dn(),ww=P(),mN=Gm(),fs=class{constructor(e,t,n){this.elementId=e,this.newViewport=t,this.animate=n,this.kind=fs.KIND}};Ee.SetViewportAction=fs;fs.KIND="viewport";var Pw;(function(i){i.KIND="getViewport";function e(){return{kind:i.KIND,requestId:(0,Sw.generateRequestId)()}}i.create=e})(Pw=Ee.GetViewportAction||(Ee.GetViewportAction={}));var Iw;(function(i){i.KIND="viewportResult";function e(t,n,r){return{kind:i.KIND,viewport:t,canvasBounds:n,responseId:r}}i.create=e})(Iw=Ee.ViewportResult||(Ee.ViewportResult={}));var tf=oy=class extends pN.MergeableCommand{constructor(e){super(),this.action=e,this.newViewport=e.newViewport}execute(e){let t=e.root,n=t.index.getById(this.action.elementId);if(n&&(0,Ew.isViewport)(n)){if(this.element=n,this.oldViewport={scroll:this.element.scroll,zoom:this.element.zoom},this.action.animate)return new ls(this.element,this.oldViewport,this.newViewport,e).start();this.element.scroll=this.newViewport.scroll,this.element.zoom=this.newViewport.zoom}return t}undo(e){return new ls(this.element,this.newViewport,this.oldViewport,e).start()}redo(e){return new ls(this.element,this.oldViewport,this.newViewport,e).start()}merge(e,t){return!this.action.animate&&e instanceof oy&&this.element===e.element?(this.newViewport=e.newViewport,!0):!1}};tf.KIND=Sw.SetViewportAction.KIND;tf=oy=_w([(0,sy.injectable)(),bw(0,(0,sy.inject)(ww.TYPES.Action)),vw("design:paramtypes",[Object])],tf);Ee.SetViewportCommand=tf;var nf=class extends mN.ModelRequestCommand{constructor(e){super(),this.action=e}retrieveResult(e){let t=e.root,n;return(0,Ew.isViewport)(t)?n={scroll:t.scroll,zoom:t.zoom}:n={scroll:hN.Point.ORIGIN,zoom:1},Iw.create(n,t.canvasBounds,this.action.requestId)}};nf.KIND=Pw.KIND;nf=_w([bw(0,(0,sy.inject)(ww.TYPES.Action)),vw("design:paramtypes",[Object])],nf);Ee.GetViewportCommand=nf;var ls=class extends gN.Animation{constructor(e,t,n,r){super(r),this.element=e,this.oldViewport=t,this.newViewport=n,this.context=r,this.zoomFactor=Math.log(n.zoom/t.zoom)}tween(e,t){return this.element.scroll={x:(1-e)*this.oldViewport.scroll.x+e*this.newViewport.scroll.x,y:(1-e)*this.oldViewport.scroll.y+e*this.newViewport.scroll.y},this.element.zoom=this.oldViewport.zoom*Math.exp(e*this.zoomFactor),t.root}};Ee.ViewportAnimation=ls});var af=f(Ae=>{"use strict";var uy=Ae&&Ae.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},dy=Ae&&Ae.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},Tw=Ae&&Ae.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.CenterKeyboardListener=Ae.FitToScreenCommand=Ae.CenterCommand=Ae.BoundsAwareViewportCommand=Ae.FitToScreenAction=Ae.CenterAction=void 0;var Ow=ie(),ps=ee(),Rw=An(),yN=$(),_N=me(),vN=dn(),ay=ue(),bN=wt(),Mw=hs(),rf=Dn(),ly=_(),Aw=P(),Lr=class{constructor(e,t=!0,n=!1){this.elementIds=e,this.animate=t,this.retainZoom=n,this.kind=Lr.KIND}};Ae.CenterAction=Lr;Lr.KIND="center";var Br=class{constructor(e,t,n,r=!0){this.elementIds=e,this.padding=t,this.maxZoom=n,this.animate=r,this.kind=Br.KIND}};Ae.FitToScreenAction=Br;Br.KIND="fit";var nc=class extends _N.Command{constructor(e){super(),this.animate=e}initialize(e){if((0,rf.isViewport)(e)){this.oldViewport={scroll:e.scroll,zoom:e.zoom};let t=[];if(this.getElementIds().forEach(n=>{let r=e.index.getById(n);r&&(0,ay.isBoundsAware)(r)&&t.push(this.boundsInViewport(r,r.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,bN.isSelectable)(n)&&n.selected&&(0,ay.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length===0&&e.index.all().forEach(n=>{(0,ay.isBoundsAware)(n)&&t.push(this.boundsInViewport(n,n.bounds,e))}),t.length!==0){let n=t.reduce((r,o)=>ps.Bounds.combine(r,o));ps.Dimension.isValid(n)&&(this.newViewport=this.getNewViewport(n,e))}}}boundsInViewport(e,t,n){return e instanceof yN.SChildElement&&e.parent!==n?this.boundsInViewport(e.parent,e.parent.localToParent(t),n):t}execute(e){return this.initialize(e.root),this.redo(e)}undo(e){let t=e.root;if((0,rf.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new Mw.ViewportAnimation(t,this.newViewport,this.oldViewport,e).start();t.scroll=this.oldViewport.scroll,t.zoom=this.oldViewport.zoom}return t}redo(e){let t=e.root;if((0,rf.isViewport)(t)&&this.newViewport!==void 0&&!this.equal(this.newViewport,this.oldViewport)){if(this.animate)return new Mw.ViewportAnimation(t,this.oldViewport,this.newViewport,e).start();t.scroll=this.newViewport.scroll,t.zoom=this.newViewport.zoom}return t}equal(e,t){return e.zoom===t.zoom&&e.scroll.x===t.scroll.x&&e.scroll.y===t.scroll.y}};nc=uy([(0,ly.injectable)(),dy("design:paramtypes",[Boolean])],nc);Ae.BoundsAwareViewportCommand=nc;var of=class extends nc{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ps.Dimension.isValid(t.canvasBounds))return;let n=this.action.retainZoom&&(0,rf.isViewport)(t)?t.zoom:1,r=ps.Bounds.center(e);return{scroll:{x:r.x-.5*t.canvasBounds.width/n,y:r.y-.5*t.canvasBounds.height/n},zoom:n}}};of.KIND=Ow.CenterAction.KIND;of=uy([Tw(0,(0,ly.inject)(Aw.TYPES.Action)),dy("design:paramtypes",[Object])],of);Ae.CenterCommand=of;var sf=class extends nc{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!ps.Dimension.isValid(t.canvasBounds))return;let n=ps.Bounds.center(e),r=this.action.padding===void 0?0:2*this.action.padding,o=Math.min(t.canvasBounds.width/(e.width+r),t.canvasBounds.height/(e.height+r));return this.action.maxZoom!==void 0&&(o=Math.min(o,this.action.maxZoom)),o===1/0&&(o=1),{scroll:{x:n.x-.5*t.canvasBounds.width/o,y:n.y-.5*t.canvasBounds.height/o},zoom:o}}};sf.KIND=Ow.FitToScreenAction.KIND;sf=uy([Tw(0,(0,ly.inject)(Aw.TYPES.Action)),dy("design:paramtypes",[Object])],sf);Ae.FitToScreenCommand=sf;var cy=class extends vN.KeyListener{keyDown(e,t){return(0,Rw.matchesKeystroke)(t,"KeyC","ctrlCmd","shift")?[new Lr([])]:(0,Rw.matchesKeystroke)(t,"KeyF","ctrlCmd","shift")?[new Br([])]:[]}};Ae.CenterKeyboardListener=cy});var py=f(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.ScrollMouseListener=gs.isScrollable=void 0;var fy=ie(),SN=$(),EN=At(),ic=ze(),cf=Dn(),wN=qi(),PN=_e(),IN=Ml(),RN=On();function MN(i){return"scroll"in i}gs.isScrollable=MN;var hy=class extends EN.MouseListener{constructor(){super(...arguments),this.scrollbarMouseDownDelay=200}mouseDown(e,t){if((0,ic.findParentByFeature)(e,wN.isMoveable)===void 0&&!(e instanceof PN.SRoutingHandle)){let r=(0,ic.findParentByFeature)(e,cf.isViewport);if(r){if(this.lastScrollPosition={x:t.pageX,y:t.pageY},this.scrollbar=this.getScrollbar(t),this.scrollbar)return window.clearTimeout(this.scrollbarMouseDownTimeout),this.moveScrollBar(r,t,this.scrollbar,!0).map(o=>new Promise(s=>{this.scrollbarMouseDownTimeout=window.setTimeout(()=>s(o),this.scrollbarMouseDownDelay)}))}else this.lastScrollPosition=void 0,this.scrollbar=void 0}return[]}mouseMove(e,t){if(t.buttons===0)return this.mouseUp(e,t);if(this.scrollbar){window.clearTimeout(this.scrollbarMouseDownTimeout);let n=(0,ic.findParentByFeature)(e,cf.isViewport);if(n)return this.moveScrollBar(n,t,this.scrollbar)}if(this.lastScrollPosition){let n=(0,ic.findParentByFeature)(e,cf.isViewport);if(n)return this.dragCanvas(n,t,this.lastScrollPosition)}return[]}mouseEnter(e,t){return e instanceof SN.SModelRoot&&t.buttons===0&&this.mouseUp(e,t),[]}mouseUp(e,t){return this.lastScrollPosition=void 0,this.scrollbar=void 0,[]}doubleClick(e,t){if((0,ic.findParentByFeature)(e,cf.isViewport)){let r=this.getScrollbar(t);if(r){window.clearTimeout(this.scrollbarMouseDownTimeout);let o=this.findClickTarget(r,t),s;if(o&&o.id.startsWith("horizontal-projection:")?s=o.id.substring(22):o&&o.id.startsWith("vertical-projection:")&&(s=o.id.substring(20)),s)return[fy.CenterAction.create([s],{animate:!0,retainZoom:!0})]}}return[]}dragCanvas(e,t,n){let r=(t.pageX-n.x)/e.zoom,o=(t.pageY-n.y)/e.zoom,s={scroll:{x:e.scroll.x-r,y:e.scroll.y-o},zoom:e.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[fy.SetViewportAction.create(e.id,s,{animate:!1})]}moveScrollBar(e,t,n,r=!1){let o=(0,IN.getModelBounds)(e);if(!o||e.zoom<=0)return[];let s=n.getBoundingClientRect(),a;if(this.getScrollbarOrientation(n)==="horizontal"){if(s.width<=0)return[];let c=e.canvasBounds.width/(e.zoom*o.width)*s.width,u=t.clientX-s.x-c/2;u<0?u=0:u>s.width-c&&(u=s.width-c),a={x:o.x+u/s.width*o.width,y:e.scroll.y}}else{if(s.height<=0)return[];let c=e.canvasBounds.height/(e.zoom*o.height)*s.height,u=t.clientY-s.y-c/2;u<0?u=0:u>s.height-c&&(u=s.height-c),a={x:e.scroll.x,y:o.y+u/s.height*o.height}}return[fy.SetViewportAction.create(e.id,{scroll:a,zoom:e.zoom},{animate:r})]}getScrollbar(e){let t=e.target;for(;t;){if(t.classList&&t.classList.contains("sprotty-projection-bar"))return t;t=t.parentElement}}getScrollbarOrientation(e){return e.classList.contains("horizontal")?"horizontal":"vertical"}findClickTarget(e,t){let n=Array.from(e.children).filter(r=>r.id&&r.classList.contains("sprotty-projection")&&(0,RN.hitsMouseEvent)(r,t));if(n.length>0)return n[n.length-1]}};gs.ScrollMouseListener=hy});var gy=f(Vt=>{"use strict";var TN=Vt&&Vt.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},ON=Vt&&Vt.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)},AN=Vt&&Vt.__param||function(i,e){return function(t,n){e(t,n,i)}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.BringToFrontCommand=Vt.BringToFrontAction=void 0;var Cw=_(),CN=P(),xw=$(),xN=me(),qw=_e(),Dw;(function(i){i.KIND="bringToFront";function e(t){return{kind:i.KIND,elementIDs:t}}i.create=e})(Dw=Vt.BringToFrontAction||(Vt.BringToFrontAction={}));var uf=class extends xN.Command{constructor(e){super(),this.action=e,this.selected=[]}execute(e){let t=e.root;return this.action.elementIDs.forEach(n=>{let r=t.index.getById(n);r instanceof qw.SRoutableElement&&(r.source&&this.addToSelection(r.source),r.target&&this.addToSelection(r.target)),r instanceof xw.SChildElement&&this.addToSelection(r),this.includeConnectedEdges(r)}),this.redo(e)}includeConnectedEdges(e){if(e instanceof qw.SConnectableElement&&(e.incomingEdges.forEach(t=>this.addToSelection(t)),e.outgoingEdges.forEach(t=>this.addToSelection(t))),e instanceof xw.SParentElement)for(let t of e.children)this.includeConnectedEdges(t)}addToSelection(e){this.selected.push({element:e,index:e.parent.children.indexOf(e)})}undo(e){for(let t=this.selected.length-1;t>=0;t--){let n=this.selected[t],r=n.element;r.parent.move(r,n.index)}return e.root}redo(e){for(let t=0;t<this.selected.length;t++)this.bringToFront(this.selected[t]);return e.root}bringToFront(e){let t=e.element,n=t.parent.children.length;t.parent.move(t,n-1)}};uf.KIND=Dw.KIND;uf=TN([(0,Cw.injectable)(),AN(0,(0,Cw.inject)(CN.TYPES.Action)),ON("design:paramtypes",[Object])],uf);Vt.BringToFrontCommand=uf});var yy=f(ms=>{"use strict";var qN=ms&&ms.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(ms,"__esModule",{value:!0});ms.SGraphFactory=void 0;var DN=_(),Fr=Pi(),$i=Tn(),df=$(),sn=Rr(),jw=bd(),my=class extends $i.SModelFactory{constructor(){super(...arguments),this.defaultGraphFeatures=(0,$i.createFeatureSet)(sn.SGraph.DEFAULT_FEATURES),this.defaultNodeFeatures=(0,$i.createFeatureSet)(sn.SNode.DEFAULT_FEATURES),this.defaultPortFeatures=(0,$i.createFeatureSet)(sn.SPort.DEFAULT_FEATURES),this.defaultEdgeFeatures=(0,$i.createFeatureSet)(sn.SEdge.DEFAULT_FEATURES),this.defaultLabelFeatures=(0,$i.createFeatureSet)(sn.SLabel.DEFAULT_FEATURES),this.defaultCompartmentFeatures=(0,$i.createFeatureSet)(sn.SCompartment.DEFAULT_FEATURES),this.defaultButtonFeatures=(0,$i.createFeatureSet)(jw.SButton.DEFAULT_FEATURES)}createElement(e,t){let n;if(this.registry.hasKey(e.type)){let r=this.registry.get(e.type,void 0);if(!(r instanceof df.SChildElement))throw new Error(`Element with type ${e.type} was expected to be an SChildElement.`);n=r}else this.isNodeSchema(e)?(n=new sn.SNode,n.features=this.defaultNodeFeatures):this.isPortSchema(e)?(n=new sn.SPort,n.features=this.defaultPortFeatures):this.isEdgeSchema(e)?(n=new sn.SEdge,n.features=this.defaultEdgeFeatures):this.isLabelSchema(e)?(n=new sn.SLabel,n.features=this.defaultLabelFeatures):this.isCompartmentSchema(e)?(n=new sn.SCompartment,n.features=this.defaultCompartmentFeatures):this.isButtonSchema(e)?(n=new jw.SButton,n.features=this.defaultButtonFeatures):n=new df.SChildElement;return this.initializeChild(n,e,t)}createRoot(e){let t;if(this.registry.hasKey(e.type)){let n=this.registry.get(e.type,void 0);if(!(n instanceof df.SModelRoot))throw new Error(`Element with type ${e.type} was expected to be an SModelRoot.`);t=n}else this.isGraphSchema(e)?(t=new sn.SGraph,t.features=this.defaultGraphFeatures):t=new df.SModelRoot;return this.initializeRoot(t,e)}isGraphSchema(e){return(0,Fr.getBasicType)(e)==="graph"}isNodeSchema(e){return(0,Fr.getBasicType)(e)==="node"}isPortSchema(e){return(0,Fr.getBasicType)(e)==="port"}isEdgeSchema(e){return(0,Fr.getBasicType)(e)==="edge"}isLabelSchema(e){return(0,Fr.getBasicType)(e)==="label"}isCompartmentSchema(e){return(0,Fr.getBasicType)(e)==="comp"}isButtonSchema(e){return(0,Fr.getBasicType)(e)==="button"}};my=qN([(0,DN.injectable)()],my);ms.SGraphFactory=my});var Nw=f(_y=>{"use strict";Object.defineProperty(_y,"__esModule",{value:!0});var jN=_(),NN=P(),LN=yy(),BN=new jN.ContainerModule((i,e,t,n)=>{n(NN.TYPES.IModelFactory).to(LN.SGraphFactory).inSingletonScope()});_y.default=BN});var Sy=f(by=>{"use strict";Object.defineProperty(by,"__esModule",{value:!0});var FN=_(),vy=P(),Lw=ad(),Bw=Pp(),rc=dd(),Fw=_t(),Vw=Op(),Kw=Tp(),Hw=Ap(),VN=new FN.ContainerModule((i,e,t)=>{(0,Fw.configureCommand)({bind:i,isBound:t},Lw.SetBoundsCommand),(0,Fw.configureCommand)({bind:i,isBound:t},Lw.RequestBoundsCommand),i(Bw.HiddenBoundsUpdater).toSelf().inSingletonScope(),i(vy.TYPES.HiddenVNodePostprocessor).toService(Bw.HiddenBoundsUpdater),i(vy.TYPES.Layouter).to(rc.Layouter).inSingletonScope(),i(vy.TYPES.LayoutRegistry).to(rc.LayoutRegistry).inSingletonScope(),(0,rc.configureLayout)({bind:i,isBound:t},Kw.VBoxLayouter.KIND,Kw.VBoxLayouter),(0,rc.configureLayout)({bind:i,isBound:t},Vw.HBoxLayouter.KIND,Vw.HBoxLayouter),(0,rc.configureLayout)({bind:i,isBound:t},Hw.StackLayouter.KIND,Hw.StackLayouter)});by.default=VN});var wy=f(Ey=>{"use strict";Object.defineProperty(Ey,"__esModule",{value:!0});var KN=_(),HN=va(),zN=new KN.ContainerModule(i=>{i(HN.ButtonHandlerRegistry).toSelf().inSingletonScope()});Ey.default=zN});var Ry=f(Iy=>{"use strict";Object.defineProperty(Iy,"__esModule",{value:!0});var YN=_(),Py=P(),zw=Sd(),lf=kp(),UN=new YN.ContainerModule(i=>{i(lf.CommandPalette).toSelf().inSingletonScope(),i(Py.TYPES.IUIExtension).toService(lf.CommandPalette),i(lf.CommandPaletteKeyListener).toSelf().inSingletonScope(),i(Py.TYPES.KeyListener).toService(lf.CommandPaletteKeyListener),i(zw.CommandPaletteActionProviderRegistry).toSelf().inSingletonScope(),i(Py.TYPES.ICommandPaletteActionProviderRegistry).toService(zw.CommandPaletteActionProviderRegistry)});Iy.default=UN});var Ty=f(My=>{"use strict";Object.defineProperty(My,"__esModule",{value:!0});var kN=_(),GN=Md(),Yw=Zp(),oc=P(),$N=new kN.ContainerModule(i=>{i(oc.TYPES.IContextMenuServiceProvider).toProvider(e=>()=>new Promise((t,n)=>{e.container.isBound(oc.TYPES.IContextMenuService)?t(e.container.get(oc.TYPES.IContextMenuService)):n()})),i(Yw.ContextMenuMouseListener).toSelf().inSingletonScope(),i(oc.TYPES.MouseListener).toService(Yw.ContextMenuMouseListener),i(oc.TYPES.IContextMenuProviderRegistry).to(GN.ContextMenuProviderRegistry)});My.default=$N});var Ay=f(Oy=>{"use strict";Object.defineProperty(Oy,"__esModule",{value:!0});var WN=go(),XN=_(),JN=ml(),ZN=em(),QN=P(),Uw=tm(),eL=new XN.ContainerModule((i,e,t)=>{(0,WN.configureModelElement)({bind:i,isBound:t},"marker",JN.SIssueMarker,ZN.IssueMarkerView),i(Uw.DecorationPlacer).toSelf().inSingletonScope(),i(QN.TYPES.IVNodePostprocessor).toService(Uw.DecorationPlacer)});Oy.default=eL});var Gw=f(Cy=>{"use strict";Object.defineProperty(Cy,"__esModule",{value:!0});var tL=_(),nL=P(),kw=vl(),iL=new tL.ContainerModule(i=>{i(kw.IntersectionFinder).toSelf().inSingletonScope(),i(nL.TYPES.IEdgeRoutePostprocessor).toService(kw.IntersectionFinder)});Cy.default=iL});var qy=f(xy=>{"use strict";Object.defineProperty(xy,"__esModule",{value:!0});var rL=_(),oL=va(),$w=Fg(),sL=new rL.ContainerModule((i,e,t)=>{(0,oL.configureButtonHandler)({bind:i,isBound:t},$w.ExpandButtonHandler.TYPE,$w.ExpandButtonHandler)});xy.default=sL});var Ny=f(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});var aL=_(),Dy=P(),ff=zg(),cL=Ar(),uL=_t(),dL=new aL.ContainerModule((i,e,t)=>{i(ff.ExportSvgKeyListener).toSelf().inSingletonScope(),i(Dy.TYPES.KeyListener).toService(ff.ExportSvgKeyListener),i(Dy.TYPES.HiddenVNodePostprocessor).to(ff.ExportSvgPostprocessor).inSingletonScope(),(0,uL.configureCommand)({bind:i,isBound:t},ff.ExportSvgCommand),i(Dy.TYPES.SvgExporter).to(cL.SvgExporter).inSingletonScope()});jy.default=dL});var By=f(Ly=>{"use strict";Object.defineProperty(Ly,"__esModule",{value:!0});var lL=_(),fL=P(),hL=hl(),pL=new lL.ContainerModule(i=>{i(fL.TYPES.IVNodePostprocessor).to(hL.ElementFader).inSingletonScope()});Ly.default=pL});var Jw=f(Wi=>{"use strict";var Ww=Wi&&Wi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},gL=Wi&&Wi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.PopupPositionUpdater=void 0;var Xw=_(),mL=P(),hf=class{decorate(e,t){return e}postUpdate(){let e=document.getElementById(this.options.popupDiv);if(e!==null&&typeof window<"u"){let t=e.getBoundingClientRect();window.innerHeight<t.height+t.top&&(e.style.top=window.pageYOffset+window.innerHeight-t.height-5+"px"),window.innerWidth<t.left+t.width&&(e.style.left=window.pageXOffset+window.innerWidth-t.width-5+"px"),t.left<0&&(e.style.left="0px"),t.top<0&&(e.style.top="0px")}}};Ww([(0,Xw.inject)(mL.TYPES.ViewerOptions),gL("design:type",Object)],hf.prototype,"options",void 0);hf=Ww([(0,Xw.injectable)()],hf);Wi.PopupPositionUpdater=hf});var Vy=f(Fy=>{"use strict";Object.defineProperty(Fy,"__esModule",{value:!0});var yL=_(),sc=P(),ft=Wg(),_L=Jw(),Zw=_t(),ac=ks(),Qw=af(),vL=hs(),bL=Qa(),SL=new yL.ContainerModule((i,e,t)=>{i(sc.TYPES.PopupVNodePostprocessor).to(_L.PopupPositionUpdater).inSingletonScope(),i(ft.HoverMouseListener).toSelf().inSingletonScope(),i(sc.TYPES.MouseListener).toService(ft.HoverMouseListener),i(ft.PopupHoverMouseListener).toSelf().inSingletonScope(),i(sc.TYPES.PopupMouseListener).toService(ft.PopupHoverMouseListener),i(ft.HoverKeyListener).toSelf().inSingletonScope(),i(sc.TYPES.KeyListener).toService(ft.HoverKeyListener),i(sc.TYPES.HoverState).toConstantValue({mouseOverTimer:void 0,mouseOutTimer:void 0,popupOpen:!1,previousPopupElement:void 0}),i(ft.ClosePopupActionHandler).toSelf().inSingletonScope();let n={bind:i,isBound:t};(0,Zw.configureCommand)(n,ft.HoverFeedbackCommand),(0,Zw.configureCommand)(n,ft.SetPopupModelCommand),(0,ac.configureActionHandler)(n,ft.SetPopupModelCommand.KIND,ft.ClosePopupActionHandler),(0,ac.configureActionHandler)(n,Qw.FitToScreenCommand.KIND,ft.ClosePopupActionHandler),(0,ac.configureActionHandler)(n,Qw.CenterCommand.KIND,ft.ClosePopupActionHandler),(0,ac.configureActionHandler)(n,vL.SetViewportCommand.KIND,ft.ClosePopupActionHandler),(0,ac.configureActionHandler)(n,bL.MoveCommand.KIND,ft.ClosePopupActionHandler)});Fy.default=SL});var zy=f(Hy=>{"use strict";Object.defineProperty(Hy,"__esModule",{value:!0});var EL=_(),Ky=P(),ys=Qa(),wL=_t(),PL=new EL.ContainerModule((i,e,t)=>{i(ys.MoveMouseListener).toSelf().inSingletonScope(),i(Ky.TYPES.MouseListener).toService(ys.MoveMouseListener),(0,wL.configureCommand)({bind:i,isBound:t},ys.MoveCommand),i(ys.LocationPostprocessor).toSelf().inSingletonScope(),i(Ky.TYPES.IVNodePostprocessor).toService(ys.LocationPostprocessor),i(Ky.TYPES.HiddenVNodePostprocessor).toService(ys.LocationPostprocessor)});Hy.default=PL});var Uy=f(Yy=>{"use strict";Object.defineProperty(Yy,"__esModule",{value:!0});var IL=_(),RL=P(),eP=gm(),ML=new IL.ContainerModule(i=>{i(eP.OpenMouseListener).toSelf().inSingletonScope(),i(RL.TYPES.MouseListener).toService(eP.OpenMouseListener)});Yy.default=ML});var Jy=f(Xy=>{"use strict";Object.defineProperty(Xy,"__esModule",{value:!0});var TL=_(),an=P(),tP=jl(),nP=Aa(),ky=Ym(),Gy=Ol(),OL=oi(),AL=gn(),$y=ql(),Wy=jm(),CL=_t(),xL=new TL.ContainerModule((i,e,t)=>{i(AL.EdgeRouterRegistry).toSelf().inSingletonScope(),i(OL.AnchorComputerRegistry).toSelf().inSingletonScope(),i(tP.ManhattanEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService(tP.ManhattanEdgeRouter),i(an.TYPES.IAnchorComputer).to(ky.ManhattanEllipticAnchor).inSingletonScope(),i(an.TYPES.IAnchorComputer).to(ky.ManhattanRectangularAnchor).inSingletonScope(),i(an.TYPES.IAnchorComputer).to(ky.ManhattanDiamondAnchor).inSingletonScope(),i(nP.PolylineEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService(nP.PolylineEdgeRouter),i(an.TYPES.IAnchorComputer).to(Gy.EllipseAnchor),i(an.TYPES.IAnchorComputer).to(Gy.RectangleAnchor),i(an.TYPES.IAnchorComputer).to(Gy.DiamondAnchor),i($y.BezierEdgeRouter).toSelf().inSingletonScope(),i(an.TYPES.IEdgeRouter).toService($y.BezierEdgeRouter),i(an.TYPES.IAnchorComputer).to(Wy.BezierEllipseAnchor),i(an.TYPES.IAnchorComputer).to(Wy.BezierRectangleAnchor),i(an.TYPES.IAnchorComputer).to(Wy.BezierDiamondAnchor),(0,CL.configureCommand)({bind:i,isBound:t},$y.AddRemoveBezierSegmentCommand)});Xy.default=xL});var e_=f(Qy=>{"use strict";Object.defineProperty(Qy,"__esModule",{value:!0});var qL=_(),iP=P(),Vr=Xl(),Zy=_t(),DL=new qL.ContainerModule((i,e,t)=>{(0,Zy.configureCommand)({bind:i,isBound:t},Vr.SelectCommand),(0,Zy.configureCommand)({bind:i,isBound:t},Vr.SelectAllCommand),(0,Zy.configureCommand)({bind:i,isBound:t},Vr.GetSelectionCommand),i(Vr.SelectKeyboardListener).toSelf().inSingletonScope(),i(iP.TYPES.KeyListener).toService(Vr.SelectKeyboardListener),i(Vr.SelectMouseListener).toSelf().inSingletonScope(),i(iP.TYPES.MouseListener).toService(Vr.SelectMouseListener)});Qy.default=DL});var n_=f(t_=>{"use strict";Object.defineProperty(t_,"__esModule",{value:!0});var jL=_(),NL=P(),rP=ty(),LL=new jL.ContainerModule(i=>{i(rP.UndoRedoKeyListener).toSelf().inSingletonScope(),i(NL.TYPES.KeyListener).toService(rP.UndoRedoKeyListener)});t_.default=LL});var r_=f(i_=>{"use strict";Object.defineProperty(i_,"__esModule",{value:!0});var BL=_(),FL=_t(),VL=ef(),KL=new BL.ContainerModule((i,e,t)=>{(0,FL.configureCommand)({bind:i,isBound:t},VL.UpdateModelCommand)});i_.default=KL});var a_=f(s_=>{"use strict";Object.defineProperty(s_,"__esModule",{value:!0});var HL=_(),o_=P(),pf=af(),oP=hs(),sP=py(),aP=il(),gf=_t(),zL=new HL.ContainerModule((i,e,t)=>{(0,gf.configureCommand)({bind:i,isBound:t},pf.CenterCommand),(0,gf.configureCommand)({bind:i,isBound:t},pf.FitToScreenCommand),(0,gf.configureCommand)({bind:i,isBound:t},oP.SetViewportCommand),(0,gf.configureCommand)({bind:i,isBound:t},oP.GetViewportCommand),i(pf.CenterKeyboardListener).toSelf().inSingletonScope(),i(o_.TYPES.KeyListener).toService(pf.CenterKeyboardListener),i(sP.ScrollMouseListener).toSelf().inSingletonScope(),i(aP.ZoomMouseListener).toSelf().inSingletonScope(),i(o_.TYPES.MouseListener).toService(sP.ScrollMouseListener),i(o_.TYPES.MouseListener).toService(aP.ZoomMouseListener)});s_.default=zL});var u_=f(c_=>{"use strict";Object.defineProperty(c_,"__esModule",{value:!0});var YL=_(),UL=_t(),kL=gy(),GL=new YL.ContainerModule((i,e,t)=>{(0,UL.configureCommand)({bind:i,isBound:t},kL.BringToFrontCommand)});c_.default=GL});var dP=f(le=>{"use strict";var Mt=le&&le.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},vf=le&&le.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(le,"__esModule",{value:!0});le.SBezierControlHandleView=le.SBezierCreateHandleView=le.SCompartmentView=le.SLabelView=le.SRoutingHandleView=le.BezierCurveEdgeView=le.PolylineEdgeViewWithGapsOnIntersections=le.JumpingPolylineEdgeView=le.PolylineEdgeView=le.SGraphView=void 0;var Tt=_(),_s=ee(),cP=Pi(),dc=Be(),$L=ya(),cc=vl(),WL=Bo(),bf=_e(),Xi=gn(),uP=km(),ge=Wt(),XL=Or(),mf=class{render(e,t){let n=this.edgeRouterRegistry.routeAllChildren(e),r=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;return(0,ge.svg)("svg",{"class-sprotty-graph":!0},(0,ge.svg)("g",{transform:r},t.renderChildren(e,{edgeRouting:n})))}};Mt([(0,Tt.inject)(Xi.EdgeRouterRegistry),vf("design:type",Xi.EdgeRouterRegistry)],mf.prototype,"edgeRouterRegistry",void 0);mf=Mt([(0,Tt.injectable)()],mf);le.SGraphView=mf;var uc=class extends uP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,ge.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,ge.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o=t[0],s=`M ${o.x},${o.y}`;for(let a=1;a<t.length;a++){let c=t[a];s+=` L ${c.x},${c.y}`}return(0,ge.svg)("path",{d:s})}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,ge.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Mt([(0,Tt.inject)(Xi.EdgeRouterRegistry),vf("design:type",Xi.EdgeRouterRegistry)],uc.prototype,"edgeRouterRegistry",void 0);uc=Mt([(0,Tt.injectable)()],uc);le.PolylineEdgeView=uc;var yf=class extends uc{constructor(){super(...arguments),this.jumpOffsetBefore=5,this.jumpOffsetAfter=5,this.skipOffsetBefore=3,this.skipOffsetAfter=2}renderLine(e,t,n,r){let o="";for(let s=0;s<t.length;s++){let a=t[s];s===0&&(o=`M ${a.x},${a.y}`),(0,cc.isIntersectingRoutedPoint)(a)&&(o+=this.intersectionPath(e,t,a,r)),s!==0&&(o+=` L ${a.x},${a.y}`)}return(0,ge.svg)("path",{d:o})}intersectionPath(e,t,n,r){if(n.intersections.length<1)return"";let o=this.getLineSegment(e,n.intersections[0],r,t),s=this.getIntersectionsSortedBySegmentDirection(o,n),a="";for(let c of s){let u=this.getOtherLineSegment(e,c,r);if(u===void 0)continue;let d=this.getLineSegment(e,c,r,t),l=c.intersectionPoint;this.shouldDrawLineJumpOnIntersection(d,u)?a+=this.createJumpPath(l,d):this.shouldDrawLineGapOnIntersection(d,u)&&(a+=this.createGapPath(l,d))}return a}getIntersectionsSortedBySegmentDirection(e,t){switch(e.direction){case"north":case"north-east":return t.intersections.sort(cc.BY_X_THEN_DESCENDING_Y);case"south":case"south-east":case"east":return t.intersections.sort(cc.BY_X_THEN_Y);case"south-west":case"west":return t.intersections.sort(cc.BY_DESCENDING_X_THEN_Y);case"north-west":return t.intersections.sort(cc.BY_DESCENDING_X_THEN_DESCENDING_Y)}}shouldDrawLineJumpOnIntersection(e,t){return Math.abs(e.slopeOrMax)<Math.abs(t.slopeOrMax)}shouldDrawLineGapOnIntersection(e,t){return!this.shouldDrawLineJumpOnIntersection(e,t)}getLineSegment(e,t,n,r){let o=r||this.edgeRouterRegistry.route(e,n),s=t.routable1===e.id?t.segmentIndex1:t.segmentIndex2;return new XL.PointToPointLine(o[s],o[s+1])}getOtherLineSegment(e,t,n){let r=t.routable1===e.id?t.routable2:t.routable1,o=e.index.getById(r);if(o instanceof bf.SRoutableElement)return this.getLineSegment(o,t,n)}createJumpPath(e,t){let n=_s.Point.shiftTowards(e,t.p1,this.jumpOffsetBefore),r=_s.Point.shiftTowards(e,t.p2,this.jumpOffsetAfter),o=t.p1.x<t.p2.x?1:0;return` L ${n.x},${n.y} A 1,1 0,0 ${o} ${r.x},${r.y}`}createGapPath(e,t){let n,r;e.y<t.p1.y?(n=-this.skipOffsetBefore,r=this.jumpOffsetAfter+this.skipOffsetAfter):(n=this.jumpOffsetBefore+this.skipOffsetAfter,r=-this.skipOffsetBefore);let o=_s.Point.shiftTowards(e,t.p1,n),s=_s.Point.shiftTowards(e,t.p2,r);return` L ${o.x},${o.y} M ${s.x},${s.y}`}};yf=Mt([(0,Tt.injectable)()],yf);le.JumpingPolylineEdgeView=yf;var d_=class extends yf{constructor(){super(...arguments),this.skipOffsetBefore=3,this.skipOffsetAfter=3}shouldDrawLineJumpOnIntersection(e,t){return!1}shouldDrawLineGapOnIntersection(e,t){return Math.abs(e.slopeOrMax)>=Math.abs(t.slopeOrMax)}createGapPath(e,t){let n=_s.Point.shiftTowards(e,t.p1,this.skipOffsetBefore),r=_s.Point.shiftTowards(e,t.p2,this.skipOffsetAfter);return` L ${n.x},${n.y} M ${r.x},${r.y}`}};d_=Mt([(0,Tt.injectable)()],d_);le.PolylineEdgeViewWithGapsOnIntersections=d_;var _f=class extends uP.RoutableView{render(e,t,n){let r=this.edgeRouterRegistry.route(e,n);return r.length===0?this.renderDanglingEdge("Cannot compute route",e,t):this.isVisible(e,r,t)?(0,ge.svg)("g",{"class-sprotty-edge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,r,t,n),this.renderAdditionals(e,r,t),t.renderChildren(e,{route:r})):e.children.length===0?void 0:(0,ge.svg)("g",null,t.renderChildren(e,{route:r}))}renderLine(e,t,n,r){let o="";if(t.length>=4){o+=this.buildMainSegment(t);let s=t.length-4;if(s>0&&s%3===0)for(let a=4;a<t.length;a+=3)o+=this.addSpline(t,a)}return(0,ge.svg)("path",{d:o})}buildMainSegment(e){let t=e[0],n=e[1],r=e[2],o=e[3];return`M${t.x},${t.y} C${n.x},${n.y} ${r.x},${r.y} ${o.x},${o.y}`}addSpline(e,t){let n=e[t+1],r=e[t+2];return` S${n.x},${n.y} ${r.x},${r.y}`}renderAdditionals(e,t,n){return[]}renderDanglingEdge(e,t,n){return(0,ge.svg)("text",{"class-sprotty-edge-dangling":!0,title:e},"?")}};Mt([(0,Tt.inject)(Xi.EdgeRouterRegistry),vf("design:type",Xi.EdgeRouterRegistry)],_f.prototype,"edgeRouterRegistry",void 0);_f=Mt([(0,Tt.injectable)()],_f);le.BezierCurveEdgeView=_f;var vs=class{constructor(){this.minimalPointDistance=10}render(e,t,n){if(n&&n.route&&e.parent instanceof bf.SRoutableElement){let r=this.edgeRouterRegistry.get(e.parent.routerKind),o=n.route===void 0?this.edgeRouterRegistry.route(e.parent,n):n.route,s=r.getHandlePosition(e.parent,o,e);if(s!==void 0){let a=(0,ge.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,dc.setAttr)(a,"data-kind",e.kind),a}}return(0,ge.svg)("g",null)}getRadius(){return 7}};Mt([(0,Tt.inject)(Xi.EdgeRouterRegistry),vf("design:type",Xi.EdgeRouterRegistry)],vs.prototype,"edgeRouterRegistry",void 0);vs=Mt([(0,Tt.injectable)()],vs);le.SRoutingHandleView=vs;var l_=class extends $L.ShapeView{render(e,t){if(!(0,WL.isEdgeLayoutable)(e)&&!this.isVisible(e,t))return;let n=(0,ge.svg)("text",{"class-sprotty-label":!0},e.text),r=(0,cP.getSubType)(e);return r&&(0,dc.setAttr)(n,"class",r),n}};l_=Mt([(0,Tt.injectable)()],l_);le.SLabelView=l_;var f_=class{render(e,t,n){let r=`translate(${e.bounds.x}, ${e.bounds.y})`,o=(0,ge.svg)("g",{transform:r,"class-sprotty-comp":"{true}"},t.renderChildren(e)),s=(0,cP.getSubType)(e);return s&&(0,dc.setAttr)(o,"class",s),o}};f_=Mt([(0,Tt.injectable)()],f_);le.SCompartmentView=f_;var h_=class extends vs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof bf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a="translate("+s.x+", "+s.y+")",c=-5.5,u=5.5,d=e.kind==="bezier-add"?"+":"-",l=(0,ge.svg)("g",{transform:a,"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,ge.svg)("circle",{r:this.getRadius()}),(0,ge.svg)("text",{x:c,y:u,"attrs-text-align":"middle","style-font-family":"monospace","style-pointer-events":"none","style-fill":"white"},d));return(0,dc.setAttr)(l,"data-kind",e.kind),l}}}return(0,ge.svg)("g",null)}};h_=Mt([(0,Tt.injectable)()],h_);le.SBezierCreateHandleView=h_;var p_=class extends vs{render(e,t,n){if(n){let r=n.route;if(r&&e.parent instanceof bf.SRoutableElement){let s=this.edgeRouterRegistry.get(e.parent.routerKind).getHandlePosition(e.parent,r,e);if(s!==void 0){let a;for(let u=0;u<r.length;u++){let d=r[u];if(d.kind===s.kind&&d.pointIndex===s.pointIndex){e.kind==="bezier-control-before"?a=r[u+1]:a=r[u-1];break}}let c;if(a){let u=`M ${s.x}, ${s.y} L ${a.x}, ${a.y}`;c=(0,ge.svg)("g",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},(0,ge.svg)("path",{d:u,stroke:"grey","style-stroke-width":"2px"}),(0,ge.svg)("circle",{cx:s.x,cy:s.y,r:this.getRadius()}))}else c=(0,ge.svg)("circle",{"class-sprotty-routing-handle":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback,cx:s.x,cy:s.y,r:this.getRadius()});return(0,dc.setAttr)(c,"data-kind",e.kind),c}}}return(0,ge.svg)("g",null)}};p_=Mt([(0,Tt.injectable)()],p_);le.SBezierControlHandleView=p_});var m_=f(g_=>{"use strict";Object.defineProperty(g_,"__esModule",{value:!0});var JL=_(),ZL=_t(),Sf=P(),QL=Na(),eB=Yo(),tB=new JL.ContainerModule((i,e,t)=>{i(Sf.TYPES.ModelSourceProvider).toProvider(n=>()=>new Promise(r=>{r(n.container.get(Sf.TYPES.ModelSource))})),(0,ZL.configureCommand)({bind:i,isBound:t},QL.CommitModelCommand),i(Sf.TYPES.IActionHandlerInitializer).toService(Sf.TYPES.ModelSource),i(eB.ComputedBoundsApplicator).toSelf().inSingletonScope()});g_.default=tB});var lP=f(bs=>{"use strict";var Ce=bs&&bs.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bs,"__esModule",{value:!0});bs.loadDefaultModules=void 0;var nB=Ce(vp()),iB=Ce(m_()),rB=Ce(Sy()),oB=Ce(wy()),sB=Ce(Ry()),aB=Ce(Ty()),cB=Ce(Ay()),uB=Ce(kd()),y_=Bg(),dB=Ce(qy()),lB=Ce(Ny()),fB=Ce(By()),hB=Ce(Vy()),pB=Ce(zy()),gB=Ce(Uy()),mB=Ce(Jy()),yB=Ce(e_()),_B=Ce(n_()),vB=Ce(r_()),bB=Ce(a_()),SB=Ce(u_());function EB(i,e){let t=[nB.default,iB.default,rB.default,oB.default,sB.default,aB.default,cB.default,y_.edgeEditModule,uB.default,dB.default,lB.default,fB.default,hB.default,y_.labelEditModule,y_.labelEditUiModule,pB.default,gB.default,mB.default,yB.default,_B.default,vB.default,bB.default,SB.default];if(e&&e.exclude)for(let n of e.exclude){let r=t.indexOf(n);r>=0&&t.splice(r,1)}i.load(...t)}bs.loadDefaultModules=EB});var fP=f(v_=>{"use strict";Object.defineProperty(v_,"__esModule",{value:!0});var Ef=po();function wB(i){let e={},t=(s,a)=>{if(a!=="style"&&a!=="class"){let c=TB(i[a]);s?s[a]=c:s={[a]:c}}return s},n=Object.keys(i).reduce(t,null);n&&(e.attrs=n);let r=PB(i);r&&(e.style=r);let o=IB(i);return o&&(e.class=o),e}function PB(i){let e=(t,n)=>{let r=n.split(":"),o=RB(r[0].trim());if(o){let s=r[1].replace("!important","").trim();t?t[o]=s:t={[o]:s}}return t};try{return i.style.split(";").reduce(e,null)}catch{return null}}function IB(i){let e=(t,n)=>(n=n.trim(),n&&(t?t[n]=!0:t={[n]:!0}),t);try{return i.class.split(" ").reduce(e,null)}catch{return null}}function RB(i){return i=i.replace(/-(\w)/g,function(n,r){return r.toUpperCase()}),`${i.charAt(0).toLowerCase()}${i.substring(1)}`}var MB=new RegExp("&[a-z0-9#]+;","gi"),Ss=null;function TB(i){return Ss||(Ss=document.createElement("div")),i.replace(MB,e=>Ss===null?"":(Ss.innerHTML=e,Ss.textContent===null?"":Ss.textContent))}function OB(i,e){let t=i,n=null,r=[],o=s=>{let a=s.firstChild;a!==null&&(n=s),t=a};for(e(t,n),o(t);;){for(;t;)r.push(t),e(t,n),o(t);let s=r.pop();if(t=s||null,!r.length)break;if(n=r[r.length-1],t){let a=t.nextSibling;a==null&&(n=r[r.length-1]),t=a}}}var lc=null,__=new Map,wf=!1;function AB(i,e){let t;switch(e!==null&&(t=__.get(e)),i?.nodeType){case 1:{if(t===void 0)return;t.children=t.children?t.children:[];let n=t.children,r=i.attributes,o={};for(let a=0;a<r.length;a++){let c=r.item(a);c&&(o[c.name]=c.value)}let s=(0,Ef.h)(i.nodeName,wB(o));n.push(s),__.set(i,s);break}case 3:{let n=i.textContent;if(n!==null&&t!==void 0){t.children=t.children?t.children:[];let r=t.children,o=r.length>0?r[r.length-1]:null;!wf&&typeof o!="string"&&o!==null&&o.sel===void 0?o.text=o.text+n:r.push((0,Ef.vnode)(void 0,void 0,void 0,n,void 0)),wf=!1}break}case 8:{wf=!0;break}case 9:{lc=(0,Ef.vnode)(void 0,void 0,[],void 0,void 0),__.set(i,lc);break}default:break}}function CB(i){let e=i?.children;return typeof e>"u"?null:e.length===1&&typeof e[0]!="string"?e[0]:null}function xB(i){var e,t;let n=new window.DOMParser;if(n===void 0||i===void 0||i==="")return null;let r=n.parseFromString(i,"application/xml");if(((e=r?.firstChild)===null||e===void 0?void 0:e.nodeName)==="parsererror"){let o=`${(t=r?.firstChild)===null||t===void 0?void 0:t.textContent}`;return(0,Ef.h)("parsererror",[o])}return wf=!1,lc=null,OB(r,AB),lc===null?null:CB(lc)}v_.default=xB});var T_=f(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.ForeignObjectElement=xe.ShapedPreRenderedElement=xe.PreRenderedElement=xe.HtmlRoot=xe.RectangularPort=xe.CircularPort=xe.DiamondNode=xe.RectangularNode=xe.CircularNode=void 0;var fc=ee(),hP=$(),b_=ue(),qB=qi(),DB=wt(),pc=Rr(),gc=oi(),S_=class extends pc.SNode{get anchorKind(){return gc.ELLIPTIC_ANCHOR_KIND}};xe.CircularNode=S_;var E_=class extends pc.SNode{get anchorKind(){return gc.RECTANGULAR_ANCHOR_KIND}};xe.RectangularNode=E_;var w_=class extends pc.SNode{get anchorKind(){return gc.DIAMOND_ANCHOR_KIND}};xe.DiamondNode=w_;var P_=class extends pc.SPort{get anchorKind(){return gc.ELLIPTIC_ANCHOR_KIND}};xe.CircularPort=P_;var I_=class extends pc.SPort{get anchorKind(){return gc.RECTANGULAR_ANCHOR_KIND}};xe.RectangularPort=I_;var R_=class extends hP.SModelRoot{constructor(){super(...arguments),this.classes=[]}};xe.HtmlRoot=R_;var Pf=class extends hP.SChildElement{};xe.PreRenderedElement=Pf;var hc=class extends Pf{constructor(){super(...arguments),this.position=fc.Point.ORIGIN,this.size=fc.Dimension.EMPTY,this.selected=!1,this.alignment=fc.Point.ORIGIN}get bounds(){return{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}}set bounds(e){this.position={x:e.x,y:e.y},this.size={width:e.width,height:e.height}}};xe.ShapedPreRenderedElement=hc;hc.DEFAULT_FEATURES=[qB.moveFeature,b_.boundsFeature,DB.selectFeature,b_.alignFeature];var M_=class extends hc{get bounds(){return fc.Dimension.isValid(this.size)?{x:this.position.x,y:this.position.y,width:this.size.width,height:this.size.height}:(0,b_.isBoundsAware)(this.parent)?{x:this.position.x,y:this.position.y,width:this.parent.bounds.width,height:this.parent.bounds.height}:fc.Bounds.EMPTY}};xe.ForeignObjectElement=M_});var _P=f(Gn=>{"use strict";var gP=Gn&&Gn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},jB=Gn&&Gn.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Gn,"__esModule",{value:!0});Gn.ForeignObjectView=Gn.PreRenderedView=void 0;var pP=Wt(),mP=_(),yP=jB(fP()),O_=Be(),NB=ya(),LB=T_(),A_=class extends NB.ShapeView{render(e,t){if(e instanceof LB.ShapedPreRenderedElement&&!this.isVisible(e,t))return;let n=(0,yP.default)(e.code);if(n!==null)return this.correctNamespace(n),n}correctNamespace(e){(e.sel==="svg"||e.sel==="g")&&(0,O_.setNamespace)(e,"http://www.w3.org/2000/svg")}};A_=gP([(0,mP.injectable)()],A_);Gn.PreRenderedView=A_;var C_=class{render(e,t){let n=(0,yP.default)(e.code);if(n===null)return;let r=(0,pP.svg)("g",null,(0,pP.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.bounds.height,width:e.bounds.width,x:0,y:0},n),t.renderChildren(e));return(0,O_.setAttr)(r,"class",e.type),(0,O_.setNamespace)(n,e.namespace),r}};C_=gP([(0,mP.injectable)()],C_);Gn.ForeignObjectView=C_});var vP=f(Es=>{"use strict";var BB=Es&&Es.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(Es,"__esModule",{value:!0});Es.HtmlRootView=void 0;var FB=Wt(),VB=_(),KB=Be(),x_=class{render(e,t){let n=(0,FB.html)("div",null,t.renderChildren(e));for(let r of e.classes)(0,KB.setClass)(n,r,!0);return n}};x_=BB([(0,VB.injectable)()],x_);Es.HtmlRootView=x_});var j_=f((q_,D_)=>{(function(i,e){typeof define=="function"&&define.amd?define([],e):typeof q_<"u"?e():(e(),i.FileSaver={})})(q_,function(){"use strict";function i(a,c){return typeof c>"u"?c={autoBom:!1}:typeof c!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function e(a,c,u){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){s(d.response,c,u)},d.onerror=function(){console.error("could not download file")},d.send()}function t(a){var c=new XMLHttpRequest;c.open("HEAD",a,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function n(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(c)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(a,c,u){var d=r.URL||r.webkitURL,l=document.createElement("a");c=c||a.name||"download",l.download=c,l.rel="noopener",typeof a=="string"?(l.href=a,l.origin===location.origin?n(l):t(l.href)?e(a,c,u):n(l,l.target="_blank")):(l.href=d.createObjectURL(a),setTimeout(function(){d.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(a,c,u){if(c=c||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(i(a,u),c);else if(t(a))e(a,c,u);else{var d=document.createElement("a");d.href=a,d.target="_blank",setTimeout(function(){n(d)})}}:function(a,c,u,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),typeof a=="string")return e(a,c,u);var l=a.type==="application/octet-stream",S=/constructor/i.test(r.HTMLElement)||r.safari,R=/CriOS\/[\d]+/.test(navigator.userAgent);if((R||l&&S||o)&&typeof FileReader<"u"){var v=new FileReader;v.onloadend=function(){var C=v.result;C=R?C:C.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=C:location=C,d=null},v.readAsDataURL(a)}else{var m=r.URL||r.webkitURL,T=m.createObjectURL(a);d?d.location=T:location.href=T,d=null,setTimeout(function(){m.revokeObjectURL(T)},4e4)}});r.saveAs=s.saveAs=s,typeof D_<"u"&&(D_.exports=s)})});var V_=f(Ot=>{"use strict";var B_=Ot&&Ot.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},wP=Ot&&Ot.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.DiagramServer=Ot.DiagramServerProxy=Ot.ServerStatusAction=Ot.isActionMessage=void 0;var HB=j_(),F_=_(),zB=hr(),Ji=ie(),YB=En(),bP=Cu(),UB=P(),N_=ad(),kB=Ar(),SP=ef(),L_=Yo();function PP(i){return(0,YB.hasOwnProperty)(i,"action")}Ot.isActionMessage=PP;var Zi=class{constructor(){this.kind=Zi.KIND}};Ot.ServerStatusAction=Zi;Zi.KIND="serverStatus";var EP="__receivedFromServer",ws=class extends L_.ModelSource{constructor(){super(...arguments),this.currentRoot={type:"NONE",id:"ROOT"}}initialize(e){super.initialize(e),e.register(Ji.ComputedBoundsAction.KIND,this),e.register(N_.RequestBoundsCommand.KIND,this),e.register(Ji.RequestPopupModelAction.KIND,this),e.register(Ji.CollapseExpandAction.KIND,this),e.register(Ji.CollapseExpandAllAction.KIND,this),e.register(zB.OpenAction.KIND,this),e.register(Zi.KIND,this),this.clientId||(this.clientId=this.viewerOptions.baseDiv)}handle(e){this.handleLocally(e)&&this.forwardToServer(e)}forwardToServer(e){let t={clientId:this.clientId,action:e};this.logger.log(this,"sending",t),this.sendMessage(t)}messageReceived(e){let t=typeof e=="string"?JSON.parse(e):e;PP(t)&&t.action?(!t.clientId||t.clientId===this.clientId)&&(t.action[EP]=!0,this.logger.log(this,"receiving",t),this.actionDispatcher.dispatch(t.action).then(()=>{this.storeNewModel(t.action)})):this.logger.error(this,"received data is not an action message",t)}handleLocally(e){switch(this.storeNewModel(e),e.kind){case Ji.ComputedBoundsAction.KIND:return this.handleComputedBounds(e);case Ji.RequestModelAction.KIND:return this.handleRequestModel(e);case N_.RequestBoundsCommand.KIND:return!1;case kB.ExportSvgAction.KIND:return this.handleExportSvgAction(e);case Zi.KIND:return this.handleServerStateAction(e)}return!e[EP]}storeNewModel(e){if(e.kind===bP.SetModelCommand.KIND||e.kind===SP.UpdateModelCommand.KIND||e.kind===N_.RequestBoundsCommand.KIND){let t=e.newRoot;t&&(this.currentRoot=t,(e.kind===bP.SetModelCommand.KIND||e.kind===SP.UpdateModelCommand.KIND)&&(this.lastSubmittedModelType=t.type))}}handleRequestModel(e){let t=Object.assign({needsClientLayout:this.viewerOptions.needsClientLayout,needsServerLayout:this.viewerOptions.needsServerLayout},e.options),n=Object.assign(Object.assign({},e),{options:t});return this.forwardToServer(n),!1}handleComputedBounds(e){if(this.viewerOptions.needsServerLayout)return!0;{let t=this.currentRoot;return this.computedBoundsApplicator.apply(t,e),t.type===this.lastSubmittedModelType?this.actionDispatcher.dispatch(Ji.UpdateModelAction.create(t)):this.actionDispatcher.dispatch(Ji.SetModelAction.create(t)),this.lastSubmittedModelType=t.type,!1}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});return(0,HB.saveAs)(t,"diagram.svg"),!1}handleServerStateAction(e){return!1}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}};B_([(0,F_.inject)(UB.TYPES.ILogger),wP("design:type",Object)],ws.prototype,"logger",void 0);B_([(0,F_.inject)(L_.ComputedBoundsApplicator),wP("design:type",L_.ComputedBoundsApplicator)],ws.prototype,"computedBoundsApplicator",void 0);ws=B_([(0,F_.injectable)()],ws);Ot.DiagramServerProxy=ws;Ot.DiagramServer=ws});var RP=f(Qi=>{"use strict";var mc=Qi&&Qi.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},If=Qi&&Qi.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(Qi,"__esModule",{value:!0});Qi.LocalModelSource=void 0;var GB=j_(),Kr=_(),_n=ie(),IP=Pi(),H_=P(),$B=Tn(),WB=hs(),XB=Ar(),JB=Jl(),ZB=Xl(),K_=Yo(),Hr=class extends K_.ModelSource{constructor(){super(...arguments),this.currentRoot=$B.EMPTY_ROOT}get model(){return this.currentRoot}set model(e){this.setModel(e)}initialize(e){super.initialize(e),e.register(_n.ComputedBoundsAction.KIND,this),e.register(_n.RequestPopupModelAction.KIND,this)}setModel(e){return this.currentRoot=e,this.submitModel(e,!1)}commitModel(e){let t=this.currentRoot;return this.currentRoot=e,t}updateModel(e){return e===void 0?this.submitModel(this.currentRoot,!0):(this.currentRoot=e,this.submitModel(e,!0))}async getSelection(){let e=await this.actionDispatcher.request(ZB.GetSelectionAction.create()),t=[];return this.gatherSelectedElements(this.currentRoot,new Set(e.selectedElementsIDs),t),t}gatherSelectedElements(e,t,n){if(t.has(e.id)&&n.push(e),e.children)for(let r of e.children)this.gatherSelectedElements(r,t,n)}async getViewport(){let e=await this.actionDispatcher.request(WB.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}async submitModel(e,t,n){if(this.viewerOptions.needsClientLayout){let r=await this.actionDispatcher.request(_n.RequestBoundsAction.create(e)),o=this.computedBoundsApplicator.apply(this.currentRoot,r);await this.doSubmitModel(e,!0,n,o)}else await this.doSubmitModel(e,t,n)}async doSubmitModel(e,t,n,r){if(this.layoutEngine!==void 0)try{let s=this.layoutEngine.layout(e,r);s instanceof Promise?e=await s:s!==void 0&&(e=s)}catch(s){this.logger.error(this,s.toString(),s.stack)}let o=this.lastSubmittedModelType;if(this.lastSubmittedModelType=e.type,n&&n.kind===_n.RequestModelAction.KIND&&n.requestId){let s=n;await this.actionDispatcher.dispatch(_n.SetModelAction.create(e,s.requestId))}else if(t&&e.type===o){let s=Array.isArray(t)?t:e;await this.actionDispatcher.dispatch(_n.UpdateModelAction.create(s,{animate:!0,cause:n}))}else await this.actionDispatcher.dispatch(_n.SetModelAction.create(e))}applyMatches(e){let t=this.currentRoot;return(0,JB.applyMatches)(t,e),this.submitModel(t,e)}addElements(e){let t=[];for(let n of e){let r=n;r.element!==void 0&&r.parentId!==void 0?t.push({right:r.element,rightParentId:r.parentId}):r.id!==void 0&&t.push({right:r,rightParentId:this.currentRoot.id})}return this.applyMatches(t)}removeElements(e){let t=[],n=new IP.SModelIndex;n.add(this.currentRoot);for(let r of e){let o=r;if(o.elementId!==void 0&&o.parentId!==void 0){let s=n.getById(o.elementId);s!==void 0&&t.push({left:s,leftParentId:o.parentId})}else{let s=n.getById(o);s!==void 0&&t.push({left:s,leftParentId:this.currentRoot.id})}}return this.applyMatches(t)}handle(e){switch(e.kind){case _n.RequestModelAction.KIND:this.handleRequestModel(e);break;case _n.ComputedBoundsAction.KIND:this.computedBoundsApplicator.apply(this.currentRoot,e);break;case _n.RequestPopupModelAction.KIND:this.handleRequestPopupModel(e);break;case XB.ExportSvgAction.KIND:this.handleExportSvgAction(e);break}}handleRequestModel(e){this.submitModel(this.currentRoot,!1,e)}handleRequestPopupModel(e){if(this.popupModelProvider!==void 0){let t=(0,IP.findElement)(this.currentRoot,e.elementId),n=this.popupModelProvider.getPopupModel(e,t);n!==void 0&&(n.canvasBounds=e.bounds,this.actionDispatcher.dispatch(_n.SetPopupModelAction.create(n,e.requestId)))}}handleExportSvgAction(e){let t=new Blob([e.svg],{type:"text/plain;charset=utf-8"});(0,GB.saveAs)(t,"diagram.svg")}};mc([(0,Kr.inject)(H_.TYPES.ILogger),If("design:type",Object)],Hr.prototype,"logger",void 0);mc([(0,Kr.inject)(K_.ComputedBoundsApplicator),If("design:type",K_.ComputedBoundsApplicator)],Hr.prototype,"computedBoundsApplicator",void 0);mc([(0,Kr.inject)(H_.TYPES.IPopupModelProvider),(0,Kr.optional)(),If("design:type",Object)],Hr.prototype,"popupModelProvider",void 0);mc([(0,Kr.inject)(H_.TYPES.IModelLayoutEngine),(0,Kr.optional)(),If("design:type",Object)],Hr.prototype,"layoutEngine",void 0);Hr=mc([(0,Kr.injectable)()],Hr);Qi.LocalModelSource=Hr});var AP=f(vn=>{"use strict";var z_=vn&&vn.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o},MP=vn&&vn.__metadata||function(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)};Object.defineProperty(vn,"__esModule",{value:!0});vn.ForwardingLogger=vn.LoggingAction=void 0;var Y_=_(),er=Zu(),TP=P(),OP;(function(i){i.KIND="logging";function e(t){return Object.assign({kind:i.KIND},t)}i.create=e})(OP=vn.LoggingAction||(vn.LoggingAction={}));var yc=class{error(e,t,...n){this.logLevel>=er.LogLevel.error&&this.forward(e,t,er.LogLevel.error,n)}warn(e,t,...n){this.logLevel>=er.LogLevel.warn&&this.forward(e,t,er.LogLevel.warn,n)}info(e,t,...n){this.logLevel>=er.LogLevel.info&&this.forward(e,t,er.LogLevel.info,n)}log(e,t,...n){if(this.logLevel>=er.LogLevel.log)try{let r=typeof e=="object"?e.constructor.name:String(e);console.log.apply(e,[r+": "+t,...n])}catch{}}forward(e,t,n,r){let o=new Date,s=OP.create({message:t,severity:er.LogLevel[n],time:o.toLocaleTimeString(),caller:typeof e=="object"?e.constructor.name:String(e),params:r.map(a=>JSON.stringify(a))});this.modelSourceProvider().then(a=>{try{a.handle(s)}catch(c){try{console.log.apply(e,[t,s,c])}catch{}}})}};z_([(0,Y_.inject)(TP.TYPES.ModelSourceProvider),MP("design:type",Function)],yc.prototype,"modelSourceProvider",void 0);z_([(0,Y_.inject)(TP.TYPES.LogLevel),MP("design:type",Number)],yc.prototype,"logLevel",void 0);yc=z_([(0,Y_.injectable)()],yc);vn.ForwardingLogger=yc});var CP=f(tr=>{"use strict";var QB=tr&&tr.__decorate||function(i,e,t,n){var r=arguments.length,o=r<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(s=i[a])&&(o=(r<3?s(o):r>3?s(e,t,o):s(e,t))||o);return r>3&&o&&Object.defineProperty(e,t,o),o};Object.defineProperty(tr,"__esModule",{value:!0});tr.WebSocketDiagramServer=tr.WebSocketDiagramServerProxy=void 0;var eF=_(),tF=V_(),Rf=class extends tF.DiagramServerProxy{listen(e){e.addEventListener("message",t=>{this.messageReceived(t.data)}),e.addEventListener("error",t=>{this.logger.error(this,"error event received",t)}),this.webSocket=e}disconnect(){this.webSocket&&(this.webSocket.close(),this.webSocket=void 0)}sendMessage(e){if(this.webSocket)this.webSocket.send(JSON.stringify(e));else throw new Error("WebSocket is not connected")}};Rf=QB([(0,eF.injectable)()],Rf);tr.WebSocketDiagramServerProxy=Rf;tr.WebSocketDiagramServer=Rf});var xP=f(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.ColorMap=nr.toSVG=nr.rgb=void 0;function nF(i,e,t){return{red:i,green:e,blue:t}}nr.rgb=nF;function iF(i){return"rgb("+i.red+","+i.green+","+i.blue+")"}nr.toSVG=iF;var U_=class{constructor(e){this.stops=e}getColor(e){e=Math.max(0,Math.min(.99999999,e));let t=Math.floor(e*this.stops.length);return this.stops[t]}};nr.ColorMap=U_});var DP=f(qP=>{"use strict";Object.defineProperty(qP,"__esModule",{value:!0})});var Mf=f(h=>{"use strict";var rF=h&&h.__createBinding||(Object.create?function(i,e,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,n,r)}:function(i,e,t,n){n===void 0&&(n=t),i[n]=e[t]}),g=h&&h.__exportStar||function(i,e){for(var t in i)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&rF(e,i,t)},we=h&&h.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(h,"__esModule",{value:!0});h.modelSourceModule=h.zorderModule=h.viewportModule=h.updateModule=h.undoRedoModule=h.selectModule=h.routingModule=h.openModule=h.moveModule=h.hoverModule=h.fadeModule=h.exportModule=h.expandModule=h.edgeLayoutModule=h.edgeIntersectionModule=h.decorationModule=h.contextMenuModule=h.commandPaletteModule=h.buttonModule=h.boundsModule=h.graphModule=h.defaultModule=void 0;g(Sc(),h);g(gu(),h);g(ks(),h);g(fh(),h);g(Qr(),h);g(ur(),h);g(hh(),h);g(me(),h);g(_t(),h);g(wb(),h);g(wh(),h);g(Ws(),h);g(Cu(),h);g(Vb(),h);g(Tn(),h);g(ze(),h);g($(),h);g(Bh(),h);g(xu(),h);g(ea(),h);g(Bu(),h);g(dn(),h);g(At(),h);g(tp(),h);g(go(),h);g(ap(),h);g(cp(),h);g(up(),h);g(lp(),h);g(Be(),h);g(P(),h);var oF=we(vp());h.defaultModule=oF.default;g(ad(),h);g(Pp(),h);g(dd(),h);g(ue(),h);g(Tp(),h);g(Op(),h);g(Ap(),h);g(ya(),h);g(va(),h);g(bd(),h);g(Sd(),h);g(kp(),h);g(iE(),h);g(Md(),h);g(Zp(),h);g(kd(),h);g(sg(),h);g(Bo(),h);g(jE(),h);g(ug(),h);g(Bg(),h);g(No(),h);g(Zd(),h);g(xg(),h);g(Va(),h);g(Fo(),h);g(rl(),h);g(Fg(),h);g(sl(),h);g(d0(),h);g(zg(),h);g(xd(),h);g(Ar(),h);g(hl(),h);g(qo(),h);g(Wg(),h);g(wr(),h);g(ml(),h);g(em(),h);g(tm(),h);g(vl(),h);g(sm(),h);g(qi(),h);g(Qa(),h);g(D0(),h);g(jp(),h);g(gm(),h);g(hm(),h);g(Ml(),h);g(H0(),h);g(oi(),h);g(Ta(),h);g(jm(),h);g(ql(),h);g(Ym(),h);g(jl(),h);g(_e(),h);g(Ol(),h);g(Aa(),h);g(gn(),h);g(km(),h);g(wt(),h);g(Xl(),h);g(ty(),h);g(Jl(),h);g(ef(),h);g(af(),h);g(Dn(),h);g(py(),h);g(jd(),h);g(hs(),h);g(il(),h);g(gy(),h);var sF=we(Nw());h.graphModule=sF.default;var aF=we(Sy());h.boundsModule=aF.default;var cF=we(wy());h.buttonModule=cF.default;var uF=we(Ry());h.commandPaletteModule=uF.default;var dF=we(Ty());h.contextMenuModule=dF.default;var lF=we(Ay());h.decorationModule=lF.default;var fF=we(Gw());h.edgeIntersectionModule=fF.default;var hF=we(kd());h.edgeLayoutModule=hF.default;var pF=we(qy());h.expandModule=pF.default;var gF=we(Ny());h.exportModule=gF.default;var mF=we(By());h.fadeModule=mF.default;var yF=we(Vy());h.hoverModule=yF.default;var _F=we(zy());h.moveModule=_F.default;var vF=we(Uy());h.openModule=vF.default;var bF=we(Jy());h.routingModule=bF.default;var SF=we(e_());h.selectModule=SF.default;var EF=we(n_());h.undoRedoModule=EF.default;var wF=we(r_());h.updateModule=wF.default;var PF=we(a_());h.viewportModule=PF.default;var IF=we(u_());h.zorderModule=IF.default;g(yy(),h);g(Rr(),h);g(dP(),h);g(lP(),h);g(_P(),h);g(vP(),h);g(Wt(),h);g(T_(),h);g(_g(),h);g(Na(),h);g(V_(),h);g(RP(),h);g(AP(),h);g(Yo(),h);g(CP(),h);var RF=we(m_());h.modelSourceModule=RF.default;g(On(),h);g(Vp(),h);g(xP(),h);g(Or(),h);g(cr(),h);g(DP(),h);g(Zu(),h);g(Mn(),h)});var J_;(function(i){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=r(i);typeof t.Reflect>"u"?t.Reflect=i:n=r(t.Reflect,n),e(n);function r(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",r=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,u={create:s?function(){return Af(Object.create(null))}:a?function(){return Af({__proto__:null})}:function(){return Af({})},has:c?function(p,y){return t.call(p,y)}:function(p,y){return y in p},get:c?function(p,y){return t.call(p,y)?p[y]:void 0}:function(p,y){return p[y]}},d=Object.getPrototypeOf(Function),l=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",S=!l&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:YP(),R=!l&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:UP(),v=!l&&typeof WeakMap=="function"?WeakMap:kP(),m=new v;function T(p,y,w,I){if(j(w)){if(!k_(p))throw new TypeError;if(!G_(y))throw new TypeError;return Ie(p,y)}else{if(!k_(p))throw new TypeError;if(!k(y))throw new TypeError;if(!k(I)&&!j(I)&&!ce(I))throw new TypeError;return ce(I)&&(I=void 0),w=ot(w),he(p,y,w,I)}}e("decorate",T);function C(p,y){function w(I,x){if(!k(I))throw new TypeError;if(!j(x)&&!FP(x))throw new TypeError;Ns(p,y,I,x)}return w}e("metadata",C);function H(p,y,w,I){if(!k(w))throw new TypeError;return j(I)||(I=ot(I)),Ns(p,y,w,I)}e("defineMetadata",H);function G(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),$e(p,y,w)}e("hasMetadata",G);function D(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),Sn(p,y,w)}e("hasOwnMetadata",D);function F(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),li(p,y,w)}e("getMetadata",F);function z(p,y,w){if(!k(y))throw new TypeError;return j(w)||(w=ot(w)),js(p,y,w)}e("getOwnMetadata",z);function W(p,y){if(!k(p))throw new TypeError;return j(y)||(y=ot(y)),Ls(p,y)}e("getMetadataKeys",W);function Y(p,y){if(!k(p))throw new TypeError;return j(y)||(y=ot(y)),_c(p,y)}e("getOwnMetadataKeys",Y);function ae(p,y,w){if(!k(y))throw new TypeError;j(w)||(w=ot(w));var I=be(y,w,!1);if(j(I)||!I.delete(p))return!1;if(I.size>0)return!0;var x=m.get(y);return x.delete(w),x.size>0||m.delete(y),!0}e("deleteMetadata",ae);function Ie(p,y){for(var w=p.length-1;w>=0;--w){var I=p[w],x=I(y);if(!j(x)&&!ce(x)){if(!G_(x))throw new TypeError;y=x}}return y}function he(p,y,w,I){for(var x=p.length-1;x>=0;--x){var He=p[x],V=He(y,w,I);if(!j(V)&&!ce(V)){if(!k(V))throw new TypeError;I=V}}return I}function be(p,y,w){var I=m.get(p);if(j(I)){if(!w)return;I=new S,m.set(p,I)}var x=I.get(y);if(j(x)){if(!w)return;x=new S,I.set(y,x)}return x}function $e(p,y,w){var I=Sn(p,y,w);if(I)return!0;var x=Of(y);return ce(x)?!1:$e(p,x,w)}function Sn(p,y,w){var I=be(y,w,!1);return j(I)?!1:cn(I.has(p))}function li(p,y,w){var I=Sn(p,y,w);if(I)return js(p,y,w);var x=Of(y);if(!ce(x))return li(p,x,w)}function js(p,y,w){var I=be(y,w,!1);if(!j(I))return I.get(p)}function Ns(p,y,w,I){var x=be(w,I,!0);x.set(p,y)}function Ls(p,y){var w=_c(p,y),I=Of(p);if(I===null)return w;var x=Ls(I,y);if(x.length<=0)return w;if(w.length<=0)return x;for(var He=new R,V=[],U=0,N=w;U<N.length;U++){var X=N[U],J=He.has(X);J||(He.add(X),V.push(X))}for(var hi=0,W_=x;hi<W_.length;hi++){var X=W_[hi],J=He.has(X);J||(He.add(X),V.push(X))}return V}function _c(p,y){var w=[],I=be(p,y,!1);if(j(I))return w;for(var x=I.keys(),He=VP(x),V=0;;){var U=HP(He);if(!U)return w.length=V,w;var N=KP(U);try{w[V]=N}catch(X){try{zP(He)}finally{throw X}}V++}}function L(p){if(p===null)return 1;switch(typeof p){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return p===null?1:6;default:return 6}}function j(p){return p===void 0}function ce(p){return p===null}function Ne(p){return typeof p=="symbol"}function k(p){return typeof p=="object"?p!==null:typeof p=="function"}function Ke(p,y){switch(L(p)){case 0:return p;case 1:return p;case 2:return p;case 3:return p;case 4:return p;case 5:return p}var w=y===3?"string":y===5?"number":"default",I=$_(p,r);if(I!==void 0){var x=I.call(p,w);if(k(x))throw new TypeError;return x}return fi(p,w==="default"?"number":w)}function fi(p,y){if(y==="string"){var w=p.toString;if(zr(w)){var I=w.call(p);if(!k(I))return I}var x=p.valueOf;if(zr(x)){var I=x.call(p);if(!k(I))return I}}else{var x=p.valueOf;if(zr(x)){var I=x.call(p);if(!k(I))return I}var He=p.toString;if(zr(He)){var I=He.call(p);if(!k(I))return I}}throw new TypeError}function cn(p){return!!p}function We(p){return""+p}function ot(p){var y=Ke(p,3);return Ne(y)?y:We(y)}function k_(p){return Array.isArray?Array.isArray(p):p instanceof Object?p instanceof Array:Object.prototype.toString.call(p)==="[object Array]"}function zr(p){return typeof p=="function"}function G_(p){return typeof p=="function"}function FP(p){switch(L(p)){case 3:return!0;case 4:return!0;default:return!1}}function $_(p,y){var w=p[y];if(w!=null){if(!zr(w))throw new TypeError;return w}}function VP(p){var y=$_(p,o);if(!zr(y))throw new TypeError;var w=y.call(p);if(!k(w))throw new TypeError;return w}function KP(p){return p.value}function HP(p){var y=p.next();return y.done?!1:y}function zP(p){var y=p.return;y&&y.call(p)}function Of(p){var y=Object.getPrototypeOf(p);if(typeof p!="function"||p===d||y!==d)return y;var w=p.prototype,I=w&&Object.getPrototypeOf(w);if(I==null||I===Object.prototype)return y;var x=I.constructor;return typeof x!="function"||x===p?y:x}function YP(){var p={},y=[],w=function(){function V(U,N,X){this._index=0,this._keys=U,this._values=N,this._selector=X}return V.prototype["@@iterator"]=function(){return this},V.prototype[o]=function(){return this},V.prototype.next=function(){var U=this._index;if(U>=0&&U<this._keys.length){var N=this._selector(this._keys[U],this._values[U]);return U+1>=this._keys.length?(this._index=-1,this._keys=y,this._values=y):this._index++,{value:N,done:!1}}return{value:void 0,done:!0}},V.prototype.throw=function(U){throw this._index>=0&&(this._index=-1,this._keys=y,this._values=y),U},V.prototype.return=function(U){return this._index>=0&&(this._index=-1,this._keys=y,this._values=y),{value:U,done:!0}},V}();return function(){function V(){this._keys=[],this._values=[],this._cacheKey=p,this._cacheIndex=-2}return Object.defineProperty(V.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),V.prototype.has=function(U){return this._find(U,!1)>=0},V.prototype.get=function(U){var N=this._find(U,!1);return N>=0?this._values[N]:void 0},V.prototype.set=function(U,N){var X=this._find(U,!0);return this._values[X]=N,this},V.prototype.delete=function(U){var N=this._find(U,!1);if(N>=0){for(var X=this._keys.length,J=N+1;J<X;J++)this._keys[J-1]=this._keys[J],this._values[J-1]=this._values[J];return this._keys.length--,this._values.length--,U===this._cacheKey&&(this._cacheKey=p,this._cacheIndex=-2),!0}return!1},V.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=p,this._cacheIndex=-2},V.prototype.keys=function(){return new w(this._keys,this._values,I)},V.prototype.values=function(){return new w(this._keys,this._values,x)},V.prototype.entries=function(){return new w(this._keys,this._values,He)},V.prototype["@@iterator"]=function(){return this.entries()},V.prototype[o]=function(){return this.entries()},V.prototype._find=function(U,N){return this._cacheKey!==U&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=U)),this._cacheIndex<0&&N&&(this._cacheIndex=this._keys.length,this._keys.push(U),this._values.push(void 0)),this._cacheIndex},V}();function I(V,U){return V}function x(V,U){return U}function He(V,U){return[V,U]}}function UP(){return function(){function p(){this._map=new S}return Object.defineProperty(p.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),p.prototype.has=function(y){return this._map.has(y)},p.prototype.add=function(y){return this._map.set(y,y),this},p.prototype.delete=function(y){return this._map.delete(y)},p.prototype.clear=function(){this._map.clear()},p.prototype.keys=function(){return this._map.keys()},p.prototype.values=function(){return this._map.values()},p.prototype.entries=function(){return this._map.entries()},p.prototype["@@iterator"]=function(){return this.keys()},p.prototype[o]=function(){return this.keys()},p}()}function kP(){var p=16,y=u.create(),w=I();return function(){function N(){this._key=I()}return N.prototype.has=function(X){var J=x(X,!1);return J!==void 0?u.has(J,this._key):!1},N.prototype.get=function(X){var J=x(X,!1);return J!==void 0?u.get(J,this._key):void 0},N.prototype.set=function(X,J){var hi=x(X,!0);return hi[this._key]=J,this},N.prototype.delete=function(X){var J=x(X,!1);return J!==void 0?delete J[this._key]:!1},N.prototype.clear=function(){this._key=I()},N}();function I(){var N;do N="@@WeakMap@@"+U();while(u.has(y,N));return y[N]=!0,N}function x(N,X){if(!t.call(N,w)){if(!X)return;Object.defineProperty(N,w,{value:u.create()})}return N[w]}function He(N,X){for(var J=0;J<X;++J)N[J]=Math.random()*255|0;return N}function V(N){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(N)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(N)):He(new Uint8Array(N),N):He(new Array(N),N)}function U(){var N=V(p);N[6]=N[6]&79|64,N[8]=N[8]&191|128;for(var X="",J=0;J<p;++J){var hi=N[J];(J===4||J===6||J===8)&&(X+="-"),hi<16&&(X+="0"),X+=hi.toString(16).toLowerCase()}return X}}function Af(p){return p.__=void 0,delete p.__,p}})})(J_||(J_={}));var LP=Yr(Mf());var Tf=Yr(_()),O=Yr(Mf());var K=Yr(Wt()),bn=Yr(_()),ht=Yr(Mf());var Ps=class extends ht.ShapeView{render(e,t,n){return(0,K.svg)("polygon",{points:"-6,-4 0,0 -6,4",style:{fill:"black"}})}};Ps=un([(0,bn.injectable)()],Ps);var Is=class extends ht.RectangularNodeView{render(e,t,n){return(0,K.svg)("g",null,(0,K.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width-(e.arrow!==0?10:0),height:e.size.height}),(0,K.svg)("rect",{"class-input-back":!0,width:"10",height:e.size.height}),e.arrow!==0&&(0,K.svg)("polygon",{"class-input-arrow-full":e.arrow===1,"class-input-arrow-stroke":e.arrow===2,points:`${e.size.width-10},0 ${e.size.width},${e.size.height/2} ${e.size.width-10},${e.size.height}`}),(0,K.svg)("g",{transform:`translate(${e.size.width/2+(e.arrow!==0?0:5)},${e.size.height/2})`},t.renderChildren(e,n)),(0,K.svg)("text",{x:e.size.width/2,y:e.size.height+15,"class-sprotty-text":!0},e.text))}};Is=un([(0,bn.injectable)()],Is);var Rs=class extends ht.RectangularNodeView{render(e,t,n){return(0,K.svg)("g",null,(0,K.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),(0,K.svg)("image",{href:`images/${e.image}`,width:e.size.width-10,height:e.size.height-10,x:"5",y:"5"}),(0,K.svg)("rect",{width:"10",height:e.size.height,x:"0",y:"0","class-input-back":!0}),(0,K.svg)("g",{transform:`translate(${e.size.width/2},0)`},(0,K.svg)("polygon",{points:"0,-4 4,0 2,2 -2,-2",style:{stroke:"lightgrey",fill:"lightblue"}}),(0,K.svg)("polygon",{points:"-2,-2 2,2 0,4 -4,0",style:{stroke:"lightgrey",fill:"white"}})),(0,K.svg)("text",{x:e.size.width/2,y:e.size.height+20,"class-sprotty-text":!0},e.text))}};Rs=un([(0,bn.injectable)()],Rs);var Ms=class extends ht.RectangularNodeView{render(e,t,n){return(0,K.svg)("g",null,(0,K.svg)("rect",{width:e.size.width,height:e.size.height,"class-sprotty-node":!0}),(0,K.svg)("rect",{x:"4",y:"4",width:e.size.width-8,height:e.size.height-8,"class-sprotty-node":!0}),(0,K.svg)("text",{x:e.size.width/2,y:"30","class-sprotty-text":!0},"EngSpdControl"))}};Ms=un([(0,bn.injectable)()],Ms);var Ts=class extends ht.RectangularNodeView{render(e,t,n){return(0,K.svg)("g",null,(0,K.svg)("rect",{"class-sprotty-node":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,width:e.size.width,height:e.size.height}),e.operand==="+"&&(0,K.svg)("text",{x:2,y:e.size.height+1,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="\xF7"&&(0,K.svg)("text",{x:3,y:e.size.height,w:!0,"class-operand-symbol":!0,style:{fontSize:"45"}},e.operand),e.operand==="-"&&(0,K.svg)("text",{x:5,y:30,w:!0,"class-operand-symbol":!0,style:{fontSize:"54"}},e.operand),e.operand==="x"&&(0,K.svg)("text",{x:4,y:e.size.height-5,w:!0,"class-operand-symbol":!0,style:{fontSize:"40"}},e.operand))}};Ts=un([(0,bn.injectable)()],Ts);var Os=class extends ht.RectangularNodeView{render(e,t,n){return(0,K.svg)("g",null,(0,K.svg)("rect",{width:e.size.width,height:e.size.height,"class-sprotty-node":!0}),(0,K.svg)("image",{href:"images/Relais.png",x:"1",width:e.size.width-2,height:e.size.height-2}))}};Os=un([(0,bn.injectable)()],Os);var As=class extends ht.PolylineEdgeView{renderAdditionals(e,t,n){let r=[];for(let o of t)if((0,ht.isIntersectingRoutedPoint)(o)){for(let s of o.intersections)if(s.routable1.split("->")[0]===s.routable2.split("->")[0]){r.push((0,K.svg)("g",{transform:`translate(${s.intersectionPoint.x},${s.intersectionPoint.y})`},(0,K.svg)("polygon",{points:"0,4 4,0 0,-4 -4,0",style:{fill:"black"}})));break}}return r}};As=un([(0,bn.injectable)()],As);var Cs=class extends ht.ShapeView{render(e,t,n){let r=e.parent.size;return(0,K.svg)("g",null,(0,K.svg)("polygon",{points:"0,-4 4,0 2,2 -2,-2",style:{stroke:"lightgrey",fill:"lightblue"}}),(0,K.svg)("polygon",{points:"-2,-2 2,2 0,4 -4,0",style:{stroke:"lightgrey",fill:"white"}}))}};Cs=un([(0,bn.injectable)()],Cs);var xs=class extends ht.ShapeView{render(e,t,n){let r=e.parent.size;return(0,K.svg)("g",null,(0,K.svg)("polygon",{points:"-4,-4 4,-4 4,4",style:{stroke:"lightgrey",fill:"none"}}),(0,K.svg)("polygon",{points:"-4,-4 -4,4 4,4",style:{stroke:"lightgrey",fill:"orange"}}))}};xs=un([(0,bn.injectable)()],xs);var qs=class extends ht.ShapeView{render(e,t,n){let r=e.parent.size;return(0,K.svg)("g",null,(0,K.svg)("polygon",{points:"-4,-4 4,-4 4,4",style:{stroke:"lightgrey",fill:"orange"}}),(0,K.svg)("polygon",{points:"-4,-4 -4,4 4,4",style:{stroke:"lightgrey",fill:"none"}}))}};qs=un([(0,bn.injectable)()],qs);var jP=i=>{let e=new Tf.ContainerModule((n,r,o,s)=>{n(O.TYPES.ModelSource).to(O.LocalModelSource).inSingletonScope(),s(O.TYPES.ILogger).to(O.ConsoleLogger).inSingletonScope(),s(O.TYPES.LogLevel).toConstantValue(O.LogLevel.log);let a={bind:n,unbind:r,isBound:o,rebind:s};(0,O.configureModelElement)(a,"graph",O.SGraph,O.SGraphView),(0,O.configureModelElement)(a,"node:input",O.RectangularNode,Is),(0,O.configureModelElement)(a,"node:component",O.RectangularNode,Rs),(0,O.configureModelElement)(a,"node:operand",O.RectangularNode,Ts),(0,O.configureModelElement)(a,"node:controller",O.RectangularNode,Ms),(0,O.configureModelElement)(a,"node:relais",O.RectangularNode,Os),(0,O.configureModelElement)(a,"edge:straight",O.SEdge,As),(0,O.configureModelElement)(a,"label:arrow",O.SLabel,Ps),(0,O.configureModelElement)(a,"label:text",O.SLabel,O.SLabelView),(0,O.configureModelElement)(a,"routing-point",O.SRoutingHandle,O.SRoutingHandleView),(0,O.configureModelElement)(a,"volatile-routing-point",O.SRoutingHandle,O.SRoutingHandleView),(0,O.configureModelElement)(a,"label:icon1",O.SChildElement,Cs),(0,O.configureModelElement)(a,"label:icon2",O.SChildElement,xs),(0,O.configureModelElement)(a,"label:icon3",O.SChildElement,qs),(0,O.configureViewerOptions)(a,{needsClientLayout:!1,baseDiv:i})}),t=new Tf.Container;return(0,O.loadDefaultModules)(t),t.load(e),t.load(O.edgeIntersectionModule),t};var Kt={width:40,height:15},Ds={width:30,height:30},BY={type:"edge:straight",routerKind:"manhattan",children:[ne()]},OF=0;function ne(){return{id:"arrow"+OF++,type:"label:arrow",text:"",edgePlacement:{position:1,side:"on",rotate:!0}}}var NP={type:"graph",id:"graph",children:[{id:"Epm_rpmEngSpd",type:"node:input",text:"Epm_rpmEngSpd",arrow:1,position:{x:40,y:150},size:Kt,children:[{id:"tEpm_rpmEngSpdIcon",type:"label:icon2"}]},{id:"Egc_facEgas",type:"node:input",text:"Egc_facEgas",arrow:1,position:{x:40,y:205},size:Kt,children:[{id:"Egc_fac_EgasIcon",type:"label:icon2"}]},{id:"Amf_facRelAir",type:"node:input",text:"Amf_facRelAir",arrow:1,position:{x:40,y:405},size:Kt,children:[{id:"Amf_facRelAirIcon",type:"label:icon2"}]},{id:"Ctc_atCool",type:"node:input",text:"Ctc_atCool",arrow:1,position:{x:40,y:495},size:Kt,children:[{id:"Ctc_atCoolIcon",type:"label:icon2"}]},{id:"Isc_fac_IdleSpdStab",type:"node:input",text:"Isc_fac_IdleSpdStab",arrow:1,position:{x:40,y:620},size:Kt,children:[{id:"Isc_fac_IdleSpdStabIcon",type:"label:icon2"}]},{id:"Tqs_facEgasFilt",type:"node:input",text:"Tqs_facEgasFilt",arrow:2,position:{x:530,y:195},size:Kt,children:[{id:"Tqs_facEgasFiltIcon",type:"label:icon3"}]},{id:"Tqs_tqMax",type:"node:input",text:"Tqs_tqMax",arrow:2,position:{x:530,y:295},size:Kt,children:[{id:"Tqs_tqMaxIcon",type:"label:icon3"}]},{id:"Tqs_tqDrag",type:"node:input",text:"Tqs_tqDrag",arrow:2,position:{x:530,y:395},size:Kt,children:[{id:"Tqs_tqDragIcon",type:"label:icon3"}]},{id:"Tqs_tqMin",type:"node:input",text:"Tqs_tqMin",arrow:1,position:{x:900,y:395},size:Kt,children:[{id:"Tqs_tqMinIcon",type:"label:icon3"}]},{id:"Tqs_flgTorqueRegOverride",type:"node:input",text:"Tqs_flgTorqueRegOverride",arrow:0,position:{x:950,y:20},size:Kt,children:[{id:"Tqs_flgTorqueRegOverrideIcon",type:"label:icon1"}]},{id:"Tqs_tqReqCalc",type:"node:input",text:"Tqs_tqReqCalc",arrow:2,position:{x:950,y:107.5},size:Kt,children:[{id:"Tqs_tqReqCalcIcon",type:"label:icon3"}]},{id:"Tqs_tqReqMan",type:"node:input",text:"Tqs_tqReqMan",arrow:0,position:{x:950,y:150},size:Kt,children:[{id:"Tqs_tqReqManIcon",type:"label:icon1"}]},{id:"Tqs_tqReq",type:"node:input",text:"Tqs_tqReq",arrow:1,position:{x:1250,y:125},size:Kt,children:[{id:"Tqs_tqReqIcon",type:"label:icon3"}]},{id:"AddOpDrag",type:"node:operand",operand:"+",position:{x:450,y:387.5},size:Ds},{id:"MultOpDrag",type:"node:operand",operand:"x",position:{x:620,y:387.5},size:Ds},{id:"SubOp",type:"node:operand",operand:"-",position:{x:670,y:287.5},size:Ds},{id:"MultOpEgas",type:"node:operand",operand:"x",position:{x:720,y:187.5},size:Ds},{id:"AddOpEgas",type:"node:operand",operand:"+",position:{x:800,y:187.5},size:Ds},{id:"AddOpCalcReq",type:"node:operand",operand:"+",position:{x:850,y:100},size:Ds},{id:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"node:component",text:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",image:"MAP_Icon.png",position:{x:300,y:170},size:{width:60,height:65}},{id:"Tqs_rpmEngSpd2tqMax_CUR",type:"node:component",text:"Tqs_rpmEngSpd2tqMax_CUR",image:"CUR_Icon.png",position:{x:300,y:270},size:{width:60,height:65}},{id:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"node:component",text:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",image:"MAP_Icon.png",position:{x:300,y:370},size:{width:60,height:65}},{id:"Tqs_atCool2tqDrag_CUR",type:"node:component",text:"Tqs_atCool2tqDrag_CUR",image:"CUR_Icon.png",position:{x:300,y:470},size:{width:60,height:65}},{id:"subController",type:"node:controller",size:{width:180,height:120},position:{x:250,y:20}},{id:"Relais",type:"node:relais",position:{x:1150,y:107.5},size:{width:30,height:50}},{id:"/3/Tqs_calc",type:"label:text",text:"/3/Tqs_calc",position:{x:550,y:180}},{id:"/4/Tqs_calc",type:"label:text",text:"/4/Tqs_calc",position:{x:550,y:280}},{id:"/5/Tqs_calc",type:"label:text",text:"/5/Tqs_calc",position:{x:550,y:380}},{id:"/7/Tqs_calc",type:"label:text",text:"/7/Tqs_calc",position:{x:920,y:380}},{id:"/8/Tqs_calc",type:"label:text",text:"/8/Tqs_calc",position:{x:970,y:90}},{id:"/9/Tqs_calc",type:"label:text",text:"/9/Tqs_calc",position:{x:1270,y:110}},{id:"Epm_rpmEngSpd->subController",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"subController",routerKind:"manhattan",routingPoints:[{x:165.01,y:157},{x:165,y:80}],children:[ne(),{id:"controllerInputLabel1",text:"Epm_rpmEngSpd",type:"label:text",cssClasses:["inputOutputLabel"],edgePlacement:{position:.8,side:"top",rotate:!1}}]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",routerKind:"manhattan",routingPoints:[{x:165,y:157},{x:165,y:190}],children:[ne()]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpd2tqMax_CUR",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpd2tqMax_CUR",routerKind:"manhattan",routingPoints:[{x:164.5,y:157},{x:164.5,y:302.5}],children:[ne()]},{id:"Epm_rpmEngSpd->Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"edge:straight",sourceId:"Epm_rpmEngSpd",targetId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",routerKind:"manhattan",routingPoints:[{x:165,y:157},{x:165,y:390}],children:[ne()]},{id:"Egc_facEgas->subController",type:"edge:straight",sourceId:"Egc_facEgas",targetId:"subController",routerKind:"manhattan",routingPoints:[{x:180,y:212.5},{x:180,y:95}],children:[ne(),{id:"controllerInputLabel2",text:"Epm_facEgas",type:"label:text",cssClasses:["inputOutputLabel"],edgePlacement:{position:.85,side:"bottom",rotate:!1}}]},{id:"Egc_facEgas->Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",type:"edge:straight",sourceId:"Egc_facEgas",targetId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",routerKind:"manhattan",routingPoints:[{x:200,y:212.5}],children:[ne()]},{id:"Amf_facRelAir->Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",type:"edge:straight",sourceId:"Amf_facRelAir",targetId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",routerKind:"manhattan",routingPoints:[{x:290,y:412.5}],children:[ne()]},{id:"Ctc_atCool->Tqs_atCool2tqDrag_CUR",type:"edge:straight",sourceId:"Ctc_atCool",targetId:"Tqs_atCool2tqDrag_CUR",routerKind:"manhattan",children:[ne()]},{id:"Isc_fac_IdleSpdStab->MultOpDrag",type:"edge:straight",sourceId:"Isc_fac_IdleSpdStab",targetId:"MultOpDrag",routerKind:"manhattan",routingPoints:[{x:635,y:627.5}],children:[ne()]},{id:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP->AddOpDrag",type:"edge:straight",sourceId:"Tqs_rpmEngSpdfacRelAir2tqDrag_MAP",targetId:"AddOpDrag",routerKind:"manhattan",children:[ne()]},{id:"AddOpDrag->AddOpDrag",type:"edge:straight",sourceId:"AddOpDrag",targetId:"Tqs_tqDrag",routerKind:"manhattan",children:[ne()]},{id:"Tqs_tqDrag->MultOpDrag",type:"edge:straight",sourceId:"Tqs_tqDrag",targetId:"MultOpDrag",routerKind:"manhattan",children:[ne()]},{id:"Tqs_atCool2tqDrag_CUR->AddOpDrag",type:"edge:straight",sourceId:"Tqs_atCool2tqDrag_CUR",targetId:"AddOpDrag",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->Tqs_tqMin",type:"edge:straight",sourceId:"MultOpDrag",targetId:"Tqs_tqMin",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->SubOp",type:"edge:straight",sourceId:"MultOpDrag",targetId:"SubOp",routerKind:"manhattan",children:[ne()]},{id:"MultOpDrag->AddOpEgas",type:"edge:straight",sourceId:"MultOpDrag",targetId:"AddOpEgas",routerKind:"manhattan",routingPoints:[{x:815,y:402.5}],children:[ne()]},{id:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP->Tqs_facEgasFilt",type:"edge:straight",sourceId:"Tqs_rpmEngSpdfacEgas2facEgasFilt_MAP",targetId:"Tqs_facEgasFilt",routerKind:"manhattan",children:[ne()]},{id:"Tqs_facEgasFilt->MultOpEgas",type:"edge:straight",sourceId:"Tqs_facEgasFilt",targetId:"MultOpEgas",routerKind:"manhattan",children:[ne()]},{id:"Tqs_rpmEngSpd2tqMax_CUR->Tqs_tqMax",type:"edge:straight",sourceId:"Tqs_rpmEngSpd2tqMax_CUR",targetId:"Tqs_tqMax",routerKind:"manhattan",children:[ne()]},{id:"Tqs_tqMax->SubOp",type:"edge:straight",sourceId:"Tqs_tqMax",targetId:"SubOp",routerKind:"manhattan",children:[ne()]},{id:"SubOp->MultOpEgas",type:"edge:straight",sourceId:"SubOp",targetId:"MultOpEgas",routerKind:"manhattan",children:[ne()]},{id:"MultOpEgas->AddOpEgas",type:"edge:straight",sourceId:"MultOpEgas",targetId:"AddOpEgas",routerKind:"manhattan",children:[ne()]},{id:"AddOpEgas->AddOpCalcReq",type:"edge:straight",sourceId:"AddOpEgas",targetId:"AddOpCalcReq",routerKind:"manhattan",children:[ne()]},{id:"subController->AddOpCalcReq",type:"edge:straight",sourceId:"subController",targetId:"AddOpCalcReq",routerKind:"manhattan",children:[ne(),{id:"controllerOutputLabel",text:"Tqs_tqIdleSpdCtrlCorr",type:"label:text",cssClasses:["inputOutputLabel"],edgePlacement:{position:.15,side:"left",rotate:!1}}]},{id:"AddOpCalcReq->Tqs_tqReqCalc",type:"edge:straight",sourceId:"AddOpCalcReq",targetId:"Tqs_tqReqCalc",routerKind:"manhattan",children:[ne()]},{id:"Tqs_flgTorqueRegOverride->Relais",type:"edge:straight",sourceId:"Tqs_flgTorqueRegOverride",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1165,y:27.5}],children:[ne()]},{id:"Tqs_tqReqCalc->Relais",type:"edge:straight",sourceId:"Tqs_tqReqCalc",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1110,y:120}],children:[ne()]},{id:"Tqs_tqReqMan->Relais",type:"edge:straight",sourceId:"Tqs_tqReqMan",targetId:"Relais",routerKind:"manhattan",routingPoints:[{x:1110,y:150}],children:[ne()]},{id:"Relais->Tqs_tqReq",type:"edge:straight",sourceId:"Relais",targetId:"Tqs_tqReq",routerKind:"manhattan",children:[ne()]}]};function BP(){jP("sprotty-showcase").get(LP.TYPES.ModelSource).setModel(NP)}document.addEventListener("DOMContentLoaded",()=>BP());})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/
//# sourceMappingURL=bundle.js.map
